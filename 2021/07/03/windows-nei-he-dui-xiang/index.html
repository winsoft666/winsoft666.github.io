<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ä¸“æ³¨è½¯ä»¶å¼€å‘ï¼Œæ¶‰è¶³å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ç­‰é¢†åŸŸ"><title>Windowså†…æ ¸å¯¹è±¡ | æ±Ÿé›ªæ¡¥ | Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Windowså†…æ ¸å¯¹è±¡</h1><a id="logo" href="/.">æ±Ÿé›ªæ¡¥ | Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Windowså†…æ ¸å¯¹è±¡</h1><div class="post-meta">2021-07-03<span> | </span><span class="category"><a href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/">Windowsæ ¸å¿ƒç¼–ç¨‹</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1"><span class="toc-text">ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-text">äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-text">ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%80%E6%AF%81"><span class="toc-text">å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="toc-text">4.1 å¼•ç”¨è®¡æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%AD%A3%E7%A1%AE%E7%9A%84%E9%94%80%E6%AF%81%E6%96%B9%E5%BC%8F"><span class="toc-text">4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%8E%B7%E5%8F%96%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="toc-text">4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E8%B7%A8%E8%BF%9B%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="toc-text">äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BD%BF%E7%94%A8%E5%8F%A5%E6%9F%84%E7%BB%A7%E6%89%BF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8DuplicateHandle%E6%96%B9%E5%BC%8F"><span class="toc-text">5.2 ä½¿ç”¨DuplicateHandleæ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E4%BD%BF%E7%94%A8%E5%91%BD%E5%90%8D%E7%9A%84%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">5.3.1 å®ç°åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4%E7%A9%BA%E9%97%B4"><span class="toc-text">5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡"></a>ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡</h2><p>æˆ‘ä»¬åœ¨windowså¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°å†…æ ¸å¯¹è±¡ï¼Œå¦‚äº‹ä»¶(Event)ï¼Œç®¡é“(Pipe)ï¼Œäº’æ–¥é‡(Mutex)ï¼Œå®Œæˆç«¯å£(IOCP)ï¼Œè¿›ç¨‹(Process)ï¼Œçº¿ç¨‹(Thread)ç­‰ï¼Œä»–ä»¬éƒ½æ˜¯å†…æ ¸å¯¹è±¡ã€‚è¿™äº›å†…æ ¸å¯¹è±¡è™½ç„¶é€šè¿‡ä¸åŒçš„ç³»ç»ŸAPIæ¥åˆ›å»ºï¼Œä½†è¿™äº›APIéƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œå°±æ˜¯éƒ½éœ€è¦ä¼ å…¥<code>SECURITY_ATTRIBUTES</code>å®‰å…¨æè¿°ç¬¦ç»“æ„ä½“æŒ‡é’ˆï¼Œå¹¶ä¸”è¿”å›å¥æŸ„(HANDLE)ã€‚ä¾æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯å†…æ ¸å¯¹è±¡ï¼Œå°±æ˜¯çœ‹åˆ›å»ºå®ƒçš„å‡½æ•°æ˜¯å¦å…è®¸ä¼ å…¥<code>SECURITY_ATTRIBUTES</code>å®‰å…¨æè¿°ç¬¦ã€‚</p>
<h2 id="äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º"><a href="#äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º"></a>äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º</h2><p>å¤§å¤šæ•°åˆ›å»ºå†…æ ¸å¯¹è±¡çš„ç³»ç»ŸAPIå‡½æ•°ï¼Œå¦‚CreateEvent, CreateMutex, CreateThread, CreateProcess, CreatePipe, CreateNamedPipeç­‰éƒ½ä¼šè¿”å›ä¸€ä¸ªHANDLEï¼ˆæ— è®ºæ˜¯ä»¥è¿”å›å€¼çš„å½¢å¼ï¼Œè¿˜æ˜¯ä»¥æŒ‡é’ˆå‚æ•°çš„å½¢å¼è¿”å›ï¼‰ï¼Œåˆ›å»ºå†…æ ¸å¯¹è±¡æˆåŠŸæ—¶HANDLEä¸º<code>éNULL</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†HANDLEçš„å€¼ä¸NULLè¿›è¡Œæ¯”è¾ƒï¼Œæ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ä½†æ˜¯æœ‰äº›å‡½æ•°æ¯”è¾ƒä¾‹å¤–ï¼Œå¦‚<code>CreateFile</code>ï¼Œè¿™äº›å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè¿”å›çš„<code>HANDLE</code>çš„å€¼ä¸º<code>INVALID_HANDLE_VALUIE</code>ã€‚</p>
<h2 id="ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®"><a href="#ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®" class="headerlink" title="ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®"></a>ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®</h2><p><strong>è™½ç„¶å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸ï¼Œä½†åˆ›å»ºå‡½æ•°è¿”å›çš„<code>HANDLE</code>å¥æŸ„å´åªå’Œå½“å‰è¿›ç¨‹æœ‰å…³ï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¿™ä¸ªå¥æŸ„ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ã€‚</strong><br>å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸çº§åˆ«ï¼Œä¸ºäº†ç³»ç»Ÿå®‰å…¨æ€§ï¼ŒWindowsä¸å…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡çš„å†…å­˜åŒºåŸŸï¼Œåªå…è®¸æˆ‘ä»¬é€šè¿‡Windowsæä¾›çš„ä¸€ç³»åˆ—APIæ¥è®¿é—®å†…æ ¸å¯¹è±¡ï¼Œå¦‚<code>SetEvent</code>, <code>ResetEvent</code>ç­‰ç­‰ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°æ—¶æˆ‘ä»¬éƒ½ä¼šç”¨åˆ°<code>HANDLE</code>ï¼Œwindowså¤´æ–‡ä»¶ä¸­<code>HANDLE</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *HANDLE;</span><br></pre></td></tr></tbody></table></figure>
<p>è™½ç„¶å®šä¹‰ä¸º<code>void*</code>ç±»å‹ï¼Œä½†å¾ˆæ˜¾ç„¶è¿™ä¸ª<code>HANDLE</code>ä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆã€‚</p>
<blockquote>
<p>å¦‚ä½•è¯æ˜HANDLEä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆï¼Ÿ<br>ä¸€æ–¹é¢ç›´æ¥æ‰§è¡Œå†…æ ¸å¯¹è±¡æ¯«æ— å®‰å…¨æ€§å¯è¨€ï¼›<br>å¦ä¸€æ–¹é¢å†…æ ¸å¯¹è±¡ä¿å­˜åœ¨å†…æ ¸åœ°å€ç©ºé—´ï¼ˆ32ä½ç³»ç»Ÿæ˜¯<code>0x80000000 åˆ° 0xFFFFFFFF</code>ï¼Œ64ä½ç³»ç»Ÿæ˜¯<code>0x00000040 00000000åˆ°0xFFFFFFFF FFFFFFFF</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ç±»ä¼¼<code>CreateEvent</code>çš„å‡½æ•°åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œè§‚å¯Ÿå…¶è¿”å›çš„HANDLEï¼Œæ˜æ˜¾ä¸åœ¨å†…æ ¸åœ°å€ç©ºé—´çš„èŒƒå›´å†…ï¼Œä¸”å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆè¿™ä¸ª<code>HANDLEå¥æŸ„</code>æ˜¯å¦‚ä½•ä¸å†…æ ¸å¯¹è±¡å…³è”èµ·æ¥çš„äº†ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<strong>è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚</strong><br>æ¯ä¸ªè¿›ç¨‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå¥æŸ„è¡¨(Windowsæ²¡æœ‰æä¾›å®˜æ–¹çš„æ–‡æ¡£æ¥ä»‹ç»å¥æŸ„è¡¨)ï¼Œå‚è€ƒã€ŠWindowsæ ¸å¿ƒç¼–ç¨‹ã€‹å¾—çŸ¥å¥æŸ„è¡¨çš„ç»“æ„ï¼Œå¦‚å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>ç´¢å¼•</th>
<th>æŒ‡å‘å†…æ ¸å¯¹è±¡å†…å­˜å—çš„æŒ‡é’ˆ</th>
<th>è®¿é—®æ©ç </th>
<th>æ ‡å¿—</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>0x????????</td>
<td>0x????????</td>
<td>0x????????</td>
</tr>
<tr>
<td>2</td>
<td>0x????????</td>
<td>0x????????</td>
<td>0x????????</td>
</tr>
<tr>
<td>â€¦</td>
<td>â€¦</td>
<td>â€¦</td>
<td>â€¦</td>
</tr>
</tbody></table>
<p>å¦‚æˆ‘ä»¬è°ƒç”¨ç±»ä¼¼<code>CreateEvent</code>çš„å‡½æ•°è¿”å›çš„å¥æŸ„<code>HANDLE</code>å°±æ˜¯å¥æŸ„è¡¨ä¸­çš„<code>ç´¢å¼•</code>ã€‚å› ä¸ºæ˜¯<code>ç´¢å¼•</code>ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚æˆ‘ä»¬å‘windows APIå‡½æ•°ä¼ å…¥è¿™ä¸ª<code>ç´¢å¼•</code>ï¼ŒAPIå†é€šè¿‡<code>ç´¢å¼•</code>æ‰¾åˆ°å¯¹åº”çš„<code>å†…æ ¸å¯¹è±¡æŒ‡é’ˆ</code>ã€‚</p>
<h2 id="å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯"><a href="#å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯" class="headerlink" title="å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯"></a>å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯</h2><h3 id="4-1-å¼•ç”¨è®¡æ•°"><a href="#4-1-å¼•ç”¨è®¡æ•°" class="headerlink" title="4.1 å¼•ç”¨è®¡æ•°"></a>4.1 å¼•ç”¨è®¡æ•°</h3><p><strong>å†…æ ¸å¯¹è±¡çš„æ‰€æœ‰è€…æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œè€Œä¸æ˜¯åˆ›å»ºå®ƒçš„è¿›ç¨‹ã€‚</strong></p>
<p>å¤šä¸ªè¿›ç¨‹å¯ä»¥å¼•ç”¨ï¼ˆä½¿ç”¨ï¼‰åŒä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨äº†è®¡æ•°å™¨çš„æ–¹å¼æ¥ç®¡ç†å†…æ ¸å¯¹è±¡ï¼ˆè¿™ä¸ªå’ŒC++ä¸­çš„<code>std::shared_ptr</code>æ™ºèƒ½æŒ‡é’ˆç±»ä¼¼ï¼‰ï¼Œä¸€ä¸ªå†…æ ¸å¯¹è±¡å…¶å®æœ‰ä¸¤ä¸ªè®¡æ•°å™¨ï¼šä¸€ä¸ªæ˜¯ç»™ç”¨æˆ·æ€(Ring3)ç”¨çš„å¥æŸ„è®¡æ•°ï¼›å¦ä¸€ä¸ªæ˜¯æŒ‡é’ˆè®¡æ•°ï¼Œä¹Ÿå«å¼•ç”¨è®¡æ•°ï¼Œå› ä¸ºæ ¸å¿ƒæ€ç¨‹åº(Ring0)ä¹Ÿç»å¸¸ç”¨åˆ°å†…æ ¸å¯¹è±¡ï¼Œä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œåœ¨æ ¸å¿ƒæ€çš„ä»£ç ç”¨æŒ‡é’ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼Œæ‰€ä»¥å†…æ ¸å¯¹è±¡çš„ç®¡ç†å™¨ä¹Ÿç»´æŠ¤äº†è¿™ä¸ªæŒ‡é’ˆå¼•ç”¨è®¡æ•°ã€‚åªæœ‰åœ¨å†…æ ¸å¯¹è±¡çš„<code>å¥æŸ„è®¡æ•°</code>å’Œ<code>å¼•ç”¨è®¡æ•°</code>éƒ½ä¸º0æ—¶ï¼Œè¯¥å†…æ ¸å¯¹è±¡æ‰è¢«é‡Šæ”¾ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒæŒ‡é’ˆå¼•ç”¨è®¡æ•°å€¼æ¯”å¥æŸ„è®¡æ•°å€¼å¤§ã€‚ </p>
<h3 id="4-2-æ­£ç¡®çš„é”€æ¯æ–¹å¼"><a href="#4-2-æ­£ç¡®çš„é”€æ¯æ–¹å¼" class="headerlink" title="4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼"></a>4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼</h3><p>å½“ç¨‹åºä¸å†ä½¿ç”¨å†…æ ¸å¯¹è±¡æ—¶ï¼Œéœ€è¦è°ƒç”¨<code>CloseHandle</code>å°†å†…æ ¸å¯¹è±¡çš„è®¡æ•°å‡1ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸åœ¨è¯¥å¯¹è±¡è®¡æ•°ä¸º0æ—¶ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«ä»»ä½•ä¸œè¥¿å¼•ç”¨æ—¶ï¼‰å°†é”€æ¯è¯¥å¯¹è±¡ã€‚ <strong>å¹¶ä¸”åœ¨è°ƒç”¨<code>CloseHandle</code>ä¹‹åï¼Œç¨‹åºè¿˜åº”è¯¥å°†<code>HANDLE</code>ç½®ä¸º<code>NULL</code>ã€‚</strong></p>
<p> å¦‚æœ<code>CloseHandle</code>ä¹‹åä¸å°†<code>HANDLE</code>ç½®ä¸º<code>NULL</code>ï¼Œåè€Œå†æ¬¡ä½¿ç”¨è¯¥<code>HANDLE</code>ï¼Œå°±ä¼šå‡ºç°2ç§æƒ…å†µï¼š</p>
<ol>
<li><p>è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥<code>HANDLE</code>æ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•å·²ç»è¢«æ¸…é™¤ï¼Œä¸”æ²¡æœ‰åˆ«çš„çº¿ç¨‹å†æ¬¡åœ¨è¯¥ç´¢å¼•åˆ›å»ºè®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„<code>HANDLE</code>è°ƒç”¨Win32 APIå‡½æ•°ï¼ŒWindowsä¼šè¿”å›æ— æ•ˆå‚æ•°é”™è¯¯ã€‚è¿™ç§æƒ…å†µè¿˜æ¯”è¾ƒå¥½è°ƒè¯•ã€‚</p>
</li>
<li><p>è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥<code>HANDLE</code>æ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•åŒæ ·ä¹Ÿå·²ç»è¢«æ¸…é™¤ï¼Œä½†å·²ç»æœ‰åˆ«çš„çº¿ç¨‹ï¼ˆè¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹ï¼‰åœ¨è¯¥<code>ç´¢å¼•</code>ä½ç½®åˆ›å»ºäº†è®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„<code>HANDLE</code>è°ƒç”¨Win32 APIå‡½æ•°ï¼Œè¯¥<code>HANDLE</code>å°±ä¼šå¼•ç”¨åˆ°å…¶ä»–çº¿ç¨‹æ–°å»ºçš„é‚£ä¸ªå†…æ ¸å¯¹è±¡ï¼Œä»è€Œå‡ºç°ä¸€äº›éš¾ä»¥é¢„æ–™çš„é”™è¯¯ã€‚è¿™ç§é”™è¯¯å¾ˆéš¾è°ƒè¯•ã€‚</p>
</li>
</ol>
<h3 id="4-3-è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°"><a href="#4-3-è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°" class="headerlink" title="4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°"></a>4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</h3><p>è™½ç„¶windowsæ²¡æœ‰æä¾›APIè®©ç”¨æˆ·åœ¨ç”¨æˆ·æ€ï¼ˆRing3ï¼‰æŸ¥è¯¢ä¸€ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„è®¡æ•°å’Œå¼•ç”¨è®¡æ•°ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»<code>Ntdll.dll</code>å¯¼å‡º<code>NtQueryObject</code>å‡½æ•°æ¥å®ç°æŸ¥è¯¢å†…æ ¸å¯¹è±¡çš„å½“å‰çŠ¶æ€(è¯¥å‡½æ•°æ²¡æœ‰è¢«æ–‡æ¡£åŒ–)ã€‚ </p>
<p><code>NtQueryObject</code>å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›å€¼ï¼šå¦‚æœæˆåŠŸåˆ™è¿”å›0</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">NtQueryObject</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE   handle,       <span class="comment">// å¾…æŸ¥è¯¢çš„å¥æŸ„</span></span></span></span><br><span class="line"><span class="params"><span class="function">DWORD   nQueryIndex,   <span class="comment">// 0ä¸ºæŸ¥è¯¢å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¥æŸ„è®¡æ•°ï¼Œå¼•ç”¨è®¡æ•°ç­‰ç­‰ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">VOID*   pOutBuffer,    <span class="comment">// å­˜æ”¾æŸ¥è¯¢ç»“æœ</span></span></span></span><br><span class="line"><span class="params"><span class="function">DWORD   cbInBufferSize,   <span class="comment">// pOutBufferçš„å¤§å°ï¼Œå¦‚æœnQueryIndexä¸º0ï¼Œè¿™é‡Œä¸ºsizeof(SYSTEM_HANDLE_STATE)</span></span></span></span><br><span class="line"><span class="params"><span class="function">VOID*   cbOutBufferSize   <span class="comment">// å®é™…å¤§å°</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;  </span><br></pre></td></tr></tbody></table></figure>

<p>å°†<code>NtQueryObject</code>å‡½æ•°è°ƒç”¨çš„ç»†èŠ‚å°è£…åˆ°<code>GetKernelObjectRefCount</code>å‡½æ•°ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GetKernelObjectRefCount</span><span class="params">(HANDLE handle, DWORD &amp;handle_count, DWORD &amp;point_count)</span> </span>{</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_SYSTEM_HANDLE_STATE</span> {</span><br><span class="line">		DWORD   r1;</span><br><span class="line">		DWORD   GrantedAccess;</span><br><span class="line">		DWORD   HandleCount;      <span class="comment">// å‡1ä¸ºå¥æŸ„è®¡æ•° </span></span><br><span class="line">		DWORD   ReferenceCount;   <span class="comment">// å‡1ä¸ºæŒ‡é’ˆå¼•ç”¨è®¡æ•° </span></span><br><span class="line">		DWORD   r5;</span><br><span class="line">		DWORD   r6;</span><br><span class="line">		DWORD   r7;</span><br><span class="line">		DWORD   r8;</span><br><span class="line">		DWORD   r9;</span><br><span class="line">		DWORD   r10;</span><br><span class="line">		DWORD   r11;</span><br><span class="line">		DWORD   r12;</span><br><span class="line">		DWORD   r13;</span><br><span class="line">		DWORD   r14;</span><br><span class="line">	}SYSTEM_HANDLE_STATE, *PSYSTEM_HANDLE_STATE;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI *PFN_NtQueryObject)</span><span class="params">(HANDLE handle,</span></span></span><br><span class="line"><span class="params"><span class="function">		DWORD nQueryIndex,</span></span></span><br><span class="line"><span class="params"><span class="function">		VOID* pOutBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">		DWORD cbInBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">		VOID* cbOutBufferSize)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">static</span> PFN_NtQueryObject pfnNtQueryObject = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">bool</span> ret = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> {</span><br><span class="line">		<span class="keyword">if</span> (pfnNtQueryObject == <span class="literal">NULL</span>) {</span><br><span class="line">			HMODULE ntdll = <span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">"Ntdll.dll"</span>));</span><br><span class="line">			<span class="keyword">if</span> (ntdll == <span class="literal">NULL</span>)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">			pfnNtQueryObject = (PFN_NtQueryObject)<span class="built_in">GetProcAddress</span>(ntdll, <span class="string">"NtQueryObject"</span>);</span><br><span class="line">			<span class="keyword">if</span> (pfnNtQueryObject == <span class="literal">NULL</span>)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		}</span><br><span class="line">		</span><br><span class="line">		SYSTEM_HANDLE_STATE sys_handle_state;</span><br><span class="line">		<span class="built_in">memset</span>(&amp;sys_handle_state, <span class="number">0</span>, <span class="built_in">sizeof</span>(SYSTEM_HANDLE_STATE));</span><br><span class="line"></span><br><span class="line">		DWORD out_buf_size = <span class="number">0</span>;</span><br><span class="line">		ret = (<span class="built_in">pfnNtQueryObject</span>(handle, <span class="number">0</span>, &amp;sys_handle_state, <span class="built_in">sizeof</span>(SYSTEM_HANDLE_STATE), &amp;out_buf_size) == <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (ret) {</span><br><span class="line">			handle_count = sys_handle_state.HandleCount - <span class="number">1</span>;</span><br><span class="line">			point_count = sys_handle_state.ReferenceCount - <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line">	} <span class="keyword">while</span> (<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®"><a href="#äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®" class="headerlink" title="äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®"></a>äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®</h2><p>è™½ç„¶å†…æ ¸å¯¹è±¡ä½äºç‹¬ç«‹äºè¿›ç¨‹ä¹‹å¤–çš„å†…æ ¸åŒºåŸŸï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­å´åªèƒ½é€šè¿‡è°ƒç”¨Win32 APIä¼ å…¥HANDLEå‚æ•°æ¥æ“ä½œå†…æ ¸å¯¹è±¡ï¼ˆå¦‚<code>SetEvent</code>ç­‰ï¼‰ã€‚ç„¶è€Œ<code>HANDLEå¥æŸ„</code>åªå¯¹å½“å‰è¿›ç¨‹æœ‰æ•ˆï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¯¥å¥æŸ„å°±æ— æ•ˆäº†ã€‚æ‰€ä»¥è¯´ï¼Œè·¨è¿›ç¨‹è®¿é—®å†…æ ¸å¯¹è±¡çš„å…³é”®åœ¨äºæˆ‘ä»¬æ€ä¹ˆè·¨è¿›ç¨‹è®¿é—®<code>å¥æŸ„HANDLE</code>ï¼Ÿ</p>
<p>ä¸‹é¢ä»‹ç»å‡ ç§æ–¹æ³•æ¥å®ç°è·¨è¿›ç¨‹å…±äº«å†…æ ¸å¯¹è±¡ã€‚</p>
<h3 id="5-1-ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼"><a href="#5-1-ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼" class="headerlink" title="5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼"></a>5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼</h3><p>åªæœ‰è¿›ç¨‹ä¹‹é—´æœ‰çˆ¶å­å…³ç³»æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶å…è®¸å­è¿›ç¨‹è®¿é—®çˆ¶è¿›ç¨‹çš„å†…æ ¸å¯¹è±¡ã€‚ä¸ºäº†ä½¿è¿™ç§ç»§æ‰¿ç”Ÿæ•ˆï¼Œçˆ¶è¿›ç¨‹å¿…é¡»æ‰§è¡Œå‡ ä¸ªæ­¥éª¤ï¼š<br>ï¼ˆ1ï¼‰. çˆ¶è¿›ç¨‹åœ¨åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡æ—¶ï¼Œçˆ¶è¿›ç¨‹å¿…é¡»å‘ç³»ç»ŸæŒ‡å®šå®ƒå¸Œæœ›è¿™ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å†…æ ¸å¯¹è±¡ï¼Œå¿…é¡»åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ª<code>SECURITY_ATTRIBUTES</code>ç»“æ„ï¼Œå¦‚ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SECURITY_ATTRIBUTES sa;</span><br><span class="line">sa.nLength = <span class="built_in">sizeof</span>(SECURITY_ATTRIBUTES);</span><br><span class="line">sa.bInheritHandle = TRUE;  <span class="comment">// å¯ç»§æ‰¿çš„</span></span><br><span class="line">sa.lpSecurityDescriptor = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(&amp;sa, TRUE, FALSE, <span class="literal">NULL</span>); </span><br></pre></td></tr></tbody></table></figure>

<p>ï¼ˆ2ï¼‰. çˆ¶è¿›ç¨‹é€šè¿‡CreateProcessç”Ÿæˆå­è¿›ç¨‹ï¼Œä¸”æŒ‡å®š<code>bInheritHandles</code>ä¸ºTRUEï¼Œä»è€Œå…è®¸å­è¿›ç¨‹æ¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„é‚£äº›â€œå¯ç»§æ‰¿çš„å¥æŸ„â€ã€‚</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨å­è¿›ç¨‹TestB.exeï¼Œå°†å¥æŸ„hä½œä¸ºå¯åŠ¨å‚æ•°ä¼ ç»™è¿›ç¨‹TestB</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">TCHAR cmd_buf[MAX_PATH];</span><br><span class="line"><span class="built_in">StringCchPrintf</span>(cmd_buf, MAX_PATH, <span class="built_in">TEXT</span>(<span class="string">"TestB.exe %ld"</span>), (<span class="type">long</span>)h);</span><br><span class="line"></span><br><span class="line">STARTUPINFO si = { <span class="built_in">sizeof</span>(si) };</span><br><span class="line">PROCESS_INFORMATION pi;</span><br><span class="line">BOOL ret = <span class="built_in">CreateProcess</span>(</span><br><span class="line">	<span class="literal">NULL</span>, </span><br><span class="line">	cmd_buf, </span><br><span class="line">	<span class="literal">NULL</span>, </span><br><span class="line">	<span class="literal">NULL</span>, </span><br><span class="line">	TRUE,  <span class="comment">// æŒ‡å®šå­è¿›ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„â€œå¯ç»§æ‰¿å¥æŸ„â€</span></span><br><span class="line">	<span class="number">0</span>, </span><br><span class="line">	<span class="literal">NULL</span>, </span><br><span class="line">	<span class="literal">NULL</span>, </span><br><span class="line">	&amp;si, </span><br><span class="line">	&amp;pi</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(pi.hProcess);</span><br><span class="line"><span class="built_in">CloseHandle</span>(pi.hThread);</span><br></pre></td></tr></tbody></table></figure>

<p>ç”±äºæˆ‘ä»¬ä¼ ç»™<code>bInheritHandles</code>å‚æ•°çš„å€¼æ˜¯<code>TRUE</code>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼šå¤šåšä¸€ä»¶äº‹æƒ…ï¼šå®ƒä¼šéå†çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨ï¼Œå¯¹å®ƒçš„æ¯ä¸€é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œå‡¡æ˜¯åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„â€œå¯ç»§æ‰¿çš„å¥æŸ„â€çš„é¡¹ï¼Œéƒ½ä¼šå°†è¯¥é¡¹å®Œæ•´çš„å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚åœ¨å­è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­ï¼Œå¤åˆ¶é¡¹çš„ä½ç½®ä¸å®ƒåœ¨çˆ¶è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ä½ç½®å®Œå…¨ä¸€æ ·ï¼ˆåŒ…å«ç´¢å¼•ï¼‰ï¼Œè¿™ä¸ªå°±æ„å‘³ç€ï¼šåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­ï¼Œå¯¹ä¸€ä¸ªå†…æ ¸å¯¹è±¡è¿›è¡Œæ ‡è¯†çš„å¥æŸ„å€¼ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é€šè¿‡æŸç§æ–¹å¼ï¼ˆå¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„å¯åŠ¨å‚æ•°çš„æ–¹å¼ï¼Œæˆ–è€…ç¯å¢ƒå˜é‡çš„æ–¹å¼ç­‰ä»»ä½•è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼ï¼‰å°†è¿™ä¸ªå€¼å‘Šè¯‰å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°±å¯ä»¥å°†è¯¥å€¼è½¬æˆ<code>HANDLE</code>ï¼Œç„¶åä½¿ç”¨è¿™ä¸ª<code>HANDLE</code>æ¥è°ƒç”¨ç³»ç»ŸAPIã€‚</p>
<h3 id="5-2-ä½¿ç”¨DuplicateHandleæ–¹å¼"><a href="#5-2-ä½¿ç”¨DuplicateHandleæ–¹å¼" class="headerlink" title="5.2 ä½¿ç”¨DuplicateHandleæ–¹å¼"></a>5.2 ä½¿ç”¨DuplicateHandleæ–¹å¼</h3><p>DuplicateHandleå‡½æ•°å¯ä»¥å°†æŒ‡å®šâ€œæºè¿›ç¨‹çš„å¥æŸ„è¡¨â€ä¸­çš„æŸä¸€é¡¹<strong>å¤åˆ¶</strong>åˆ°â€œç›®çš„è¿›ç¨‹å¥æŸ„è¡¨â€ä¸­ï¼ˆé™¤äº†ç´¢å¼•ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥é¡¹åœ¨ç›®çš„è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ç´¢å¼•ï¼ˆå³HADNLEï¼‰ã€‚<br>å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨DuplicateHandleå‡½æ•°ï¼ŒDuplicateHandleå¯¹æºå¥æŸ„æ˜¯å¦æ˜¯å¯ç»§æ‰¿çš„æ²¡æœ‰è¦æ±‚ã€‚</p>
<p>å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">DuplicateHandle</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hSourceProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hSourceHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hTargetProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPHANDLE lpTargetHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD dwDesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bInheritHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD dwOptions</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>DuplicateHandleè¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒMSDNï¼š<a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx</a></p>
</blockquote>
<p>DuplicateHandleå‡½æ•°ä¸èƒ½å¤åˆ¶æ‰€æœ‰ç±»å‹çš„å¥æŸ„ï¼Œåªèƒ½å¤åˆ¶å¦‚ä¸‹ç±»å‹çš„å¥æŸ„ï¼ˆä»MSDNå¤åˆ¶è€Œæ¥ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>Object</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Access token</td>
<td>The handle is returned by the CreateRestrictedToken, DuplicateToken, DuplicateTokenEx, OpenProcessToken, or OpenThreadToken function.</td>
</tr>
<tr>
<td>Change notification</td>
<td>The handle is returned by the FindFirstChangeNotification function.</td>
</tr>
<tr>
<td>Communications device</td>
<td>The handle is returned by the CreateFile function.</td>
</tr>
<tr>
<td>Console input</td>
<td>The handle is returned by the CreateFile function when CONIN$ is specified, or by the GetStdHandle function when STD_INPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process.</td>
</tr>
<tr>
<td>Console screen buffer</td>
<td>The handle is returned by the CreateFile function when CONOUT$ is specified, or by the GetStdHandle function when STD_OUTPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process.</td>
</tr>
<tr>
<td>Desktop</td>
<td>The handle is returned by the GetThreadDesktop function.</td>
</tr>
<tr>
<td>Event</td>
<td>The handle is returned by the CreateEvent or OpenEvent function.</td>
</tr>
<tr>
<td>File</td>
<td>The handle is returned by the CreateFile function.</td>
</tr>
<tr>
<td>File mapping</td>
<td>The handle is returned by the CreateFileMapping function.</td>
</tr>
<tr>
<td>Job</td>
<td>The handle is returned by the CreateJobObject function.</td>
</tr>
<tr>
<td>Mailslot</td>
<td>The handle is returned by the CreateMailslot function.</td>
</tr>
<tr>
<td>Mutex</td>
<td>The handle is returned by the CreateMutex or OpenMutex function.</td>
</tr>
<tr>
<td>Pipe</td>
<td>A named pipe handle is returned by the CreateNamedPipe or CreateFile function. An anonymous pipe handle is returned by the CreatePipe function.</td>
</tr>
<tr>
<td>Process</td>
<td>The handle is returned by the CreateProcess, GetCurrentProcess, or OpenProcess function.</td>
</tr>
<tr>
<td>Registry key</td>
<td>The handle is returned by the RegCreateKey, RegCreateKeyEx, RegOpenKey, or RegOpenKeyEx function. Note that registry key handles returned by the RegConnectRegistry function cannot be used in a call to DuplicateHandle.</td>
</tr>
<tr>
<td>Semaphore</td>
<td>The handle is returned by the CreateSemaphore or OpenSemaphore function.</td>
</tr>
<tr>
<td>Thread</td>
<td>The handle is returned by the CreateProcess, CreateThread, CreateRemoteThread, or GetCurrentThread function</td>
</tr>
<tr>
<td>Timer</td>
<td>The handle is returned by the CreateWaitableTimer or OpenWaitableTimer function.</td>
</tr>
<tr>
<td>Transaction</td>
<td>The handle is returned by the CreateTransaction function.</td>
</tr>
<tr>
<td>Window station</td>
<td>The handle is returned by the GetProcessWindowStation function.</td>
</tr>
</tbody></table>
<p>ä¸åŒçš„äº‹ä»¶ç±»å‹å¯¹åº”çš„<code>dwDesiredAccess</code>å‚æ•°ä¸åŒï¼Œå…·ä½“å‚è€ƒ<a target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx">MSDN</a>ã€‚</p>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p><strong>è¿›ç¨‹TestAæºç </strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>{</span><br><span class="line">	HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯åŠ¨å­è¿›ç¨‹TestB.exe</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	TCHAR cmd_buf[MAX_PATH];</span><br><span class="line">	<span class="built_in">StringCchPrintf</span>(cmd_buf, MAX_PATH, <span class="built_in">TEXT</span>(<span class="string">"D:\\TestB.exe"</span>), (<span class="type">long</span>)h);</span><br><span class="line"></span><br><span class="line">	STARTUPINFO si = { <span class="built_in">sizeof</span>(si) };</span><br><span class="line">	PROCESS_INFORMATION pi;</span><br><span class="line">	BOOL ret = <span class="built_in">CreateProcess</span>(<span class="literal">NULL</span>, cmd_buf, <span class="literal">NULL</span>, <span class="literal">NULL</span>, TRUE, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line">	<span class="built_in">assert</span>(ret);</span><br><span class="line">	<span class="built_in">assert</span>(pi.hProcess);</span><br><span class="line"></span><br><span class="line">	HANDLE duplicated_h = <span class="literal">NULL</span>;</span><br><span class="line">	ret = <span class="built_in">DuplicateHandle</span>(<span class="built_in">GetCurrentProcess</span>(), h, pi.hProcess, &amp;duplicated_h, <span class="number">0</span>, FALSE, DUPLICATE_SAME_ACCESS);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">WaitForSingleObject</span>(pi.hProcess, INFINITE);</span><br><span class="line">	<span class="built_in">CloseHandle</span>(pi.hProcess);</span><br><span class="line">	<span class="built_in">CloseHandle</span>(pi.hThread);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> has_signal = <span class="built_in">WaitForSingleObject</span>(h, <span class="number">0</span>) == WAIT_OBJECT_0;</span><br><span class="line">	<span class="built_in">assert</span>(has_signal == <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>


<p><strong>å­è¿›ç¨‹TestBæºç </strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	<span class="type">long</span> l = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Input Handle:"</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%ld"</span>, &amp;l);</span><br><span class="line"></span><br><span class="line">	HANDLE h = (HANDLE)l;</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> has_signal = <span class="built_in">WaitForSingleObject</span>(h, <span class="number">0</span>) == WAIT_OBJECT_0;</span><br><span class="line">	<span class="built_in">assert</span>(has_signal == <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">SetEvent</span>(h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨çˆ¶è¿›ç¨‹TestAä¸­åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„äº‹ä»¶ -&gt; ç„¶åå¯åŠ¨å­è¿›ç¨‹TestB -&gt; è°ƒç”¨DuplicateHandleå¤åˆ¶å¥æŸ„é¡¹åˆ°TestBè¿›ç¨‹å¥æŸ„è¡¨ -&gt; å¹¶å‘TestBè¾“å…¥å¥æŸ„å€¼ -&gt; TestBè®¿é—®è¯¥äº‹ä»¶å¥æŸ„ï¼Œå°†äº‹ä»¶ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ã€‚</p>
<h3 id="5-3-ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼"><a href="#5-3-ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼" class="headerlink" title="5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼"></a>5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼</h3><h4 id="5-3-1-å®ç°åŸç†"><a href="#5-3-1-å®ç°åŸç†" class="headerlink" title="5.3.1 å®ç°åŸç†"></a>5.3.1 å®ç°åŸç†</h4><p>è¿™ç§æ–¹å¼ä¸¥æ ¼çš„è¯´å·²ç»ä¸æ˜¯æ–‡ç« å¼€å¤´è¯´åˆ°çš„è·¨è¿›ç¨‹è®¿é—®å¥æŸ„äº†ï¼Œæœ‰ç‚¹ç±»ä¼¼è·¨è¿›ç¨‹ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡äº†ã€‚<br>è¯¥æ–¹å¼å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨è°ƒç”¨åˆ›å»ºå†…æ ¸å¯¹è±¡çš„<code>Create***</code>å‡½æ•°æ—¶ï¼Œé€šè¿‡<code>pszName</code>å‚æ•°ä¸ºå†…æ ¸å¯¹è±¡å–ä¸€ä¸ªåå­—ã€‚<br>å¦‚åˆ›å»ºäº‹ä»¶Eventçš„å‡½æ•°<code>CreateEvent</code>ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE WINAPI <span class="title">CreateEvent</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  LPSECURITY_ATTRIBUTES lpEventAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bManualReset,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bInitialState,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPCTSTR lpName  <span class="comment">// æŒ‡å®šåç§°</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="built_in">TEXT</span>(<span class="string">"TestA_Obj"</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>è‹¥åœ¨å…¶ä»–è¿›ç¨‹ä¸­è¦è®¿é—®è¿™ä¸ªå†…æ ¸å¯¹è±¡ï¼Œåªéœ€è¦ä½¿ç”¨æ‰“å¼€å‡½æ•°<code>Open***</code>æ‰“å¼€è¯¥å†…æ ¸å¯¹è±¡ï¼Œ<strong>ç³»ç»Ÿå°±ä¼šåœ¨è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶è¿”å›è¿™æ¡è®°å½•çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯å¥æŸ„</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰“å¼€å†…æ ¸å¯¹è±¡æ—¶éœ€è¦ç•™æ„<code>è¿”å›å€¼</code>å’Œ<code>GetLastError</code>å‡½æ•°çš„è¿”å›å€¼ã€‚ç”±äºå†…æ ¸å¯¹è±¡æ˜¯æœ‰è®¿é—®æƒé™çš„ï¼Œæœ‰æ—¶å€™è™½ç„¶è¿™ä¸ªåå­—çš„å†…æ ¸å¯¹è±¡å­˜åœ¨ï¼Œä½†è¯¥è¿›ç¨‹å´ä¸è§å¾—æœ‰æƒé™å¯ä»¥æ‰“å¼€å®ƒï¼Œè¿™ä¸ªæ—¶å€™<code>GetLastError</code>å‡½æ•°ä¼šè¿”å›å¤±è´¥çš„åŸå› ã€‚</p>
<p>ä»¥æ‰“å¼€äº‹ä»¶çš„å‡½æ•°<code>OpenEvent</code>ä¸ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">OpenEvent</span>(READ_CONTROL, FALSE, <span class="built_in">TEXT</span>(<span class="string">"TestA_Obj"</span>));</span><br><span class="line"><span class="keyword">if</span> (h == <span class="literal">NULL</span>) {</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">GetLastError</span>() == ERROR_ACCESS_DENIED) { <span class="comment">// æ²¡æœ‰READ_CONTROLæƒé™</span></span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="5-3-2-å…¨å±€å‘½ä»¤ç©ºé—´"><a href="#5-3-2-å…¨å±€å‘½ä»¤ç©ºé—´" class="headerlink" title="5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´"></a>5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´</h4><p>ä¸åŒçš„ä¼šè¯ï¼ˆSessionï¼‰æœ‰ä¸åŒçš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼ˆå¦‚windowsæœåŠ¡ç¨‹åºä½äº<code>Session 0</code>ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ä½äº<code>Session 1</code>ï¼‰ï¼Œè¦é€šè¿‡åç§°è®¿é—®å…¶ä»–ä¼šè¯ä¸­çš„å†…æ ¸å¯¹è±¡ï¼Œéœ€è¦åœ¨åç§°å‰é¢åŠ ä¸Š<code>Session\&lt;å½“å‰ä¼šè¯ID&gt;</code>ã€‚Windowsæä¾›äº†ä¸€ä¸ªå…¨å±€çš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼Œå¤„äºä»»ä½•ä¼šè¯ä¸­çš„è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®è¯¥å‘½åç©ºé—´ï¼Œå°†å†…æ ¸å¯¹è±¡æ”¾å…¥å…¨å±€å‘½ä»¤ç©ºé—´çš„æ–¹å¼å¾ˆç®€å•ï¼šåªéœ€è¦åœ¨å†…æ ¸å¯¹è±¡åç§°å‰åŠ å…¥<code>Global\</code>å³å¯ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="built_in">TEXT</span>(<span class="string">"Global\\TestA_Obj"</span>));</span><br></pre></td></tr></tbody></table></figure>

</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>Windowså†…æ ¸å¯¹è±¡</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>æ±Ÿé›ªæ¡¥</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2021-07-03</p><p><span>æœ€åæ›´æ–°ï¼š</span>2023-07-14</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/2021/07/03/windows-nei-he-dui-xiang/">https://jiangxueqiao.com/2021/07/03/windows-nei-he-dui-xiang/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://jiangxueqiao.com/2021/07/03/windows-nei-he-dui-xiang/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p></div><br><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HANDLE/" rel="tag">HANDLE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1/" rel="tag">å†…æ ¸å¯¹è±¡</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8F%A5%E6%9F%84/" rel="tag">å¥æŸ„</a></li></ul></div><div class="post-nav"><a class="pre" href="/2021/08/21/bian-yi-qi-ji-chu-gai-nian/">ç¼–è¯‘å™¨åŸºç¡€æ¦‚å¿µ</a><a class="next" href="/2021/06/03/c-shi-xian-bian-yi-shi-duan-yan/">C++å®ç°ç¼–è¯‘æ—¶æ–­è¨€</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.png"/></a><p>All things are difficult before they are easy.</p><a class="info-icon" href="mailto:smart7178@163.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/winsoft666" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://1key.run" title="1key.run" target="_blank">1key.run</a></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CMake/">CMake</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CentOS/">CentOS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Qt/">Qt</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vcpkg/">Vcpkg</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows%E5%86%85%E5%AD%98%E4%BD%93%E7%B3%BB/">Windowså†…å­˜ä½“ç³»</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/">Windowsæ ¸å¿ƒç¼–ç¨‹</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows%E6%B3%A8%E5%85%A5%E4%B8%8E%E6%8B%A6%E6%88%AA/">Windowsæ³¨å…¥ä¸æ‹¦æˆª</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%88%91%E7%9A%84%E4%BA%A7%E5%93%81/">æˆ‘çš„äº§å“</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%B9%E5%A4%84%E7%90%86/">æ‰¹å¤„ç†</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8B%A8%E5%BC%80%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E8%BF%B7%E9%9B%BE/">æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">ç½‘ç»œ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">ç½‘ç»œåè®®</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95/">è½¯ä»¶è°ƒè¯•</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%85%92/">é…’</a><span class="category-list-count">1</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/." rel="nofollow">æ±Ÿé›ªæ¡¥ | Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>