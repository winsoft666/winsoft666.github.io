<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="C++生成条形码, Windows,Linux,C++,Qt,Node.js,Electron,WebRTC">
    <meta name="description" content="一、条形码介绍条形码(barcode)是将宽度不等的多个黑条和空白，按照一定的编码规则排列，用以表达一组信息的图形标识符。常见的条形码是由反射率相差很大的黑条（简称条）和白条（简称空）排成的平行线图案。
条码种类很多，常见的大概有二十多种码">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>C++生成条形码 | Jiangxueqiao&#39;s Site</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://static.1key.run/cherry.svg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Jiangxueqiao&#39;s Site</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a target="_blank" rel="noopener" href="https://support.qq.com/products/597551" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://static.1key.run/cherry.svg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Jiangxueqiao&#39;s Site</div>
        <div class="logo-desc">
            
            总结⚡归纳⚡沉淀⚡分享
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a target="_blank" rel="noopener" href="https://support.qq.com/products/597551" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://static.1key.run/blog/matery-theme/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">C++生成条形码</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%9D%A1%E5%BD%A2%E7%A0%81/">
                                <span class="chip bg-color">条形码</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/C/" class="post-category">
                                C++
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-06-25
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2023-07-05
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.2k
                </div>
                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="一、条形码介绍"><a href="#一、条形码介绍" class="headerlink" title="一、条形码介绍"></a>一、条形码介绍</h1><p>条形码(<code>barcode</code>)是将宽度不等的多个黑条和空白，按照一定的编码规则排列，用以表达一组信息的图形标识符。常见的条形码是由反射率相差很大的黑条（简称条）和白条（简称空）排成的平行线图案。</p>
<p><strong>条码种类很多，常见的大概有二十多种码制，其中包括：</strong><br>Code39码（标准39码）、Codabar码（库德巴码）、Code25码（标准25码）、ITF25码（交叉25码）、Matrix25码（矩阵25码）、UPC-A码、UPC-E码、EAN-13码（EAN-13国际商品条码）、EAN-8码（EAN-8国际商品条码）、中国邮政码（矩阵25码的一种变体）、Code-B码、MSI码、Code11码、Code93码、ISBN码、ISSN码、Code128码（Code128码，包括EAN128码）、Code39EMS（EMS专用的39码）等一维条码和PDF417等二维条码。</p>
<p><strong>目前，国际广泛使用的条码种类有：</strong></p>
<ul>
<li>EAN码 —— 国际物品编码协会制定的一种商品用条码，通用于全世界。EAN码符号有标准版（EAN-13）和缩短版（EAN-8）两种，我国的通用商品条码与其等效，日常购买的商品包装上所印的条码一般就是EAN码。</li>
<li>UPC码 —— UPC码是美国统一代码委员会制定的一种商品用条码，主要用于美国和加拿大地区，我们在美国进口的商品上可以看到。</li>
<li>Code39码 —— 因其可采用数字与字母共同组成的方式而在各行业内部管理上被广泛使用。</li>
<li>Code93码 —— Code 93码与39码具有相同的字符集，但它的密度要比39码高，所以在面积不足的情况下，可以用93码代替39码</li>
<li>Codebar码 —— 可表示数字0 - 9，字符$、+、 -、还有只能用作起始/终止符的a,b,c d四个字符，可变长度，没有校验位，多用于血库,图书馆和照像馆的业务中。</li>
<li>Code128码 —— 128可表示ASCII 0 到 ASCII 127 共计128个ASCII字符。</li>
<li>CodeI2of5码 —— 只能表示数字0 -9 可变长度，连续性条形码，所有条与空都表示代码，第一个数字由条开始，第二个数字由空组成，空白区比窄条宽10倍，应用于商品批发、仓库、机场、生产/包装识别、工业中，条形码的识读率高，可适用于固定扫描器可靠扫描，在所有一维条形码中的密度最高。</li>
</ul>
<h1 id="二、C-方式实现"><a href="#二、C-方式实现" class="headerlink" title="二、C++方式实现"></a>二、C++方式实现</h1><p><strong><code>barcode.h</code></strong> 中实现了Code39、Code93、Code128、CodeI2of5等4种格式的条形码的生成。<br>具体使用方法：调用对应类的<code>DrawBarcode</code>函数将条形码绘制到HDC上，绘制到HDC上之后可以保存为图片或者显示到界面。</p>
<pre class="line-numbers language-CPP" data-language="CPP"><code class="language-CPP">#ifndef BARCODE_H_
#define BARCODE_H_
#pragma once

class Barcode39;
class Barcode93;
class BarcodeIof5;
class Barcode128;

static const int ga2_Code128[2][207] =
{
    {
        64,  65,  66,  67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,  78,  79,
        80,  81,  82,  83,  84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  95,
        0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,
        16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,  28,  29,  30,  31,
        32,  33,  34,  35,  36,  37,  38,  39,  40,  41,  42,  43,  44,  45,  46,  47,
        48,  49,  50,  51,  52,  53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  95,  96,  97,  98,  99, 100, 101, 102, 103, 104, 105, 106,
    },
    {
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        0,   1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,
        16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,  28,  29,  30,  31,
        32,  33,  34,  35,  36,  37,  38,  39,  40,  41,  42,  43,  44,  45,  46,  47,
        48,  49,  50,  51,  52,  53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63,
        64,  65,  66,  67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,  78,  79,
        80,  81,  82,  83,  84,  85,  86,  87,  88,  89,  90,  91,  92,  93,  94,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
        -1,  -1,  -1,  95,  96,  97,  98,  99, 100, 101, 102, 103, 104, 105, 106,
    },
};


class BarcodeBase {
public:
    BarcodeBase() {
        Clear();
        i_Ratio = 3;
    }

    void operator=(const BarcodeBase&amp;bc) {
        i_LenBuf = bc.i_LenBuf;
        i_Ratio = bc.i_Ratio;
        memcpy(ia_Buf, bc.ia_Buf, sizeof(ia_Buf));
    }

    void Clear() {
        memset(ia_Buf, 0, sizeof(ia_Buf));
        i_LenBuf = 0;
    }

    int GetEncodeLength()	const {
        BYTE*pb = (BYTE*)ia_Buf;
        int i, iLen = 0;
        for (i = 0; i &lt; i_LenBuf; i++) {
            //wide is 3
            if (*pb &amp; 2)	iLen += (i_Ratio - 1);
            pb++;
        }
        return iLen + i_LenBuf;
    }
    int GetBufferLength()	const {
        return i_LenBuf;
    }
    const BYTE&amp;GetAt(int i)	const {
        return ia_Buf[i];
    }
    int GetRatio()	const {
        return i_Ratio;
    }
    int SetRatio(int iRatio) {
        i_Ratio = iRatio;
        if (i_Ratio &lt;= 0)	i_Ratio = 1;
    }
    void DrawBarcode(HDC hDC, int iX, int iY0, int iY10, int iY11, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        HPEN hPenBar = ::CreatePen(PS_SOLID, iPenW, clrBar);
        HPEN hPenSpace = ::CreatePen(PS_SOLID, iPenW, clrSpace);

        HPEN hPenOld = (HPEN)::SelectObject(hDC, hPenBar);

        BYTE*pb = ia_Buf;
        int i0, iNum0 = i_LenBuf;

        BYTE bBar;
        int i1, iNum1;
        int iY;
        for (i0 = 0; i0 &lt; iNum0; i0++) {
            bBar = *pb &amp; 0x01;
            iNum1 = (*pb &amp; 0x02) ? i_Ratio : 1;
            iY = (*pb &amp; 0x04) ? iY11 : iY10;
            for (i1 = 0; i1 &lt; iNum1; i1++) {
                if (bBar)	::SelectObject(hDC, hPenBar);
                else		::SelectObject(hDC, hPenSpace);

                ::MoveToEx(hDC, iX, iY0, 0);
                ::LineTo(hDC, iX, iY);
                iX += iPenW;
            }
            pb++;
        }

        ::SelectObject(hDC, hPenOld);

        ::DeleteObject(hPenBar);
        ::DeleteObject(hPenSpace);
    }

protected:
    BYTE	ia_Buf[4096];
    int		i_LenBuf;

    int		i_Ratio;

    struct IntString {
        int ch;
        char*psz;
    };

};

class Barcode39 : public BarcodeBase {
    //[n/a][n/a][n/a][n/a][n/a][n/a][w-n][b-s]
public:
    Barcode39() {
    }
    ~Barcode39() {
    }

    BOOL Encode39(const char*pszCodeIn) {
        int iLen = strlen(pszCodeIn);

        char*pszCode = new char[iLen + 3];
        sprintf(pszCode, "*%s*", pszCodeIn);
        strupr(pszCode);

        BYTE*pFst = ia_Buf;
        BYTE*p0 = pFst, *p1;

        iLen += 2;
        int i;
        for (i = 0; i &lt; iLen; i++) {
            p1 = P_GetNarrowWideBarSpace39(pszCode[i], p0);
            if (p1 == 0)	return 0;
            p0 = p1;
        }
        i_LenBuf = p1 - pFst;
        delete[]pszCode;
        return 1;
    }

    void Draw39(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW);
    }

private:
    BYTE*P_GetNarrowWideBarSpace39(char ch, BYTE*pb) {
        IntString infs[] =
        {
            {'1',	"wnnwnnnnwn"},
            {'2',	"nnwwnnnnwn"},
            {'3',	"wnwwnnnnnn"},
            {'4',	"nnnwwnnnwn"},
            {'5',	"wnnwwnnnnn"},
            {'6',	"nnwwwnnnnn"},
            {'7',	"nnnwnnwnwn"},
            {'8',	"wnnwnnwnnn"},
            {'9',	"nnwwnnwnnn"},
            {'0',	"nnnwwnwnnn"},
            {'A',	"wnnnnwnnwn"},
            {'B',	"nnwnnwnnwn"},
            {'C',	"wnwnnwnnnn"},
            {'D',	"nnnnwwnnwn"},
            {'E',	"wnnnwwnnnn"},
            {'F',	"nnwnwwnnnn"},
            {'G',	"nnnnnwwnwn"},
            {'H',	"wnnnnwwnnn"},
            {'I',	"nnwnnwwnnn"},
            {'J',	"nnnnwwwnnn"},
            {'K',	"wnnnnnnwwn"},
            {'L',	"nnwnnnnwwn"},
            {'M',	"wnwnnnnwnn"},
            {'N',	"nnnnwnnwwn"},
            {'O',	"wnnnwnnwnn"},
            {'P',	"nnwnwnnwnn"},
            {'Q',	"nnnnnnwwwn"},
            {'R',	"wnnnnnwwnn"},
            {'S',	"nnwnnnwwnn"},
            {'T',	"nnnnwnwwnn"},
            {'U',	"wwnnnnnnwn"},
            {'V',	"nwwnnnnnwn"},
            {'W',	"wwwnnnnnnn"},
            {'X',	"nwnnwnnnwn"},
            {'Y',	"wwnnwnnnnn"},
            {'Z',	"nwwnwnnnnn"},
            {'-',	"nwnnnnwnwn"},
            {'.',	"wwnnnnwnnn"},
            {' ',	"nwwnnnwnnn"},
            {'*',	"nwnnwnwnnn"},
            {'$',	"nwnwnwnnnn"},
            {'/',	"nwnwnnnwnn"},
            {'+',	"nwnnnwnwnn"},
            {'%',	"nnnwnwnwnn"},
        };

        int i0, iNum0 = sizeof(infs) / sizeof(infs[0]);
        int i1;
        for (i0 = 0; i0 &lt; iNum0; i0++) {
            IntString&amp;inf = infs[i0];
            if (inf.ch == ch) {
                for (i1 = 0; i1 &lt; 10; i1++) {
                    if (inf.psz[i1] == 'w')	*pb += 2;
                    if (i1 % 2 == 0)			*pb += 1;
                    pb++;
                }
                return pb;
            }
        }
        return 0;
    }
};

class BarcodeI2of5 :public BarcodeBase {
    //[n/a][n/a][n/a][n/a][n/a][n/a][w-n][b-s]
public:
    BarcodeI2of5() {
    }
    ~BarcodeI2of5() {
    }

    BOOL EncodeI2of5(const char*pszCode) {
        Clear();
        BYTE*pFst = ia_Buf;
        BYTE*pb = pFst;

        const int iNum = strlen(pszCode);

        int i;
        //"nnnn"
        for (i = 0; i &lt; 4; i++) {
            if (i % 2 == 0)	*pb += 1;
            pb++;
        }

        int iV;
        for (i = 0; i &lt; iNum; i += 2) {
            iV = pszCode[i] - '0';
            iV = iV * 10;
            iV += pszCode[i + 1] - '0';
            pb = P_GetNarrorWideBarSpaceI2of5(pb, iV);
            if (pb == 0)	return 0;
        }

        //"wnn"
        *pb += 3;	pb++;
        *pb += 0;	pb++;
        *pb += 1;	pb++;

        i_LenBuf = pb - pFst;
        return 1;
    }

    void DrawI2of5(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW);
    }

private:
    BYTE*P_GetNarrorWideBarSpaceI2of5(BYTE*pb, int ch) {
        if (ch &lt; 0)	return 0;
        if (ch &gt; 99)	return 0;

        IntString infs[] =
        {
            {0,		"nnnnwwwwnn"},
            {1,		"nwnnwnwnnw"},
            {2,		"nnnwwnwnnw"},
            {3,		"nwnwwnwnnn"},
            {4,		"nnnnwwwnnw"},
            {5,		"nwnnwwwnnn"},
            {6,		"nnnwwwwnnn"},
            {7,		"nnnnwnwwnw"},
            {8,		"nwnnwnwwnn"},
            {9,		"nnnwwnwwnn"},
            {10,	"wnnnnwnwwn"},
            {11,	"wwnnnnnnww"},
            {12,	"wnnwnnnnww"},
            {13,	"wwnwnnnnwn"},
            {14,	"wnnnnwnnww"},
            {15,	"wwnnnwnnwn"},
            {16,	"wnnwnwnnwn"},
            {17,	"wnnnnnnwww"},
            {18,	"wwnnnnnwwn"},
            {19,	"wnnwnnnwwn"},
            {20,	"nnwnnwnwwn"},
            {21,	"nwwnnnnnww"},
            {22,	"nnwwnnnnww"},
            {23,	"nwwwnnnnwn"},
            {24,	"nnwnnwnnww"},
            {25,	"nwwnnwnnwn"},
            {26,	"nnwwnwnnwn"},
            {27,	"nnwnnnnwww"},
            {28,	"nwwnnnnwwn"},
            {29,	"nnwwnnnwwn"},
            {30,	"wnwnnwnwnn"},
            {31,	"wwwnnnnnnw"},
            {32,	"wnwwnnnnnw"},
            {33,	"wwwwnnnnnn"},
            {34,	"wnwnnwnnnw"},
            {35,	"wwwnnwnnnn"},
            {36,	"wnwwnwnnnn"},
            {37,	"wnwnnnnwnw"},
            {38,	"wwwnnnnwnn"},
            {39,	"wnwwnnnwnn"},
            {40,	"nnnnwwnwwn"},
            {41,	"nwnnwnnnww"},
            {42,	"nnnwwnnnww"},
            {43,	"nwnwwnnnwn"},
            {44,	"nnnnwwnnww"},
            {45,	"nwnnwwnnwn"},
            {46,	"nnnwwwnnwn"},
            {47,	"nnnnwnnwww"},
            {48,	"nwnnwnnwwn"},
            {49,	"nnnwwnnwwn"},
            {50,	"wnnnwwnwnn"},
            {51,	"wwnnwnnnnw"},
            {52,	"wnnwwnnnnw"},
            {53,	"wwnwwnnnnn"},
            {54,	"wnnnwwnnnw"},
            {55,	"wwnnwwnnnn"},
            {56,	"wnnwwwnnnn"},
            {57,	"wnnnwnnwnw"},
            {58,	"wwnnwnnwnn"},
            {59,	"wnnwwnnwnn"},
            {60,	"nnwnwwnwnn"},
            {61,	"nwwnwnnnnw"},
            {62,	"nnwwwnnnnw"},
            {63,	"nwwwwnnnnn"},
            {64,	"nnwnwwnnnw"},
            {65,	"nwwnwwnnnn"},
            {66,	"nnwwwwnnnn"},
            {67,	"nnwnwnnwnw"},
            {68,	"nwwnwnnwnn"},
            {69,	"nnwwwnnwnn"},
            {70,	"nnnnnwwwwn"},
            {71,	"nwnnnnwnww"},
            {72,	"nnnwnnwnww"},
            {73,	"nwnwnnwnwn"},
            {74,	"nnnnnwwnww"},
            {75,	"nwnnnwwnwn"},
            {76,	"nnnwnwwnwn"},
            {77,	"nnnnnnwwww"},
            {78,	"nwnnnnwwwn"},
            {79,	"nnnwnnwwwn"},
            {80,	"wnnnnwwwnn"},
            {81,	"wwnnnnwnnw"},
            {82,	"wnnwnnwnnw"},
            {83,	"wwnwnnwnnn"},
            {84,	"wnnnnwwnnw"},
            {85,	"wwnnnwwnnn"},
            {86,	"wnnwnwwnnn"},
            {87,	"wnnnnnwwnw"},
            {88,	"wwnnnnwwnn"},
            {89,	"wnnwnnwwnn"},
            {90,	"nnwnnwwwnn"},
            {91,	"nwwnnnwnnw"},
            {92,	"nnwwnnwnnw"},
            {93,	"nwwwnnwnnn"},
            {94,	"nnwnnwwnnw"},
            {95,	"nwwnnwwnnn"},
            {96,	"nnwwnwwnnn"},
            {97,	"nnwnnnwwnw"},
            {98,	"nwwnnnwwnn"},
            {99,	"nnwwnnwwnn"},
        };

        IntString&amp;inf = infs[ch];

        int i;
        for (i = 0; i &lt; 10; i++) {
            if (inf.psz[i] == 'w')	*pb += 2;
            if (i % 2 == 0)			*pb += 1;
            pb++;
        }
        return pb;
    }
};

class Barcode93 :public BarcodeBase {
    //[n/a][n/a][n/a][n/a][n/a][n/a][n/a][b-s]
public:
    Barcode93() {
    }
    ~Barcode93() {
    }

    BOOL Encode93(const char* pszCode) {
        Clear();
        const int iNum = strlen(pszCode);

        BYTE*pFst = ia_Buf;
        BYTE*pb = pFst;

        pb = P_GetBarSpace93(pb, 47);
        if (pb == 0)	return 0;

        BOOL b;
        int i, iFirst, iSecond;
        for (i = 0; i &lt; iNum; i++) {
            b = P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond);
            if (b == 0)	return 0;

            pb = P_GetBarSpace93(pb, iFirst);
            if (pb == 0)	return 0;

            if (iSecond != -1) {
                pb = P_GetBarSpace93(pb, iSecond);
                if (pb == 0)	return 0;
            }
        }

        pb = P_GetCheckDigits(pb, pszCode);
        if (pb == 0)	return 0;

        pb = P_GetBarSpace93(pb, 48);
        if (pb == 0)	return 0;

        i_LenBuf = pb - pFst;
        return 1;
    }

    void Draw93(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW);
    }

private:
    BYTE*P_GetBarSpace93(BYTE*pb, int ch) {
        if (ch &lt; 0)	return 0;
        if (ch &gt; 48)	return 0;

        IntString infs[] =
        {
            {0,		"bsssbsbss"},
            {1,		"bsbssbsss"},
            {2,		"bsbsssbss"},
            {3,		"bsbssssbs"},
            {4,		"bssbsbsss"},
            {5,		"bssbssbss"},
            {6,		"bssbsssbs"},
            {7,		"bsbsbssss"},
            {8,		"bsssbssbs"},
            {9,		"bssssbsbs"},
            {10,	"bbsbsbsss"},
            {11,	"bbsbssbss"},
            {12,	"bbsbsssbs"},
            {13,	"bbssbsbss"},
            {14,	"bbssbssbs"},
            {15,	"bbsssbsbs"},
            {16,	"bsbbsbsss"},
            {17,	"bsbbssbss"},
            {18,	"bsbbsssbs"},
            {19,	"bssbbsbss"},
            {20,	"bsssbbsbs"},
            {21,	"bsbsbbsss"},
            {22,	"bsbssbbss"},
            {23,	"bsbsssbbs"},
            {24,	"bssbsbbss"},
            {25,	"bsssbsbbs"},
            {26,	"bbsbbsbss"},
            {27,	"bbsbbssbs"},
            {28,	"bbsbsbbss"},
            {29,	"bbsbssbbs"},
            {30,	"bbssbsbbs"},
            {31,	"bbssbbsbs"},
            {32,	"bsbbsbbss"},
            {33,	"bsbbssbbs"},
            {34,	"bssbbsbbs"},
            {35,	"bssbbbsbs"},
            {36,	"bssbsbbbs"},
            {37,	"bbbsbsbss"},
            {38,	"bbbsbssbs"},
            {39,	"bbbssbsbs"},
            {40,	"bsbbsbbbs"},
            {41,	"bsbbbsbbs"},
            {42,	"bbsbsbbbs"},
            {43,	"bssbssbbs"},
            {44,	"bbbsbbsbs"},
            {45,	"bbbsbsbbs"},
            {46,	"bssbbssbs"},
            {47,	"bsbsbbbbs"},
            {48,	"bsbsbbbbsb"},
        };

        IntString&amp;inf = infs[ch];
        int i;
        for (i = 0; i &lt; 9; i++) {
            if (inf.psz[i] == 'b')	*pb += 1;
            pb++;
        }

        if (ch == 48) {
            *pb += 1;
            pb++;
        }
        return pb;
    }

private:
    BYTE*P_GetCheckDigits(BYTE*pb, const char*&amp;pszCode) {
        int i, iSum, iWeight, iFirst, iSecond;

        // "C" check digit character
        iWeight = 1;
        iSum = 0;

        const int iNum = strlen(pszCode);

        for (i = iNum - 1; i &gt; -1; i--) {
            P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond);

            iSum += (iWeight*iFirst);
            iWeight++;
            if (iWeight &gt; 20)	iWeight = 1;

            if (iSecond != -1) {
                iSum += (iWeight*iSecond);
                iWeight++;
                if (iWeight &gt; 20)	iWeight = 1;
            }
        }

        pb = P_GetBarSpace93(pb, iSum % 47);
        if (pb == 0)	return 0;

        iWeight = 2;
        iSum = iSum % 47;
        for (i = iNum - 1; i &gt; -1; i--) {
            P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond);

            iSum += (iWeight * iFirst);
            iWeight++;
            if (iWeight &gt; 15)	iWeight = 1;

            if (iSecond != -1) {
                iSum += (iWeight * iSecond);
                iWeight++;
                if (iWeight &gt; 15)	iWeight = 1;
            }
        }

        pb = P_GetBarSpace93(pb, iSum % 47);
        if (pb == 0)	return 0;

        return pb;
    }

    BOOL P_AscIItoCode93Sequence(int iValue, int&amp;iFirst, int&amp;iSecond) {
        if (iValue &lt; 0)	return 0;
        if (iValue &gt; 127)	return 0;

        struct	I3 { int iV, iFirst, iSecond; };

        I3 i3s[] =
        {
            {0,	44,	30},
            {1,	43,	10},
            {2,	43,	11},
            {3,	43,	12},
            {4,	43,	13},
            {5,	43,	14},
            {6,	43,	15},
            {7,	43,	16},
            {8,	43,	17},
            {9,	43,	18},
            {10,43,	19},
            {11,43,	20},
            {12,43,	21},
            {13,43,	22},
            {14,43,	23},
            {15,43,	24},
            {16,43,	25},
            {17,43,	26},
            {18,43,	27},
            {19,43,	28},
            {20,43,	29},
            {21,43,	30},
            {22,43,	31},
            {23,43,	32},
            {24,43,	33},
            {25,43,	34},
            {26,43,	35},
            {27,44,	10},
            {28,44,	11},
            {29,44,	12},
            {30,44,	13},
            {31,44,	14},
            {32,38,	-1},
            {33,45,	10},
            {34,45,	11},
            {35,45,	12},
            {36,39,	-1},
            {37,42,	-1},
            {38,45,	15},
            {39,45,	16},
            {40,45,	17},
            {41,45,	18},
            {42,45,	19},
            {43,41,	-1},
            {44,45,	21},
            {45,36,	-1},
            {46,37,	-1},
            {47,40,	-1},
            {48,0,	-1},
            {49,1,	-1},
            {50,2,	-1},
            {51,3,	-1},
            {52,4,	-1},
            {53,5,	-1},
            {54,6,	-1},
            {55,7,	-1},
            {56,8,	-1},
            {57,9,	-1},
            {58,45,	35},
            {59,44,	15},
            {60,44,	16},
            {61,44,	17},
            {62,44,	18},
            {63,44,	19},
            {64,44,	31},
            {65,10,	-1},
            {66,11,	-1},
            {67,12,	-1},
            {68,13,	-1},
            {69,14,	-1},
            {70,15,	-1},
            {71,16,	-1},
            {72,17,	-1},
            {73,18,	-1},
            {74,19,	-1},
            {75,20,	-1},
            {76,21,	-1},
            {77,22,	-1},
            {78,23,	-1},
            {79,24,	-1},
            {80,25,	-1},
            {81,26,	-1},
            {82,27,	-1},
            {83,28,	-1},
            {84,29,	-1},
            {85,30,	-1},
            {86,31,	-1},
            {87,32,	-1},
            {88,33,	-1},
            {89,34,	-1},
            {90,35,	-1},
            {91,44,	20},
            {92,44,	21},
            {93,44,	22},
            {94,44,	23},
            {95,44,	24},
            {96,44,	32},
            {97,46,	10},
            {98,46,	11},
            {99,46,	12},
            {100,46,13},
            {101,46,14},
            {102,46,15},
            {103,46,16},
            {104,46,17},
            {105,46,18},
            {106,46,19},
            {107,46,20},
            {108,46,21},
            {109,46,22},
            {110,46,23},
            {111,46,24},
            {112,46,25},
            {113,46,26},
            {114,46,27},
            {115,46,28},
            {116,46,29},
            {117,46,30},
            {118,46,31},
            {119,46,32},
            {120,46,33},
            {121,46,34},
            {122,46,35},
            {123,44,25},
            {124,44,26},
            {125,44,27},
            {126,44,28},
            {127,44,29},
        };

        I3&amp;i3 = i3s[iValue];
        iFirst = i3.iFirst;
        iSecond = i3.iSecond;
        return 1;
    }
};

class Barcode128 :public BarcodeBase {
public:
    Barcode128() {
    }
    ~Barcode128() {
    }

    BOOL Encode128A(const char* pszCode) { return P_Encode128((char*)pszCode, SUB::SETA); }
    BOOL Encode128B(const char* pszCode) { return P_Encode128((char*)pszCode, SUB::SETB); }
    BOOL Encode128C(const char* pszCode) { return P_Encode128((char*)pszCode, SUB::SETC); }

    void Draw128(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW);
    }

private:
    struct SUB {
        enum {
            SETA = 0,
            SETB = 1,
            SETC = 2,
        };
    };

    BOOL P_Encode128(char*pszCode, const int iSetIn) {
        Clear();
        BYTE*pFst = ia_Buf;
        BYTE*pb = pFst;


        if (iSetIn == SUB::SETA)	pb = P_GetBarSpace128(pb, 103);
        else
            if (iSetIn == SUB::SETB)	pb = P_GetBarSpace128(pb, 104);
            else					pb = P_GetBarSpace128(pb, 105);
            if (pb == 0)	return 0;

            const int iCheckDigit = GetCheckDigit(iSetIn, pszCode);
            const int iNum = strlen(pszCode);

            int iChar, iCharNext;
            int iPosition = 0;
            int iSet = iSetIn;

            while (iPosition &lt; iNum) {
                if (iSet == SUB::SETC) {
                    if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 101) {
                        pb = P_GetBarSpace128(pb, 101);
                        iPosition++;
                        iSet = SUB::SETA;
                    }
                    else
                        if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 100) {
                            pb = P_GetBarSpace128(pb, 100);
                            iPosition++;
                            iSet = SUB::SETB;
                        }
                        else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 102) {
                            pb = P_GetBarSpace128(pb, 100);
                            iPosition++;
                        }
                        else {
                            char chT = pszCode[iPosition + 2];
                            pszCode[iPosition + 2] = 0;
                            iChar = atoi(&amp;pszCode[iPosition]);
                            pszCode[iPosition + 2] = chT;

                            pb = P_GetBarSpace128(pb, iChar);
                            if (pb == 0)	return 0;
                            iPosition += 2;
                        }
                }
                else {
                    int iTemp2 = pszCode[iPosition];
                    if (iTemp2 &lt; -1)	iTemp2 = iTemp2 &amp; 255;

                    iChar = ga2_Code128[iSet][iTemp2];

                    pb = P_GetBarSpace128(pb, iChar);
                    if (pb == 0)	return 0;
                    iPosition++;
                    if (iSet == SUB::SETA) {
                        if (iChar == 100)	iSet = SUB::SETB;
                        else
                            if (iChar == 99)	iSet = SUB::SETC;
                    }
                    else if (iSet == SUB::SETB) {
                        if (iChar == 101)	iSet = SUB::SETA;
                        else
                            if (iChar == 99)	iSet = SUB::SETC;
                    }
                    else
                        if (iChar == 98) {
                            if (iSet == SUB::SETA)
                                iCharNext = ga2_Code128[SUB::SETB][pszCode[iPosition]];
                            else
                                iCharNext = ga2_Code128[SUB::SETA][pszCode[iPosition]];

                            pb = P_GetBarSpace128(pb, iChar);
                            if (pb == 0)	return 0;
                            iPosition++;
                        }
                }
            }

            pb = P_GetBarSpace128(pb, iCheckDigit);
            if (pb == 0)	return 0;
            pb = P_GetBarSpace128(pb, 106);
            i_LenBuf = pb - pFst;

            return 1;
    }

    BYTE*P_GetBarSpace128(BYTE*pb, int iV) {
        if (iV &lt; 0)	return 0;
        if (iV &gt; 106)	return 0;
        IntString infs[] =
        {
            {0,		"bbsbbssbbss"},
            {1,		"bbssbbsbbss"},
            {2,		"bbssbbssbbs"},
            {3,		"bssbssbbsss"},
            {4,		"bssbsssbbss"},
            {5,		"bsssbssbbss"},
            {6,		"bssbbssbsss"},
            {7,		"bssbbsssbss"},
            {8,		"bsssbbssbss"},
            {9,		"bbssbssbsss"},
            {10,	"bbssbsssbss"},
            {11,	"bbsssbssbss"},
            {12,	"bsbbssbbbss"},
            {13,	"bssbbsbbbss"},
            {14,	"bssbbssbbbs"},
            {15,	"bsbbbssbbss"},
            {16,	"bssbbbsbbss"},
            {17,	"bssbbbssbbs"},
            {18,	"bbssbbbssbs"},
            {19,	"bbssbsbbbss"},
            {20,	"bbssbssbbbs"},
            {21,	"bbsbbbssbss"},
            {22,	"bbssbbbsbss"},
            {23,	"bbbsbbsbbbs"},
            {24,	"bbbsbssbbss"},
            {25,	"bbbssbsbbss"},
            {26,	"bbbssbssbbs"},
            {27,	"bbbsbbssbss"},
            {28,	"bbbssbbsbss"},
            {29,	"bbbssbbssbs"},
            {30,	"bbsbbsbbsss"},
            {31,	"bbsbbsssbbs"},
            {32,	"bbsssbbsbbs"},
            {33,	"bsbsssbbsss"},
            {34,	"bsssbsbbsss"},
            {35,	"bsssbsssbbs"},
            {36,	"bsbbsssbsss"},
            {37,	"bsssbbsbsss"},
            {38,	"bsssbbsssbs"},
            {39,	"bbsbsssbsss"},
            {40,	"bbsssbsbsss"},
            {41,	"bbsssbsssbs"},
            {42,	"bsbbsbbbsss"},
            {43,	"bsbbsssbbbs"},
            {44,	"bsssbbsbbbs"},
            {45,	"bsbbbsbbsss"},
            {46,	"bsbbbsssbbs"},
            {47,	"bsssbbbsbbs"},
            {48,	"bbbsbbbsbbs"},
            {49,	"bbsbsssbbbs"},
            {50,	"bbsssbsbbbs"},
            {51,	"bbsbbbsbsss"},
            {52,	"bbsbbbsssbs"},
            {53,	"bbsbbbsbbbs"},
            {54,	"bbbsbsbbsss"},
            {55,	"bbbsbsssbbs"},
            {56,	"bbbsssbsbbs"},
            {57,	"bbbsbbsbsss"},
            {58,	"bbbsbbsssbs"},
            {59,	"bbbsssbbsbs"},
            {60,	"bbbsbbbbsbs"},
            {61,	"bbssbssssbs"},
            {62,	"bbbbsssbsbs"},
            {63,	"bsbssbbssss"},
            {64,	"bsbssssbbss"},
            {65,	"bssbsbbssss"},
            {66,	"bssbssssbbs"},
            {67,	"bssssbsbbss"},
            {68,	"bssssbssbbs"},
            {69,	"bsbbssbssss"},
            {70,	"bsbbssssbss"},
            {71,	"bssbbsbssss"},
            {72,	"bssbbssssbs"},
            {73,	"bssssbbsbss"},
            {74,	"bssssbbssbs"},
            {75,	"bbssssbssbs"},
            {76,	"bbssbsbssss"},
            {77,	"bbbbsbbbsbs"},
            {78,	"bbssssbsbss"},
            {79,	"bsssbbbbsbs"},
            {80,	"bsbssbbbbss"},
            {81,	"bssbsbbbbss"},
            {82,	"bssbssbbbbs"},
            {83,	"bsbbbbssbss"},
            {84,	"bssbbbbsbss"},
            {85,	"bssbbbbssbs"},
            {86,	"bbbbsbssbss"},
            {87,	"bbbbssbsbss"},
            {88,	"bbbbssbssbs"},
            {89,	"bbsbbsbbbbs"},
            {90,	"bbsbbbbsbbs"},
            {91,	"bbbbsbbsbbs"},
            {92,	"bsbsbbbbsss"},
            {93,	"bsbsssbbbbs"},
            {94,	"bsssbsbbbbs"},
            {95,	"bsbbbbsbsss"},
            {96,	"bsbbbbsssbs"},
            {97,	"bbbbsbsbsss"},
            {98,	"bbbbsbsssbs"},
            {99,	"bsbbbsbbbbs"},
            {100,	"bsbbbbsbbbs"},
            {101,	"bbbsbsbbbbs"},
            {102,	"bbbbsbsbbbs"},
            //			{103,	"bbsbsbbbbss"},
                        {103,	"bbsbssssbss"},
                        {104,	"bbsbssbssss"},
                        {105,	"bbsbssbbbss"},
                        {106,	"bbsssbbbsbsbb"},
        };

        int i;
        IntString&amp;inf = infs[iV];
        for (i = 0; i &lt; 11; i++) {
            if (inf.psz[i] == 'b')	*pb += 1;
            pb++;
        }
        if (iV == 106) {
            *pb += 1;	pb++;
            *pb += 1;	pb++;
        }
        return pb;
    }

private:
    int GetCheckDigit(const int iSet, char*pszCode) {
        int	iSum = 0, iCurSet = 0, iChar128, iCharNext, iWeight, iPosition;

        iCurSet = iSet;
        if (iSet == SUB::SETA) {
            iSum = 103;
        }
        else
            if (iSet == SUB::SETB) {
                iSum = 104;
            }
            else
                if (iSet == SUB::SETC) {
                    iSum = 105;
                }

        iPosition = 0;
        iWeight = 1;

        const int iNum = strlen(pszCode);
        while (iPosition &lt; iNum) {
            if (iCurSet == SUB::SETC) {
                if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 101) {
                    iChar128 = 101;
                    iSum += (iWeight*iChar128);

                    iPosition++;
                    iWeight++;
                    iCurSet = SUB::SETA;
                }
                else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 100) {
                    iChar128 = 100;
                    iSum += (iWeight*iChar128);
                    iPosition++;
                    iWeight++;
                    iCurSet = SUB::SETB;
                }
                else
                    if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 102) {
                        iChar128 = 102;
                        iSum += (iWeight*iChar128);
                        iPosition++;
                        iWeight++;
                    }
                    else {
                        char chT = pszCode[iPosition + 2];
                        pszCode[iPosition + 2] = 0;
                        iChar128 = atol(&amp;pszCode[iPosition]);
                        pszCode[iPosition + 2] = chT;

                        iSum += (iWeight*iChar128);
                        iPosition += 2;
                        iWeight++;
                    }
            }
            else {
                int iTemp2 = pszCode[iPosition];
                if (iTemp2 &lt; -1)	iTemp2 = iTemp2 &amp; 255;

                iChar128 = ga2_Code128[iCurSet][iTemp2];

                iSum += (iWeight*iChar128);

                iPosition++;
                iWeight++;

                if (iCurSet == SUB::SETA) {
                    if (iChar128 == 100)
                        iCurSet = SUB::SETB;
                    else if (iChar128 == 99)
                        iCurSet = SUB::SETC;
                }
                else
                    if (iCurSet == SUB::SETB) {
                        if (iChar128 == 101)		iCurSet = SUB::SETA;
                        else if (iChar128 == 99)	iCurSet = SUB::SETC;
                    }
                    else
                        if (iChar128 == 98) {
                            if (iCurSet == SUB::SETA)
                                iCharNext = ga2_Code128[SUB::SETB][pszCode[iPosition]];
                            else
                                iCharNext = ga2_Code128[SUB::SETA][pszCode[iPosition]];

                            iSum += (iWeight*iCharNext);
                            iPosition++;
                            iWeight++;
                        }
            }
        }
        return iSum % 103;
    }
};

//=============================================
class BarcodeEan13 :public BarcodeBase {
public:
    BarcodeEan13() {
    }
    ~BarcodeEan13() {
    }

    BOOL EncodeEan13(const char*pszCodeIn) {
        Clear();

        //only allow 12 characters as input
        char szCode[14];
        const int iLen = strlen(pszCodeIn);
        if (iLen &gt; 12) {
            strncpy(szCode, pszCodeIn, 12);
        }
        else {
            strcpy(szCode, pszCodeIn);
            while (strlen(szCode) &lt; 12)	strcat(szCode, "0");
        }

        BYTE*pFst = ia_Buf;
        BYTE*pb = pFst;

        //"bsb"-long
        *pb += 5;	pb++;
        *pb += 4;	pb++;
        *pb += 5;	pb++;

        BYTE iaCountryCode[6];
        BOOL b = P_GetCountryCode(szCode[0], iaCountryCode);
        if (b == 0)	return 0;

        pb = P_GetLeftOddParity(pb, szCode[1]);

        int i;
        for (i = 2; i &lt; 7; i++) {
            if (iaCountryCode[i - 2] == 'O') {
                pb = P_GetLeftOddParity(pb, szCode[i]);
            }
            else
                if (iaCountryCode[i - 2] == 'E') {
                    pb = P_GetLeftEvenParity(pb, szCode[i]);
                }
        }

        //"sbsbs"-long
        *pb += 4;	pb++;
        *pb += 5;	pb++;
        *pb += 4;	pb++;
        *pb += 5;	pb++;
        *pb += 4;	pb++;

        for (i = 7; i &lt; 12; i++) {
            pb = P_GetRightPattern(pb, szCode[i]);
        }

        i = P_GetCheckSumDigit(szCode);
        pb = P_GetRightPattern(pb, (char)i);

        //"bsb"-long
        *pb += 5;	pb++;
        *pb += 4;	pb++;
        *pb += 5;	pb++;

        i_LenBuf = pb - pFst;
        return 1;
    }

    void DrawEan13(HDC hDC, int iX, int iY0, int iY10, int iY11, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) {
        DrawBarcode(hDC, iX, iY0, iY10, iY11, clrBar, clrSpace, iPenW);
    }

private:
    BOOL P_GetCountryCode(char ch, BYTE*pbCountryCode) {
        const int iV = ch - '0';
        if (iV &lt; 0)	return 0;
        if (iV &gt; 9)	return 0;

        IntString infs[] =
        {
            {0,	"OOOOO"},
            {1,	"OEOEE"},
            {2,	"OEEOE"},
            {3,	"OEEEO"},
            {4,	"EOOEE"},
            {5,	"EEOOE"},
            {6,	"EEEOO"},
            {7,	"EOEOE"},
            {8,	"EOEEO"},
            {9,	"EEOEO"},
        };
        memcpy(pbCountryCode, infs[iV].psz, 5);
        return 1;
    }

    BYTE*P_GetLeftOddParity(BYTE*pb, char ch) {
        const int iV = ch - '0';
        if (iV &lt; 0)	return 0;
        if (iV &gt; 9)	return 0;


        IntString infs[] =
        {
            {0,	"sssbbsb"},
            {1,	"ssbbssb"},
            {2,	"ssbssbb"},
            {3,	"sbbbbsb"},
            {4,	"sbsssbb"},
            {5,	"sbbsssb"},
            {6,	"sbsbbbb"},
            {7,	"sbbbsbb"},
            {8,	"sbbsbbb"},
            {9,	"sssbsbb"},
        };

        IntString&amp;inf = infs[iV];
        int i;
        for (i = 0; i &lt; 7; i++) {
            if (inf.psz[i] == 'b')	*pb += 1;
            pb++;
        }
        return pb;
    }

    BYTE*P_GetLeftEvenParity(BYTE*pb, char ch) {
        const int iV = ch - '0';
        if (iV &lt; 0)	return 0;
        if (iV &gt; 9)	return 0;

        IntString infs[] =
        {
            {0,	"sbssbbb"},
            {1,	"sbbssbb"},
            {2,	"ssbbsbb"},
            {3,	"sbssssb"},
            {4,	"ssbbbsb"},
            {5,	"sbbbssb"},
            {6,	"ssssbsb"},
            {7,	"ssbsssb"},
            {8,	"sssbssb"},
            {9,	"ssbsbbb"},
        };
        char*psz = infs[iV].psz;
        int i;
        for (i = 0; i &lt; 7; i++) {
            if (psz[i] == 'b')	*pb += 1;
            pb++;
        }
        return pb;
    }

    BYTE*P_GetRightPattern(BYTE*pb, char ch) {
        const int iV = ch - '0';
        if (iV &lt; 0)	return 0;
        if (iV &gt; 9)	return 0;

        IntString infs[] =
        {
            {0,	"bbbssbs"},
            {1,	"bbssbbs"},
            {2,	"bbsbbss"},
            {3,	"bssssbs"},
            {4,	"bsbbbss"},
            {5,	"bssbbbs"},
            {6,	"bsbssss"},
            {7,	"bsssbss"},
            {8,	"bssbsss"},
            {9,	"bbbsbss"},
        };
        char*psz = infs[iV].psz;
        int i;
        for (i = 0; i &lt; 7; i++) {
            if (psz[i] == 'b')	*pb += 1;
            pb++;
        }
        return pb;
    }

    char P_GetCheckSumDigit(const char*pszCode) {
        const int iLen = strlen(pszCode);
        int i, iSum = 0, iItem;

        for (i = iLen; i &gt;= 1; i--) {
            iItem = i % 2 ? (pszCode[i - 1] - '0') * 1 : (pszCode[i - 1] - '0') * 3;
            iSum += iItem;
        }

        iSum %= 10;
        return '0' + (10 - iSum) % 10;
    }

};

#endif
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">jiangxueqiao.com</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jiangxueqiao.com/2023/06/25/c-sheng-cheng-tiao-xing-ma/">https://jiangxueqiao.com/2023/06/25/c-sheng-cheng-tiao-xing-ma/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">jiangxueqiao.com</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%9D%A1%E5%BD%A2%E7%A0%81/">
                                    <span class="chip bg-color">条形码</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/06/25/c-nei-cun-chi-shi-xian/">
                    <div class="card-image">
                        
                        <img src="https://static.1key.run/blog/img/cpp-fruit.jpg" class="responsive-img" alt="C++内存池实现">
                        
                        <span class="card-title">C++内存池实现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-06-25
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/C/" class="post-category">
                                    C++
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%86%85%E5%AD%98%E6%B1%A0/">
                        <span class="chip bg-color">内存池</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/06/25/windows-zhu-ce-url-xie-yi/">
                    <div class="card-image">
                        
                        <img src="https://static.1key.run/blog/img/windows1.jpg" class="responsive-img" alt="Windows注册URL协议">
                        
                        <span class="card-title">Windows注册URL协议</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-06-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/" class="post-category">
                                    Windows核心编程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/URL%E5%8D%8F%E8%AE%AE/">
                        <span class="chip bg-color">URL协议</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Jiangxueqiao&#39;s Site<br />'
            + '文章作者: jiangxueqiao.com<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <a href="/about" target="_blank">jiangxueqiao.com</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">87.3k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "6";
                        var startDate = "20";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
                <span id="icp"><img src="/medias/icp.png"
                                    style="vertical-align: text-bottom;"/>
                <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">鄂ICP备2020015399号-5</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/winsoft666" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:smart7178@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=295429457" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 295429457" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://jiangxueqiao.com"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
        <div style="position:fixed;bottom:125px;right:16px;cursor: pointer;">
            <a title="兔小巢" target="_blank" rel="noopener" href="https://support.qq.com/products/597551"><i class="fa fa-comments fa-3x"  aria-hidden="true"></i></a>
        </div>
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
