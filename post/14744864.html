<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Windows,Linux,C/C++,Golang,Qt,Node.js,Electron,Vue,WebRTC,NSIS,HTTP">
    <meta name="description" content="æ·±å…¥è·¨å¹³å°å®¢æˆ·ç«¯é¢†åŸŸï¼ŒæŒç»­æ„å»ºå®Œå–„çš„å®¢æˆ·ç«¯æŠ€æœ¯ä½“ç³»">
    <meta name="author" content="æ±Ÿé›ªæ¡¥">
    
    <title>
        
            Windowså†…æ ¸å¯¹è±¡ |
        
        JiangXueqiao&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/favicon.png">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
        
            
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"jiangxueqiao.com","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"JiangXueqiao's Blog","author":"æ±Ÿé›ªæ¡¥","avatar":"/images/avatar.png","logo":null,"favicon":"/images/favicon.png"},"menu":{"home":"/ || fa-solid fa-home","archives":"/archives || fa-solid fa-layer-group","categories":"/categories || fa-solid fa-box-archive","tags":"/tags || fa-solid fa-tags","about":"/about || fa-solid fa-user-graduate","ğŸ“˜ä¸“æ ":"/post/902225606.html","ğŸ”¥åŒ å¿ƒä¹‹ä½œ":"/post/3416050985.html","Github":"https://github.com/winsoft666"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":true,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":null,"category":true,"tag":true,"post_datetime":"updated"},"post":{"author_badge":{"enable":false,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":false},"comment":{"enable":false,"use":"twikoo","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":"https://twikoo.jiangxueqiao.com","region":"zh-CN","version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":2},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2017,"word_count":false,"icp":{"enable":true,"record_code":"é„‚ICPå¤‡2020015399å·-6","url":"https://beian.miit.gov.cn"},"site_deploy":{"enable":false,"provider":"github","url":null},"shields_style":{"enable":false,"custom":[{"link_url":null,"img_url":null}]}},"inject":{"enable":true,"css":[null,"/css/custom.css"],"js":[null]},"root":"","source_data":{},"version":"4.1.0"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="JiangXueqiao's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
            <a class="site-name border-box" href="/">
               JiangXueqiao&#39;s Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                    <i class="menu-icon fa-solid fa-home"></i>
                                
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                    <i class="menu-icon fa-solid fa-layer-group"></i>
                                
                                å½’æ¡£
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                
                                    <i class="menu-icon fa-solid fa-box-archive"></i>
                                
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                
                                    <i class="menu-icon fa-solid fa-tags"></i>
                                
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                
                                    <i class="menu-icon fa-solid fa-user-graduate"></i>
                                
                                å…³äº
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/post/902225606.html"
                            >
                                
                                ğŸ“˜ä¸“æ 
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/post/3416050985.html"
                            >
                                
                                ğŸ”¥åŒ å¿ƒä¹‹ä½œ
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               target="_blank" rel="noopener" href="https://github.com/winsoft666"
                            >
                                
                                GITHUB
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >é¦–é¡µ</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >å½’æ¡£</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories"
                    >åˆ†ç±»</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags"
                    >æ ‡ç­¾</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about"
                    >å…³äº</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/post/902225606.html"
                    >ğŸ“˜ä¸“æ </a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/post/3416050985.html"
                    >ğŸ”¥åŒ å¿ƒä¹‹ä½œ</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       target="_blank" rel="noopener" href="https://github.com/winsoft666"
                    >GITHUB</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Windowså†…æ ¸å¯¹è±¡
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.png">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">æ±Ÿé›ªæ¡¥</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2021-07-03 20:00:35</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Sun Mar 31 2024 19:06:20 GMT+0800">2024-03-31 19:06:20</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/Windows%E7%BC%96%E7%A8%8B/">Windowsç¼–ç¨‹</a></li>
                        
                    
                </ul>
            </span>
        

        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body">
                    

                    <h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡"></a>ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡</h2><p>æˆ‘ä»¬åœ¨ windows å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°å†…æ ¸å¯¹è±¡ï¼Œå¦‚äº‹ä»¶(Event)ï¼Œç®¡é“(Pipe)ï¼Œäº’æ–¥é‡(Mutex)ï¼Œå®Œæˆç«¯å£(IOCP)ï¼Œè¿›ç¨‹(Process)ï¼Œçº¿ç¨‹(Thread)ç­‰ï¼Œä»–ä»¬éƒ½æ˜¯å†…æ ¸å¯¹è±¡ã€‚è¿™äº›å†…æ ¸å¯¹è±¡è™½ç„¶é€šè¿‡ä¸åŒçš„ç³»ç»Ÿ API æ¥åˆ›å»ºï¼Œä½†è¿™äº› API éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œå°±æ˜¯éƒ½éœ€è¦ä¼ å…¥<code>SECURITY_ATTRIBUTES</code>å®‰å…¨æè¿°ç¬¦ç»“æ„ä½“æŒ‡é’ˆï¼Œå¹¶ä¸”è¿”å›å¥æŸ„(HANDLE)ã€‚ä¾æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯å†…æ ¸å¯¹è±¡ï¼Œå°±æ˜¯çœ‹åˆ›å»ºå®ƒçš„å‡½æ•°æ˜¯å¦å…è®¸ä¼ å…¥<code>SECURITY_ATTRIBUTES</code>å®‰å…¨æè¿°ç¬¦ã€‚</p>
<span id="more"></span>

<h2 id="äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º"><a href="#äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º" class="headerlink" title="äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º"></a>äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º</h2><p>å¤§å¤šæ•°åˆ›å»ºå†…æ ¸å¯¹è±¡çš„ç³»ç»Ÿ API å‡½æ•°ï¼Œå¦‚ CreateEvent, CreateMutex, CreateThread, CreateProcess, CreatePipe, CreateNamedPipe ç­‰éƒ½ä¼šè¿”å›ä¸€ä¸ª HANDLEï¼ˆæ— è®ºæ˜¯ä»¥è¿”å›å€¼çš„å½¢å¼ï¼Œè¿˜æ˜¯ä»¥æŒ‡é’ˆå‚æ•°çš„å½¢å¼è¿”å›ï¼‰ï¼Œåˆ›å»ºå†…æ ¸å¯¹è±¡æˆåŠŸæ—¶ HANDLE ä¸º<code>éNULL</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† HANDLE çš„å€¼ä¸ NULL è¿›è¡Œæ¯”è¾ƒï¼Œæ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ä½†æ˜¯æœ‰äº›å‡½æ•°æ¯”è¾ƒä¾‹å¤–ï¼Œå¦‚<code>CreateFile</code>ï¼Œè¿™äº›å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè¿”å›çš„<code>HANDLE</code>çš„å€¼ä¸º<code>INVALID_HANDLE_VALUIE</code>ã€‚</p>
<p>ç›¸å…³æ–‡ç« ï¼š<a href="/post/3906615635.html" title="ç”±HANDLEè¿”å›å€¼ä¸ç¡®å®šæ€§å¼•å‘çš„æ€è€ƒ">ç”±HANDLEè¿”å›å€¼ä¸ç¡®å®šæ€§å¼•å‘çš„æ€è€ƒ</a></p>
<h2 id="ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®"><a href="#ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®" class="headerlink" title="ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®"></a>ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®</h2><p><strong>è™½ç„¶å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸ï¼Œä½†åˆ›å»ºå‡½æ•°è¿”å›çš„<code>HANDLE</code>å¥æŸ„å´åªå’Œå½“å‰è¿›ç¨‹æœ‰å…³ï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¿™ä¸ªå¥æŸ„ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ã€‚</strong><br>å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸çº§åˆ«ï¼Œä¸ºäº†ç³»ç»Ÿå®‰å…¨æ€§ï¼ŒWindows ä¸å…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡çš„å†…å­˜åŒºåŸŸï¼Œåªå…è®¸æˆ‘ä»¬é€šè¿‡ Windows æä¾›çš„ä¸€ç³»åˆ— API æ¥è®¿é—®å†…æ ¸å¯¹è±¡ï¼Œå¦‚<code>SetEvent</code>, <code>ResetEvent</code>ç­‰ç­‰ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°æ—¶æˆ‘ä»¬éƒ½ä¼šç”¨åˆ°<code>HANDLE</code>ï¼Œwindows å¤´æ–‡ä»¶ä¸­<code>HANDLE</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *HANDLE;</span><br></pre></td></tr></tbody></table></figure>

<p>è™½ç„¶å®šä¹‰ä¸º<code>void*</code>ç±»å‹ï¼Œä½†å¾ˆæ˜¾ç„¶è¿™ä¸ª<code>HANDLE</code>ä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆã€‚</p>
<blockquote>
<p>å¦‚ä½•è¯æ˜ HANDLE ä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆï¼Ÿ<br>ä¸€æ–¹é¢ç›´æ¥æ‰§è¡Œå†…æ ¸å¯¹è±¡æ¯«æ— å®‰å…¨æ€§å¯è¨€ï¼›<br>å¦ä¸€æ–¹é¢å†…æ ¸å¯¹è±¡ä¿å­˜åœ¨å†…æ ¸åœ°å€ç©ºé—´ï¼ˆ32 ä½ç³»ç»Ÿæ˜¯<code>0x80000000 åˆ° 0xFFFFFFFF</code>ï¼Œ64 ä½ç³»ç»Ÿæ˜¯<code>0x00000040 00000000åˆ°0xFFFFFFFF FFFFFFFF</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ç±»ä¼¼<code>CreateEvent</code>çš„å‡½æ•°åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œè§‚å¯Ÿå…¶è¿”å›çš„ HANDLEï¼Œæ˜æ˜¾ä¸åœ¨å†…æ ¸åœ°å€ç©ºé—´çš„èŒƒå›´å†…ï¼Œä¸”å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆè¿™ä¸ª<code>HANDLEå¥æŸ„</code>æ˜¯å¦‚ä½•ä¸å†…æ ¸å¯¹è±¡å…³è”èµ·æ¥çš„äº†ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<strong>è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚</strong><br>æ¯ä¸ªè¿›ç¨‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå¥æŸ„è¡¨(Windows æ²¡æœ‰æä¾›å®˜æ–¹çš„æ–‡æ¡£æ¥ä»‹ç»å¥æŸ„è¡¨)ï¼Œå‚è€ƒã€ŠWindows æ ¸å¿ƒç¼–ç¨‹ã€‹å¾—çŸ¥å¥æŸ„è¡¨çš„ç»“æ„ï¼Œå¦‚å›¾ï¼š</p>
<table>
<thead>
<tr>
<th>ç´¢å¼•</th>
<th>æŒ‡å‘å†…æ ¸å¯¹è±¡å†…å­˜å—çš„æŒ‡é’ˆ</th>
<th>è®¿é—®æ©ç </th>
<th>æ ‡å¿—</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>0x????????</td>
<td>0x????????</td>
<td>0x????????</td>
</tr>
<tr>
<td>2</td>
<td>0x????????</td>
<td>0x????????</td>
<td>0x????????</td>
</tr>
<tr>
<td>â€¦</td>
<td>â€¦</td>
<td>â€¦</td>
<td>â€¦</td>
</tr>
</tbody></table>
<p>å¦‚æˆ‘ä»¬è°ƒç”¨ç±»ä¼¼<code>CreateEvent</code>çš„å‡½æ•°è¿”å›çš„å¥æŸ„<code>HANDLE</code>å°±æ˜¯å¥æŸ„è¡¨ä¸­çš„<code>ç´¢å¼•</code>ã€‚å› ä¸ºæ˜¯<code>ç´¢å¼•</code>ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚æˆ‘ä»¬å‘ windows API å‡½æ•°ä¼ å…¥è¿™ä¸ª<code>ç´¢å¼•</code>ï¼ŒAPI å†é€šè¿‡<code>ç´¢å¼•</code>æ‰¾åˆ°å¯¹åº”çš„<code>å†…æ ¸å¯¹è±¡æŒ‡é’ˆ</code>ã€‚</p>
<h2 id="å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯"><a href="#å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯" class="headerlink" title="å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯"></a>å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯</h2><h3 id="4-1-å¼•ç”¨è®¡æ•°"><a href="#4-1-å¼•ç”¨è®¡æ•°" class="headerlink" title="4.1 å¼•ç”¨è®¡æ•°"></a>4.1 å¼•ç”¨è®¡æ•°</h3><p><strong>å†…æ ¸å¯¹è±¡çš„æ‰€æœ‰è€…æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œè€Œä¸æ˜¯åˆ›å»ºå®ƒçš„è¿›ç¨‹ã€‚</strong></p>
<p>å¤šä¸ªè¿›ç¨‹å¯ä»¥å¼•ç”¨ï¼ˆä½¿ç”¨ï¼‰åŒä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨äº†è®¡æ•°å™¨çš„æ–¹å¼æ¥ç®¡ç†å†…æ ¸å¯¹è±¡ï¼ˆè¿™ä¸ªå’Œ C++ä¸­çš„<code>std::shared_ptr</code>æ™ºèƒ½æŒ‡é’ˆç±»ä¼¼ï¼‰ï¼Œä¸€ä¸ªå†…æ ¸å¯¹è±¡å…¶å®æœ‰ä¸¤ä¸ªè®¡æ•°å™¨ï¼šä¸€ä¸ªæ˜¯ç»™ç”¨æˆ·æ€(Ring3)ç”¨çš„å¥æŸ„è®¡æ•°ï¼›å¦ä¸€ä¸ªæ˜¯æŒ‡é’ˆè®¡æ•°ï¼Œä¹Ÿå«å¼•ç”¨è®¡æ•°ï¼Œå› ä¸ºæ ¸å¿ƒæ€ç¨‹åº(Ring0)ä¹Ÿç»å¸¸ç”¨åˆ°å†…æ ¸å¯¹è±¡ï¼Œä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œåœ¨æ ¸å¿ƒæ€çš„ä»£ç ç”¨æŒ‡é’ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼Œæ‰€ä»¥å†…æ ¸å¯¹è±¡çš„ç®¡ç†å™¨ä¹Ÿç»´æŠ¤äº†è¿™ä¸ªæŒ‡é’ˆå¼•ç”¨è®¡æ•°ã€‚åªæœ‰åœ¨å†…æ ¸å¯¹è±¡çš„<code>å¥æŸ„è®¡æ•°</code>å’Œ<code>å¼•ç”¨è®¡æ•°</code>éƒ½ä¸º 0 æ—¶ï¼Œè¯¥å†…æ ¸å¯¹è±¡æ‰è¢«é‡Šæ”¾ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒæŒ‡é’ˆå¼•ç”¨è®¡æ•°å€¼æ¯”å¥æŸ„è®¡æ•°å€¼å¤§ã€‚</p>
<h3 id="4-2-æ­£ç¡®çš„é”€æ¯æ–¹å¼"><a href="#4-2-æ­£ç¡®çš„é”€æ¯æ–¹å¼" class="headerlink" title="4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼"></a>4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼</h3><p>å½“ç¨‹åºä¸å†ä½¿ç”¨å†…æ ¸å¯¹è±¡æ—¶ï¼Œéœ€è¦è°ƒç”¨<code>CloseHandle</code>å°†å†…æ ¸å¯¹è±¡çš„è®¡æ•°å‡ 1ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸åœ¨è¯¥å¯¹è±¡è®¡æ•°ä¸º 0 æ—¶ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«ä»»ä½•ä¸œè¥¿å¼•ç”¨æ—¶ï¼‰å°†é”€æ¯è¯¥å¯¹è±¡ã€‚ <strong>å¹¶ä¸”åœ¨è°ƒç”¨<code>CloseHandle</code>ä¹‹åï¼Œç¨‹åºè¿˜åº”è¯¥å°†<code>HANDLE</code>ç½®ä¸º<code>NULL</code>ã€‚</strong></p>
<p>å¦‚æœ<code>CloseHandle</code>ä¹‹åä¸å°†<code>HANDLE</code>ç½®ä¸º<code>NULL</code>ï¼Œåè€Œå†æ¬¡ä½¿ç”¨è¯¥<code>HANDLE</code>ï¼Œå°±ä¼šå‡ºç° 2 ç§æƒ…å†µï¼š</p>
<ol>
<li><p>è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥<code>HANDLE</code>æ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•å·²ç»è¢«æ¸…é™¤ï¼Œä¸”æ²¡æœ‰åˆ«çš„çº¿ç¨‹å†æ¬¡åœ¨è¯¥ç´¢å¼•åˆ›å»ºè®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„<code>HANDLE</code>è°ƒç”¨ Win32 API å‡½æ•°ï¼ŒWindows ä¼šè¿”å›æ— æ•ˆå‚æ•°é”™è¯¯ã€‚è¿™ç§æƒ…å†µè¿˜æ¯”è¾ƒå¥½è°ƒè¯•ã€‚</p>
</li>
<li><p>è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥<code>HANDLE</code>æ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•åŒæ ·ä¹Ÿå·²ç»è¢«æ¸…é™¤ï¼Œä½†å·²ç»æœ‰åˆ«çš„çº¿ç¨‹ï¼ˆè¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹ï¼‰åœ¨è¯¥<code>ç´¢å¼•</code>ä½ç½®åˆ›å»ºäº†è®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„<code>HANDLE</code>è°ƒç”¨ Win32 API å‡½æ•°ï¼Œè¯¥<code>HANDLE</code>å°±ä¼šå¼•ç”¨åˆ°å…¶ä»–çº¿ç¨‹æ–°å»ºçš„é‚£ä¸ªå†…æ ¸å¯¹è±¡ï¼Œä»è€Œå‡ºç°ä¸€äº›éš¾ä»¥é¢„æ–™çš„é”™è¯¯ã€‚è¿™ç§é”™è¯¯å¾ˆéš¾è°ƒè¯•ã€‚</p>
</li>
</ol>
<h3 id="4-3-è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°"><a href="#4-3-è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°" class="headerlink" title="4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°"></a>4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</h3><p>è™½ç„¶ windows æ²¡æœ‰æä¾› API è®©ç”¨æˆ·åœ¨ç”¨æˆ·æ€ï¼ˆRing3ï¼‰æŸ¥è¯¢ä¸€ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„è®¡æ•°å’Œå¼•ç”¨è®¡æ•°ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»<code>Ntdll.dll</code>å¯¼å‡º<code>NtQueryObject</code>å‡½æ•°æ¥å®ç°æŸ¥è¯¢å†…æ ¸å¯¹è±¡çš„å½“å‰çŠ¶æ€(è¯¥å‡½æ•°æ²¡æœ‰è¢«æ–‡æ¡£åŒ–)ã€‚</p>
<p><code>NtQueryObject</code>å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›å€¼ï¼šå¦‚æœæˆåŠŸåˆ™è¿”å›0</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">NtQueryObject</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">HANDLE   handle,       <span class="comment">// å¾…æŸ¥è¯¢çš„å¥æŸ„</span></span></span></span><br><span class="line"><span class="params"><span class="function">DWORD   nQueryIndex,   <span class="comment">// 0ä¸ºæŸ¥è¯¢å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¥æŸ„è®¡æ•°ï¼Œå¼•ç”¨è®¡æ•°ç­‰ç­‰ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">VOID*   pOutBuffer,    <span class="comment">// å­˜æ”¾æŸ¥è¯¢ç»“æœ</span></span></span></span><br><span class="line"><span class="params"><span class="function">DWORD   cbInBufferSize,   <span class="comment">// pOutBufferçš„å¤§å°ï¼Œå¦‚æœnQueryIndexä¸º0ï¼Œè¿™é‡Œä¸ºsizeof(SYSTEM_HANDLE_STATE)</span></span></span></span><br><span class="line"><span class="params"><span class="function">VOID*   cbOutBufferSize   <span class="comment">// å®é™…å¤§å°</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></tbody></table></figure>

<p>å°†<code>NtQueryObject</code>å‡½æ•°è°ƒç”¨çš„ç»†èŠ‚å°è£…åˆ°<code>GetKernelObjectRefCount</code>å‡½æ•°ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GetKernelObjectRefCount</span><span class="params">(HANDLE handle, DWORD &amp;handle_count, DWORD &amp;point_count)</span> </span>{</span><br><span class="line">  <span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_SYSTEM_HANDLE_STATE</span> {</span><br><span class="line">    DWORD   r1;</span><br><span class="line">    DWORD   GrantedAccess;</span><br><span class="line">    DWORD   HandleCount;      <span class="comment">// å‡1ä¸ºå¥æŸ„è®¡æ•°</span></span><br><span class="line">    DWORD   ReferenceCount;   <span class="comment">// å‡1ä¸ºæŒ‡é’ˆå¼•ç”¨è®¡æ•°</span></span><br><span class="line">    DWORD   r5;</span><br><span class="line">    DWORD   r6;</span><br><span class="line">    DWORD   r7;</span><br><span class="line">    DWORD   r8;</span><br><span class="line">    DWORD   r9;</span><br><span class="line">    DWORD   r10;</span><br><span class="line">    DWORD   r11;</span><br><span class="line">    DWORD   r12;</span><br><span class="line">    DWORD   r13;</span><br><span class="line">    DWORD   r14;</span><br><span class="line">  }SYSTEM_HANDLE_STATE, *PSYSTEM_HANDLE_STATE;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">typedef</span> <span class="title">DWORD</span><span class="params">(WINAPI *PFN_NtQueryObject)</span><span class="params">(HANDLE handle,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD nQueryIndex,</span></span></span><br><span class="line"><span class="params"><span class="function">    VOID* pOutBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    DWORD cbInBufferSize,</span></span></span><br><span class="line"><span class="params"><span class="function">    VOID* cbOutBufferSize)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">static</span> PFN_NtQueryObject pfnNtQueryObject = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="type">bool</span> ret = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">do</span> {</span><br><span class="line">    <span class="keyword">if</span> (pfnNtQueryObject == <span class="literal">NULL</span>) {</span><br><span class="line">      HMODULE ntdll = <span class="built_in">GetModuleHandle</span>(<span class="built_in">TEXT</span>(<span class="string">"Ntdll.dll"</span>));</span><br><span class="line">      <span class="keyword">if</span> (ntdll == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      pfnNtQueryObject = (PFN_NtQueryObject)<span class="built_in">GetProcAddress</span>(ntdll, <span class="string">"NtQueryObject"</span>);</span><br><span class="line">      <span class="keyword">if</span> (pfnNtQueryObject == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    SYSTEM_HANDLE_STATE sys_handle_state;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;sys_handle_state, <span class="number">0</span>, <span class="built_in">sizeof</span>(SYSTEM_HANDLE_STATE));</span><br><span class="line"></span><br><span class="line">    DWORD out_buf_size = <span class="number">0</span>;</span><br><span class="line">    ret = (<span class="built_in">pfnNtQueryObject</span>(handle, <span class="number">0</span>, &amp;sys_handle_state, <span class="built_in">sizeof</span>(SYSTEM_HANDLE_STATE), &amp;out_buf_size) == <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret) {</span><br><span class="line">      handle_count = sys_handle_state.HandleCount - <span class="number">1</span>;</span><br><span class="line">      point_count = sys_handle_state.ReferenceCount - <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">while</span> (<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®"><a href="#äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®" class="headerlink" title="äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®"></a>äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®</h2><p>è™½ç„¶å†…æ ¸å¯¹è±¡ä½äºç‹¬ç«‹äºè¿›ç¨‹ä¹‹å¤–çš„å†…æ ¸åŒºåŸŸï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­å´åªèƒ½é€šè¿‡è°ƒç”¨ Win32 API ä¼ å…¥ HANDLE å‚æ•°æ¥æ“ä½œå†…æ ¸å¯¹è±¡ï¼ˆå¦‚<code>SetEvent</code>ç­‰ï¼‰ã€‚ç„¶è€Œ<code>HANDLEå¥æŸ„</code>åªå¯¹å½“å‰è¿›ç¨‹æœ‰æ•ˆï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¯¥å¥æŸ„å°±æ— æ•ˆäº†ã€‚æ‰€ä»¥è¯´ï¼Œè·¨è¿›ç¨‹è®¿é—®å†…æ ¸å¯¹è±¡çš„å…³é”®åœ¨äºæˆ‘ä»¬æ€ä¹ˆè·¨è¿›ç¨‹è®¿é—®<code>å¥æŸ„HANDLE</code>ï¼Ÿ</p>
<p>ä¸‹é¢ä»‹ç»å‡ ç§æ–¹æ³•æ¥å®ç°è·¨è¿›ç¨‹å…±äº«å†…æ ¸å¯¹è±¡ã€‚</p>
<h3 id="5-1-ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼"><a href="#5-1-ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼" class="headerlink" title="5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼"></a>5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼</h3><p>åªæœ‰è¿›ç¨‹ä¹‹é—´æœ‰çˆ¶å­å…³ç³»æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶å…è®¸å­è¿›ç¨‹è®¿é—®çˆ¶è¿›ç¨‹çš„å†…æ ¸å¯¹è±¡ã€‚ä¸ºäº†ä½¿è¿™ç§ç»§æ‰¿ç”Ÿæ•ˆï¼Œçˆ¶è¿›ç¨‹å¿…é¡»æ‰§è¡Œå‡ ä¸ªæ­¥éª¤ï¼š<br>ï¼ˆ1ï¼‰. çˆ¶è¿›ç¨‹åœ¨åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡æ—¶ï¼Œçˆ¶è¿›ç¨‹å¿…é¡»å‘ç³»ç»ŸæŒ‡å®šå®ƒå¸Œæœ›è¿™ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å†…æ ¸å¯¹è±¡ï¼Œå¿…é¡»åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ª<code>SECURITY_ATTRIBUTES</code>ç»“æ„ï¼Œå¦‚ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SECURITY_ATTRIBUTES sa;</span><br><span class="line">sa.nLength = <span class="built_in">sizeof</span>(SECURITY_ATTRIBUTES);</span><br><span class="line">sa.bInheritHandle = TRUE;  <span class="comment">// å¯ç»§æ‰¿çš„</span></span><br><span class="line">sa.lpSecurityDescriptor = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(&amp;sa, TRUE, FALSE, <span class="literal">NULL</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>ï¼ˆ2ï¼‰. çˆ¶è¿›ç¨‹é€šè¿‡ CreateProcess ç”Ÿæˆå­è¿›ç¨‹ï¼Œä¸”æŒ‡å®š<code>bInheritHandles</code>ä¸º TRUEï¼Œä»è€Œå…è®¸å­è¿›ç¨‹æ¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„é‚£äº›â€œå¯ç»§æ‰¿çš„å¥æŸ„â€ã€‚</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨å­è¿›ç¨‹TestB.exeï¼Œå°†å¥æŸ„hä½œä¸ºå¯åŠ¨å‚æ•°ä¼ ç»™è¿›ç¨‹TestB</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">TCHAR cmd_buf[MAX_PATH];</span><br><span class="line"><span class="built_in">StringCchPrintf</span>(cmd_buf, MAX_PATH, <span class="built_in">TEXT</span>(<span class="string">"TestB.exe %ld"</span>), (<span class="type">long</span>)h);</span><br><span class="line"></span><br><span class="line">STARTUPINFO si = { <span class="built_in">sizeof</span>(si) };</span><br><span class="line">PROCESS_INFORMATION pi;</span><br><span class="line">BOOL ret = <span class="built_in">CreateProcess</span>(</span><br><span class="line">  <span class="literal">NULL</span>,</span><br><span class="line">  cmd_buf,</span><br><span class="line">  <span class="literal">NULL</span>,</span><br><span class="line">  <span class="literal">NULL</span>,</span><br><span class="line">  TRUE,  <span class="comment">// æŒ‡å®šå­è¿›ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„â€œå¯ç»§æ‰¿å¥æŸ„â€</span></span><br><span class="line">  <span class="number">0</span>,</span><br><span class="line">  <span class="literal">NULL</span>,</span><br><span class="line">  <span class="literal">NULL</span>,</span><br><span class="line">  &amp;si,</span><br><span class="line">  &amp;pi</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">CloseHandle</span>(pi.hProcess);</span><br><span class="line"><span class="built_in">CloseHandle</span>(pi.hThread);</span><br></pre></td></tr></tbody></table></figure>

<p>ç”±äºæˆ‘ä»¬ä¼ ç»™<code>bInheritHandles</code>å‚æ•°çš„å€¼æ˜¯<code>TRUE</code>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼šå¤šåšä¸€ä»¶äº‹æƒ…ï¼šå®ƒä¼šéå†çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨ï¼Œå¯¹å®ƒçš„æ¯ä¸€é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œå‡¡æ˜¯åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„â€œå¯ç»§æ‰¿çš„å¥æŸ„â€çš„é¡¹ï¼Œéƒ½ä¼šå°†è¯¥é¡¹å®Œæ•´çš„å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚åœ¨å­è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­ï¼Œå¤åˆ¶é¡¹çš„ä½ç½®ä¸å®ƒåœ¨çˆ¶è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ä½ç½®å®Œå…¨ä¸€æ ·ï¼ˆåŒ…å«ç´¢å¼•ï¼‰ï¼Œè¿™ä¸ªå°±æ„å‘³ç€ï¼šåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­ï¼Œå¯¹ä¸€ä¸ªå†…æ ¸å¯¹è±¡è¿›è¡Œæ ‡è¯†çš„å¥æŸ„å€¼ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é€šè¿‡æŸç§æ–¹å¼ï¼ˆå¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„å¯åŠ¨å‚æ•°çš„æ–¹å¼ï¼Œæˆ–è€…ç¯å¢ƒå˜é‡çš„æ–¹å¼ç­‰ä»»ä½•è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼ï¼‰å°†è¿™ä¸ªå€¼å‘Šè¯‰å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°±å¯ä»¥å°†è¯¥å€¼è½¬æˆ<code>HANDLE</code>ï¼Œç„¶åä½¿ç”¨è¿™ä¸ª<code>HANDLE</code>æ¥è°ƒç”¨ç³»ç»Ÿ APIã€‚</p>
<h3 id="5-2-ä½¿ç”¨-DuplicateHandle-æ–¹å¼"><a href="#5-2-ä½¿ç”¨-DuplicateHandle-æ–¹å¼" class="headerlink" title="5.2 ä½¿ç”¨ DuplicateHandle æ–¹å¼"></a>5.2 ä½¿ç”¨ DuplicateHandle æ–¹å¼</h3><p>DuplicateHandle å‡½æ•°å¯ä»¥å°†æŒ‡å®šâ€œæºè¿›ç¨‹çš„å¥æŸ„è¡¨â€ä¸­çš„æŸä¸€é¡¹<strong>å¤åˆ¶</strong>åˆ°â€œç›®çš„è¿›ç¨‹å¥æŸ„è¡¨â€ä¸­ï¼ˆé™¤äº†ç´¢å¼•ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥é¡¹åœ¨ç›®çš„è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ç´¢å¼•ï¼ˆå³ HADNLEï¼‰ã€‚<br>å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨ DuplicateHandle å‡½æ•°ï¼ŒDuplicateHandle å¯¹æºå¥æŸ„æ˜¯å¦æ˜¯å¯ç»§æ‰¿çš„æ²¡æœ‰è¦æ±‚ã€‚</p>
<p>å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">DuplicateHandle</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hSourceProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hSourceHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  HANDLE hTargetProcessHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPHANDLE lpTargetHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD dwDesiredAccess,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bInheritHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD dwOptions</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>DuplicateHandle è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ MSDNï¼š<a class="link" target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<p>DuplicateHandle å‡½æ•°ä¸èƒ½å¤åˆ¶æ‰€æœ‰ç±»å‹çš„å¥æŸ„ï¼Œåªèƒ½å¤åˆ¶å¦‚ä¸‹ç±»å‹çš„å¥æŸ„ï¼ˆä» MSDN å¤åˆ¶è€Œæ¥ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>Object</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Access token</td>
<td>The handle is returned by the CreateRestrictedToken, DuplicateToken, DuplicateTokenEx, OpenProcessToken, or OpenThreadToken function.</td>
</tr>
<tr>
<td>Change notification</td>
<td>The handle is returned by the FindFirstChangeNotification function.</td>
</tr>
<tr>
<td>Communications device</td>
<td>The handle is returned by the CreateFile function.</td>
</tr>
<tr>
<td>Console input</td>
<td>The handle is returned by the CreateFile function when CONIN$ is specified, or by the GetStdHandle function when STD_INPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process.</td>
</tr>
<tr>
<td>Console screen buffer</td>
<td>The handle is returned by the CreateFile function when CONOUT$ is specified, or by the GetStdHandle function when STD_OUTPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process.</td>
</tr>
<tr>
<td>Desktop</td>
<td>The handle is returned by the GetThreadDesktop function.</td>
</tr>
<tr>
<td>Event</td>
<td>The handle is returned by the CreateEvent or OpenEvent function.</td>
</tr>
<tr>
<td>File</td>
<td>The handle is returned by the CreateFile function.</td>
</tr>
<tr>
<td>File mapping</td>
<td>The handle is returned by the CreateFileMapping function.</td>
</tr>
<tr>
<td>Job</td>
<td>The handle is returned by the CreateJobObject function.</td>
</tr>
<tr>
<td>Mailslot</td>
<td>The handle is returned by the CreateMailslot function.</td>
</tr>
<tr>
<td>Mutex</td>
<td>The handle is returned by the CreateMutex or OpenMutex function.</td>
</tr>
<tr>
<td>Pipe</td>
<td>A named pipe handle is returned by the CreateNamedPipe or CreateFile function. An anonymous pipe handle is returned by the CreatePipe function.</td>
</tr>
<tr>
<td>Process</td>
<td>The handle is returned by the CreateProcess, GetCurrentProcess, or OpenProcess function.</td>
</tr>
<tr>
<td>Registry key</td>
<td>The handle is returned by the RegCreateKey, RegCreateKeyEx, RegOpenKey, or RegOpenKeyEx function. Note that registry key handles returned by the RegConnectRegistry function cannot be used in a call to DuplicateHandle.</td>
</tr>
<tr>
<td>Semaphore</td>
<td>The handle is returned by the CreateSemaphore or OpenSemaphore function.</td>
</tr>
<tr>
<td>Thread</td>
<td>The handle is returned by the CreateProcess, CreateThread, CreateRemoteThread, or GetCurrentThread function</td>
</tr>
<tr>
<td>Timer</td>
<td>The handle is returned by the CreateWaitableTimer or OpenWaitableTimer function.</td>
</tr>
<tr>
<td>Transaction</td>
<td>The handle is returned by the CreateTransaction function.</td>
</tr>
<tr>
<td>Window station</td>
<td>The handle is returned by the GetProcessWindowStation function.</td>
</tr>
</tbody></table>
<p>ä¸åŒçš„äº‹ä»¶ç±»å‹å¯¹åº”çš„<code>dwDesiredAccess</code>å‚æ•°ä¸åŒï¼Œå…·ä½“å‚è€ƒ<a class="link" target="_blank" rel="noopener" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx">MSDN<i class="fas fa-external-link-alt"></i></a>ã€‚</p>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p><strong>è¿›ç¨‹ TestA æºç </strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>{</span><br><span class="line">  HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯åŠ¨å­è¿›ç¨‹TestB.exe</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  TCHAR cmd_buf[MAX_PATH];</span><br><span class="line">  <span class="built_in">StringCchPrintf</span>(cmd_buf, MAX_PATH, <span class="built_in">TEXT</span>(<span class="string">"D:\\TestB.exe"</span>), (<span class="type">long</span>)h);</span><br><span class="line"></span><br><span class="line">  STARTUPINFO si = { <span class="built_in">sizeof</span>(si) };</span><br><span class="line">  PROCESS_INFORMATION pi;</span><br><span class="line">  BOOL ret = <span class="built_in">CreateProcess</span>(<span class="literal">NULL</span>, cmd_buf, <span class="literal">NULL</span>, <span class="literal">NULL</span>, TRUE, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line">  <span class="built_in">assert</span>(ret);</span><br><span class="line">  <span class="built_in">assert</span>(pi.hProcess);</span><br><span class="line"></span><br><span class="line">  HANDLE duplicated_h = <span class="literal">NULL</span>;</span><br><span class="line">  ret = <span class="built_in">DuplicateHandle</span>(<span class="built_in">GetCurrentProcess</span>(), h, pi.hProcess, &amp;duplicated_h, <span class="number">0</span>, FALSE, DUPLICATE_SAME_ACCESS);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">WaitForSingleObject</span>(pi.hProcess, INFINITE);</span><br><span class="line">  <span class="built_in">CloseHandle</span>(pi.hProcess);</span><br><span class="line">  <span class="built_in">CloseHandle</span>(pi.hThread);</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> has_signal = <span class="built_in">WaitForSingleObject</span>(h, <span class="number">0</span>) == WAIT_OBJECT_0;</span><br><span class="line">  <span class="built_in">assert</span>(has_signal == <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å­è¿›ç¨‹ TestB æºç </strong></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="type">long</span> l = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Input Handle:"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%ld"</span>, &amp;l);</span><br><span class="line"></span><br><span class="line">  HANDLE h = (HANDLE)l;</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> has_signal = <span class="built_in">WaitForSingleObject</span>(h, <span class="number">0</span>) == WAIT_OBJECT_0;</span><br><span class="line">  <span class="built_in">assert</span>(has_signal == <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">SetEvent</span>(h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨çˆ¶è¿›ç¨‹ TestA ä¸­åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„äº‹ä»¶ -&gt; ç„¶åå¯åŠ¨å­è¿›ç¨‹ TestB -&gt; è°ƒç”¨ DuplicateHandle å¤åˆ¶å¥æŸ„é¡¹åˆ° TestB è¿›ç¨‹å¥æŸ„è¡¨ -&gt; å¹¶å‘ TestB è¾“å…¥å¥æŸ„å€¼ -&gt; TestB è®¿é—®è¯¥äº‹ä»¶å¥æŸ„ï¼Œå°†äº‹ä»¶ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ã€‚</p>
<h3 id="5-3-ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼"><a href="#5-3-ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼" class="headerlink" title="5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼"></a>5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼</h3><h4 id="5-3-1-å®ç°åŸç†"><a href="#5-3-1-å®ç°åŸç†" class="headerlink" title="5.3.1 å®ç°åŸç†"></a>5.3.1 å®ç°åŸç†</h4><p>è¿™ç§æ–¹å¼ä¸¥æ ¼çš„è¯´å·²ç»ä¸æ˜¯æ–‡ç« å¼€å¤´è¯´åˆ°çš„è·¨è¿›ç¨‹è®¿é—®å¥æŸ„äº†ï¼Œæœ‰ç‚¹ç±»ä¼¼è·¨è¿›ç¨‹ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡äº†ã€‚<br>è¯¥æ–¹å¼å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨è°ƒç”¨åˆ›å»ºå†…æ ¸å¯¹è±¡çš„<code>Create***</code>å‡½æ•°æ—¶ï¼Œé€šè¿‡<code>pszName</code>å‚æ•°ä¸ºå†…æ ¸å¯¹è±¡å–ä¸€ä¸ªåå­—ã€‚<br>å¦‚åˆ›å»ºäº‹ä»¶ Event çš„å‡½æ•°<code>CreateEvent</code>ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HANDLE WINAPI <span class="title">CreateEvent</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  LPSECURITY_ATTRIBUTES lpEventAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bManualReset,</span></span></span><br><span class="line"><span class="params"><span class="function">  BOOL bInitialState,</span></span></span><br><span class="line"><span class="params"><span class="function">  LPCTSTR lpName  <span class="comment">// æŒ‡å®šåç§°</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="built_in">TEXT</span>(<span class="string">"TestA_Obj"</span>));</span><br></pre></td></tr></tbody></table></figure>

<p>è‹¥åœ¨å…¶ä»–è¿›ç¨‹ä¸­è¦è®¿é—®è¿™ä¸ªå†…æ ¸å¯¹è±¡ï¼Œåªéœ€è¦ä½¿ç”¨æ‰“å¼€å‡½æ•°<code>Open***</code>æ‰“å¼€è¯¥å†…æ ¸å¯¹è±¡ï¼Œ<strong>ç³»ç»Ÿå°±ä¼šåœ¨è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶è¿”å›è¿™æ¡è®°å½•çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯å¥æŸ„</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰“å¼€å†…æ ¸å¯¹è±¡æ—¶éœ€è¦ç•™æ„<code>è¿”å›å€¼</code>å’Œ<code>GetLastError</code>å‡½æ•°çš„è¿”å›å€¼ã€‚ç”±äºå†…æ ¸å¯¹è±¡æ˜¯æœ‰è®¿é—®æƒé™çš„ï¼Œæœ‰æ—¶å€™è™½ç„¶è¿™ä¸ªåå­—çš„å†…æ ¸å¯¹è±¡å­˜åœ¨ï¼Œä½†è¯¥è¿›ç¨‹å´ä¸è§å¾—æœ‰æƒé™å¯ä»¥æ‰“å¼€å®ƒï¼Œè¿™ä¸ªæ—¶å€™<code>GetLastError</code>å‡½æ•°ä¼šè¿”å›å¤±è´¥çš„åŸå› ã€‚</p>
<p>ä»¥æ‰“å¼€äº‹ä»¶çš„å‡½æ•°<code>OpenEvent</code>ä¸ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">OpenEvent</span>(READ_CONTROL, FALSE, <span class="built_in">TEXT</span>(<span class="string">"TestA_Obj"</span>));</span><br><span class="line"><span class="keyword">if</span> (h == <span class="literal">NULL</span>) {</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">GetLastError</span>() == ERROR_ACCESS_DENIED) { <span class="comment">// æ²¡æœ‰READ_CONTROLæƒé™</span></span><br><span class="line"></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="5-3-2-å…¨å±€å‘½ä»¤ç©ºé—´"><a href="#5-3-2-å…¨å±€å‘½ä»¤ç©ºé—´" class="headerlink" title="5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´"></a>5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´</h4><p>ä¸åŒçš„ä¼šè¯ï¼ˆSessionï¼‰æœ‰ä¸åŒçš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼ˆå¦‚ windows æœåŠ¡ç¨‹åºä½äº<code>Session 0</code>ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ä½äº<code>Session 1</code>ï¼‰ï¼Œè¦é€šè¿‡åç§°è®¿é—®å…¶ä»–ä¼šè¯ä¸­çš„å†…æ ¸å¯¹è±¡ï¼Œéœ€è¦åœ¨åç§°å‰é¢åŠ ä¸Š<code>Session\&lt;å½“å‰ä¼šè¯ID&gt;</code>ã€‚Windows æä¾›äº†ä¸€ä¸ªå…¨å±€çš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼Œå¤„äºä»»ä½•ä¼šè¯ä¸­çš„è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®è¯¥å‘½åç©ºé—´ï¼Œå°†å†…æ ¸å¯¹è±¡æ”¾å…¥å…¨å±€å‘½ä»¤ç©ºé—´çš„æ–¹å¼å¾ˆç®€å•ï¼šåªéœ€è¦åœ¨å†…æ ¸å¯¹è±¡åç§°å‰åŠ å…¥<code>Global\</code>å³å¯ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HANDLE h = <span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, TRUE, FALSE, <span class="built_in">TEXT</span>(<span class="string">"Global\\TestA_Obj"</span>));</span><br></pre></td></tr></tbody></table></figure>

                </div>
                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                Windowså†…æ ¸å¯¹è±¡
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                post/14744864.html
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    ä½œè€…
                </div>
                <div class="content">æ±Ÿé›ªæ¡¥</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    å‘å¸ƒäº
                </div>
                <div class="content">2021-07-03 20:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    è®¸å¯
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ° QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="åˆ†äº«åˆ°å¾®ä¿¡"
            data-tooltip-img-tip="å¾®ä¿¡æ‰«ä¸€æ‰«"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ°å¾®åš"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/post/128186902.html"
                                   title="C++çš„APIè®¾è®¡è§„èŒƒ"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">C++çš„APIè®¾è®¡è§„èŒƒ</span>
                                        <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/post/4155207961.html"
                                   title="C++å®ç°ç¼–è¯‘æ—¶æ–­è¨€"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">C++å®ç°ç¼–è¯‘æ—¶æ–­è¨€</span>
                                        <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1"><span class="nav-text">ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="nav-text">ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%80%E6%AF%81"><span class="nav-text">å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="nav-text">4.1 å¼•ç”¨è®¡æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%AD%A3%E7%A1%AE%E7%9A%84%E9%94%80%E6%AF%81%E6%96%B9%E5%BC%8F"><span class="nav-text">4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E8%8E%B7%E5%8F%96%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="nav-text">4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E8%B7%A8%E8%BF%9B%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="nav-text">äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%BD%BF%E7%94%A8%E5%8F%A5%E6%9F%84%E7%BB%A7%E6%89%BF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E4%BD%BF%E7%94%A8-DuplicateHandle-%E6%96%B9%E5%BC%8F"><span class="nav-text">5.2 ä½¿ç”¨ DuplicateHandle æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-text">ç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E4%BD%BF%E7%94%A8%E5%91%BD%E5%90%8D%E7%9A%84%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">5.3.1 å®ç°åŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4%E7%A9%BA%E9%97%B4"><span class="nav-text">5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2017</span>&nbsp;-&nbsp;2024
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">æ±Ÿé›ªæ¡¥</a>
                
            </div>

            <div class="copyright-info info-item default">
                æœ¬ç«™æ–‡ç« å‡ä¸ºåŸåˆ›ï¼ˆå°‘æ•°æ³¨æ˜è½¬è½½çš„é™¤å¤–ï¼‰ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
            </div>

            <div class="copyright-info info-item default">
                <a target="_blank" rel="noopener" href="https://blog.csdn.net/china_jeffery">My CSDN</a>
                &nbsp;&nbsp;
                <a target="_blank" rel="noopener" href="https://github.com/winsoft666/">My Github</a>
                &nbsp;&nbsp;
                <a href="/post/3416050985.html">åŒ å¿ƒä¹‹ä½œ</a>
            </div>

            
                <div class="icp-info info-item default">
                    <a class=""
                       target="_blank"
                       href="https://beian.miit.gov.cn"
                    >
                        é„‚ICPå¤‡2020015399å·-6
                    </a>
                </div>
            

            
        

        <div class="count-item info-item default">
            

            

            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1"><span class="nav-text">ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="nav-text">ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%80%E6%AF%81"><span class="nav-text">å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="nav-text">4.1 å¼•ç”¨è®¡æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E6%AD%A3%E7%A1%AE%E7%9A%84%E9%94%80%E6%AF%81%E6%96%B9%E5%BC%8F"><span class="nav-text">4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E8%8E%B7%E5%8F%96%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0"><span class="nav-text">4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E8%B7%A8%E8%BF%9B%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="nav-text">äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E4%BD%BF%E7%94%A8%E5%8F%A5%E6%9F%84%E7%BB%A7%E6%89%BF%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E4%BD%BF%E7%94%A8-DuplicateHandle-%E6%96%B9%E5%BC%8F"><span class="nav-text">5.2 ä½¿ç”¨ DuplicateHandle æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-text">ç¤ºä¾‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E4%BD%BF%E7%94%A8%E5%91%BD%E5%90%8D%E7%9A%84%E5%86%85%E6%A0%B8%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">5.3.1 å®ç°åŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2-%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4%E7%A9%BA%E9%97%B4"><span class="nav-text">5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->

    
<script src="/js/lazyload.js"></script>



<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        
            
<script src="/js/post/copyright-info.js"></script>

        

        <!-- share -->
        
            
<script src="/js/post/share.js"></script>

        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



    
        
    

</body>
</html>
