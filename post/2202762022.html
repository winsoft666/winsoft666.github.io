<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#177cb0"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.png" color="#177cb0">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-corner-indicator.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiangxueqiao.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"vs2015"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":true,"height":300},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":true,"duration":200,"transition":{"menu_item":null,"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":null}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="移除Qt控件虚线框方式一：使用 StyleSheet123QWidget:focus &#123;  outline: none; &#x2F;* 去掉得到焦点时的虚线框 *&#x2F;&#125;  方式二：继承 QProxyStyle继承 QProxyStyle，PrimitiveElement 为 QStyle::PE_FrameFocusRect 时不绘制虚线框，然后在 main() 函数里调用 QAppli">
<meta property="og:type" content="article">
<meta property="og:title" content="Qt开发路上的“绊脚石”与“垫脚石”">
<meta property="og:url" content="https://jiangxueqiao.com/post/2202762022.html">
<meta property="og:site_name" content="JiangXueqiao&#39;s blog">
<meta property="og:description" content="移除Qt控件虚线框方式一：使用 StyleSheet123QWidget:focus &#123;  outline: none; &#x2F;* 去掉得到焦点时的虚线框 *&#x2F;&#125;  方式二：继承 QProxyStyle继承 QProxyStyle，PrimitiveElement 为 QStyle::PE_FrameFocusRect 时不绘制虚线框，然后在 main() 函数里调用 QAppli">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/default-menu-style.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/after-qss-menu-style.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/music-menu-sample.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/qwidgetaction-menu-sample.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/qpixmap-syyd-2.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/qpixmap-syyd-1.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/5OlnDS5QGd-TinyTu.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/jiugongge.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/NinePatchTest.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/feiyuqitupiansuofang-1.png">
<meta property="article:published_time" content="2022-09-25T12:55:02.000Z">
<meta property="article:modified_time" content="2025-11-17T07:58:28.716Z">
<meta property="article:author" content="jiangxueqiao.com">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jiangxueqiao.com/images/blog/default-menu-style.png">


<link rel="canonical" href="https://jiangxueqiao.com/post/2202762022.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jiangxueqiao.com/post/2202762022.html","path":"post/2202762022.html","title":"Qt开发路上的“绊脚石”与“垫脚石”"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Qt开发路上的“绊脚石”与“垫脚石” | JiangXueqiao's blog</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?fbb46283a7b4d42d425356f8779708d5"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>

  <script src="/js/third-party/pace.js" defer></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">JiangXueqiao's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">17</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">12</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">158</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4Qt%E6%8E%A7%E4%BB%B6%E8%99%9A%E7%BA%BF%E6%A1%86"><span class="nav-number">1.</span> <span class="nav-text">移除Qt控件虚线框</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8-StyleSheet"><span class="nav-number">1.1.</span> <span class="nav-text">方式一：使用 StyleSheet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E7%BB%A7%E6%89%BF-QProxyStyle"><span class="nav-number">1.2.</span> <span class="nav-text">方式二：继承 QProxyStyle</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%A0%E6%B3%95%E6%8B%96%E5%85%A5%E6%96%87%E4%BB%B6%E5%88%B0QListWidget"><span class="nav-number">2.</span> <span class="nav-text">无法拖入文件到QListWidget</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BFQListWidgetItem%E8%87%AA%E9%80%82%E5%BA%94%E5%B0%BA%E5%AF%B8"><span class="nav-number">3.</span> <span class="nav-text">使QListWidgetItem自适应尺寸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%B8%AD%E6%9B%B4%E6%96%B0UI"><span class="nav-number">4.</span> <span class="nav-text">子线程中更新UI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%951-%E4%BD%BF%E7%94%A8%E4%BF%A1%E5%8F%B7%E6%A7%BD"><span class="nav-number">4.1.</span> <span class="nav-text">方法1: 使用信号槽</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%952-%E4%BD%BF%E7%94%A8invokeMethod"><span class="nav-number">4.2.</span> <span class="nav-text">方法2: 使用invokeMethod</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">加载字体文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QWidget%E5%AD%90%E7%B1%BB%E6%97%A0%E6%B3%95%E5%BA%94%E7%94%A8QSS"><span class="nav-number">6.</span> <span class="nav-text">QWidget子类无法应用QSS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QSS-%E8%AE%BE%E7%BD%AE%E6%BB%9A%E5%8A%A8%E6%9D%A1%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="nav-number">7.</span> <span class="nav-text">QSS 设置滚动条的样式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%92%8C%E7%BE%8E%E5%8C%96%E8%8F%9C%E5%8D%95"><span class="nav-number">8.</span> <span class="nav-text">自定义和美化菜单</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8F%9C%E5%8D%95%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">8.1.</span> <span class="nav-text">菜单基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8QSS%E7%BE%8E%E5%8C%96%E8%8F%9C%E5%8D%95"><span class="nav-number">8.2.</span> <span class="nav-text">使用QSS美化菜单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#QSS%E7%BE%8E%E5%8C%96QMenu"><span class="nav-number">8.2.1.</span> <span class="nav-text">QSS美化QMenu</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%8F%9C%E5%8D%95%E9%A1%B9"><span class="nav-number">8.3.</span> <span class="nav-text">自定义菜单项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%B9%E7%AA%97%E5%A4%96%E9%83%A8%E7%82%B9%E5%87%BB%E6%97%B6%E8%87%AA%E5%8A%A8%E5%85%B3%E9%97%AD"><span class="nav-number">9.</span> <span class="nav-text">弹窗外部点击时自动关闭</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ActivationChange-%E4%BA%8B%E4%BB%B6"><span class="nav-number">9.1.</span> <span class="nav-text">ActivationChange 事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt-WA-NoMouseReplay-%E4%BB%8B%E7%BB%8D"><span class="nav-number">9.2.</span> <span class="nav-text">Qt::WA_NoMouseReplay 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-closed-%E4%BF%A1%E5%8F%B7"><span class="nav-number">9.3.</span> <span class="nav-text">自定义 closed 信号</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#QPixmap%E4%BD%BF%E7%94%A8%E8%A6%81%E7%82%B9"><span class="nav-number">10.</span> <span class="nav-text">QPixmap使用要点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E7%A8%8B%E5%BA%8F-DPI-%E7%BC%A9%E6%94%BE"><span class="nav-number">10.1.</span> <span class="nav-text">开启程序 DPI 缩放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QPixmap-devicePixelRatio"><span class="nav-number">10.2.</span> <span class="nav-text">QPixmap::devicePixelRatio</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E7%9A%84%E5%B8%83%E5%B1%80%E6%8A%80%E5%B7%A7"><span class="nav-number">11.</span> <span class="nav-text">Qt的布局技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E6%8B%96%E6%94%BE"><span class="nav-number">11.1.</span> <span class="nav-text">手动拖放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%B8%83%E5%B1%80"><span class="nav-number">11.2.</span> <span class="nav-text">代码布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B1%80%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80"><span class="nav-number">11.3.</span> <span class="nav-text">布局描述语言</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E6%8C%89%E4%B9%9D%E5%AE%AB%E6%A0%BC%E6%A8%A1%E5%BC%8F%E7%BC%A9%E6%94%BE"><span class="nav-number">12.</span> <span class="nav-text">图片按九宫格模式缩放</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8QSS%E5%AE%9E%E7%8E%B0"><span class="nav-number">12.1.</span> <span class="nav-text">使用QSS实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E4%B9%9D%E5%AE%AB%E6%A0%BC%E7%BC%A9%E6%94%BE"><span class="nav-number">12.2.</span> <span class="nav-text">使用代码实现九宫格缩放</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jiangxueqiao.com"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">jiangxueqiao.com</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/winsoft666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;winsoft666" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:smart7178@163.com" title="E-Mail → mailto:smart7178@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://jiangxueqiao.com/online-tools" title="https:&#x2F;&#x2F;jiangxueqiao.com&#x2F;online-tools">在线工具</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiangxueqiao.com/post/2202762022.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="jiangxueqiao.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiangXueqiao's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Qt开发路上的“绊脚石”与“垫脚石” | JiangXueqiao's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Qt开发路上的“绊脚石”与“垫脚石”
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-25 20:55:02" itemprop="dateCreated datePublished" datetime="2022-09-25T20:55:02+08:00">2022-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-17 15:58:28" itemprop="dateModified" datetime="2025-11-17T15:58:28+08:00">2025-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Qt/" itemprop="url" rel="index"><span itemprop="name">Qt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>23 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="移除Qt控件虚线框"><a href="#移除Qt控件虚线框" class="headerlink" title="移除Qt控件虚线框"></a>移除Qt控件虚线框</h1><h3 id="方式一：使用-StyleSheet"><a href="#方式一：使用-StyleSheet" class="headerlink" title="方式一：使用 StyleSheet"></a>方式一：使用 StyleSheet</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QWidget<span class="selector-pseudo">:focus</span> &#123;</span><br><span class="line">  <span class="attribute">outline</span>: none; <span class="comment">/* 去掉得到焦点时的虚线框 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方式二：继承-QProxyStyle"><a href="#方式二：继承-QProxyStyle" class="headerlink" title="方式二：继承 QProxyStyle"></a>方式二：继承 QProxyStyle</h3><p>继承 QProxyStyle，PrimitiveElement 为 QStyle::PE_FrameFocusRect 时不绘制虚线框，然后在 main() 函数里调用 QApplication::setStyle() 使用新的样式。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名: NoFocusRectStyle.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> NOFOCUSRECTSTYLE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NOFOCUSRECTSTYLE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QProxyStyle&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoFocusRectStyle</span> : <span class="keyword">public</span> QProxyStyle</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">NoFocusRectStyle</span>(QStyle *baseStyle) : <span class="built_in">QProxyStyle</span>(baseStyle) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">drawPrimitive</span><span class="params">(PrimitiveElement element,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">const</span> QStyleOption *option,</span></span></span><br><span class="line"><span class="params"><span class="function">                       QPainter *painter,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">const</span> QWidget *widget = <span class="number">0</span>)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element == QStyle::PE_FrameFocusRect)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        QProxyStyle::<span class="built_in">drawPrimitive</span>(element, option, painter, widget);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// NOFOCUSRECTSTYLE_H</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名: main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;NoFocusRectStyle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    NoFocusRectStyle *style = <span class="keyword">new</span> <span class="built_in">NoFocusRectStyle</span>(app.<span class="built_in">style</span>());</span><br><span class="line">    app.<span class="built_in">setStyle</span>(style); <span class="comment">// Ownership of the style object is transferred to QApplication</span></span><br><span class="line">    Widget w;</span><br><span class="line">    w.<span class="built_in">show</span>();</span><br><span class="line">    <span class="keyword">return</span> app.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="无法拖入文件到QListWidget"><a href="#无法拖入文件到QListWidget" class="headerlink" title="无法拖入文件到QListWidget"></a>无法拖入文件到QListWidget</h1><p>一般而言，只需要做如下操作，QWidget即可支持拖入文件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setDragDropMode</span>(QAbstractItemView::DropOnly); <span class="comment">// 仅支持拖入文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写dragEnterEvent，当拖入文件进入时被调用，可以在该函数中取消拖入操作</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dragEnterEvent</span><span class="params">(QDragEnterEvent* e)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写dropEvent，当拖入文件并释放鼠标时被调用</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dropEvent</span><span class="params">(QDropEvent* e)</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure>

<p>但在执行上述操作后，我们拖入文件到QListWidget时，却只能收到dragEnterEvent事件，却无法收到dropEvent事件。</p>
<span id="more"></span>
<p>因为还需要重写dragMoveEvent方法，如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dragMoveEvent</span><span class="params">(QDragMoveEvent* e)</span> </span>&#123;</span><br><span class="line">    e-&gt;<span class="built_in">acceptProposedAction</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="使QListWidgetItem自适应尺寸"><a href="#使QListWidgetItem自适应尺寸" class="headerlink" title="使QListWidgetItem自适应尺寸"></a>使QListWidgetItem自适应尺寸</h1><p>QListWidget添加item的方法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QListWidget* list = <span class="keyword">new</span> <span class="built_in">QListWidget</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">QListWidgetItem* item = <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>();</span><br><span class="line">list-&gt;<span class="built_in">addItem</span>(item);</span><br></pre></td></tr></table></figure>

<p>如需要自定义Item的布局，还可以通过自定义Widget来实现，如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QListWidget* list = <span class="keyword">new</span> <span class="built_in">QListWidget</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">QListWidgetItem* item = <span class="keyword">new</span> <span class="built_in">QListWidgetItem</span>();</span><br><span class="line">list-&gt;<span class="built_in">addItem</span>(item);</span><br><span class="line"></span><br><span class="line">CustomWidget * customWidget = <span class="keyword">new</span> <span class="built_in">CustomWidget</span>();</span><br><span class="line">list-&gt;<span class="built_in">setItemWidget</span>(item, customWidget);  <span class="comment">// 设置Item的自定义Widget</span></span><br></pre></td></tr></table></figure>

<p>此时，我们还没有为item设置size hint，item会自动根据item的数据（如text）计算size hint。但如果是自定义的Widget，则无法自动计算size hint，需要手动设置size hint，如：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> vScrollbarWidth = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">verticalScrollBar</span>())</span><br><span class="line">    vScrollbarWidth = <span class="built_in">verticalScrollBar</span>()-&gt;<span class="built_in">width</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 减去纵坐标的宽度</span></span><br><span class="line">item-&gt;<span class="built_in">setSizeHint</span>(<span class="built_in">QSize</span>(list-&gt;<span class="built_in">width</span>() - vScrollbarWidth, widget-&gt;<span class="built_in">height</span>()));</span><br></pre></td></tr></table></figure>

<p>QListWidget的滚动条默认显示策略是<code>ScrollBarAsNeeded</code>，当宽度不够显示Item时，滚动条就会显示出来，此时虽然QListWidget宽度改变了，但Item的宽度却不会改变，Item不会收到ResizeEvent事件。如需Item的宽度跟随QListWidget宽度而改变，则需要关闭滚动条显示，并在 QListWidget 的 ResizeEvent 事件中实时设置每个Item的size hint，代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭滚动条</span></span><br><span class="line">list-&gt;<span class="built_in">setHorizontalScrollBarPolicy</span>(Qt::ScrollBarAlwaysOff);</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FileList::resizeEvent</span><span class="params">(QResizeEvent* e)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> vScrollbarWidth = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">verticalScrollBar</span>())</span><br><span class="line">        vScrollbarWidth = <span class="built_in">verticalScrollBar</span>()-&gt;<span class="built_in">width</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> w = <span class="built_in">width</span>();</span><br><span class="line">    <span class="type">int</span> cnt = <span class="built_in">count</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; cnt; i++) &#123;</span><br><span class="line">        QListWidgetItem* it = <span class="built_in">item</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (it) &#123;</span><br><span class="line">            CustomWidget* customWidget = <span class="built_in">dynamic_cast</span>&lt;CustomWidget*&gt;(<span class="built_in">itemWidget</span>(it));</span><br><span class="line">            <span class="keyword">if</span> (customWidget) &#123;</span><br><span class="line">                it-&gt;<span class="built_in">setSizeHint</span>(<span class="built_in">QSize</span>(w - vScrollbarWidth, customWidget-&gt;<span class="built_in">height</span>()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    QListWidget::<span class="built_in">resizeEvent</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="子线程中更新UI"><a href="#子线程中更新UI" class="headerlink" title="子线程中更新UI"></a>子线程中更新UI</h1><h3 id="方法1-使用信号槽"><a href="#方法1-使用信号槽" class="headerlink" title="方法1: 使用信号槽"></a>方法1: 使用信号槽</h3><p>这是一种非常常规的方式，通过自定义信号、槽，连接该信号和槽，在子线程中发送信号，在槽中更新 UI。</p>
<p>定义信号和槽：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updateUi</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUpdateUi</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在子线程中发送信号：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接信号</span></span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>, &amp;UpdateUIInSubThread::updateUi, <span class="keyword">this</span>, &amp;UpdateUIInSubThread::onUpdateUi, Qt::AutoConnection);</span><br><span class="line"></span><br><span class="line">std::thread t = std::<span class="built_in">thread</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        emit <span class="built_in">updateUi</span>(i); <span class="comment">// 发送信号</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t.<span class="built_in">detach</span>();</span><br></pre></td></tr></table></figure>

<p>在槽函数中更新 UI：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UpdateUIInSubThread::onUpdateUi</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.label-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式需要单独额外定义信号和槽，使用起来比较繁琐。</p>
<h3 id="方法2-使用invokeMethod"><a href="#方法2-使用invokeMethod" class="headerlink" title="方法2: 使用invokeMethod"></a>方法2: 使用invokeMethod</h3><p>QMetaObject::invokeMethod 函数的原型如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Functor, <span class="keyword">typename</span> FunctorReturnType&gt; <span class="function"><span class="type">bool</span> <span class="title">QMetaObject::invokeMethod</span><span class="params">(QObject *context, Functor function, Qt::ConnectionType type = Qt::AutoConnection, FunctorReturnType *ret = <span class="literal">nullptr</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>该函数可以在<code>context</code>的事件循环中执行<code>function</code>函数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::thread t = std::<span class="built_in">thread</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (QMetaObject::<span class="built_in">invokeMethod</span>(<span class="keyword">this</span>, [i, <span class="keyword">this</span>]() &#123;</span><br><span class="line">            ui.label-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(i));</span><br><span class="line">        &#125;)) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Update UI success&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t.<span class="built_in">detach</span>();</span><br></pre></td></tr></table></figure>

<p>由于在子线程中更新 UI，因此信号和槽肯定使用的是 QueuedConnection 的连接方式，所以无法将<code>FunctorReturnType</code>返回给调用者，否则会出现如下错误：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QMetaObject::invokeMethod: Unable to invoke methods with return values in queued connections</span><br></pre></td></tr></table></figure>

<p>当然上述示例中也可以不使用 lambda 表达式，直接调用槽函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::thread t = std::<span class="built_in">thread</span>([<span class="keyword">this</span>]() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        QMetaObject::<span class="built_in">invokeMethod</span>(<span class="keyword">this</span>, <span class="string">&quot;onUpdateUi&quot;</span>, Qt::AutoConnection, <span class="built_in">Q_ARG</span>(<span class="type">int</span>, i));</span><br><span class="line"></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t.<span class="built_in">detach</span>();</span><br></pre></td></tr></table></figure>

<h1 id="加载字体文件"><a href="#加载字体文件" class="headerlink" title="加载字体文件"></a>加载字体文件</h1><p>如何使用 Qt 加载外部字体文件，并遍历字体名称和样式名称。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">LoadFont</span><span class="params">(<span class="type">const</span> QString&amp; fontPath)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> fontId = QFontDatabase::<span class="built_in">addApplicationFont</span>(fontPath);</span><br><span class="line">    <span class="keyword">if</span> (fontId == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历字体名和样式名</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> QT_VERSION &gt;= QT_VERSION_CHECK(6, 0, 0)</span></span><br><span class="line">    <span class="type">const</span> QStringList fontFamilyList = fontDb.<span class="built_in">applicationFontFamilies</span>(fontId);</span><br><span class="line"></span><br><span class="line">    QString fontFamily;</span><br><span class="line">    foreach (fontFamily, fontFamilyList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Family:&quot;</span> &lt;&lt; fontFamily;</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> QStringList fontStyleList = QFontDatabase::<span class="built_in">styles</span>(fontFamily);</span><br><span class="line">        QString fontStyle;</span><br><span class="line">        foreach (fontStyle, fontStyleList) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;\tStyle:&quot;</span> &lt;&lt; fontStyle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    QFontDatabase fontDb;</span><br><span class="line">    <span class="type">const</span> QStringList fontFamilyList = fontDb.<span class="built_in">applicationFontFamilies</span>(fontId);</span><br><span class="line"></span><br><span class="line">    QString fontFamily;</span><br><span class="line">    foreach (fontFamily, fontFamilyList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Family:&quot;</span> &lt;&lt; fontFamily;</span><br><span class="line"></span><br><span class="line">        <span class="type">const</span> QStringList fontStyleList = fontDb.<span class="built_in">styles</span>(fontFamily);</span><br><span class="line">        QString fontStyle;</span><br><span class="line">        foreach (fontStyle, fontStyleList) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;\tStyle:&quot;</span> &lt;&lt; fontStyle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="QWidget子类无法应用QSS"><a href="#QWidget子类无法应用QSS" class="headerlink" title="QWidget子类无法应用QSS"></a>QWidget子类无法应用QSS</h1><p>QWidget子类无法应用QSS样式的问题是一个老生常谈的问题，在使用Qt进行界面开发时，我们经常会继承自QWidget来实现自定义控件（当然这里说的是非顶级窗口），此时我们发现在该自定义控件上应用QSS样式会无效。</p>
<p>导致这个问题的主要原因是QWidget的paintEvent函数实现为空，未做任何绘制，也没有对样式表进行初始化和绘制，其代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QWidget::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决这个问题也比较简单，在QWidget子类的paintEvent函数中初始化并绘制样式表：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomWidget::paintEvent</span><span class="params">(QPaintEvent* e)</span> </span>&#123;</span><br><span class="line">    QStyleOption opt;</span><br><span class="line">    opt.<span class="built_in">init</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="built_in">style</span>()-&gt;<span class="built_in">drawPrimitive</span>(QStyle::PE_Widget, &amp;opt, &amp;p, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然我们也可以采用变通的方法，改为继承自<code>QFrame</code>，因为QFrame默认初始化和绘制了样式表，其代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QFrame::paintEvent</span><span class="params">(QPaintEvent *)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPainter <span class="title">paint</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="built_in">drawFrame</span>(&amp;paint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    \internal</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Used by QLabel and QLCDNumber</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QFrame::drawFrame</span><span class="params">(QPainter *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QStyleOptionFrame opt;</span><br><span class="line">    <span class="built_in">initStyleOption</span>(&amp;opt);</span><br><span class="line">    <span class="built_in">style</span>()-&gt;<span class="built_in">drawControl</span>(QStyle::CE_ShapedFrame, &amp;opt, p, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="QSS-设置滚动条的样式"><a href="#QSS-设置滚动条的样式" class="headerlink" title="QSS 设置滚动条的样式"></a>QSS 设置滚动条的样式</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*垂直滚动条*/</span></span><br><span class="line">QScrollBar:vertical &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent; <span class="comment">/*背景色*/</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>; <span class="comment">/*宽度*/</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span>; <span class="comment">/**/</span></span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">12px</span>; <span class="comment">/*距离上面12px*/</span></span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">12px</span>; <span class="comment">/*距离底部12px*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条*/</span></span><br><span class="line">QScrollBar:horizontal &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent; <span class="comment">/*背景色*/</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>; <span class="comment">/*高度*/</span></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">12px</span>; <span class="comment">/*距离左边12px*/</span></span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">12px</span>; <span class="comment">/*距离右边12px*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直/横向滚动条Hover效果*/</span></span><br><span class="line">QScrollBar:vertical:hover,</span><br><span class="line">QScrollBar:horizontal:hover &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">30</span>); <span class="comment">/*背景色*/</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>; <span class="comment">/*圆角*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条 - 滑块*/</span></span><br><span class="line">QScrollBar::handle:vertical &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条 - 滑块*/</span></span><br><span class="line">QScrollBar::handle:horizontal &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直/横向滚动条滑块Hover效果*/</span></span><br><span class="line">QScrollBar::handle:vertical:hover,</span><br><span class="line">QScrollBar::handle:horizontal:hover &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条下部分块*/</span></span><br><span class="line">QScrollBar::add-page:vertical &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条上面部分块*/</span></span><br><span class="line">QScrollBar::sub-page:vertical &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条右边部分块*/</span></span><br><span class="line">QScrollBar::add-page:horizontal &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条左边部分块*/</span></span><br><span class="line">QScrollBar::sub-page:horizontal &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ----------- 对于扁平化设计风格，下面的样式可以不用设置 ----------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条顶部三角形位置*/</span></span><br><span class="line">QScrollBar::sub-line:vertical &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  subcontrol-<span class="attribute">position</span>: top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条顶部三角形图标*/</span></span><br><span class="line">QScrollBar::up-arrow:vertical &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowup_normal.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条顶部三角形图标 鼠标Hover效果*/</span></span><br><span class="line">QScrollBar::up-arrow:vertical:hover &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowup_down.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条顶部三角形图标 鼠标按下效果*/</span></span><br><span class="line">QScrollBar::up-arrow:vertical:pressed &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowup_highlight.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条底部三角形位置*/</span></span><br><span class="line">QScrollBar::add-line:vertical &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  subcontrol-<span class="attribute">position</span>: bottom;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条底部三角形图标*/</span></span><br><span class="line">QScrollBar::down-arrow:vertical &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowdown_normal.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*垂直滚动条底部三角形图标 鼠标Hover效果*/</span></span><br><span class="line">QScrollBar::down-arrow:vertical:hover &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowdown_down.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*垂直滚动条底部三角形图标 鼠标按下效果*/</span></span><br><span class="line">QScrollBar::down-arrow:vertical:pressed &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowdown_highlight.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条左侧三角形位置*/</span></span><br><span class="line">QScrollBar::sub-line:horizontal &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  subcontrol-<span class="attribute">position</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条左侧三角形图标*/</span></span><br><span class="line">QScrollBar::left-arrow:horizontal &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowleft_normal.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条左侧三角形图标 鼠标Hover效果*/</span></span><br><span class="line">QScrollBar::left-arrow:horizontal:hover &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowleft_down.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条左侧三角形图标 鼠标按下效果*/</span></span><br><span class="line">QScrollBar::left-arrow:horizontal:pressed &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowleft_highlight.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条右侧三角形部分*/</span></span><br><span class="line">QScrollBar::add-line:horizontal &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  subcontrol-<span class="attribute">position</span>: right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条右侧三角形图标*/</span></span><br><span class="line">QScrollBar::right-arrow:horizontal &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowright_normal.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条右侧三角形图标 鼠标Hover效果*/</span></span><br><span class="line">QScrollBar::right-arrow:horizontal:hover &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowright_down.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*横向滚动条右侧三角形图标 鼠标按下效果*/</span></span><br><span class="line">QScrollBar::right-arrow:horizontal:pressed &#123;</span><br><span class="line">  <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/client/images/scrollbar_arrowright_highlight.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="自定义和美化菜单"><a href="#自定义和美化菜单" class="headerlink" title="自定义和美化菜单"></a>自定义和美化菜单</h1><p>在Qt中可以通过QSS对菜单进行样式设置，而且对于非标准菜单项我也可以通过自定义Widget的方法来实现，本文讲述在Qt中QMenu的使用方法。</p>
<h2 id="菜单基本使用"><a href="#菜单基本使用" class="headerlink" title="菜单基本使用"></a>菜单基本使用</h2><p>下面示例演示了右键菜单的创建方法，该菜单包含了图标、选中&#x2F;未选中状态、二级菜单、互斥选择等常用菜单特性，代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QIcon <span class="title">settingIcon</span><span class="params">(<span class="string">&quot;:/MenuBeauty/setting.png&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Actions</span></span><br><span class="line">QAction* action1 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;动作1&quot;</span>);</span><br><span class="line">QAction* action2 = <span class="keyword">new</span> <span class="built_in">QAction</span>(settingIcon, <span class="string">&quot;动作2 有图标&quot;</span>);</span><br><span class="line"></span><br><span class="line">QAction* action3 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;动作3 [未选中]&quot;</span>);</span><br><span class="line">action3-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line">action3-&gt;<span class="built_in">setChecked</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="built_in">connect</span>(action3, &amp;QAction::triggered, <span class="keyword">this</span>, [action3](<span class="type">bool</span> checked) &#123;</span><br><span class="line">    action3-&gt;<span class="built_in">setText</span>(checked ? <span class="string">&quot;动作3 [选中]&quot;</span> : <span class="string">&quot;动作3 [未选中]&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">QAction* action4 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;Action4 动作四测试&quot;</span>);</span><br><span class="line"></span><br><span class="line">QAction* action5 = <span class="keyword">new</span> <span class="built_in">QAction</span>(settingIcon, <span class="string">&quot;动作5 禁用&quot;</span>);</span><br><span class="line">action5-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">QAction* action6 = <span class="keyword">new</span> <span class="built_in">QAction</span>(settingIcon, <span class="string">&quot;动作6 子菜单&quot;</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 动作6的子动作</span></span><br><span class="line">    QAction* action6_1 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;动作6.1&quot;</span>);</span><br><span class="line">    action6_1-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    QAction* action6_2 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;动作6.1&quot;</span>);</span><br><span class="line">    action6_2-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    QAction* action6_3 = <span class="keyword">new</span> <span class="built_in">QAction</span>(<span class="string">&quot;动作6.1&quot;</span>);</span><br><span class="line">    action6_3-&gt;<span class="built_in">setCheckable</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动作6的子菜单</span></span><br><span class="line">    QMenu* action6SubMenu = <span class="keyword">new</span> <span class="built_in">QMenu</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    action6SubMenu-&gt;<span class="built_in">addAction</span>(action6_1);</span><br><span class="line">    action6SubMenu-&gt;<span class="built_in">addAction</span>(action6_2);</span><br><span class="line">    action6SubMenu-&gt;<span class="built_in">addAction</span>(action6_3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 互斥子菜单项，同时只能选择一个</span></span><br><span class="line">    QActionGroup* action6Group = <span class="keyword">new</span> <span class="built_in">QActionGroup</span>(<span class="keyword">this</span>);</span><br><span class="line">    action6Group-&gt;<span class="built_in">setExclusive</span>(<span class="literal">true</span>);</span><br><span class="line">    action6Group-&gt;<span class="built_in">addAction</span>(action6_1);</span><br><span class="line">    action6Group-&gt;<span class="built_in">addAction</span>(action6_2);</span><br><span class="line">    action6Group-&gt;<span class="built_in">addAction</span>(action6_3);</span><br><span class="line"></span><br><span class="line">    action6-&gt;<span class="built_in">setMenu</span>(action6SubMenu);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义菜单</span></span><br><span class="line">QMenu* menu = <span class="keyword">new</span> <span class="built_in">QMenu</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加Action</span></span><br><span class="line">menu-&gt;<span class="built_in">addActions</span>(&#123;action1, action2, action3&#125;);</span><br><span class="line">menu-&gt;<span class="built_in">addSeparator</span>();</span><br><span class="line">menu-&gt;<span class="built_in">addActions</span>(&#123;action4, action5, action6&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 鼠标右键弹出菜单</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setContextMenuPolicy</span>(Qt::CustomContextMenu);</span><br><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>, &amp;QWidget::customContextMenuRequested, <span class="keyword">this</span>, [<span class="keyword">this</span>, menu](<span class="type">const</span> QPoint&amp; pos) &#123;</span><br><span class="line">    menu-&gt;<span class="built_in">exec</span>(<span class="keyword">this</span>-&gt;<span class="built_in">mapToGlobal</span>(pos));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述菜单未经过任何美化，样式如下图所示：<br><img data-src="/images/blog/default-menu-style.png"></p>
<h2 id="使用QSS美化菜单"><a href="#使用QSS美化菜单" class="headerlink" title="使用QSS美化菜单"></a>使用QSS美化菜单</h2><p>现在我们使用如下QSS对上面创建的菜单进行美化，可以美化的项包含背景、文本颜色、边距、图标等。</p>
<p>为了使大家不被颜色值所困扰，下面QSS中的颜色统一使用颜色名称表示。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 菜单的属性 */</span></span><br><span class="line">QMenu &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solod red;</span><br><span class="line">    <span class="comment">/* 圆角生效的前提是菜单窗口背景透明 */</span></span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: blue;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&quot;Microsoft YaHei&quot;</span>;</span><br><span class="line">    <span class="comment">/* 设置菜单项最小宽度，此处有bug：虽可自动增长但实际宽度比所需宽度小 */</span></span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">160px</span>;</span><br><span class="line">    <span class="comment">/* 菜单内容上下边距为10px，预留圆角区域 */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0px</span> <span class="number">10px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 菜单项的属性 */</span></span><br><span class="line">QMenu::item &#123;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">background-color</span>: transparent;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="comment">/* 设置菜单项最小高度，可以让菜单项的高适应内容自动增长 */</span></span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="comment">/* 设置菜单项最小宽度，此处有bug：虽可自动增长但实际宽度比所需宽度小 */</span></span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">160px</span>;</span><br><span class="line">    <span class="comment">/* 使菜单项之间及菜单项和图标之间保持一定间隔，设置上下左右边距为8px，此处不能用margin */</span></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 菜单项-鼠标移入时的属性 */</span></span><br><span class="line">QMenu::item:selected &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: green;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 菜单项-禁用时的属性 */</span></span><br><span class="line">QMenu::item:disabled &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: gray;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 分割线的属性 */</span></span><br><span class="line">QMenu::separator &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">    <span class="comment">/* 左右边距：6px */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>x <span class="number">6px</span> <span class="number">0px</span> <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 图标的属性 */</span></span><br><span class="line">QMenu::icon &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="comment">/* 左边距：12px */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 指示器的属性 */</span></span><br><span class="line"><span class="comment">/* 这里将互斥和非互斥Action的指示器样式设置为一样的，也可以设置为不一样 */</span></span><br><span class="line">QMenu::indicator:non-exclusive:checked, QMenu::indicator:exclusive:checked &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="comment">/* 左边距：8px */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span>;</span><br><span class="line">    <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/MenuBeauty/check.png</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QMenu::indicator:non-exclusive:unchecked, QMenu::indicator:exclusive:unchecked &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="comment">/* 左边距：8px */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span>;</span><br><span class="line">    <span class="selector-tag">image</span>: <span class="built_in">url</span>(<span class="string">:/MenuBeauty/unchecked.png</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了使菜单的圆角生效，我们还需要移除菜单的边框、阴影，并将背景设置为透明，代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">menu-&gt;<span class="built_in">setWindowFlags</span>(action6SubMenu-&gt;<span class="built_in">windowFlags</span>() |</span><br><span class="line">                                Qt::FramelessWindowHint |   <span class="comment">// 无边框</span></span><br><span class="line">                                Qt::NoDropShadowWindowHint  <span class="comment">// 移除系统阴影</span></span><br><span class="line">);</span><br><span class="line">menu-&gt;<span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground); <span class="comment">// 背景透明</span></span><br></pre></td></tr></table></figure>

<p>美化后的菜单如下图所示：<br><img data-src="/images/blog/after-qss-menu-style.png"></p>
<h3 id="QSS美化QMenu"><a href="#QSS美化QMenu" class="headerlink" title="QSS美化QMenu"></a>QSS美化QMenu</h3><p>QMenu支持QSS盒子模型，其通用属性如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">border</span><br><span class="line">border-radius</span><br><span class="line">margin</span><br><span class="line">padding</span><br><span class="line">background</span><br><span class="line">color</span><br><span class="line">font</span><br><span class="line">border-image</span><br></pre></td></tr></table></figure>

<p>QSS还可以对QMenu的子控件进行设置，支持QMenu子控件如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">item</span><br><span class="line">indicator</span><br><span class="line">separator</span><br><span class="line">right-arrow</span><br><span class="line">left-arrow</span><br><span class="line">scroller</span><br><span class="line">tearoff</span><br></pre></td></tr></table></figure>

<p>QMenu不支持伪状态，只有其子控件支持伪状态，支持的伪状态如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">default</span><br><span class="line">selected</span><br><span class="line">exclusive</span><br><span class="line">non-exclusive</span><br></pre></td></tr></table></figure>

<p>具体的子控件和伪状态的含义，可以参考 <a href="/post/749849405.html" title="QSS基本使用方法">QSS基本使用方法</a> 文章。</p>
<h2 id="自定义菜单项"><a href="#自定义菜单项" class="headerlink" title="自定义菜单项"></a>自定义菜单项</h2><p>大多数情况下，上述常规的菜单项就可以满足要求，但在有些情况下，我们的菜单项可能由更加复杂的Widget组合而成，比如下面播放器的菜单：<br><img data-src="/images/blog/music-menu-sample.png"></p>
<p>我们可以使用<code>QWidgetAction</code>来实现上述菜单效果，<code>QWidgetAction</code>可以将一个QWidget放入菜单项的容器内，从而实现自定义菜单项。</p>
<p>下面代码定义了一个包含3个按钮的菜单项，点击按钮会弹出对话框：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">QWidgetAction* action7 = <span class="keyword">new</span> <span class="built_in">QWidgetAction</span>(<span class="keyword">this</span>);</span><br><span class="line">&#123;</span><br><span class="line">    QWidget* widget = <span class="keyword">new</span> <span class="built_in">QWidget</span>();</span><br><span class="line">    QHBoxLayout* hl = <span class="keyword">new</span> <span class="built_in">QHBoxLayout</span>(widget);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> createPushButtonFn = [<span class="keyword">this</span>](QString title) &#123;</span><br><span class="line">        QPushButton* btn = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(title);</span><br><span class="line">        <span class="built_in">connect</span>(btn, &amp;QPushButton::clicked, <span class="keyword">this</span>, [<span class="keyword">this</span>]() &#123;</span><br><span class="line">            QMessageBox::<span class="built_in">information</span>(<span class="keyword">this</span>, <span class="string">&quot;Clicked&quot;</span>, ((QPushButton*)<span class="built_in">sender</span>())-&gt;<span class="built_in">text</span>());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> btn;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    hl-&gt;<span class="built_in">addWidget</span>(<span class="built_in">createPushButtonFn</span>(<span class="string">&quot;Button1&quot;</span>));</span><br><span class="line">    hl-&gt;<span class="built_in">addWidget</span>(<span class="built_in">createPushButtonFn</span>(<span class="string">&quot;Button2&quot;</span>));</span><br><span class="line">    hl-&gt;<span class="built_in">addWidget</span>(<span class="built_in">createPushButtonFn</span>(<span class="string">&quot;Button3&quot;</span>));</span><br><span class="line"></span><br><span class="line">    action7-&gt;<span class="built_in">setDefaultWidget</span>(widget);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menu-&gt;<span class="built_in">addAction</span>(action7);</span><br></pre></td></tr></table></figure>

<p>效果如图所示：<br><img data-src="/images/blog/qwidgetaction-menu-sample.png"></p>
<p>我们也可以使用QSS对菜单项内的控件进行样式设置，如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">QMenu QPushButton &#123;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>📌限于篇幅，不在此提供完整的示例代码，如需获取完整的示例代码，可以<a href="/about">联系我</a></strong></p>
<h1 id="弹窗外部点击时自动关闭"><a href="#弹窗外部点击时自动关闭" class="headerlink" title="弹窗外部点击时自动关闭"></a>弹窗外部点击时自动关闭</h1><p>在 Qt 编程中如何实现当鼠标点击弹窗外部区域时，该弹窗可以自动关闭的效果。</p>
<h2 id="ActivationChange-事件"><a href="#ActivationChange-事件" class="headerlink" title="ActivationChange 事件"></a>ActivationChange 事件</h2><p>弹窗通过监听 Activation 改变事件，来判断自身是否还是当前的活动窗口，如果不是则关闭自身。</p>
<p>在 QWidget 里面重写 event，捕获 QEvent::ActivationChange 事件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UserCenterDlg::event</span><span class="params">(QEvent* e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">type</span>() == QEvent::ActivationChange) &#123;</span><br><span class="line">        QWidget* curActiveWin = QApplication::<span class="built_in">activeWindow</span>();</span><br><span class="line">        <span class="keyword">if</span> (curActiveWin != <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">event</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Qt-WA-NoMouseReplay-介绍"><a href="#Qt-WA-NoMouseReplay-介绍" class="headerlink" title="Qt::WA_NoMouseReplay 介绍"></a>Qt::WA_NoMouseReplay 介绍</h2><blockquote>
<p>摘自 Qt 帮助文档：</p>
<p>Qt::WA_NoMouseReplay: Used for pop-up widgets. Indicates that the most recent mouse press event should not be replayed when the pop-up widget closes. The flag is set by the widget’s author and cleared by the Qt kernel every time the widget receives a new mouse event.</p>
</blockquote>
<p>Qt::WA_NoMouseReplay 属性可以用来避免如下情况的发生：<br>在鼠标点击 Popup Widget 外部区域时，该 Widget 接收到自身的 Activation 状态发生改变，关闭自身，但在该 Widget 在关闭后，Qt 依然会将鼠标点击事件继续向下传递，从而窗口外区域下面的控件也会被点击。</p>
<p>由于 Qt::WA_NoMouseReplay 属性只对具有 Popup 属性的 Widget 起作用，因此只能使用 QWidget，不能使用 QDialog，并设置 Qt::Popup 属性。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowFlags</span>(<span class="built_in">windowFlags</span>() | Qt::Popup);</span><br></pre></td></tr></table></figure>

<p>何时设置 Qt::WA_NoMouseReplay 属性了？</p>
<p>重写 mousePressEvent，在鼠标按下事件发生时，设置 Qt::WA_NoMouseReplay 属性。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UserCenterDlg::mousePressEvent</span><span class="params">(QMouseEvent* e)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">setAttribute</span>(Qt::WA_NoMouseReplay);</span><br><span class="line">    QWidget::<span class="built_in">mousePressEvent</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义-closed-信号"><a href="#自定义-closed-信号" class="headerlink" title="自定义 closed 信号"></a>自定义 closed 信号</h2><p>QWidget 没有关闭信号，我们可以自定义关闭信号，该信号在 closeEvent 中触发。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">UserCenterDlg::closeEvent</span><span class="params">(QCloseEvent* e)</span> </span>&#123;</span><br><span class="line">    <span class="function">emit <span class="title">closed</span><span class="params">()</span></span>;</span><br><span class="line">    QWidget::<span class="built_in">closeEvent</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="QPixmap使用要点"><a href="#QPixmap使用要点" class="headerlink" title="QPixmap使用要点"></a>QPixmap使用要点</h1><ul>
<li>QPixmap::size() 值与程序的 devicePixelRatio 无关，输出的是图片原始尺寸。</li>
<li>AspectRatioMode 取值：<ul>
<li>Qt::IgnoreAspectRatio 忽略图片原长宽比，将图片缩放到指定尺寸</li>
<li>Qt::KeepAspectRatio 在保持图片原长宽比和图片所有元素的情况下，尽量填充满目标矩形。</li>
<li>Qt::KeepAspectRatioByExpanding 在保持长宽比的情况下，拉伸图片保证填充满目标矩形，可能会舍弃部分图片元素。</li>
</ul>
</li>
</ul>
<p><img data-src="/images/blog/qpixmap-syyd-2.png"></p>
<ul>
<li>scaledToWidth、scaledToHeight 函数可以实现在保持原图片长宽比的前提下，将图片缩放到指定的宽或者高。</li>
<li>drawPixmap 函数的参数从左到右依次是：目标区域 -&gt; pix -&gt; 源区域。<strong>目标区域会考虑当前 Widget 的 devicePixelRatio，而源区域则与 devicePixelRatio 无关。</strong></li>
</ul>
<h3 id="开启程序-DPI-缩放"><a href="#开启程序-DPI-缩放" class="headerlink" title="开启程序 DPI 缩放"></a>开启程序 DPI 缩放</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    QGuiApplication::<span class="built_in">setAttribute</span>(Qt::AA_EnableHighDpiScaling);</span><br><span class="line">    QGuiApplication::<span class="built_in">setAttribute</span>(Qt::AA_UseHighDpiPixmaps);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (QT_VERSION &gt;= QT_VERSION_CHECK(5, 14, 0))</span></span><br><span class="line">    QGuiApplication::<span class="built_in">setHighDpiScaleFactorRoundingPolicy</span>(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="QPixmap-devicePixelRatio"><a href="#QPixmap-devicePixelRatio" class="headerlink" title="QPixmap::devicePixelRatio"></a>QPixmap::devicePixelRatio</h3><p>首先 QPixmap::devicePixelRatio 仅适用于开启了 DPI 缩放的程序。</p>
<p>高分辨率版本的图片有大于 1 的设备像素比（即QPixmap::devicePixelRatio），如果该值匹配底层 QPaintDevice 的值，它将直接绘制到设备上，而不应用额外的转换。</p>
<p><strong>该值用于指定当前 QPixmap 图片是基于 1 倍图的几倍缩放图。</strong></p>
<p>需要注意的是，在使用<code>drawPixmap</code>函数时，如果该目标区域参数未指定宽和高，QPixmap::devicePixelRatio 才生效。</p>
<p>如下面的 drawPixmap 原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">const</span> QPixmap &amp;pixmap, <span class="type">int</span> sx, <span class="type">int</span> sy, <span class="type">int</span> sw, <span class="type">int</span> sh)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">const</span> QPointF &amp;point, <span class="type">const</span> QPixmap &amp;pixmap, <span class="type">const</span> QRectF &amp;source)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">const</span> QPoint &amp;point, <span class="type">const</span> QPixmap &amp;pixmap, <span class="type">const</span> QRect &amp;source)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">const</span> QPointF &amp;point, <span class="type">const</span> QPixmap &amp;pixmap)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">const</span> QPoint &amp;point, <span class="type">const</span> QPixmap &amp;pixmap)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QPainter::drawPixmap</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">const</span> QPixmap &amp;pixmap)</span></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<p>示例（程序已开启 DPI 缩放）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtWidgetsApplication1::paintEvent</span><span class="params">(QPaintEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="keyword">this</span>-&gt;<span class="built_in">devicePixelRatioF</span>(); <span class="comment">// 当前程序的DPI缩放为1.5</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="function">QPixmap <span class="title">pix</span><span class="params">(<span class="string">&quot;D:\\gril.png&quot;</span>)</span></span>; <span class="comment">// gril.png图片实际尺寸为400*400</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 告知程序该图片是基于1倍图进行4倍放大后的，即1倍图为宽高为400/4</span></span><br><span class="line">    pix.<span class="built_in">setDevicePixelRatio</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实际绘制的图片宽度为150*150，左上角坐标为150*150</span></span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="built_in">QPoint</span>(<span class="number">100</span>,<span class="number">100</span>), pix);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/blog/qpixmap-syyd-1.png"></p>
<h1 id="Qt的布局技巧"><a href="#Qt的布局技巧" class="headerlink" title="Qt的布局技巧"></a>Qt的布局技巧</h1><h3 id="手动拖放"><a href="#手动拖放" class="headerlink" title="手动拖放"></a>手动拖放</h3><p>通过在 Qt Designer 中手动拖放控件，可以快速实现界面布局，如下图所示：</p>
<p><img data-src="/images/blog/5OlnDS5QGd-TinyTu.png"></p>
<p>这种方式对初学者非常友好，可以快速上手开发一个界面，增加成就感。但我们需要知道，拖放布局不是 Qt 布局的全部，这种方式仅适合简单的界面布局。</p>
<p>在实际的项目开发中，界面上的控件会比上面示例中的多得多，布局也会更加复杂，而且界面通常还需要反复地调整。在这种情况下，如果继续通过手动拖放的方式来进行布局，在每次界面调整时，我们都需要打破（分拆）原有的布局，并在修改完成之后重新进行布局，可能还需要重新设置布局的 Spacing 和 ContentsMargins，每一次修改都非常费劲。</p>
<blockquote>
<p>题外话：手动拖放控件对手的稳定性要求较高，可能手稍一抖，整个布局就错乱了，又得还原了重新来。</p>
</blockquote>
<h3 id="代码布局"><a href="#代码布局" class="headerlink" title="代码布局"></a>代码布局</h3><p>我通常使用代码的方式来进行 Qt 界面布局，例如下面的代码实现了与上面示例一样的布局效果：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">QLabel* lblUserName = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;用户名: &quot;</span>);</span><br><span class="line">QLabel* lblPassword = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="string">&quot;密码: &quot;</span>);</span><br><span class="line">QLineEdit* editUserName = <span class="keyword">new</span> <span class="built_in">QLineEdit</span>();</span><br><span class="line">QLineEdit* editPassword = <span class="keyword">new</span> <span class="built_in">QLineEdit</span>();</span><br><span class="line">QPushButton* btnLogin = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">QPushButton* btnRegister = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="string">&quot;注册&quot;</span>);</span><br><span class="line"></span><br><span class="line">QHBoxLayout* hUserName = <span class="keyword">new</span> <span class="built_in">QHBoxLayout</span>();</span><br><span class="line">hUserName-&gt;<span class="built_in">addWidget</span>(lblUserName);</span><br><span class="line">hUserName-&gt;<span class="built_in">addWidget</span>(editUserName);</span><br><span class="line"></span><br><span class="line">QHBoxLayout* hPassword = <span class="keyword">new</span> <span class="built_in">QHBoxLayout</span>();</span><br><span class="line">hPassword-&gt;<span class="built_in">addWidget</span>(lblPassword);</span><br><span class="line">hPassword-&gt;<span class="built_in">addWidget</span>(editPassword);</span><br><span class="line"></span><br><span class="line">QHBoxLayout* hButton = <span class="keyword">new</span> <span class="built_in">QHBoxLayout</span>();</span><br><span class="line">hButton-&gt;<span class="built_in">addStretch</span>();</span><br><span class="line">hButton-&gt;<span class="built_in">addWidget</span>(btnRegister);</span><br><span class="line">hButton-&gt;<span class="built_in">addWidget</span>(btnLogin);</span><br><span class="line">hButton-&gt;<span class="built_in">addStretch</span>();</span><br><span class="line"></span><br><span class="line">QVBoxLayout* vMain = <span class="keyword">new</span> <span class="built_in">QVBoxLayout</span>();</span><br><span class="line">vMain-&gt;<span class="built_in">addLayout</span>(hUserName);</span><br><span class="line">vMain-&gt;<span class="built_in">addLayout</span>(hPassword);</span><br><span class="line">vMain-&gt;<span class="built_in">addStretch</span>();</span><br><span class="line">vMain-&gt;<span class="built_in">addLayout</span>(hButton);</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setLayout</span>(vMain);</span><br></pre></td></tr></table></figure>

<p>大家看到上面代码后，第一感觉肯定是“我的个老天，这么复杂”，这个可以理解。但这种方式的好处也非常明显，比如灵活性更大，后期调整、复用、维护也更加方便，而且对于自定义控件比较多的界面，这种方式可以直接创建对应类型的实例，不需要在设计器上进行类型提升。</p>
<h3 id="布局描述语言"><a href="#布局描述语言" class="headerlink" title="布局描述语言"></a>布局描述语言</h3><p>我在这里不是为了创造一种新的语言，而是受到了 Flutter 界面布局方式的启发，对 Qt 的布局进行了封装，简化了上述布局代码。</p>
<p>下面是上述示例简化后的布局代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> layout = <span class="built_in">VBox</span>(</span><br><span class="line">    <span class="built_in">HBox</span>(lblUserName, editUserName),</span><br><span class="line">    <span class="built_in">HBox</span>(lblPassword, editPassword),</span><br><span class="line">    <span class="built_in">Stretch</span>(),</span><br><span class="line">    <span class="built_in">HBox</span>(<span class="built_in">Stretch</span>(), btnRegister, btnLogin, <span class="built_in">Stretch</span>()));</span><br><span class="line"></span><br><span class="line"><span class="built_in">setLayout</span>(layout);</span><br></pre></td></tr></table></figure>

<p>从代码量来看，明显少了很多，而且我们还可以通过代码的层次结构快速看出界面的布局结构。</p>
<p>在此省略了 VBox、HBox 等类的实现代码，如果您对上述 Qt 布局方式的具体实现感兴趣，可以联系我。</p>
<h1 id="图片按九宫格模式缩放"><a href="#图片按九宫格模式缩放" class="headerlink" title="图片按九宫格模式缩放"></a>图片按九宫格模式缩放</h1><p>我们在缩放图片时，都期望能保持图片的原长宽比，因为这样可以防止图片变形，但往往事与愿违，有些时候我们没办法保持原图的长宽比不变，比如需要在保持图片高度不变的情况下，仅横向拉伸图片，此时就会导致图片变形。</p>
<p>为了解决这种问题，我们可以考虑使用九宫格模式进行图片的缩放。</p>
<p>九宫格模式就是将图片切分为九块（不强制切分的每一块必须等分），如下图所示，在图片缩放时，我们通常保持1、3、7、9四个顶点位置的图片不变，对2、4、5、6、8五个区域进行缩放。</p>
<p><img data-src="/images/blog/jiugongge.png"></p>
<h3 id="使用QSS实现"><a href="#使用QSS实现" class="headerlink" title="使用QSS实现"></a>使用QSS实现</h3><p>在Qt中实现图片按九宫格缩放最简单的方法是使用QSS的<code>border-image</code>属性来实现，通过上下左右四个边框的宽度或高度来设置1、3、7、9四个顶点的大小。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">border-image</span>: <span class="built_in">url</span>(<span class="string">:/Sample/image/NinePatchTest.png</span>);</span><br><span class="line"><span class="attribute">border-left</span>: <span class="number">210px</span>;</span><br><span class="line"><span class="attribute">border-top</span>: <span class="number">180px</span>;</span><br><span class="line"><span class="attribute">border-right</span>: <span class="number">300px</span>;</span><br><span class="line"><span class="attribute">border-bottom</span>: <span class="number">227px</span>;</span><br></pre></td></tr></table></figure>

<p>为了便于测试，我制作了一个九宫格测试图片（整个图片的宽高为1280*720）：</p>
<p><img data-src="/images/blog/NinePatchTest.png"></p>
<p>通过这种方法实现的九宫格缩放有一个弊端：</p>
<p>该方案会始终保持1、3、7、9四个区域图片的宽高不变，如1号区域是<code>210*180</code>，当我们对图片进行放大时，这个行为是没有问题的，但当我们缩小图片时，缩小后的图片宽高不足以容纳4个顶角图片时，缩小操作就会出现非预期的行为，可能如下图所示：</p>
<p><img data-src="/images/blog/feiyuqitupiansuofang-1.png"></p>
<p>这种弊端还会体现在支持高DPI缩放的Qt程序中，例如在一个支持DPI缩放的程序中，为宽高为<code>640*360</code>的QWidget设置背景图片，我们知道不同的 devicePixelRatio 会导致实际渲染的图片宽高不同，如devicePixelRatio为1时，图片渲染区域为<code>640*360</code>， 而devicePixelRatio为2时，实际渲染区域为<code>1280*720</code>，为了保证程序在不同DPI的环境下都有比较好的界面呈现，我们通常简单得指定一个倍图（如2倍图）让程序自动进行图片缩放（当然也可以使用SVG或针对不同DPI使用不同的图片）。</p>
<p>而使用 border-left 等属性指定的宽度是固定的，顶点图片无法参与到自动缩放中来，从而会导致这一 DPI 适配机制失效。下一节介绍的方法可以解决这一弊端。</p>
<h3 id="使用代码实现九宫格缩放"><a href="#使用代码实现九宫格缩放" class="headerlink" title="使用代码实现九宫格缩放"></a>使用代码实现九宫格缩放</h3><p>本节介绍如何使用代码来实现九宫格模式缩放图片，实现原理大致如下：</p>
<p>提取九个区域的图片，保持1、3、7、9四个图片不变，对2、4、5、6、8五个区域图片进行缩放，分别得到新的图片，最后再将九个区域的图片合并成一张图。</p>
<p>为了解决上述QSS方案的弊端，我们可以采取先将图片在保持长宽比的情况缩放到相应尺寸：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QPixmap keepRatioScaledPix = src.<span class="built_in">scaled</span>(destSize, Qt::KeepAspectRatio, Qt::SmoothTransformation);</span><br></pre></td></tr></table></figure>

<p>由于keepRatioScaledPix实际尺寸肯定与我们想要得到的destSize不匹配，所以我们再把keepRatioScaledPix图片按九宫格模式缩放。</p>
<p>具体实现代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QPixmap <span class="title">ScaleByNinePatch</span><span class="params">(<span class="type">const</span> QPixmap&amp; src, <span class="comment">// 原图</span></span></span></span><br><span class="line"><span class="params"><span class="function">                         QSize destSize, <span class="comment">// 目标尺寸</span></span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">bool</span> keepVertexImageSize,  <span class="comment">// 是否保持1、3、7、9顶点图片大小不变，设置为true则与QSS方式效果类似（仅类似，因为该函数是直接返回原图）</span></span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">int</span> pos1Width, </span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">int</span> pos1Height, </span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">int</span> pos3Width, </span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="type">int</span> pos7Height, </span></span></span><br><span class="line"><span class="params"><span class="function">                        Qt::TransformationMode mode = Qt::SmoothTransformation)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 参数校准</span></span><br><span class="line">    pos1Width = <span class="built_in">qMax</span>(pos1Width, <span class="number">0</span>);</span><br><span class="line">    pos1Height = <span class="built_in">qMax</span>(pos1Height, <span class="number">0</span>);</span><br><span class="line">    pos3Width = <span class="built_in">qMax</span>(pos3Width, <span class="number">0</span>);</span><br><span class="line">    pos7Height = <span class="built_in">qMax</span>(pos7Height, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> handlePixW = <span class="number">0</span>, handlePixH = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> QPixmap* handlePix = <span class="literal">nullptr</span>;</span><br><span class="line">    QPixmap keepRatioScaledPix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keepVertexImageSize) &#123;</span><br><span class="line">        <span class="comment">// 保持顶点图片大小不变的情况，如果顶点图片宽或高已经大于了目标宽高，则直接返回原图</span></span><br><span class="line">        <span class="keyword">if</span> (pos1Width + pos3Width &gt; destSize.<span class="built_in">width</span>() || pos1Height + pos7Height &gt; destSize.<span class="built_in">height</span>())</span><br><span class="line">            <span class="keyword">return</span> src;</span><br><span class="line"></span><br><span class="line">        handlePixW = src.<span class="built_in">width</span>();</span><br><span class="line">        handlePixH = src.<span class="built_in">height</span>();</span><br><span class="line">        handlePix = &amp;src;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">const</span> qreal srcW = src.<span class="built_in">width</span>();</span><br><span class="line">        <span class="type">const</span> qreal srcH = src.<span class="built_in">height</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先等比缩放到适合的尺寸</span></span><br><span class="line">        keepRatioScaledPix = src.<span class="built_in">scaled</span>(destSize, Qt::KeepAspectRatio, mode);</span><br><span class="line">        handlePixW = keepRatioScaledPix.<span class="built_in">width</span>();</span><br><span class="line">        handlePixH = keepRatioScaledPix.<span class="built_in">height</span>();</span><br><span class="line">        qreal krsPixWidth = handlePixW;</span><br><span class="line">        qreal krsPixHeight = handlePixH;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按照之前的比例获取新顶点图片的大小</span></span><br><span class="line">        pos1Width = krsPixWidth * (qreal)pos1Width / srcW;</span><br><span class="line">        pos1Height = krsPixHeight * (qreal)pos1Height / srcH;</span><br><span class="line">        pos3Width = krsPixWidth * (qreal)pos3Width / srcW;</span><br><span class="line">        pos7Height = krsPixHeight * (qreal)pos7Height / srcH;</span><br><span class="line"></span><br><span class="line">        handlePix = &amp;keepRatioScaledPix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提前各个区域图片</span></span><br><span class="line">    QPixmap pix1 = handlePix-&gt;<span class="built_in">copy</span>(<span class="number">0</span>, <span class="number">0</span>, pos1Width, pos1Height);</span><br><span class="line">    QPixmap pix2 = handlePix-&gt;<span class="built_in">copy</span>(pos1Width, <span class="number">0</span>, <span class="built_in">qMax</span>(handlePixW - pos1Width - pos3Width, <span class="number">0</span>), pos1Height);</span><br><span class="line">    QPixmap pix3 = handlePix-&gt;<span class="built_in">copy</span>(<span class="built_in">qMax</span>(handlePixW - pos3Width, <span class="number">0</span>), <span class="number">0</span>, pos3Width, pos1Height);</span><br><span class="line">    QPixmap pix4 = handlePix-&gt;<span class="built_in">copy</span>(<span class="number">0</span>, pos1Height, pos1Width, <span class="built_in">qMax</span>(handlePixH - pos1Height - pos7Height, <span class="number">0</span>));</span><br><span class="line">    QPixmap pix5 = handlePix-&gt;<span class="built_in">copy</span>(pos1Width, pos1Height, <span class="built_in">qMax</span>(handlePixW - pos1Width - pos3Width, <span class="number">0</span>), <span class="built_in">qMax</span>(handlePixH - pos1Height - pos7Height, <span class="number">0</span>));</span><br><span class="line">    QPixmap pix6 = handlePix-&gt;<span class="built_in">copy</span>(<span class="built_in">qMax</span>(handlePixW - pos3Width, <span class="number">0</span>), pos1Height, pos3Width, <span class="built_in">qMax</span>(handlePixH - pos1Height - pos7Height, <span class="number">0</span>));</span><br><span class="line">    QPixmap pix7 = handlePix-&gt;<span class="built_in">copy</span>(<span class="number">0</span>, <span class="built_in">qMax</span>(handlePixH - pos7Height, <span class="number">0</span>), pos1Width, pos7Height);</span><br><span class="line">    QPixmap pix8 = handlePix-&gt;<span class="built_in">copy</span>(pos1Width, <span class="built_in">qMax</span>(handlePixH - pos7Height, <span class="number">0</span>), <span class="built_in">qMax</span>(handlePixW - pos1Width - pos3Width, <span class="number">0</span>), pos7Height);</span><br><span class="line">    QPixmap pix9 = handlePix-&gt;<span class="built_in">copy</span>(<span class="built_in">qMax</span>(handlePixW - pos3Width, <span class="number">0</span>), <span class="built_in">qMax</span>(handlePixH - pos7Height, <span class="number">0</span>), pos3Width, pos7Height);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对2、4、5、6、8区域图片进行缩放</span></span><br><span class="line">    pix2 = pix<span class="number">2.</span><span class="built_in">scaled</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos1Width - pos3Width, <span class="number">0</span>), pos1Height, Qt::IgnoreAspectRatio, mode);</span><br><span class="line">    pix4 = pix<span class="number">4.</span><span class="built_in">scaled</span>(pos1Width, <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos1Height - pos7Height, <span class="number">0</span>), Qt::IgnoreAspectRatio, mode);</span><br><span class="line">    pix5 = pix<span class="number">5.</span><span class="built_in">scaled</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos1Width - pos3Width, <span class="number">0</span>), <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos1Height - pos7Height, <span class="number">0</span>), Qt::IgnoreAspectRatio, mode);</span><br><span class="line">    pix6 = pix<span class="number">6.</span><span class="built_in">scaled</span>(pos3Width, <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos1Height - pos7Height, <span class="number">0</span>), Qt::IgnoreAspectRatio, mode);</span><br><span class="line">    pix8 = pix<span class="number">8.</span><span class="built_in">scaled</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos1Width - pos3Width, <span class="number">0</span>), pos7Height, Qt::IgnoreAspectRatio, mode);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拼接新的图片</span></span><br><span class="line">    <span class="function">QPixmap <span class="title">dest</span><span class="params">(destSize)</span></span>;</span><br><span class="line">    dest.<span class="built_in">fill</span>(Qt::transparent); <span class="comment">// 使用透明色填充图片</span></span><br><span class="line"></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(&amp;dest)</span></span>;</span><br><span class="line"></span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="number">0</span>, <span class="number">0</span>, pix1);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(pos1Width, <span class="number">0</span>, pix2);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos3Width, <span class="number">0</span>), <span class="number">0</span>, pix3);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="number">0</span>, pos1Height, pix4);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(pos1Width, pos1Height, pix5);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos3Width, <span class="number">0</span>), pos1Height, pix6);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="number">0</span>, <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos7Height, <span class="number">0</span>), pix7);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(pos1Width, <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos7Height, <span class="number">0</span>), pix8);</span><br><span class="line">    painter.<span class="built_in">drawPixmap</span>(<span class="built_in">qMax</span>(destSize.<span class="built_in">width</span>() - pos3Width, <span class="number">0</span>), <span class="built_in">qMax</span>(destSize.<span class="built_in">height</span>() - pos7Height, <span class="number">0</span>), pix9);</span><br><span class="line">    painter.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>jiangxueqiao.com
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://jiangxueqiao.com/post/2202762022.html" title="Qt开发路上的“绊脚石”与“垫脚石”">https://jiangxueqiao.com/post/2202762022.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/2711697202.html" rel="prev" title="Windbg调试入门">
                  <i class="fa fa-angle-left"></i> Windbg调试入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/581068365.html" rel="next" title="C++内存池实现">
                  C++内存池实现 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鄂ICP备2020015399号-6 </a>
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-rocket"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">jiangxueqiao.com</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">255k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">15:29</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"winsoft666","repo":"blog-comment","client_id":"Ov23libVrm4js5jotUI4","client_secret":"ab2e3a6d1daa72bfcb968ff049246f8df2ce8988","admin_user":"winsoft666","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"175d8eef37340e84a2479868d8a73570"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
