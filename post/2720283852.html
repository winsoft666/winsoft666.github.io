<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#177cb0"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.png" color="#177cb0">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiangxueqiao.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"right","width_expanded":300,"width_dual_column":260,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"vs2015"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":true,"height":300},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":true,"duration":200,"transition":{"menu_item":null,"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":null}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="为什么有些软件界面上的韩文会显示乱码？ ASCII 和 ANSI 有什么区别？ 相信不少人在字符编码上面摔过跟头，这篇文章针对开发中需要了解的字符编码知识进行讲解，希望帮助大家拨开字符编码的迷雾，从此告别乱码的困扰。">
<meta property="og:type" content="article">
<meta property="og:title" content="拨开字符编码的迷雾">
<meta property="og:url" content="https://jiangxueqiao.com/post/2720283852.html">
<meta property="og:site_name" content="独钓寒江雪">
<meta property="og:description" content="为什么有些软件界面上的韩文会显示乱码？ ASCII 和 ANSI 有什么区别？ 相信不少人在字符编码上面摔过跟头，这篇文章针对开发中需要了解的字符编码知识进行讲解，希望帮助大家拨开字符编码的迷雾，从此告别乱码的困扰。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MDA0NTIy">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MTI5ODIz">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MTM4NTUx">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/byqrhclzfbm-1.jpg">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/byqrhclzfbm-2.jpg">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/mysql-zfbm-1.jpg">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/mysql-zfbm-2.jpg">
<meta property="article:published_time" content="2017-11-27T12:46:23.000Z">
<meta property="article:modified_time" content="2025-12-09T03:01:05.326Z">
<meta property="article:author" content="jiangxueqiao.com">
<meta property="article:tag" content="字符编码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jiangxueqiao.com/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MDA0NTIy">


<link rel="canonical" href="https://jiangxueqiao.com/post/2720283852.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jiangxueqiao.com/post/2720283852.html","path":"post/2720283852.html","title":"拨开字符编码的迷雾"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>拨开字符编码的迷雾 | 独钓寒江雪</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?fbb46283a7b4d42d425356f8779708d5"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">独钓寒江雪</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">用C++的优雅，驯服Windows的狂野</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ASCII-%E5%8F%8A%E5%85%B6%E6%89%A9%E5%B1%95"><span class="nav-number">1.</span> <span class="nav-text">ASCII 及其扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-ASCII-%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">1.1.</span> <span class="nav-text">什么是 ASCII 字符集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ASCII-%E7%9A%84%E6%89%A9%E5%B1%95"><span class="nav-number">1.2.</span> <span class="nav-text">ASCII 的扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%9C%80%E9%AB%98%E4%BD%8D"><span class="nav-number">1.2.1.</span> <span class="nav-text">扩展最高位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%AD%97%E8%8A%82%E6%89%A9%E5%B1%95-GB-%E7%B3%BB%E5%88%97"><span class="nav-number">1.2.2.</span> <span class="nav-text">多字节扩展 - GB 系列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E8%A7%92%E4%B8%8E%E5%8D%8A%E8%A7%92"><span class="nav-number">1.2.3.</span> <span class="nav-text">全角与半角</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ANSI"><span class="nav-number">2.</span> <span class="nav-text">ANSI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ANSI-%E4%B8%8E%E4%BB%A3%E7%A0%81%E9%A1%B5"><span class="nav-number">2.1.</span> <span class="nav-text">ANSI 与代码页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E4%BB%A3%E7%A0%81%E9%A1%B5"><span class="nav-number">2.2.</span> <span class="nav-text">更改默认代码页</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#chcp-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.2.1.</span> <span class="nav-text">chcp 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF"><span class="nav-number">2.2.2.</span> <span class="nav-text">控制面板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="nav-number">2.2.3.</span> <span class="nav-text">代码修改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Unicode"><span class="nav-number">3.</span> <span class="nav-text">Unicode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Unicode-%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF"><span class="nav-number">3.1.</span> <span class="nav-text">Unicode 产生背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">3.2.</span> <span class="nav-text">字符集与字符编码的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UTF-16-%E7%BC%96%E7%A0%81%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="nav-number">3.3.</span> <span class="nav-text">UTF-16 编码的缺点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unicode-%E5%AD%97%E7%AC%A6%E9%9B%86%E5%B8%B8%E7%94%A8%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F%EF%BC%9AUTF-8"><span class="nav-number">3.4.</span> <span class="nav-text">Unicode 字符集常用编码方式：UTF-8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UTF-8-%E6%A6%82%E8%BF%B0"><span class="nav-number">3.4.1.</span> <span class="nav-text">UTF-8 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UTF-8-%E7%BC%96%E7%A0%81%E8%A7%84%E5%88%99"><span class="nav-number">3.4.2.</span> <span class="nav-text">UTF-8 编码规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UTF-8-BOM"><span class="nav-number">3.4.3.</span> <span class="nav-text">UTF-8 BOM</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81"><span class="nav-number">4.</span> <span class="nav-text">编译器处理文件编码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Visual-Studio-%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">4.1.</span> <span class="nav-text">Visual Studio 字符集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#char-%E5%92%8C-wchar-t"><span class="nav-number">4.2.</span> <span class="nav-text">char 和 wchar_t</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%99%A8%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%A1%AC%E7%BC%96%E7%A0%81%E5%AD%97%E7%AC%A6"><span class="nav-number">4.3.</span> <span class="nav-text">编译器如何处理硬编码字符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="nav-number">4.4.</span> <span class="nav-text">实例分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%BC%96%E8%AF%91%E5%99%A8%E5%A4%84%E7%90%86%E7%AA%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="nav-number">4.4.1.</span> <span class="nav-text">测试编译器处理窄字符编码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E4%BE%8B-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF%EF%BC%9F"><span class="nav-number">4.4.1.1.</span> <span class="nav-text">用例 3 为什么会编译错误？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%A8%E4%BE%8B-4-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BE%93%E5%87%BA%E7%9A%84D6-D0%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF3F%EF%BC%9F"><span class="nav-number">4.4.1.2.</span> <span class="nav-text">用例 4 为什么输出的D6 D0，而不是3F？</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%BC%96%E8%AF%91%E5%99%A8%E5%A4%84%E7%90%86%E5%AE%BD%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="nav-number">4.4.2.</span> <span class="nav-text">测试编译器处理宽字符编码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%A8%8B%E5%BA%8F%E5%BD%BB%E5%BA%95%E5%91%8A%E5%88%AB%E4%B9%B1%E7%A0%81"><span class="nav-number">4.5.</span> <span class="nav-text">使程序彻底告别乱码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">MySQL字符编码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%A0%A1%E5%AF%B9%E8%A7%84%E5%88%99"><span class="nav-number">5.1.</span> <span class="nav-text">MySQL 字符集和校对规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E5%90%84%E4%B8%AA%E7%BA%A7%E5%88%AB%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">5.2.</span> <span class="nav-text">MySQL 各个级别字符集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BA%A7%E5%88%AB%E5%AD%97%E7%AC%A6%E9%9B%86%E8%AE%BE%E7%BD%AE"><span class="nav-number">5.2.1.</span> <span class="nav-text">服务器级别字符集设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#utf8-%E4%B8%8E-utf8mb4-%E5%8C%BA%E5%88%AB"><span class="nav-number">5.3.</span> <span class="nav-text">utf8 与 utf8mb4 区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E5%AE%8C%E5%85%A8%E9%81%BF%E5%85%8D%E4%B9%B1%E7%A0%81"><span class="nav-number">5.4.</span> <span class="nav-text">MySQL完全避免乱码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Qt%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="nav-number">6.</span> <span class="nav-text">Qt字符编码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#QString-toLocal8Bit"><span class="nav-number">6.1.</span> <span class="nav-text">QString::toLocal8Bit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Qt%E7%A8%8B%E5%BA%8F%E5%91%8A%E5%88%AB%E4%B9%B1%E7%A0%81"><span class="nav-number">6.2.</span> <span class="nav-text">Qt程序告别乱码</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jiangxueqiao.com</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">167</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/winsoft666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;winsoft666" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:smart7178@163.com" title="E-Mail → mailto:smart7178@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://jiangxueqiao.com/online-tools" title="https:&#x2F;&#x2F;jiangxueqiao.com&#x2F;online-tools">在线工具</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/zoe" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;zoe" rel="noopener" target="_blank">跨平台文件下载库</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/veigar" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;veigar" rel="noopener" target="_blank">跨平台RPC库</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/QWebView" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;QWebView" rel="noopener" target="_blank">多浏览器内核Qt组件</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/vlc-qt2" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;vlc-qt2" rel="noopener" target="_blank">VLC内核Qt播放器组件</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/1key.run" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;1key.run" rel="noopener" target="_blank">仿Mac平台Alfred软件</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/qss-editor" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;qss-editor" rel="noopener" target="_blank">QSS编辑预览工具</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/WinSpyPlus" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;WinSpyPlus" rel="noopener" target="_blank">Spy++加强版</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/PortableStarter" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;PortableStarter" rel="noopener" target="_blank">便携式应用启动工具</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/electron-vue3-boilerplate" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;electron-vue3-boilerplate" rel="noopener" target="_blank">产品级的Electron模板</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/NSIS-UI-Plugin" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;NSIS-UI-Plugin" rel="noopener" target="_blank">NSIS界面插件</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://github.com/winsoft666/epub-image-localizer" title="https:&#x2F;&#x2F;github.com&#x2F;winsoft666&#x2F;epub-image-localizer" rel="noopener" target="_blank">本地化EPUB在线图片</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiangxueqiao.com/post/2720283852.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiangxueqiao.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="独钓寒江雪">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="拨开字符编码的迷雾 | 独钓寒江雪">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          拨开字符编码的迷雾
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-27 20:46:23" itemprop="dateCreated datePublished" datetime="2017-11-27T20:46:23+08:00">2017-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-09 11:01:05" itemprop="dateModified" datetime="2025-12-09T11:01:05+08:00">2025-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E2%91%A0%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">①编程基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>为什么有些软件界面上的韩文会显示乱码？</p>
<p>ASCII 和 ANSI 有什么区别？</p>
<p>相信不少人在字符编码上面摔过跟头，这篇文章针对开发中需要了解的字符编码知识进行讲解，希望帮助大家拨开字符编码的迷雾，从此告别乱码的困扰。</p>
<span id="more"></span>

<h1 id="ASCII-及其扩展"><a href="#ASCII-及其扩展" class="headerlink" title="ASCII 及其扩展"></a>ASCII 及其扩展</h1><h2 id="什么是-ASCII-字符集"><a href="#什么是-ASCII-字符集" class="headerlink" title="什么是 ASCII 字符集"></a>什么是 ASCII 字符集</h2><p>字符集就是一系列用于显示的字符的集合。</p>
<p>ASCII 字符集由美国国家标准协会（American National Standard Institute)于 1968 年制定一个字符映射集合。</p>
<p>ASCII 使用 7 位二进制位来表示一个字符，总共可以表示 128 个字符（即<code>2^7</code>，二进制<code>000 0000 ～ 111 1111</code>，十进制<code>0～127</code>）。</p>
<p>ASCII 字符集中每个数字对应一个唯一的字符，如下表：</p>
<table>
<thead>
<tr>
<th><strong>ASCII</strong></th>
<th>Hex</th>
<th>字符</th>
<th><strong>ASCII</strong></th>
<th>Hex</th>
<th>字符</th>
<th><strong>ASCII</strong></th>
<th>Hex</th>
<th>字符</th>
<th><strong>ASCII</strong></th>
<th>Hex</th>
<th>字符</th>
</tr>
</thead>
<tbody><tr>
<td><strong>0</strong></td>
<td>0x00</td>
<td>NUL</td>
<td><strong>1</strong></td>
<td>0x01</td>
<td>SOH</td>
<td><strong>2</strong></td>
<td>0x02</td>
<td>STX</td>
<td><strong>3</strong></td>
<td>0x03</td>
<td>ETX</td>
</tr>
<tr>
<td><strong>4</strong></td>
<td>0x04</td>
<td>EOT</td>
<td><strong>5</strong></td>
<td>0x05</td>
<td>ENQ</td>
<td><strong>6</strong></td>
<td>0x06</td>
<td>ACK</td>
<td><strong>7</strong></td>
<td>0x07</td>
<td>BEL</td>
</tr>
<tr>
<td><strong>8</strong></td>
<td>0x08</td>
<td>BS</td>
<td><strong>9</strong></td>
<td>0x09</td>
<td>HT</td>
<td><strong>10</strong></td>
<td>0x0A</td>
<td>LF</td>
<td><strong>11</strong></td>
<td>0x0B</td>
<td>VT</td>
</tr>
<tr>
<td><strong>12</strong></td>
<td>0x0C</td>
<td>FF</td>
<td><strong>13</strong></td>
<td>0x0D</td>
<td>CR</td>
<td><strong>14</strong></td>
<td>0x0E</td>
<td>SO</td>
<td><strong>15</strong></td>
<td>0x0F</td>
<td>SI</td>
</tr>
<tr>
<td><strong>16</strong></td>
<td>0x10</td>
<td>DLE</td>
<td><strong>17</strong></td>
<td>0x11</td>
<td>DC1</td>
<td><strong>18</strong></td>
<td>0x12</td>
<td>DC2</td>
<td><strong>19</strong></td>
<td>0x13</td>
<td>DC3</td>
</tr>
<tr>
<td><strong>20</strong></td>
<td>0x14</td>
<td>DC4</td>
<td><strong>21</strong></td>
<td>0x15</td>
<td>NAK</td>
<td><strong>22</strong></td>
<td>0x16</td>
<td>SYN</td>
<td><strong>23</strong></td>
<td>0x17</td>
<td>ETB</td>
</tr>
<tr>
<td><strong>24</strong></td>
<td>0x18</td>
<td>CAN</td>
<td><strong>25</strong></td>
<td>0x19</td>
<td>EM</td>
<td><strong>26</strong></td>
<td>0x1A</td>
<td>SUB</td>
<td><strong>27</strong></td>
<td>0x1B</td>
<td>ESC</td>
</tr>
<tr>
<td><strong>28</strong></td>
<td>0x1C</td>
<td>FS</td>
<td><strong>29</strong></td>
<td>0x1D</td>
<td>GS</td>
<td><strong>30</strong></td>
<td>0x1E</td>
<td>RS</td>
<td><strong>31</strong></td>
<td>0x1F</td>
<td>US</td>
</tr>
<tr>
<td><strong>32</strong></td>
<td>0x20</td>
<td>Space</td>
<td><strong>33</strong></td>
<td>0x21</td>
<td>!</td>
<td><strong>34</strong></td>
<td>0x22</td>
<td>“</td>
<td><strong>35</strong></td>
<td>0x23</td>
<td>#</td>
</tr>
<tr>
<td><strong>36</strong></td>
<td>0x24</td>
<td>$</td>
<td><strong>37</strong></td>
<td>0x25</td>
<td>%</td>
<td><strong>38</strong></td>
<td>0x26</td>
<td>&amp;</td>
<td><strong>39</strong></td>
<td>0x27</td>
<td>‘</td>
</tr>
<tr>
<td><strong>40</strong></td>
<td>0x28</td>
<td>(</td>
<td><strong>41</strong></td>
<td>0x29</td>
<td>)</td>
<td><strong>42</strong></td>
<td>0x2A</td>
<td>*</td>
<td><strong>43</strong></td>
<td>0x2B</td>
<td>+</td>
</tr>
<tr>
<td><strong>44</strong></td>
<td>0x2C</td>
<td>,</td>
<td><strong>45</strong></td>
<td>0x2D</td>
<td>-</td>
<td><strong>46</strong></td>
<td>0x2E</td>
<td>.</td>
<td><strong>47</strong></td>
<td>0x2F</td>
<td>&#x2F;</td>
</tr>
<tr>
<td><strong>48</strong></td>
<td>0x30</td>
<td>0</td>
<td><strong>49</strong></td>
<td>0x31</td>
<td>1</td>
<td><strong>50</strong></td>
<td>0x32</td>
<td>2</td>
<td><strong>51</strong></td>
<td>0x33</td>
<td>3</td>
</tr>
<tr>
<td><strong>52</strong></td>
<td>0x34</td>
<td>4</td>
<td><strong>53</strong></td>
<td>0x35</td>
<td>5</td>
<td><strong>54</strong></td>
<td>0x36</td>
<td>6</td>
<td><strong>55</strong></td>
<td>0x37</td>
<td>7</td>
</tr>
<tr>
<td><strong>56</strong></td>
<td>0x38</td>
<td>8</td>
<td><strong>57</strong></td>
<td>0x39</td>
<td>9</td>
<td><strong>58</strong></td>
<td>0x3A</td>
<td>:</td>
<td><strong>59</strong></td>
<td>0x3B</td>
<td>;</td>
</tr>
<tr>
<td><strong>60</strong></td>
<td>0x3C</td>
<td>&lt;</td>
<td><strong>61</strong></td>
<td>0x3D</td>
<td>&#x3D;</td>
<td><strong>62</strong></td>
<td>0x3E</td>
<td>&gt;</td>
<td><strong>63</strong></td>
<td>0x3F</td>
<td>?</td>
</tr>
<tr>
<td><strong>64</strong></td>
<td>0x40</td>
<td>@</td>
<td><strong>65</strong></td>
<td>0x41</td>
<td>A</td>
<td><strong>66</strong></td>
<td>0x42</td>
<td>B</td>
<td><strong>67</strong></td>
<td>0x43</td>
<td>C</td>
</tr>
<tr>
<td><strong>68</strong></td>
<td>0x44</td>
<td>D</td>
<td><strong>69</strong></td>
<td>0x45</td>
<td>E</td>
<td><strong>70</strong></td>
<td>0x46</td>
<td>F</td>
<td><strong>71</strong></td>
<td>0x47</td>
<td>G</td>
</tr>
<tr>
<td><strong>72</strong></td>
<td>0x48</td>
<td>H</td>
<td><strong>73</strong></td>
<td>0x49</td>
<td>I</td>
<td><strong>74</strong></td>
<td>0x4A</td>
<td>J</td>
<td><strong>75</strong></td>
<td>0x4B</td>
<td>K</td>
</tr>
<tr>
<td><strong>76</strong></td>
<td>0x4C</td>
<td>L</td>
<td><strong>77</strong></td>
<td>0x4D</td>
<td>M</td>
<td><strong>78</strong></td>
<td>0x4E</td>
<td>N</td>
<td><strong>79</strong></td>
<td>0x4F</td>
<td>O</td>
</tr>
<tr>
<td><strong>80</strong></td>
<td>0x50</td>
<td>P</td>
<td><strong>81</strong></td>
<td>0x51</td>
<td>Q</td>
<td><strong>82</strong></td>
<td>0x52</td>
<td>R</td>
<td><strong>83</strong></td>
<td>0x53</td>
<td>S</td>
</tr>
<tr>
<td><strong>84</strong></td>
<td>0x54</td>
<td>T</td>
<td><strong>85</strong></td>
<td>0x55</td>
<td>U</td>
<td><strong>86</strong></td>
<td>0x56</td>
<td>V</td>
<td><strong>87</strong></td>
<td>0x57</td>
<td>W</td>
</tr>
<tr>
<td><strong>88</strong></td>
<td>0x58</td>
<td>X</td>
<td><strong>89</strong></td>
<td>0x59</td>
<td>Y</td>
<td><strong>90</strong></td>
<td>0x5A</td>
<td>Z</td>
<td><strong>91</strong></td>
<td>0x5B</td>
<td>[</td>
</tr>
<tr>
<td><strong>92</strong></td>
<td>0x5C</td>
<td>\</td>
<td><strong>93</strong></td>
<td>0x5D</td>
<td>]</td>
<td><strong>94</strong></td>
<td>0x5E</td>
<td>^</td>
<td><strong>95</strong></td>
<td>0x5F</td>
<td>_</td>
</tr>
<tr>
<td><strong>96</strong></td>
<td>0x60</td>
<td>&#96;</td>
<td><strong>97</strong></td>
<td>0x61</td>
<td>a</td>
<td><strong>98</strong></td>
<td>0x62</td>
<td>b</td>
<td><strong>99</strong></td>
<td>0x63</td>
<td>c</td>
</tr>
<tr>
<td><strong>100</strong></td>
<td>0x64</td>
<td>d</td>
<td><strong>101</strong></td>
<td>0x65</td>
<td>e</td>
<td><strong>102</strong></td>
<td>0x66</td>
<td>f</td>
<td><strong>103</strong></td>
<td>0x67</td>
<td>g</td>
</tr>
<tr>
<td><strong>104</strong></td>
<td>0x68</td>
<td>h</td>
<td><strong>105</strong></td>
<td>0x69</td>
<td>i</td>
<td><strong>106</strong></td>
<td>0x6A</td>
<td>j</td>
<td><strong>107</strong></td>
<td>0x6B</td>
<td>k</td>
</tr>
<tr>
<td><strong>108</strong></td>
<td>0x6C</td>
<td>l</td>
<td><strong>109</strong></td>
<td>0x6D</td>
<td>m</td>
<td><strong>110</strong></td>
<td>0x6E</td>
<td>n</td>
<td><strong>111</strong></td>
<td>0x6F</td>
<td>o</td>
</tr>
<tr>
<td><strong>112</strong></td>
<td>0x70</td>
<td>p</td>
<td><strong>113</strong></td>
<td>0x71</td>
<td>q</td>
<td><strong>114</strong></td>
<td>0x72</td>
<td>r</td>
<td><strong>115</strong></td>
<td>0x73</td>
<td>s</td>
</tr>
<tr>
<td><strong>116</strong></td>
<td>0x74</td>
<td>t</td>
<td><strong>117</strong></td>
<td>0x75</td>
<td>u</td>
<td><strong>118</strong></td>
<td>0x76</td>
<td>v</td>
<td><strong>119</strong></td>
<td>0x77</td>
<td>w</td>
</tr>
<tr>
<td><strong>120</strong></td>
<td>0x78</td>
<td>x</td>
<td><strong>121</strong></td>
<td>0x79</td>
<td>y</td>
<td><strong>122</strong></td>
<td>0x7A</td>
<td>z</td>
<td><strong>123</strong></td>
<td>0x7B</td>
<td>{</td>
</tr>
<tr>
<td><strong>124</strong></td>
<td>0x7C</td>
<td>|</td>
<td><strong>125</strong></td>
<td>0x7D</td>
<td>}</td>
<td><strong>126</strong></td>
<td>0x7E</td>
<td>~</td>
<td><strong>127</strong></td>
<td>0x7F</td>
<td>DEL</td>
</tr>
</tbody></table>
<p>因为其对应关系非常简单，不需要特殊的编码规则，所以严格来讲 ASCII 不能算字符编码，因为它没有规定编码规则。我们只是习惯性的将 ASCII 字符集称之为 ASCII 码、ASCII 编码。</p>
<h2 id="ASCII-的扩展"><a href="#ASCII-的扩展" class="headerlink" title="ASCII 的扩展"></a>ASCII 的扩展</h2><h3 id="扩展最高位"><a href="#扩展最高位" class="headerlink" title="扩展最高位"></a>扩展最高位</h3><p>ASCII 字符集是美国人发明的，其中的字符完全是为其自己量身定制的。随着计算机技术普及到欧洲（如法国、德国）各国，欧洲很多国家使用的字符除了 ASCII 表中的 128 个字符之外，此时欧洲人民发现 ASCII 字符集不能完全表达他们所要表达的内容。<br><span style="color:#FFFFFF">&lt;原文出自: jiangxueqiao.com，请尊重原创&gt;</span><br>怎么办了？他们发现 ASCII 只使用了一个字节（8 位）之中的低 7 位，于是欧洲各国开始各显神通，打起了最高位（第 0 位）的主意，将最高位利用了起来，这样又多了 128 个字符，从而满足了欧洲人民的需要。</p>
<p>但因为每个国家的需求不一样，各国都设计了不同的方案。为了结束这种混乱的局面，国际标准化组织(ISO)及国际电工委员会(IEC)联合制定了<strong>一系列 8 位字符集</strong>的标准，统称为 ISO 8859（全称 ISO&#x2F;IEC 8859）。注意，这是一系列字符集的统称，如 ISO&#x2F;IEC 8859-1（也就是常听到的 Latin-1）支持西欧语言，ISO&#x2F;IEC 8859-4（Latin-4）支持北欧语言等。</p>
<p>完整列表如下（摘自百度百科）：<br>ISO&#x2F;IEC 8859-1 (Latin-1) - 西欧语言<br>ISO&#x2F;IEC 8859-2 (Latin-2) - 中欧语言<br>ISO&#x2F;IEC 8859-3 (Latin-3) - 南欧语言，世界语也可用此字符集显示。<br>ISO&#x2F;IEC 8859-4 (Latin-4) - 北欧语言<br>ISO&#x2F;IEC 8859-5 (Cyrillic) - 斯拉夫语言<br>ISO&#x2F;IEC 8859-6 (Arabic) - 阿拉伯语<br>ISO&#x2F;IEC 8859-7 (Greek) - 希腊语<br>ISO&#x2F;IEC 8859-8 (Hebrew) - 希伯来语(视觉顺序)<br>ISO 8859-8-I - 希伯来语(逻辑顺序)<br>ISO&#x2F;IEC 8859-9 (Latin-5 或 Turkish) - 它把 Latin-1 的冰岛语字母换走，加入土耳其语字母。<br>ISO&#x2F;IEC 8859-10 (Latin-6 或 Nordic) - 北日耳曼语支，用来代替 Latin-4。<br>ISO&#x2F;IEC 8859-11 (Thai) - 泰语，从泰国的 TIS620 标准字集演化而来。<br>ISO&#x2F;IEC 8859-13 (Latin-7 或 Baltic Rim) - 波罗的语族<br>ISO&#x2F;IEC 8859-14 (Latin-8 或 Celtic) - 凯尔特语族<br>ISO&#x2F;IEC 8859-15 (Latin-9) - 西欧语言，加入 Latin-1 欠缺的芬兰语字母和大写法语重音字母，以及欧元符号。<br>ISO&#x2F;IEC 8859-16 (Latin-10) - 东南欧语言。主要供罗马尼亚语使用，并加入欧元符号。</p>
<blockquote>
<p>我们在数据库或 Qt 中常见到的 Latin-1、2、5、7 其实就是上面提到的针对特定语言的 ASCII 扩展字符集。<br><img data-src="/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MDA0NTIy"></p>
</blockquote>
<h3 id="多字节扩展-GB-系列"><a href="#多字节扩展-GB-系列" class="headerlink" title="多字节扩展 - GB 系列"></a>多字节扩展 - GB 系列</h3><p>前面讲到了，欧洲各国有效利用闲置的最高位对 ASCII 字符集进行了扩展。可是欧洲人民没有想到在大洋彼岸有着一个拥有五千年历史的伟大民族，她拥有着成千上万的汉字，1 个字节显然不够表达如此深厚的文化底蕴。</p>
<p>于是当计算机引入到中国之初，国家技术监督局就设计了 GB 系列编码方案（GB 为 guo biao 的首字母缩写)。</p>
<p><strong>GB 编码方案使用 2 个字节来表达一个汉字。同时为了兼容 ASCII 编码，规定各个字节的最高位（首位）必须为 1，从而避免了和最高位为 0 的 ASCII 字符集的冲突。</strong></p>
<p>GB 系列字符集经历下面的几个发展过程：</p>
<table>
<thead>
<tr>
<th>编码名称</th>
<th>发布时间</th>
<th>字节数</th>
<th>汉字范围</th>
</tr>
</thead>
<tbody><tr>
<td>GB2312</td>
<td>1980 年</td>
<td>变字节（ASCII 1 字节，汉字 2 个字节）</td>
<td>6763 个汉字</td>
</tr>
<tr>
<td>GB13000</td>
<td>1993 年第一版</td>
<td>变字节（ASCII 1 字节，汉字 2 个字节）</td>
<td>20902 个汉字</td>
</tr>
<tr>
<td>GBK</td>
<td>Windows95 中</td>
<td>2 个字节</td>
<td>21886 个汉字和图形符号（含 GB2312，BIG5 中所有字符）</td>
</tr>
<tr>
<td>GB18030</td>
<td>2000 年第一版</td>
<td>变字节（ASCII 1 字节，汉字 2 个或 4 个字节）</td>
<td>27484 个汉字</td>
</tr>
</tbody></table>
<p>每一次迭代，支持的字符数量都会增加，而且每一次迭代都会保留之前版本支持的编码，所以做到了向上兼容。</p>
<h3 id="全角与半角"><a href="#全角与半角" class="headerlink" title="全角与半角"></a>全角与半角</h3><p>因为汉字在显示器上的显示宽度要比英文字符的宽度要宽一倍，在一起排版显示时不太美观。所以 GB 编码不仅仅加入了汉字字符，而且包括了 ASCII 字符集中本来就有的数字、标点符号、字母等字符。这些被编入 GB 编码中的数字、英文标点符号、字母在显示器上的显示宽度比 ASCII 字符集中的宽度宽一倍，所以前者称为全角字符，后者称为半角字符。</p>
<h1 id="ANSI"><a href="#ANSI" class="headerlink" title="ANSI"></a>ANSI</h1><h2 id="ANSI-与代码页"><a href="#ANSI-与代码页" class="headerlink" title="ANSI 与代码页"></a>ANSI 与代码页</h2><p>前面说到了世界各国针对 ASCII 的扩展方案（如欧洲的 ISO&#x2F;IEC 8859，中国的 GB 系列等），这些 ASCII 扩展编码方案的特点是：他们都兼容 ASCII 编码，但他们彼此之间是不兼容的。微软将这些编码方案统称为 ANSI 编码。故 ANSI 并不是特指某一种编码方案，只有知道了在哪个国家，哪个语言环境下，才知道它具体表示哪个编码方案。<br><span style="color:#FFFFFF">&lt;原文出自: jiangxueqiao.com，请尊重原创&gt;</span><br>在 Windows 操作系统上，默认使用 ANSI 来保存文件（但从 Windows 10 开始默认使用 UTF8 编码）。操作系统是如何知道 ANSI 到底应该表示哪种编码了，是 GBK 还是 ASCII，抑或还是 EUC-KR 了？ Windows 通过一个叫”Code Page”（翻译为中文叫代码页）的东西来判断系统的默认编码。</p>
<p>简体中文操作系统的代码页默认是 936，即 ANSI 使用的是 GBK 编码。</p>
<blockquote>
<p>GB18030 编码对应的 Windows 代码页为 CP54936。</p>
</blockquote>
<p>可以使用命令<code>chcp</code>来查看和修改系统默认的代码页。</p>
<p>汉字“𤭢”（念 suì）只包含在 GB18030 中，GB2312、GB13000、GBK 中均不包含。默认情况下，Visual Studio 会使用 CP936（即 GBK）来保存代码文件，如果在代码文件中输入该汉字，Visual Studio 弹出如下提示要求用户选择代码页：</p>
<p><img data-src="/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MTI5ODIz"><br><img data-src="/images/blog/aHR0cDovL2ltZy5ibG9nLmNzZG4ubmV0LzIwMTcxMTI3MjA1MTM4NTUx"></p>
<h2 id="更改默认代码页"><a href="#更改默认代码页" class="headerlink" title="更改默认代码页"></a>更改默认代码页</h2><h3 id="chcp-命令"><a href="#chcp-命令" class="headerlink" title="chcp 命令"></a>chcp 命令</h3><p>可以使用<code>chcp</code>命令来更改默认代码页，如<code>chcp 437</code>将默认代码页更改为 437（美国）。</p>
<h3 id="控制面板"><a href="#控制面板" class="headerlink" title="控制面板"></a>控制面板</h3><p>在“控制面板”–&gt;“区域和语言”–&gt; “更改系统区域设置”中更改系统默认的代码页为“中文（简体，中国）”。</p>
<h3 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h3><p>也可以通过代码更改默认的代码页：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">setlocale</span><span class="params">(</span></span><br><span class="line"><span class="params">   <span class="type">int</span> category,</span></span><br><span class="line"><span class="params">   <span class="type">const</span> <span class="type">char</span> *locale</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<h1 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h1><h2 id="Unicode-产生背景"><a href="#Unicode-产生背景" class="headerlink" title="Unicode 产生背景"></a>Unicode 产生背景</h2><p>各个国家使用不同的编码规则，虽然他们都是兼容 ASCII 的，但它们相互却是不兼容的。</p>
<p>试想法国人 Jack 写了一封名为”love_you.txt”的信，传给了他的德国朋友 Rose，Rose 想要在 windows 系统上打开这个文件，她需要知道德国使用的字符编码是 Latin-1，然后还要确保她的计算机上安装了该编码，才能顺利的打开这个文件。</p>
<p>如果上面这些还能忍受，那么随着网络的发展，你从互联网上获取的文件，你很有可能不知道它来自哪个国家，使用的哪种编码。这也就是 Email 刚诞生时常常出现乱码的原因，发信人和收信人使用的编码可能是不一样的。</p>
<p>于是<code>The Unicode Standard</code>（统一码标准）横空出世，它由 The Unicode Consortium 于 1991 年发布，我们习惯称它为 Unicode 字符集。<br><span style="color:#FFFFFF">&lt;原文出自: jiangxueqiao.com，请尊重原创&gt;</span><br>Unicode 字符集和 ASCII 字符集一样，也只是一个字符集合，标记着字符和数字之间的映射关系，它不包含任何编码规则和方案。和 ASCII 不一样的是，Unicode 字符集支持的字符数量是没有限制的（具体可以参考 Unicode 规范）。</p>
<blockquote>
<p>我们通常认为的 Unicode 字符固定占用 2 个字节的观点是错误的。如“𤭢”（念 suì）的 Unicode 码为<code>D852 DF62</code>。</p>
</blockquote>
<p>那么 Unicode 字符是怎样被编码成内存中的字节的呢？它是通过 UTF (Unicode Transformation Formats) 实现的，比较常见得有 UTF-8，UTF-16。</p>
<blockquote>
<p>在 Windows 系统上汉字默认使用 CP936（即 GBK 编码），占 2 个字节。而大多数 Unicode 字符的 Unicode 码值也占 2 个字节，所以大多数人误以为汉字字符串在内存中的值就是 Unicode 值，这是错误的。<br>可以从 <a target="_blank" rel="noopener" href="http://tool.chinaz.com/tools/unicode.aspx" title="站长工具">站长工具-Unicode</a> 查询汉字的 Unicode 码值。</p>
</blockquote>
<h2 id="字符集与字符编码的区别"><a href="#字符集与字符编码的区别" class="headerlink" title="字符集与字符编码的区别"></a>字符集与字符编码的区别</h2><p>从 ASCII、GB2312、GBK、GB18030、Big5（繁体中文）、Latin-1 等采用的方案来看，它们都只是定义了单个字符与二进制数据的映射关系，一个字符在一个方案中只会存在一种表示方式，所以我们说 GB2312 是字符集还是字符编码方式都无所谓了。但是 Unicode 不一样，Unicode 作为一个字符集可以采用多种编码方式，如 UTF-8, UTF-16, UTF-32 等。<strong>所以自 Unicode 出现之后，字符集与字符编码需要明确区分开来。</strong></p>
<h2 id="UTF-16-编码的缺点"><a href="#UTF-16-编码的缺点" class="headerlink" title="UTF-16 编码的缺点"></a>UTF-16 编码的缺点</h2><p>UTF-16 编码方式规定用两个或四个字节来表示所有的字符。对于 ASCII 字符保持不变，只是将原来的 7 位扩展到了 16 位，其高 9 位永远是 0。</p>
<p>如字符’A’：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ASCII:  0100 0001</span><br><span class="line">UTF-16: 0000 0000 0100 0001</span><br></pre></td></tr></table></figure>

<p>从上面可以看到，对于 ASCII 字符，UTF-16 的存储空间扩大了一倍，因此 UTF-16 并不是完全兼容 ASCII 字符集的。这对于那些 ASCII 字符集已经满足需求的西方国家来说完全是没必要的，而且 ASCII 字符经过 UTF-16 编码之后高字节始终是 0，还会导致很多 C 语言函数（如<code>strcpy</code>,<code>strlen</code>）将此字节视为字符串的结束符<code>&#39;\0&#39;</code>，从而出现错误的计算结果。</p>
<p>而且，UTF-16 还存在大小端的问题，“𤭢”（念 suì）Unicode 码在大端系统上为<code>D852 DF62</code>，小端系统上为<code>52D8 62DF</code>。</p>
<p>因此，UTF-16 一开始推出的时候就遭到很多西方国家的抵制，影响了 Unicode 的推行。于是后来又设计了 UTF-8 编码方式，才解决了这些问题。</p>
<h2 id="Unicode-字符集常用编码方式：UTF-8"><a href="#Unicode-字符集常用编码方式：UTF-8" class="headerlink" title="Unicode 字符集常用编码方式：UTF-8"></a>Unicode 字符集常用编码方式：UTF-8</h2><h3 id="UTF-8-概述"><a href="#UTF-8-概述" class="headerlink" title="UTF-8 概述"></a>UTF-8 概述</h3><p>UTF-8 是互联网上使用最广泛的 Unicode 字符集编码方式。UTF-8 编码的最小单位由 8 位（1 个字节）组成，UTF-8 使用一个至四个字节来表示 Unicode 字符。另外，UTF-8 是完美兼容 ASCII 字符集的，这一点可以通过下面的 UTF-8 的编码规则得到证明。</p>
<h3 id="UTF-8-编码规则"><a href="#UTF-8-编码规则" class="headerlink" title="UTF-8 编码规则"></a>UTF-8 编码规则</h3><p>UTF-8 编码规则很简单：<br>（1）对于 ASCII（单字节字符）字符，采用和 ASCII 相同的编码方式，即只使用一个字节表示，且该字节第一位为 0.<br>（2）对于多字节（2~4 字节）字符，假设字节数为 n（1 &lt; n &lt;&#x3D; 4），第一个字节：前 n 位都设为 1，第 n+1 位设为 0；后面的 n-1 个字节的前两位一律设为 10。所有字节中的没有提及的其他二进制位，全部为这个符号的 Unicode 码。按照这个规则，程序通过第一个字节中1的个数就可以知道当前字符编码所占的位数。</p>
<table>
<thead>
<tr>
<th>Unicode 符号范围(十六进制)</th>
<th>UTF-8 编码方式(二进制)</th>
</tr>
</thead>
<tbody><tr>
<td>单字节:00000000-0000 007F</td>
<td>0xxxxxxx</td>
</tr>
<tr>
<td>双字节:00000080-0000 07FF</td>
<td>110xxxxx 10xxxxxx</td>
</tr>
<tr>
<td>三字节:00000800-0000 FFFF</td>
<td>1110xxxx 10xxxxxx 10xxxxxx</td>
</tr>
<tr>
<td>四字节:0001 0000-0010 FFFF</td>
<td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td>
</tr>
</tbody></table>
<h3 id="UTF-8-BOM"><a href="#UTF-8-BOM" class="headerlink" title="UTF-8 BOM"></a>UTF-8 BOM</h3><p>BOM（byte order mark）从字面意义来看是标记字节顺序的。最早出现的原因是因为 UTF-16 和 UTF-32 编码采用 2 个或 4 个字节表示一个字符，面临大小端的问题。为了区分是使用的大端(Big Endian，简称 BE)还是小端(Little Endian，简称 LE)，采用了在串的前面加入指定的字节加以区分，UTF-16 大端加入<code>FE FF</code>，小端加入<code>FF FE</code>. 比如， 字符串“ABC”的 UTF-16 编码为 <code>00 41 00 42 00 43</code>，对应的各种的字节序列如下：</p>
<table>
<thead>
<tr>
<th>序列</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td>UTF-16BE (without BOM)</td>
<td>00 41 00 42 00 43</td>
</tr>
<tr>
<td>UTF-16LE (without BOM)</td>
<td>41 00 42 00 43 00</td>
</tr>
<tr>
<td>UTF-16BE (with BOM)</td>
<td>FE FF 00 41 00 42 00 43</td>
</tr>
<tr>
<td>UTF-16LE (with BOM)</td>
<td>FF FE 41 00 42 00 43 00</td>
</tr>
</tbody></table>
<p>因为 UTF-8 和 ASCII 扩展字符集都是单字节序列，二者不好区分，微软采用在 UTF-8 编码的字符串前也加入 BOM（3 个字节<code>EF BB BF</code>）来标记 UTF-8 编码的串。UTF-8 BOM 这一规范大多在 Windows 下被使用，在其他平台下用的很少使用，如 Linux 全部采用 UTF-8 编码，不存在需要区分的情况；HTTP 协议可以通过 <code>Content-Type:text/html; charset=utf-8</code> 来指定当前使用 UTF8 编码，也没有区分的需求。</p>
<h1 id="编译器处理文件编码"><a href="#编译器处理文件编码" class="headerlink" title="编译器处理文件编码"></a>编译器处理文件编码</h1><h2 id="Visual-Studio-字符集"><a href="#Visual-Studio-字符集" class="headerlink" title="Visual Studio 字符集"></a>Visual Studio 字符集</h2><p>虽然使用 Visual Studio 创建的 C++工程可以在工程属性<code>配置属性--&gt;常规</code>中配置字符集：<code>使用Unicode字符集</code>（默认）、<code>使用多字节字符集</code>。</p>
<p>如图：<br><img data-src="/images/blog/byqrhclzfbm-1.jpg"></p>
<p>但<strong>这个设置项并不会对编译器处理字符编码产生直接的影响</strong>（注意这里的“直接”二字，第 3 节会说到），只会在工程属性<code>配置属性--&gt;C/C++--&gt;预处理器</code>加入相应的宏：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用Unicode字符集 --&gt; _UNICODE和UNICODE宏</span><br><span class="line">使用多字节字符集   --&gt; _MBCS宏</span><br></pre></td></tr></table></figure>

<p>这几个宏一般用来判断是使用 char 还是 wchar_t，在系统 API 中使用比较多，如 MessegeBox 通过判断是否定义了 UNICODE 宏来决定是使用 LPCSTR 还是 LPCWSTR（LPCSTR 即 const char*, LPCWSTR 即 const wchar_t*）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MessageBox  MessageBoxW</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MessageBox  MessageBoxA</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// !UNICODE</span></span></span><br></pre></td></tr></table></figure>

<h2 id="char-和-wchar-t"><a href="#char-和-wchar-t" class="headerlink" title="char 和 wchar_t"></a>char 和 wchar_t</h2><p>上面提到了，定义 API 时通过 UNICODE 宏来决定是使用 char 还是 wchar_t 类型，那么 char 和 wchar_t 有什么不同了？</p>
<p>char 和 wchar_t 是标准 C&#x2F;C++字符类型，并不是 Windows 特有的。 char 固定占 1 个字节，wchar_t 固定占 2 个字节，从内存的角度来看，char、wchar_t 和其他数据类型一样，只是代表一段内存块，用来存储固定长度的二进制 0 或 1。 在编程时，我们一般习惯于将字符串储到 char 或 wchar_t 定义的内存空间中，将整形存储在 int 定义的内存空间中。</p>
<p>所以，用 char 还是 wchar_t 来存储字符，只是内存分配和数据存储上面的事情，<strong>它们本身也是与字符编码无直接关系的</strong>（ 同样注意这里的“直接”二字，第 3 节会说到）。</p>
<h2 id="编译器如何处理硬编码字符"><a href="#编译器如何处理硬编码字符" class="headerlink" title="编译器如何处理硬编码字符"></a>编译器如何处理硬编码字符</h2><p>MSVC 编译器编译源代码的步骤中，涉及编码处理的步骤主要有 2 个：</p>
<p>第 1 步：预处理</p>
<p>1.1) 读取源文件，判断源文件采用的字符编码类型。(<strong>这一步不会改变文件内容</strong>)</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">编译器判断源文件编码类型的步骤为：</span><br><span class="line">1. 若文件开始处有BOM (EF BB BF)，则判定为 UTF-8 编码；</span><br><span class="line">2. 若没有BOM，则试图从文件的前 8 个字节来判断文件是否像 UTF-16 编码，如果像，则就判断为 UTF-16 编码。</span><br><span class="line">3. 如果既没BOM，也不是UTF-16编码，则使用系统当前的代码页（简体中文操作系统为CP936）。</span><br></pre></td></tr></table></figure>

<p>1.2) 将源文件内容转成<code>源字符集</code>(Source Character Set)，默认为 UTF-8 编码。</p>
<p>第 2 步：链接</p>
<p>2.1) 将 1.2 中得到的 UTF-8 转为<code>执行字符集</code>(Execution Character Set)：</p>
<ul>
<li>对于宽字符串（wchar_t类型），执行字符集为 UTF-16 编码。</li>
<li>对于窄字符串（char类型），执行字符集为系统当前的代码页。</li>
</ul>
<p><img data-src="/images/blog/byqrhclzfbm-2.jpg"></p>
<p>到现在我们彻底明白了 Visual Studio 字符集设置、char、wchar*t 是如何***间接_**影响到编译器对字符编码的处理了：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Visual Studio字符集设置</span><br><span class="line">      |</span><br><span class="line">决定声明哪一个宏（UNICODE还是_MBCS宏）</span><br><span class="line">      |</span><br><span class="line">宏又决定了API参数使用char还是wchar_t</span><br><span class="line">      |</span><br><span class="line">编译器在进行【执行字符集】编码时对char和wchar_采用不同的处理方式，从而对字符编码产生了影响。</span><br></pre></td></tr></table></figure>

<p>在 Visual Studio 2010（含）之后，可以在代码中使用<code>#pragma execution_character_set</code>来设置执行字符集：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行字符集设置为utf8</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>也可以在Visual Studio项目属性中（“配置属性”&gt;“C&#x2F;C++”&gt;“命令行”）中，通过<code>/source-charset:utf-8</code> 和 <code>/execution-charset:utf-8</code> 来分别设置源字符集和可执行字符集为utf-8。</p>
<h2 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h2><p>已知汉字“中”的各种编码如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GBK        D6 D0</span><br><span class="line">Unicode    2D 4E</span><br><span class="line">UTF-8      E4 B8 AD</span><br></pre></td></tr></table></figure>

<p>函数<code>DumpCharacterCode</code>用于按字节打印内存中的数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DumpCharacterCode</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* pChar, <span class="type">int</span> iSize)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; iSize; i++) &#123;</span><br><span class="line">		<span class="type">char</span> a = *pChar++;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02X &quot;</span>, a &amp; <span class="number">0xff</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置系统代码页的方法： “控制面板” –&gt; “区域和语言” –&gt; “管理” –&gt; “非 Unicode 程序的语言” –&gt; “更改系统区域设置”。</p>
<p>Visual Studio 保存文件到指定编码方法：“文件” –&gt; “高级保存选项”。</p>
<h3 id="测试编译器处理窄字符编码"><a href="#测试编译器处理窄字符编码" class="headerlink" title="测试编译器处理窄字符编码"></a>测试编译器处理窄字符编码</h3><p>测试代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">100</span>] = &#123;<span class="string">&quot;中&quot;</span>&#125;;   <span class="comment">// char</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DumpCharacterCode</span>(buf, <span class="number">2</span>);  <span class="comment">// 也可以打印4个字节</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>针对不同的系统代码页和源文件编码，打印出的汉字“中”的编码分别为：</p>
<table>
<thead>
<tr>
<th>测试用例</th>
<th>系统代码页</th>
<th>保存源文件编码</th>
<th>编译器判断文件采用的编码</th>
<th>源字符集(Source Character Set)</th>
<th>执行字符集(Execution Character Set)</th>
<th>打印输出</th>
</tr>
</thead>
<tbody><tr>
<td>用例 1</td>
<td>简体中文 CP936</td>
<td>简体中文 CP936</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>简体中文 CP936</td>
<td>D6 D0</td>
</tr>
<tr>
<td>用例 2</td>
<td>简体中文 CP936</td>
<td>UTF-8 BOM</td>
<td>UTF-8 BOM</td>
<td>UTF-8</td>
<td>简体中文 CP936</td>
<td>D6 D0</td>
</tr>
<tr>
<td>用例 3</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>简体中文 CP936</td>
<td>编译错误(C2146)</td>
</tr>
<tr>
<td>用例 4</td>
<td>西欧 CP1252</td>
<td>简体中文 CP936</td>
<td>西欧 CP1252</td>
<td>UTF-8</td>
<td>西欧 CP1252</td>
<td>D6 D0</td>
</tr>
<tr>
<td>用例 5</td>
<td>西欧 CP1252</td>
<td>UTF-8 BOM</td>
<td>UTF-8 BOM</td>
<td>UTF-8</td>
<td>西欧 CP1252</td>
<td>3F 00</td>
</tr>
</tbody></table>
<p>表格中列 4~6 依次对应编译处理源文件的几个步骤。<br><code>3F</code>对应的 ASCII 字符为<code>?</code>，编译器遇到不能识别的字符时，就会用<code>?</code>来替代。 出现<code>?</code>的情况会伴随着编译警告<code>C4566</code>。<br>上面出现了 1 次<code>3F</code>（用例 5），导致乱码的原因是<code>UTF-8 --&gt; 西欧 CP1252</code>. <code>西欧 CP1252</code>也就是 ASCII 的扩展，不支持汉字，所以用<code>3F</code>替代。</p>
<h4 id="用例-3-为什么会编译错误？"><a href="#用例-3-为什么会编译错误？" class="headerlink" title="用例 3 为什么会编译错误？"></a>用例 3 为什么会编译错误？</h4><p>微软的编译器只能识别带 BOM 的 UTF-8，用例 3 的 UTF-8 没带 BOM，编译器会判定源文件编码为系统当前代码页 CP936。“中”的 UTF-8 编码为<code>E4 B8 AD</code>，列 5 执行从 CP936 到 UTF-8 转换之后变成了<code>E6 B6 93 3F</code>，列 6 再要将<code>E6 B6 93 3F</code>转换为 CP936 肯定是转换不回去的，相当于 UTF-8（1） –&gt; UTF-8 （2），再将 UTF-8（2）转换回 CP936，这时肯定得到的字符不是原来的字符了。</p>
<h4 id="用例-4-为什么输出的D6-D0，而不是3F？"><a href="#用例-4-为什么输出的D6-D0，而不是3F？" class="headerlink" title="用例 4 为什么输出的D6 D0，而不是3F？"></a>用例 4 为什么输出的<code>D6 D0</code>，而不是<code>3F</code>？</h4><p>对着用例 4 的各个顺序来看，源文件通过 CP936 保存着，但编译器通过 CP1252 来读取的，CP1252 就是 ASCII 扩展，单字节的，虽然此时显示为乱码，但各字节仍然是 D6 D0；然后将读取到的文件内容从 CP1252 转成 UTF-8 编码，转码后为 C3 96 C3 90；然后再将 UTF-8 编码转回为 CP1251，转码就又变成了 D6 D0。 但这个<code>D6 D0</code>在 CP1252 中是无法显示的，如果我们在用例 4 加入<code>MessageBoxA(NULL, &quot;中&quot;, &quot;test&quot;, MB_OK);</code> 会发现弹出的对话框中显示仍然是乱码。<br>可以使用下面的代码进行测试：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">3</span>] = &#123; <span class="number">0</span> &#125;;    <span class="comment">// 模拟CP936编码的“中”</span></span><br><span class="line">	buf[<span class="number">0</span>] = <span class="number">0xD6</span>;</span><br><span class="line">	buf[<span class="number">1</span>] = <span class="number">0xD0</span>;</span><br><span class="line"></span><br><span class="line">	std::string strUTF8 = <span class="built_in">ANSIToUTF8</span>(buf, <span class="number">1252</span>);</span><br><span class="line">	<span class="type">char</span> *p = (<span class="type">char</span>*)strUTF<span class="number">8.</span><span class="built_in">c_str</span>();  <span class="comment">// 通过visual studio查看指针p处内存为： C3 96 C3 90</span></span><br><span class="line"></span><br><span class="line">	std::string str = <span class="built_in">UTF8ToANSI</span>(strUTF8, <span class="number">1252</span>);</span><br><span class="line">	p = (<span class="type">char</span>*)str.<span class="built_in">c_str</span>();   <span class="comment">// 通过visual studio查看指针p处内存为： D6 D0</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试编译器处理宽字符编码"><a href="#测试编译器处理宽字符编码" class="headerlink" title="测试编译器处理宽字符编码"></a>测试编译器处理宽字符编码</h3><p>测试代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _tmain(<span class="type">int</span> argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">wchar_t</span> buf[<span class="number">100</span>] = &#123;<span class="string">L&quot;中&quot;</span>&#125;;   <span class="comment">// wchar_t</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DumpCharacterCode</span>((<span class="type">char</span>*)buf, <span class="number">4</span>); <span class="comment">// 打印4个字节</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样，针对不同的系统代码页和源文件编码，打印出的汉字“中”的编码分别为：</p>
<table>
<thead>
<tr>
<th>测试用例</th>
<th>系统代码页</th>
<th>保存源文件编码</th>
<th>编译器判断文件采用的编码</th>
<th>源字符集(Source Character Set)</th>
<th>执行字符集(Execution Character Set)</th>
<th>打印输出</th>
</tr>
</thead>
<tbody><tr>
<td>用例 1</td>
<td>简体中文 CP936</td>
<td>简体中文 CP936</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>UTF-16</td>
<td>2D 4E 00 00</td>
</tr>
<tr>
<td>用例 2</td>
<td>简体中文 CP936</td>
<td>UTF-8 BOM</td>
<td>UTF-8 BOM</td>
<td>UTF-8</td>
<td>UTF-16</td>
<td>2D 4E 00 00</td>
</tr>
<tr>
<td>用例 3</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>简体中文 CP936</td>
<td>UTF-8</td>
<td>UTF-16</td>
<td>编译错误(C2146)</td>
</tr>
<tr>
<td>用例 4</td>
<td>西欧 CP1252</td>
<td>简体中文 CP936</td>
<td>西欧 CP1252</td>
<td>UTF-8</td>
<td>UTF-16</td>
<td>D6 00 D0 00 <strong>大小端</strong></td>
</tr>
<tr>
<td>用例 5</td>
<td>西欧 CP1252</td>
<td>UTF-8 BOM</td>
<td>UTF-8 BOM</td>
<td>UTF-8</td>
<td>UTF-16</td>
<td>2D 4E 00 00</td>
</tr>
</tbody></table>
<h2 id="使程序彻底告别乱码"><a href="#使程序彻底告别乱码" class="headerlink" title="使程序彻底告别乱码"></a>使程序彻底告别乱码</h2><p>要开发支持多语言，在任意语言（系统代码页）的 windows 环境下都正常编译，且运行起来没有乱码的程序，需要遵循如下原则：</p>
<ol>
<li>代码文件采用 UTF-8 with BOM 编码。</li>
<li>Visual Studio 字符集设置为 Unicode 字符集。</li>
<li>使用 wchar_t。</li>
</ol>
<p>做到上面 3 步，你的代码被别人从 github 上 clone 下来编译，不会因为你代码中含有中文等字符，产生类似<code>error C2015</code>这样的编译错误，更不会产生乱码。</p>
<blockquote>
<p>本文介绍的方法只用来解决硬编码字符乱码的问题，至于数据传输中的乱码，需要统一字符编码来解决。</p>
</blockquote>
<blockquote>
<p>参考: <a target="_blank" rel="noopener" href="https://blogs.msdn.microsoft.com/vcblog/2016/02/22/new-options-for-managing-character-sets-in-the-microsoft-cc-compiler">https://blogs.msdn.microsoft.com/vcblog/2016/02/22/new-options-for-managing-character-sets-in-the-microsoft-cc-compiler</a></p>
</blockquote>
<h1 id="MySQL字符编码"><a href="#MySQL字符编码" class="headerlink" title="MySQL字符编码"></a>MySQL字符编码</h1><h2 id="MySQL-字符集和校对规则"><a href="#MySQL-字符集和校对规则" class="headerlink" title="MySQL 字符集和校对规则"></a>MySQL 字符集和校对规则</h2><p>MySQL 的字符集是用来定义 MySQL 存储字符串的方式，校对规则（有的软件叫排序规则）则是用来定义了比较字符串的方式。</p>
<p>字符集和校对规则是一对多的关系。每种字符集都有一个默认校对规则。</p>
<p><strong>查看数据库支持的字符集:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 方法<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CHARACTER SET</span>;</span><br><span class="line"></span><br><span class="line"># 方法<span class="number">2</span>：</span><br><span class="line">USE information_schema;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> CHARACTER_SETS;</span><br></pre></td></tr></table></figure>

<p><strong>查看数据库支持的校对规则：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 方法<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span>;</span><br><span class="line"></span><br><span class="line"># 方法<span class="number">2</span>：</span><br><span class="line">USE information_schema;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> collations;</span><br></pre></td></tr></table></figure>

<h2 id="MySQL-各个级别字符集"><a href="#MySQL-各个级别字符集" class="headerlink" title="MySQL 各个级别字符集"></a>MySQL 各个级别字符集</h2><p>MySQL 可以对如下字符集进行设置：</p>
<ul>
<li>服务器级字符集（CHARACTER_SET_SERVER）</li>
<li>数据库级字符集（CHARACTER_SET_DATABASE）</li>
<li>表级字符集</li>
<li>字段级字符集</li>
<li>连接字符集（CHARACTER_SET_CONNECTION），客户端连接数据库所用的字符集。</li>
<li>结果字符集（CHARACTER_SET_RESULTS），存储查询结果（含错误信息）所用的字符集。</li>
<li>客户端字符集（CHARACTER_SET_CLIENT），客户端发送给 MySQL 服务器的查询语句字符集。</li>
<li>系统字符集（CHARACTER_SET_SYSTEM），用于存储我们新建的或自带的数据库的表、列的名称，默认是 UTF-8。</li>
</ul>
<p><code>服务器级、数据库级、表级、字段级</code> 这 4 个字符集设置影响到数据库中存储数据的编码。 这 4 个级别的字符集继承关系为：<code>服务器级 --&gt; 数据库级 --&gt; 表级 --&gt; 字段级</code>, 从左到右，一级继承一级，和 C++、Java 中的类的继承类似，如果某一级未显式的指定字符集，那么将继承上一级的字符集设置。</p>
<h3 id="服务器级别字符集设置"><a href="#服务器级别字符集设置" class="headerlink" title="服务器级别字符集设置"></a>服务器级别字符集设置</h3><p>服务器级别的字符集可以从下面几个地方指定，从上到下优先级依次增加：</p>
<ul>
<li>编译 MySQL 时指定的字符集</li>
<li>my.cnf 配置文件设置 character-set-server</li>
<li>mysqld 服务启动命令行中指定字符集</li>
</ul>
<p>影响数据存储的字符集之间的关系：<br><img data-src="/images/blog/mysql-zfbm-1.jpg"></p>
<p><strong>查看当前数据库的字符集设置：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 方法<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%character%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 方法<span class="number">2</span>：</span><br><span class="line">USE information_schema;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> GLOBAL_VARIABLES <span class="keyword">WHERE</span> VARIABLE_NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%character%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="utf8-与-utf8mb4-区别"><a href="#utf8-与-utf8mb4-区别" class="headerlink" title="utf8 与 utf8mb4 区别"></a>utf8 与 utf8mb4 区别</h2><p>UTF-8 是多字节编码方案，采用 1~4 个字节来存储一个字符，但在 MySQL 设计之初，一个字符最多采用 3 个字节的就可以存储，所以 Mysql 的设计者将 MySQL 中的 UTF-8 字符集（UTF-8 其实不是字符集，是字符编码方案，但在 MySQL 中一直这么叫）设计成了最大长度只能为 3. 如图：<br><img data-src="/images/blog/mysql-zfbm-2.jpg"></p>
<p>但随着 Unicode 字符集的扩张，出现了需要 4 个字节才能存储的字符，如果这时仍然使用 utf-8（指 mysql 中的 3 字节 utf-8）来存储这些字符就会出现错误，<br>如执行<code>INSERT INTO member(memberName)VALUES(&#39;𤭢&#39;)</code>报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Warning Code : 1366</span><br><span class="line">Incorrect string value: &#x27;\xF0\xA4\xAD\xA2&#x27; for column &#x27;memberName&#x27; at row 1</span><br></pre></td></tr></table></figure>

<p>于是 MySQL 后来新增了 utf8mb4 字符集，最大长度为 4，兼容之前的 utf8，但为了之前的数据库不报错，仍然保留了之前的 utf8 字符集。 所以 MySQL 中的 UTF-8 字符集是伪 UTF-8，现在需要使用 utf8mb4。</p>
<h2 id="MySQL完全避免乱码"><a href="#MySQL完全避免乱码" class="headerlink" title="MySQL完全避免乱码"></a>MySQL完全避免乱码</h2><p>要完全避免字符乱码，最简单也是最好的方法就是将各个字符集保持一致，可以都设置为 utf8mb4。</p>
<p>Mysql 数据存储所涉及到的 4 个字符集的设置可以使用第二节的方法进行设置，客户端字符集、连接字符集，结果字符集关系到数据显示的正确性，可以使用如下语句统一设置为 utf8mb4，但这个设置只针对当前连接有效：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> names utf8mb4;</span><br></pre></td></tr></table></figure>

<p>编程开发中，一般使用 MySQL API 进行数据连接、查询等操作，可以使用<code>mysql_set_character_set</code>对每个连接进行设置，这个 API 会将客户端字符集、连接字符集，结果字符集都设置为指定字符集，代码大致如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MYSQL* pMysql = <span class="literal">NULL</span>;</span><br><span class="line"><span class="built_in">mysql_real_connect</span>(pMysql, szHost, szUser, szPwd, szDatabase, iPort, <span class="literal">NULL</span>, CLIENT_MULTI_STATEMENTS);</span><br><span class="line"><span class="built_in">mysql_set_character_set</span>(pMysql, <span class="string">&quot;utf8mb4&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="Qt字符编码"><a href="#Qt字符编码" class="headerlink" title="Qt字符编码"></a>Qt字符编码</h1><p>我们以<code>“测试字符串-보고싶다-Test String.”</code>这个字符串来进行讲解，它包含了英文、中文和韩文。<br>因为我使用 Qt 的方式是<code>Visual Studio + Qt库</code>的形式，所以本文以 MSVC 编译器为例来进行说明，但这种方式的原理也适用于其他编译器。</p>
<p><strong>QString 中使用 QChar 来存储每一个字符，QChar 是 short 类型，占 2 个字节，默认按 Unicode 编码存储。</strong></p>
<p>首先，为了保证写到代码文件中的测试字符串能被 MSVC 编译器理解，我们需要将源文件保存为<code>Utf8-带签名</code>的格式。</p>
<p>解决 Qt 程序乱码问题的关键在于理解QString中存储字符的编码格式。</p>
<p><strong>QString 中存储的字符串的编码格式就是“编译器执行字符集编码格式”。</strong> 这一句话很关键。</p>
<p>在 MSVC 中我们可以使用<code>#pragma execution_character_set(&quot;utf-8&quot;)</code>来指定该源文件的执行字符集编码格式为 UTF8 格式，这样 QString 中存储的字符串格式就是 utf8 编码了。</p>
<p>下面是完整的测试用例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Demo01::qStringUseCase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	该源文件使用Utf8-BOM格式保存.</span></span><br><span class="line"><span class="comment">	源字符集为UTF8-BOM.</span></span><br><span class="line"><span class="comment">	可执行字符集为UTF8：#pragma execution_character_set(&quot;utf-8&quot;) 定义在stdafx.h.</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEST_STR_A <span class="string">&quot;测试字符串-보고싶다-Test String.&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEST_STR_W <span class="string">L&quot;测试字符串-보고싶다-Test String.&quot;</span></span></span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 因为可执行字符集是utf8，所以使用OutputDebugStringA需要转换成ANSI</span></span><br><span class="line">		<span class="built_in">OutputDebugStringA</span>(<span class="built_in">Utf8ToAnsi</span>(TEST_STR_A).<span class="built_in">c_str</span>());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#123;</span><br><span class="line">		ui.lblLanguage-&gt;<span class="built_in">setText</span>(TEST_STR_A);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// char* --&gt; QString</span></span><br><span class="line">	&#123;</span><br><span class="line">		QString qstr = TEST_STR_A;</span><br><span class="line">		<span class="built_in">qInfo</span>() &lt;&lt; qstr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// QString --&gt; char*或std::string</span></span><br><span class="line">	&#123;</span><br><span class="line">		QString qstr = TEST_STR_A;</span><br><span class="line"></span><br><span class="line">		std::string str = qstr.<span class="built_in">toStdString</span>(); <span class="comment">// 不能直接使用qstr.toStdString().c_str()来获取，必须先将qstr.toStdString()存入std::string中</span></span><br><span class="line">		<span class="type">const</span> <span class="type">char</span>* pStr = str.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		QString qstr2 = QString::<span class="built_in">fromUtf8</span>(pStr);</span><br><span class="line">		<span class="built_in">Q_ASSERT</span>(qstr == qstr2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// QString --&gt; wchar_t*或std::wstring</span></span><br><span class="line">	&#123;</span><br><span class="line">		QString qstr = TEST_STR_A;</span><br><span class="line"></span><br><span class="line">		std::wstring str = qstr.<span class="built_in">toStdWString</span>();</span><br><span class="line">		<span class="type">const</span> <span class="type">wchar_t</span> * pStr = str.<span class="built_in">c_str</span>();</span><br><span class="line"></span><br><span class="line">		QString qstr2 = QString::<span class="built_in">fromWCharArray</span>(pStr);</span><br><span class="line">		<span class="built_in">Q_ASSERT</span>(qstr == qstr2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// std::string --&gt; QString</span></span><br><span class="line">	&#123;</span><br><span class="line">		std::string str = TEST_STR_A;  <span class="comment">// std::string中存储的是UTF-8编码的字符串，因为可执行字符集为UTF8</span></span><br><span class="line">		QString qstr = QString::<span class="built_in">fromStdString</span>(str);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// std::wstring --&gt; QString</span></span><br><span class="line">	&#123;</span><br><span class="line">		std::wstring str = TEST_STR_W;  <span class="comment">// std::wstring中存储的是UTF-8编码的字符串，因为可执行字符集为UTF8</span></span><br><span class="line">		QString qstr = QString::<span class="built_in">fromStdWString</span>(str);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="QString-toLocal8Bit"><a href="#QString-toLocal8Bit" class="headerlink" title="QString::toLocal8Bit"></a>QString::toLocal8Bit</h2><p>QString 有一个名为<code>toLocal8Bit</code>的方法，网上很多介绍如何解决乱码的文章都会提到这个函数。关于这个函数官方的介绍如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Returns the local 8-bit representation of the string as a QByteArray. The returned byte array is undefined if the string contains characters not supported by the local 8-bit encoding.</span><br><span class="line"></span><br><span class="line">QTextCodec::codecForLocale() is used to perform the conversion from Unicode. If the locale encoding could not be determined, this function does the same as toLatin1().</span><br><span class="line"></span><br><span class="line">If this string contains any characters that cannot be encoded in the locale, the returned byte array is undefined. Those characters may be suppressed or replaced by another.</span><br></pre></td></tr></table></figure>

<p>简而言之，toLocal8Bit 函数将字符串转换为的 ANSI 编码，ANSI 是和具体的代码页相关联的（在 Windows 中文环境下默认代码页为 936）。Qt 不是根据系统代码页来做判断的，而是通过<code>QTextCodec</code>来做判断的，所以文档中会提到这个函数需要结合<code>QTextCodec::codecForLocale()</code>来使用，<code>toLocal8Bit</code>根据对应的<code>QTextCodec</code>来做相应的转换。</p>
<h2 id="Qt程序告别乱码"><a href="#Qt程序告别乱码" class="headerlink" title="Qt程序告别乱码"></a>Qt程序告别乱码</h2><p>所以要想在使用 Qt 时，避免遇到中文乱码问题，只需要在预编译头文件中加入（对于不使用预编译头的项目可以在.cpp文件中添加）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>同时由于部分韩文、日文等字符不在 Visual Studio 默认的中文 GB2312 编码中，所以如果遇到 Visual Studio 提示“此文件的某些 Unicode 字符未能保存到当前代码页中”时，这时应该选择”<code>Utf8-带签名</code>“格式来保存。</p>
<p>综上所述，源文件保存为<code>Utf8-带签名</code>，且设置编译器执行字符集编码为UTF8（如<code>#pragma execution_character_set(&quot;utf-8&quot;)</code>）就可以解决所有乱码问题。</p>
<blockquote>
<p>文章图片带有“CSDN”水印的说明：<br>由于该文章和图片最初发表在我的<a target="_blank" rel="noopener" href="https://blog.csdn.net/china_jeffery">CSDN 博客</a>中，因此图片被 CSDN 自动添加了水印。</p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>jiangxueqiao.com
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://jiangxueqiao.com/post/2720283852.html" title="拨开字符编码的迷雾">https://jiangxueqiao.com/post/2720283852.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" rel="tag"># 字符编码</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/2842059394.html" rel="prev" title="SQL批量添加更新和删除">
                  <i class="fa fa-angle-left"></i> SQL批量添加更新和删除
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/2824175441.html" rel="next" title="Linux GDB调试命令">
                  Linux GDB调试命令 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鄂ICP备2020015399号-6 </a>
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-rocket"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">jiangxueqiao.com</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"winsoft666","repo":"blog-comment","client_id":"Ov23libVrm4js5jotUI4","client_secret":"ab2e3a6d1daa72bfcb968ff049246f8df2ce8988","admin_user":"winsoft666","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d6866d7b5021721f3eeacf289d408c31"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
