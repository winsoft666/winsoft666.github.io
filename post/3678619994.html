<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-corner-indicator.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"jiangxueqiao.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":true,"height":300},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":true,"duration":200,"transition":{"menu_item":null,"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":null}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="CMake 是一个开源、跨平台的构建系统生成器（Build-system Generator）。 CMake 是构建系统生成器，而不是构建系统，CMake 支持生成不同构建系统所支持的工程文件，如 Visual Studio，XCode，Makefile 等。 本教程作为 CMake 的简明教程，不会事无巨细的讲述 CMake 的每一个语法，而是以实用为目的，介绍 CMake 的基础语法和常用指令">
<meta property="og:type" content="article">
<meta property="og:title" content="Modern CMake 简明教程（上）">
<meta property="og:url" content="https://jiangxueqiao.com/post/3678619994.html">
<meta property="og:site_name" content="JiangXueqiao&#39;s blog">
<meta property="og:description" content="CMake 是一个开源、跨平台的构建系统生成器（Build-system Generator）。 CMake 是构建系统生成器，而不是构建系统，CMake 支持生成不同构建系统所支持的工程文件，如 Visual Studio，XCode，Makefile 等。 本教程作为 CMake 的简明教程，不会事无巨细的讲述 CMake 的每一个语法，而是以实用为目的，介绍 CMake 的基础语法和常用指令">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/n3oz6wn7Ke-TinyTu.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/Qv1nk8g1ZA.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/nx0MX2PY7u-TinyTu.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/ycHxFOTmrG-TinyTu.png">
<meta property="og:image" content="https://jiangxueqiao.com/images/blog/6zoF01MV26-TinyTu.png">
<meta property="article:published_time" content="2024-10-08T09:30:36.000Z">
<meta property="article:modified_time" content="2025-11-17T05:07:24.071Z">
<meta property="article:author" content="jiangxueqiao.com">
<meta property="article:tag" content="CMake">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jiangxueqiao.com/images/blog/n3oz6wn7Ke-TinyTu.png">


<link rel="canonical" href="https://jiangxueqiao.com/post/3678619994.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jiangxueqiao.com/post/3678619994.html","path":"post/3678619994.html","title":"Modern CMake 简明教程（上）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Modern CMake 简明教程（上） | JiangXueqiao's blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>

  <script src="/js/third-party/pace.js" defer></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">JiangXueqiao's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">17</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">12</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Modern-CMake"><span class="nav-number">1.</span> <span class="nav-text">Modern CMake</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.2.</span> <span class="nav-text">一个简单的示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E5%A4%96%E6%9E%84%E5%BB%BA"><span class="nav-number">2.3.</span> <span class="nav-text">源码外构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">2.4.</span> <span class="nav-text">工作流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">2.5.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMake%E6%9C%80%E4%BD%8E%E7%89%88%E6%9C%AC"><span class="nav-number">2.6.</span> <span class="nav-text">CMake最低版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%90%8D%E7%A7%B0"><span class="nav-number">2.7.</span> <span class="nav-text">项目名称</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BBCMakeLists-txt"><span class="nav-number">2.7.1.</span> <span class="nav-text">主CMakeLists.txt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.8.</span> <span class="nav-text">目标类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="nav-number">2.8.1.</span> <span class="nav-text">可执行文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E5%92%8C%E9%9D%99%E6%80%81%E5%BA%93"><span class="nav-number">2.8.2.</span> <span class="nav-text">动态库和静态库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">基础语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.1.</span> <span class="nav-text">变量的定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BA"><span class="nav-number">3.1.2.</span> <span class="nav-text">调试输出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#message"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">message</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmake-print-variables"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">cmake_print_variables</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%A1%A8"><span class="nav-number">3.1.3.</span> <span class="nav-text">列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#list-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">list 命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E5%88%97%E8%A1%A8"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">遍历列表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E5%BC%95%E5%8F%B7%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-number">3.1.4.</span> <span class="nav-text">双引号的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.5.</span> <span class="nav-text">三种不同的变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.5.1.</span> <span class="nav-text">普通变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.5.2.</span> <span class="nav-text">缓存变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#option"><span class="nav-number">3.1.5.3.</span> <span class="nav-text">option</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">3.1.5.4.</span> <span class="nav-text">环境变量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">3.1.6.</span> <span class="nav-text">变量作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#include"><span class="nav-number">3.1.6.1.</span> <span class="nav-text">include</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#add-subdirectory"><span class="nav-number">3.1.6.2.</span> <span class="nav-text">add_subdirectory</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="nav-number">3.2.</span> <span class="nav-text">数学运算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">3.3.</span> <span class="nav-text">条件判断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E5%80%BC%E4%B8%8E%E5%81%87%E5%80%BC"><span class="nav-number">3.3.1.</span> <span class="nav-text">真值与假值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">3.3.2.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">3.3.3.</span> <span class="nav-text">关系运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%9C%A8%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="nav-number">3.3.4.</span> <span class="nav-text">存在性校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.4.</span> <span class="nav-text">循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#foreach"><span class="nav-number">3.4.1.</span> <span class="nav-text">foreach</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while"><span class="nav-number">3.4.2.</span> <span class="nav-text">while</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%92%8C%E5%AE%8F"><span class="nav-number">3.5.</span> <span class="nav-text">函数和宏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">3.5.1.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">3.5.1.1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">3.5.1.2.</span> <span class="nav-text">返回值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F"><span class="nav-number">3.5.2.</span> <span class="nav-text">宏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="nav-number">3.6.</span> <span class="nav-text">字符串操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="nav-number">3.7.</span> <span class="nav-text">内置变量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">4.</span> <span class="nav-text">目标的属性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E8%B0%83%E8%AF%95"><span class="nav-number">4.1.</span> <span class="nav-text">属性调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%85%E5%90%AB%E7%9B%AE%E5%BD%95"><span class="nav-number">4.2.</span> <span class="nav-text">包含目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E5%AE%8F"><span class="nav-number">4.3.</span> <span class="nav-text">预编译宏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="nav-number">4.4.</span> <span class="nav-text">依赖库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#INTERFACE%E3%80%81PUBLIC-%E5%92%8C-PRIVATE"><span class="nav-number">4.5.</span> <span class="nav-text">INTERFACE、PUBLIC 和 PRIVATE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5%E9%80%89%E9%A1%B9"><span class="nav-number">4.6.</span> <span class="nav-text">编译和链接选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="nav-number">4.7.</span> <span class="nav-text">其他属性</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="jiangxueqiao.com"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">jiangxueqiao.com</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/winsoft666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;winsoft666" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:smart7178@163.com" title="E-Mail → mailto:smart7178@163.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://jiangxueqiao.com/online-tools" title="https:&#x2F;&#x2F;jiangxueqiao.com&#x2F;online-tools">在线工具</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jiangxueqiao.com/post/3678619994.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="jiangxueqiao.com">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiangXueqiao's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Modern CMake 简明教程（上） | JiangXueqiao's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Modern CMake 简明教程（上）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-08 17:30:36" itemprop="dateCreated datePublished" datetime="2024-10-08T17:30:36+08:00">2024-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-17 13:07:24" itemprop="dateModified" datetime="2025-11-17T13:07:24+08:00">2025-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E8%AF%91%E4%B8%8E%E6%9E%84%E5%BB%BA/" itemprop="url" rel="index"><span itemprop="name">编译与构建</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a target="_blank" rel="noopener" href="https://cmake.org/">CMake</a> 是一个开源、跨平台的构建系统生成器（Build-system Generator）。</p>
<p>CMake 是构建系统生成器，而不是构建系统，CMake 支持生成不同构建系统所支持的工程文件，如 Visual Studio，XCode，Makefile 等。</p>
<p>本教程作为 CMake 的简明教程，不会事无巨细的讲述 CMake 的每一个语法，而是以实用为目的，介绍 CMake 的基础语法和常用指令。</p>
<p>虽然只是简明教程，但通过本教程，你仍然可以掌握 CMake 的脉络，熟练应用 CMake 于项目中。</p>
<span id="more"></span>

<h1 id="Modern-CMake"><a href="#Modern-CMake" class="headerlink" title="Modern CMake"></a>Modern CMake</h1><p>CMake 距今已有 20 多年的历史，CMake 从 3.0 开始引入 Target 概念，有了 Target 和 Property 的定义，CMake 也就更加地现代化。</p>
<p>我们将引入 Target 概念之前（也就是 3.0 之前）的 CMake 称之为老式 CMake，之后的称之为现代 CMake（Modern CMake）。</p>
<p>现代 CMake 是围绕 Target 和 Property 来定义的，在现代 CMake 中不应该出现诸如下面的指令：</p>
<ul>
<li>add_compile_options</li>
<li>include_directories</li>
<li>link_directories</li>
<li>link_libraries</li>
</ul>
<p>因为这些指令都是目录级别的，在该目录（含子目录）上定义的所有目标都会继承这些属性，这样会导致出现很多隐藏依赖和多余属性的情况。</p>
<p>我们最好直接针对 Target 进行操作，如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(hello main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 老式写法</span></span><br><span class="line"><span class="keyword">include_directories</span>(./<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现代写法</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(hello PRIVATE ./<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<p><strong>本文讲述的知识点只适用于现代 CMake，让我们脱掉沉重的历史包袱，轻装上阵吧！</strong></p>
<h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><p>所有的构建系统都需要通过某个入口点来定义项目（如 Visual Studio 的 .sln 文件），CMake 作为构建系统生成器也不例外，CMake 使用的是 <code>CMakeLists.txt</code> 的文件，该文件以 UTF-8 编码（也支持 UTF-8 BOM 文件头），其中存储了符合 CMake 语言规范的脚本代码。</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>CMake 没有强制规定 CMakeLists.txt 文件的位置以及项目的目录结构，但目前大多数项目都会采用相似的目录结构。</p>
<p>如果项目名称为 my_project，且该项目包含一个名为 lib 的库和一个名为 app 的程序，则目录结构通常如下面所示：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- my_project</span><br><span class="line">  - .gitignore</span><br><span class="line">  - README.md</span><br><span class="line">  - LICENSE.md</span><br><span class="line">  - CMakeLists.txt</span><br><span class="line">  - cmake</span><br><span class="line">    - FindSomeLib.cmake</span><br><span class="line">    - something_else.cmake</span><br><span class="line">  - include</span><br><span class="line">    - my_project</span><br><span class="line">      - lib.h</span><br><span class="line">  - src</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">    - lib.cpp</span><br><span class="line">  - apps</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">    - app.cpp</span><br><span class="line">  - tests</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">    - testlib.cpp</span><br><span class="line">  - docs</span><br><span class="line">    - CMakeLists.txt</span><br><span class="line">  - extern</span><br><span class="line">    - googletest</span><br><span class="line">  - scripts</span><br><span class="line">    - helper.py</span><br></pre></td></tr></table></figure>

<p>当然，上面的名称并不是一成不变的，可以根据自己的喜好来定义，例如 my_project 可以是任意的项目名，如果不喜欢复数，可以将 tests 改成test，如果没有 python 代码，也可以移除 python 目录，cmake 目录则用于存放 CMake 辅助脚本。</p>
<p>从上面的目录结构可以看到，CMakeLists.txt 文件分散在各个子目录中，但在 include 目录中没有 CMakeList.txt 文件，这样是为了防止暴露不必要的文件给库的使用者，因为 include 目录中存放的是库的头文件，在安装时通常都会将该目录拷贝到指定位置（如Linux系统的 &#x2F;usr&#x2F;include）。</p>
<p>extern 目录用于存放第三方依赖库的源码，这些库可以通过 <code>git submodule</code> 的形式来管理，也可以直接将源码拷贝到此，并提交到项目 git 中。但无论使用哪种方式，依赖库最好能支持 CMake，这样可以方便的使用 <code>add_subdirectory</code> 命令将项目添加到工程中（如果你对 add_subdirectory 命令的具体用法还不了解，这没关系，现在你只需要知道该命令可以添加任何包含 CMakeLists.txt 的目录到项目中即可）。</p>
<h2 id="一个简单的示例"><a href="#一个简单的示例" class="headerlink" title="一个简单的示例"></a>一个简单的示例</h2><p>在学习 CMake 之前，我们先将 CMake 玩起来。我们先从一个简单的示例开始，了解 CMake 的基本玩法。</p>
<p>该示例是只包含一个 main.cpp 文件，我们期望编译该文件能生成 hello_cmake 程序。</p>
<p>目录结构如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- hello_cmake</span><br><span class="line">  - main.cpp</span><br><span class="line">  - CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p>main.cpp 文件的内容非常简单：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello cmake&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CMakeLists.txt 内容如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 CMake 的最低版本</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置项目名称</span></span><br><span class="line"><span class="keyword">project</span> (hello_cmake)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个名为 hello_cmake 的目标</span></span><br><span class="line"><span class="comment"># 目标类型为可执行文件</span></span><br><span class="line"><span class="comment"># 使用 main.cpp 来编译生成 hello_cmake 可执行文件（如hello_cmake.exe）</span></span><br><span class="line"><span class="keyword">add_executable</span>(hello_cmake main.cpp)</span><br></pre></td></tr></table></figure>

<p>完成上面步骤，我们就可以使用 CMake GUI 或命令行（当然你需要提前安装 CMake，这不在本文的介绍范围之内）就可以生成相应的工程了。</p>
<p><img data-src="/images/blog/n3oz6wn7Ke-TinyTu.png"></p>
<p>通过 CMake 命令行生成 Visual Studio 工程的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake.exe -G <span class="string">&quot;Visual Studio 15 2017&quot;</span> -S .\hello_cmake -B .\hello_cmake\build</span><br></pre></td></tr></table></figure>

<h2 id="源码外构建"><a href="#源码外构建" class="headerlink" title="源码外构建"></a>源码外构建</h2><p>我们通常会将构建目录指定到一个单独的子目录内，这个目录名称的通常是 <code>build</code>。如果不这样做，CMake 生成的工程文件和临时缓存文件会污染源码目录。这种方式有个学名叫“源码外构建” (out-of-source build)。</p>
<p>使用源码外构建时，我们通常还会将 build 目录添加到 .gitignore 文件中。</p>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p>编写 CMake 脚本的基本流程如下：</p>
<ol>
<li>在脚本第一行使用 cmake_minimum_required 指定运行当前脚本所需的 CMake 最低版本。</li>
<li>使用 project 指定项目名称。</li>
<li>使用 add_executable 或 add_library 创建目标。</li>
<li>为目标设置包含目录、链接库等属性（可选）。</li>
<li>安装（可选）。</li>
</ol>
<p>编写完 CMake 脚本以后，就可以使用 CMake GUI 或命令行来生成对应的工程文件了。以 Visual Studio 为例，对于有 my_lib 库 和 app 应用程序的项目，CMake 会生成如下图所示的 5 个项目：</p>
<p><img data-src="/images/blog/Qv1nk8g1ZA.png"></p>
<p>下面介绍 CMake 自动生成的一些项目的作用：</p>
<ul>
<li>编译 ALL_BUILD 项目会自动编译除 INSTALL 项目外的所有项目。</li>
<li>编译 INSTALL 项目会执行 CMake 脚本中指定的安装操作。</li>
<li>编译 ZERO_CHECK 项目会再次执行 CMake 脚本，重新生成项目。因此若 CMake 脚本有更新，既可以使用 CMake 工具来重新生成项目，也可以是重新编译 ZERO_CHECK 项目。</li>
</ul>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>在 CMake 中使用 <code>#</code> 来声明单行注释，这是我们使用最多的注释方法。虽然也支持使用 <code>#[[ ]]</code> 来声明多行注释（也称块注释），但是使用的比较少，例如:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[[</span></span><br><span class="line"><span class="comment">  这是多行注释也称块注释</span></span><br><span class="line"><span class="comment">  你明白了吗？</span></span><br><span class="line"><span class="comment">]]</span></span><br></pre></td></tr></table></figure>

<h2 id="CMake最低版本"><a href="#CMake最低版本" class="headerlink" title="CMake最低版本"></a>CMake最低版本</h2><p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/cmake_minimum_required.html">cmake_minimum_required</a> 是我们接触到第一个 CMake 指令，该指令用于指定编译该脚本所需的最低 CMake 版本。</p>
<p>你可以在 CMakeList.txt 文件的第一行都使用该指令来指定运行当前脚本需要的最低 CMake 版本，但我们通常只需要在主 CMakeList.txt （何为主 CMakeList.txt？见下面的“项目名称”小节） 中的第一行使用该指令即可。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION &lt;min&gt;[...&lt;policy_max&gt;] [FATAL_ERROR])</span><br></pre></td></tr></table></figure>

<p>如果运行 CMake 的版本低于<min>要求的版本，则将停止处理该脚本并返回错误。</p>
<p>我们始终应该选择一个比编译器晚发布的 CMake 版本，因为只有这样，CMake 才能支持新的编译器选项。但最低版本不应低于 3.0，实际项目中通常最低版本不会低于 3.16（该版本于2020年09月15日发布），本教程也是以此为标准进行讲解的。</p>
<h2 id="项目名称"><a href="#项目名称" class="headerlink" title="项目名称"></a>项目名称</h2><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/project.html">project</a> 指定项目名称。</p>
<p>项目名称区别于目标（Target）名称，以 Visual Studio 为例，project 指定的名称对应“解决方案名称”，而 add_executable 或 add_library 等指定的名称才对应具体项目名和生成的“目标文件名”。</p>
<p>设置项目名称后，CMake 会自动定义一些变量（<em>变量的具体用法会在稍后的“3.1 变量”小节进行介绍</em>）。为了方便介绍各个变量的含义，假设我们是通过如下命令来运行 CMake 的:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake.exe -G <span class="string">&quot;Visual Studio 15 2017&quot;</span> -S D:\hello_cmake -B D:\hello_cmake\build</span><br></pre></td></tr></table></figure>

<p>下面列举了一些 CMake 自动定义的变量：</p>
<ul>
<li>PROJECT_NAME<br>项目名称，如 hello_cmake</li>
<li>CMAKE_PROJECT_NAME<br>如果 CMakeLists.txt 位于项目的顶级目录，还会定义 CMAKE_PROJECT_NAME 变量，值与 PROJECT_NAME 一致。</li>
<li>PROJECT_SOURCE_DIR<br>项目的根目录（绝对路径），即 <code>-S</code> 参数指定的目录，如 D:\hello_cmake</li>
<li>&lt;PROJECT-NAME&gt;_SOURCE_DIR<br>值与 PROJECT_SOURCE_DIR 相同，只是变量名不同，如 hello_cmake_SOURCE_DIR  </li>
<li>PROJECT_BINARY_DIR<br>项目的构建目录（绝对路径），即 <code>-B</code> 参数指定的目录，如 D:\hello_cmake\build</li>
<li>&lt;PROJECT-NAME&gt;_BINARY_DIR<br>值与 PROJECT_BINARY_DIR 相同，只是变量名不同，如 hello_cmake_BINARY_DIR</li>
</ul>
<h3 id="主CMakeLists-txt"><a href="#主CMakeLists-txt" class="headerlink" title="主CMakeLists.txt"></a>主CMakeLists.txt</h3><p>主 CMakeLists.txt 即项目根目录下的 CMakeLists.txt 文件。可以通过检查 CMAKE_PROJECT_NAME 与 PROJECT_NAME 变量是否相同来判断当前的 CMakeLists.txt 文件是否为主 CMakeLists.txt。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_PROJECT_NAME <span class="keyword">STREQUAL</span> PROJECT_NAME)</span><br><span class="line"></span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h2 id="目标类型"><a href="#目标类型" class="headerlink" title="目标类型"></a>目标类型</h2><p>既然现代 CMake 是围绕目标（Target）工作的，Target 如此重要，那我们首先就需要创建一个 Target。</p>
<p>在 C&#x2F;C++ 开发中，常见的 Target 类型有：可执行文件、静态库、动态库，CMake 还额外提供了一个 MODULE 类型。</p>
<p>下面列举了不同类型的目标的创建方式。</p>
<h3 id="可执行文件"><a href="#可执行文件" class="headerlink" title="可执行文件"></a>可执行文件</h3><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/add_executable.html">add_executable</a> 指令可以创建可执行文件类型的目标。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(my_exe main.cpp)</span><br></pre></td></tr></table></figure>

<h3 id="动态库和静态库"><a href="#动态库和静态库" class="headerlink" title="动态库和静态库"></a>动态库和静态库</h3><p>通过为 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/add_library.html">add_library</a> 指令指定不同的参数，可以创建动态库和静态库。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(&lt;name&gt; [&lt;type&gt;] [EXCLUDE_FROM_ALL] &lt;sources&gt;...)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 动态库</span></span><br><span class="line"><span class="keyword">add_library</span>(my_lib SHARED main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态库</span></span><br><span class="line"><span class="keyword">add_library</span>(my_lib STATIC main.cpp)</span><br></pre></td></tr></table></figure>

<p>我们也可以在 add_library 中不指定类型参数，改为通过设置 BUILD_SHARED_LIBS 变量来切换静态库和动态库。下面示例在脚本中设置了 BUILD_SHARED_LIBS 变量值为 ON （ON &#x2F; OFF 对应 CMake 中的开&#x2F;关）：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span> (hello_cmake)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(BUILD_SHARED_LIBS <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(hello_cmake main.cpp)</span><br></pre></td></tr></table></figure>

<p>也可以通过命令行参数进行指定 BUILD_SHARED_LIBS 变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake.exe -G <span class="string">&quot;Visual Studio 15 2017&quot;</span> -DBUILD_SHARED_LIBS=ON -S .\hello_cmake -B .\hello_cmake\build</span><br></pre></td></tr></table></figure>

<p>亦可以在 GUI 界面上设置 BUILD_SHARED_LIBS 变量，如：</p>
<p><img data-src="/images/blog/nx0MX2PY7u-TinyTu.png"></p>
<h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="变量的定义"><a href="#变量的定义" class="headerlink" title="变量的定义"></a>变量的定义</h3><p>在 CMake 中使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/set.html">set</a> 和 <code>unset</code> 命令来定义和取消定义变量。</p>
<p>CMake 的变量没有类型一说，因为其变量值始终是字符串类型。</p>
<p>基于上述原因，在 CMake 中不能直接使用 <code>+</code>、<code>-</code>、<code>*</code>、<code>\</code> 等操作符对变量进行数学运算，需要使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/math.html">math</a> 指令，也不能直接使用 <code>&gt;</code>、<code>&lt;</code>、<code>==</code> 等操作符对变量进行逻辑运算，需要使用 LESS、EQUAL 进行判断，详见下面的“条件判断”章节。</p>
<p>CMake 的变量名是<strong>大小写敏感</strong>的，而且其变量名不像其他语言那样有各种限制，它可以包含任何字符，如空格、问号等，但如果变量名中包含<code>#</code>（该符号用于行注释），则需要使用 <code>\#</code> 进行转义。</p>
<p>下面的语句都是合法的：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(abc <span class="number">123</span>)</span><br><span class="line"><span class="keyword">set</span>(ABC <span class="string">&quot;123&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="string">&quot;ab c&quot;</span> <span class="string">&quot;456&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="string">&quot;ab?c&quot;</span> <span class="string">&quot;789&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="string">&quot;/usr/bin/bash&quot;</span> <span class="string">&quot;987&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="string">&quot;C:\\Program Files\\&quot;</span> <span class="string">&quot;654&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="string">&quot; &quot;</span> <span class="string">&quot;321&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(\<span class="comment"># &quot;321&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unset</span>(a)</span><br></pre></td></tr></table></figure>

<p>虽然 CMake 允许变量名为任意字符串，但我们仍然建议在变量名称中仅包含字母、数字、<code>-</code> 和 <code>_</code> ，而且字母为大写字母，如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建议的命名方式</span></span><br><span class="line"><span class="keyword">set</span>(QT_VERSION <span class="string">&quot;5.15.2&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(LIB_NAME <span class="string">&quot;my_lib&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>CMake 还会保留一些标识符，我们在定义变量时尽量不要使用这些名称（你执意要用，CMake 也不会报错）：</p>
<ul>
<li>以 <code>CMAKE_</code> 开头的。</li>
<li>以 <code>_CMAKE_</code> 开头的。</li>
<li>以 <code>_&lt;cmake command&gt;</code> 开头的，如 _file，完整的 command 列表见：<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html">cmake-commands</a>。</li>
</ul>
<p>在定义完变量以后，就可以通过 <code>${variable}</code> 的形式进行引用了，如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(QT_VERSION <span class="string">&quot;5.15.2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;QT_VERSION is $&#123;QT_VERSION&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在 CMake 中，还可以通过引用变量的方式来定义新的变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(a <span class="string">&quot;xyz&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(b <span class="string">&quot;$&#123;a&#125;_321&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(<span class="variable">$&#123;a&#125;</span>_1 <span class="string">&quot;456&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(variable_<span class="variable">$&#123;a&#125;</span> <span class="string">&quot;$&#123;a&#125; + $&#123;b&#125; + 15&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;b: &#x27;$&#123;b&#125;&#x27;&quot;</span>) <span class="comment"># b: &#x27;xyz_321&#x27;</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;xyz_1: &#x27;$&#123;xyz_1&#125;&#x27;&quot;</span>) <span class="comment"># xyz_1: &#x27;456&#x27;</span></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;variable_xyz: &#x27;$&#123;variable_xyz&#125;&#x27;&quot;</span>) <span class="comment"># variable_xyz: &#x27;xyz + xyz_321 + 15&#x27;</span></span><br></pre></td></tr></table></figure>

<p>环境变量的引用方式有所不同，在下面的环境变量章节会详细介绍，而且在 if 条件中可以省略 <code>${}</code>，直接使用变量名，如 <code>if(QT_VERSION)</code>。</p>
<p>CMake 还允许使用未定义的变量，未定义的变量的值为空字符串。</p>
<p>CMake 也允许重复定义变量，变量的值采用最后定义的值。</p>
<h3 id="调试输出"><a href="#调试输出" class="headerlink" title="调试输出"></a>调试输出</h3><h4 id="message"><a href="#message" class="headerlink" title="message"></a>message</h4><p>为了方便调试脚本，我们可以使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/message.html">messsage</a> 指令来输出变量和调试信息。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>([&lt;mode&gt;] <span class="string">&quot;message text&quot;</span> ...)</span><br></pre></td></tr></table></figure>

<p><code>&lt;mode&gt;</code> 关键字是可选的，它用于指定消息的类型，消息类型会影响 CMake 对该消息的处理方式。</p>
<p>常用的消息类型有：</p>
<ul>
<li>FATAL_ERROR<br>致命错误（红色），只有该类型会导致脚本终止执行。</li>
<li>WARNING<br>警告（红色），脚本继续执行。</li>
<li><strong>NOTICE（默认）</strong><br>需要特别关注的消息（红色），脚本继续执行。</li>
<li>STATUS<br>普通输出，正常颜色，脚本也会继续执行。</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;Current version is 1.0.0.1&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;BUILD_SHARED_LIBS value is $&#123;BUILD_SHARED_LIBS&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="cmake-print-variables"><a href="#cmake-print-variables" class="headerlink" title="cmake_print_variables"></a>cmake_print_variables</h4><p>如果只是单纯地想打印变量的值，使用 messsage 显得有些繁琐，我们可以使用 cmake_print_variables 函数来打印变量的值，该函数以 <code>variable=value</code> 格式输出每个变量的值，方便进行观察。</p>
<p>由于该函数由 CMake 的 CMakePrintHelpers 模块提供，因此在使用之前，需要先 <code>include(CMakePrintHelpers)</code>：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CMakePrintHelpers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(MY_NAME <span class="string">&quot;jack&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(MY_ADDRESS <span class="string">&quot;Hubei&quot;</span>)</span><br><span class="line"></span><br><span class="line">cmake_print_variables(MY_NAME MY_ADDRESS) <span class="comment"># MY_NAME=&quot;jack&quot; ; MY_ADDRESS=&quot;Hubei&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>列表就是简单地包含一系列值，使用空格分割每个值：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST a b <span class="string">&quot;c&quot;</span> <span class="number">1</span> <span class="number">2</span> <span class="variable">$&#123;MY_NAME&#125;</span> <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>;</code> 来代替空格：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST <span class="string">&quot;a;b;c;1;2;$&#123;MY_NAME&#125;;3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(MY_LIST a;b;c;<span class="number">1</span>;<span class="number">2</span>;<span class="variable">$&#123;MY_NAME&#125;</span>;<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h4 id="list-命令"><a href="#list-命令" class="headerlink" title="list 命令"></a>list 命令</h4><p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/list.html">list</a> 命令提供了众多针对列表的操作，如获取元素个数、查找、添加、删除、排序等。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取元素个数</span></span><br><span class="line"><span class="keyword">list</span>(LENGTH &lt;<span class="keyword">list</span>&gt; &lt;out-var&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定下标（可以指定多个下标）的元素</span></span><br><span class="line"><span class="keyword">list</span>(GET &lt;<span class="keyword">list</span>&gt; &lt;element index&gt; [&lt;index&gt; ...] &lt;out-var&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接2个列表</span></span><br><span class="line"><span class="keyword">list</span>(JOIN &lt;<span class="keyword">list</span>&gt; &lt;glue&gt; &lt;out-var&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定位置指定长度的一段列表</span></span><br><span class="line"><span class="keyword">list</span>(SUBLIST &lt;<span class="keyword">list</span>&gt; &lt;begin&gt; &lt;length&gt; &lt;out-var&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找，&lt;out-var&gt;中存储查找到的元素下标，如果没找到则为-1</span></span><br><span class="line"><span class="keyword">list</span>(FIND &lt;<span class="keyword">list</span>&gt; &lt;value&gt; &lt;out-var&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在列表尾部添加若干元素</span></span><br><span class="line"><span class="keyword">list</span>(APPEND &lt;<span class="keyword">list</span>&gt; [&lt;element&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按条件过滤列表</span></span><br><span class="line"><span class="keyword">list</span>(FILTER &lt;<span class="keyword">list</span>&gt; &lt;<span class="keyword">INCLUDE</span>|EXCLUDE&gt; REGEX &lt;regular_expression&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定位置插入若干元素</span></span><br><span class="line"><span class="keyword">list</span>(INSERT &lt;<span class="keyword">list</span>&gt; &lt;index&gt; [&lt;element&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 弹出尾部的若干元素（如果没有指定&lt;out-var&gt;变量，则只弹出一个）</span></span><br><span class="line"><span class="keyword">list</span>(POP_BACK &lt;<span class="keyword">list</span>&gt; [&lt;out-var&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 弹出头部的若干元素（如果没有指定&lt;out-var&gt;变量，则只弹出一个）</span></span><br><span class="line"><span class="keyword">list</span>(POP_FRONT &lt;<span class="keyword">list</span>&gt; [&lt;out-var&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将若干元素插入到列表的头部，如果&lt;list&gt;没有被定义，则相当于创建了一个新的列表</span></span><br><span class="line"><span class="keyword">list</span>(PREPEND &lt;<span class="keyword">list</span>&gt; [&lt;element&gt;...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除列表中的若干元素</span></span><br><span class="line"><span class="keyword">list</span>(REMOVE_ITEM &lt;<span class="keyword">list</span>&gt; &lt;value&gt;...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除列表中指定位置（可以指定多个）的元素</span></span><br><span class="line"><span class="keyword">list</span>(REMOVE_AT &lt;<span class="keyword">list</span>&gt; &lt;index&gt;...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除列表中的重复项目。保留项目的相对顺序，但如果遇到重复项，则仅保留第一个实例。</span></span><br><span class="line"><span class="keyword">list</span>(REMOVE_DUPLICATES &lt;<span class="keyword">list</span>&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照&lt;ACTION&gt;对列表元素进行转换</span></span><br><span class="line"><span class="keyword">list</span>(TRANSFORM &lt;<span class="keyword">list</span>&gt; &lt;ACTION&gt; [&lt;SELECTOR&gt;] [OUTPUT_VARIABLE &lt;output variable&gt;])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表反转</span></span><br><span class="line"><span class="keyword">list</span>(REVERSE &lt;<span class="keyword">list</span>&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表排序</span></span><br><span class="line"><span class="keyword">list</span>(SORT &lt;<span class="keyword">list</span>&gt; [COMPARE &lt;compare&gt;] [CASE &lt;case&gt;] [ORDER &lt;order&gt;])</span><br></pre></td></tr></table></figure>

<p>下面仅简单地演示 2 个列表功能的用法：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(NAME_LIST jack jim jeff tom)</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(LENGTH NAME_LIST NAME_COUNT)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;name count: $&#123;NAME_COUNT&#125;&quot;</span>) <span class="comment"># name count: 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(FIND NAME_LIST jim JIM_INDEX)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;jim at: $&#123;JIM_INDEX&#125;&quot;</span>) <span class="comment"># jim at: 1</span></span><br></pre></td></tr></table></figure>

<h4 id="遍历列表"><a href="#遍历列表" class="headerlink" title="遍历列表"></a>遍历列表</h4><p>可以使用 foreach 来遍历列表，下面示例演示了如何使用 foreach 遍历输出 MY_LIST 列表中每个元素，其中 _ITEM 变量的作用域仅限 foreach 代码块。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST hello world)</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(_ITEM <span class="variable">$&#123;MY_LIST&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_ITEM&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<p>我们还可以使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/while.html">while</a> 来遍历列表，详见下面的“循环”章节。</p>
<h3 id="双引号的作用"><a href="#双引号的作用" class="headerlink" title="双引号的作用"></a>双引号的作用</h3><p>学习到这里，也许你会感到困扰，在定义变量时，为什么有时候使用双引号把值包围起来，有时候又不使用呢？</p>
<p>我们已经学习完了列表的相关知识，现在就可以解释加不加引号的区别了。</p>
<p>在定义变量时，若变量值中包含空格，此时不使用双引号包裹，则等同于定义列表；使用双引号包裹，则等同于定义字符串变量。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义的MY_VAR为列表，包含2个元素：hello、world</span></span><br><span class="line"><span class="keyword">set</span>(MY_VAR hello world)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义的MY_VAR为字符串</span></span><br><span class="line"><span class="keyword">set</span>(MY_VAR <span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>对于列表类型的变量，在使用时是否使用双引号包裹也会有区别：有双引号包裹时，会将数组元素以分号作为分隔符进行拼接，否则会直接拼接各元素。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST hello world)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;MY_LIST&#125;&quot;</span>) <span class="comment"># hello;world</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="variable">$&#123;MY_LIST&#125;</span>) <span class="comment"># helloworld</span></span><br></pre></td></tr></table></figure>

<h3 id="三种不同的变量"><a href="#三种不同的变量" class="headerlink" title="三种不同的变量"></a>三种不同的变量</h3><p>CMake 中的变量分为普通变量、缓存变量和环境变量，三者都可以通过 <code>set</code> 指令进行定义。</p>
<h4 id="普通变量"><a href="#普通变量" class="headerlink" title="普通变量"></a>普通变量</h4><p>下面使用 <code>set</code> 定义的变量就是普通变量。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_NAME <span class="string">&quot;jack&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>也可以在 CMake 命令行中通过 <code>-D</code> 参数定义普通变量，如下面示例定义了 BUILD_SHARED_LIBS 和 TEST 变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake.exe -G <span class="string">&quot;Visual Studio 15 2017&quot;</span> -DBUILD_SHARED_LIBS=ON -DTEST=123 -S .\hello_cmake -B .\hello_cmake\build</span><br></pre></td></tr></table></figure>

<h4 id="缓存变量"><a href="#缓存变量" class="headerlink" title="缓存变量"></a>缓存变量</h4><p>缓存变量也是通过 <code>set</code> 指令定义的，但需要添加额外的参数：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(&lt;variable&gt; &lt;value&gt;... CACHE &lt;type&gt; &lt;docstring&gt; [FORCE])</span><br></pre></td></tr></table></figure>

<p>下面示例定义了一个名为 LIB_VERSION 的缓存变量：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(LIB_VERSION <span class="string">&quot;1.0.0.1&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;the version of library&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span> (hello_cmake)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(hello_cmake main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;LIB_VERSION = $&#123;LIB_VERSION&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/blog/ycHxFOTmrG-TinyTu.png"></p>
<p>使用 CMake GUI 程序执行该脚本，可以看到界面上多出了一个名为 LIB_VERSION 的文本输入框，而且输入框有默认值 1.0.0.1。</p>
<p>将输入框中的文本修改为 1.0.0.2，再次执行该脚本，可以发现调试输出的内容是 <code>LIB_VERSION = 1.0.0.2</code>，而且无论我们执行多少次脚本，始终输出的都是该内容。</p>
<p>这是因为 CMake 会将缓存变量及其值存储到 “构建目录\CMakeCache.txt” 文件中，下次运行脚本时，会优先从该文件中加载变量，该文件内容格式大致如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># build\CMakeCache.txt 文件</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">//the version of library</span><br><span class="line">LIB_VERSION:STRING=1.0.0.2</span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>其中，<code>&lt;type&gt;</code> 用于指定变量的输入类型。请注意，<code>&lt;type&gt;</code> 指定的不是变量的类型，因为 CMake 的所有变量都是字符串类型。<code>&lt;type&gt;</code> 指定的是输入类型，仅用于帮助 CMake GUI 程序显示不同的用户输入控件，如文本输入框、复选框、文件选择对话框等。 </p>
<p><code>&lt;type&gt;</code> 的取值必须是下面列表中的一个：</p>
<ul>
<li>BOOL<br>开关ON或OFF，在 CMake GUI 上提供一个复选框。</li>
<li>PATH<br>文件夹的路径，在 CMake GUI 上提供一个文本输入框和一个按钮来打开<strong>文件夹</strong>选择对话框。</li>
<li>FILEPATH<br>文件的路径，在 CMake GUI 上提供一个文本输入框和一个按钮来打开文件选择对话框。</li>
<li>STRING<br>文本字符串，在 CMake GUI 上提供一个文本输入框。</li>
<li>STRINGS<br>文本字符串，但在 CMake GUI 上会提供一个下拉列表选择框。</li>
<li>INTERNAL<br>虽然也是文本字符串，但不会显示在 CMake GUI 上，因此用户无法在界面上修改该变量的值。</li>
</ul>
<p>如果我们不希望某些缓存变量直接展示 CMake GUI 上，可以使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/mark_as_advanced.html">mark_as_advanced</a> 指令将缓存变量设置为高级状态，这样除非用户打开了 “Show Advanced” 选项，否则高级变量不会显示在 CMake GUI 中。在脚本模式下，高级&#x2F;非高级状态是无效的。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(DEBUG_LIBNAME_SUFFIX <span class="string">&quot;-d&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;Optional suffix to append to the library name for a debug build&quot;</span>)</span><br><span class="line"><span class="keyword">mark_as_advanced</span>(DEBUG_LIBNAME_SUFFIX)</span><br></pre></td></tr></table></figure>

<h4 id="option"><a href="#option" class="headerlink" title="option"></a>option</h4><p>虽然 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/option.html">option</a> 也可用于定义缓存变量，但其只能定义“开&#x2F;关”类型的变量。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span>(ENABLE_TEST <span class="string">&quot;enable test or not&quot;</span> <span class="keyword">ON</span>)</span><br></pre></td></tr></table></figure>

<p>如果未指定初始值，默认为 OFF。</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>环境变量的定义方式如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;&lt;variable&gt;&#125; [&lt;value&gt;])</span><br></pre></td></tr></table></figure>

<p>环境变量在引用时，需要在前面添加 <code>ENV</code> 标识，如 <code>$ENV{&lt;variable&gt;}</code></p>
<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;USER_NAME&#125; <span class="string">&quot;jack&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;User name is $ENV&#123;USER_NAME&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>CMake 程序在启动时，会加载系统的环境变量，同时还会设置一些内置的环境变量，内置的环境变量见 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-env-variables.7.html">cmake-env-variables</a>。</p>
<p>CMake 虽然会加载系统的环境变量，我们也可以修改该环境变量，但该修改操作不会影响到系统的环境变量。</p>
<p>定义或加载的环境变量只会作用于当前的 CMake 进程，而且对当前进程所运行的所有脚本都可见，但不会影响到其他 CMake 进程和系统中的其他进程。</p>
<h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><p>在上面介绍三种不同的变量时，我一直在竭力避免讨论一个话题，那就是变量的作用域。事实上，上面三种变量还有个不同之处就是作用域的不同。</p>
<p>缓存变量和环境变量都是全局的，它们可以跨文件、目录、函数进行读写，因此作用域主要针对普通变量而言。</p>
<p>CMake 中作用域分为“目录级别作用域”和“函数作用域”（也可以使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/block.html">block()</a> 来显式的创建一个作用域，但这种使用方式非常少）。</p>
<p>函数有自己的作用域，在函数中定义的变量只能在函数体中使用，函数体外无法访问。除非在定义变量时添加 <code>PARENT_SCOPE</code> 来将变量作用域设置为上一级目录。</p>
<h4 id="include"><a href="#include" class="headerlink" title="include"></a>include</h4><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/include.html">include</a> 指令可以加载和执行其他 CMake 脚本文件（名称通常为 <code>*.cmake</code>），include 会在 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_MODULE_PATH.html">CMAKE_MODULE_PATH</a> 变量指定的目录列表中搜索指定文件。</p>
<p>使用 include 指令加载cmake文件时，无需指定 <code>.cmake</code> 后缀，指定文件名即可，假设在 A（CMakeLists.txt或*.cmake）中调用 <code>include(B)</code> 加载 B.cmake ，则 A 和 B 之间可以相互读写彼此的变量（包含普通变量、缓存变量和环境变量）。</p>
<p>当然，在 <code>B.cmake</code> 文件中也可以使用 include 指令加载执行其他的 cmake 文件。</p>
<h4 id="add-subdirectory"><a href="#add-subdirectory" class="headerlink" title="add_subdirectory"></a>add_subdirectory</h4><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html">add_subdirectory</a> 指令可以添加一个子目录到项目构建中，但是被添加的子目录中必须包含 CMakeLists.txt 文件。</p>
<p>假设在 A (CMakeLists.txt文件) 中调用 <code>add_subdirectory(lib)</code> 添加了 lib 子目录，则 lib 目录中的 CMakeLists.txt 可以读写 A 中的普通变量，但 A 不能读写 lib 目录 CMakeLists.txt 的普通变量。但可以在定义变量时添加 <code>PARENT_SCOPE</code> 选项来突破该限制，将变量作用域设置为上一级作用域，即父目录的作用域，如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib\CMakeLists.txt 文件</span></span><br><span class="line"><span class="keyword">set</span>(LIB_NAME <span class="string">&quot;MyTestLib&quot;</span> PARENT_SCOPE)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(lib)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以访问 LIB_NAME 变量</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;LIB_NAME&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h2><p>在前面章节已经提到了 CMake 中的值都是以字符串类型存储的，不能直接使用数学运算符符进行运算，需要使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/math.html">math</a> 指令进行数学运算。</p>
<p>math 的语法如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">math</span>(EXPR &lt;variable&gt; <span class="string">&quot;&lt;expression&gt;&quot;</span> [OUTPUT_FORMAT &lt;format&gt;])</span><br></pre></td></tr></table></figure>

<p>其中，<code>&lt;variable&gt;</code>变量如果没有定义，math 会自动定义该变量；</p>
<p>OUTPUT_FORMAT 选项用于指定计算结果的进制（十六进制或十进制）：</p>
<ul>
<li>HEXADECIMAL  十六进制</li>
<li>DECIMAL 十进制（默认）</li>
</ul>
<p>math 支持如下运算符：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ - * / % | &amp; ^ ~ &lt;&lt; &gt;&gt;  (...)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># value 等于 &quot;300&quot;</span></span><br><span class="line"><span class="keyword">math</span>(EXPR value <span class="string">&quot;100 * 3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># value 等于 &quot;1000&quot;</span></span><br><span class="line"><span class="keyword">math</span>(EXPR value <span class="string">&quot;100 * 0xA&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># value 等于 &quot;0x12c&quot;</span></span><br><span class="line"><span class="keyword">math</span>(EXPR value <span class="string">&quot;100 * 3&quot;</span> OUTPUT_FORMAT HEXADECIMAL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(value <span class="number">3</span>)</span><br><span class="line"><span class="keyword">math</span>(EXPR value <span class="string">&quot;100 * $&#123;value&#125;&quot;</span>)   <span class="comment"># value 等于 &quot;300&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># value 等于 &quot;306&quot;</span></span><br><span class="line"><span class="keyword">math</span>(EXPR value <span class="string">&quot;(100 + 2) * 3&quot;</span>)      </span><br></pre></td></tr></table></figure>


<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>在 CMake 中，使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/if.html">if</a> 进行条件判断，语法如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(&lt;condition&gt;)</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">elseif</span>(&lt;condition&gt;) <span class="comment"># 可选的，可以有多个</span></span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">else</span>()              <span class="comment"># 可选的</span></span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>与众多语言中的 if 一样，当括号中的条件为真时，才执行指定的 commands。</p>
<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(a <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a <span class="keyword">LESS</span> <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;a &lt; 10&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;a &gt;= 10&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>else() 和 endif() 括号中的内容可以为空，但如果需要指定，则就必须与 if 中的条件完全一致，如下面示例所示：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(a <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a <span class="keyword">LESS</span> <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;a &lt; 10&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>(a <span class="keyword">LESS</span> <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;a &gt;= 10&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>(a <span class="keyword">LESS</span> <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>我们通常不在 else() 和 endif() 中指定条件，因为这样太繁琐了。</p>
<h3 id="真值与假值"><a href="#真值与假值" class="headerlink" title="真值与假值"></a>真值与假值</h3><p>何为真，何为假，人生真真假假，难以分辨，程序的真假却清清楚楚。</p>
<p>下列常量始终为真（不区分大小写）：</p>
<ul>
<li>1 和其他非零数字（包含浮点型），如 1、2、3.14</li>
<li>ON</li>
<li>YES</li>
<li>TRUE</li>
<li>Y</li>
</ul>
<p>下列常量始终为假（不区分大小写）：</p>
<ul>
<li>0</li>
<li>OFF</li>
<li>NO</li>
<li>FALSE</li>
<li>N</li>
<li>IGNORE</li>
<li>NOTFOUND</li>
<li>空字符串</li>
<li>被引号包裹的字符串（除始终为真的字符串外，如 TRUE、Y 等）</li>
</ul>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>在 CMake 中，逻辑运算符的与、或、非分别使用 AND、OR、NOT 表示。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> &lt;condition&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(&lt;cond1&gt; <span class="keyword">AND</span> &lt;cond2&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(&lt;cond1&gt; <span class="keyword">OR</span> &lt;cond2&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((condition) <span class="keyword">AND</span> (condition <span class="keyword">OR</span> (condition)))</span><br></pre></td></tr></table></figure>

<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p>由于 CMake 变量都是以字符串类型存储的，因此即便是数字也不能直接使用 <code>&gt;</code>、<code>&lt;</code>、<code>==</code> 这样的运算符来直接比较。</p>
<p>针对数值类型，CMake 支持的关系运算符如下：</p>
<ul>
<li>LESS  小于</li>
<li>LESS_EQUAL  小于等于</li>
<li>GREATER  大于</li>
<li>GREATER_EQUAL  大于等于</li>
<li>EQUAL  等于</li>
</ul>
<p>CMake 还支持字符串比较，即从左到右依次比较字符串中的每个字符，出现不相同时立即返回，类似于 C 语言中的 strcmp 函数。</p>
<ul>
<li>STRLESS  </li>
<li>STRLESS_EQUAL </li>
<li>STRGREATER </li>
<li>STRGREATER_EQUAL </li>
<li>STREQUAL</li>
</ul>
<h3 id="存在性校验"><a href="#存在性校验" class="headerlink" title="存在性校验"></a>存在性校验</h3><p>CMake 提供了一些判断变量是否定义、目标是否创建、元素是否存在于列表中、文件&#x2F;目录是否存在等方法。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给定名称是否是可以调用的指令</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">COMMAND</span> &lt;<span class="keyword">command</span>-name&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定名称是否是已创建的目标，即通过add_executable()、add_library() 或 add_custom_target() 命令创建</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">TARGET</span> &lt;<span class="keyword">target</span>-name&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定名称的普通变量、缓存变量、环境变量是否已定义</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">DEFINED</span> &lt;name&gt;|CACHE&#123;&lt;name&gt;&#125;|ENV&#123;&lt;name&gt;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定的元素是否包含在列表中</span></span><br><span class="line"><span class="keyword">if</span>(&lt;variable|<span class="keyword">string</span>&gt; <span class="keyword">IN_LIST</span> &lt;variable&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定的文件或目录是否存在</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">EXISTS</span> &lt;path-to-<span class="keyword">file</span>-<span class="keyword">or</span>-directory&gt;)</span><br></pre></td></tr></table></figure>

<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>CMake 有两种循环方式：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/foreach.html">foreach</a>  </li>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/while.html">while</a></li>
</ul>
<p>二者都可以使用 break() 提前退出循环和 continue() 跳过本次循环。</p>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p>下面是 foreach 的基本语法形式，这种形式在之前的“遍历列表”章节已经使用到了：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(&lt;loop_var&gt; &lt;items&gt;)</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(_ITEM <span class="variable">$&#123;MY_LIST&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_ITEM&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<p>foreach 还支持下面两种语法形式，这两种形式都不需要指定列表 <code>&lt;items&gt;</code> 参数，作用类似于 C 语言中的 for 语句：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 循环 [0 ~ &lt;stop&gt;]，步长为 1</span></span><br><span class="line"><span class="keyword">foreach</span>(&lt;loop_var&gt; RANGE &lt;stop&gt;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环 [&lt;start&gt; ~ &lt;stop&gt;]，步长为 &lt;step&gt;（可选）</span></span><br><span class="line"><span class="keyword">foreach</span>(&lt;loop_var&gt; RANGE &lt;start&gt; &lt;stop&gt; [&lt;step&gt;])</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(_I RANGE <span class="number">3</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_I&#125;&quot;</span>) <span class="comment"># 依次输出 0 1 2 3</span></span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(_I RANGE <span class="number">2</span> <span class="number">5</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_I&#125;&quot;</span>) <span class="comment"># 依次输出 2 3 4 5</span></span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(_I RANGE <span class="number">2</span> <span class="number">5</span> <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;$&#123;_I&#125;&quot;</span>) <span class="comment"># 依次输出 2 4</span></span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p>while 的语法形式如下，其中 <code>&lt;condition&gt;</code> 为真时（参考 if 条件判断章节），执行代码块中的 commands 命令。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(&lt;condition&gt;)</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endwhile</span>()</span><br></pre></td></tr></table></figure>

<p>下面示例演示了如何使用 while 来遍历列表：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_LIST <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>)</span><br><span class="line"><span class="keyword">list</span>(LENGTH MY_LIST LIST_COUNT)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(INDEX <span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span>(INDEX <span class="keyword">LESS</span> LIST_COUNT)</span><br><span class="line">  <span class="keyword">list</span>(GET MY_LIST <span class="variable">$&#123;INDEX&#125;</span> VALUE) <span class="comment"># 获取 $&#123;INDEX&#125; 位置的元素</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;element at $&#123;INDEX&#125; = $&#123;VALUE&#125;&quot;</span>)</span><br><span class="line">  <span class="keyword">math</span>(EXPR INDEX <span class="string">&quot;$&#123;INDEX&#125; + 1&quot;</span>) <span class="comment"># 自增 INDEX</span></span><br><span class="line"><span class="keyword">endwhile</span>()</span><br></pre></td></tr></table></figure>

<p>上面示例依次输出如下内容：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element at 0 = 1</span><br><span class="line">element at 1 = 2</span><br><span class="line">element at 2 = 3</span><br></pre></td></tr></table></figure>


<h2 id="函数和宏"><a href="#函数和宏" class="headerlink" title="函数和宏"></a>函数和宏</h2><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/function.html">function</a> 定义函数：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(&lt;name&gt; [&lt;arg1&gt; ...])</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>函数有自己的作用域，而宏没有自己的作用域，在函数体里面定义的普通变量默认只能在函数体中被访问，除非在定义时指定了 <code>PARENT_SCOPE</code> 选项，或者改为定义缓存变量、环境变量。</p>
<p>函数在被调用时，函数名是不区分大小写的，如我们定义了名为 <code>foo</code> 的函数，就可以使用 <code>foo()</code>、<code>Foo()</code>、<code>FOO()</code> 等形式来调用，但我们还是建议保持与函数定义时的名称一致。</p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>关于函数的参数，我们可以在定义函数时就指定各个参数的名称，如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(my_func NAME AGE)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;name: $&#123;NAME&#125;&quot;</span>) <span class="comment"># name: jack </span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;age: $&#123;AGE&#125;&quot;</span>) <span class="comment"># age: 18</span></span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">my_func(<span class="string">&quot;jack&quot;</span> <span class="number">18</span>)</span><br></pre></td></tr></table></figure>

<p>在调用函数时，调用参数（实参）的个数可以超过定义的参数个数（形参），但不能少于定义的参数个数，否则会报错。超出的参数，可以通过下面的形式获取：</p>
<ul>
<li>使用 <code>ARGV0</code>, <code>ARGV1</code>, <code>ARGV2</code>, <code>...</code> 变量获取函数的每个参数。</li>
<li>使用 <code>ARGV</code> 变量获取函数的参数列表，通过 <code>ARGN</code> 变量获取参数的个数。</li>
</ul>
<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>使用 <code>return()</code> 可以从函数体中提前返回，但不能直接使用 return() 带出返回值，需要借用 <code>set(&lt;variable&gt; &lt;value&gt; PARENT_SCOPE)</code> 方式，来间接的带出返回值。</p>
<p>下面示例演示了函数的定义、调用、参数的获取以及返回值的用法。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(my_func NAME AGE)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;name: $&#123;NAME&#125;&quot;</span>) <span class="comment"># name: jack</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;parameter count: $&#123;ARGC&#125;&quot;</span>) <span class="comment"># parameter count: 3</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;parameter list: $&#123;ARGV&#125;&quot;</span>) <span class="comment"># parameter list: jack;18;Hubei</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;parameter 0: $&#123;ARGV0&#125;&quot;</span>) <span class="comment"># parameter 0: jack</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;parameter 2: $&#123;ARGV1&#125;&quot;</span>) <span class="comment"># parameter 2: Hubei</span></span><br><span class="line">  <span class="keyword">set</span>(FUNC_RET <span class="string">&quot;OK&quot;</span> PARENT_SCOPE)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">my_func(<span class="string">&quot;jack&quot;</span> <span class="number">18</span> <span class="string">&quot;Hubei&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;return value: $&#123;FUNC_RET&#125;&quot;</span>) <span class="comment"># return value: OK</span></span><br></pre></td></tr></table></figure>

<p>但在实际项目中，除需要传入不定个数的参数情况外，我们通常在定义函数时，就约定好了参数名称和返回参数的名称，如下面示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(my_func NAME AGE OUT_RET)</span><br><span class="line">  <span class="comment"># 使用 $&#123;NAME&#125; $&#123;AGE&#125; 访问参数</span></span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;name: $&#123;NAME&#125;&quot;</span>) <span class="comment"># name: jack</span></span><br><span class="line">  <span class="keyword">set</span>(OUT_RET <span class="string">&quot;OK&quot;</span> PARENT_SCOPE)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line">my_func(<span class="string">&quot;jack&quot;</span> <span class="number">18</span> OUT_RET)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;return value: $&#123;OUT_RET&#125;&quot;</span>) <span class="comment"># return value: OK</span></span><br></pre></td></tr></table></figure>

<h3 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h3><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/macro.html">macro</a> 定义宏：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">macro</span>(&lt;name&gt; [&lt;arg1&gt; ...])</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endmacro</span>()</span><br></pre></td></tr></table></figure>

<p>CMake 中的宏和 C 语言中的宏一样，是在调用处进行语句替换后再执行，因此在宏中使用 <code>return()</code> 时要格外小心，可能会终止整个脚本的执行。</p>
<p>建议优先使用函数。</p>
<h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><p>字符串操作由 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/string.html">string</a> 指令提供，详见官方文档。</p>
<h2 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h2><p>本节列举了在项目中经常用到的 CMake 内置变量。</p>
<ul>
<li><p>CMAKE_SOURCE_DIR<br>始终存储的是项目的根目录。</p>
</li>
<li><p>CMAKE_BINARY_DIR<br>始终存储的是项目的根构建目录。</p>
</li>
<li><p>PROJECT_SOURCE_DIR<br>与 CMAKE_SOURCE_DIR 一样，也始终存储的是项目的根目录，但该变量需要使用 project 创建项目以后，才会被定义。</p>
</li>
<li><p>PROJECT_BINARY_DIR<br>与 CMAKE_BINARY_DIR 一样，也始终存储的是项目的构建目录，但该变量需要使用 project 创建项目以后，才会被定义。</p>
</li>
<li><p>CMAKE_CURRENT_SOURCE_DIR<br>存储的是当前正在执行脚本所在的目录。</p>
</li>
<li><p>CMAKE_CURRENT_BINARY_DIR<br>一个工程中可能包括多个项目，每个项目的构建目录不同，该变量存储的是当前项目的构建目录。</p>
</li>
<li><p>CMAKE_CURRENT_LIST_FILE<br>当前脚本代码所在文件的完整路径。</p>
</li>
<li><p>CMAKE_CURRENT_LIST_LINE<br>当前脚本代码所在行数。</p>
</li>
<li><p>CMAKE_MODULE_PATH<br>通过设置改变变量，可以控制 CMake 查找 <code>.cmake</code> 文件的路径，在使用 <code>include</code> 时就可以直接使用文件名了。如：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(utils)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，当在 include 中仅指定了文件名时，不能再添加 <code>.cmake</code> 扩展名，否则会导致查找不到相应文件。</p>
</li>
<li><p>WIN32<br>在 Windows 系统上，定义该变量，值为 1。</p>
</li>
<li><p>APPLE<br>在 Apple 系统上，定义该变量，值为 1。</p>
</li>
<li><p>UNIX<br>在类 UNIX 系统上，定义该变量，值为 1。</p>
</li>
<li><p>CMAKE_SYSTEM_NAME<br>当前构建所选定目标系统，但该变量需要使用 project 创建项目以后，才会被定义。</p>
<p>该变量常见的值有：Android、iOS、Linux、FreeBSD、MSYS、Windows、Darwin，完整的列表见：<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/variable/CMAKE_SYSTEM_NAME.html">CMAKE_SYSTEM_NAME</a>。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;Linux&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: Linux &quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;Windows&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: Windows&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;FreeBSD&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: FreeBSD&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;Darwin&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: macOS&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;Android&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: Android&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span> (CMAKE_SYSTEM_NAME <span class="keyword">STREQUAL</span> <span class="string">&quot;iOS&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;current platform: iOS&quot;</span>)</span><br><span class="line"><span class="keyword">else</span> ()</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;other platform: $&#123;CMAKE_SYSTEM_NAME&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
</li>
<li><p>MSVC<br>当编译器是 Microsoft Visual C++ 的某个版本或模拟 Visual C++ cl 命令行语法的其他编译器时设置为 true。</p>
</li>
<li><p>MSVC_VERSION<br>正在使用的 Microsoft Visual C&#x2F;C++ 版本（如果有）。如果正在使用模拟 Visual C++ 的编译器，则此变量将设置为 _MSC_VER 预处理器定义所给定的模拟工具集版本。</p>
</li>
</ul>
<h1 id="目标的属性"><a href="#目标的属性" class="headerlink" title="目标的属性"></a>目标的属性</h1><h2 id="属性调试"><a href="#属性调试" class="headerlink" title="属性调试"></a>属性调试</h2><p>在介绍如何设置目标的属性之前，我们先学习一下如何调试输出目标属性，方便在开发中检查属性设置是否出错。</p>
<p>使用 CMakePrintHelpers 模块提供 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/CMakePrintHelpers.html">cmake_print_properties</a> 函数可以打印输出目标的属性，该函数的原型如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmake_print_properties(&lt;TARGETS       [&lt;target1&gt; ...] |</span><br><span class="line">                        SOURCES       [&lt;source1&gt; ...] |</span><br><span class="line">                        DIRECTORIES   [&lt;dir1&gt; ...]    |</span><br><span class="line">                        TESTS         [&lt;test1&gt; ...]   |</span><br><span class="line">                        CACHE_ENTRIES [&lt;entry1&gt; ...]  &gt;</span><br><span class="line">                       PROPERTIES [&lt;prop1&gt; ...]         )</span><br></pre></td></tr></table></figure>

<p>以打印输出目标的“包含目录”属性为例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(hello_cmake main.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(hello_cmake PRIVATE <span class="string">&quot;include&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(CMakePrintHelpers)</span><br><span class="line">cmake_print_properties(TARGETS hello_cmake PROPERTIES <span class="keyword">INCLUDE_DIRECTORIES</span>) </span><br></pre></td></tr></table></figure>

<p>输出： </p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Properties for TARGET hello_cmake:</span><br><span class="line">  hello_cmake.INCLUDE_DIRECTORIES = &quot;D:/cmake-sample/hello_cmake/include&quot;</span><br></pre></td></tr></table></figure>

<h2 id="包含目录"><a href="#包含目录" class="headerlink" title="包含目录"></a>包含目录</h2><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/target_include_directories.html">target_include_directories</a> 指定目标包含一个或多个目录。指定的目录路径可以是绝对路径也可以是相对路径，如果是相对路径，则该路径是相对于当前脚本文件的。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(&lt;<span class="keyword">target</span>&gt; [SYSTEM] [AFTER|BEFORE]</span><br><span class="line">  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]</span><br><span class="line">  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</span><br></pre></td></tr></table></figure>

<p>这就相当于在 Visual Studio 中设置“附加包含目录”。</p>
<p><img data-src="/images/blog/6zoF01MV26-TinyTu.png"></p>
<p>可以针对一个目标重复调用 target_include_directories，会按照调用顺序依次附加包含目录，也可以使用 BEFORE 选项，将本次设置的包含目录插入到最前面。</p>
<p>我们需要特别花精力理解 INTERFACE、PUBLIC、PRIVATE 三者的区别，这三者的区别，我们先按下不表，稍后介绍。</p>
<p>在使用 PUBLIC、PRIVATE 设置包含目录时，会自动设置 <code>INCLUDE_DIRECTORIES</code> 属性；在使用 INTERFACE 设置包含目录时，会自动设置 <code>INTERFACE_INCLUDE_DIRECTORIES</code> 属性。</p>
<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(hello_cmake </span><br><span class="line">	PUBLIC <span class="string">&quot;include&quot;</span></span><br><span class="line">	PRIVATE <span class="string">&quot;./extern/jsoncpp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(hello_cmake BEFORE</span><br><span class="line">	PUBLIC <span class="string">&quot;include&quot;</span></span><br><span class="line">	PRIVATE <span class="string">&quot;./extern/rpclib&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="预编译宏"><a href="#预编译宏" class="headerlink" title="预编译宏"></a>预编译宏</h2><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html">target_compile_definitions</a> 设置目标的预编译宏。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_compile_definitions</span>(&lt;<span class="keyword">target</span>&gt;</span><br><span class="line">  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]</span><br><span class="line">  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</span><br></pre></td></tr></table></figure>

<p>可以针对一个目标重复调用 target_compile_definitions，附加多个预编译宏。</p>
<p>使用 PUBLIC、PRIVATE 设置包含目录时，会自动设置 <code>COMPILE_DEFINITIONS</code> 属性；使用 INTERFACE 设置包含目录时，会自动设置 <code>INTERFACE_COMPILE_DEFINITIONS</code> 属性。</p>
<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义2个预编译宏</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(hello_cmake</span><br><span class="line">	PUBLIC USING_BOOST USING_THRIFT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再定义一个预编译宏</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(hello_cmake</span><br><span class="line">	INTERFACE USING_ZLIB)</span><br></pre></td></tr></table></figure>

<h2 id="依赖库"><a href="#依赖库" class="headerlink" title="依赖库"></a>依赖库</h2><p>使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html">target_link_libraries</a> 指令设置目标的依赖库，该指令有很多原型，但常用的原型有：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt;</span><br><span class="line">                     [&lt;PRIVATE|PUBLIC|INTERFACE&gt; &lt;item&gt;...]</span><br><span class="line">                     [&lt;PRIVATE|PUBLIC|INTERFACE&gt; &lt;item&gt;...]...)</span><br></pre></td></tr></table></figure>

<p>item 可以是如下几种类型：</p>
<ul>
<li>lib 文件的绝对路径或相对路径，CMake 不会校验文件是否存在</li>
<li>其他的 CMake 目标。</li>
<li>表达式生成器（见“生成器表达式”章节）。</li>
<li>以 <code>-</code> 开头的链接标志，但从 CMake 3.13 版本开始，可以直接使用 <code>target_link_options()</code> 替代。</li>
</ul>
<p>可以针对一个目标重复调用 target_link_libraries，附加多个依赖库。</p>
<p><code>&lt;PRIVATE|PUBLIC|INTERFACE&gt;</code> 可以省略，如果省略，则默认为 PUBLIC。</p>
<p>使用 PUBLIC、PRIVATE 设置依赖库时，会自动设置 <code>LINK_LIBRARIES</code> 属性；使用 INTERFACE 设置依赖库时，会自动设置 <code>INTERFACE_LINK_LIBRARIES</code> 属性。</p>
<h2 id="INTERFACE、PUBLIC-和-PRIVATE"><a href="#INTERFACE、PUBLIC-和-PRIVATE" class="headerlink" title="INTERFACE、PUBLIC 和 PRIVATE"></a>INTERFACE、PUBLIC 和 PRIVATE</h2><p>INTERFACE、PUBLIC 和 PRIVATE 用于指定属性的可见性传递方案。</p>
<table>
<thead>
<tr>
<th>目标类型</th>
<th>可见性传递</th>
<th>自身是否应用该属性</th>
<th>使用者是否应用该属性</th>
</tr>
</thead>
<tbody><tr>
<td>可执行文件</td>
<td>INTERFACE</td>
<td>否</td>
<td>否（可执行文件不存在使用者）</td>
</tr>
<tr>
<td>可执行文件</td>
<td>PUBLIC</td>
<td>是</td>
<td>否（可执行文件不存在使用者）</td>
</tr>
<tr>
<td>可执行文件</td>
<td>PRIVATE</td>
<td>是</td>
<td>否（可执行文件不存在使用者）</td>
</tr>
<tr>
<td>库（动态或静态）</td>
<td>INTERFACE</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>库（动态或静态）</td>
<td>PUBLIC</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>库（动态或静态）</td>
<td>PRIVATE</td>
<td>是</td>
<td>否</td>
</tr>
</tbody></table>
<h2 id="编译和链接选项"><a href="#编译和链接选项" class="headerlink" title="编译和链接选项"></a>编译和链接选项</h2><p>通过 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/target_compile_options.html">target_compile_options</a> 指令设置编译选项。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_compile_options</span>(&lt;<span class="keyword">target</span>&gt; [BEFORE]</span><br><span class="line">  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]</span><br><span class="line">  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</span><br></pre></td></tr></table></figure>

<p>通过 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/target_link_options.html">target_link_options</a> 指令设置链接选项。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_options</span>(&lt;<span class="keyword">target</span>&gt; [BEFORE]</span><br><span class="line">  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]</span><br><span class="line">  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</span><br></pre></td></tr></table></figure>

<p>这两个指令的用法与前面介绍的 target_include_directories 类似。</p>
<p>示例：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译选项</span></span><br><span class="line"><span class="keyword">target_compile_options</span>(my_lib PRIVATE /utf8)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接选项</span></span><br><span class="line"><span class="keyword">target_link_options</span>(app PRIVATE /NOLOGO)</span><br></pre></td></tr></table></figure>

<h2 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a>其他属性</h2><p>CMake 为目标还提供了其他属性，详见 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html#target-properties">target-properties</a> ，总计约有 400 多个，涵盖了开发中会用到的绝大多数属性，例如其中以 VS_ 开头的属性是专门为 Visual Studio 所准备的。</p>
<p>针对这些属性，需要使用 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/command/set_target_properties.html">set_target_properties</a> 指令进行设置。</p>
<p>例如，使用 OUTPUT_NAME 和 DEBUG_OUTPUT_NAME 设置目标的输出文件名。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(zoe PROPERTIES </span><br><span class="line">	OUTPUT_NAME Zoe</span><br><span class="line">	DEBUG_OUTPUT_NAME Zoe-d)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/buycoffie.png" alt="jiangxueqiao.com 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>jiangxueqiao.com
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://jiangxueqiao.com/post/3678619994.html" title="Modern CMake 简明教程（上）">https://jiangxueqiao.com/post/3678619994.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/CMake/" rel="tag"># CMake</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/3832899600.html" rel="prev" title="绘制Windows的界面：探索窗口、GDI与GDI+的图形世界">
                  <i class="fa fa-angle-left"></i> 绘制Windows的界面：探索窗口、GDI与GDI+的图形世界
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/2304457467.html" rel="next" title="Modern CMake 简明教程（中）">
                  Modern CMake 简明教程（中） <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鄂ICP备2020015399号-6 </a>
  </div>
  <div class="copyright">
    &copy; 2017 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-rocket"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">jiangxueqiao.com</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">255k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">15:29</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"winsoft666","repo":"blog-comment","client_id":"Ov23libVrm4js5jotUI4","client_secret":"ab2e3a6d1daa72bfcb968ff049246f8df2ce8988","admin_user":"winsoft666","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"cea35e71e013721b5c641a4b570a4d15"}</script>
<script src="/js/third-party/comments/gitalk.js" defer></script>

</body>
</html>
