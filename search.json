[{"title":"è°ˆä¸€è°ˆQtçš„å¸ƒå±€æŠ€å·§","path":"/post/1495821570.html","content":"1. æ‰‹åŠ¨æ‹–æ”¾é€šè¿‡åœ¨ Qt Designer ä¸­æ‰‹åŠ¨æ‹–æ”¾æ§ä»¶ï¼Œå¯ä»¥å¿«é€Ÿå®ç°ç•Œé¢å¸ƒå±€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™ç§æ–¹å¼éå¸¸é€‚åˆåˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ï¼Œä½†è¿™å¹¶ä¸æ˜¯ Qt ç•Œé¢å¸ƒå±€çš„å…¨éƒ¨ï¼Œå› ä¸ºè¿™ç§æ–¹å¼ä»…é€‚åˆç®€å•çš„ç•Œé¢å¸ƒå±€ã€‚ åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œç•Œé¢ä¸Šçš„æ§ä»¶ä¼šæ¯”ä¸Šé¢ç¤ºä¾‹ä¸­çš„å¤šå¾—å¤šã€å¸ƒå±€ä¹Ÿä¼šç›¸å¯¹å¤æ‚ï¼Œè€Œä¸”ç•Œé¢é€šå¸¸è¿˜éœ€è¦åå¤åœ°è°ƒæ•´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç»§ç»­é€šè¿‡æ‰‹åŠ¨æ‹–æ”¾çš„æ–¹å¼æ¥è¿›è¡Œå¸ƒå±€ï¼Œåœ¨æ¯æ¬¡ç•Œé¢è°ƒæ•´æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰“ç ´ï¼ˆåˆ†æ‹†ï¼‰åŸæœ‰å¸ƒå±€ï¼Œå¹¶åœ¨ä¿®æ”¹å®Œæˆåé‡æ–°è¿›è¡Œå¸ƒå±€ï¼Œå¯èƒ½è¿˜éœ€è¦é‡æ–°è®¾ç½®å¸ƒå±€çš„ Spacing å’Œ ContentsMarginsï¼Œæ¯ä¸€æ¬¡ä¿®æ”¹éƒ½éå¸¸è´¹åŠ²ã€‚ æ‰‹åŠ¨æ‹–æ”¾æ§ä»¶å¯¹æ‰‹çš„ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜ï¼Œå¯èƒ½æ‰‹ç¨ä¸€æŠ–ï¼Œæ•´ä¸ªå¸ƒå±€å°±é”™ä¹±äº†ï¼Œåˆå¾—è¿˜åŸäº†é‡æ–°æ¥ã€‚ 2. ä»£ç å¸ƒå±€åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘é€šå¸¸ä½¿ç”¨ä»£ç çš„æ–¹å¼æ¥å¸ƒå±€ç•Œé¢ï¼Œä¸‹é¢çš„ä»£ç å®ç°äº†ä¸ä¸Šé¢ç¤ºä¾‹ä¸€æ ·çš„å¸ƒå±€æ•ˆæœï¼š 12345678910111213141516171819202122232425262728QLabel* lblUserName = new QLabel(&quot;ç”¨æˆ·å: &quot;);QLabel* lblPassword = new QLabel(&quot;å¯†ç : &quot;);QLineEdit* editUserName = new QLineEdit();QLineEdit* editPassword = new QLineEdit();QPushButton* btnLogin = new QPushButton(&quot;ç™»å½•&quot;);QPushButton* btnRegister = new QPushButton(&quot;æ³¨å†Œ&quot;);QHBoxLayout* hUserName = new QHBoxLayout();hUserName-&gt;addWidget(lblUserName);hUserName-&gt;addWidget(editUserName);QHBoxLayout* hPassword = new QHBoxLayout();hPassword-&gt;addWidget(lblPassword);hPassword-&gt;addWidget(editPassword);QHBoxLayout* hButton = new QHBoxLayout();hButton-&gt;addStretch();hButton-&gt;addWidget(btnRegister);hButton-&gt;addWidget(btnLogin);hButton-&gt;addStretch();QVBoxLayout* vMain = new QVBoxLayout();vMain-&gt;addLayout(hUserName);vMain-&gt;addLayout(hPassword);vMain-&gt;addStretch();vMain-&gt;addLayout(hButton);this-&gt;setLayout(vMain); ä»ä¸Šé¢çš„ä»£ç è¡Œæ•°æ¥çœ‹ï¼Œé€šè¿‡ä»£ç å¸ƒå±€çš„ç¡®æ¯”æ‹–åŠ¨æ§ä»¶æ‰€èŠ±çš„æ—¶é—´æ›´å¤šï¼Œä½†è¿™ç§æ–¹å¼çš„å¥½å¤„ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œæ¯”å¦‚çµæ´»æ€§æ›´å¤§ï¼ŒåæœŸè°ƒæ•´å’Œç»´æŠ¤ä¹Ÿæ›´æ–¹ä¾¿ï¼Œè€Œä¸”å¯¹äºè‡ªå®šä¹‰æ§ä»¶æ¯”è¾ƒå¤šçš„ç•Œé¢ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥åˆ›å»ºå¯¹åº”ç±»å‹çš„å®ä¾‹ï¼Œä¸éœ€è¦åœ¨è®¾è®¡å™¨ä¸Šè¿›è¡Œç±»å‹æå‡ã€‚ 3. å¸ƒå±€æè¿°è¯­è¨€æˆ‘åœ¨æ­¤ä¸æ˜¯ä¸ºäº†åˆ›é€ ä¸€ç§æ–°çš„è¯­è¨€ï¼Œè€Œæ˜¯å—åˆ°äº† Flutter ç•Œé¢å¸ƒå±€æ–¹å¼çš„å¯å‘ï¼Œå¯¹ Qt çš„å¸ƒå±€è¿›è¡Œäº†å°è£…ï¼Œç®€åŒ–äº†ä¸Šè¿°å¸ƒå±€ä»£ç ã€‚ ä¸‹é¢æ˜¯ç®€åŒ–åçš„å¸ƒå±€ä»£ç ï¼š 1234567auto layout = VBox( HBox(lblUserName, editUserName), HBox(lblPassword, editPassword), Stretch(), HBox(Stretch(), btnRegister, btnLogin, Stretch()));setLayout(layout); ä»£ç é‡æ˜æ˜¾å°‘äº†å¾ˆå¤šï¼Œè€Œä¸”è¿˜è¿˜å¯ä»¥é€šè¿‡ä»£ç çš„å±‚æ¬¡ç»“æ„æ¥ä½“ç°å‡ºç•Œé¢çš„å¸ƒå±€ç»“æ„ã€‚ å¦‚æœæ‚¨å¯¹ä¸Šè¿° Qt å¸ƒå±€çš„å…·ä½“å®ç°æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨ä¸‹é¢ç•™è¨€æˆ–è€…è”ç³»æˆ‘ã€‚","tags":["Qt"],"categories":["Qt"]},{"title":"C++å¼‚å¸¸ä¹‹æˆ‘æ‰€è§","path":"/post/1878135693.html","content":"C++å¼‚å¸¸æ‰€å¸¦æ¥çš„é—®é¢˜å½“æˆ‘ä»¬åœ¨ä»£ç ä¸­å†™ä¸‹ä¸€è¡Œ throw è¯­å¥æ—¶ï¼Œæˆ‘ä»¬å°±æ­¤åŸ‹ä¸‹äº†ä¸€ä¸ªç¥¸æ ¹ï¼Œä»æ­¤ä»¥åï¼Œåœ¨è¯¥å‡½æ•°è°ƒç”¨é“¾ä¸­ï¼Œå¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªè°ƒç”¨è€…éœ€è¦æä¾›ç›¸åº”çš„å¼‚å¸¸æ•è·ï¼Œå¦åˆ™ä¸€æ—¦å¼‚å¸¸è¢«æŠ›å‡ºï¼Œç¨‹åºå°±ä¼šå¼‚å¸¸ç»ˆæ­¢ã€‚ ä¾‹å¦‚ï¼Œå‡½æ•° f() è°ƒç”¨ g()ï¼Œè€Œ g() åˆè°ƒç”¨ h()ï¼Œå¹¶ä¸” h() æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œåˆ™ g() å’Œ f()ä¸­å¿…é¡»æœ‰ä¸€ä¸ªæä¾›äº†ç›¸åº”çš„å¼‚å¸¸æ•è·ï¼Œå¦åˆ™ç¨‹åºä¼šå¼‚å¸¸ç»ˆæ­¢ã€‚ ç”±äºå¼‚å¸¸å¯ä»¥ä½¿ä»£ç æ‰§è¡Œæµç¨‹ä»ä»»æ„åœ°æ–¹è·³å‡ºï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦ä»˜å‡ºå¤§é‡çš„ç²¾åŠ›æ¥ç¼–å†™æ­£ç¡®çš„å¼‚å¸¸å®‰å…¨ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰æ¥ä¿è¯èµ„æºæ­£ç¡®é‡Šæ”¾ã€‚ å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨å‡½æ•° f() ä¸­æ•è·äº†å¼‚å¸¸ï¼Œé¿å…äº†ç¨‹åºçš„å¼‚å¸¸ç»ˆæ­¢ï¼Œä½†å¼‚å¸¸å´ä¸­æ–­äº†å‡½æ•° g() çš„æ­£å¸¸æ‰§è¡Œæµç¨‹ï¼Œå¯¼è‡´å¯¹è±¡ m æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾ï¼Œä»è€Œå‡ºç°äº†èµ„æºæ³„éœ²ã€‚è¿™ç§æƒ…å†µå¯èƒ½è¿˜ä¼šå˜ç›¸åœ°å¢åŠ äº†ç¨‹åºçš„è°ƒè¯•éš¾åº¦ã€‚ 1234567891011121314151617181920212223void h() &#123; throw std::exception();&#125;void g() &#123; int* m = new int(); h(); delete m;&#125;void f() &#123; try &#123; g(); &#125; catch (...) &#123; &#125;&#125;int main()&#123; f(); return 0;&#125; å¯ç”¨å¼‚å¸¸è¿˜ä¼šåœ¨æ¯ä¸ªç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ·»åŠ é¢å¤–çš„æ•°æ®ï¼Œä»è€Œå¢åŠ ç¼–è¯‘æ—¶é—´ï¼ˆå¯èƒ½åªæ˜¯ç•¥å¾®å¢åŠ ï¼‰å¹¶å¯èƒ½å¢åŠ åœ°å€ç©ºé—´çš„ä½¿ç”¨ã€‚ å¼‚å¸¸çš„å­˜åœ¨å¯èƒ½ä¼šå¯¼è‡´å¼€å‘äººå‘˜æ»¥ç”¨å¼‚å¸¸ï¼Œåœ¨æœ¬ä¸è¯¥ï¼ˆæˆ–ä¸éœ€è¦ï¼‰æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹æŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œæ— æ•ˆçš„ç”¨æˆ·è¾“å…¥å°±ä¸åº”æŠ›å‡ºå¼‚å¸¸ã€‚ å³ä¾¿æˆ‘ä»¬æ•è·äº†å¼‚å¸¸ï¼Œæˆ‘ä»¬ä¹Ÿå¾ˆéš¾ä»å¼‚å¸¸ä¸­æ¢å¤å›æ¥ï¼Œå› ä¸ºæˆ‘ä¸èƒ½ç¡®å®šå¼‚å¸¸å…·ä½“æ˜¯ä»è°ƒç”¨é“¾çš„å“ªä¸€æ­¥æŠ›å‡ºçš„ï¼Œä¹Ÿæ— æ³•çŸ¥æ™“æ¯ä¸€æ­¥çš„å®ç°é€»è¾‘ï¼Œå› æ­¤å¦‚æœç¨‹åºä¸­ä½¿ç”¨äº†å¼‚å¸¸ï¼Œæˆ‘ä»¬é™¤äº†åšå¥½å¿…è¦çš„å‚æ•°æ£€æŸ¥ï¼Œå°½é‡é¿å…å¼‚å¸¸å‘ç”Ÿï¼Œåœ¨å¼‚å¸¸è¢«æŠ›å‡ºæ—¶ï¼Œè®©ç¨‹åºè‡ªç„¶çš„é€€å‡ºä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ èƒ½å®Œå…¨é¿å…ä½¿ç”¨å¼‚å¸¸å—ï¼Ÿå¤ªéš¾äº†ï¼Œæˆ‘ä»¬å¾ˆéš¾å®Œå…¨é¿å…ä½¿ç”¨å¼‚å¸¸ã€‚ åœ¨ C++ æ ‡å‡†åº“ï¼ˆSTLï¼‰ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µæ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸çš„å½¢å¼æ¥è¿”å›é”™è¯¯çš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¸å¦‚ EASTL è¿™æ ·çš„åº“æ¥æ›¿ä»£ STLï¼Œä½†ä»ç„¶å¾ˆéš¾é¿å…ç¨‹åºä½¿ç”¨çš„å…¶ä»–åº“ä¸ä¼šä½¿ç”¨ STL ä»¥åŠæŠ›å‡ºå¼‚å¸¸ï¼Œæ¯”å¦‚å¸¸ç”¨çš„æ—¥å¿—åº“ spldlogã€booståº“ã€rpclibåº“ç­‰éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ å› æ­¤è¦å®Œå…¨çš„ä¸ä½¿ç”¨å¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦ä»å¤´å®ç°ä¼—å¤šçš„åŸºç¡€ç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å·¥ä½œé‡ã€‚ æŠ˜ä¸­çš„åŠæ³•è™½ç„¶æˆ‘ä»¬å¾ˆéš¾å®Œå…¨é¿å…å¼‚å¸¸ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åŠªåŠ›è¿œç¦»å¼‚å¸¸çš„ã€‚ ä¸‹é¢æ˜¯æˆ‘çš„ä¸€ç‚¹ç‚¹å»ºè®®ï¼š å¯ä»¥ä½¿ç”¨ EASTL æ›¿ä»£ STLï¼Œæˆ–è€…ä»…ä½¿ç”¨ STL ä¸­ä¸æŠ›å‡ºå¼‚å¸¸çš„æ¨¡å—ã€‚ åœ¨é€‰æ‹©ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œå°½é‡é€‰æ‹©ä¸ä½¿ç”¨å¼‚å¸¸çš„åº“ï¼Œé€šå¸¸ C è¯­è¨€å¼€å‘çš„åº“ä¸ä¼šä½¿ç”¨å¼‚å¸¸ï¼Œå¦‚ curlã€zlog ç­‰ï¼Œä½†éœ€è¦ç•™æ„æœ‰äº› C è¯­è¨€åº“å¯èƒ½ä¼šä½¿ç”¨ exit å’Œ abort å‡½æ•°ã€‚ ä¿è¯è‡ªå·±ç¼–å†™çš„ä»£ç ä¸ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œä¾‹å¦‚å‡½æ•°é€šè¿‡è¿”å›å€¼çš„å½¢å¼è¿”å›é”™è¯¯ï¼Œå¹¶ä¸”å°½å¯èƒ½ä½¿ç”¨ C++ 17 ä¸­çš„[[nodiscard]]ï¼Œå¼ºåˆ¶è°ƒç”¨è€…æ£€æŸ¥è¿”å›å€¼ã€‚ä½†åº”é¿å…ä½¿ç”¨å…¨å±€çŠ¶æ€å˜é‡ï¼Œå¦‚ Windows çš„ LastErrorï¼Œå› ä¸ºè¿™æ ·ä¼šç ´åå‡½æ•°è°ƒç”¨çš„å±€éƒ¨æ€§ã€‚ æ„é€ å‡½æ•°ä¹Ÿå¯èƒ½ä¼šå¤±è´¥ï¼Œä½†æˆ‘ä»¬ä¸åº”ä½¿ç”¨å¼‚å¸¸æ¥æŠ›å‡ºé”™è¯¯ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤æ­¥æ„é€ æ³•ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­åªåšåŸºæœ¬çš„ã€ä¸ä¼šå‡ºé”™ã€ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„æ“ä½œæˆ–è€…ç›´æ¥ä½¿ç”¨ç©ºçš„æ„é€ å‡½æ•°ï¼Œç„¶åæä¾›ä¸€ä¸ªå•ç‹¬çš„ init å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶è¿”å›é”™è¯¯ç ã€‚ å¼‚å¸¸æ•è·çš„ç²’åº¦ä¸å®œå¤ªç»†ï¼Œå¦‚æœå¯¹æ¯ä¸€è¡Œå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„è¯­å¥éƒ½è¿›è¡Œå¼‚å¸¸æ•è·ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç è¿‡äºç¹çã€‚å¦‚æœç²’åº¦å¤ªç²—ï¼Œåˆä¼šå¯¼è‡´å¼‚å¸¸éš¾äºæ¢å¤ï¼Œå¤±å»äº†æ•è·çš„æ„ä¹‰ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œåœ¨è°ƒç”¨å‡½æ•°å‰ï¼Œå¯¹å‚æ•°è¿›è¡Œå……åˆ†åœ°æ£€æŸ¥ï¼Œå°½é‡é¿å…å¼‚å¸¸çš„å‘ç”Ÿï¼Œç„¶åä»…åœ¨å…³é”®ä»£ç ä½ç½®è¿›è¡Œå¼‚å¸¸æ•è·ã€‚","tags":["C++","å¼‚å¸¸"],"categories":["C++è¯­è¨€"]},{"title":"æœ‰è¶£çš„Unicodeè¡¨æƒ…ç¬¦å·","path":"/post/3984616957.html","content":"æœ¬æ–‡äº†è½¬è½½å’Œæ”¶é›†äº†ä¸€äº›å¸¸ç”¨çš„ Unicode è¡¨æƒ…ç¬¦å·ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚å®Œæ•´çš„ Unicode è¡¨æƒ…ç¬¦å·å¯ä»¥æŸ¥è¯¢ä¸‹é¢çš„ç½‘ç«™ï¼š unicodeå®˜ç½‘emojiåˆ—è¡¨ wikipedia List_of_emojis å‡ ä½•å›¾å½¢ğŸ€ğŸğŸ‚ğŸƒğŸ„ğŸ…ğŸ‡ğŸ‰ğŸŒğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğŸ˜ğŸšğŸ›ğŸœğŸğŸğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ââœ”âœ…â˜‘ï¸ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿ğŸŸ€ğŸŸ‚ğŸŸƒğŸŸ„ğŸŸ†ğŸŸ‡ğŸŸˆğŸŸ‰ğŸŸŠğŸŸŒğŸŸğŸŸğŸŸğŸŸ’ğŸŸ”ğŸŸ ğŸŸ¡ğŸŸ¢ğŸŸ£ğŸŸ¤ğŸŸ¥ğŸŸ¦ğŸŸ§ğŸŸ¨ğŸŸ©ğŸŸªğŸŸ« è¡¨æƒ…ğŸ¤—ğŸ¤«ğŸ¤£ğŸ™ƒğŸ™‚ğŸ¥°ğŸ¤©ğŸ¤ªğŸ¤‘ğŸ¤­ğŸ¤”ğŸ¤ğŸ¤¬ğŸ¥±ğŸ˜©ğŸ¥ºğŸ§ğŸ¤“ğŸ˜ğŸ¤ ğŸ¥³ğŸ˜µâ€ğŸ’«ğŸ¤¯ğŸ¤§ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤¢ğŸ¤®ğŸ¥µğŸ¥¶ğŸ¥´ğŸ¤¤ğŸ¤¥ğŸ¤¨ğŸ¤–ğŸ¤¡ğŸ’© ğŸ™ˆ ğŸ™‰ ğŸ™Š ğŸ˜€ğŸ˜ğŸ˜‚ğŸ˜ƒğŸ˜„ğŸ˜…ğŸ˜†ğŸ˜‰ğŸ˜ŠğŸ˜‹ğŸ˜ğŸ˜ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šâ˜ºğŸ˜‡ğŸ˜ğŸ˜‘ğŸ˜¶ğŸ˜ğŸ˜£ğŸ˜¥ğŸ˜®ğŸ˜¯ğŸ˜ªğŸ˜«ğŸ˜´ğŸ˜ŒğŸ˜›ğŸ˜œğŸ˜ğŸ˜’ğŸ˜“ğŸ˜”ğŸ˜•ğŸ˜²ğŸ˜·ğŸ˜–ğŸ˜ğŸ˜ŸğŸ˜¤ğŸ˜¢ğŸ˜­ğŸ˜¦ğŸ˜§ğŸ˜¨ğŸ˜¬ğŸ˜°ğŸ˜±ğŸ˜³ğŸ˜µğŸ˜¡ğŸ˜  æƒ…æ„ŸğŸ’‹ğŸ’¯ğŸ’¢ğŸ’¥ğŸ’«ğŸ’¦ğŸ’¨ğŸ•³ğŸ’¬ğŸ‘ï¸â€ğŸ—¨ï¸ğŸ—¨ğŸ—¯ğŸ’­ğŸ’¤ äººç‰©ğŸ‘¦ğŸ‘§ğŸ‘¨ğŸ‘©ğŸ‘´ğŸ‘µğŸ‘¶ğŸ‘±ğŸ‘®ğŸ‘²ğŸ‘³ğŸ‘·ğŸ‘¸ğŸ’‚ğŸ…ğŸ‘°ğŸ‘¼ğŸ’†ğŸ’‡ğŸ™ğŸ™ğŸ™…ğŸ™†ğŸ’ğŸ™‹ğŸ™‡ğŸ™ŒğŸ™ğŸ‘¤ğŸ‘¥ğŸš¶ğŸƒğŸ‘¯ğŸ’ƒğŸ‘«ğŸ‘¬ğŸ‘­ğŸ’ğŸ’‘ğŸ‘ª ä¸åŒè‚¤è‰²ã€å‘å‹ã€æ€§åˆ«çš„äººğŸ‘´ğŸ‘´ğŸ»ğŸ‘´ğŸ¼ğŸ‘´ğŸ½ğŸ‘´ğŸ¾ğŸ‘´ğŸ¿ğŸ’‡ğŸ¦°ğŸ¦±ğŸ¦³ğŸ¦²ğŸ§‘ğŸ‘¨ğŸ‘©ğŸ‘« æ‰‹åŠ¿ğŸ’ªğŸ‘ˆğŸ‘‰â˜ğŸ‘†ğŸ‘‡âœŒâœ‹ğŸ‘ŒğŸ‘ğŸ‘âœŠğŸ‘ŠğŸ‘‹ğŸ‘ğŸ‘âœ æ‰‹æœºç”µè¯ğŸ“±ğŸ“²ğŸ“¶ğŸ“³ğŸ“´â˜ğŸ“ğŸ“ŸğŸ“  å…¬å…±ç¤¾ä¼šâ™»ğŸ§ğŸš®ğŸš°â™¿ğŸš¹ğŸšºğŸš»ğŸš¼ğŸš¾âš ğŸš¸â›”ğŸš«ğŸš³ğŸš­ğŸš¯ğŸš±ğŸš·ğŸ”ğŸ’ˆ åŠ¨ç‰©ğŸ™ˆğŸ™‰ğŸ™ŠğŸµğŸ’ğŸ¶ğŸ•ğŸ©ğŸºğŸ±ğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾ğŸˆğŸ¯ğŸ…ğŸ†ğŸ´ğŸğŸ®ğŸ‚ğŸƒğŸ„ğŸ·ğŸ–ğŸ—ğŸ½ğŸğŸ‘ğŸğŸªğŸ«ğŸ˜ğŸ­ğŸğŸ€ğŸ¹ğŸ°ğŸ‡ğŸ»ğŸ¨ğŸ¼ğŸ¾ğŸ”ğŸ“ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¸ğŸŠğŸ¢ğŸğŸ²ğŸ‰ğŸ³ğŸ‹ğŸ¬ğŸŸğŸ ğŸ¡ğŸ™ğŸšğŸŒğŸ›ğŸœğŸğŸğŸ¦‹ æ¤ç‰©ğŸ’ğŸŒ¸ğŸ’®ğŸŒ¹ğŸŒºğŸŒ»ğŸŒ¼ğŸŒ·ğŸŒ±ğŸŒ²ğŸŒ³ğŸŒ´ğŸŒµğŸŒ¾ğŸŒ¿ğŸ€ğŸğŸ‚ğŸƒ è‡ªç„¶å¤©æ°”ğŸŒğŸŒğŸŒğŸŒğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒ™ğŸŒšğŸŒ›ğŸŒœâ˜€ğŸŒğŸŒâ­ğŸŒŸğŸŒ â˜â›…â˜”âš¡â„ğŸ”¥ğŸ’§ğŸŒŠ é£Ÿç‰©ğŸ‡ğŸˆğŸ‰ğŸŠğŸ‹ğŸŒğŸğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ…ğŸ†ğŸŒ½ğŸ„ğŸŒ°ğŸğŸ–ğŸ—ğŸ”ğŸŸğŸ•ğŸ³ğŸ²ğŸ±ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸ ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¡ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ‚ğŸ°ğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ¼â˜•ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ´ æ–‡ä½“ğŸªğŸ­ğŸ¨ğŸ°ğŸš£ğŸ›€ğŸ«ğŸ†âš½âš¾ğŸ€ğŸˆğŸ‰ğŸ¾ğŸ±ğŸ³â›³ğŸ£ğŸ½ğŸ¿ğŸ‚ğŸ„ğŸ‡ğŸŠğŸš´ğŸšµğŸ¯ğŸ®ğŸ²ğŸ·ğŸ¸ğŸºğŸ»ğŸ¬ ææ€–ğŸ˜ˆğŸ‘¿ğŸ‘¹ğŸ‘ºğŸ’€â˜ ğŸ‘»ğŸ‘½ğŸ‘¾ğŸ’£ åäºŒç”Ÿè‚–ğŸğŸ‚ğŸ…ğŸ‡ğŸ‰ğŸğŸğŸğŸ’ğŸ“ğŸ•ğŸ– æ—¶é’ŸğŸ•›ğŸ•§ğŸ•ğŸ•œğŸ•‘ğŸ•ğŸ•’ğŸ•ğŸ•“ğŸ•ŸğŸ•”ğŸ• ğŸ••ğŸ•¡ğŸ•–ğŸ•¢ğŸ•—ğŸ•£ğŸ•˜ğŸ•¤ğŸ•™ğŸ•¥ğŸ•šğŸ•¦âŒ›â³âŒšâ°â±â²ğŸ•° çˆ±å¿ƒâ¤ğŸ’ŒğŸ’â¤ï¸â€ğŸ”¥â¤ï¸â€ğŸ©¹ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤ğŸ’˜â¤ğŸ’“ğŸ’”ğŸ’•ğŸ’–ğŸ’—ğŸ’™ğŸ’šğŸ’›ğŸ’œğŸ’ğŸ’ğŸ’Ÿâ£ äº¤é€šğŸš‚ğŸšƒğŸš„ğŸš…ğŸš†ğŸš‡ğŸšˆğŸš‰ğŸšŠğŸšğŸšğŸš‹ğŸšŒğŸšğŸšğŸšğŸšğŸš‘ğŸš’ğŸš“ğŸš”ğŸš•ğŸš–ğŸš—ğŸš˜ğŸššğŸš›ğŸšœğŸš²â›½ğŸš¨ğŸš¥ğŸš¦ğŸš§âš“â›µğŸš£ğŸš¤ğŸš¢âœˆğŸ’ºğŸšğŸšŸğŸš ğŸš¡ğŸš€ åŠå…¬ğŸ“±ğŸ“²â˜ğŸ“ğŸ“ŸğŸ“ ğŸ”‹ğŸ”ŒğŸ’»ğŸ’½ğŸ’¾ğŸ’¿ğŸ“€ğŸ¥ğŸ“ºğŸ“·ğŸ“¹ğŸ“¼ğŸ”ğŸ”ğŸ”¬ğŸ”­ğŸ“¡ğŸ“”ğŸ“•ğŸ“–ğŸ“—ğŸ“˜ğŸ“™ğŸ“šğŸ““ğŸ“ƒğŸ“œğŸ“„ğŸ“°ğŸ“‘ğŸ”–ğŸ’³âœ‰ğŸ“§ğŸ“¨ğŸ“©ğŸ“¤ğŸ“¥ğŸ“¦ğŸ“«ğŸ“ªğŸ“¬ğŸ“­ğŸ“®âœâœ’ğŸ“ğŸ“ğŸ“‚ğŸ“…ğŸ“†ğŸ“‡ğŸ“ˆğŸ“‰ğŸ“ŠğŸ“‹ğŸ“ŒğŸ“ğŸ“ğŸ“ğŸ“âœ‚ğŸ”’ğŸ”“ğŸ”ğŸ”ğŸ”‘ ç®­å¤´â¬†â†—â¡â†˜â¬‡â†™â¬…â†–â†•â†”â†©â†ªâ¤´â¤µğŸ”ƒğŸ”„ğŸ”™ğŸ”šğŸ”›ğŸ”œğŸ” å…«å¦â˜°â˜±â˜²â˜³â˜´â˜µâ˜¶â˜· ä·€ä·ä·‚ä·ƒä·„ä·…ä·†ä·‡ä·ˆä·‰ä·Šä·‹ä·Œä·ä·ä·ä·ä·‘ä·’ä·“ä·”ä·•ä·–ä·—ä·˜ä·™ä·šä·›ä·œä·ä·ä·Ÿä· ä·¡ä·¢ä·£ä·¤ä·¥ä·¦ä·§ä·¨ä·©ä·ªä·«ä·¬ä·­ä·®ä·¯ä·°ä·±ä·²ä·³ä·´ä·µä·¶ä··ä·¸ä·¹ä·ºä·»ä·¼ä·½ä·¾ä·¿ æ‰‘å…‹ç‰ŒğŸ‚ ğŸ‚¡ğŸ‚¢ğŸ‚£ğŸ‚¤ğŸ‚¥ğŸ‚¦ğŸ‚§ğŸ‚¨ğŸ‚©ğŸ‚ªğŸ‚«ğŸ‚¬ğŸ‚­ğŸ‚®ğŸ‚±ğŸ‚²ğŸ‚³ğŸ‚´ğŸ‚µğŸ‚¶ğŸ‚·ğŸ‚¸ğŸ‚¹ğŸ‚ºğŸ‚»ğŸ‚¼ğŸ‚½ğŸ‚¾ğŸ‚¿ğŸƒğŸƒ‚ğŸƒƒğŸƒ„ğŸƒ…ğŸƒ†ğŸƒ‡ğŸƒˆğŸƒ‰ğŸƒŠğŸƒ‹ğŸƒŒğŸƒğŸƒğŸƒğŸƒ‘ğŸƒ’ğŸƒ“ğŸƒ”ğŸƒ•ğŸƒ–ğŸƒ—ğŸƒ˜ğŸƒ™ğŸƒšğŸƒ›ğŸƒœğŸƒğŸƒğŸƒŸğŸƒ ğŸƒ¡ğŸƒ¢ğŸƒ£ğŸƒ¤ğŸƒ¥ğŸƒ¦ğŸƒ§ğŸƒ¨ğŸƒ©ğŸƒªğŸƒ«ğŸƒ¬ğŸƒ­ğŸƒ®ğŸƒ¯ğŸƒ°ğŸƒ±ğŸƒ²ğŸƒ³ğŸƒ´ğŸƒµ éº»å°†ç‰ŒğŸ€€ğŸ€ğŸ€‚ğŸ€ƒğŸ€„ğŸ€…ğŸ€†ğŸ€‡ğŸ€ˆğŸ€‰ğŸ€ŠğŸ€‹ğŸ€ŒğŸ€ğŸ€ğŸ€ğŸ€ğŸ€‘ğŸ€’ğŸ€“ğŸ€”ğŸ€•ğŸ€–ğŸ€—ğŸ€˜ğŸ€™ğŸ€šğŸ€›ğŸ€œğŸ€ğŸ€ğŸ€ŸğŸ€ ğŸ€¡ğŸ€¢ğŸ€£ğŸ€¤ğŸ€¥ğŸ€¦ğŸ€§ğŸ€¨ğŸ€©ğŸ€ªğŸ€« å¤šç±³è¯ºéª¨ç‰ŒğŸ€°ğŸ€±ğŸ€²ğŸ€³ğŸ€´ğŸ€µğŸ€¶ğŸ€·ğŸ€¸ğŸ€¹ğŸ€ºğŸ€»ğŸ€¼ğŸ€½ğŸ€¾ğŸ€¿ğŸ€ğŸğŸ‚ğŸƒğŸ„ğŸ…ğŸ†ğŸ‡ğŸˆğŸ‰ğŸŠğŸ‹ğŸŒğŸğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡ğŸ¢ğŸ£ğŸ¤ğŸ¥ğŸ¦ğŸ§ğŸ¨ğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿ğŸ‚€ğŸ‚ğŸ‚‚ğŸ‚ƒğŸ‚„ğŸ‚…ğŸ‚†ğŸ‚‡ğŸ‚ˆğŸ‚‰ğŸ‚ŠğŸ‚‹ğŸ‚ŒğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚‘ğŸ‚’ğŸ‚“","tags":["Unicode","Emoji"],"categories":["çˆ±æŠ˜è…¾"]},{"title":"ç”Ÿæ´»å®¶ã€è½¬è½½ã€‘","path":"/post/1485983255.html","content":"ã€Šçº¢æ¥¼æ¢¦ã€‹ç¬¬äº”åå›ä¸­ï¼Œä¸€å¤œå¤§é›ªåï¼Œè´¾åºœå¤§è§‚å›­çš„å§å¦¹ä»¬ä¸€èµ·ä½œè¯—ï¼Œä¼—å§å¦¹è¦ç‹ç†™å‡¤ä¸ºå³æ™¯è”è¯—èµ·ä¸ªå¤´ã€‚ç‹ç†™å‡¤è™½åªè¯†å¾—å‡ ä¸ªå­—ï¼Œå€’ä¹Ÿä¸æ‰­æï¼Œç¬‘é“:â€œæˆ‘æƒ³ä¸‹é›ªå¿…åˆ®åŒ—é£ã€‚æ˜¨å¤œå¬è§äº†ä¸€å¤œçš„åŒ—é£ï¼Œæˆ‘æœ‰äº†ä¸€å¥ï¼Œå°±æ˜¯â€˜ä¸€å¤œåŒ—é£ç´§â€™ï¼Œå¯ä½¿å¾—?â€ä¼—äººå¬äº†ï¼Œéƒ½ç›¸è§†ç¬‘é“ï¼šâ€œè¿™å¥è™½ç²—ï¼Œä¸è§åº•ä¸‹çš„ï¼Œè¿™æ­£æ˜¯ä¼šä½œè¯—çš„èµ·æ³•ã€‚ä¸ä½†å¥½ï¼Œè€Œä¸”ç•™äº†å¤šå°‘åœ°æ­¥ä¸åäººâ€ã€‚ çš„ç¡®ï¼Œä¸å¤§è§‚å›­é‡Œæ‰å¥³ä»¬çš„é”¦å¿ƒç»£å£æ¯”èµ·æ¥ï¼Œâ€œä¸€å¤œåŒ—é£ç´§â€ç”šè‡³ç®—ä¸ä¸Šè¯—ã€‚ä¸è¿‡ï¼Œå‡¤å§è¯´å¾—æ²¡é”™ã€‚å¤§é›ªå°†è½ä¹‹æ—¶ï¼Œå¿…æ˜¯è¦åˆ®åŒ—é£çš„ã€‚å¥¹ä¸æ˜¯ä¼˜ç§€çš„è¯—äººï¼Œå´æ˜¯ä¸€ä½æ´å¯Ÿä¸–äº‹çš„ç”Ÿæ´»å®¶ã€‚ æˆå¹´åï¼Œæˆ‘ä¸çˆ¶äº²èŠèµ·å‡¤å§çš„â€œä¸€å¤œåŒ—é£ç´§â€ï¼Œæ¯äº²çªç„¶é—®ï¼šâ€œè¿™ä¸ªå‡¤å§æ˜¯ä¸æ˜¯ä¸€ä¸ªå‰å®³äººç‰©ï¼ŒæŒç®¡ç€æ•´ä¸ªå®¶æ—äº‹åŠ¡?â€æˆ‘åƒæƒŠåœ°ç‚¹å¤´ï¼Œæ¯äº²è§†åŠ›ä¸ä½³çœ‹ä¸æˆæˆæ–‡ï¼Œæ›´æ²¡æœ‰è¯»è¿‡ã€Šçº¢æ¥¼æ¢¦ã€‹ï¼Œå¥¹æ˜¯å¦‚ä½•å¾—çŸ¥çš„å‘¢ï¼Ÿæ¯äº²è§£é‡Š:â€œä½ æƒ³å•Šï¼Œåœ¨æ·±å®…å¤§é™¢ï¼Œç†Ÿç¡çš„äººæ ¹æœ¬å¬ä¸åˆ°å¤–é¢çš„åŠ¨é™ã€‚èƒ½å¬åˆ°ä¸€å¤œåŒ—é£çš„äººï¼Œè‚¯å®šæ˜¯æ—¥å¤œæ“åŠ³ã€å¿ƒé‡Œè£…ç€äº‹çš„äººå•Š!â€ æ¯äº²çš„è¯è®©æˆ‘æƒ³èµ·å°æ—¶å€™çš„æ— æ•°ä¸ªæ¸…æ™¨ï¼Œçœ‹åˆ°é™¢å­é‡Œæœ‰ä¸€æ‘Šæ‘Šæ°´æ¸ï¼Œæˆ‘å¥½å¥‡åœ°é—®çˆ¶æ¯:â€œæ˜¨æ™šä¸‹é›¨äº†å—ï¼Ÿâ€ï¼Œâ€œåˆæ˜¯åˆ®é£åˆæ˜¯ä¸‹é›¨çš„ï¼Œå‡Œæ™¨å››äº”ç‚¹é’Ÿæ‰åœã€‚â€çˆ¶æ¯å›ç­”ã€‚å½“æ—¶æˆ‘è¿˜çº³é—·å„¿ï¼šæˆ‘æ€ä¹ˆä¸€ç‚¹å„¿åŠ¨é™éƒ½æ²¡æœ‰å¬åˆ°å‘¢ï¼Ÿç°åœ¨æƒ³æ¥ï¼Œé‚£æ—¶å¹´å°‘æ— å¿§æ— è™‘ï¼Œä¸€è§‰é…£ç¡åˆ°å¤©äº®ï¼Œç–¾é£éª¤é›¨éƒ½ä¸è‡ªå·±æ— å…³ã€‚è€Œçˆ¶æ¯ä¸ºä¸€å®¶äººçš„ç”Ÿè®¡æ“åŠ³ï¼Œæ™šä¸Šå¬åˆ°é£é›¨å£°ï¼Œä¼šæƒ¦è®°ç€è¡£æœæ”¶äº†æ²¡æœ‰ï¼Œå·²ç»ç»“äº†ç©—çš„åº„ç¨¼ä¼šä¸ä¼šè¢«é£é›¨æ‰“å¾—ä¸ƒé›¶å…«è½ï¼Œé›¨åé“è·¯æ³¥æ³æ˜¯å¦å½±å“å‡ºå·¥â€¦â€¦ ç»ˆäºï¼Œæˆ‘æ‡‚å¾—äº†çˆ¶æ¯ï¼Œä¹Ÿè¯»æ‡‚äº†å‡¤å§ã€‚","tags":["çº¢æ¥¼æ¢¦"],"categories":["ç¾æ–‡èµæ"]},{"title":"ç©è½¬Qt 2Dç»˜å›¾ä¹‹ç”»å®¶","path":"/post/1967189103.html","content":"åœ¨ Qt 2D ä¸–ç•Œä¸­ï¼Œå›¾å½¢åŸºæœ¬éƒ½ç”±ç‚¹ã€çº¿ã€çŸ©å½¢ã€å¤šè¾¹å½¢ã€æ¤­åœ†ã€åœ†ã€æŠ˜çº¿ã€æ›²çº¿ã€æ–‡æœ¬ã€è´´å›¾ç­‰åŸºæœ¬å…ƒç´ è¾…ä»¥ç€è‰²è€Œæ„æˆï¼Œè€Œä¸” QPainter ç±»å·²ç»æä¾›äº†è¿™äº›å…ƒç´ çš„ç»˜åˆ¶æ–¹æ³•ï¼ŒèŠ±ç‚¹æ—¶é—´æŒæ¡è¿™äº›æ–¹æ³•ï¼Œä¹Ÿå°±æŒæ¡äº† Qt 2Då›¾å½¢æ§ä»¶çš„åˆ¶ä½œï¼Œä½™ä¸‹çš„å°±æ˜¯å‹¤å­¦å¤šç»ƒã€å­°èƒ½ç”Ÿå·§äº†ã€‚ ä¸€ã€ç‚¹åœ¨ Qt ä¸­ä½¿ç”¨ QPoint æˆ– QPointF ç±»å‹è¡¨ç¤ºä¸€ä¸ªç‚¹çš„åæ ‡ã€‚ QPoint å’Œ QPointF çš„åŒºåˆ«åœ¨äºï¼šQPoint ä½¿ç”¨æ•´å‹è¡¨ç¤º X å’Œ Y åæ ‡ï¼Œè€Œ QPointF ä½¿ç”¨ qreal æµ®ç‚¹ç±»å‹è¡¨ç¤ºXå’ŒYåæ ‡ã€‚ä¸‹é¢å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€ä»‹ç»çš„æ–¹æ³•éƒ½é€‚ç”¨äºä¸¤ä¸ªç±»å‹ã€‚ QPoint ç±»å‹è™½ç„¶æä¾›äº† isNull æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œåœ¨ X å’Œ Y åæ ‡å‡ä¸º 0 æ—¶ï¼ŒisNull è¿”å› trueï¼Œå…¶ä»–æƒ…å†µè¿”å› falseã€‚åœ¨ä½¿ç”¨ QPoint::isNull æ–¹æ³•æ—¶è¦ç•™æ„è¿™ä¸ªæƒ…å†µã€‚ å¯ä»¥ä½¿ç”¨ QPoint::manhattanLength æ–¹æ³•è¿”å› x å’Œ y åæ ‡çš„ç»å¯¹å€¼ä¹‹å’Œï¼ˆä¹Ÿå«æ›¼å“ˆé¡¿è·ç¦»ï¼‰ï¼Œå¦‚ï¼š 12QPoint pt(-2, 4);pt.manhattanLength(); // 6 1.1 ä¸¤ç‚¹è·ç¦»ä½¿ç”¨ä¸¤ç‚¹é—´çš„è·ç¦»å…¬å¼å¯ä»¥å¿«é€Ÿè®¡ç®—ä¸¤ç‚¹çš„è·ç¦»ï¼š 123456#include &lt;QtMath&gt;QPointF pt1(-2, 4);QPointF pt2(4, 8);qreal distance = qSqrt(qPow(pt1.x() - pt2.x(), 2.0) + qPow(pt1.y() - pt2.y(), 2.0)); // 7.21 1.2 drawPoint ä¸ drawPointsdrawPoint ç”¨äºç»˜åˆ¶å•ä¸ªç‚¹ï¼š 123void drawPoint(const QPointF &amp;position)void drawPoint(const QPoint &amp;position)void drawPoint(int x, int y) drawPoints ç”¨äºä¸€æ¬¡æ€§ç»˜åˆ¶å¤šä¸ªç‚¹ï¼š 1234void drawPoints(const QPointF *points, int pointCount)void drawPoints(const QPolygonF &amp;points)void drawPoints(const QPoint *points, int pointCount)void drawPoints(const QPolygon &amp;points) QPolygonç»§æ‰¿è‡ª QVector&lt;QPoint&gt;ï¼Œè€ŒQPolygonFç»§æ‰¿è‡ª QVector&lt;QPointF&gt;ã€‚ äºŒã€æŠ˜çº¿æŠ˜çº¿æ˜¯ç”±å¤šä¸ªç‚¹ç›¸è¿ç»„æˆçš„éé—­åˆçº¿æ¡ï¼ˆç›¸é‚»çš„ä¸¤ä¸ªç‚¹è¿æ¥æˆç›´çº¿ï¼Œä½†é¦–ä½ä¸ç›¸è¿ï¼‰ã€‚ 1234void drawPolyline(const QPointF *points, int pointCount)void drawPolyline(const QPolygonF &amp;points)void drawPolyline(const QPoint *points, int pointCount)void drawPolyline(const QPolygon &amp;points) ä¸‹é¢ç¤ºä¾‹æ¼”ç¤ºäº†æŠ˜çº¿çš„ä¸€ç§ç»˜åˆ¶æ–¹æ³•ï¼Œä¸ºäº†ä½¿çº¿æ¡æ›´åŠ åœ†æ¶¦ï¼Œæˆ‘ä»¬è¿˜è®¾ç½®äº†çº¿æ¡çš„èµ·è½ç¬”æ ·å¼å’Œç›¸äº¤ç‚¹æ ·å¼ã€‚ 1234567891011void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); painter.setPen(QPen(Qt::red, 6, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin)); QPolygon pg; pg &lt;&lt; QPoint(20, 200) &lt;&lt; QPoint(80, 10) &lt;&lt; QPoint(140, 200) &lt;&lt; QPoint(200, 10); painter.drawPolyline(pg);} ä¸‰ã€å¤šè¾¹å½¢å¤šè¾¹å½¢æ˜¯åœ¨æŠ˜çº¿çš„åŸºç¡€ä¸Šé¦–å°¾ç›¸è¿è€Œæ¥ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ç”»åˆ·å¯¹å¤šè¾¹å½¢çš„é—­åˆåŒºåŸŸè¿›è¡Œå¡«å……ã€‚ ä»ç„¶ä½¿ç”¨ä¸Šé¢ç¤ºä¾‹ä¸­å®šä¹‰çš„ç‚¹æ¥ç»˜åˆ¶å¤šè¾¹å½¢ï¼Œè®¾ç½® QPainter ç”»åˆ·é¢œè‰²ä¸ºè“è‰²ï¼š 123456789101112void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); painter.setPen(QPen(Qt::red, 6, Qt::SolidLine, Qt::RoundCap, Qt::RoundJoin)); QPolygon pg; pg &lt;&lt; QPoint(20, 200) &lt;&lt; QPoint(80, 10) &lt;&lt; QPoint(140, 200) &lt;&lt; QPoint(200, 10); painter.setBrush(Qt::blue); painter.drawPolygon(pg);} å››ã€çº¿ä¸¤ç‚¹ï¼ˆQPoint æˆ– QPointFï¼‰å¯ä»¥ç¡®å®šä¸€æ¡ç›´çº¿ï¼ŒQt æä¾›äº† QLine å’Œ QLineF ç±»å‹æ¥æè¿°çº¿æ®µã€‚ ä½¿ç”¨ drawLine æ–¹æ³•å¯ä»¥ç»˜åˆ¶ä¸€æ¡ç›´çº¿ï¼Œä½¿ç”¨ drawLines æ–¹æ³•åˆ™å¯ä»¥ä¸€æ¬¡æ€§ç»˜åˆ¶å¤šæ¡ç›´çº¿ã€‚ 12345678910111213void drawLine(const QLineF &amp;line)void drawLine(const QLine &amp;line)void drawLine(int x1, int y1, int x2, int y2)void drawLine(const QPoint &amp;p1, const QPoint &amp;p2)void drawLine(const QPointF &amp;p1, const QPointF &amp;p2)void drawLines(const QLineF *lines, int lineCount)void drawLines(const QVector&lt;QLineF&gt; &amp;lines)void drawLines(const QPointF *pointPairs, int lineCount)void drawLines(const QVector&lt;QPointF&gt; &amp;pointPairs)void drawLines(const QLine *lines, int lineCount)void drawLines(const QVector&lt;QLine&gt; &amp;lines)void drawLines(const QPoint *pointPairs, int lineCount)void drawLines(const QVector&lt;QPoint&gt; &amp;pointPairs) äº”ã€æ¤­åœ†ä¸åœ†5.1 æ¤­åœ†æ¤­åœ†æœ‰é•¿è½´ã€çŸ­è½´ã€ç„¦ç‚¹ç­‰æ¦‚å¿µï¼Œå»ºè®®åœ¨å­¦ä¹ ç»˜åˆ¶æ¤­åœ†ä¹‹å‰å…ˆäº†è§£æ¤­åœ†çš„è¿™äº›æ¦‚å¿µï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç«  å›é¡¾2Dç»˜å›¾çš„æ•°å­¦çŸ¥è¯† ä¸­çš„â€œæ¤­åœ†â€ç« èŠ‚ã€‚ Qtæä¾›äº† QPainter::drawEllipse æ–¹æ³•ç»˜åˆ¶æ¤­åœ†ï¼Œæ–¹æ³•åŸå‹å¦‚ä¸‹ï¼š 12345void drawEllipse(const QRectF &amp;rectangle)void drawEllipse(const QRect &amp;rectangle)void drawEllipse(int x, int y, int width, int height)void drawEllipse(const QPointF &amp;center, qreal rx, qreal ry)void drawEllipse(const QPoint &amp;center, int rx, int ry) drawEllipse æ–¹æ³•è™½ç„¶æœ‰5ç§é‡è½½å½¢å¼ï¼Œä½†æ€»ä½“æ¥è¯´ï¼Œéƒ½æ˜¯ä¼ é€’ä¸€ä¸ªçŸ©å½¢åŒºåŸŸç»™ drawEllipseæ–¹æ³•ï¼Œå› ä¸ºæ ¹æ®ä¼ å…¥çš„çŸ©å½¢å¯ä»¥ç¡®å®šæ¤­åœ†çš„é•¿è½´ã€çŸ­è½´å’Œç„¦ç‚¹ï¼Œå…¶ä¸­é•¿è½´ç­‰äºçŸ©å½¢çš„é•¿ï¼ŒçŸ­è½´ç­‰äºçŸ©å½¢çš„é«˜ï¼Œ2ä¸ªç„¦ç‚¹åˆ†åˆ«ä½äº2ä¸ªé•¿åŠè½´çš„ä¸­é—´ã€‚ ä¸‹é¢ç¤ºä¾‹å…ˆç»˜åˆ¶äº†ä¸€ä¸ªæµ…ç°è‰²çš„çŸ©å½¢ï¼ˆç”¨äºè§‚å¯Ÿæ¤­åœ†çš„ç»˜åˆ¶ï¼‰ï¼Œç„¶ååœ¨ä½¿ç”¨è¯¥çŸ©å½¢ç»˜åˆ¶æ¤­åœ†ã€‚ 1234567891011121314void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // æµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // çº¢è‰²æ¤­åœ† painter.setPen(Qt::red); painter.drawEllipse(rect);} 5.2 åœ†åœ†æ˜¯æ¤­åœ†çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå½“æ¤­åœ†çš„é•¿è½´ç­‰äºçŸ­è½´æ—¶ï¼Œæ‰€ç»˜åˆ¶å‡ºæ¥çš„å°±æ˜¯åœ†äº†ã€‚ 123456789void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); // å®½ = é«˜ QRectF rect(50, 50, 300, 300); painter.drawEllipse(rect);} å…­ã€çŸ©å½¢åœ¨ Qtä¸­ä½¿ç”¨ QRect å’Œ QRectF ç±»å‹æ¥è¡¨ç¤ºçŸ©å½¢ï¼Œåœ¨ä½¿ç”¨ QRect æ—¶éœ€è¦å…³æ³¨ QRect çš„å†å²é—ç•™é—®é¢˜ï¼Œè¯¦è§ï¼šç©è½¬Qt 2Dç»˜å›¾ä¹‹åæ ‡ç³» çš„â€œQRecté—ç•™é—®é¢˜â€ç« èŠ‚ã€‚ 6.1 çŸ©å½¢çš„åˆæ³•æ€§QRectå’ŒQRectFç±»å‹å‡æä¾›äº†isEmptyã€isNullã€isValidæ–¹æ³•ï¼Œä½† QRect ç”±äºå†å²é—ç•™é—®é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­å¯¹å„ä¸ªæ–¹æ³•çš„å®šä¹‰çœ‹èµ·æ¥æ¯”è¾ƒæ€ªå¼‚ï¼Œè¿›è¡Œé€»è¾‘ä¸‹é¢å¯¹å…¶è¿›è¡Œäº†é€»è¾‘è¿ç®—ï¼Œæ–¹ä¾¿ç†è§£ã€‚ QRect 1234567891011isEmpty() == left() &gt; right() || top() &gt; bottom() == left() &gt; left() + width() - 1 || top() &gt; top() + height() - 1 == 1 &gt; width() || 1 &gt; height()isNull() == (right() == left() - 1 &amp;&amp; bottom() == top() - 1) == (left() + width() - 1 == left() - 1 &amp;&amp; top() + height() - 1 == top() - 1) == (width() == 0 &amp;&amp; height() == 0)isValid() == left() &lt;= right() &amp;&amp; top() &lt;= bottom() == left() &lt;= left() + width() - 1 &amp;&amp; top() &lt;= top() + height() - 1 == 1 &lt;= width() &amp;&amp; 1 &lt;= height() QRectF 123isEmpty() == width() &lt;= 0 || height() &lt;= 0isNull() == width() == 0 &amp;&amp; height() == 0isValid() == width() &gt; 0 &amp;&amp; height() &gt; 0 ä»ä¸Šè¿°å®šä¹‰å¯ä»¥å‘ç°ï¼Œå½“å‰çŸ©å½¢çš„å®½æˆ–é«˜ä¸ºè´Ÿæ•°æ—¶ï¼ŒisNull è¿”å›çš„å´æ˜¯ falseã€‚ 6.2 drawRect ä¸ drawRectsä½¿ç”¨ drawRect æ–¹æ³•ç»˜åˆ¶å•ä¸ªçŸ©å½¢ï¼Œä½¿ç”¨ drawRects æ–¹æ³•ä¸€æ¬¡æ€§ç»˜åˆ¶å¤šä¸ªçŸ©å½¢ã€‚ 1234567void drawRect(const QRectF &amp;rectangle)void drawRect(int x, int y, int width, int height)void drawRect(const QRect &amp;rectangle)void drawRects(const QRectF *rectangles, int rectCount)void drawRects(const QVector&lt;QRectF&gt; &amp;rectangles)void drawRects(const QRect *rectangles, int rectCount)void drawRects(const QVector&lt;QRect&gt; &amp;rectangles) ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ç¤ºä¾‹ï¼š 12345678910111213void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); painter.drawRect(QRect(20, 20, 200, 200)); painter.setPen(Qt::red); QVector&lt;QRect&gt; rects; rects &lt;&lt; QRect(60, 60, 200, 200) &lt;&lt; QRect(100, 100, 200, 200); painter.drawRects(rects);} 6.3 åœ†è§’çŸ©å½¢ä¸Šé¢ç»˜åˆ¶çš„çŸ©å½¢éƒ½ä¸æ˜¯åœ†è§’ï¼Œåœ¨Qtä¸­ç»˜åˆ¶åœ†è§’çŸ©å½¢æœ‰ä¸¤ç§æ–¹å¼ï¼š QPainter::drawRoundedRectï¼Œæœ¬èŠ‚ä¸»è¦ä»‹ç»è¿™ç§æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ç»˜åˆ¶çš„åœ†è§’çŸ©å½¢çš„4ä¸ªè§’çš„æ›²åº¦ä¸€æ ·ã€‚ QPainterè¿˜æä¾›äº† drawRoundRect æ–¹æ³•ä¹Ÿå¯ä»¥ç»˜åˆ¶åœ†è§’çŸ©å½¢ï¼Œä½†è¯¥æ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œå› æ­¤ä¸å»ºè®®ç»§ç»­ä½¿ç”¨ã€‚ QPainter::drawPath é€šè¿‡è·¯å¾„çš„æ–¹å¼æ¥ç»˜åˆ¶åœ†è§’çŸ©å½¢ï¼Œè¿™ç§æ–¹æ³•ç»˜åˆ¶çš„åœ†è§’çŸ©å½¢çš„4ä¸ªè§’çš„æ›²åº¦å¯ä»¥ä¸ä¸€æ ·ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ä¸‹é¢ç« èŠ‚ä»‹ç»ã€‚ 1void QPainter::drawRoundedRect(const QRectF &amp;rect, qreal xRadius, qreal yRadius, Qt::SizeMode mode = Qt::AbsoluteSize) ä¸‹é¢ç¤ºä¾‹ä¸ºäº†æ¼”ç¤ºåœ†è§’çŸ©å½¢å’Œæ™®é€šçš„ç›´è§’çŸ©å½¢çš„ä¸åŒï¼Œå…ˆç»˜åˆ¶äº†ä¸€ä¸ªæµ…ç°è‰²ç›´è§’çŸ©å½¢ï¼Œç„¶åå†ç›¸åŒåŒºåŸŸç»˜åˆ¶äº†ä¸€ä¸ªçº¢è‰²åœ†è§’çŸ©å½¢ã€‚ 12345678910111213141516171819void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // å…ˆç»˜åˆ¶ä¸€ä¸ªæµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // ç„¶åç»˜åˆ¶ä¸€ä¸ªçº¢è‰²åœ†è§’çŸ©å½¢ // qreal xRadius = 20; qreal yRadius = 40; painter.setPen(QPen(Qt::red, 1, Qt::DashDotLine)); painter.drawRoundedRect(rect, xRadius, yRadius);} 7.4 xRadius ä¸ yRadiusxRadius ä¸ yRadius å‚æ•°å†³å®šäº†åœ†è§’çš„æ›²åº¦ï¼ŒdrawRoundedRect æ–¹æ³•ç»˜åˆ¶çš„åœ†è§’çŸ©å½¢çš„å››ä¸ªè§’é‡‡ç”¨åŒä¸€ä¸ªæ›²åº¦ã€‚é‚£ä¹ˆ xRadius ä¸ yRadius å…·ä½“æ˜¯å¦‚ä½•å†³å®šåœ†è§’çš„æ›²åº¦çš„å‘¢ï¼Ÿ xRadius å‚æ•°ä¸ºæ¤­åœ†çš„é•¿åŠè½´ï¼ŒyRadius å‚æ•°ä¸ºæ¤­åœ†çš„çŸ­åŠè½´ã€‚ å…³äºæ¤­åœ†çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç«  å›é¡¾2Dç»˜å›¾çš„æ•°å­¦çŸ¥è¯† ä¸­çš„â€œæ¤­åœ†â€ç« èŠ‚ã€‚ é€šè¿‡ xRadius å’Œ yRadius å‚æ•°ç¡®å®šäº†æ¤­åœ†çš„é•¿è½´å’ŒçŸ­è½´ï¼Œé‚£ä¹ˆåœ¨ä»€ä¹ˆä½ç½®ç”»æ¤­åœ†å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šè´´ç€å››ä¸ªé¡¶è§’åˆ†åˆ«ç”» 4 ä¸ªæ¤­åœ†æ¥ç¡®å®šæ›²åº¦ã€‚ ä¸‹é¢ä»£ç åœ¨ä¸Šé¢ç¤ºä¾‹çš„åŸºç¡€ä¸Šï¼Œåˆ†åˆ«åœ¨å·¦ä¸Šè§’å’Œå³ä¸‹è§’ä½ç½®ç”»äº†2ä¸ªæ·±é»„è‰²çš„æ¤­åœ†ï¼Œå¯ä»¥çœ‹åˆ°æ¤­åœ†ä¸åœ†è§’æ˜¯ç›¸é‡åˆçš„ã€‚ 12345678910111213141516171819202122232425void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // å…ˆç»˜åˆ¶ä¸€ä¸ªæµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // ç„¶åç»˜åˆ¶ä¸€ä¸ªçº¢è‰²åœ†è§’çŸ©å½¢ // qreal xRadius = 20; qreal yRadius = 40; painter.setPen(QPen(Qt::red, 1, Qt::DashDotLine)); painter.drawRoundedRect(rect, xRadius, yRadius); // ~~~ æ–°å¢å¦‚ä¸‹ä»£ç  ~~~ painter.setPen(QPen(Qt::darkYellow, 1, Qt::DashLine)); painter.drawEllipse(QRectF(rect.left(), rect.top(), xRadius * 2, yRadius * 2)); painter.drawEllipse(QRectF(rect.right() - xRadius * 2, rect.bottom() - yRadius * 2, xRadius * 2, yRadius * 2));} ä¸ƒã€æ¤­åœ†ä¸Šçš„ä¸€æ®µçº¿7.1 å¼§çº¿ï¼ˆArcï¼‰ä½¿ç”¨ drawArc æ–¹æ³•å¯ä»¥ç»˜åˆ¶ä¸€æ®µå¼§çº¿ï¼š 1234void drawArc(const QRectF &amp;rectangle, int startAngle, int spanAngle)void drawArc(const QRect &amp;rectangle, int startAngle, int spanAngle)void drawArc(int x, int y, int width, int height, int startAngle, int spanAngle) åœ¨å‰é¢ä»‹ç»çš„æ¤­åœ†ç»˜åˆ¶æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®šä¸€ä¸ªçŸ©å½¢åŒºåŸŸå°±å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªæ¤­åœ†ï¼Œè€Œ drawArc æ–¹æ³•ç»˜åˆ¶æ›²çº¿çš„åˆ™æ˜¯è¯¥æ¤­åœ†ä¸Šçš„æŸä¸€æ®µå¼§çº¿ã€‚é€šè¿‡ startAngle å‚æ•°æŒ‡å®šå¼§çº¿çš„èµ·å§‹è§’åº¦ï¼ŒspanAngle å‚æ•°æŒ‡å®šå¼§çº¿æ‰€è·¨è¶Šçš„è§’åº¦ã€‚ éœ€è¦æ³¨æ„ï¼š åœ¨ QPainter çš„ç»˜å›¾å‡½æ•°ä¸­æŒ‡å®šè§’åº¦ï¼ˆä¸æ˜¯å¼§åº¦ï¼‰æ—¶ï¼Œä»¥æ­£ä¸‰ç‚¹é’Ÿæ–¹å‘ä¸º 0 åº¦ï¼Œè§’åº¦æŒ‰é€†æ—¶é’ˆæ–¹å‘å¢é•¿ï¼Œæ•´ä¸ªåœ†æŒ‰ 5760 åº¦è®¡ç®—ï¼ˆå³ 16 * 360ï¼‰ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ç»˜åˆ¶ä¸€æ®µçº¢è‰²çš„å¼§çº¿ï¼Œå¼§çº¿ä» 30 åº¦æ–¹å‘å¼€å§‹ï¼Œå¼§çº¿è·¨è¶Šäº† 120 åº¦ã€‚ 123456789101112131415161718void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // æµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // è“è‰²çš„æ¤­åœ† painter.setPen(Qt::blue); painter.drawEllipse(rect); // çº¢è‰²çš„å¼§çº¿ painter.setPen(Qt::red); painter.drawArc(rect, 30 * 16, 120 * 16);} å®é™…ç»˜åˆ¶æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå¼§çº¿å®é™…æ˜¯æ¤­åœ†ä¸Šçš„æŸä¸€æ®µæ›²çº¿ã€‚ 7.2 é¥¼çŠ¶å›¾ï¼ˆPieï¼‰ä½¿ç”¨ drawPie å¯ä»¥ç»˜åˆ¶é¥¼çŠ¶å›¾ï¼Œé¥¼çŠ¶å›¾æ˜¯åœ¨ä¸Šé¢å¼§çº¿ï¼ˆArcï¼‰çš„åŸºç¡€ä¸Šï¼Œåˆ†åˆ«å°†å¼§çº¿çš„é¦–å°¾ä¸ä¸­å¿ƒç‚¹ç›¸è¿è€Œæ¥ï¼Œå› æ­¤ drawPie æ–¹æ³•çš„å‚æ•°ä¹Ÿä¸ drawArc æ–¹æ³•ä¸€æ ·ã€‚ QPainter åœ¨ç»˜åˆ¶é¥¼çŠ¶å›¾æ—¶ï¼Œä¼šä½¿ç”¨å½“å‰çš„ç”»åˆ·å¡«å……é¥¼çŠ¶å›¾ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ç»˜åˆ¶äº†ä¸€ä¸ªå…·æœ‰çº¢è‰²è½®å»“ã€é»„è‰²å¡«å……çš„é¥¼çŠ¶å›¾ã€‚ 12345678910111213141516171819void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // æµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // è“è‰²çš„æ¤­åœ† painter.setPen(Qt::blue); painter.drawEllipse(rect); // é¥¼çŠ¶å›¾ï¼šçº¢è‰²çš„è½®å»“ï¼Œé»„è‰²çš„å¡«å…… painter.setPen(Qt::red); painter.setBrush(Qt::yellow); painter.drawPie(rect, 30 * 16, 120 * 16);} 7.3 å’Œå¼¦å›¾ï¼ˆChrodï¼‰ æ­¤å¤„å°†ChrodæŒ‰ç…§è‹±æ–‡ç›´è¯‘æˆâ€œå’Œå¼¦â€å¯èƒ½ä¸å¤ªå‡†ç¡® å’Œå¼¦å›¾ï¼ˆChrodï¼‰ä¸é¥¼çŠ¶å›¾ï¼ˆPieï¼‰ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å¼§çº¿çš„åŸºç¡€ä¸Šå˜åŒ–è€Œæ¥ï¼Œå°†å¼§çº¿çš„é¦–å°¾ç›¸æ¥å°±å¯å¾—åˆ°å’Œå¼¦å›¾ï¼ˆChrodï¼‰ã€‚ QPainter åœ¨ç»˜åˆ¶å’Œå¼¦å›¾æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨å½“å‰çš„ç”»åˆ·å¡«å……é¥¼çŠ¶å›¾ã€‚ ä½¿ç”¨ drawChord æ–¹æ³•å¯ä»¥ç»˜åˆ¶å’Œå¼¦å›¾ï¼ŒdrawChord æ–¹æ³•çš„å‚æ•°ä¹Ÿä¸ drawArc æ–¹æ³•ä¸€æ ·ã€‚ 12345678910111213141516171819void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QRectF rect(50, 50, 300, 200); // æµ…ç°è‰²çš„çŸ©å½¢ painter.setPen(Qt::lightGray); painter.drawRect(rect); // è“è‰²çš„æ¤­åœ† painter.setPen(Qt::blue); painter.drawEllipse(rect); // å’Œå¼¦å›¾ï¼šçº¢è‰²çš„è½®å»“ï¼Œé»„è‰²çš„å¡«å…… painter.setPen(Qt::red); painter.setBrush(Qt::yellow); painter.drawChord(rect, 30 * 16, 120 * 16);} å…«ã€è·¯å¾„å‰é¢ä»‹ç»äº†çº¿ã€çŸ©å½¢ã€æ¤­åœ†ã€åœ†ã€å¼§çº¿ã€é¥¼çŠ¶å›¾ç­‰å½¢çŠ¶ï¼Œè·¯å¾„åˆ™æ˜¯ç”±è‹¥å¹²ä¸ªè¿™äº›å½¢çŠ¶ï¼ˆä¸é™äºè¿™äº›å½¢çŠ¶ï¼‰ç»„æˆçš„ä¸€ä¸ªé›†åˆï¼Œè·¯å¾„å¯ä»¥æ˜¯é—­åˆçš„ï¼Œä¹Ÿå¯ä»¥ä¸é—­åˆã€‚ åœ¨Qtä¸­ä½¿ç”¨QPainterPathå¯¹è±¡æ¥å®šä¹‰ä¸€ä¸ªè·¯å¾„ï¼Œå¹¶ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å‘è·¯å¾„ä¸­æ·»åŠ å½¢çŠ¶ï¼š addEllipse æ·»åŠ ä¸€ä¸ªæ¤­åœ†æˆ–åœ†åˆ°è·¯å¾„ä¸­ addRect æ·»åŠ ä¸€ä¸ªçŸ©å½¢åˆ°è·¯å¾„ä¸­ addRoundedRect æ·»åŠ ä¸€ä¸ªåœ†è§’çŸ©å½¢åˆ°è·¯å¾„ä¸­ addText å°†ç”¨æŒ‡å®šå­—ä½“ç»˜åˆ¶çš„æ–‡ä»¶æ‰€å½¢æˆçš„é—­åˆå½¢çŠ¶æ·»åŠ åˆ°è·¯å¾„ä¸­ lineTo æ·»åŠ ä¸€æ¡ç›´çº¿åˆ°è·¯å¾„ä¸­ arcTo æ·»åŠ ä¸€æ®µåœ†å¼§åˆ°è·¯å¾„ä¸­arcTo çš„åŸå‹å¦‚ä¸‹ï¼Œå’Œ drawArc æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦æŒ‡å®šèµ·å§‹è§’åº¦å’Œè·¨è¶Šè§’åº¦ï¼Œä½†ä¸drawArc æ–¹æ³•ä¸åŒçš„æ˜¯ï¼ŒarcTo æ–¹æ³•æŒ‡å®šçš„è§’åº¦æ˜¯ä»¥360åº¦æ•´åœ†è®¡ç®—çš„ï¼Œå› æ­¤ä¸éœ€è¦ä¹˜ä»¥ 16ã€‚1void QPainterPath::arcTo(const QRectF &amp;rectangle, qreal startAngle, qreal sweepLength) cubicTo æ·»åŠ ä¸€ä¸ªä¸‰æ¬¡è´å¡å°”æ›²çº¿åˆ°è·¯å¾„ä¸­ quadTo æ·»åŠ ä¸€ä¸ªäºŒæ¬¡è´å¡å°”æ›²çº¿åˆ°è·¯å¾„ä¸­ åœ¨ä¸Šé¢æ–¹æ³•ä¸­ï¼Œå‘½åæ ¼å¼ä¸ºâ€œToâ€çš„æ–¹æ³•ï¼Œå¦‚ lineToã€arcToã€quadTo ç­‰ï¼Œéƒ½æ˜¯åŸºäºâ€œå½“å‰ä½ç½®â€æ¥æ·»åŠ å½¢çŠ¶çš„ï¼Œé»˜è®¤çš„å½“å‰ä½ç½®ä¸ºå½“å‰çš„*åæ ‡åŸç‚¹ (0,0) å¤„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ QPainterPath::currentPosition æ–¹æ³•è·å–å½“å‰ä½ç½®ã€‚ æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡ QPainter::translate ç­‰æ–¹æ³•å˜æ¢é€»è¾‘åæ ‡ï¼ŒQPainterPath çš„å½“å‰ä½ç½®ä¹Ÿä¼šå—é€»è¾‘åæ ‡å˜æ¢çš„å½±å“ã€‚ åœ¨ä½¿ç”¨ lineTo æ·»åŠ ç›´çº¿åˆ°è·¯å¾„ä¸­æ—¶ï¼Œåªæœ‰æŒ‡å®šç›´çº¿çš„ç»“æŸç‚¹ï¼Œä¼šè‡ªåŠ¨å°†å½“å‰ä½ç½®ä¸ç»“æŸç‚¹ç›¸è¿ï¼Œå½¢æˆä¸€æ¡ç›´çº¿ï¼Œå¹¶é‡è®¾å½“å‰ä½ç½®ä¸ºè¯¥ç»“æŸç‚¹ã€‚ åœ¨ä½¿ç”¨ arcToã€cubicToã€quadTo æ·»åŠ æ›²çº¿åˆ°åˆ°è·¯å¾„ä¸­æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å½“å‰ä½ç½®ä¸æ›²çº¿èµ·ç‚¹ç›¸è¿ï¼Œå¹¶é‡è®¾å½“å‰ä½ç½®ä¸ºæ›²çº¿ç»“æŸç‚¹ã€‚ æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜å½“å‰ä½ç½®å’Œç»“æŸç‚¹çš„å…³ç³»ï¼Œä¸‹é¢ç¤ºä¾‹å…ˆæ·»åŠ ä¸€æ¡ç›´çº¿ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæ›²çº¿ï¼Œæœ€å¥½å†æ·»åŠ ä¸€æ¡ç›´çº¿ï¼š 123456789101112// ç¤ºä¾‹ï¼šå½“å‰ä½ç½®void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QPainterPath path; path.lineTo(80, 50); path.arcTo(QRectF(50, 50, 300, 200), 30, 120); path.lineTo(200, 200); painter.drawPath(path);} å®é™…æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 8.1 å¡«å……è§„åˆ™è·¯å¾„å¯ä»¥æ˜¯é—­åˆçš„ä¹Ÿå¯ä»¥æ˜¯éé—­åˆçš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„å½“å‰ä½ç½®ç¤ºä¾‹ä¸­çš„è·¯å¾„æ˜¯éé—­åˆçš„ï¼Œä½†å¦‚æœä¸º QPainter æŒ‡å®šäº†ç”»åˆ·ï¼ŒQPainter ä¼šè‡ªåŠ¨ä½¿ç”¨ä¸€æ¡ç›´çº¿è¿æ¥è¯¥éé—­åˆå½¢çŠ¶çš„é¦–å°¾ï¼Œä½¿å…¶é—­åˆï¼Œè¿›è€Œä½¿ç”¨ç”»åˆ·å¯¹å…¶å¡«å……ã€‚ QPainterPath æœ‰ä¸¤ç§å¡«å……è§„åˆ™ï¼Œå¯ä»¥é€šè¿‡QPainterPath::setFillRuleæ–¹æ³•æ¥è®¾ç½®å¡«å……è§„åˆ™ï¼š Qt::OddEvenFill å¥‡å¶å¡«å……è§„åˆ™ï¼Œä»ä¸€ç‚¹å‘å›¾å½¢å¤–å¼•ä¸€æ¡æ°´å¹³çº¿ï¼Œè¯¥çº¿å’Œå›¾å½¢çš„è¾¹çº¿ç›¸äº¤ï¼Œå¦‚æœäº¤ç‚¹çš„ä¸ªæ•°ä¸ºå¥‡æ•°ï¼Œåˆ™è¯¥ç‚¹åœ¨å›¾å½¢ä¸­ã€‚ Qt::WindingFilléé›¶å¼¯æ›²è§„åˆ™ï¼Œä»ä¸€ç‚¹å‘å›¾å½¢å¤–å¼•ä¸€æ¡æ°´å¹³çº¿ï¼Œè¯¥çº¿ä¸å›¾å½¢çš„è¾¹çº¿ç›¸äº¤ã€‚å¦‚æœè¾¹çº¿æ˜¯é¡ºæ—¶é’ˆç»˜åˆ¶çš„ï¼Œåˆ™è®°ä¸º1ï¼Œå¦‚æœè¾¹çº¿æ˜¯é€†æ—¶é’ˆç»˜åˆ¶çš„ï¼Œåˆ™è®°ä¸º-1ã€‚æœ€åå°†æ‰€æœ‰ç»“æœç›¸åŠ çš„å’Œä¸º0åˆ™è¯¥ç‚¹åœ¨å›¾å½¢ä¸­ã€‚ï¼ˆçŸ©å½¢å’Œæ¤­åœ†éƒ½æŒ‰é¡ºæ—¶é’ˆç»˜åˆ¶ï¼‰ ä¹ã€æ–‡æœ¬æ–‡å­—æœ‰é¢œè‰²ã€å­—ä½“ç­‰å±æ€§ï¼Œé¢œè‰²å¯ä»¥é€šè¿‡ä¸º QPainter è®¾ç½®ç”»ç¬”ï¼ˆQPenï¼‰çš„æ–¹å¼æ¥ä¿®æ”¹ï¼Œè¿™ç§æ–¹å¼åªèƒ½è®¾ç½®çº¯è‰²ã€‚ æœ‰ä¸‹é¢ä¸¤ç§ç»˜åˆ¶æ¸å˜è‰²çš„æ–‡å­—æ–¹æ³•ï¼š å…ˆå°†æ–‡å­—è½¬å˜æˆè·¯å¾„ï¼ˆå‚è€ƒQPainterPath::addTextï¼‰ï¼Œç„¶åä½¿ç”¨æ¸å˜ç”»åˆ·å¡«å……è¯¥è·¯å¾„ã€‚ ç›´æ¥ä¸º QPen è®¾ç½®æ¸å˜ç”»åˆ·ã€‚ é€šè¿‡ä¸º QPainter è®¾ç½® QFont å¯¹è±¡çš„æ–¹å¼æ¥ä¿®æ”¹å­—ä½“ï¼Œå­—ä½“æœ‰å­—ä½“æ—ã€å­—å·ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ç­‰æ ·å¼æˆ–æ•ˆæœï¼š 123456789QFont font;font.setFamilies({\"Microsoft YaHei\", \"Arial\"}); // å­—ä½“æ—font.setPixelSize(26); // å­—å·font.setBold(true); // ç²—ä½“font.setItalic(true); // æ–œä½“font.setUnderline(true); // ä¸‹åˆ’çº¿font.setStrikeOut(true); // åˆ é™¤çº¿painter.setFont(font); ä½¿ç”¨ QPainter::drawText æ–¹æ³•ç»˜åˆ¶æ–‡æœ¬ï¼Œæ–¹æ³•åŸå‹æœ‰å¾ˆå¤šï¼Œå¤§å¤šæ˜¯é€šè¿‡ä¸‹é¢2ä¸ªåŸå‹è¿›è¡Œé‡è½½è€Œæ¥çš„ï¼š 12void QPainter::drawText(const QRectF &amp;rectangle, int flags, const QString &amp;text, QRectF *boundingRect = nullptr)void QPainter::drawText(const QRectF &amp;rectangle, const QString &amp;text, const QTextOption &amp;option = QTextOption()) 9.1 é—´è·é—´è·åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š æ¯ä¸ªå­—ç¬¦çš„é—´è·ï¼Œå¦‚å•ä¸ªè‹±æ–‡å­—æ¯æˆ–å•ä¸ªæ±‰å­—çš„é—´è·ï¼Œç§°ä¸ºLetter Spacingã€‚ æ¯ä¸ªè‹±æ–‡å•è¯çš„é—´è·ï¼Œç§°ä¸ºWord Spacingã€‚ ä½¿ç”¨ QFont::setWordSpacing å’Œ QFont::wordSpacing æ–¹æ³•è®¾ç½®å’Œè·å–å•è¯çš„é—´è·ã€‚ 1void QFont::setWordSpacing(qreal spacing) å½“ setWordSpacing å‚æ•°å¤§äº0æ—¶ï¼Œå•è¯é—´è·å¢åŠ ç›¸åº”çš„åƒç´ ï¼›å°äº0æ—¶ï¼Œé—´è·å‡å°‘ç›¸åº”çš„åƒç´ ã€‚ ä½¿ç”¨ QFont::setLetterSpacing å’Œ QFont::letterSpacing æ–¹æ³•è®¾ç½®å’Œè·å–å­—ç¬¦çš„é—´è·ã€‚ 1void QFont::setLetterSpacing(QFont::SpacingType type, qreal spacing) å­—ç¬¦é—´è·æ”¯æŒç™¾åˆ†æ¯”å’Œç»å¯¹å€¼ä¸¤ç§è®¾ç½®æ–¹æ³•ï¼Œé€šè¿‡QFont::SpacingTypeæšä¸¾ç±»å‹æŒ‡å®šã€‚ QFont::PercentageSpacing ç™¾åˆ†æ¯”æ–¹å¼ã€‚å€¼ä¸º100æ—¶è¡¨ç¤ºä¸åšä»»ä½•æ”¹å˜ï¼Œ200è¡¨ç¤ºé—´è·æ‰©å¤§åˆ°åŸæ¥çš„ä¸€å€ï¼Œ-200è¡¨ç¤ºé—´è·ç¼©å°åˆ°åŸæ¥çš„ä¸€å€ã€‚ QFont::AbsoluteSpacing ç»å¯¹å€¼æ–¹å¼ï¼Œä¸è®¾ç½®å•è¯é—´è·çš„æ–¹å¼ä¸€æ ·ã€‚ 9.2 å°å‹å¤§å†™å­—æ¯å°å‹å¤§å†™å­—æ¯ï¼ˆè‹±è¯­ï¼šsmall capitalsï¼Œç®€ç§° small capsï¼‰æ˜¯è¥¿æ–‡å­—ä½“è®¾è®¡ä¸­çš„ä¸€ç§å­—ç¬¦å½¢å¼ã€‚è¿™äº›å­—æ¯çš„å½¢çŠ¶ï¼ˆå­—å½¢ï¼‰å’Œå¤§å†™å­—æ¯ç›¸åŒä½†å°ºå¯¸è¾ƒå°ï¼Œæ¯”å¦‚åœ¨è¡¨ç¤ºé”®ç›˜å¿«æ·é”®çš„æ—¶å€™ä¹Ÿå¸¸ç”¨å°å‹å¤§å†™å­—æ¯ã€‚ åœ¨ Qt ä¸­é€šè¿‡è®¾ç½® QFont çš„ Capitalization æ ·å¼ä¸º SmallCaps é£æ ¼æ¥ä½¿ç”¨å°å‹å¤§å†™å­—æ¯ï¼Œå¦‚ï¼š 12345678910111213141516void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QPen pen; pen.setBrush(Qt::red); pen.setWidthF(20); QFont font; font.setPixelSize(26); font.setCapitalization(QFont::SmallCaps); ^^^^^^^^^^^^^ painter.setFont(font); painter.drawText(10, 30, \"The Keyboard Shortcut is Ctrl + Shift + K\");} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆç•™æ„å…¨å°å†™çš„â€œisâ€å’Œå…¶ä»–é¦–å­—æ¯å¤§å†™çš„å•è¯ï¼‰ï¼š Capitalization è¿˜æ”¯æŒè®¾ç½®å¦‚ä¸‹é£æ ¼ï¼š QFont::MixedCase é»˜è®¤ï¼Œä¸åšæ›´æ”¹ QFont::AllUppercase å…¨éƒ¨å°å†™ QFont::AllLowercase å…¨éƒ¨å¤§å†™ QFont::Capitalize é¦–å­—æ¯å¤§å†™ 9.3 è®¡ç®—ç»˜åˆ¶æ–‡æœ¬æ‰€éœ€ç©ºé—´æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¡ç®—æŒ‰æŒ‡å®šå­—ä½“ç»˜åˆ¶æ–‡æœ¬æ‰€éœ€çš„ç©ºé—´ã€‚ **æ–¹å¼ä¸€ï¼šä½¿ç”¨ QPainter::drawText ** ä½¿ç”¨å¦‚ä¸‹å‡½æ•°åŸå‹ï¼š 1void QPainter::drawText(const QRectF &amp;rectangle, int flags, const QString &amp;text, QRectF *boundingRect = nullptr) å°†å‚æ•° rectangle çš„ å®½å’Œé«˜éƒ½è®¾ç½®ä¸º 0ï¼Œå‡½æ•°ä¼šé€šè¿‡ boundingRect å‚æ•°è¿”å›ç»˜åˆ¶æ–‡æœ¬æ‰€éœ€è¦çš„å®½å’Œé«˜ã€‚ æ–¹å¼äºŒï¼šä½¿ç”¨ QFontMetricsF QFontMetrics æˆ– QFontMetricsF å¯ä»¥æŒ‰ç…§æŒ‡å®šå­—ä½“æ¥è®¡ç®—ç»™å®šå­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å®½å’Œé«˜ã€‚ è¿™ç§æ–¹å¼çš„å¼Šç«¯åœ¨äºï¼šä¸èƒ½å°†ç»˜åˆ¶é£æ ¼ï¼ˆå¦‚å±…ä¸­å¯¹é½ã€å¤šè¡Œæ–‡æœ¬ï¼‰å¸¦å…¥å…¶ä¸­è¿›è¡Œè®¡ç®—ï¼Œåªèƒ½è®¡ç®—ç»™å®šçš„å•è¡Œå­—ç¬¦ä¸²æŒ‰ç…§æŒ‡å®šçš„å­—ä½“æ˜¾ç¤ºæ‰€éœ€çš„å®½é«˜ã€‚ 123456QFont font;font.setPixelSize(36);QFontMetricsF fm(font);qDebug() &lt;&lt; fm.horizontalAdvance(\"Hello World\"); // å­—ç¬¦ä¸²æ‰€å å®½åº¦qDebug() &lt;&lt; fm.height(); // å­—ä½“çš„é«˜åº¦ åã€è´´å›¾QPainter æä¾›äº† drawPixmap å’Œ drawImage ä¸¤ä¸ªå¸¸ç”¨çš„è´´å›¾å‡½æ•°ï¼ŒdrawPixmap ç”¨äºç»˜åˆ¶ QPixmap å¯¹è±¡ï¼Œè€Œ drawImage ç”¨äºç»˜åˆ¶ QImage å¯¹è±¡ï¼ŒQImage ä¸ QPixmap é—´æ˜¯å¯ä»¥ç›¸äº’è½¬åŒ–ï¼Œå› æ­¤ drawPixmap å’Œ drawImage æ–¹æ³•çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ drawPixmap æ–¹æ³•åœ¨å±å¹•ä¸Šç»˜åˆ¶é€Ÿåº¦æ›´å¿«ï¼Œè€Œ drawImage æ–¹æ³•åˆ™åœ¨ QPrinter å’Œå…¶ä»–è®¾å¤‡ä¸Šç»˜åˆ¶çš„æ›´å¿«ã€‚ éœ€è¦æ³¨æ„ï¼šQPicture å¯¹è±¡ç”¨äºè®°å½•ç»˜åˆ¶æ­¥éª¤ï¼Œè€Œ QPainter::drawPicture æ–¹æ³•ç”¨äºé‡å¤ QPicture å¯¹è±¡æ‰€è®°å½•çš„æ­¥éª¤ã€‚ drawPixmap å’Œ drawImage æ–¹æ³•æœ‰å¤šä¸ªé‡è½½çš„åŸå‹ï¼Œå…¶å‚æ•°ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼š 1ç›®æ ‡åŒºåŸŸ -&gt; QPixmap/QImage -&gt; æºåŒºåŸŸ ç›®æ ‡åŒºåŸŸä¼šåº”ç”¨å½“å‰ QWidget çš„ devicePixelRatioï¼Œè€ŒæºåŒºåŸŸåˆ™ä¸ devicePixelRatio æ— å…³ï¼Œå…·ä½“å‚è€ƒ QPixmapä½¿ç”¨è¦ç‚¹ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt"],"categories":["Qt"]},{"title":"ç©è½¬Qt 2Dç»˜å›¾ä¹‹ç”»å®¶çš„å·¥å…·","path":"/post/1336811290.html","content":"è½¯ä»¶æ˜¯å¯¹ç°å®ä¸–ç•Œçš„æŠ½è±¡ï¼Œåœ¨è®¾è®¡è½¯ä»¶æ¥å£æ—¶é€šå¸¸ä¹Ÿä¼šå‚è€ƒç°å®ä¸–ç•Œæ¥è¿›è¡Œè®¾è®¡ã€‚ åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œç”»å®¶ä½¿ç”¨ç”»ç¬”ã€ç”»åˆ·è¿™äº›å·¥å…·åœ¨å®£çº¸ä¸Šä½œç”»ï¼Œè€Œåœ¨ Qt ä¸­ï¼Œç”»å®¶æ˜¯ QPainter å¯¹è±¡ï¼ˆç”»å®¶çš„å¤§è„‘åˆ™æ˜¯ QPaintEngineï¼‰ï¼Œçº¸å¼ å¯ä»¥æ˜¯ QPaintDevice çš„ä»»ä½•å­ç±»å¯¹è±¡ï¼Œå¦‚ QWidgetã€QImageã€QPixmapã€QGLPixelBuffer ç­‰ï¼›åœ¨ QPainter é€‰å¥½çº¸å¼ åï¼Œå°±å¯ä»¥ä½¿ç”¨ç”»ç¬”æ¥å‹¾å‹’ç‰©ä½“çš„è½®å»“äº†ï¼ŒQt ä¸­çš„ç”»ç¬”æ˜¯ QPen å¯¹è±¡ï¼›ç”»å®Œè½®å»“åï¼Œå¯èƒ½è¿˜éœ€è¦ä½¿ç”¨ç”»åˆ·æ¥å¡«å……è½®å»“ï¼ŒQt ä¸­çš„ç”»åˆ·æ˜¯ QBrush å¯¹è±¡ã€‚ ä¸€ã€QPaintDeviceæœ¬èŠ‚ä»‹ç» QPaintDevice çš„å‡ ä¸ªå¸¸ç”¨æ–¹æ³•ã€‚ devicePixelRatio() ä¸ devicePixelRatioF() ç”¨äºè·å–DPIçš„ç¼©æ”¾å€æ•°ï¼Œéœ€è¦å…ˆåœ¨ç¨‹åºä¸­å¼€å¯DPIç¼©æ”¾ç‰¹æ€§ï¼š 123456789int main(int argc, char *argv[]){ QGuiApplication::setAttribute(Qt::AA_EnableHighDpiScaling); QGuiApplication::setAttribute(Qt::AA_UseHighDpiPixmaps);#if (QT_VERSION &gt;= QT_VERSION_CHECK(5, 14, 0)) QGuiApplication::setHighDpiScaleFactorRoundingPolicy(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);#endif // .......} ä» Qt 5.14 ç‰ˆæœ¬å¼€å§‹ï¼ŒQtå¯ä»¥æ”¯æŒå°æ•°ä½çš„ DPI ç¼©æ”¾ï¼Œå¦‚ 1.25ã€1.75 ç­‰ã€‚å¦‚éœ€è·å–å°æ•°ä½DPIå€¼ï¼Œéœ€è¦å…ˆè®¾ç½®Qt::HighDpiScaleFactorRoundingPolicy::PassThroughç­–ç•¥ï¼Œç„¶åé€šè¿‡ devicePixelRatioF æ–¹æ³•è·å–ã€‚ width() ä¸ height() ç”¨äºè·å– QPaintDevice çš„å®½å’Œé«˜ï¼Œè¿™ä¸ªæ•°å€¼ä¸ä¼šéšç€åæ ‡ç³»çš„æ”¹å˜è€Œæ”¹å˜ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šéšç€ DPI çš„æ”¹å˜è€Œæ”¹å˜ã€‚ widthMM() ä¸ heightMM() ç”¨äºè·å– QPaintDevice åœ¨å±å¹•ä¸Šå®é™…æ˜¾ç¤ºçš„å®½å’Œé«˜ï¼Œå•ä½ä¸ºæ¯«ç±³ã€‚ äºŒã€QPenç”»ç¬”æœ‰å®½åº¦ï¼ˆwidth/widthFï¼‰ã€é¢œæ–™ï¼ˆbrushï¼‰ã€çº¿æ¡æ ·å¼ï¼ˆStyleï¼‰ã€ä¸€æ¡çº¿èµ·ç¬”å’Œè½ç¬”çš„æ ·å¼ï¼ˆCapStyleï¼‰ã€ä¸¤æ¡çº¿ç›¸äº¤å¤„çš„æ ·å¼ï¼ˆJoinStyleï¼‰ç­‰å±æ€§ã€‚ 2.1 å®½åº¦12void QPen::setWidth(int width)void QPen::setWidthF(qreal width) å¦‚æœæŒ‡å®šçš„å®½åº¦å°äº 0ï¼Œå°†ä¸ä¼šç»˜åˆ¶ä»»ä½•å†…å®¹ï¼›å¦‚æœæŒ‡å®šçš„å®½åº¦ç­‰äº 0ï¼Œå°†è¢«è§†ä¸º 1 ä¸ªåƒç´ å®½åº¦ï¼›å¦‚æœæŒ‡å®šçš„å®½åº¦å¤§äºç­‰äº 1ï¼Œåˆ™æŒ‰æŒ‡å®šçš„å®½åº¦æ¥ç»˜åˆ¶ã€‚ 2.2 QPençš„ç”»åˆ·1void QPen::setBrush(const QBrush &amp;brush) QPen æœ‰ç”»åˆ·å±æ€§ï¼ŒQPainter å¯¹è±¡ä¹Ÿç”»åˆ·å±æ€§ï¼ˆä¸‹é¢ç« èŠ‚ä¼šä»‹ç»ï¼‰ï¼ŒäºŒè€…éƒ½æœ‰å¡«å……ä¹‹æ„ï¼ŒQPen çš„ç”»åˆ·æ˜¯ç”¨æ¥å¡«å……ç”»ç¬”æ‰€ç”»çš„çº¿æ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºç”»ç¬”çš„é¢œæ–™ï¼‰çš„ï¼Œè€ŒQPainter çš„ç”»åˆ·æ˜¯ç”¨æ¥å¡«å……ç”»ç¬”æ‰€ç”»çš„è½®å»“åŒºåŸŸçš„ï¼Œå¦‚å¡«å……çŸ©å½¢é‡Œé¢çš„åŒºåŸŸã€‚ ç”»åˆ·å¯ä»¥æ˜¯çº¯è‰²ã€æ¸å˜è‰²ï¼Œä¹Ÿå¯ä»¥æ˜¯å›¾ç‰‡ã€‚ 2.3 çº¿æ¡æ ·å¼1void QPen::setStyle(Qt::PenStyle style) 2.4 èµ·è½ç¬”æ ·å¼1void QPen::setCapStyle(Qt::PenCapStyle style) 2.5 æ‹ç‚¹æ ·å¼1void QPen::setJoinStyle(Qt::PenJoinStyle style) 2.6 å®ä¾‹ä¸‹é¢ç¤ºä¾‹æŒ‡å®šäº†ç”»ç¬”çš„å¦‚ä¸‹å±æ€§ï¼š ç”»ç¬”çš„å®½åº¦ä¸º 70px ä½¿ç”¨çº¢è‰²ç”»åˆ· çº¿æ¡æ ·å¼ä¸ºé€šè¿‡è‹¥å¹²ç©ºæ ¼åˆ†å‰²çš„ç‚¹çº¿çŠ¶ çº¿æ¡èµ·ç¬”å’Œè½ç¬”å¤„ä¸ºåœ†å½¢ çº¿æ¡æ‹ç‚¹å¤„ä¹Ÿä¸ºåœ†å½¢ 1234567891011121314151617void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QPen pen; pen.setWidth(70); pen.setBrush(Qt::red); pen.setStyle(Qt::DotLine); pen.setCapStyle(Qt::RoundCap); pen.setJoinStyle(Qt::RoundJoin); painter.setPen(pen); painter.drawLine(50, 50, 600, 50); painter.drawLine(600, 50, 600, 600);} å®é™…ç»˜åˆ¶å‡ºæ¥çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸Šé¢ç”»ç¬”ä½¿ç”¨çº¢è‰²ä½œä¸ºé¢œæ–™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ¸å˜è‰²ä½œä¸ºé¢œæ–™ï¼Œå½“ç„¶è¿˜å¯ä»¥ä½¿ç”¨å›¾ç‰‡ä½œä¸ºé¢œæ–™ã€‚ ä¸‹é¢æˆ‘ä»¬å°†é¢œæ–™æ›´æ”¹ä¸ºä¸€ä¸ªçº¢è‰²çš„å¿ƒå½¢â™¥å›¾ç‰‡ï¼š 123456789101112131415161718void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QPen pen; pen.setWidth(70); pen.setBrush(QImage(\":/heart.png\")); // ä»…ä¿®æ”¹äº†æ­¤è¡Œä»£ç  ~~~~~~~~~~~~~~ pen.setStyle(Qt::DotLine); pen.setCapStyle(Qt::RoundCap); pen.setJoinStyle(Qt::RoundJoin); painter.setPen(pen); painter.drawLine(50, 50, 600, 50); painter.drawLine(600, 50, 600, 600);} ç»˜åˆ¶çš„æ•ˆæœå¦‚ä¸‹ï¼š ä¸‰ã€QBrushQPen ä¸ QPainter éƒ½æœ‰ç”»åˆ·å±æ€§ï¼Œè¿™é‡Œçš„ QBrush æ˜¯æŒ‡çš„ QPainter çš„ç”»åˆ·ã€‚è™½ç„¶ä¸ QPen çš„ç”»åˆ·éƒ½ä¸º QBrush ç±»å‹ï¼Œä½†äºŒè€…æ˜¯æœ‰åŒºåˆ«çš„ï¼ŒQPen çš„ç”»åˆ·æ˜¯ç”¨æ¥å¡«å……ç”»ç¬”æ‰€ç”»çº¿æ¡ï¼ˆå¯ä»¥ç†è§£ä¸ºç”»ç¬”çš„é¢œæ–™ï¼‰çš„ï¼Œè€Œ QPainter çš„ç”»åˆ·æ˜¯ç”¨æ¥å¡«å……ç”»ç¬”æ‰€ç”»çš„è½®å»“æ‰€åŒ…å›´çš„åŒºåŸŸï¼Œå¦‚å¡«å……çŸ©å½¢é‡Œé¢çš„åŒºåŸŸã€‚ å¦‚ä¸‹é¢ç¤ºä¾‹ï¼š 12345678910111213void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QPen pen; pen.setWidth(6); pen.setBrush(Qt::red); painter.setPen(pen); painter.setBrush(Qt::blue); painter.drawRect(50, 50, 200, 200);} å®é™…ç»˜åˆ¶çš„çŸ©å½¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š QBrush æœ‰æ ·å¼ï¼ˆStyleï¼‰ã€é¢œè‰²ï¼ˆColorï¼‰ã€æ¸å˜è‰²ï¼ˆGradientï¼‰ã€çº¹ç†å›¾ç‰‡ï¼ˆTextureï¼‰ç­‰å±æ€§ã€‚ 3.1 æ ·å¼ç”»åˆ·çš„ä½œç”¨æ˜¯å¡«å……åŒºåŸŸï¼Œç”»åˆ·çš„æ ·å¼åˆ™æ˜¯ç”¨æ¥æŒ‡å®šé€šè¿‡ä»€ä¹ˆæ¨¡å¼æ¥å¡«å……åŒºåŸŸçš„ã€‚ ä¸‹å›¾åˆ—å‡ºäº† QBrush æ”¯æŒçš„æ ·å¼ï¼š QBrushçš„åˆå§‹æ ·å¼æ˜¯ Qt::NoBrushï¼Œå³ä¸åšå¡«å……æ“ä½œï¼Œè¯¥å€¼æ˜¾ç„¶æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé”™è¯¯çš„ä½¿ç”¨ç¤ºä¾‹ï¼› 123// é”™è¯¯ç¤ºä¾‹QBrush brush;brush.setColor(Qt::red); // ç”»åˆ·ä»ç„¶æ˜¯ Qt::NoBrushæ ·å¼ï¼Œä¸ä¼šå¡«å……ä»»ä½•é¢œè‰² æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å’Œ setStyle æ–¹æ³•æ¥è®¾ç½®æ ·å¼ï¼š 123QBrush(Qt::BrushStyle style)void setStyle(Qt::BrushStyle style) å½“é€šè¿‡ä¸åŒçš„æ–¹å¼æ„é€  QBrush å¯¹è±¡æ—¶ï¼ŒQBrush çš„æ ·å¼ä¹Ÿä¼šè‡ªåŠ¨è¢«è®¾ç½®ä¸ºä¸åŒçš„å€¼ï¼š 12345678// æ ·å¼è‡ªåŠ¨è¢«è®¾ç½®ä¸ºæ¸å˜æ ·å¼ï¼šQt::LinearGradientPattern, Qt::RadialGradientPattern æˆ– Qt::ConicalGradientPatternQBrush(const QGradient &amp;gradient) // æ ·å¼è‡ªåŠ¨è¢«è®¾ç½®ä¸ºçº¹ç†æ ·å¼Qt::TexturePatternQBrush(const QImage &amp;image) QBrush(const QPixmap &amp;pixmap)QBrush(Qt::GlobalColor color, const QPixmap &amp;pixmap)QBrush(const QColor &amp;color, const QPixmap &amp;pixmap) 3.2 çº¹ç†å›¾ç‰‡ä¸Šé¢2.6èŠ‚çš„å®ä¾‹ä¸­ï¼Œåœ¨è®¾ç½®å¿ƒå½¢å›¾ç‰‡ä½œä¸ºQPençš„ç”»åˆ·æ—¶ï¼Œä½¿ç”¨çš„å°±æ˜¯çº¹ç†å›¾ç‰‡ã€‚ ä¸‹é¢æ±‡æ€»äº†è®¾ç½® QBrush çº¹ç†å›¾ç‰‡çš„å‡ ç§æ–¹æ³•ï¼š 123456789// é€šè¿‡æ„é€ å‡½æ•°QBrush(const QImage &amp;image)QBrush(const QPixmap &amp;pixmap)QBrush(Qt::GlobalColor color, const QPixmap &amp;pixmap)QBrush(const QColor &amp;color, const QPixmap &amp;pixmap)// é€šè¿‡æˆå‘˜æ–¹æ³•void setTexture(const QPixmap &amp;pixmap)void setTextureImage(const QImage &amp;image) é€šè¿‡ä¸Šé¢æ–¹å¼è®¾ç½®çº¹ç†å›¾ç‰‡åï¼ŒQBrush æ ·å¼ä¼šè¢«è‡ªåŠ¨ä¿®æ”¹ä¸º Qt::TexturePatternï¼Œå› ä¸ºçº¹ç†å›¾ç‰‡åªèƒ½ä¸ Qt::TexturePattern æ ·å¼é…åˆä½¿ç”¨ï¼Œå¦åˆ™çº¹ç†å›¾ç‰‡å°†å¤±æ•ˆã€‚ 3.3 çº¯è‰²å¯ä»¥ä¸ºç”»åˆ·æŒ‡å®šçº¯è‰²æˆ–æ¸å˜è‰²ï¼Œçº¯è‰²ä½¿ç”¨ QColor å¯¹è±¡è¡¨ç¤ºã€‚ å¸¸ç”¨çš„æ„é€  QColor å¯¹è±¡çš„æ–¹å¼æœ‰å¦‚ä¸‹å‡ ç§ï¼š 1234QColor(\"#FFFFFF\"); // r g bQColor(\"#AAFFFFFF\"); // a r g bQColor(255, 255, 255, 255); // r g b aQColor(Qt::red); // Qt::GlobalColor æšä¸¾å€¼ 3.4 æ¸å˜è‰²QBrush åªæä¾›äº†ä¸€ç§æ–¹å¼æ¥æŒ‡å®šæ¸å˜è‰²ï¼š 1QBrush(const QGradient &amp;gradient) åœ¨Qtä¸­ï¼Œæ¸å˜è‰²ä½¿ç”¨ QGradient åŠå…¶å­ç±»è¡¨ç¤ºï¼Œç›®å‰Qtæ”¯æŒä¸‰ç§ç±»å‹çš„æ¸å˜ï¼š çº¿æ€§æ¸å˜ï¼Œå¯¹åº” QLinearGradient ç±»ã€‚ é”¥å½¢æ¸å˜ï¼Œå¯¹åº” QConicalGradient ç±»ã€‚ å¾„å‘æ¸å˜ï¼Œåˆåˆ†ä¸ºç®€å•å¾„å‘æ¸å˜å’Œæ‰©å±•å¾„å‘æ¸å˜ï¼ŒäºŒè€…éƒ½å¯¹åº” QRadialGradient ç±»ã€‚ ä¸‹å›¾æ˜¯ä¸€ä¸ªä»å·¦åˆ°å³ï¼Œç”±ç™½åˆ°é»‘çš„æ¸å˜è¿‡ç¨‹ï¼š å¡«å……æ–¹å‘æ—¢ç„¶å¯ä»¥ä»å·¦åˆ°å³ã€ä»å³åˆ°å·¦çš„ã€ä»é‡Œåˆ°å¤–ï¼Œæ˜¯å¯ä»¥360åº¦æ—‹è½¬ç­‰ç­‰ï¼Œä¸åŒçš„å¡«å……æ–¹å‘é€ å°±äº†ä¸åŒç±»å‹çš„æ¸å˜ï¼Œä¸Šè¿°ä¸‰ç§ç±»å‹çš„æ¸å˜ä¸»è¦åŒºåˆ«ä¹Ÿåœ¨å¡«å……æ–¹å‘çš„ä¸åŒã€‚ 3.4.1 çº¿æ€§æ¸å˜QLinearGradient æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š 12QLinearGradient(qreal x1, qreal y1, qreal x2, qreal y2)QLinearGradient(const QPointF &amp;start, const QPointF &amp;finalStop) é€šè¿‡æŒ‡å®šä¸€ä¸ªèµ·ç‚¹å’Œä¸€ä¸ªç»ˆç‚¹å°±å¯ä»¥ç¡®å®šä¸€æ¡çº¿æ®µçš„é•¿åº¦åŠæ–¹å‘ï¼Œè¿™ä¸ªæ–¹å‘å°±æ˜¯å¡«å……æ–¹å‘ï¼Œæ¸å˜èŒƒå›´åŸºäºè¯¥é•¿åº¦è€Œç¡®å®šï¼ˆè¯¦è§åé¢çš„â€œæ¸å˜èŒƒå›´â€ç« èŠ‚ï¼‰ã€‚ çº¿æ€§æ¸å˜çš„æ–¹å‘å¯ä»¥æ˜¯æ°´å¹³çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å‚ç›´çš„ï¼Œè¿˜å¯ä»¥æ˜¯æ–œç€çš„ï¼Œå…·ä½“æ–¹å‘ç”±çº¿æ®µä¸Xè½´çš„å¤¹è§’æ¥å†³å®šã€‚ ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªèµ·ç‚¹ä¸º(0,0)ã€ç»ˆç‚¹ä¸º(0,400)ï¼Œå‚ç›´æ–¹å‘çš„çº¿æ€§æ¸å˜ï¼Œç„¶åä½¿ç”¨è¯¥æ¸å˜å¡«å……ä½ç½®åœ¨ (0,0)ï¼Œå®½é«˜ä¸º 200x400 çš„çŸ©å½¢ï¼ˆè¯·æ³¨æ„çŸ©å½¢çš„ä½ç½®å’Œå¤§å°ï¼Œè¿™ä¸ªä¸æ¸å˜çš„èµ·æ­¢ä½ç½®æœ‰å…³ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ï¼š 1234567891011121314void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QLinearGradient linearGrad(QPointF(0, 0), QPointF(0, 400)); linearGrad.setColorAt(0, Qt::black); linearGrad.setColorAt(1, Qt::white); QBrush brush(linearGrad); painter.setBrush(brush); painter.drawRect(0, 0, 200, 400);} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç”±äºæ˜¯å‚ç›´æ–¹é¢çš„æ¸å˜ï¼Œæ‰€ä»¥æ¸å˜è‰²ä»ä¸Šåˆ°ä¸‹å˜åŒ–çš„ï¼Œé¢œè‰²èµ·å§‹äºé»‘è‰²ï¼Œç»ˆæ­¢äºç™½è‰²ã€‚ æ¸å˜è‰²çš„èµ·æ­¢é¢œè‰²ç”±setColorAtæ–¹æ³•è®¾ç½®ï¼Œè¯¥æ–¹æ³•åŸå‹å¦‚ä¸‹ï¼š 1void QGradient::setColorAt(qreal position, const QColor &amp;color) setColorAt ä¸ä»…æ¥å—é¢œè‰²å‚æ•°ï¼Œè¿˜æ”¯æŒ postion å‚æ•°ï¼Œposition å‚æ•°çš„èŒƒå›´æ˜¯[0,1]ã€‚çº¿æ€§æ¸å˜é€šè¿‡èµ·æ­¢ä½ç½®ç¡®å®šäº†ä¸€æ¡å¸¦æ–¹å‘çš„çº¿æ®µï¼Œè€Œ position å‚æ•°åˆ™ç”¨äºç¡®å®šçº¿æ®µä¸Šçš„ä¸€ä¸ªå…·ä½“ä½ç½®ï¼Œç»“åˆpositionå’Œcolorå‚æ•°å°±å¯ä»¥è¡¨ç¤ºåœ¨æŸä¸€ä½ç½®çš„é¢œè‰²å€¼ã€‚ å¯ä»¥ä½¿ç”¨ setColorAt æ–¹æ³•æŒ‡å®šå¤šä¸ªåœ¨[0,1]ä¹‹é—´çš„ä½ç½®åŠè¯¥ä½ç½®çš„é¢œè‰²ï¼ŒQtä¼šè‡ªåŠ¨åœ¨å¤šä¸ªé¢œè‰²ä¹‹é—´æ’å…¥è¿‡æ¸¡è‰²ï¼Œè¾¾åˆ°å¹³æ»‘è¿‡æ¸¡çš„æ•ˆæœã€‚ ç°åœ¨æˆ‘ä»¬åœ¨ 0.3 ä½ç½®æ’å…¥ä¸€ä¸ªéªšæ°”çš„çº¢è‰²ï¼Œ0.5ä½ç½®æ’å…¥é»„è‰²ï¼Œå…¶ä»–éƒ½ä¿æŒä¸å˜ï¼š 1234linearGrad.setColorAt(0, Qt::black);linearGrad.setColorAt(0.3, Qt::red);linearGrad.setColorAt(0.8, Qt::yellow);linearGrad.setColorAt(1, Qt::white); æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.4.2 æ¸å˜èŒƒå›´åœ¨ä¸Šé¢ä¸€èŠ‚ï¼Œæˆ‘ä»¬å¼ºè°ƒäº†æ‰€ç»˜åˆ¶çš„çŸ©å½¢çš„ä½ç½®/å¤§å°ä¸æ¸å˜çš„èµ·æ­¢ä½ç½®æœ‰å…³ï¼Œè€Œä¸”åˆå¼ºè°ƒäº† position å‚æ•°æ‰€ç¡®å®šæ˜¯çº¿æ®µä¸Šçš„å…·ä½“ä½ç½®ã€‚å…¶æ ¹æœ¬åŸå› å°±åœ¨äºæ¸å˜æ˜¯æœ‰ä½ç½®å’ŒèŒƒå›´çš„ã€‚ å¯¹äºçº¿æ€§æ¸å˜è€Œè¨€ï¼Œæ¸å˜çš„èŒƒå›´æ˜¯èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹é—´çš„çº¿æ®µï¼Œä½†é¢œè‰²åœ¨å‚ç›´äºè¯¥çº¿æ®µçš„æ–¹å‘å´æ˜¯æ— é™æ‰©å……çš„ï¼Œä¸‹é¢ç¤ºä¾‹å¯ä»¥å¾ˆå¥½çš„è¯´æ˜è¿™ä¸€ç‰¹æ€§ã€‚ 123456789101112131415161718// Qt2DSampleçª—å£é•¿å®½ä¸º600x600void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QLinearGradient linearGrad(QPointF(150, 150), QPointF(450, 450)); linearGrad.setColorAt(0, Qt::yellow); linearGrad.setColorAt(0.5, Qt::red); linearGrad.setColorAt(1, Qt::white); QBrush brush(linearGrad); painter.setBrush(brush); painter.drawRect(0, 0, 600, 600); // ä¸ä½¿ç”¨ç”»åˆ·ï¼Œç»˜åˆ¶ å·¦ä¸Šè§’ -&gt; å³ä¸‹è§’ ä¸ºçº¿æ€§æ¸å˜èµ·æ­¢ç‚¹çš„çŸ©å½¢ painter.setBrush(Qt::NoBrush); painter.drawRect(150, 150, 300, 300);} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ¸å˜è‰²åœ¨å‚ç›´äºæ¸å˜çº¿æ®µï¼ˆä¸­é—´çŸ©å½¢çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’è¿æˆçš„æ–œçº¿ï¼‰æ–¹å‘æ— é™æ‰©å±•ï¼Œä½†ä¸ºä»€ä¹ˆåœ¨æ¸å˜èŒƒå›´è¾¹ç•Œä»¥å¤–è¿˜æœ‰é¢œè‰²å‘¢ï¼Ÿå¦‚å·¦ä¸Šè§’çš„é»„è‰²å’Œå³ä¸‹è§’çš„ç™½è‰²ï¼Œè¿™ä¸ªä¸æ¸å˜çš„å¦ä¸€ä¸ªå±æ€§ç‰¹æ€§æœ‰å…³ â€“ æ¸å˜ä¼ æ’­ï¼Œåé¢ç« èŠ‚æœ‰è¯¦ç»†ä»‹ç»ã€‚ 3.4.3 é”¥å‘æ¸å˜QConicalGradient ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š 12QConicalGradient(qreal cx, qreal cy, qreal angle)QConicalGradient(const QPointF &amp;center, qreal angle) é”¥å‘æ¸å˜é€šè¿‡ä¸­å¿ƒç‚¹ï¼ˆcenterï¼‰å’Œèµ·å§‹è§’åº¦æ¥ï¼ˆangleï¼‰æ¥æ‰€è¿æ¥çš„ç›´çº¿ç¡®å®šå¡«å……çš„åˆå§‹æ–¹å‘ï¼Œç„¶åä»è¯¥ç›´çº¿å¼€å§‹é€†æ—¶é’ˆè¿›è¡Œ360åº¦å¡«å……ï¼Œè€Œä¸”æ¯ä¸ªè§’åº¦çš„é¢œè‰²éƒ½æ˜¯æ— é™å‘å¤–ä¼ æ’­çš„ã€‚ 1234567891011121314151617// Qt2DSampleçª—å£é•¿å®½ä¸º200x200void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); // è®¾å®šä¸­å¿ƒç‚¹åˆšå¥½åœ¨çª—å£ä¸­å¿ƒï¼Œèµ·å§‹è§’åº¦ä¸º45åº¦ QConicalGradient conicalGrad(QPointF(100, 100), 45); conicalGrad.setColorAt(0, Qt::yellow); conicalGrad.setColorAt(0.5, Qt::red); conicalGrad.setColorAt(1, Qt::white); QBrush brush(conicalGrad); painter.setBrush(brush); // ç»˜åˆ¶çš„çŸ©å½¢åŒºåŸŸä¸ºæ•´ä¸ªçª—å£å¤§å° painter.drawRect(0, 0, 200, 200);} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¸å˜è‰²ä»45åº¦å¼€å§‹æ¸å˜ï¼Œå¹¶ä¸”æ¯ä¸ªè§’åº¦éƒ½æ— é™å‘å¤–ä¼ æ’­ï¼Œå¡«å……æ»¡äº†æ•´ä¸ªçŸ©å½¢ï¼š 3.4.5 å¾„å‘æ¸å˜å¾„å‘æ¸å˜åˆ†ä¸ºç®€å•å¾„å‘æ¸å˜å’Œæ‰©å±•å¾„å‘æ¸å˜ï¼Œåœ¨ä»‹ç»äºŒè€…çš„ä¸åŒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹QRadialGradient ç±»çš„æ„é€ å‡½æ•°å¯ä»¥å¤§è‡´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š 12345678// æŒ‡å®šä¸­å¿ƒç‚¹ã€åŠå¾„ã€ç„¦ç‚¹ä½ç½®ã€ç„¦åŠå¾„QRadialGradient(const QPointF &amp;center, qreal centerRadius, const QPointF &amp;focalPoint, qreal focalRadius)// ä»…æŒ‡å®šä¸­å¿ƒç‚¹ã€åŠå¾„ï¼Œæ­¤æ—¶ç„¦ç‚¹ä½ç½®ä¸ä¸­å¿ƒç‚¹é‡åˆQRadialGradient(const QPointF &amp;center, qreal radius)// æŒ‡å®šä¸­å¿ƒç‚¹ã€åŠå¾„ã€ç„¦ç‚¹ä½ç½®QRadialGradient(const QPointF &amp;center, qreal radius, const QPointF &amp;focalPoint) ä¸­å¿ƒç‚¹ï¼ˆcenterï¼‰å’ŒåŠå¾„ï¼ˆcenterRadiusï¼‰ç»„æˆäº†ä¸€ä¸ªåœ†ï¼Œè®°ä¸ºåœ†Aï¼Œå¾„å‘æ¸å˜çš„èŒƒå›´åªé™äºåœ†Aä»¥å†…ï¼Œåœ†Aä»¥å¤–çš„åŒºåŸŸæŒ‰ç…§æŒ‡å®šçš„æ¸å˜ä¼ æ’­æ–¹å¼è¿›è¡Œä¼ æ’­ï¼› ç„¦ç‚¹ï¼ˆfocalPointï¼‰ä¸ºå¹³é¢ä¸Šçš„çš„ä¸€ä¸ªç‚¹ï¼Œç®€å•å¾„å‘æ¸å˜å’Œæ‰©å±•å¾„å‘æ¸å˜å¯¹ç„¦ç‚¹çš„ä½ç½®æœ‰ä¸åŒçš„è¦æ±‚ï¼Œè¿™ä¸ªåŒºåˆ«åœ¨åé¢ä¼šä»‹ç»ï¼› ç„¦åŠå¾„ï¼ˆfocalRadiusï¼‰åˆ™æ˜¯å›´ç»•ç„¦ç‚¹æ‰€ä½œçš„å¦å¤–ä¸€ä¸ªåœ†ï¼ˆè®°ä¸ºåœ†Bï¼‰çš„åŠå¾„ã€‚ æ‰©å±•å¾„å‘æ¸å˜æ˜¯åœ¨ç®€å•å¾„å‘æ¸å˜çš„åŸºç¡€ä¸Šé¢å¤–ä½¿ç”¨äº† focalRadiusï¼ˆç„¦ç‚¹åŠå¾„ï¼‰è¿™ä¸ªå‚æ•°ã€‚ ç®€å•å¾„å‘æ¸å˜ç„¦ç‚¹å’Œåœ†Aåœ†å¼§ä¸Šçš„æ¯ä¸€ä¸ªç‚¹éƒ½å¯ä»¥ç»„æˆä¸€æ¡çº¿æ®µï¼Œå¦‚æœæŒ‰ç…§1åº¦å–ä¸€ä¸ªç‚¹ï¼Œå°±æœ‰360ä¸ªçº¿æ®µï¼Œç®€å•å¾„å‘æ¸å˜å°±æ˜¯å¯¹è¿™360ä¸ªçº¿æ®µéƒ½è¿›è¡Œçº¿æ€§æ¸å˜ã€‚ å¯¹äºç®€å•å¾„å‘æ¸å˜è€Œè¨€ï¼Œå…è®¸ç„¦ç‚¹ä½äºåœ†å¼§ä¸Šå’Œåœ†å¤–ï¼Œå¦‚æœç„¦ç‚¹ä½äºåœ†å¤–ï¼Œä¼šè‡ªåŠ¨å°†å…¶é€€ç¼©åˆ°åœ†å¼§ä¸Šã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å¾„å‘æ¸å˜çš„ä¾‹å­ï¼š 123456789101112131415// Qt2DSampleçª—å£é•¿å®½ä¸º600x600void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); // ç„¦ç‚¹ä½äºåœ†å†…å³ä¸Šè§’éƒ¨åˆ† QRadialGradient radialGrad(QPointF(300, 300), 200, QPointF(400, 200)); radialGrad.setColorAt(0, Qt::white); radialGrad.setColorAt(1, Qt::black); QBrush brush(radialGrad); painter.setBrush(brush); painter.drawRect(0, 0, 600, 600);} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¾„å‘æ¸å˜çš„èŒƒå›´åªé™äºåœ†å†…ï¼Œåœ†å¤–çš„åŒºåŸŸé»˜è®¤é‡‡ç”¨PadSpreadæ–¹å¼ä¼ æ’­ï¼š æ‰©å±•å¾„å‘æ¸å˜æ‰©å±•å¾„å‘æ¸å˜ä½¿ç”¨ç„¦ç‚¹å’Œç„¦åŠå¾„åˆç»„æˆäº†ä¸€ä¸ªåœ†Bï¼Œä¸ç®€å•å¾„å‘æ¸å˜ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡å¯¹åœ†Aåœ†å¼§ä¸Šçš„æ¯ä¸ªç‚¹çš„è¿çº¿åšçº¿æ€§æ¸å˜æ¥å®ç°ï¼Œä½†è¿™æ¬¡ä¸æ˜¯ç„¦ç‚¹ä¸åœ†Aåœ†å¼§ä¸Šçš„ç‚¹è¿›è¡Œè¿çº¿ï¼Œè€Œæ˜¯â€œåœ†Båœ†å¼§ä¸Šçš„ç‚¹â€ä¸â€œåœ†Aåœ†å¼§ä¸Šçš„ç‚¹â€çš„è¿çº¿ï¼Œå¯¹è¿™äº›è¿çº¿åšçº¿æ€§æ¸å˜ã€‚ åœ†Bå§‹ç»ˆå¡«å……èµ·å§‹é¢œè‰²ã€‚ ä¸ç®€å•å¾„å‘æ¸å˜ä¸åŒçš„æ˜¯ï¼Œåœ†Bå¿…é¡»å®Œå…¨åœ¨åœ†Aé‡Œé¢ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰©å±•å¾„å‘æ¸å˜çš„ä¾‹å­ï¼š 123456789101112131415// Qt2DSampleçª—å£é•¿å®½ä¸º600x600void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); // ç„¦ç‚¹ä½äºåœ†å†…å³ä¸Šè§’éƒ¨åˆ†ï¼Œç„¦åŠå¾„ä¸º30 QRadialGradient radialGrad(QPointF(300, 300), 200, QPointF(400, 200), 30); radialGrad.setColorAt(0, Qt::white); radialGrad.setColorAt(1, Qt::black); QBrush brush(radialGrad); painter.setBrush(brush); painter.drawRect(0, 0, 600, 600);} æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.4.6 æ¸å˜ä¼ æ’­åœ¨Qtä¸­é€šè¿‡ setSpread æ–¹æ³•è®¾ç½®æ¸å˜ä¼ æ’­æ–¹å¼ï¼š 1void QGradient::setSpread(QGradient::Spread method) QGradient::Spreadæšä¸¾å®šä¹‰äº†ä¸‰ç§ä¼ æ’­æ–¹å¼ï¼š QGradient::PadSpread QGradient::RepeatSpread QGradient::ReflectSpread é»˜è®¤ä¸ºä¼ æ’­æ–¹å¼ä¸º QGradient::PadSpreadï¼Œè€Œä¸”ç”±é”¥å‘æ¸å˜çš„è¡Œä¸ºå¯çŸ¥ï¼Œé”¥å‘æ¸å˜æ˜¯æ²¡æœ‰æ¸å˜ä¼ æ’­ä¸€è¯´çš„ï¼Œå› æ­¤å®ƒå§‹ç»ˆéƒ½æ˜¯360åº¦æ¸å˜ã€‚ ä¸‹å›¾å½¢è±¡è¯´æ˜äº†ä¸‰ç§ä¼ æ’­æ–¹å¼çš„å·®å¼‚ï¼š PadSpread æ–¹å¼å»¶ç»­äº†èµ·ç‚¹ä¸ç»ˆç‚¹å¤„å„è‡ªçš„é¢œè‰²ï¼Œæ— é™ä¼ æ’­ RepeatSpread æ–¹å¼ä¸æ–­é‡å¤æ¸å˜è¾¹ç•Œå†…çš„è¿™ä¸€é¢œè‰²çš„æ¸å˜æ¨¡å¼ ReflectSpread æ–¹å¼å°†æ¸å˜è¾¹ç•Œå†…çš„æ¨¡å¼ä¸æ–­å¾€å¤–é•œåƒåå°„ 3.4.7 æ¸å˜ä¸»é¢˜è®¾è®¡ä¸€ä¸ªæ¼‚äº®çš„æ¸å˜è‰²å¹¶éæ˜“äº‹ï¼ŒQtæä¾›äº†å†…ç½®çš„æ¸å˜ä¸»é¢˜(Preset)ï¼Œè¿™äº›ä¸»é¢˜é€šè¿‡ QGradient::Preset æšä¸¾ç±»å‹æä¾›ï¼ˆè¯¥æšä¸¾ä» Qt 5.12 å¼€å§‹å¼•å…¥ï¼‰ã€‚ ä»Qtå®˜æ–¹æ–‡æ¡£å¾—çŸ¥ï¼ŒQGradient::Preseté¢„ç½®æ¸å˜ä¸»é¢˜æ–¹æ¡ˆæ˜¯åŸºäºhttps://webgradients.com/å®ç°çš„ã€‚ QGradient ç±»æ”¯æŒé€šè¿‡QGradient::Preset æšä¸¾ç±»å‹ç›´æ¥æ„é€ ï¼š 1QGradient::QGradient(QGradient::Preset preset) ä¸‹é¢æ˜¯ä½¿ç”¨QGradient::Presetçš„ç¤ºä¾‹ï¼š 1234567891011void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); QGradient grad(QGradient::HealthyWater); QBrush brush(grad); painter.setBrush(brush); painter.drawRect(0, 0, 600, 600);} 3.4.8 ç½‘ç«™æ¨èä¸‹é¢å‡ ä¸ªç½‘ç«™ä¹Ÿæä¾›äº†æ¼‚äº®çš„æ¸å˜è‰²æ–¹æ¡ˆï¼Œå¯ä»¥ç”¨ä½œå‚è€ƒï¼š grabient.com uigradients.com webgradients.com é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt"],"categories":["Qt"]},{"title":"ç©è½¬Qt 2Dç»˜å›¾ä¹‹åæ ‡ç³»","path":"/post/847642761.html","content":"Qtä¸­æä¾›äº†å¼ºå¤§çš„ 2D ç»˜å›¾ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„APIåœ¨å±å¹•å’Œç»˜å›¾è®¾å¤‡ä¸Šè¿›è¡Œç»˜åˆ¶ï¼Œä¸»è¦åŸºäº QPainterã€QPaintDeviceå’Œ QPaintEngine è¿™ä¸‰ä¸ªç±»å®ç°ï¼Œå…¶ä¸­ï¼š QPainteræ‰§è¡Œå…·ä½“çš„ç»˜å›¾æ“ä½œï¼ŒQPainter ç±»æä¾›äº†å¤§é‡çš„GUIç¼–ç¨‹æ‰€éœ€çš„å‡½æ•°ï¼Œå¦‚drawLineã€drawImageç­‰ã€‚ QPaintDevice æ˜¯ä¸€ä¸ªåŸºç±»ï¼Œæä¾›ç»˜å›¾è®¾å¤‡çš„æŠ½è±¡æ¥å£ï¼Œå®ƒæ˜¯ä¸€ä¸ªäºŒç»´ç©ºé—´çš„æŠ½è±¡ï¼Œå¯ä»¥ä½¿ç”¨QPainteråœ¨å…¶ä¸Šè¿›è¡Œç»˜åˆ¶ï¼Œå¸¸è§çš„ç»§æ‰¿è¯¥ç±»çš„ç»˜å›¾è®¾å¤‡æœ‰QImageã€QPixmapã€QWidgetã€QOpenGLPaintDeviceç­‰ã€‚ QPaintEngine æä¾›äº†ä¸€äº›æŠ½è±¡æ¥å£ï¼Œç”¨äºå®ç°QPainteråœ¨ä¸åŒçš„è®¾å¤‡ä¸Šè¿›è¡Œç»˜åˆ¶ã€‚QPaintEngine ç”± QPaintDevice åˆ›å»ºå¹¶ç®¡ç†ã€‚ åœ¨Qtå®˜æ–¹æ–‡æ¡£ä¸­æœ‰ä¸€å¼ å›¾å¯ä»¥å¾ˆå¥½è¯´æ˜Qtå„ä¸ªåæ ‡ç³»å˜æ¢æ–¹å¼ï¼ˆæš‚ä¸ç”¨å…³æ³¨å›¾ä¸Šçš„åæ ‡å€¼ï¼‰ï¼š æˆ‘ä»¬åœ¨ä½¿ç”¨QPainterç»˜å›¾æ—¶éœ€è¦ä¼ å…¥å…ƒç´ åæ ‡ï¼Œä¼ å…¥çš„åæ ‡å°±æ˜¯å›¾ä¸Šçš„ä¸–ç•Œåæ ‡ç³»ï¼ˆWorld Coordinatesï¼‰ï¼Œä¸–ç•Œåæ ‡ç»è¿‡çŸ©é˜µå˜æ¢ï¼ˆè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼‰åå†ä¼ é€’ç»™çª—å£åæ ‡ç³»ï¼ˆWindow Coordinatesï¼‰ï¼Œçª—å£åæ ‡ç³»ä¸Šçš„å…ƒç´ çš„åæ ‡è¿˜éœ€ç»è¿‡çª—å£åˆ°è§†å£çš„åæ ‡å˜æ¢ï¼ˆçº¿æ€§å˜æ¢ï¼‰ï¼Œæœ€ååœ¨è®¾å¤‡åæ ‡ç³»ï¼ˆDevice Coordinatesï¼‰çš„è§†å£åŒºåŸŸå†…ç»˜åˆ¶ã€‚ 1. ä¸–ç•Œåæ ‡ç³»ä¸–ç•Œåæ ‡ç³»ä¹Ÿç§°ä¹‹ä¸ºé€»è¾‘åæ ‡ç³»ï¼Œä½¿ç”¨çš„å•ä½å«é€»è¾‘å•ä½ã€‚ åœ¨çœŸå®çš„ä¸–ç•Œåœ°ç†ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç»çº¬åº¦æ¥è¡¨ç¤ºæŸä¸€ä¸ªå…·ä½“ä½ç½®ï¼Œå¦‚æ­¦æ±‰çš„åæ ‡ä¸º(ä¸œç»114Â°,åŒ—çº¬30Â°)ï¼Œè€Œåœ¨Qtç»˜å›¾æ—¶ä½¿ç”¨çš„é€»è¾‘å•ä½æ˜¯åƒç´ ã€‚ Qtçš„åƒç´ æ”¯æŒéæ•´æ•°æ•°é‡ï¼Œå¦‚ 0.5 ä¸ªåƒç´ ï¼Œè€Œå®é™…è®¾å¤‡ï¼ˆå¦‚æ˜¾ç¤ºå™¨ã€æ‰“å°æœºç­‰ï¼‰åªæ”¯æŒæ•´æ•°æ•°é‡çš„åƒç´ æ˜¾ç¤ºï¼Œå› æ­¤ä»é€»è¾‘åæ ‡åˆ°è®¾å¤‡åæ ‡éœ€è¦ç»è¿‡ç›¸åº”çš„è½¬æ¢è¿‡ç¨‹ã€‚ åœ¨Qtä¸­ï¼Œæˆ‘ä»¬æä¾›ç»™ QPainter çš„éƒ½æ˜¯é€»è¾‘åæ ‡ï¼Œè¿™ç§åæ ‡ä¸å…·ä½“çš„è®¾å¤‡ç±»å‹æ— å…³ã€‚ 2. çª—å£åæ ‡ç³»ä¸Šå›¾ä¸­çš„çª—å£æ˜¯æ‰“äº†å¼•å·çš„ï¼Œè¿™è¯´æ˜è¯¥çª—å£æ˜¯å®é™…ä¸å­˜åœ¨çš„ï¼Œè¿™ä¸ªçª—å£æŒ‡çš„æ˜¯çª—å£åæ ‡ç³»å·¦ä¸Šè§’åŸç‚¹åˆ°å³ä¸‹è§’çš„ä¸€ä¸ªè™šæ‹ŸçŸ©å½¢çª—å£ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œçª—å£åæ ‡ç³»å’Œé€»è¾‘åæ ‡ç³»éƒ½ç­‰åŒäºè®¾å¤‡åæ ‡ç³»ï¼Œä¸‰è€…é‡åˆï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨QPaintet::setWindowæ–¹æ³•é‡è®¾çª—å£åæ ‡ç³»çš„åŸç‚¹å’ŒèŒƒå›´ï¼Œæœ‰äº†å·¦ä¸Šè§’åŸç‚¹å’Œé•¿/å®½ï¼Œä¹Ÿå°±å¾—åˆ°ä¸€ä¸ªæ–°çš„â€œçª—å£â€ã€‚ åœ¨ç»˜å›¾æ—¶ä¼ é€’ç»™ QPainter çš„é€»è¾‘åæ ‡éœ€è¦å…ˆç»è¿‡çŸ©é˜µå˜æ¢ï¼ˆå¸¸è§çš„çŸ©é˜µå˜æ¢æœ‰QPainter çš„ translateã€scaleã€rotateã€shearç­‰æ–¹æ³•ï¼Œåé¢ç« èŠ‚ä¼šä»‹ç»ï¼‰ï¼Œç„¶åå†ä¼ é€’ç»™çª—å£åæ ‡ç³»ã€‚ 3. è®¾å¤‡åæ ‡ç³»ä¹Ÿç§°ä¹‹ä¸ºç‰©ç†åæ ‡ï¼ˆPhysical Coordinatesï¼‰ï¼Œåæ ‡åŸç‚¹ä½äºå·¦ä¸Šè§’ï¼ŒXè½´æ°´å¹³å‘å³å¢é•¿ï¼ŒYè½´å‚ç›´å‘ä¸‹å¢é•¿ã€‚ ä¸åŒçš„è®¾å¤‡åæ ‡å•ä½é€šå¸¸ä¸åŒï¼Œå¦‚æ˜¾ç¤ºå™¨é€šå¸¸ä»¥åƒç´ ä¸ºå•ä½ï¼Œè€Œæ‰“å°æœºé€šå¸¸ä»¥ç‚¹ä¸ºå•ä½ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯è®¾å¤‡åæ ‡ç³»çš„åŸç‚¹å’ŒèŒƒå›´å§‹ç»ˆç­‰åŒäºå®é™…ç»˜åˆ¶è®¾å¤‡ï¼Œä¸ä¼šè·Ÿéšé€»è¾‘åæ ‡ç³»ã€çª—å£åæ ‡ç³»ä»¥åŠè§†å£ï¼ˆviewportï¼‰çš„æ”¹å˜è€Œæ”¹å˜ã€‚ 4. è§†å£è§†å£ï¼ˆviewportï¼‰æ˜¯è®¾å¤‡ç¯å¢ƒä¸­çš„ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œä½¿ç”¨è®¾å¤‡åæ ‡ç³»è¡¨ç¤ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè§†å£å·¦ä¸Šè§’ä½ç½®ä¸ºè®¾å¤‡åæ ‡ç³»çš„åŸç‚¹ï¼Œå¤§å°ä¸ºå®é™…ç»˜åˆ¶ç›®æ ‡è®¾å¤‡çš„å¤§å°ã€‚ è§†å£å­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†æŒ‡å®šåœ¨æ˜¾ç¤ºè®¾å¤‡çš„ä»€ä¹ˆä½ç½®ï¼Œä»¥å¤šå¤§çš„èŒƒå›´æ¥å®Œå…¨æ˜¾ç¤ºæŒ‡å®šçš„çª—å£å†…å®¹ï¼Œå¦‚æœçª—å£å†…å®¹è¶…å‡ºäº†è§†å£åŒºåŸŸï¼Œè¶…å‡ºéƒ¨åˆ†å°†ä¸ä¼šæ˜¾ç¤ºã€‚ æˆ‘ä»¬å¯ä»¥ç”¨ QPainter::setViewport æ–¹æ³•æ¥æ”¹å˜è§†å£çš„ä½ç½®å’Œå¤§å°ï¼ŒQPainter::setViewport çš„å‚æ•°éƒ½æ˜¯åŸºäºè®¾å¤‡åæ ‡ç³»çš„ï¼Œå¦‚æœæŒ‡å®šçš„è§†å£åŒºåŸŸè¶…å‡ºäº†è®¾å¤‡å¤–ï¼Œè®¾å¤‡å¤–çš„å†…å®¹å°†ä¸ä¼šæ˜¾ç¤ºã€‚ 5. å®ä¾‹è®²è§£ä¸ºäº†æ›´å¥½è¯´æ˜å„ä¸ªåæ ‡ç³»åŠè§†å£ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å…·ä½“è¯´æ˜ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªé•¿å®½ä¸º400x400çš„çª—å£ï¼Œå¹¶ä¸”ç¨‹åºæœªå¼€å¯DPIç¼©æ”¾ç‰¹æ€§ï¼š 1resize(400, 400); ç»˜åˆ¶ä»£ç å¦‚ä¸‹ï¼š 1234567void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.translate(100, 200); painter.setWindow(QRect(200, 300, 600, 600)); painter.setViewport(QRect(100, 100, 300, 300)); painter.drawRect(QRect(300, 100, 200, 200));} ä¸‹å›¾ä½¿ç”¨ä¸åŒçš„é¢œè‰²ç»˜åˆ¶äº†ä¸åŒçš„åæ ‡ç³»åŠè§†å£ã€çª—å£çš„ä½ç½®å’ŒåŒºåŸŸï¼š ç¬¬1è¡Œä»£ç QPainter painter(this)ï¼š è¡¨æ˜æˆ‘ä»¬æ˜¯åœ¨å½“å‰ QWidget å®ä¾‹ä¸Šè¿›è¡Œç»˜åˆ¶ï¼Œå› æ­¤è®¾å¤‡åæ ‡ç³»åŸç‚¹ä¸º(0,0)ï¼Œåæ ‡ç³»çš„èŒƒå›´ä¸ºQWidgetçš„é•¿å®½400x400ï¼Œåæ ‡å•ä½ä¸ºåƒç´ ï¼Œå¯¹åº”ä¸Šå›¾ç»¿è‰²éƒ¨åˆ†ã€‚ æ­¤æ—¶è¿˜æœªè®¾ç½®è§†å£ï¼Œå› æ­¤è§†å£é»˜è®¤ç­‰åŒäºè®¾å¤‡åæ ‡ç³»çš„èŒƒå›´ï¼Œå³(0,0,400,400)ï¼Œè¯¥éƒ¨åˆ†æœªåœ¨ä¸Šå›¾ç”»å‡ºã€‚ ç¬¬2è¡Œä»£ç painter.translate(100, 200): å°†é€»è¾‘åæ ‡ç³»çš„åŸç‚¹åç§»(100,200)ä¸ªåƒç´ ã€‚ åœ¨è¿›è¡Œåç§»æ—¶ï¼Œå€¼ä¸ºæ­£è¡¨ç¤ºå‘æ–¹å‘ç§»åŠ¨ï¼Œå€¼ä¸ºè´Ÿè¡¨ç¤ºå‘è´Ÿæ–¹å‘ç§»åŠ¨ã€‚ ç¬¬3è¡Œä»£ç painter.setWindow(QRect(200, 300, 600, 600))ï¼š è®¾ç½®çª—å£åæ ‡ç³»åŸç‚¹ä¸º(200, 300)ï¼Œçª—å£èŒƒå›´æ˜¯600x600ï¼Œå¯¹åº”ä¸Šå›¾çº¢è‰²éƒ¨åˆ†ã€‚ ç¬¬4è¡Œä»£ç painter.setViewport(QRect(100, 100, 300, 300))ï¼š è®¾ç½®è§†å£ä¸ºQRect(100, 100, 300, 300)ï¼Œå³åœ¨è®¾å¤‡åæ ‡ç³»ä¸Šçš„ä½¿ç”¨QRect(100, 100, 300, 300)åŒºåŸŸæ¥æ˜¾ç¤ºä¸Šé¢600x600çš„çª—å£ï¼Œå¯¹åº”ä¸Šå›¾è“è‰²éƒ¨åˆ†ã€‚ ç¬¬2ã€3ã€4è¡Œä»£ç æ˜¯æ²¡æœ‰å…ˆåé¡ºåºçš„ï¼Œå› ä¸ºä¸‰ä¸ªè®¾ç½®å‡½æ•°æ‰€å½±å“çš„ç›®æ ‡æ˜¯ä¸åŒçš„ã€‚ ç¬¬5è¡Œä»£ç painter.drawRect(QRect(300, 100, 200, 200))ï¼š åœ¨ (300,100) ä½ç½®ç»˜åˆ¶ 200x200 çš„æ­£æ–¹å½¢ï¼Œæ­¤å¤„ä¼ é€’çš„æ˜¯é€»è¾‘åæ ‡ï¼Œè€Œé€»è¾‘åæ ‡ç³»å·²åœ¨ç¬¬2è¡Œä»£ç å¤„è¿›è¡Œäº†åç§»ï¼Œå› æ­¤æ ¹æ®æ–°çš„é€»è¾‘åæ ‡ç³»ï¼Œæ­£æ–¹å½¢å·¦ä¸Šè§’ä½ç½®æ˜¯ (300+100, 100+200) = (400, 300)ï¼Œåˆå› ä¸ºæ­¤å¤„é€»è¾‘åæ ‡ç³»æœªåšç¼©æ”¾æ“ä½œï¼ˆç¼©æ”¾æ“ä½œç”± QPainter::scale æä¾›ï¼‰ï¼Œå› æ­¤æ­£æ–¹å½¢çš„é•¿å®½ä¿æŒä¸å˜ï¼Œä»ä¸º200x200ï¼Œå³ QRect(400,300,200,200)ã€‚ ç„¶åå°†æ­£æ–¹å½¢ QRect(400,300,200,200) ä¼ é€’ç»™çª—å£åæ ‡ç³»ï¼Œè¯¥æ­£æ–¹å½¢åœ¨çª—å£åæ ‡ç³» (200,300,600,600) ä¸Šé¢çš„ä½ç½®å’Œå¤§å°å¯¹åº”ä¸Šå›¾ç²‰çº¢è‰²éƒ¨åˆ†ã€‚ æœ€åç”¨è®¾å¤‡åæ ‡ç³»ä¸Šçš„è§†å£åŒºåŸŸæ¥æ˜¾ç¤ºè¯¥çª—å£ï¼Œç”±äºçª—å£åæ ‡ç³»å’Œè®¾å¤‡åæ ‡ç³»çš„åŸç‚¹åŠèŒƒå›´ä¸ç›¸åŒï¼Œå› æ­¤è¿˜éœ€è¦åšçº¿æ€§è½¬åŒ–ï¼š 12345åœ¨(200, 300, 600, 600) èŒƒå›´ä¸Šæ˜¾ç¤ºçš„æ­£æ–¹å½¢ (400, 300, 200, 200)è½¬åŒ–ä¸ºåœ¨è§†å£(100, 100, 300, 300) èŒƒå›´ä¸Šæ˜¾ç¤ºçš„æ­£æ–¹å½¢ (x, y, w, h) ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºçª—å£èŒƒå›´æ˜¯è§†å£çš„600 / 300 = 2å€ï¼Œå› æ­¤åœ¨è§†å£ä¸Šçš„åŸç‚¹å’Œé•¿å®½åˆ†åˆ«ä¸ºï¼š 1234567x = 100 + (400 - 200) / 2 = 200y = 100 + (300 - 300) / 2 = 100w = 200 / 2 = 100h = 200 / 2 = 100 è®¡ç®—å¾—åˆ°éœ€è¦åœ¨è§†å£ (100, 100, 300, 300) ä¸Šç»˜åˆ¶çš„æ­£æ–¹å½¢ä¸º (200,100,100,100) ï¼Œå®é™…ç»˜åˆ¶çš„æ­£æ–¹å½¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 6. ç§»åŠ¨åŸç‚¹åˆ°çª—å£ä¸­å¤®é»˜è®¤æƒ…å†µä¸‹ï¼Œåæ ‡åŸç‚¹åœ¨çª—å£çš„å·¦ä¸Šè§’ï¼ŒXè½´æ°´å¹³å‘å³å¢é•¿ï¼ŒYè½´å‚ç›´å‘ä¸‹å¢é•¿ã€‚ç°åœ¨å°†åæ ‡åŸç‚¹ç§»åŠ¨åˆ°çª—å£ä¸­å¤®ï¼Œä½†ä¸æ”¹å˜Xè½´å’ŒYè½´çš„æ–¹å‘ã€‚ 123456789101112131415161718// Qt2DSampleçª—å£é•¿å®½ä¸º400x400void Qt2DSample::paintEvent(QPaintEvent* e) { QPainter painter(this); painter.setRenderHints(QPainter::Antialiasing | QPainter::TextAntialiasing); const int w = width(); const int h = height(); // å°†åæ ‡åŸç‚¹ç§»åŠ¨åˆ°çª—å£ä¸­å¤® painter.translate(w / 2.0, h / 2.0); // ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼š // painter.setWindow(w / 2.0, h / 2.0, w, h); // painter.translate(w, h); // ç»˜åˆ¶æµ‹è¯•çŸ©å½¢ painter.drawRect(QRect(0, 0, 100, 100));} å®é™…ç»˜åˆ¶çš„çŸ©å½¢åœ¨çª—å£ä¸­çš„ä½ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7. QRecté—ç•™é—®é¢˜åœ¨ä»‹ç» QRect çš„é—ç•™é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£Qtä¸­é”¯é½¿ä¸æŠ—é”¯é½¿çš„ç›¸å…³å†…å®¹ã€‚ 7.1 æŠ—é”¯é½¿ä¸‹å›¾å±•ç¤ºäº†åœ¨ç»˜åˆ¶ä¸€æ¡æ–œçº¿æ—¶ï¼Œæœªå¼€å¯æŠ—é”¯é½¿ï¼ˆå·¦è¾¹ï¼‰å’Œå¼€å¯äº†æŠ—é”¯é½¿åï¼ˆå³è¾¹ï¼‰ä¸¤è€…çš„æ•ˆæœã€‚ æŠ—é”¯é½¿å°±æ˜¯ç»˜å›¾å¼•æ“é€šè¿‡åœ¨å…ƒç´ çš„è¾¹ç¼˜å¡«å……ä¸åŒçš„é¢œè‰²æ¥å®ç°å¹³æ»‘è¾¹ç¼˜çš„æ•ˆæœã€‚ Qté»˜è®¤ç»˜å›¾çš„å…ƒç´ æ˜¯æœ‰é”¯é½¿çš„ï¼Œå½“ä½¿ç”¨1åƒç´ å®½çš„ç”»ç¬”ç»˜åˆ¶æ—¶ï¼Œå®é™…åƒç´ å°†æ¸²æŸ“åˆ°æˆ‘ä»¬å®šä¹‰åæ ‡çš„å³ä¸‹æ–¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“ç”»ç¬”å®½åº¦ä¸ºå¶æ•°æ—¶ï¼Œåƒç´ å°†å›´ç»•å®šä¹‰åæ ‡è¿›è¡Œå¯¹ç§°æ¸²æŸ“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“ç”»ç¬”å®½åº¦ä¸ºå¥‡æ•°æ—¶ï¼Œæ•´é™¤åå¤šä½™çš„1åƒç´ å°†æ¸²æŸ“åˆ°å®šä¹‰åæ ‡çš„å³ä¸‹æ–¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 7.2 QRectå®é™…å®½é«˜åŸºäºä¸Šè¿°åŸå› ï¼ŒQRect::right() å’Œ QRect::bottom() çš„å€¼å¹¶ä¸ç­‰äºçŸ©å½¢çœŸæ­£å³ä¸‹è§’çš„åæ ‡ã€‚ 1234567891011121314QRect::QRect(int aleft, int atop, int awidth, int aheight) noexcept : x1(aleft), y1(atop), x2(aleft + awidth - 1), y2(atop + aheight - 1) {}void QRect::setWidth(int w) noexcept{ x2 = (x1 + w - 1); }void QRect::setHeight(int h) noexcept{ y2 = (y1 + h - 1); }int QRect::width() const noexcept{ return x2 - x1 + 1; }int QRect::height() const noexcept{ return y2 - y1 + 1; } ä»ä¸Šé¢ QRect çš„æºç å¯çŸ¥ï¼ŒQRect::width() å’Œ QRect::height() æ–¹æ³•è¿”å›çš„æ˜¯çŸ©å½¢çš„å®é™…å®½é«˜ï¼Œä½† QRect::right() å’Œ QRect::bottom() æ–¹æ³•è¿”å›çš„ä¸æ˜¯çŸ©å½¢çš„å®é™…å³è¾¹å’Œåº•éƒ¨ï¼š 123QRect::right() è¿”å›çš„å®é™…æ˜¯ QRect::left() + QRect::width() - 1QRect::bottom() è¿”å›çš„å®é™…æ˜¯ QRect::top() + QRect::height() - 1 è¿™å±äºQRectçš„å†å²é—ç•™é—®é¢˜ï¼ŒQtä¸ºäº†å…¼å®¹ä¹‹å‰è€çš„ä»£ç ï¼Œå¯¹è¯¥éƒ¨åˆ†æœªä½œä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹å¼è·å–QRectçœŸå®çš„å®½å’Œé«˜ï¼š 123QRect::x() + QRect::width()QRect::y() + QRect::height() ä¹Ÿå¯ä»¥ä½¿ç”¨ QRectFç±»å‹æ¥ä»£æ›¿ QRect ç±»å‹ï¼ŒQRectFç±»å‹æ²¡æœ‰ä¸Šè¿°é—®é¢˜ã€‚ 7.3 å¼€å¯æŠ—é”¯é½¿åœ¨Qtä¸­å¼€å¯æŠ—é”¯é½¿ä¹Ÿéå¸¸ç®€å•ï¼Œä¸‹é¢ä»£ç å¼€å¯äº†æŠ—é”¯é½¿ï¼š 1234painter.setRenderHints( QPainter::Antialiasing | // æ¶ˆé™¤åŸºç¡€å…ƒç´ ï¼ˆå¦‚çº¿ã€ç‚¹ï¼‰è¾¹ç¼˜çš„é”¯é½¿ QPainter::TextAntialiasing // æ¶ˆé™¤æ–‡å­—è¾¹ç¼˜çš„é”¯é½¿); å¼€å¯æŠ—é”¯é½¿ä»¥åï¼Œåƒç´ å°†å§‹ç»ˆå›´ç»•å®šä¹‰åæ ‡è¿›è¡Œå¯¹ç§°æ¸²æŸ“ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åœ¨è¾¹ç¼˜å¡«å……é¢œè‰²æ¥å¹³æ»‘è¾¹ç¼˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 8. é€»è¾‘åæ ‡çŸ©é˜µå˜æ¢Qt æä¾›äº†æ–¹æ³•æ¥ç›´æ¥å¯¹ä¸–ç•Œåæ ‡ï¼ˆä¹Ÿå¯ç§°ä¸ºé€»è¾‘åæ ‡ï¼‰è¿›è¡ŒçŸ©é˜µå˜æ¢ï¼š 1void QPainter::setWorldTransform(const QTransform &amp;matrix, bool combine = false) è¿˜æä¾›æ–¹æ³•æ¥å¼€å¯å’Œå…³é—­ä¸–ç•Œåæ ‡çš„çŸ©é˜µå˜æ¢æ“ä½œï¼š 1void QPainter::setWorldMatrixEnabled(bool enable) åŒæ—¶ QPainter è¿˜æ˜¯æä¾›äº† translateã€scaleã€rotateã€shear ç­‰å¿«æ·æ–¹æ³•å®ç°å¯¹é€»è¾‘åæ ‡çš„çŸ©é˜µå˜æ¢æ“ä½œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è°ƒç”¨äº†translateã€scaleã€rotateã€shearæ–¹æ³•åï¼ŒQPainter ä¼šè‡ªåŠ¨å¼€å¯å¯¹ä¸–ç•Œåæ ‡çš„çŸ©é˜µè½¬æ¢ã€‚ ä¸ºäº†æ›´å¥½çš„ä»‹ç»æ˜¯é€»è¾‘åæ ‡çš„è½¬åŒ–è¿‡ç¨‹ï¼Œç°åœ¨å‡è®¾åœ¨åæ ‡å˜æ¢ä¹‹å‰å­˜åœ¨ ç‚¹A(x, y) å’Œ çŸ©å½¢B(x, y, w, h) 8.1 translate123void QPainter::translate(const QPointF &amp;offset)void QPainter::translate(const QPoint &amp;offset)void QPainter::translate(qreal dx, qreal dy) Xå’ŒYè½´åˆ†åˆ«å¹³ç§»è·ç¦» m å’Œ nï¼Œå¹³ç§»åï¼Œç‚¹Açš„åæ ‡ä¸º(x + m, y + n)ï¼ŒçŸ©å½¢Bçš„åæ ‡ä¸º(x + m, y + n, w, h) m å’Œ n å¯ä»¥ä¸ºè´Ÿæ•°ã€‚ 8.2 scale1void QPainter::scale(qreal sx, qreal sy) Xå’ŒYè½´åˆ†åˆ«ç¼©æ”¾ m å’Œ n å€ ï¼Œç¼©æ”¾åï¼Œç‚¹Açš„åæ ‡ä¸º(x * m, y * n)ï¼ŒçŸ©å½¢Bçš„åæ ‡ä¸º (x * m, y * n, w * m, h * n) m å’Œ n å¯ä»¥ä¸ºè´Ÿæ•°ï¼Œå¦‚ï¼š ç‚¹A(50,100) -&gt; scale(-10, 2) -&gt; (-500,200) ç‚¹A(-50,100) -&gt; scale(-10, 2) -&gt; (500,200) 8.3 rotate1void QPainter::rotate(qreal angle) æŒ‰é€†æ—¶é’ˆå°†Xå’ŒYè½´åŒæ—¶æ—‹è½¬angleåº¦ï¼ˆæ³¨æ„angleå‚æ•°çš„å•ä½æ˜¯åº¦ï¼Œè€Œä¸æ˜¯å¼§åº¦ï¼‰ï¼Œå…¶ä¸­0åº¦ä¸ºæ­£ä¸‰ç‚¹é’Ÿæ–¹å‘ã€‚ å¯¹äºå•ä¸ªç‚¹è¿›è¡Œæ—‹è½¬æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œ 8.4 shear1void QPainter::shear(qreal sh, qreal sv) å¯¹Xå’ŒYè½´åˆ†åˆ«è¿›è¡Œæ‰­æ›²å˜æ¢ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt"],"categories":["Qt"]},{"title":"å›é¡¾2Dç»˜å›¾çš„æ•°å­¦çŸ¥è¯†","path":"/post/66759332.html","content":"æœ¬ç¯‡æ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜å›é¡¾åœ¨2Då›¾å½¢ç¼–ç¨‹ä¸­å¯èƒ½ä¼šæ¶‰åŠåˆ°çš„æ•°å­¦çŸ¥è¯†ã€‚ 1. çŸ©å½¢çŸ©å½¢é¢ç§¯ é•¿å®½ çŸ©å½¢å‘¨é•¿ é•¿å®½ 2. ä¸¤ç‚¹é—´çš„è·ç¦»åœ¨ç›´è§’åæ ‡ç³»ä¸­ï¼Œè®¾ä¸¤ä¸ªç‚¹Aã€Bä»¥åŠåæ ‡åˆ†åˆ«ä¸º ã€ ï¼Œåˆ™Aå’ŒBä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ä¸ºï¼š 3. åœ†é€šå¸¸ä½¿ç”¨è¡¨ç¤ºåœ†çš„åŠå¾„ï¼› åœ†çš„é¢ç§¯ åœ†çš„å‘¨é•¿ å½“åœ†å¿ƒåæ ‡ä¸º(0ï¼Œ0)æ—¶ï¼Œåœ†çš„æ–¹ç¨‹å¼ä¸ºï¼š ï¼Œè¡¨ç¤ºçš„æ›²çº¿æ˜¯ä»¥O(0ï¼Œ0)ä¸ºåœ†å¿ƒï¼Œä»¥rä¸ºåŠå¾„çš„åœ†ã€‚ å½“åœ†å¿ƒåæ ‡ä¸ä¸º(0ï¼Œ0)æ—¶ï¼Œåœ†çš„æ–¹ç¨‹å¼ä¸ºï¼š è¡¨ç¤ºçš„æ›²çº¿æ˜¯ä»¥O(aï¼Œb)ä¸ºåœ†å¿ƒï¼Œä»¥rä¸ºåŠå¾„çš„åœ†ã€‚ 4. å¼§åº¦ä¸è§’åº¦å¼§åº¦æ˜¯åŸºäºåœ†çš„åŠå¾„çš„çº¯è®¡é‡å•ä½ï¼Œå½“è§’åº¦ä»¥å¼§åº¦ç»™å‡ºæ—¶ï¼Œé€šå¸¸ä¸å†™å¼§åº¦å•ä½ï¼Œæˆ–æœ‰æ—¶è®°ä¸ºradã€‚ å¼§åº¦æ˜¯æŒ‡åœ¨ä¸€ä¸ªåœ†ä¸­ï¼Œå¼§é•¿å’ŒåŠå¾„ä¹‹æ¯”ï¼Œå³ï¼šå¼§åº¦å¼§é•¿åŠå¾„ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªåœ†çš„å‘¨é•¿ä¸º ï¼Œæ‰€ä»¥å¯å¾—ä¸€ä¸ªåœ†çš„å¼§åº¦ä¸º å·²çŸ¥ä¸€ä¸ªåœ†çš„è§’åº¦æ˜¯ï¼Œæ‰€ä»¥ ç”±æ­¤å¯çŸ¥äºŒè€…è½¬æ¢å…³ç³»ä¸ºï¼š 5. ä¸‰è§’å½¢è‹¥ä¸‰è§’å½¢çš„ä¸‰è¾¹åˆ†åˆ«ä¸ºaï¼Œbï¼Œcï¼Œå…¶ä¸­cä¸ºåº•è¾¹ï¼Œé«˜ä¸ºhï¼Œä¸‰è§’åˆ†åˆ«ä¸ºAï¼ˆï¼‰ï¼ŒBï¼ˆï¼‰ï¼ŒCï¼ˆï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨â–³ABCä¸­ é¢ç§¯ å‘¨é•¿ ä¸‰è§’å½¢çš„ä¸‰ä¸ªè§’ç›¸åŠ æ°¸è¿œæ˜¯ ï¼Œå³ ï¼Œå› æ­¤ç­‰è¾¹ä¸‰è§’å½¢çš„æ¯ä¸ªè§’éƒ½æ˜¯ 5.1 æ­£å¼¦/ä½™å¼¦/æ­£åˆ‡æ­£å¼¦ã€ä½™å¼¦å’Œæ­£åˆ‡æ˜¯åŸºäºç›´è§’ä¸‰è§’å½¢è€Œå»ºç«‹çš„ã€‚ å¯¹è¾¹æ–œè¾¹ é‚»è¾¹æ–œè¾¹ å¯¹è¾¹é‚»è¾¹ é‚»è¾¹å¯¹è¾¹ 5.2 ä½™å¼¦å®šç†å¯¹äºä»»æ„ä¸‰è§’å½¢ï¼Œä»»ä½•ä¸€è¾¹çš„å¹³æ–¹ç­‰äºå…¶ä»–ä¸¤è¾¹å¹³æ–¹çš„å’Œå‡å»è¿™ä¸¤è¾¹ä¸å®ƒä»¬å¤¹è§’çš„ä½™å¼¦çš„ç§¯çš„ä¸¤å€ã€‚ 5.3 å‹¾è‚¡å®šç†ç›´è§’ä¸‰è§’å½¢çš„ä¸¤æ¡ç›´è§’è¾¹çš„é•¿åº¦çš„å¹³æ–¹å’Œç­‰äºæ–œè¾¹é•¿çš„å¹³æ–¹ã€‚ å·²çŸ¥ ï¼Œç»“åˆä½™å¼¦å®šç†ï¼Œå¯ä»¥çŸ¥é“å‹¾è‚¡å®šç†æ˜¯ä½™å¼¦å®šç†çš„ç‰¹å®šæƒ…å†µã€‚ 6. æ­£å¼¦æ›²çº¿æ°´å¹³æ–¹å‘å’Œå‚ç›´æ–¹å‘åŒæ—¶åšæ­£å¼¦è¿åŠ¨ï¼Œå°±å¾—åˆ°äº†åœ†å‘¨è¿åŠ¨ã€‚ ä¸‹é¢è§†é¢‘å±•ç¤ºäº†ä»åœ†ä¸­åˆ†è§£å‡ºæ­£å¼¦æ›²çº¿çš„è¿‡ç¨‹ï¼š (function(){var player = new DPlayer({\"container\":document.getElementById(\"dplayer0\"),\"video\":{\"url\":\"https://blog-static.jiangxueqiao.com/blog/img/sin-graph.mp4\"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})() æ ‡å‡†çš„æ­£å¼¦æ›²çº¿å‡½æ•°æ˜¯ ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ­£å¼¦æ›²çº¿ï¼š ä¸æ­£å¼¦æ›²çº¿ç›¸å…³çš„æ¦‚å¿µæœ‰ï¼š 6.1 å‘¨æœŸå‘¨æœŸï¼šä»ä¸€ä¸ªé¡¶ç‚¹åˆ°å¦ä¸€ä¸ªé¡¶ç‚¹çš„è·ç¦»ï¼Œæ ‡å‡†æ­£å¼¦æ›²çº¿çš„å‘¨æœŸæ˜¯ 6.2 æŒ¯å¹…æŒ¯å¹…ï¼šä»ä¸­çº¿ï¼ˆXè½´ï¼‰åˆ°é¡¶ç‚¹çš„è·ç¦»ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ 6.3 ç›¸ç§»ç›¸ç§»ï¼šæ›²çº¿çš„å·¦å³å¹³ç§»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 6.4 å‚ç›´ä½ç§»å‚ç›´ä½ç§»ï¼šæ›²çº¿çš„ä¸Šä¸‹å¹³ç§»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 6.5 ä¼¸ç¼©å˜æ¢ä¸‹å›¾åˆ†åˆ«ç»˜åˆ¶äº†ã€ã€çš„å›¾åƒã€‚ ä»ä¸Šå›¾å¯çŸ¥ï¼Œ æ‰€ä¹˜ä»¥çš„ç³»æ•°å¯¹åº”æ›²çº¿å‘¨æœŸç¼©å°çš„å€æ•°ã€‚ 6.6 å¹³ç§»å˜æ¢æ­£å¼¦æ›²çº¿çš„å¹³ç§»å˜æ¢éµå¾ªâ€œå·¦åŠ å³å‡ï¼Œä¸ŠåŠ ä¸‹å‡â€çš„è§„åˆ™ã€‚ å®ä¾‹ä¸‹å›¾å±•ç¤ºäº†ä» å˜æ¢åˆ° çš„è¿‡ç¨‹ã€‚ 6.7 ç»¼åˆå˜æ¢æ­£å¼¦æ›²çº¿å¯è¡¨ç¤ºä¸º ä¸‹å›¾æ¼”ç¤ºäº†ä» å˜æ¢åˆ° çš„è¿‡ç¨‹ã€‚ 7. æ¤­åœ†æ¤­åœ†ï¼ˆEllipseï¼‰æ˜¯å¹³é¢å†…åˆ°å®šç‚¹F1ã€F2çš„è·ç¦»ä¹‹å’Œç­‰äºå¸¸æ•°ï¼ˆå¤§äºï¼‰çš„åŠ¨ç‚¹Pçš„è½¨è¿¹ï¼ŒF1ã€F2ç§°ä¸ºæ¤­åœ†çš„ä¸¤ä¸ªç„¦ç‚¹ã€‚ å…¶æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š ä¸¤ç„¦ç‚¹F1ã€F2çš„è·ç¦» 7.1 æ¤­åœ†æ–¹ç¨‹å¼æˆ‘ä»¬å§‹ç»ˆç”¨è¡¨ç¤ºé•¿åŠè½´ï¼Œç”¨è¡¨ç¤ºçŸ­åŠè½´ï¼Œå³ä¸Šå›¾çš„ç„¦ç‚¹åœ¨Xè½´æ—¶ï¼Œä½äºXè½´ï¼Œè‹¥ç„¦ç‚¹åœ¨Yè½´åˆ™ä½äºYè½´ã€‚ å½“ä¸¤ä¸ªç„¦ç‚¹åœ¨Xè½´æ—¶ï¼Œæ ‡å‡†æ–¹ç¨‹ä¸ºï¼š å½“ä¸¤ä¸ªç„¦ç‚¹åœ¨Yè½´æ—¶ï¼Œæ ‡å‡†æ–¹ç¨‹ä¸ºï¼š 7.2 æ¤­åœ†é¢ç§¯æ¤­åœ†é¢ç§¯ 7.3 ç›¸å…³å…¬å¼ è¯æ˜å¦‚ä¸‹ï¼š ç”±ä¸¤ç‚¹é—´çš„è·ç¦»å…¬å¼å¯å¾—ï¼š åˆå› ä¸ºï¼Œå³ï¼š è¡¨è¾¾å¼åŒ–ç®€åï¼š ç»§ç»­å±•å¼€å’ŒåŒ–ç®€ï¼Œæœ€ç»ˆå¯å¾—ï¼š å‚è€ƒæ¤­åœ†çš„å…¬å¼å¯å¾—ï¼š 7.4 æ¤­åœ†ä¸Šä»»æ„è§’åº¦ç‚¹çš„åæ ‡ ä¸Šå›¾ç„¦ç‚¹ä½äºXè½´ï¼Œç”±æ¤­åœ†æ–¹ç¨‹å¼å¯å¾—ï¼š ç”±æ­£åˆ‡å‡½æ•°å¯å¾—ï¼š å°† ä»£å…¥ä¸Šé¢è¡¨è¾¾å¼å¯å¾—ï¼š æœ€ç»ˆæ±‚å¾—ï¼š å¯ä»¥ä¸ºæ­£/è´Ÿå€¼ï¼Œéœ€è¦æ ¹æ®è§’åº¦å†³å®šæ­£è´Ÿã€‚ æœ¬æ–‡ä½¿ç”¨latexliveç”Ÿæˆæ•°å­¦å…¬å¼ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["æ•°å­¦","æ¤­åœ†"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"å¦‚ä½•é€šè¿‡ç»“æ„ä½“æˆå‘˜åœ°å€è·å–çˆ¶åœ°å€","path":"/post/3142528002.html","content":"æœ‰å¦‚ä¸‹ç»“æ„ä½“ï¼š 12345678struct Test &#123; int a; // .... // è¿˜æœ‰è‹¥å¹²æˆå‘˜ // ... int y; int z;&#125;; åœ¨åªçŸ¥é“æˆå‘˜å˜é‡yåœ°å€çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è·å–åˆ°ç»“æ„ä½“çš„é¦–åœ°å€ï¼Ÿ å¯ä»¥é€šè¿‡å¦‚ä¸‹å®æ¥å®ç°ï¼š 123#define GET_PARENT_ADDRESS(address, type, field) ((type *)( \\ (char*)(address) - \\ (ULONG_PTR)(&amp;((type *)0)-&gt;field))) ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 123456789int main()&#123; Test t = &#123; 1, 2, 3 &#125;; Test* pT = GET_PARENT_ADDRESS(&amp;t.b, Test, b); printf(&quot;a:%d b:%d c:%d &quot;, pT-&gt;a, pT-&gt;b, pT-&gt;c); // è¾“å‡ºa: 1 b:2 c:3 return 0;&#125; æ ¸å¿ƒåŸç†ï¼š é€šè¿‡å°†ç©ºæŒ‡é’ˆå¼ºè½¬æˆ Test* ç±»å‹, ç„¶åå†å–æˆå‘˜å˜é‡bçš„åœ°å€ï¼Œè¯¥æ“ä½œçš„ä½œç”¨æ˜¯ï¼šå‡è®¾ Test å¼€å§‹åœ¨ 0x00000000 å†…å­˜ä½ç½®ä¸Šåˆ†é…å†…å­˜ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå¾—bçš„å†…å­˜åœ°å€ï¼Œè¿™æ ·ç­‰åŒäºè·å¾—äº†æˆå‘˜ b çš„ç»“æ„ä½“å¯¹é½ååç§»é‡ã€‚ æœ€åï¼Œç”¨ b çš„å®é™…å†…å­˜åœ°å€å‡å»bçš„åç§»é‡å°±æ˜¯ç»“æ„ä½“çš„é¦–åœ°å€ã€‚ å‚è€ƒï¼šMicrosoft å®Œæˆç«¯å£CONTAINING_RECORDå®çš„å®ç°ã€‚ æœ¬æ–‡æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„CSDNåšå®¢ï¼šã€ŠCONTAINING_RECORDå®çš„å®ç°åŸç†ã€‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šç¨ä½œæ•´ç†ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["C++"],"categories":["C++è¯­è¨€"]},{"title":"ä¸åŒæ“ä½œç³»ç»Ÿæ‰€é›†æˆçš„å­—ä½“","path":"/post/1759569674.html","content":"å¦‚æœç•Œé¢æ‰€æŒ‡å®šçš„å­—ä½“åœ¨ç”¨æˆ·ç³»ç»Ÿä¸Šæœªå®‰è£…ï¼Œåˆ™ä¼šè‡ªåŠ¨é™çº§åˆ°ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸æˆ–è¾¾ä¸åˆ°é¢„æœŸæ•ˆæœã€‚ å¯¹äºç‰¹æ®Šå­—ä½“æˆ‘ä»¬é€šå¸¸ä¼šé›†æˆåˆ°è½¯ä»¶å®‰è£…åŒ…å†…ï¼Œä½†å¯¹äºæ±‰å­—è¿™æ ·çš„è¯­è¨€ï¼Œå®ƒçš„æ–‡å­—æ¯”è¾ƒå¤šï¼Œå› æ­¤å­—ä½“æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå¦‚æœé›†æˆåˆ°å®‰è£…åŒ…å†…ä¼šå¯¼è‡´å®‰è£…åŒ…ä½“ç§¯å˜å¤§ï¼Œæ‰€ä»¥å¯¹äºç±»ä¼¼ä¸­æ–‡è¿™æ ·å­—ç¬¦æ¯”è¾ƒå¤šçš„è¯­è¨€å­—ä½“ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€‰æ‹©ç³»ç»Ÿè‡ªå¸¦çš„å­—ä½“ã€‚ è€Œä¸åŒæ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowså’ŒmacOSï¼‰æ‰€è‡ªå¸¦çš„å­—ä½“ä¸ä¸€æ ·ï¼Œç”šè‡³åŒä¸€æ“ä½œç³»ç»Ÿä¸åŒçš„ç‰ˆæœ¬ï¼ˆå¦‚Windows 7å’ŒWindows 11ï¼‰è‡ªå¸¦çš„å­—ä½“ä¹Ÿä¸ä¸€æ ·ï¼Œå› æ­¤åœ¨é€‰æ‹©é‡‡ç”¨ä»€ä¹ˆå­—ä½“å‰ï¼Œéœ€è¦å¼„æ¸…æˆ‘ä»¬åº”ç”¨ç¨‹åºæ”¯æŒçš„æ“ä½œç³»ç»Ÿæ‰€è‡ªå¸¦çš„å­—ä½“éƒ½æœ‰å“ªäº›ï¼Œæ‰èƒ½æ›´å¥½çš„åšé€‰æ‹©ã€‚ æ“ä½œç³»ç»Ÿçš„æ–°ç‰ˆæœ¬é€šå¸¸åªä¼šæ–°å¢å­—ä½“ï¼Œä¸ä¼šç§»é™¤è€çš„å­—ä½“ã€‚ Windowsç³»ç»Ÿè§ç»´åŸºç™¾ç§‘ï¼š List_of_typefaces_included_with_Microsoft_Windows macOSå’ŒiOSç³»ç»Ÿè§appleå®˜ç½‘ï¼š system-fonts ä¸­æ–‡å­—ä½“çš„è‹±æ–‡åç§°å¯¹ç…§è¡¨macOSç³»ç»Ÿéƒ¨åˆ†å­—ä½“ ä¸­æ–‡å è‹±æ–‡å åæ–‡ç»†é»‘ STHeiti Light åæ–‡é»‘ä½“ STHeiti åæ–‡æ¥·ä½“ STKaiti åæ–‡å®‹ä½“ STSong åæ–‡ä»¿å®‹ STFangsong ä¿ªé»‘ Pro LiHei Pro Medium ä¿ªå®‹ Pro LiSong Pro Light æ ‡æ¥·ä½“ BiauKai è‹¹æœä¿ªä¸­é»‘ Apple LiGothic Medium è‹¹æœä¿ªç»†å®‹ Apple LiSung Light Windowsç³»ç»Ÿéƒ¨åˆ†å­—ä½“ ä¸­æ–‡å è‹±æ–‡å æ–°ç»†æ˜ä½“ PMingLiU ç»†æ˜ä½“ MingLiU æ ‡æ¥·ä½“ DFKai-SB é»‘ä½“ SimHei å®‹ä½“ SimSun æ–°å®‹ä½“ NSimSun ä»¿å®‹ FangSong æ¥·ä½“ KaiTi ä»¿å®‹_GB2312 FangSong_GB2312 æ¥·ä½“_GB2312 KaiTi_GB2312 å¾®è½¯æ­£é»‘ä½“ Microsoft JhengHei å¾®è½¯é›…é»‘ä½“ Microsoft YaHei éš¶ä¹¦ LiSu å¹¼åœ† YouYuan åæ–‡ç»†é»‘ STXihei åæ–‡æ¥·ä½“ STKaiti åæ–‡å®‹ä½“ STSong åæ–‡ä¸­å®‹ STZhongsong åæ–‡ä»¿å®‹ STFangsong æ–¹æ­£èˆ’ä½“ FZShuTi æ–¹æ­£å§šä½“ FZYaoti åæ–‡å½©äº‘ STCaiyun åæ–‡ç¥ç€ STHupo åæ–‡éš¶ä¹¦ STLiti åæ–‡è¡Œæ¥· STXingkai åæ–‡æ–°é­ STXinwei é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["å­—ä½“"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"åŸºäºå…±äº«å†…å­˜çš„è·¨å¹³å°RPCæ¡†æ¶ - Veigar","path":"/post/3008752839.html","content":"1. èƒŒæ™¯åœ¨é¡¹ç›®å¼€å‘ä¸­æ—¶å¸¸ä¼šé‡åˆ°éœ€è¦å¤šä¸ªè¿›ç¨‹é—´äº¤äº’&#x2F;é€šä¿¡çš„åœºæ™¯ï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ–‡ä»¶ã€æ³¨å†Œè¡¨ã€ç½‘ç»œã€ç®¡é“ã€å…±äº«å†…å­˜ç­‰ã€‚ å¯¹äºç®€å•çš„äº¤äº’åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„é€‰æ‹©ä¸€ç§åˆé€‚çš„æ–¹å¼ï¼Œå¦‚ Google Chrome ä½¿ç”¨çš„æ˜¯ç®¡é“çš„æ–¹å¼ã€‚ ä½†åœ¨äº¤äº’åœºæ™¯å¤æ‚çš„æƒ…å†µä¸‹ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰çš„æ–¹å¼åˆ™ä¼šæ›´æ–°ä¾¿æ·ã€‚ ç›®å‰å¼€æºçš„ã€åŠŸèƒ½ç›¸å¯¹å®Œå–„çš„ C++ RPC æ¡†æ¶éƒ½æ˜¯åŸºäºç½‘ç»œæ–¹å¼å®ç°çš„ï¼Œè¿™ç§æ–¹å¼å­˜åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ¦‚å¿µï¼Œä¸¤ç«¯ç›¸äº’è°ƒç”¨éœ€è¦å„æ–¹éƒ½å¯åŠ¨ä¸€ä¸ªç«¯å£ç›‘å¬æœåŠ¡ï¼Œæ—¢ç„¶éœ€è¦ç›‘å¬ç«¯å£ï¼Œé‚£å°±ä¼šå­˜åœ¨ç«¯å£è¢«å ç”¨çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ Windows ä¸Šè¿˜ä¼šå­˜åœ¨ç«¯å£å‡å¯ç”¨çš„é—®é¢˜ï¼Œç«¯å£è™½ç„¶ç›‘å¬æˆåŠŸï¼Œä½†å®¢æˆ·ç«¯ä»ç„¶æ— æ³•è¿æ¥çš„æƒ…å†µã€‚ æˆ‘ä¸€ç›´æƒ³æ‰¾åˆ°ä¸€ä¸ªåŸºäºå…±äº«å†…å­˜å®ç°çš„ã€è·¨å¹³å°çš„ C++ RPC æ¡†æ¶ï¼Œä½†é—æ†¾çš„æ˜¯ä¸€ç›´æ²¡èƒ½ç»“ç¼˜ï¼Œäºæ˜¯æˆ‘å†³å®šçƒ¹é¥ªä¸€ä¸ªã€‚ ä¹‹æ‰€ä»¥å–åä¸ºâ€œVeigarâ€ï¼Œå› ä¸ºè¯¥è¯æ¥æºäºè‹±é›„è”ç›Ÿé‡Œé¢çš„â€œé‚ªæ¶å°æ³•å¸ˆ-ç»´è¿¦â€ï¼Œæˆ‘çš„å¼€æºé¡¹ç›®å–åä¹Ÿå¤§å¤šæ¥è‡ªè¯¥æ¸¸æˆã€‚ é¡¹ç›®åœ°å€ï¼š https://github.com/winsoft666/veigar ç›®å‰è¯¥é¡¹ç›®å·²ç»åœ¨å¤šä¸ª Windows å®¢æˆ·ç«¯äº§å“ä¸­å¾—åˆ°åº”ç”¨ï¼ŒLinux å¹³å°ä¹Ÿç»è¿‡äº†æµ‹è¯•ã€‚ 2. ç‰¹æ€§ åŸºäºå…±äº«å†…å­˜æŠ€æœ¯å®ç°ã€‚ æ”¯æŒ Windowsã€Linux å¹³å°ã€‚ å¯ä»¥å°†ä»»ä½•å‡½æ•°æš´éœ²ç»™è°ƒç”¨æ–¹ï¼ˆä¸é™è¯­è¨€ï¼Œåªè¦å®ç° msgpack-rpc å³å¯ï¼‰ã€‚ ä»»ä½•è¯­è¨€ç¼–å†™çš„ç¨‹åºéƒ½å¯ä»¥è°ƒç”¨è¢«æš´éœ²çš„å‡½æ•°ã€‚ ä¸éœ€è¦å­¦ä¹  IDL è¯­è¨€ã€‚ ä¸éœ€è¦æ·»åŠ é¢å¤–çš„ä»£ç ç”Ÿæˆæ­¥éª¤ï¼Œä»…éœ€è¦ C++ ä»£ç ã€‚ æ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ¦‚å¿µï¼Œæ¯ä¸ª Veigar å®ä¾‹é—´éƒ½å¯ä»¥ç›¸äº’è°ƒç”¨ã€‚ æ²¡æœ‰ç½‘ç»œé—®é¢˜ï¼Œå¦‚ç«¯å£å ç”¨ã€åŠå…³é—­çŠ¶æ€ç­‰ã€‚ æ²¡æœ‰è¯¡å¼‚çš„ç«¯å£å‡å¯ç”¨æ€§é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯åœ¨ Windows ç³»ç»Ÿä¸Šï¼‰ã€‚ 3. ç¼–è¯‘è™½ç„¶Veigarçš„åº•å±‚æ˜¯åŸºäºmsgpackå®ç°çš„ï¼Œä½†å·²ç»å°†å…¶åŒ…å«åˆ°é¡¹ç›®ä¸­ï¼Œä¸éœ€è¦é¢å¤–ç¼–è¯‘å’Œå®‰è£…msgpackã€‚ è™½ç„¶åœ¨veigarå…¬å…±å¤´æ–‡ä»¶å¼•ç”¨äº†msgpackå¤´æ–‡ä»¶ï¼Œä½†è¿™ä¸ä¼šæ±¡æŸ“æ‚¨çš„å…¨å±€msgpackå‘½åç©ºé—´ï¼Œå› ä¸ºVeigarä¸­çš„msgpackå‘½ä»¤ç©ºé—´ä¸ºveigar_msgpackã€‚ Veigarä»…æ”¯æŒç¼–è¯‘ä¸ºé™æ€åº“ã€‚ å¯ä»¥ä½¿ç”¨CMakeè¿›è¡Œç¼–è¯‘æ„å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨vcpkgè¿›è¡Œå®‰è£…ï¼Œå¦‚ï¼š 1vcpkg install veigar 4. å¿«é€Ÿä¸Šæ‰‹åœ¨ä½¿ç”¨Veigaræ—¶ï¼Œä»…éœ€è¦åœ¨é¡¹ç›®ä¸­åŒ…å«includeç›®å½•ï¼Œå¹¶é“¾æ¥é™æ€åº“å³å¯ã€‚ 4.1 åŒæ­¥è°ƒç”¨ä¸‹é¢æ˜¯ä¸€ä¸ªåŒæ­¥è°ƒç”¨çš„ç¤ºä¾‹ï¼š æœ¬ç¤ºä¾‹ä¸ºäº†ä½¿ä»£ç æ›´åŠ ç®€æ´ï¼Œæ²¡æœ‰å¯¹å‡½æ•°è¿”å›å€¼è¿›è¡Œæ ¡éªŒï¼Œè¯·åœ¨å®é™…ä½¿ç”¨ä¸­ä¸è¦è¿™æ ·åšï¼ 12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt;#include &quot;veigar/veigar.h&quot;int main(int argc, char** argv) &#123; if (argc != 3) &#123; return 1; &#125; std::string channelName = argv[1]; std::string targetChannelName = argv[2]; veigar::Veigar vg; vg.bind(&quot;echo&quot;, [](const std::string&amp; msg, int i, double d, std::vector&lt;uint8_t&gt; buf) &#123; std::string result; // ... return result; &#125;); vg.init(channelName); std::vector&lt;uint8_t&gt; buf; veigar::CallResult ret = vg.syncCall(targetChannelName, 100, &quot;echo&quot;, &quot;hello&quot;, 12, 3.14, buf); if (ret.isSuccess()) &#123; std::cout &lt;&lt; ret.obj.get().as&lt;std::string&gt;() &lt;&lt; std::endl; &#125; else &#123; std::cout &lt;&lt; ret.errorMessage &lt;&lt; std::endl; &#125; vg.uninit(); return 0;&#125; æ¯ä¸ªVeigarå®ä¾‹æœ‰ä¸€ä¸ªåœ¨æœ¬æœºèŒƒå›´å†…å”¯ä¸€çš„é€šé“åç§°ï¼ˆChannelï¼‰ï¼Œåœ¨è°ƒç”¨initå‡½æ•°æ—¶éœ€è¦ä¸ºVeigaræŒ‡å®šé€šé“åç§°ï¼ŒVeigarä¸ä¼šæ£€æµ‹é€šé“çš„å”¯ä¸€æ€§ï¼Œéœ€è¦ç”±è°ƒç”¨è€…æ¥ä¿è¯é€šé“åç§°çš„å”¯ä¸€æ€§ã€‚ åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå½“å‰å®ä¾‹çš„é€šé“åç§°å’Œç›®æ ‡å®ä¾‹çš„é€šé“åç§°ï¼Œå¦‚ï¼š 1sample.exe myself other æ¯ä¸ªå®ä¾‹éƒ½ç»‘å®šäº†åä¸ºechoçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ç®€å•çš„åŸæ ·è¿”å›msgå‚æ•°å­—ç¬¦ä¸²ã€‚ é€šè¿‡ä¸ºsyncCallå‡½æ•°æŒ‡å®šâ€œç›®æ ‡é€šé“åç§°â€ã€â€œå‡½æ•°åç§°â€ã€â€œå‡½æ•°å‚æ•°â€åŠâ€œè¶…æ—¶æ¯«ç§’æ•°â€å°±å¯ä»¥åŒæ­¥è°ƒç”¨ç›®æ ‡å‡½æ•°å¹¶å¾—åˆ°è°ƒç”¨ç»“æœã€‚ 4.2 æ‹’ç»å¼‚å¸¸æˆ‘ä¸å–œæ¬¢å¼‚å¸¸ï¼Œå› æ­¤Veigarä¹Ÿä¸ä¼šé€šè¿‡å¼‚å¸¸çš„å½¢å¼æ¥æŠ›å‡ºé”™è¯¯ï¼ŒVeigarä¼šä¸»åŠ¨æ•è·æ‰€æœ‰C++æ ‡å‡†åº“ã€msgpackã€boostå¼‚å¸¸ï¼Œä»¥è¿”å›å€¼çš„å½¢å¼è¿”å›ç»™è°ƒç”¨è€…ã€‚å½“è°ƒç”¨å¤±è´¥æ—¶ï¼ˆ!ret.isSuccess())ï¼ŒerrorMessageä¸­å­˜å‚¨çš„é”™è¯¯ä¿¡æ¯å°±å¯èƒ½æ˜¯Veigaræ•è·çš„å¼‚å¸¸ä¿¡æ¯ã€‚ 4.3 å¼‚æ­¥è°ƒç”¨ä½¿ç”¨asyncCallå‡½æ•°å¯ä»¥å®ç°å¼‚æ­¥è°ƒç”¨ã€‚ ä¸‹é¢æ˜¯å¼‚æ­¥è°ƒç”¨ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526//// ä¸åŒæ­¥è°ƒç”¨ç›¸åŒ// ...std::vector&lt;uint8_t&gt; buf;std::shared_ptr&lt;veigar::AsyncCallResult&gt; acr = vg.asyncCall(targetChannelName, &quot;echo&quot;, &quot;hello&quot;, 12, 3.14, buf);if (acr-&gt;second.valid()) &#123; auto waitResult = acr-&gt;second.wait_for(std::chrono::milliseconds(100)); if (waitResult == std::future_status::timeout) &#123; // timeout &#125; else &#123; veigar::CallResult ret = std::move(acr-&gt;second.get()); if(ret.isSuccess()) &#123; std::cout &lt;&lt; ret.obj.get().as&lt;std::string&gt;() &lt;&lt; std::endl; &#125; else &#123; std::cout &lt;&lt; ret.errorMessage &lt;&lt; std::endl; &#125; &#125;&#125;vg.releaseCall(acr-&gt;first);//// ä¸åŒæ­¥è°ƒç”¨ç›¸åŒ// ... ä¸åŒæ­¥è°ƒç”¨ä¸åŒï¼ŒasyncCallå‡½æ•°è¿”å›çš„æ˜¯std::shared_ptr&lt;veigar::AsyncCallResult&gt;ï¼Œè€Œä¸”è°ƒç”¨è€…åœ¨è·å–åˆ°CallResultæˆ–ä¸å†å…³ç³»è°ƒç”¨ç»“æœæ—¶ï¼Œéœ€è¦è°ƒç”¨releaseCallå‡½æ•°é‡Šæ”¾èµ„æºã€‚ 5. æ€§èƒ½ä½¿ç”¨examples\\echoç¨‹åºä½œä¸ºæµ‹è¯•ç”¨ä¾‹ã€‚ å¯åŠ¨Aã€Bã€Cä¸‰ä¸ªChannelï¼Œæ¯ä¸ªChannelåˆ†åˆ«ä½¿ç”¨2ä¸ªçº¿ç¨‹å‘å½¼æ­¤è°ƒç”¨100ä¸‡æ¬¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Windowså¹³å°æµ‹è¯•æœºå™¨CPUé…ç½®ï¼š 112th Gen Intel(R) Core(TM) i7-12700H 2.30 GHz æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627Target channel names (Split by comma):A,B,CAsync method(0/1):0Thread number for each target:2Call times each of thread:1000000Read/Write Timeout(ms):100[Thread 1, Target A] Calling...[Thread 0, Target C] Calling...[Thread 0, Target A] Calling...[Thread 1, Target B] Calling...[Thread 0, Target B] Calling...[Thread 1, Target C] Calling...[Thread 1, Target B] Total 1000000, Success 1000000, Error 0, Used: 59092341us, Average: 59us/call, 16922call/s.[Thread 0, Target B] Total 1000000, Success 1000000, Error 0, Used: 59112785us, Average: 59us/call, 16916call/s.[Thread 1, Target A] Total 1000000, Success 1000000, Error 0, Used: 59111520us, Average: 59us/call, 16917call/s.[Thread 0, Target C] Total 1000000, Success 1000000, Error 0, Used: 59126879us, Average: 59us/call, 16912call/s.[Thread 0, Target A] Total 1000000, Success 1000000, Error 0, Used: 59206766us, Average: 59us/call, 16889call/s.[Thread 1, Target C] Total 1000000, Success 1000000, Error 0, Used: 59299407us, Average: 59us/call, 16863call/s. å¹³å‡æ¯æ¬¡è°ƒç”¨èŠ±è´¹59å¾®å¦™ï¼Œæ¯ç§’å¯ä»¥è°ƒç”¨çº¦16900æ¬¡ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["RPC","Veigar"],"categories":["Power By Me"]},{"title":"Nodeæ’ä»¶å¼€å‘(2)-ä¸åŒçš„è°ƒç”¨æ–¹å¼","path":"/post/235943795.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨ Node-API ä¸­å®ç°ä¸åŒçš„ç±»å‹çš„æ¥å£ï¼Œå¦‚ï¼š åŒæ­¥è°ƒç”¨ åŸºäº Napi::AsyncWorker çš„å¼‚æ­¥è°ƒç”¨ï¼Œé€šè¿‡å›è°ƒå‡½æ•°è¿”å› å¼‚æ­¥è°ƒç”¨ï¼Œè¿”å› Promise åŸºäº Napi::ThreadSafeFunction çš„å¼‚æ­¥è°ƒç”¨ï¼Œé€šè¿‡å›è°ƒå‡½æ•°è¿”å› ä¸€ã€åŒæ­¥è°ƒç”¨12345678910111213Napi::Number Add(const Napi::CallbackInfo&amp; info) &#123; Napi::Env env = info.Env(); if (info.Length() != 2) throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); if (!info[0].IsNumber() || !info[1].IsNumber()) throw Napi::TypeError::New(env, &quot;Wrong arguments&quot;); const int ret = info[0].ToNumber().Int32Value() + info[1].ToNumber().Int32Value(); return Napi::Number::New(env, ret);&#125; äºŒã€å¼‚æ­¥å›è°ƒåœ¨Node-APIä¸­ï¼Œä¸èƒ½åœ¨æœ¬åœ°å­çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨JavaScriptå‡½æ•°ï¼Œå¯ä»¥å€ŸåŠ©Napi::AsyncWorkerå®ç°å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶åœ¨å…¶OnOKæˆ–OnErrorè™šå‡½æ•°ä¸­æ‰§è¡ŒJavaScriptå›è°ƒå‡½æ•°è¿”å›ç»“æœåˆ°JavaScriptã€‚ ä»¥å¼‚æ­¥è®¡ç®—æ­£æ•´æ•°Nçš„10æ¬¡æ–¹ä¸ºä¾‹ï¼Œé€šè¿‡å›è°ƒå‡½æ•°è¿”å›è®¡ç®—ç»“æœã€‚ ä¸Node.jså®˜æ–¹æ¨¡å—çš„æ¥å£ä¸€æ ·ï¼Œå›è°ƒå‡½æ•°æœ‰2ä¸ªå‚æ•°callback(err, result)ï¼Œå¤±è´¥errä¸ä¸ºNullï¼ŒæˆåŠŸåˆ™errä¸ºNullã€‚ ç»§æ‰¿è‡ªNapi::AsyncWorkerï¼Œé‡å†™Executeè™šå‡½æ•°å®ç°ä»»åŠ¡é€»è¾‘ï¼Œé‡å†™OnOKè™šå‡½æ•°æ‰§è¡Œå›è°ƒå‡½æ•°è¿”å›æˆåŠŸç»“æœï¼Œé‡å†™OnErrorè™šå‡½æ•°æ‰§è¡Œå›è°ƒå‡½æ•°è¿”å›å¤±è´¥ã€‚ 12345678910111213141516171819202122232425262728293031323334class Power10AsyncWorker : public Napi::AsyncWorker &#123; public: Power10AsyncWorker(const Napi::Function&amp; callback, int32_t n) : Napi::AsyncWorker(callback), n_(n) &#123; &#125; void Execute() override &#123; if (n_ &lt;= 0) &#123; // Nå°äº0åˆ™è¿”å›é”™è¯¯ SetError(&quot;N must larger than 0&quot;); return; &#125; result_ = 1; for (int i = 0; i &lt; 10; i++) &#123; // æ¯æ¬¡æš‚åœ10msï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ std::this_thread::sleep_for(std::chrono::milliseconds(10)); result_ *= n_; &#125; &#125; void OnOK() override &#123; Callback().Call(&#123;Env().Null(), Napi::Value::From(Env(), result_)&#125;); &#125; void OnError(const Napi::Error&amp; e) override &#123; Callback().Call(&#123;e.Value(), Env().Null()&#125;); &#125; private: int32_t n_ = 0; int32_t result_ = 0;&#125;; å®šä¹‰æ¥å£GetPower10ï¼Œæ”¯æŒ2ä¸ªå‚æ•°ï¼šæ•´æ•°Nå’Œå›è°ƒå‡½æ•°ã€‚ 1234567891011121314void GetPower10(const Napi::CallbackInfo&amp; info) &#123; Napi::Env env = info.Env(); if (info.Length() != 2) throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); if (!info[0].IsNumber() || !info[1].IsFunction()) throw Napi::TypeError::New(env, &quot;Wrong arguments&quot;); int32_t n = info[0].ToNumber().Int32Value(); Napi::Function callback = info[1].As&lt;Napi::Function&gt;(); (new Power10AsyncWorker(callback, n))-&gt;Queue();&#125; ä¸‰ã€è¿”å›Promiseä»¥å¼‚æ­¥è®¡ç®—æ­£æ•´æ•°Nçš„20æ¬¡æ–¹ä¸ºä¾‹ï¼Œè¿”å›Promiseå¯¹è±¡ï¼Œå½“Nå°äº0æ—¶ï¼ŒPromiseè®¾ç½®ä¸ºrejectçŠ¶æ€ã€‚ 123456789101112131415161718192021222324252627282930313233343536class Power20AsyncWorker : public Napi::AsyncWorker &#123; public: Power20AsyncWorker(const Napi::Env&amp; env, const Napi::Promise::Deferred&amp; deferred, int32_t n) : Napi::AsyncWorker(env), deferred_(deferred), n_(n) &#123; &#125; void Execute() override &#123; if (n_ &lt;= 0) &#123; // å°äº0æ—¶è¿”å›é”™è¯¯ SetError(&quot;N must larger than 0&quot;); return; &#125; result_ = 1; for (int i = 0; i &lt; 20; i++) &#123; // æ¯æ¬¡æš‚åœ10msï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ std::this_thread::sleep_for(std::chrono::milliseconds(10)); result_ *= n_; &#125; &#125; void OnOK() override &#123; deferred_.Resolve(Napi::Number::New(Env(), result_)); &#125; void OnError(const Napi::Error&amp; e) override &#123; deferred_.Reject(e.Value()); &#125; private: Napi::Promise::Deferred deferred_; int32_t n_ = 0; int32_t result_ = 0;&#125;; 123456789101112131415161718Napi::Value GetPower20(const Napi::CallbackInfo&amp; info) &#123; Napi::Env env = info.Env(); if (info.Length() != 1) throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); if (!info[0].IsNumber()) throw Napi::TypeError::New(env, &quot;Wrong arguments&quot;); int32_t n = info[0].ToNumber().Int32Value(); Napi::Function callback = info[1].As&lt;Napi::Function&gt;(); Napi::Promise::Deferred deferred = Napi::Promise::Deferred::New(env); (new Power20AsyncWorker(env, deferred, n))-&gt;Queue(); return deferred.Promise();&#125; å››ã€ThreadSafeFunctionå‰é¢çš„ç¤ºä¾‹éƒ½æ²¡æœ‰å¯åŠ¨æœ¬åœ°å­çº¿ç¨‹ï¼Œè€Œæ˜¯é€šè¿‡Napi::AsyncWorkerå®ç°çš„å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨std::threadå¼€å¯å­çº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡å¹¶è°ƒç”¨å›è°ƒå‡½æ•°è¿”å›ç»“æœã€‚ å®ç°åœ¨æœ¬åœ°å­çº¿ç¨‹ä¸­è°ƒç”¨JavaScriptå›è°ƒå‡½æ•°ï¼Œä¸»è¦å€ŸåŠ©äºNapi::ThreadSafeFunctionå®ç°ã€‚ ä»¥å¼‚æ­¥è®¡ç®—æ­£æ•´æ•°Nçš„30æ¬¡æ–¹ä¸ºä¾‹ï¼Œé€šè¿‡å›è°ƒå‡½æ•°è¿”å›è®¡ç®—ç»“æœã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374void GetPower30(const Napi::CallbackInfo&amp; info) &#123; Napi::Env env = info.Env(); if (info.Length() != 2) throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); if (!info[0].IsNumber() || !info[1].IsFunction()) throw Napi::TypeError::New(env, &quot;Wrong arguments&quot;); int32_t n = info[0].ToNumber().Int32Value(); Napi::Function callback = info[1].As&lt;Napi::Function&gt;(); std::thread* nativeThread = nullptr; Napi::ThreadSafeFunction tsfn = Napi::ThreadSafeFunction::New( env, callback, &quot;Resource Name&quot;, // Name 0, // Unlimited queue 1, // Only one thread will use this initially [nativeThread](Napi::Env) &#123; // Finalizer used to clean threads up if (nativeThread &amp;&amp; nativeThread-&gt;joinable()) &#123; nativeThread-&gt;join(); &#125; &#125;); nativeThread = new std::thread([n, tsfn]() &#123; struct CallParam &#123; std::string error; int32_t result = 0; &#125;; CallParam* param = new CallParam(); if (n &gt; 0) &#123; param-&gt;result = 1; for (int i = 0; i &lt; 30; i++) &#123; param-&gt;result *= n; &#125; &#125; else &#123; param-&gt;error = &quot;N must larger than 0&quot;; &#125; auto callback = [](Napi::Env env, Napi::Function jsCallback, CallParam* param) &#123; if (jsCallback &amp;&amp; param) &#123; try &#123; if (param-&gt;error.empty()) &#123; jsCallback.Call(&#123;env.Null(), Napi::Number::New(env, param-&gt;result)&#125;); &#125; else &#123; Napi::Error err = Napi::Error::New(env, param-&gt;error); jsCallback.Call(&#123;err.Value(), env.Null()&#125;); &#125; &#125; catch (std::exception&amp; e) &#123;#if (defined _WIN32 || defined WIN32) OutputDebugStringA(e.what());#endif &#125; &#125; if (param) &#123; delete param; &#125; &#125;; napi_status status = tsfn.BlockingCall(param, callback); if (status != napi_ok) &#123; // TODO How to handle error &#125; tsfn.Release(); &#125;);&#125; å®Œæ•´çš„ç¤ºä¾‹ä»£ç ä»¥ä¸Šä¼ è‡ªGithubï¼š https://github.com/winsoft666/node-addon-sample","tags":["Electron","Node-API"],"categories":["Electron"]},{"title":"ABIå…¼å®¹æ€§","path":"/post/529732738.html","content":"ABI æ˜¯ Application Binary Interface çš„ç¼©å†™ï¼Œå½“æˆ‘ä»¬ä»¥äºŒè¿›åˆ¶å½¢å¼ï¼ˆéæºç å½¢å¼ï¼‰å‘å¸ƒæˆ‘ä»¬çš„åŠ¨æ€åº“æ—¶ï¼Œå°±éœ€è¦å…³å¿ƒABIå…¼å®¹ï¼ˆä¹Ÿç§°äºŒè¿›åˆ¶å…¼å®¹ï¼‰ã€‚ å¯¹äºé™æ€åº“ï¼Œæ›´æ–°é™æ€åº“å§‹ç»ˆéƒ½éœ€è¦è¯¥åº“çš„ä½¿ç”¨æ–¹é‡æ–°ç¼–è¯‘ï¼Œå› æ­¤ä¸å­˜åœ¨ABIå…¼å®¹çš„è¯´æ³•ã€‚ ä¸€ã€ä»€ä¹ˆæ˜¯ABIå…¼å®¹å‡è®¾æˆ‘ä»¬å¼€å‘äº†æŸä¸ªåŠ¨æ€åº“ï¼ˆåä¸º somethingï¼‰ï¼Œä»¥åŠ¨æ€åº“çš„å½¢å¼æä¾›ï¼šsomething.hã€something.libã€something.dllã€‚ æœ‰äººä½¿ç”¨è¯¥åŠ¨æ€åº“å¼€å‘äº†ç¨‹åº wï¼ˆwå¯ä»¥æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œä¹Ÿå¯ä»¥æ˜¯åº“ï¼‰ï¼Œå³ç¨‹åºwé“¾æ¥äº†åŠ¨æ€åº“ somethingï¼Œå¹¶å°†ç¨‹åºwæ‰“åŒ…äº¤ä»˜ç»™ç»ˆç«¯ç”¨æˆ·ï¼Œæ‰“åŒ…æ–‡ä»¶åŒ…å«ï¼šw.exeã€something.dllã€‚ something åº“æ˜¯å¦å…·æœ‰ABIå…¼å®¹æ€§å†³å®šäº†åœ¨æ›´æ–° something.dll æ—¶ï¼Œæ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘ w.exeï¼Ÿ å¦‚æœä¸éœ€è¦é‡æ–°ç¼–è¯‘ w.exeï¼Œåˆ™ something åº“æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œå¦åˆ™å°±ä¸æ˜¯çš„ã€‚ Microsoft C++ï¼ˆMSVCï¼‰ç¼–è¯‘å™¨å·¥å…·é›†åœ¨ Visual Studio 2015 ä¹‹å‰æœªå®ç°ABIå…¼å®¹ï¼Œä½†åœ¨ Visual Studio 2015ï¼ˆå«ï¼‰ä¹‹åå®ç°äº†ABIå…¼å®¹ã€‚ è¯¦è§ä¹‹å‰æ–‡ç« ï¼šMSVCç‰ˆæœ¬çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ äºŒã€ä¸ ABI æœ‰å…³çš„çŸ¥è¯†åœ¨ç†è§£å“ªäº›è¡Œä¸ºæ˜¯å¦ä¼šç ´å ABI å…¼å®¹æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¢„å…ˆäº†è§£ä¸€äº›C++åŸºç¡€çŸ¥è¯†ã€‚ 2.1 ç±»å¦‚ä½•è®¿é—®æˆå‘˜å˜é‡åœ¨ C++ ä¸­ï¼Œstruct å’Œ class æ˜¯é€šè¿‡åç§»é‡æ¥è®¿é—®æˆå‘˜å˜é‡çš„ï¼Œå¦‚æœæ”¹å˜äº†æˆå‘˜å˜é‡çš„é¡ºåºï¼Œåç§»é‡ä¹Ÿä¼šç›¸åº”æ”¹å˜ã€‚ 2.2 è™šå‡½æ•°è¡¨è™šå‡½æ•°æ˜¯é€šè¿‡è™šå‡½æ•°è¡¨æ¥ç®¡ç†å’Œè®¿é—®çš„ï¼Œæ”¹å˜è™šå‡½æ•°é¡ºåºã€æ–°å¢&#x2F;åˆ é™¤è™šå‡½æ•°éƒ½ä¼šæ”¹å˜è™šå‡½æ•°è¡¨ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰æœ‰å…³è™šå‡½æ•°çš„æ–‡ç« ï¼šæ·±å…¥ç†è§£C++è™šå‡½æ•° 2.3 Name ManglingC++ ç¼–è¯‘å™¨ä¼šæŠŠå‡½æ•°çš„åå­—ã€å‚æ•°ç­‰ä¿¡æ¯ï¼ˆæˆ–è€…å«å‡½æ•°ç­¾åï¼‰ç¼–ç æˆä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œç”¨ä½œé“¾æ¥ç¬¦å·ï¼Œè¿™æ ·å°±èƒ½åœ¨ç¼–è¯‘æœŸå®Œæˆæ£€æŸ¥ï¼Œä»è€Œé¿å…è¿è¡Œæ—¶æŠ¥é”™ï¼Œè¿™ç§è¡Œä¸ºç§°ä½œName Manglingï¼Œä¾‹å¦‚ï¼š 1234567namespace wikipedia &#123; class article &#123; public: std::string format(void); &#125;&#125; format å‡½æ•°ç»è¿‡ Name Mangling ä¹‹åå˜æˆäº†ï¼š_ZN9wikipedia7article6formatEv Name Manglingä½¿ç”¨çš„ç®—æ³•æ˜¯å¯é€†çš„ï¼Œhttp://demangler.com/ ç½‘ç«™æä¾›äº†é€šè¿‡æ–°å‡½æ•°åé€†å‘æ¨æ¼”å‡ºåŸæœ‰å‡½æ•°åçš„åŠŸèƒ½ã€‚ 2.4 ç±»å¦‚ä½•è®¿é—®æˆå‘˜å‡½æ•°C++ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æˆå‘˜å‡½æ•°æ—¶ä¼šæ ¹æ®å®ƒæ‰€åœ¨çš„å‘½åç©ºé—´ã€æ‰€å±ç±»ã€ä»¥åŠå‚æ•°ç­‰ä¿¡æ¯ï¼Œé€šè¿‡ Name Mangling ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°åã€‚ ç±»çš„æˆå‘˜å‡½æ•°æœ€ç»ˆè¢«ç¼–è¯‘æˆä¸å¯¹è±¡æ— å…³çš„å…¨å±€å‡½æ•°ï¼Œä¸ºäº†ä½¿è¯¥å…¨å±€å‡½æ•°å¯ä»¥è®¿é—®ç±»çš„å…¶ä»–æˆå‘˜å‡½æ•°å’Œå˜é‡ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æˆå‘˜å‡½æ•°æ—¶ä¼šé¢å¤–æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼ŒæŠŠå½“å‰å¯¹è±¡çš„æŒ‡é’ˆä¼ é€’è¿›å»ï¼Œé€šè¿‡æŒ‡é’ˆæ¥è®¿é—®æˆå‘˜å˜é‡&#x2F;æˆå‘˜å‡½æ•°ã€‚ 2.5 å¤´æ–‡ä»¶çš„ä½œç”¨åœ¨ C&#x2F;C++ ä¸­ï¼ŒåŠ¨æ€é“¾æ¥åº“é€šå¸¸ä¼šé™„å¸¦å¤´æ–‡ä»¶ï¼Œè¿™ä¸ªå¤´æ–‡ä»¶å¯ä»¥ç†è§£æˆåŠ¨æ€åº“çš„â€œä½¿ç”¨è¯´æ˜ä¹¦â€ï¼Œåº“çš„ä½¿ç”¨è€…ä¼šæŒ‰ç…§å¤´æ–‡ä»¶ä½¿ç”¨è¯¥åº“ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®è¯¥å¤´æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶ä»£ç ï¼Œç„¶ååœ¨è¿è¡Œçš„æ—¶å€™é€šè¿‡è£…è½½å™¨(loader)æŠŠå¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€åº“ç»‘åˆ°ä¸€èµ·ã€‚ 3. ç ´åABIå…¼å®¹æ€§çš„è¡Œä¸ºå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ”¹åŠ¨æ˜¯ä¸æ˜¯äºŒè¿›åˆ¶å…¼å®¹ï¼Œä¸»è¦çœ‹è€ç‰ˆçš„å¤´æ–‡ä»¶èƒ½å¦ä¸æ–°ç‰ˆæœ¬çš„åŠ¨æ€åº“çš„å®é™…ä½¿ç”¨æ–¹æ³•å…¼å®¹ã€‚å› ä¸ºæ–°çš„åº“å¿…ç„¶æœ‰æ–°çš„å¤´æ–‡ä»¶ï¼Œä½†æ˜¯ç°æœ‰çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿˜æ˜¯æŒ‰æ—§çš„å¤´æ–‡ä»¶æ¥è°ƒç”¨åŠ¨æ€åº“ã€‚ æ€»ç»“èµ·æ¥ï¼ŒABI ä¸å…¼å®¹ä¸»è¦æ˜¯å› ä¸ºï¼š sizeof(class) å¤§å°æ”¹å˜ã€‚ æ•°æ®æˆå‘˜åç§»é‡å‘ç”Ÿæ”¹å˜ã€‚ è™šå‡½æ•°è¡¨å‘ç”Ÿæ”¹å˜ã€‚ Name Mangling åå‘ç”Ÿæ”¹å˜ã€‚ ä¸‹é¢åˆ—ä¸¾äº†ä¼šç ´å ABI å…¼å®¹æ€§çš„æ“ä½œã€‚ 3.1 æ·»åŠ æˆ–åˆ é™¤éé™æ€æˆå‘˜å˜é‡å› ä¸º sizeof(class) å¤§å°å‘ç”Ÿæ”¹å˜ï¼Œå¦‚ä¹‹å‰å ç”¨8ä¸ªå­—èŠ‚ï¼Œæ–°å¢ä¸€ä¸ªæˆå‘˜å˜é‡åå ç”¨12å­—èŠ‚ï¼Œä½†å¤–éƒ¨ä»£ç new classæ—¶ä»ç„¶åªåˆ†é…äº†8å­—èŠ‚ï¼Œæ‰€ä»¥ä¼šå‡ºé—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåŠ¨æ€åº“æä¾›äº†åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œå§‹ç»ˆåœ¨åŠ¨æ€åº“å†…éƒ¨åˆ›å»ºå¯¹è±¡ï¼Œåˆ™æ²¡æœ‰è¯¥é—®é¢˜ï¼Œå¦‚ï¼š 123456class EXPORT_API Koi &#123; public: // ....&#125;;EXPORT_API Koi* GetKoi(); ä¹Ÿå¯ä»¥é€šè¿‡Implè®¾è®¡æ¨¡å¼æ¥è§£å†³è¯¥é—®é¢˜ã€‚ 1234567class EXPORT_API Koi &#123; public: // .... private: class Impl; Impl* impl_;&#125;; 123456// åŠ¨æ€åº“å†…éƒ¨class Koi::Impl &#123; public: int a_; // ...&#125; 3.2 æ”¹å˜éé™æ€æˆå‘˜å˜é‡çš„é¡ºåºæ”¹å˜äº†éé™æ€æˆå‘˜å˜é‡çš„é¡ºåºå°±æ”¹å˜äº†å˜é‡çš„å†…å­˜åç§»ï¼Œä¼šå¯¼è‡´å˜é‡è¯»å†™å‡ºé”™ï¼Œå› æ­¤ç ´åäº†ABIå…¼å®¹æ€§ã€‚ è¿™ä¸ªé—®é¢˜ä¹Ÿå¯é€šè¿‡ä¸Šé¢ 3.1 èŠ‚çš„æ–¹å¼æ¥è§£å†³ã€‚ 3.3 ä¿®æ”¹å‡½æ•°çš„åç§°è¿™ä¸ªå¯¼è‡´ä¼š Name Mangling åå‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤ ABI ä¸å…¼å®¹ã€‚ 3.4 æ·»åŠ é»˜è®¤çš„æ¨¡æ¿ç±»å‹å‚æ•°å¦‚Foo&lt;T&gt; æ”¹ä¸º Foo&lt;T, Alloc=alloc&lt;T&gt; &gt;ï¼Œè¿™ä¸ªå¯¼è‡´ä¼š Name Mangling åå‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤ä¸ ABI å…¼å®¹ã€‚ 3.5 ä¸ºå‡½æ•°æ·»åŠ é»˜è®¤å‚æ•°ç°æœ‰çš„åŠ¨æ€åº“ä½¿ç”¨æ–¹ï¼ˆå¯æ‰§è¡Œç¨‹åºæˆ–å¦å¤–ä¸€ä¸ªåŠ¨æ€åº“ï¼‰æ˜¯åŸºäºè€çš„å¤´æ–‡ä»¶è¿›è¡Œç¼–è¯‘çš„ï¼Œæ— æ³•ä¼ é€’è¯¥é»˜è®¤å‚æ•°ç»™æ–°çš„åŠ¨æ€åº“ï¼Œå› æ­¤ä¸ ABI å…¼å®¹ã€‚ 3.6 ä¿®æ”¹å‡½æ•°å‚æ•°ä¼ é€’æ–¹å¼å¦‚ __cdecl ä¿®æ”¹ä¸º __stdcallã€‚å‡½æ•°å‚æ•°çš„ä¼ é€’æ–¹å¼æœ‰å¤šç§ï¼Œå¦‚å‹æ ˆæ–¹å¼ã€å¯„å­˜å™¨æ–¹å¼ã€‚å¦‚æœé€‰æ‹©å‹æ ˆæ–¹å¼ï¼Œåœ¨ç»´æŒæ ˆå¹³è¡¡ä¸Šæœ‰åˆ†è°ƒç”¨è€…ç»´æŒã€å‡½æ•°è‡ªèº«ç»´æŒï¼Œåœ¨å‚æ•°çš„ä¼ é€’é¡ºåºä¹Ÿæœ‰å¤šç§ï¼Œä»å·¦åˆ°å³ï¼Œè¿˜æ˜¯ä»å³åˆ°å·¦ã€‚ å…·ä½“ä»‹ç»å¯ä»¥å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼šä»æ±‡ç¼–çš„è§’åº¦åˆ†æå‡½æ•°è°ƒç”¨è¿‡ç¨‹ 3.7 æ·»åŠ è™šå‡½æ•°æ·»åŠ è™šå‡½æ•°ä¼šå¯¼è‡´è™šå‡½æ•°è¡¨å‘ç”Ÿäº†å˜åŒ–ï¼Œå³ä¾¿æ˜¯åœ¨æœ€å°¾ç«¯æ·»åŠ è™šå‡½æ•°ä¹Ÿå¯èƒ½ä¸è¡Œï¼Œå› ä¸ºå½“å‰ç±»å¯èƒ½å·²ç»è¢«å…¶ä»–ç±»ç»§æ‰¿äº†ã€‚ 3.8 ä¸åŒç³»ç»Ÿçš„åŠ¨æ€åº“ä¸åŒæ“ä½œç³»ç»Ÿæ‰€æ”¯æŒçš„åŠ¨æ€åº“çš„äºŒè¿›åˆ¶æ ¼å¼ä¸ä¸€æ ·ï¼Œå› æ­¤ä¸åŒç³»ç»Ÿçš„åŠ¨æ€åº“è‚¯å®šæ˜¯æ— æ³•å…¼å®¹çš„ã€‚ å››ã€ä¸ç ´åABIå…¼å®¹æ€§çš„è¡Œä¸ºä¸‹é¢çš„æ“ä½œä¸ä¼šç ´å ABI å…¼å®¹æ€§ï¼š æ·»åŠ æ–°çš„ç±» ä¿®æ”¹æˆå‘˜å˜é‡çš„åç§° æ›´æ”¹éè™šæˆå‘˜å‡½æ•°çš„é¡ºåº äº”ã€Windows COM å®ç° ABI å…¼å®¹çš„æ–¹å¼å¾ˆå¤šæ—¶å€™ï¼Œç”±äºåŠŸèƒ½æ›´æ–°ï¼Œå¯¹æ¥å£çš„ä¿®æ”¹ä¸å¯é¿å…çš„ï¼Œæ—¢ç„¶æ¥å£å·²ç»å‘ç”Ÿå¤§æ”¹åŠ¨ï¼Œé‚£æ˜¾ç„¶å¾ˆéš¾æ»¡è¶³ABIå…¼å®¹æ€§ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ç‰ˆæœ¬ç®¡ç†çš„æ–¹å¼æ¥ä¿è¯ ABI å…¼å®¹æ€§ï¼Œå¦‚ï¼š 1234567// ç‰ˆæœ¬1class Interface &#123;public: virtual void API sendMessage(const char* message) = 0;&#125;;Interface* CreateInterface(int version); 1234567// ç‰ˆæœ¬2class Interface2 &#123;public: virtual void API sendMessage(const char* message, int messageSize) = 0;&#125;;Interface2* CreateInterface(int version); ä¸Šé¢æ–¹å¼ä¹Ÿæ˜¯ COM å®ç° ABI å…¼å®¹æ€§çš„æ–¹å¼ï¼Œéœ€è¦åœ¨åŠ¨æ€åº“ä¸­ä»è¦ä¿ç•™è€çš„æ¥å£å’Œå®ç°ï¼Œä»¥å®ç°å‘å‰å…¼å®¹ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸ªå¼Šç«¯å°±æ˜¯ä¼šå­˜åœ¨å¾ˆå¤šç‰ˆæœ¬çš„æ¥å£ï¼Œå¦‚ï¼š 12IDirect3D7, IDirect3D8, IDirect3D9, ID3D10*, ID3D11*IXMLDOMDocument, IXMLDOMDocument2, IXMLDOMDocument3 æœ¬æ–‡å‚è€ƒäº†ï¼š C++ å·¥ç¨‹å®è·µ(4)ï¼šäºŒè¿›åˆ¶å…¼å®¹æ€§","tags":["C++","ABI"],"categories":["C++è¯­è¨€"]},{"title":"Nodeæ’ä»¶å¼€å‘(1)-å¿«é€Ÿå…¥é—¨","path":"/post/819381949.html","content":"åœ¨ä½¿ç”¨Electronå¼€å‘å®¢æˆ·ç«¯æ—¶ï¼Œå¦‚æœç°æœ‰Nodeæ¨¡å—æ‰€æä¾›çš„åŠŸèƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨C++å¼€å‘è‡ªå®šä¹‰çš„Nodeæ¨¡å—ï¼Œä¹Ÿç§°æ’ä»¶ï¼ˆaddonï¼‰ã€‚ Node.jsæ’ä»¶çš„æ‰©å±•åä¸º.nodeï¼Œæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯åŠ¨æ€é“¾æ¥åº“é‡å‘½åè€Œæ¥ï¼Œåœ¨Windowså¹³å°æ˜¯.dllæ–‡ä»¶ï¼ŒLinux&#x2F;Unixå¹³å°æ˜¯.soæ–‡ä»¶ã€‚ 1. é€‰æ‹©Node-APIå¼€å‘Node.jsæ‰©å±•çš„æ–¹å¼æœ‰ä¸‰ç§ï¼š Node-APIï¼ˆä»¥å‰å«N-APIï¼‰ nan ç›´æ¥ä½¿ç”¨v8ã€libuvç­‰åº“è¿›è¡Œå¼€å‘ é™¤éæ˜¯ä¸ºäº†ä½¿ç”¨ Node-API æœªå…¬å¼€çš„æ¥å£ï¼Œå¦åˆ™å»ºè®®ä½¿ç”¨ Node-API è¿›è¡Œå¼€å‘ã€‚ å› ä¸ºNode-APIæ˜¯äºŒè¿›åˆ¶ï¼ˆABIï¼‰å…¼å®¹çš„ï¼Œå®ƒå°†åº•å±‚JavaScriptå¼•æ“ä¸ä¸Šå±‚æ’ä»¶éš”ç¦»å¼€äº†ï¼ŒJavaScriptyå¼•æ“çš„ä¿®æ”¹ä¸ä¼šå½±å“æˆ‘ä»¬å¼€å‘çš„ä¸Šå±‚æ’ä»¶ï¼Œæˆ‘ä»¬åŸºäºæŸä¸ªç‰ˆæœ¬ç¼–è¯‘çš„æ’ä»¶åœ¨ä¸éœ€è¦é‡æ–°ç¼–è¯‘çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è¿è¡Œåœ¨å…¶ä»–ç‰ˆæœ¬çš„Node.jsä¸­ã€‚ 2. å®‰è£…ç¼–è¯‘ç¯å¢ƒNodeæ’ä»¶ä½¿ç”¨C++å¼€å‘ï¼Œå› æ­¤åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šé‡‡ç”¨ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒã€‚åœ¨Linuxç¯å¢ƒé€šå¸¸ä½¿ç”¨GCCå’ŒLLVMï¼› Macç¯å¢ƒé€šå¸¸ä½¿ç”¨Xcodeï¼› Windowsç¯å¢ƒé€šå¸¸ä½¿ç”¨Visual Studioï¼Œå¦‚æœä¸æƒ³å®‰è£…å®Œæ•´çš„Visual Studioï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä»…å®‰è£…å¿…è¦çš„å·¥å…·é“¾ï¼š 1npm install --global windows-build-tools Nodeæ’ä»¶é€šå¸¸ä½¿ç”¨node-gypè¿›è¡Œç¼–è¯‘ï¼Œnode-gypåŸºäºGoogleçš„gyp-nextæ„å»ºç³»ç»Ÿï¼Œnode-gypå·²ç»ä¸npmæ†ç»‘åœ¨ä¸€èµ·ï¼Œä½†æˆ‘ä»¬åœ¨ä½¿ç”¨node-gypä¹‹å‰è¿˜éœ€è¦å…ˆå®‰è£…Pythonã€‚ è‡³æ­¤Nodeæ’ä»¶å¼€å‘çš„ç¯å¢ƒå·²ç»æ­å»ºå®Œæˆã€‚ 3.æ­å»ºå·¥ç¨‹ æœ¬æ–‡ä»¥åœ¨Windowsä¸‹å¼€å‘Nodeæ’ä»¶ä¸ºä¾‹ï¼Œå…¶ä»–ç³»ç»Ÿç¯å¢ƒåœ¨ç¼–è¯‘é€‰é¡¹æ–¹é¢ç•¥æœ‰ä¸åŒ 3.1 package.json123456789101112131415&#123; &quot;name&quot;: &quot;node-addson-sample&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;private&quot;: true, &quot;description&quot;: &quot;A sample node addson sample&quot;, &quot;dependencies&quot;: &#123; &quot;bindings&quot;: &quot;^1.5.0&quot;, &quot;node-addon-api&quot;: &quot;^7.1.0&quot; &#125;, &quot;scripts&quot;: &#123; &quot;build-debug&quot;: &quot;node-gyp --debug --arch=x64 configure rebuild&quot;, &quot;build-release&quot;: &quot;node-gyp --release --arch=x64 configure rebuild&quot;, &quot;test&quot;: &quot;node test.js&quot; &#125;&#125; ä½¿ç”¨npm installå®‰è£…ä¾èµ–é¡¹ã€‚ å„ä¸ªä¾èµ–é¡¹çš„ä½œç”¨å¦‚ä¸‹ï¼š node-addon-apiç”¨äºæä¾›äº†Node-APIç›¸å…³çš„å¤´æ–‡ä»¶ï¼› bindingsç”¨äºå¸®åŠ©æ’ä»¶å¼€å‘è€…å¿«é€Ÿå¯¼å…¥ç¼–è¯‘åçš„.nodeæ’ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œè¿™ä¸ªä¾èµ–æ˜¯éå¿…é¡»ï¼› build-debugå’Œbuild-releaseè„šæœ¬åˆ†åˆ«ç”¨äºç¼–è¯‘Debugå’ŒReleaseç‰ˆæœ¬çš„æ’ä»¶ï¼› testè„šæœ¬ç”¨äºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼› 32ä½æ’ä»¶æŒ‡å®šarchä¸ºia32ï¼ˆ--arch=ia32ï¼‰å°±å¯ä»¥ç¼–è¯‘32ä½ç‰ˆæœ¬çš„Nodeæ’ä»¶ã€‚ éœ€è¦æ³¨æ„ï¼š64ä½ç‰ˆæœ¬Node.jsåªèƒ½åŠ è½½64ä½çš„Nodeæ’ä»¶ï¼Œ32ä½ç‰ˆæœ¬çš„Node.jsä¹Ÿåªèƒ½åŠ è½½32ä½çš„Nodeæ’ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š 1Error: \\\\?\\D: ode-addon-sample\\build\\Debug ode-addon-sample.node is not a valid Win32 application. 3.2 ç¼–è¯‘è„šæœ¬Node-APIæ”¯æŒGYPå’ŒCMake.jsä¸¤ç§ç¼–è¯‘æ–¹å¼ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨GYPæ–¹å¼ã€‚ æ–°å»ºbinding.gypæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107&#123; &quot;targets&quot;: [ &#123; &quot;target_name&quot;: &quot;node-addson-sample&quot;, # ***.node &quot;cflags!&quot;: [ &quot;-fno-exceptions&quot; ], &quot;cflags_cc!&quot;: [ &quot;-fno-exceptions&quot; ], # æŒ‡å®šéœ€è¦ç¼–è¯‘çš„æºæ–‡ä»¶ &quot;sources&quot;: [ &quot;main.cpp&quot; ], &quot;include_dirs&quot;: [ &quot;&lt;!@(node -p \\&quot;require(&#x27;node-addon-api&#x27;).include\\&quot;)&quot; ], # é¢„ç¼–è¯‘å® &quot;defines&quot;: [ &quot;NAPI_CPP_EXCEPTIONS&quot;, # åœ¨Node-APIä¸­å¯ç”¨C++å¼‚å¸¸ ], &quot;conditions&quot;: [ [ # Windowså¹³å°ç¼–è¯‘é€‰é¡¹ &quot;OS == &#x27;win&#x27;&quot;, &#123; &quot;configurations&quot;: &#123; # Debugç¼–è¯‘é€‰é¡¹ &quot;Debug&quot;: &#123; # é¢„ç¼–è¯‘å® &quot;defines&quot;: [ &quot;DEBUG&quot;, &quot;_DEBUG&quot; ], &quot;cflags&quot;: [ &quot;-g&quot;, &quot;-O0&quot; ], &quot;conditions&quot;: [ [ &quot;target_arch==&#x27;x64&#x27;&quot;, &#123; &quot;msvs_configuration_platform&quot;: &quot;x64&quot;, &#125; ], ], &quot;msvs_settings&quot;: &#123; &quot;VCCLCompilerTool&quot;: &#123; # 0 - MultiThreaded (/MT) # 1 - MultiThreadedDebug (/MTd) # 2 - MultiThreadedDLL (/MD) # 3 - MultiThreadedDebugDLL (/MDd) &quot;RuntimeLibrary&quot;: 1, # /MTd &quot;Optimization&quot;: 0, # /Od, no optimization &quot;MinimalRebuild&quot;: &quot;false&quot;, &quot;OmitFramePointers&quot;: &quot;false&quot;, &quot;BasicRuntimeChecks&quot;: 3, # /RTC1 &quot;AdditionalOptions&quot;: [ &quot;/EHsc&quot; ], &#125;, &quot;VCLinkerTool&quot;: &#123; &quot;LinkIncremental&quot;: 2, # Enable incremental linking # é™„åŠ ä¾èµ–åº“ &quot;AdditionalDependencies&quot;: [ ], &#125;, &#125;, # é™„åŠ åŒ…å«ç›®å½• &quot;include_dirs&quot;: [ ], &#125;, # Debugç¼–è¯‘é€‰é¡¹ &quot;Release&quot;: &#123; # é¢„ç¼–è¯‘å® &quot;defines&quot;: [ &quot;NDEBUG&quot; ], &quot;msvs_settings&quot;: &#123; &quot;VCCLCompilerTool&quot;: &#123; &quot;RuntimeLibrary&quot;: 0, # /MT &quot;Optimization&quot;: 3, # /Ox, full optimization &quot;FavorSizeOrSpeed&quot;: 1, # /Ot, favour speed over size &quot;InlineFunctionExpansion&quot;: 2, # /Ob2, inline anything eligible &quot;WholeProgramOptimization&quot;: &quot;false&quot;, # Dsiable /GL, whole program optimization, needed for LTCG &quot;OmitFramePointers&quot;: &quot;true&quot;, &quot;EnableFunctionLevelLinking&quot;: &quot;true&quot;, &quot;EnableIntrinsicFunctions&quot;: &quot;true&quot;, &quot;RuntimeTypeInfo&quot;: &quot;false&quot;, &quot;ExceptionHandling&quot;: &quot;2&quot;, # /EHsc &quot;AdditionalOptions&quot;: [ &quot;/MP&quot;, # compile across multiple CPUs ], &quot;DebugInformationFormat&quot;: 3, &quot;AdditionalOptions&quot;: [ ], &#125;, &quot;VCLibrarianTool&quot;: &#123; &quot;AdditionalOptions&quot;: [ &quot;/LTCG&quot;, # link time code generation ], &#125;, &quot;VCLinkerTool&quot;: &#123; &quot;LinkTimeCodeGeneration&quot;: 1, # link-time code generation &quot;OptimizeReferences&quot;: 2, # /OPT:REF &quot;EnableCOMDATFolding&quot;: 2, # /OPT:ICF &quot;LinkIncremental&quot;: 1, # disable incremental linking # é™„åŠ ä¾èµ–åº“ &quot;AdditionalDependencies&quot;: [ ], &#125;, &#125;, # é™„åŠ åŒ…å«ç›®å½• &quot;include_dirs&quot;: [ ], &#125; &#125; &#125;, ] ] &#125; ]&#125; binding.gypä¸­çš„ç¼–è¯‘é€‰é¡¹å¤§å¤šä¸ç‰¹å®šå¹³å°çš„ç¼–è¯‘å™¨æœ‰å…³ï¼Œå…·ä½“å¯ä»¥æŸ¥é˜…ç›¸å…³ç¼–è¯‘å™¨æ–‡æ¡£ï¼Œå¦‚Windowså¹³å°å¯ä»¥æŸ¥è¯¢MSVCæ–‡æ¡£ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŒ‡å®šéœ€è¦ä½¿ç”¨çš„ Visual Stuido ç‰ˆæœ¬ï¼š 1npm config set msvs_version 20xx node-gypå®˜æ–¹æä¾›äº†ä¸€äº›ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™äº›ç¤ºä¾‹ä¸­è·å–ä¸å°‘çµæ„Ÿï¼š binding.gyp-files-in-the-wild GYPå®˜æ–¹æ–‡æ¡£ï¼š https://gyp.gsrc.io/docs/UserDocumentation.md 3.3 ç¬¬ä¸€ä¸ªAPIç°åœ¨æ–°å»ºmain.cppï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªAPIï¼ŒAPIåä¸ºAddï¼Œæ”¯æŒä¼ å…¥2ä¸ªæ•´æ•°å‚æ•°ï¼Œè¿”å›æ•´æ•°ç›¸åŠ çš„å’Œã€‚ 1234567891011121314151617#include &lt;napi.h&gt;// åŒæ­¥è°ƒç”¨// è®¡ç®—ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ç»“æœå¹¶è¿”å›Napi::Number Add(const Napi::CallbackInfo&amp; info) &#123; Napi::Env env = info.Env(); if (info.Length() != 2) throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); if (!info[0].IsNumber() || !info[1].IsNumber()) throw Napi::TypeError::New(env, &quot;Wrong arguments&quot;); const int ret = info[0].ToNumber().Int32Value() + info[1].ToNumber().Int32Value(); return Napi::Number::New(env, ret);&#125; åœ¨å®šä¹‰å®ŒAPIä¹‹åï¼Œè¿˜éœ€è¦å°†APIå¯¼å‡ºï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 12345678// å¯¼å‡ºå‡½æ•°Napi::Object Init(Napi::Env env, Napi::Object exports) &#123; exports.Set(Napi::String::New(env, &quot;Add&quot;), Napi::Function::New(env, Add)); return exports;&#125;NODE_API_MODULE(addon, Init) å¦‚æœå¿˜è®°å¯¼å‡ºAPIï¼ŒåŠ è½½Nodeæ’ä»¶æ—¶ä¼šæŠ¥é”™ï¼š 1Error: Module did not self-register: &#x27;\\\\?\\D: ode-addson-sample\\build\\Debug ode-addson-sample.node&#x27;. ç°åœ¨æ‰§è¡Œnpm run build-debugç¼–è¯‘Debugç‰ˆæœ¬æ’ä»¶ï¼Œç¼–è¯‘ç”Ÿæˆçš„nodeæ’ä»¶è·¯å¾„ä¸ºbuild\\Debug ode-addson-sample.nodeã€‚ 3.4 æµ‹è¯•ç”¨ä¾‹æ–°å»ºtest.jsï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 123const sample = require(&quot;bindings&quot;)(&quot;node-addson-sample.node&quot;);console.log(sample.Add(100, 200)); // è¾“å‡º300 ä½¿ç”¨bindingsæ¨¡å—å¯ä»¥ä¸ç”¨è€ƒè™‘æ’ä»¶çš„å…·ä½“ä½ç½®ï¼Œè¯¥æ¨¡å—ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨é¡¹ç›®ç›®å½•ä¸‹éå†æŸ¥æ‰¾ã€‚ 4. æ•°æ®ç±»å‹åœ¨napi.hå¤´æ–‡ä»¶ä¸­æœ‰å¾ˆå¤šç»§æ‰¿è‡ªNapi::Valueçš„å­ç±»ï¼Œè¿™äº›ç±»åˆ†åˆ«å¯¹åº”JavaScriptä¸­çš„æ•°æ®ç±»å‹ï¼Œå¦‚ï¼š Napi::Boolean -&gt; Boolean Napi::Number -&gt; Number Napi::String -&gt; String Napi::Function -&gt; Function Napi::Symbol -&gt; Symbol Napi::Array -&gt; Array Napi::Object -&gt; Object Node-Apiè¿˜å®šä¹‰Promiseã€Dateã€Bufferç­‰æ•°æ®ç±»å‹ã€‚ 4.1 Nullå’ŒUndefinedNullå’ŒUndefinedæ¯”è¾ƒç‰¹æ®Šï¼Œæ²¡æœ‰å®šä¹‰ä¸“é—¨çš„ç±»ï¼Œç”±Envç±»çš„æˆå‘˜å‡½æ•°è¿”å›ã€‚ 123env.Null()env.Undefined() 4.2 åˆ›å»ºå¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç”¨æ¥åˆ›å»ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼Œä»¥åˆ›å»ºBooleanç±»å‹ä¸ºä¾‹ï¼š 12Napi::Boolean::New(env, true)Napi::Value::From(env, false) ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ•°ç»„ä¸ºä¾‹ä»‹ç»å¯¹è±¡å’Œæ•°ç»„çš„ä½¿ç”¨æ–¹æ³•ï¼š 12345678Napi::Array result = Napi::Array::New(env);for (size_t i = 0; i &lt; 3; i++) &#123; Napi::Object obj = Napi::Object::New(env); obj.Set(Napi::String::New(env, &quot;filePath&quot;), Napi::String::New(env, &quot;/root/&quot; + std::to_string(i) + &quot;.txt&quot;)); obj.Set(Napi::String::New(env, &quot;fileSize&quot;), Napi::Number::New(env, i * 100)); result.Set(Napi::Number::New(env, i), obj);&#125; 4.3 ç±»å‹æ ¡éªŒNapi::Valueæä¾›äº†è‹¥å¹²æ–¹æ³•ç”¨äºåˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦ä¸ºæŒ‡å®šç±»å‹ï¼Œå¦‚ï¼š IsUndefined IsNull IsBoolean IsNumber IsString IsSymbol IsArray IsObject IsFunction IsPromise IsBuffer 5. å¼‚å¸¸å¯ä»¥åœ¨ç¼–è¯‘è„šæœ¬binding.gypä¸­é€šè¿‡é¢„ç¼–è¯‘å®æŒ‡å®šæ˜¯å¦å¯ç”¨C++å¼‚å¸¸ï¼š 123NAPI_CPP_EXCEPTIONSNAPI_DISABLE_CPP_EXCEPTIONS å¦‚æœå¯ç”¨C++å¼‚å¸¸ï¼Œåˆ™Napi::Errorä¼šç»§æ‰¿è‡ªstd::exceptionã€‚ 123456class Error : public ObjectReference#ifdef NAPI_CPP_EXCEPTIONS , public std::exception#endif // NAPI_CPP_EXCEPTIONS... åœ¨å¯åŠ¨C++å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œä»Nodeæ’ä»¶æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼å¦‚ä¸‹ï¼š 1throw Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;); å°†ä¼šä¸­æ–­å½“å‰å‡½æ•°throwåé¢ä»£ç çš„æ‰§è¡Œã€‚ TypeErrorç»§æ‰¿è‡ªErrorï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºä¸ç±»å‹é”™è¯¯ç›¸å…³çš„å¼‚å¸¸ã€‚ç±»ä¼¼çš„é”™è¯¯ç±»å‹è¿˜æœ‰RangeErrorç­‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŠ›å‡ºErrorç±»å‹çš„é”™è¯¯ï¼š 1throw Napi::Error::New(env, &quot;Wrong number of arguments&quot;); åœ¨æ²¡æœ‰å¯åŠ¨C++å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œä»Nodeæ’ä»¶æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼å¦‚ä¸‹ï¼ŒæŠ›å‡ºå¼‚å¸¸åéœ€è¦ä½¿ç”¨returnè¯­å¥ç»ˆæ­¢ä¸‹é¢æµç¨‹çš„æ‰§è¡Œï¼š 12Napi::TypeError::New(env, &quot;Wrong number of arguments&quot;).ThrowAsJavaScriptException();return; Node-APIå®˜æ–¹æ–‡æ¡£ï¼šnode-addon-api docNode.jså®˜æ–¹addonç¤ºä¾‹ï¼šnode-addon-examples","tags":["Electron","Node-API"],"categories":["Electron"]},{"title":"äº§å“çº§çš„Electroné¡¹ç›®æ¨¡æ¿","path":"/post/946276004.html","content":"å†™åœ¨å‰é¢å·²ç»æœ‰äº†é‚£ä¹ˆå¤šçš„ Electron é¡¹ç›®æ¨¡æ¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†é€ ä¸€ä¸ªï¼Ÿæ˜¯é‡å¤é€ è½®å­å—ï¼Ÿ æˆ‘ç›¸ä¿¡å¤§å¤šæ•°äººé€‰æ‹©ä½¿ç”¨ Electron å¼€å‘å®¢æˆ·ç«¯æ—¶ï¼Œæˆ–å¤šæˆ–å°‘éƒ½çœ‹ä¸Šäº† Web å¼€å‘çš„é«˜æ•ˆç‡ï¼Œä½†Webå¼€å‘äººå‘˜åœ¨å®¢æˆ·ç«¯å’Œç³»ç»Ÿç¼–ç¨‹æ–¹é¢çš„ç»éªŒç›¸å¯¹ç¼ºä¹ï¼ŒåˆåŠ ä¸Š Electron å’Œå‰ç«¯æ¡†æ¶ï¼ˆå¦‚ Vue ï¼‰ç»“åˆèµ·æ¥ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„è½»è€Œæ˜“ä¸¾ï¼Œå¼€å‘äººå‘˜å¤§å¤šä¼šé€‰æ‹©åŸºäºæ¨¡æ¿æ¥å¿«é€Ÿä¸Šæ‰‹æ­å»ºElectroné¡¹ç›®ã€‚ ç›®å‰ï¼ŒElectron çš„æ¨¡æ¿é¡¹ç›®å·²ç»æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒæµè¡Œçš„æœ‰electron-viteã€electron-vite-vueç­‰ã€‚åœ¨è¿™äº›æ¨¡æ¿ä¸­ï¼Œæœ‰çš„åŠŸèƒ½è¿‡äºå®Œå–„ï¼Œä»£ç å¤ªå¤æ‚ï¼Œè¿œè¿œè¶…è¿‡äº†å¾ˆå¤š Electron å®¢æˆ·ç«¯é¡¹ç›®æœ¬èº«çš„ä»£ç é‡ï¼Œéœ€è¦èŠ±å¾ˆå¤šæ—¶é—´æ¥ç†Ÿæ‚‰æ¨¡æ¿ï¼Œä¸é€‚åˆæ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹å’Œä¿®æ”¹ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä¹Ÿéš¾ä»¥ç»´æŠ¤ï¼›æœ‰çš„æ¨¡æ¿åˆå¹´ä¹…å¤±ä¿®ï¼Œä½¿ç”¨çš„æŠ€æœ¯æ—©å·²è¢«æ·˜æ±°ï¼Œä¹Ÿä¸é€‚åˆç”¨æ¥å¼€å‘çº¿ä¸Šäº§å“ï¼Œè€Œä¸”è¿™äº›æ¨¡æ¿éƒ½æœ‰ä¸€ä¸ªé€šç—…ï¼Œéƒ½æ˜¯åœ¨ç”¨Webå¼€å‘çš„æ€ç»´æ¥å¼€å‘å®¢æˆ·ç«¯ã€‚ åŸºäºä¸Šè¿°åŸå› ï¼Œæˆ‘å¼€å‘äº†è¿™ä¸ª Electron é¡¹ç›®æ¨¡æ¿ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸€ç›´éµå¾ªç¨³å®šã€æ˜“äºç»´æŠ¤çš„åˆè¡·ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/winsoft666/electron-vue3-boilerplate é¡¹ç›®ä»‹ç»åŸºäºVue3 + Electron + TypeScriptçš„å®¢æˆ·ç«¯ç¨‹åºæ¨¡æ¿ï¼Œä½¿ç”¨Viteå’ŒElectron Forgeæ„å»ºå’Œæ‰“åŒ…ã€‚ çœŸæ­£åšåˆ°å¼€ç®±å³ç”¨ï¼Œé¢å‘è·¨å¹³å°å®¢æˆ·ç«¯è®¾è®¡ï¼Œäº§å“çº§çš„é¡¹ç›®æ¨¡æ¿ã€‚ ç‰¹æ€§ ä½¿ç”¨ ViteJS æ„å»ºå’Œé©±åŠ¨å‰ç«¯é¡µé¢ï¼Œæ”¯æŒçƒ­åŠ è½½ï¼ˆHMRï¼‰ï¼Œä½¿å¼€å‘å’Œè°ƒè¯•å˜å¾—æ›´åŠ é«˜æ•ˆ âš¡ æ”¯æŒElectronçª—å£åˆ›å»ºæŒ‡ä»¤ï¼Œå¹¶ä¸”å¯éš”ç¦»ä¸åŒçª—å£çš„IPCäº‹ä»¶ ğŸ’– å°è£…ç®€åŒ–äº†IPCçš„è°ƒç”¨æ–¹å¼ï¼Œå¹¶æä¾›äº†IPCå‡½æ•°å¿«é€Ÿåˆ›å»ºæŒ‡ä»¤ï¼Œä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„ç›¸äº’è°ƒç”¨ä»æœªå¦‚æ­¤ç®€å• ğŸ‘ ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹æ”¯æŒçƒ­åŠ è½½ âš¡ ç²¾é€‰ä¾èµ–åŒ…ï¼Œæå‡é¡¹ç›®ç¨³å®šæ€§ ä»£ç ç®€æ´ï¼Œæ˜“æŒæ§ï¼Œå¯å®šåˆ¶æ€§å¼º æ—¥å¿—æ–‡ä»¶ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹å¯ä»¥ç›´æ¥å†™æ–‡ä»¶æ—¥å¿— é…ç½®æ–‡ä»¶ ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹å‡æ”¯æŒaxios HTTPè¯·æ±‚ æ–‡ä»¶ä¸‹è½½ï¼ˆå«å“ˆå¸Œæ ¡éªŒã€è¿›åº¦åé¦ˆï¼‰ï¼Œæ¸²æŸ“è¿›ç¨‹å¯ç›´æ¥å¼‚æ­¥è°ƒç”¨ ğŸ‘ åŠŸèƒ½å®Œå–„çš„æ— è¾¹æ¡†çª—å£ æ‰˜ç›˜å›¾æ ‡å’Œå³é”®èœå•ï¼Œçª—å£å…³é—­æ—¶ç¨‹åºæœ€å°åŒ–åˆ°æ‰˜ç›˜ å®¢æˆ·ç«¯ç¨‹åºå•å®ä¾‹ åŸºäºESLintçš„ä»£ç è§„èŒƒå’Œè‡ªåŠ¨æ ¼å¼åŒ– ä½¿ç”¨Electronå®˜æ–¹æ¨èçš„Electron Forgeè¿›è¡Œå®¢æˆ·ç«¯æ„å»ºå’Œæ‰“åŒ… æ”¯æŒNSISå®‰è£…åŒ… ğŸ˜ â€¦â€¦ å¿«é€Ÿå¼€å§‹ ğŸŒˆç‚¹å‡»å³ä¸Šè§’ç»¿è‰²çš„ Use this template æŒ‰é’®ï¼Œä½¿ç”¨è¯¥æ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“å¹¶å…‹éš†åˆ°æœ¬åœ°ã€‚ æˆ–è€….. ç›´æ¥å…‹éš†è¯¥é¡¹ç›®: 1git clone https://github.com/winsoft666/electron-vue3-boilerplate.git Visual Studio Codeæ¨èä½¿ç”¨Visual Studio Codeè¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå¹¶å®‰è£…å¦‚ä¸‹æ’ä»¶ï¼š ESLint Vue Language Features (Volar) å®‰è£…ä¾èµ– â¬1yarn install å¼€å‘ âš’ï¸1yarn run dev å…¶ä»–å‘½ä»¤1234567891011yarn run dev # å¯åŠ¨åº”ç”¨å¹¶æ”¯æŒçƒ­åŠ è½½yarn run build # æ„å»ºåº”ç”¨ï¼Œå¯å‘å¸ƒçš„åŒ…ä½äº&quot;out\\make&quot;ç›®å½•# æˆ–è€…yarn run build:win32 # æ„å»ºWindowså¹³å° 32ä½åº”ç”¨yarn run build:win64 # æ„å»ºWindowså¹³å° 64ä½åº”ç”¨yarn run build:mac # æ„å»ºmacOSå¹³å°åº”ç”¨yarn run build:linux # æ„å»ºLinuxå¹³å°åº”ç”¨yarn run new:page # åˆ›å»ºæ–°çš„Vueé¡µé¢yarn run new:window # åˆ›å»ºæ–°çš„Electronçª—å£ æ›´å¤šçš„å¯é€‰é…ç½®é¡¹å¯ä»¥å‚è€ƒ Electron Forge CLI docsã€‚ æ›´å¤šä»‹ç»å¯ä»¥è®¿é—®é¡¹ç›®ä¸»é¡µï¼š https://github.com/winsoft666/electron-vue3-boilerplate é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Electron"],"categories":["Power By Me"]},{"title":"ğŸ‰2024é¾™è¡Œé¾˜é¾˜","path":"/post/1391804423.html","content":"å†™ä¸‹è¿™ä¸€è¡Œé¢„ç¤ºç€2024å¹´çš„å·¥ä½œå¼€å§‹äº†ï¼ŒåŠ æ²¹ï¼ ç‰©æ¥é¡ºåº”ï¼Œæœªæ¥ä¸è¿ã€‚ å½“æ—¶ä¸æ‚ï¼Œæ—¢è¿‡ä¸æ‹ã€‚","categories":["æ‚å¿µ"]},{"title":"å¼€æºåº“spdlogä½¿ç”¨å¤‡å¿˜","path":"/post/2185523635.html","content":"spdlogæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½C++æ—¥å¿—åº“ï¼Œæ”¯æŒä»…å¤´æ–‡ä»¶ï¼ˆheader-onlyï¼‰æ¨¡å¼ä½¿ç”¨ã€‚ å®˜ç½‘åœ°å€ï¼š https://github.com/gabime/spdlog spdlogæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†ä¸æ˜¯è¿›ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ä¸€ä¸ªspdlogå¯¹è±¡è¾“å‡ºæ—¥å¿—ï¼Œä½†ä¸èƒ½å¤šä¸ªè¿›ç¨‹åŒæ—¶å¾€ä¸€ä¸ªæ–‡ä»¶å†™å…¥æ—¥å¿—ã€‚ åœ¨spdlogå†…éƒ¨ä½¿ç”¨fmtè¿›è¡Œå­—ç¬¦ä¸²çš„æ ¼å¼åŒ–ï¼Œå› æ­¤spdlogå­—ç¬¦ä¸²æ ¼å¼çš„æ–¹å¼ä¸fmtåº“ç›¸åŒï¼Œå¦‚ï¼š 1spdlog::critical(&quot;Support for int: &#123;0:d&#125;; hex: &#123;0:x&#125;; oct: &#123;0:o&#125;; bin: &#123;0:b&#125;&quot;, 42); ä¸€ã€æ—¥å¿—çº§åˆ«å¤§å¤šæ•°æ—¥å¿—åº“éƒ½æœ‰æ—¥å¿—çº§åˆ«çš„æ¦‚å¿µï¼Œé€šè¿‡è®¾å®šæ—¥å¿—çº§åˆ«å¯ä»¥åŠ¨æ€æ§åˆ¶æˆ‘ä»¬éœ€è¦æ‰“å°è¾“å‡ºçš„æ—¥å¿—ï¼Œspdlogæ”¯æŒå¦‚ä¸‹æ—¥å¿—çº§åˆ«ï¼š 123456trace = SPDLOG_LEVEL_TRACE // æœ€ä½çº§debug = SPDLOG_LEVEL_DEBUGinfo = SPDLOG_LEVEL_INFOwarn = SPDLOG_LEVEL_WARNerr = SPDLOG_LEVEL_ERRORcritical = SPDLOG_LEVEL_CRITICAL // æœ€é«˜çº§ å¦‚ä¸‹ä»£ç è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºinfoï¼Œæ­¤æ—¶åªä¼šæ‰“å°è¾“å‡ºinfoåŠæ¯”infoçº§åˆ«é«˜çš„æ—¥å¿—ï¼š 1spdlog::set_level(spdlog::level::info); äºŒã€Loggerå’ŒSinkspdlogä¸»è¦ç”±Logger(è®°å½•å™¨)å’ŒSink(è¾“å‡ºä½ç½®)ä¸¤éƒ¨åˆ†ç»„æˆï¼Œspdlogçš„é«˜å¯æ‹“å±•æ€§ä½“ç°åœ¨Loggerå’ŒSinkçš„å¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰æ–¹é¢ã€‚ æ¯ä¸ªç¨‹åºå¯ä»¥åˆ›å»ºå¤šä¸ªLoggerå¯¹è±¡ï¼Œè€Œæ¯ä¸ªLoggerå¯¹è±¡åˆå¯ä»¥åŒ…å«å¤šä¸ªSinkï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥åŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªä½ç½®ï¼‰ã€‚ 2.1 åˆ›å»ºSinkåœ¨ä»‹ç»Loggerçš„åˆ›å»ºæ–¹æ³•å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•åˆ›å»ºSinkå¯¹è±¡ã€‚ æ¯ä¸ªSinkéƒ½æ˜¯ä¸€ä¸ªstd::shared_ptr&lt;spdlog::sink&gt;å¯¹è±¡ï¼Œåˆ›å»ºSinkæ–¹æ³•å¦‚ä¸‹ï¼š 1auto sink = std::make_shared&lt;spdlog::sinks::stdout_sink_mt&gt;(); spdlogæœ‰_mtï¼ˆmulti threadedï¼‰å’Œ_stï¼ˆsingle threadedï¼‰ä¸¤ç±»åç¼€çš„sinkå¯¹è±¡ï¼Œç”¨äºåŒºåˆ†æ˜¯å¦çº¿ç¨‹å®‰å…¨ã€‚å•çº¿ç¨‹(_ståç¼€)çš„sinkæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä¸èƒ½è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚ spdlogå†…ç½®äº†å¤šç§ä¸åŒçš„sinkç±»å‹ï¼Œå¦‚å¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ã€æ§åˆ¶å°ã€tcp&#x2F;udpç«¯å£ã€Windowsäº‹ä»¶æ—¥å¿—ã€mongoæ•°æ®åº“ç­‰ã€‚å®Œæ•´çš„sinkå¯ä»¥æŸ¥çœ‹æºä»£ç çš„sinksç›®å½•ï¼Œé€šå¸¸ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªsinkã€‚ è™½ç„¶å†…ç½®çš„Sinkå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„å¤§å¤šæ•°éœ€æ±‚ï¼Œä½†spdlogä¾ç„¶æ”¯æŒè‡ªå®šä¹‰Sinkï¼Œå…·ä½“æ–¹æ³•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šimplementing-your-own-sink ä¸‹é¢ä»‹ç»å‡ ç§å¸¸ç”¨å†…ç½®sinkçš„åˆ›å»ºæ–¹æ³•ã€‚ simple_file_sinkä¸€ä¸ªç®€å•çš„æ–‡ä»¶æ¥æ”¶å™¨ï¼Œå°†æ—¥å¿—å†™å…¥åˆ°ç»™å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½•çš„é™åˆ¶ã€‚ 123#include &quot;spdlog/sinks/basic_file_sink.h&quot;// ...auto logger = spdlog::basic_logger_mt(&quot;mylogger&quot;, &quot;log.txt&quot;); å…³äºæ—¥å¿—çš„è¾“å‡ºç›®å½•ï¼Œå¦‚ä¸Šé¢çš„data/logsç›®å½•ï¼Œä»splog 1.5.0ç‰ˆæœ¬å¼€å§‹ï¼Œspdlogå°†è‡ªåŠ¨åˆ›å»ºåŒ…å«æ—¥å¿—æ–‡ä»¶çš„ç›®å½•ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œå¿…é¡»æ‰‹åŠ¨åˆ›å»ºç›®å½•ã€‚ rotating_file_sinkå½“è¾¾åˆ°æœ€å¤§æ–‡ä»¶å¤§å°æ—¶ï¼Œå…³é—­æ–‡ä»¶ï¼Œå¹¶é‡å‘½åï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚æœ€å¤§æ–‡ä»¶å¤§å°å’Œæœ€å¤§æ–‡ä»¶æ•°éƒ½å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­é…ç½®ã€‚ 1234#include &quot;spdlog/sinks/rotating_file_sink.h&quot;// ...auto file_logger = spdlog::rotating_logger_mt(&quot;file_logger&quot;, &quot;data/logs/mylogfile.log&quot;, 1048576 * 5, 3); daily_file_sinkæ¯å¤©åœ¨æŒ‡å®šçš„æ—¶é—´åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ååé™„åŠ ä¸€ä¸ªæ—¶é—´æˆ³ã€‚ 123#include &quot;spdlog/sinks/daily_file_sink.h&quot;// ...auto daily_logger = spdlog::daily_logger_mt(&quot;daily_logger&quot;, &quot;logs/daily&quot;, 14, 55); ä¸Šé¢ä»£ç å°†åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„sinkï¼Œè¯¥sinkå°†åœ¨æ¯å¤©14:55åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚ stdout_sinkè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ 12#include &quot;spdlog/sinks/stdout_sinks.h&quot;auto sink = std::make_shared&lt;spdlog::sinks::stdout_sink_mt&gt;(); stdout_sink with colorsè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¹¶å¸¦é¢œè‰²æ ‡è®°ã€‚ 12#include &quot;spdlog/sinks/stdout_sinks.h&quot;auto sink = std::make_shared&lt;spdlog::sinks::stdout_color_sink_mt&gt;(); msvc_sinkè¾“å‡ºåˆ°Windowsè°ƒè¯•æ¥æ”¶å™¨ï¼ˆå¦‚DbgViewï¼‰,åœ¨spdlogå†…éƒ¨å®é™…ä½¿ç”¨OutputDebugStringAè¿›è¡Œæ—¥å¿—è¾“å‡ºã€‚ 123#include &quot;spdlog/sinks/msvc_sink.h&quot;// ...auto sink = std::make_shared&lt;spdlog::sinks::msvc_sink_mt&gt;(false); msvc_sinkçš„æ„é€ å‡½æ•°æ”¯æŒcheck_debugger_presentå‚æ•°ï¼Œå¦‚æœè¯¥å‚æ•°ä¸ºtrueï¼Œåˆ™ä»…åœ¨è°ƒè¯•ç¯å¢ƒè¾“å‡ºæ—¥å¿—åˆ°Windowsè°ƒè¯•æ¥æ”¶å™¨ã€‚ dup_filter_sinkåœ¨æ—¥å¿—è¾“å‡ºæ—¶ç§»é™¤é‡å¤çš„æ—¥å¿—ã€‚å¦‚æœæ—¥å¿—ä¸å‰ä¸€æ¡æ—¥å¿—ç›¸åŒï¼Œå¹¶ä¸”é—´éš”æ—¶é—´å°äºmax_skip_durationï¼Œåˆ™è·³è¿‡è¾“å‡ºè¯¥æ—¥å¿—ã€‚ 123456789#include &quot;spdlog/sinks/dup_filter_sink.h&quot;auto dup_filter = std::make_shared&lt;dup_filter_sink_mt&gt;(std::chrono::seconds(5));spdlog::logger l(&quot;logger&quot;, dup_filter);l.info(&quot;Hello&quot;);l.info(&quot;Hello&quot;);l.info(&quot;Hello&quot;);l.info(&quot;Different Hello&quot;); ä¸Šé¢ç¤ºä¾‹è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š 123[2019-06-25 17:50:56.511] [logger] [info] Hello[2019-06-25 17:50:56.512] [logger] [info] Skipped 3 duplicate messages..[2019-06-25 17:50:56.512] [logger] [info] Different Hello 2.2 åˆ›å»ºLoggeråœ¨åˆ›å»ºå®ŒSinkå¯¹è±¡åï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™äº›Sinkæ¥åˆ›å»ºLoggerå¯¹è±¡ã€‚ ä¸‹é¢ç¤ºä¾‹åˆ›å»ºäº†åä¸ºmyloggerçš„åŒæ­¥Loggerå¯¹è±¡ï¼Œä¸ºè¯¥å¯¹è±¡é…ç½®äº†2ä¸ªsinkã€‚ 123456789auto file_sink = std::make_shared&lt;spdlog::sinks::rotating_file_sink_mt&gt;(&quot;logs/app.log&quot;, 1048576, 7);auto msvc_sink = std::make_shared&lt;spdlog::sinks::msvc_sink_mt&gt;(false);std::vector&lt;spdlog::sink_ptr&gt; sinks = &#123;file_sink, msvc_sink&#125;;auto logger = std::make_shared&lt;spdlog::logger&gt;(&quot;mylogger&quot;, sinks.begin(), sinks.end()); spdlogå†…éƒ¨ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤ä¸€å¼ å…¨å±€çš„Loggerè®°å½•è¡¨ï¼Œè®°è½½äº†æ¯ä¸ªè¿›ç¨‹ä¸­é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºçš„Loggerå®ä¾‹(æŸäº›æƒ…å†µéœ€è¦ç”¨æˆ·æ‰‹åŠ¨æ³¨å†Œ)ã€‚å› è€Œï¼Œåœ¨ä½¿ç”¨æ—¶åªéœ€è¦çŸ¥é“åˆ›å»ºæ—¶æŒ‡å®šçš„åç§°å³å¯è·å–Loggerå¯¹è±¡ï¼š 123auto logger = spdlog::get(&quot;mylogger&quot;);logger-&gt;info(&quot;some things want to say.&quot;); ä¸‰ã€è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼æ—¥å¿—æ ¼å¼ä½œç”¨åœ¨Sinkå¯¹è±¡ä¸Šï¼Œæ¯ä¸ªSinkéƒ½æœ‰ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºï¼Œspdlogçš„é»˜è®¤æ—¥å¿—è®°å½•æ ¼å¼ä¸ºï¼š 1[2014-10-31 23:46:59.678] [my_loggername] [info] Some message æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼ä¸ºå½“å‰è¿›ç¨‹çš„æ‰€æœ‰Loggerå¯¹è±¡çš„æ‰€æœ‰Sinkéƒ½ç»Ÿä¸€è®¾ç½®æ—¥å¿—æ ¼å¼ï¼š 1spdlog::set_pattern(&quot;*** [%H:%M:%S %z] [thread %t] %v ***&quot;); ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼ä¸ºæŒ‡å®šçš„Loggerå¯¹è±¡çš„æ‰€æœ‰Sinkè®¾ç½®æ—¥å¿—æ ¼å¼ï¼š 1some_logger-&gt;set_pattern(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;); å½“ç„¶å¯ä»¥é’ˆå¯¹å…·ä½“çš„Sinkæ¥è®¾ç½®æ—¥å¿—æ ¼å¼ï¼š 12345some_logger-&gt;sinks()[0]-&gt;set_pattern(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;);some_logger-&gt;sinks()[1]-&gt;set_pattern(&quot;..&quot;);// æˆ–some_sink-&gt;set_pattern(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;); åœ¨è®¾ç½®æ—¥å¿—æ ¼å¼æ—¶ï¼Œspdlogéƒ½ä¼šå¯¹æ ¼å¼è¿›ç¨‹é¢„ç¼–è¯‘ï¼Œé¿å…æ¯æ¬¡è¾“å‡ºæ—¥å¿—éƒ½è¿›ç¨‹æ ¼å¼è§£æï¼Œæå‡æ—¥å¿—æ€§èƒ½ã€‚ 3.1 æ ¼å¼æ ‡è®°ä¸‹é¢åˆ—å‡ºäº†spdlogçš„patternå­—ç¬¦ä¸²æ”¯æŒçš„æ ¼å¼æ ‡è®°ï¼ˆç±»ä¼¼%flagï¼‰ã€‚ æ ‡è®° å«ä¹‰ ç¤ºä¾‹ %v å®é™…çš„æ—¥å¿—æ–‡æœ¬ some user text %t çº¿ç¨‹ID 1232 %P è¿›ç¨‹ID 3456 %n æ—¥å¿—åç§° some logger name %l æ—¥å¿—ç­‰çº§å…¨ç§° debugã€infoç­‰ %L æ—¥å¿—ç­‰çº§ç®€å†™ Dã€Iç­‰ %a ç®€å†™æ˜ŸæœŸåç§° Thu %A æ˜ŸæœŸåç§°å…¨ç¨‹ Thursday %b ç®€å†™æœˆä»½åç§° Aug %B æœˆä»½åç§°å…¨ç¨‹ August %c æ—¥æœŸå’Œæ—¶é—´ Thu Aug 23 15:35:46 2014 %C ä¸¤ä½æ•°è¡¨ç¤ºå¹´ä»½ 2014è¾“å‡º14 %Y å››ä½æ•°è¡¨ç¤ºå¹´ä»½ 2014 %D MM&#x2F;DD&#x2F;YYæ ¼å¼çš„æ—¥æœŸ 08&#x2F;23&#x2F;14 %m æœˆä»½ï¼ˆ01-12ï¼‰ 11 %d å¤©ï¼ˆ01-31ï¼‰ 29 %H 24å°æ—¶åˆ¶çš„å°æ—¶(00-23) 23 %I 12å°æ—¶åˆ¶çš„å°æ—¶(01-12) 11 %M åˆ†é’Ÿï¼ˆ00-59ï¼‰ 59 %S ç§’ï¼ˆ00-59ï¼‰ 58 %e æ¯«ç§’ 678 %f å¾®å¦™ 056789 %F çº³ç§’ 256789123 %p AM&#x2F;PM AM %r 12å°æ—¶åˆ¶æ—¶é—´ 02:55:02 PM %R 24å°æ—¶åˆ¶æ—¶é—´ï¼Œç­‰åŒäº %H:%M 23:55 %Tæˆ–%X ISO 8601æ—¶é—´æ ¼å¼ï¼Œç­‰åŒäº%H:%M:%S 23:55:59 %z ISO 8601æ—¶é—´æ ¼å¼ï¼Œæ—¶åŒºåç§» ([+&#x2F;-]HH:MM) å¦‚ä¸­å›½æ˜¯ä¸œ8åŒºï¼Œ+08:00 %E æ—¶é—´æˆ³ 1528834770 %% è¾“å‡º% % %+ spdlogé»˜è®¤æ ¼å¼ [2014-10-31 23:46:59.678] [mylogger] [info] Some message %^ å¼€å§‹é¢œè‰²æ ‡è®°ï¼ˆåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼‰ [mylogger] [info(green)] Some message %$ ç»“æŸé¢œè‰²æ ‡è®°(å¦‚%^[+++]%$ %v) (åªèƒ½ä½¿ç”¨ä¸€æ¬¡) [+++] Some message %@ æºæ–‡ä»¶è·¯å¾„å’Œæ‰€åœ¨è¡Œæ•°ï¼Œç­‰åŒäº%g:%# &#x2F;some&#x2F;dir&#x2F;my_file.cpp:123 %s æºæ–‡ä»¶å my_file.cpp %g æºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œç­‰åŒäº__FILE__å® &#x2F;some&#x2F;dir&#x2F;my_file.cpp %# æºç æ‰€åœ¨è¡Œæ•° 123 %! æºç æ‰€åœ¨å‡½æ•°å my_func %o ä¸ä¸Šæ¡æ—¥å¿—çš„é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ 456 %i ä¸ä¸Šæ¡æ—¥å¿—çš„é—´éš”æ—¶é—´ï¼ˆå¾®ç§’ï¼‰ 456 %u ä¸ä¸Šæ¡æ—¥å¿—çš„é—´éš”æ—¶é—´ï¼ˆçº³ç§’ï¼‰ 11456 %O ä¸ä¸Šæ¡æ—¥å¿—çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ 4 ä½¿ç”¨ç¤ºä¾‹ï¼š 12auto file_sink = std::make_shared&lt;spdlog::sinks::rotating_file_sink_mt&gt;(&quot;logs/app.log&quot;, 1048576, 7);file_sink-&gt;set_pattern(&quot;%Y-%m-%d %H:%M:%S.%e %z %-10n %-8l [%P %t] %v&quot;); è¾“å‡ºæ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š 12023-12-21 09:34:45.691 +08:00 Dock1703122417075610 info [15460 6948] this is log text æºç ä½ç½®æ ‡è®°å¦‚æœéœ€è¦ä½¿ç”¨æºç ä½ç½®æ ‡è®°ï¼Œå¦‚%s, %g, %#, %!ï¼Œéœ€è¦åœ¨åŒ…å«spdlogå¤´æ–‡ä»¶ä¹‹å‰ï¼Œå®šä¹‰å¦‚ä¸‹å®ï¼š 1#define SPDLOG_ACTIVE_LEVEL SPDLOG_LEVEL_TRACE 3.2 å¯¹é½æ¯ä¸ªæ ¼å¼æ ‡è®°å¯ä»¥é€šè¿‡é¢„å…ˆæ·»åŠ å®½åº¦æ ‡è®°æ¥å®ç°å¯¹é½ã€‚ ä½¿ç”¨-ï¼ˆå·¦å¯¹é½ï¼‰æˆ–=ï¼ˆä¸­é—´å¯¹é½ï¼‰æ§åˆ¶å¯¹é½æ–¹å‘ï¼š å¯¹é½ å«ä¹‰ ç¤ºä¾‹ ç»“æœ % å³å¯¹é½ %8l â€œ infoâ€ %- å·¦å¯¹é½ %-8l â€œinfo â€œ %&#x3D; ä¸­é—´å¯¹é½ %&#x3D;8l â€œ info â€œ 3.3 æˆªæ–­è¿˜å¯ä»¥é€šè¿‡æ·»åŠ !æ ‡è®°æ¥è¿›è¡Œæ•°æ®æˆªæ–­ï¼Œå¦‚æœå®½åº¦è¶…è¿‡æŒ‡å®šçš„å®½åº¦ï¼Œåˆ™æˆªæ–­ç»“æœï¼š å¯¹é½ å«ä¹‰ ç¤ºä¾‹ ç»“æœ %! å³å¯¹é½å¹¶é•¿åº¦è¶…è¿‡3ä¸ªåæˆªæ–­ %3!l â€œinfâ€ %-! å·¦å¯¹é½å¹¶é•¿åº¦è¶…è¿‡2ä¸ªåæˆªæ–­ %-2!l â€œinâ€ %&#x3D;! ä¸­é—´å¯¹é½å¹¶é•¿åº¦è¶…è¿‡1ä¸ªåæˆªæ–­ %&#x3D;1!l â€œiâ€ å››ã€è¾“å‡ºç­–ç•¥(Flush policy)åŸºäºæ€§èƒ½è€ƒè™‘ï¼Œspdlogä¸ä¼šç«‹å³è¾“å‡ºæ—¥å¿—ï¼Œè€Œæ˜¯åœ¨å†…éƒ¨é€šè¿‡æ—¥å¿—é˜Ÿåˆ—çš„æ–¹å¼ç¼“å­˜æ—¥å¿—ï¼Œåœ¨åˆé€‚çš„æ—¶å€™è¿›è¡Œæ‰¹é‡è¾“å‡ºã€‚ å¦‚æœéœ€è¦è®©spdlogç«‹å³è¾“å‡ºé˜Ÿåˆ—ä¸­çš„æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‡ ç§æ–¹å¼å®ç°ã€‚ 4.1 æ‰‹åŠ¨æ“ä½œæˆ‘ä»¬å¯ä»¥å•ç‹¬è°ƒç”¨Sinkçš„flushå‡½æ•°ç«‹å³è¾“å‡ºé˜Ÿåˆ—ä¸­çš„æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨Loggerå¯¹è±¡çš„flushå‡½æ•°è®©è¯¥å¯¹è±¡ä¸‹çš„æ‰€æœ‰sinkç«‹å³è¾“å‡ºã€‚ å¦‚æœæ˜¯å¼‚æ­¥æ—¥å¿—ï¼Œè°ƒç”¨flushå‡½æ•°åªä¼šç»™æ—¥å¿—é˜Ÿåˆ—å‘é€ä¸€ä¸ªflushæ¶ˆæ¯ï¼Œä¸ä¼šç«‹å³åˆ·æ–°ã€‚ åœ¨ç¨‹åºé€€å‡ºå‰ï¼Œspdlogä¼šç¡®ä¿é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ—¥å¿—éƒ½è¾“å‡ºå®Œæˆã€‚å¦‚æœæƒ³æ‰‹åŠ¨ç¡®ä¿æ‰€æœ‰æ—¥å¿—è¾“å‡ºå®Œæˆåé€€å‡ºç¨‹åºï¼Œå¯ä»¥è°ƒç”¨spdlog::shutdown()å‡½æ•°ã€‚ 4.2 åŸºäºæ—¥å¿—ç­‰çº§çš„è¾“å‡ºæ‚¨å¯ä»¥è®¾ç½®å°†è§¦å‘è‡ªåŠ¨è¾“å‡ºçš„æœ€ä½æ—¥å¿—çº§åˆ«ã€‚ä¾‹å¦‚ï¼Œæ¯å½“è®°å½•é”™è¯¯æˆ–æ›´ä¸¥é‡çš„æ¶ˆæ¯æ—¶ï¼Œè¿™å°†è§¦å‘ç«‹å³è¾“å‡ºï¼š 1my_logger-&gt;flush_on(spdlog::level::err); 4.3 å®šæ—¶è¾“å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„Loggeræ¯5ç§’çš„å®šæœŸè¾“å‡ºï¼š 1spdlog::flush_every(std::chrono::seconds(5)); è¿™ç§æ–¹å¼åªèƒ½ä½¿ç”¨åœ¨çº¿ç¨‹å®‰å…¨çš„sinkä¸Šï¼ˆå³_mtåç¼€ï¼‰ï¼Œå› ä¸ºå®šæ—¶è¾“å‡ºä»»åŠ¡æ‰§è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸Šã€‚ äº”ã€å¼‚å¸¸spdlogåœ¨å…¶æ–‡æ¡£ä¸­å…³äºå¼‚å¸¸çš„è¯´æ˜ï¼Œspdlogåªä¼šåœ¨æ„é€ Loggerå’ŒSinké”™è¯¯æ—¶ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºspdlogè®¤ä¸ºè¿™ä¸ªé”™è¯¯æ˜¯è‡´å‘½çš„ï¼Œä½†è¿™ä¸ªå¹¶ä¸å¯ä¿¡ï¼Œæœ€å¤šåªèƒ½è®¤ä¸ºspdlogåœ¨å…¶ä»–æƒ…å†µä¸‹ä¸ä¼šä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œä½†ä¸èƒ½ä¿è¯å…¶ä¾èµ–çš„åº“ï¼ˆå¦‚fmtï¼‰ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ è€Œä¸”å¦‚æœå¤šä¸ªè¿›ç¨‹å‘åŒä¸€ä¸ªæ–‡ä»¶å†™å…¥æ—¥å¿—ï¼Œå½“æ–‡ä»¶è¾¾åˆ°æœ€å¤§å¤§å°æ—¶ï¼Œspdlogä¼šè‡ªåŠ¨é‡å‘½åå½“å‰æ–‡ä»¶ï¼Œå¹¶æ–°å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æœå¤šä¸ªè¿›ç¨‹å‘åŒä¸€ä¸ªæ–‡ä»¶å†™å…¥æ—¥å¿—ï¼Œä¼šå¯¼è‡´é‡å‘½åæ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼Œsplogä¼šå°†è¯¥å¤±è´¥è®¤ä¸ºæ˜¯è‡´å‘½é”™è¯¯ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœåœ¨æ‰“å°æ—¥å¿—æ—¶å‡ºç°äº†spdlogèƒ½å¤Ÿé¢„æ–™çš„é”™è¯¯ï¼ˆéé¢„æ–™çš„åŠä¸‰æ–¹åº“æŠ›å‡ºçš„å¼‚å¸¸ä»ç„¶ä¼šä¼ é€’åˆ°å¤–éƒ¨ï¼‰ï¼Œspdlogé»˜è®¤å°†å‘stderræ‰“å°é”™è¯¯æ¶ˆæ¯ï¼Œä¸ºäº†é¿å…é”™è¯¯æ¶ˆæ¯å……æ–¥å±å¹•ï¼Œæ¯ä¸ªLoggerçš„é”™è¯¯æ¶ˆæ¯è¾“å‡ºé€Ÿç‡é™åˆ¶ä¸º1æ¡æ¶ˆæ¯&#x2F;åˆ†é’Ÿã€‚ spdlogæä¾›äº†é”™è¯¯å¤„ç†æ–¹æ³•ï¼Œæ¥è®©ç”¨æˆ·è‡ªå®šä¹‰å¦‚ä½•å¤„ç†é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡set_error_handlerå‡½æ•°æ¥è‡ªå®šä¹‰é”™è¯¯å¤„ç†æ–¹æ³•ï¼š 123456789// å…¨å±€ä¸ºæ¯ä¸ªLoggeræ³¨å†Œé”™è¯¯å¤„ç†æ–¹æ³•spdlog::set_error_handler([](const std::string&amp; msg) &#123; std::cerr &lt;&lt; &quot;my err handler: &quot; &lt;&lt; msg &lt;&lt; std::endl;&#125;);// åˆ†åˆ«ä¸ºç‰¹å®šçš„Loggeræ³¨å†Œé”™è¯¯å¤„ç†æ–¹æ³•critical_logger-&gt;set_error_handler([](const std::string&amp; msg) &#123; throw std::runtime_error(msg);&#125;); spdlogä¸æ˜¯å¼‚å¸¸å®‰å…¨çš„ï¼Œåœ¨ä½¿ç”¨spdlogæ—¶ä¸€å®šè¦æ³¨æ„å¼‚å¸¸æ•è·ï¼Œå¦åˆ™å¯èƒ½å› ä¸ºä¸€ä¸ªæ ¼å¼åŒ–æ ‡è®°å†™é”™å¯¼è‡´ç¨‹åºå´©æºƒï¼Œæœ¬æ¥æ˜¯æƒ³é€šè¿‡æ—¥å¿—æ¥æ’é™¤é—®é¢˜çš„ï¼Œç»“æœå´å› ä¸ºæ—¥å¿—å¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¦‚ï¼š 12// å¯¼è‡´ç¨‹åºå´©æºƒlogger-&gt;error(&quot;create device enumerator failed, hr: &#123;#x&#125;&quot;, hr); å…­ã€å®½çª„å­—ç¬¦spdlogå†…éƒ¨å°†å­—ç¬¦ä½œä¸ºcharç±»å‹å¤„ç†ï¼Œå¦‚æœéœ€è¦è¾“å‡ºwchar_tç±»å‹çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸ºcharç±»å‹ï¼Œspdlogä»…å°†charç±»å‹å­—ç¬¦ä¸²åŸæ ·è¾“å‡ºï¼Œä¸åšå­—ç¬¦ç¼–ç åˆ¤æ–­å’Œå¤„ç†ï¼Œéœ€è¦è°ƒç”¨è€…æ¥è§‰å¾—å­—ç¬¦ä¸²çš„ç¼–ç ï¼Œå»ºè®®ç»Ÿä¸€æ—¥å¿—å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼ä¸ºUTF-8æˆ–ANSIã€‚ ä¸ƒã€æ—¥å¿—æ ¼å¼spdlogæ—¥å¿—å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–å¤„ç†ä½¿ç”¨çš„æ˜¯å¼€æºfmtåº“ï¼Œå…¶è¯¦ç»†è¯­æ³•è§ï¼šFormat String Syntaxã€‚ ä¸‹é¢åˆ—ä¸¾äº†å¸¸ç”¨çš„æ—¥å¿—æ ¼å¼åŒ–æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869logger-&gt;info(&quot;è¾“å‡ºcharå­—ç¬¦ä¸²:&#123;&#125;&quot;, &quot;hello&quot;);// è¾“å‡ºcharå­—ç¬¦ä¸²:hellologger-&gt;info(&quot;è¾“å‡ºstd::string:&#123;&#125;&quot;, std::string(&quot;hello&quot;));// è¾“å‡ºstd::string:hello/** è¾“å‡ºæœ€å°é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœé•¿åº¦ä¸è¶³åˆ™ç”¨å›ºå®šå­—ç¬¦å¡«å……ï¼Œä½†è¶…å‡ºä¸ä¼šæˆªæ–­å­—ç¬¦ä¸²*/logger-&gt;info(&quot;è¾“å‡ºå·¦å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……):&#123;:&lt;10&#125;&quot;, &quot;hello&quot;);// è¾“å‡ºå·¦å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……):hello logger-&gt;info(&quot;è¾“å‡ºå·¦å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10):&#123;:&lt;10&#125;&quot;, &quot;hello my world&quot;);// è¾“å‡ºå·¦å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10):hello my worldlogger-&gt;info(&quot;è¾“å‡ºå³å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……):&#123;:&gt;10&#125;&quot;, &quot;hello&quot;);// è¾“å‡ºå³å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……): hellologger-&gt;info(&quot;è¾“å‡ºå±…ä¸­å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……):&#123;:^10&#125;&quot;, &quot;hello&quot;);// è¾“å‡ºå±…ä¸­å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œç©ºæ ¼å¡«å……): hello logger-&gt;info(&quot;è¾“å‡ºå±…ä¸­å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œ*å¡«å……):&#123;:*^10&#125;&quot;, &quot;hello&quot;);// è¾“å‡ºå±…ä¸­å¯¹é½å­—ç¬¦ä¸²(æœ€å°é•¿åº¦10ï¼Œ*å¡«å……):**hello***logger-&gt;info(&quot;è¾“å‡ºæ•´å‹:&#123;&#125;&quot;, 1234);// è¾“å‡ºæ•´å‹:1234logger-&gt;info(&quot;è¾“å‡ºå¸ƒå°”ç±»å‹:&#123;&#125;&quot;, true);// è¾“å‡ºå¸ƒå°”ç±»å‹:truelogger-&gt;info(&quot;è¾“å‡ºfloat:&#123;&#125;&quot;, 3.1415936f);// è¾“å‡ºfloat:3.1415937logger-&gt;info(&quot;è¾“å‡ºdouble:&#123;&#125;&quot;, 3.1415936);// è¾“å‡ºdouble:3.1415936/** è¾“å‡ºæœ€å°ä½æ•°ï¼ˆå«å°æ•°ç‚¹ï¼‰çš„æµ®ç‚¹å‹* å°æ•°ç‚¹å‰éƒ¨çš„æœ€å°ä½æ•°=æ€»ä½æ•°-åéƒ¨å›ºå®šä½æ•°-1ï¼Œä½æ•°ä¸è¶³é»˜è®¤å¡«å……ç©ºæ ¼ï¼Œè¶…è¿‡ä¸æˆªæ–­ï¼›* å°æ•°ç‚¹åéƒ¨çš„ä½æ•°å§‹ç»ˆå›ºå®šï¼Œä½æ•°ä¸è¶³åˆ™åœ¨å°¾éƒ¨æ·»åŠ 0ï¼Œè¶…å‡ºåˆ™å››èˆäº”å…¥åæˆªæ–­ï¼›*/logger-&gt;info(&quot;è¾“å‡ºæµ®ç‚¹å‹(å«å°æ•°ç‚¹æœ€å°ä½æ•°6ä½ï¼ˆå·¦è¾¹å¡«å……ç©ºæ ¼ï¼‰ï¼Œå°æ•°ç‚¹åå§‹ç»ˆ3ä½):&#123;:6.3f&#125;&quot;, 3.1415936);// è¾“å‡ºæµ®ç‚¹å‹(å«å°æ•°ç‚¹æœ€å°ä½æ•°6ä½ï¼ˆå·¦è¾¹å¡«å……ç©ºæ ¼ï¼‰ï¼Œå°æ•°ç‚¹åå§‹ç»ˆ3ä½): 3.142logger-&gt;info(&quot;è¾“å‡ºæµ®ç‚¹å‹(å«å°æ•°ç‚¹æœ€å°ä½æ•°6ä½ï¼ˆå·¦è¾¹å¡«å……ç©ºæ ¼ï¼‰ï¼Œå°æ•°ç‚¹åå§‹ç»ˆ3ä½):&#123;:6.2f&#125;&quot;, 31415926.1);// è¾“å‡ºæµ®ç‚¹å‹(å«å°æ•°ç‚¹æœ€å°ä½æ•°6ä½ï¼ˆå·¦è¾¹å¡«å……ç©ºæ ¼ï¼‰ï¼Œå°æ•°ç‚¹åå§‹ç»ˆ3ä½):31415926.10logger-&gt;info(&quot;è¾“å‡ºå°å†™åå…­è¿›åˆ¶:&#123;:x&#125;&quot;, 123);// è¾“å‡ºå°å†™åå…­è¿›åˆ¶:7blogger-&gt;info(&quot;è¾“å‡ºå¤§å†™åå…­è¿›åˆ¶:&#123;:X&#125;&quot;, 123);// è¾“å‡ºå¤§å†™åå…­è¿›åˆ¶:7Blogger-&gt;info(&quot;è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€):&#123;:#x&#125;&quot;, 123);// è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€):0x7blogger-&gt;info(&quot;è¾“å‡ºå¤§å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€):&#123;:#X&#125;&quot;, 123);// è¾“å‡ºå¤§å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€):0X7Blogger-&gt;info(&quot;è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å›ºå®š8ä½ï¼Œä¸è¶³è¡¥0):&#123;:08x&#125;&quot;, 123);// è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å›ºå®š8ä½ï¼Œä¸è¶³è¡¥0):0000007blogger-&gt;info(&quot;è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€ï¼Œå›ºå®š8ä½ï¼Œä¸è¶³è¡¥0):&#123;:#010x&#125;&quot;, 123);// è¾“å‡ºå°å†™åå…­è¿›åˆ¶(å¸¦0xå‰ç¼€ï¼Œå›ºå®š8ä½ï¼Œä¸è¶³è¡¥0):0x0000007bHRESULT hr = E_FAIL;logger-&gt;info(&quot;è¾“å‡ºHRESULT:&#123;:#010x&#125;&quot;, (unsigned long)hr);// è¾“å‡ºHRESULT:0x80004005","tags":["æ—¥å¿—"],"categories":["å¼€æºåº“"]},{"title":"C/C++ä¸åŒæ•´æ•°ç±»å‹çš„åŒºåˆ«","path":"/post/2418701368.html","content":"åœ¨C&#x2F;C++ä¸­æ¶‰åŠçš„æ•´æ•°ç›¸å…³çš„ç±»å‹å¤§è‡´æœ‰å¦‚ä¸‹å‡ ç§ï¼š charã€unsigned char shortã€unsigned short intã€unsigned int longã€unsigned long long longã€unsigned long long int8_tã€uint8_t int32_tã€uint32_t int64_tã€uint64_t DWORD DWORD32ã€DWORD64 size_tã€ssize_t SIZE_Tã€SSIZE_T ä¸€ã€åŸç”Ÿæ•°æ®ç±»å‹ä»¥ä¸‹æ•°æ®ç±»å‹C&#x2F;C++è¯­è¨€ä¸­çš„åŸç”Ÿæ•´æ•°ç±»å‹ï¼Œå…¶é•¿åº¦å–å†³äºæ‰€ä½¿ç”¨çš„è®¡ç®—æœºç³»ç»Ÿå’Œç¼–è¯‘å™¨ï¼š shortã€unsigned short intã€unsigned int longã€unsigned long long longã€unsigned long long å¦‚æœéœ€è¦å¼€å‘è·¨å¹³å°çš„ã€å…·æœ‰è‰¯å¥½å¯ç§»æ¤æ€§çš„ç¨‹åºï¼Œè¯·ä¸è¦ä½¿ç”¨è¿™äº›æ•°æ®ç±»å‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›æ•°æ®ç±»å‹æ‰€å å­—èŠ‚æ•°å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ•°æ®ç±»å‹ å­—èŠ‚æ•° èŒƒå›´ char 1 -128 ~ 127 unsigned char 1 0 ~ 255 short 2 -32,768 ~ 32,767 unsigned short 2 0 ~ 65,535 int 4 -2,147,483,648 ~ 2,147,483,647 unsigned int 0 0 ~ 4,294,967,295 long 4 -2,147,483,648 ~ 2,147,483,647 unsigned long 4 0 ~ 4,294,967,295 long long 8 -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807 unsigned long long 8 0 ~ 18,446,744,073,709,551,615 äºŒã€int*_tæ•°æ®ç±»å‹int*_tæ ¼å¼çš„æ•°æ®ç±»å‹æ˜¯ä½¿ç”¨typedefé‡æ–°å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚é€šè¿‡åœ¨ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒè¿›è¡Œé‡å®šä¹‰ï¼Œç¡®ä¿å…¶æ‰€å ç”¨çš„å­—èŠ‚æ•°å§‹ç»ˆç›¸åŒï¼ˆå³æ•°æ®èŒƒå›´ä¹Ÿç›¸åŒï¼‰ã€‚ é€‚åˆç”¨æ¥å¼€å‘è·¨å¹³å°çš„ç¨‹åºã€‚ æ•°æ®ç±»å‹ å­—èŠ‚æ•° èŒƒå›´ int8_t 1 -128 ~ 127 uint8_t 1 0 ~ 255 int32_t 4 -2,147,483,648 ~ 2,147,483,647 uint32_t 4 0 ~ 4,294,967,295 int64_t 8 -9,223,372,036,854,775,808 ~ 9,223,372,036,854,775,807 uint64_t 8 0 ~ 18,446,744,073,709,551,615 ä¸‰ã€size_tå’Œstd::size_tsize_tå’Œstd::size_tæ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œsize_tæ˜¯å®šä¹‰åœ¨Cè¯­è¨€çš„å¤´æ–‡ä»¶ï¼Œè€Œstd::size_tå®šä¹‰åœ¨C++æ ‡å‡†åº“çš„&lt;cstddef&gt;å¤´æ–‡ä»¶ä¸­ã€‚ è™½ç„¶äºŒè€…æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä½†std::size_tåœ¨å®ç°ä¸Šå…¼å®¹size_täº†ï¼ŒäºŒè€…æ‰€å çš„å­—èŠ‚æ•°å§‹ç»ˆç›¸åŒã€‚ size_tå’Œstd::size_téƒ½æ˜¯æ— ç¬¦å·æ•´å‹ï¼Œå®ƒä»¬åœ¨32ä½ç¼–è¯‘ç¯å¢ƒå ç”¨4å­—èŠ‚ï¼Œ64ä½ç¼–è¯‘ç¯å¢ƒå 8å­—èŠ‚ã€‚ å¦‚æœéœ€è¦ä½¿ç”¨æœ‰ç¬¦å·çš„size_tç±»å‹ï¼Œåœ¨Linuxä¸Šå¯ä»¥ä½¿ç”¨ssize_tç±»å‹ï¼ŒWindowsä¸Šå¯ä»¥ä½¿ç”¨SSIZE_Tç±»å‹ã€‚ å››ã€DWORDå’ŒDWORD32ã€DWORD64DWORDæ˜¯32ä½æ— ç¬¦å·æ•´å‹ï¼ˆèŒƒå›´0 ~ 4,294,967,295ï¼‰ DWORD32ä¹Ÿæ˜¯32ä½æ— ç¬¦å·æ•´å‹ï¼ˆèŒƒå›´0 ~ 4,294,967,295ï¼‰,è€ŒDWORD64æ˜¯64ä½æ— ç¬¦å·æ•´å‹ï¼ˆèŒƒå›´0 ~ 18,446,744,073,709,551,615ï¼‰ã€‚ DWORDä¸ºä»€ä¹ˆä¸€ç›´æ˜¯32ä½æ— ç¬¦å·æ•´å‹ï¼Ÿ å¾®è½¯åœ¨è®¾è®¡ä¹‹åˆæ˜¯æ‰“ç®—è®©DWORDåœ¨ä¸åŒçš„ç¼–è¯‘ç¯å¢ƒå…·æœ‰ä¸åŒä½æ•°çš„ï¼Œä½†ä»ç›®å‰æƒ…å†µæ¥çœ‹ï¼Œè¿™ç§å¸Œæœ›å·²ç„¶ç ´ç­ï¼ŒDWORDå°†æ°¸è¿œæ˜¯32ä½çš„æ— ç¬¦å·æ•´å‹ã€‚ äº”ã€ä¸€ç‚¹ç‚¹å»ºè®®ä¸ºäº†ä¿è¯ç¨‹åºçš„å¯ç§»æ¤æ€§ï¼Œè¯·åœ¨å¼€å‘ä¸­åªä½¿ç”¨å›ºå®šå­—èŠ‚æ•°çš„æ•°æ®ç±»å‹ï¼Œå¦‚int8_tã€int32_tã€int64_tã€‚","tags":["C++"],"categories":["C++è¯­è¨€"]},{"title":"Windowsçª—å£è°ƒè¯•åˆ©å™¨-WinSpyPlus","path":"/post/1533480858.html","content":"åœ¨Windowså¹³å°è¿›è¡Œå®¢æˆ·ç«¯å¼€å‘æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šé‡åˆ°éœ€è¦è°ƒè¯•çª—å£çš„æƒ…å†µï¼Œå¦‚æŸ¥çœ‹çª—å£å¥æŸ„ã€çª—å£ä½ç½®&#x2F;å°ºå¯¸ã€ç›‘å¬çª—å£æ¶ˆæ¯ç­‰ã€‚è™½ç„¶å¾®è½¯éš Visual Stuido ä¸€åŒå‘å¸ƒäº† Microsoft Spy++ å·¥å…·ï¼Œä½†è¯¥å·¥å…·çš„åŠŸèƒ½æ›´æ–°ç¼“æ…¢ï¼Œè¿™ä¹ˆå¤šå¹´è¿‡å»äº†åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œæ¯”å¦‚ï¼š ä¸€ç›´æœªæä¾›å•ç‹¬çš„å®‰è£…åŒ…ã€‚ å¼ºåˆ¶ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨ï¼Œè™½ç„¶ä»¥ç®¡ç†å‘˜æƒé™å¯åŠ¨å¯ä»¥é¿å…å¾ˆå¤šé—®é¢˜ï¼ˆå¦‚æ— æ³•ç›‘å¬ç®¡ç†å‘˜æƒé™è¿›ç¨‹çª—å£çš„æ¶ˆæ¯ç­‰ï¼‰ï¼Œä½†è¿™è®©ç”¨æˆ·å¤±å»äº†é€‰æ‹©éç®¡ç†å‘˜çš„æƒåŠ›ã€‚ ä¸èƒ½é€šè¿‡æ ‡é¢˜æˆ–ç±»åæ¥æŸ¥æ‰¾çª—å£ã€‚ æŸ¥æ‰¾åˆ°çš„çª—å£ä¸èƒ½è‡ªåŠ¨å®šä½åˆ°çª—å£æ ‘ä¸­ã€‚ ä¸èƒ½è¿‡æ»¤æ˜¯å¦æ˜¾ç¤ºéšè—çª—å£ã€æ˜¯å¦æ˜¾ç¤ºæ— æ ‡é¢˜çª—å£ã€‚ ä¸èƒ½æŸ¥çœ‹ Message-Only çª—å£ã€‚ ä¸èƒ½å®šæ—¶å¯¼å‡ºçª—å£æ ‘åˆ°æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åšåç»­çš„å¯¹æ¯”åˆ†æã€‚ é»˜è®¤å¯åŠ¨çš„æ—¶32ä½è¿›ç¨‹ï¼Œæ— æ³•ç›‘å¬ 64 ä½è¿›ç¨‹çª—å£çš„æ¶ˆæ¯ï¼Œç›‘å¬å¤±è´¥æ—¶ä¹Ÿæœªèƒ½æç¤ºç”¨æˆ·ã€‚ æœªæä¾›å¯¹çª—å£çš„å¿«é€Ÿæ“ä½œæŒ‡ä»¤ï¼Œå¦‚æ˜¾ç¤º&#x2F;éšè—ã€æœ€å¤§åŒ–&#x2F;æœ€å°åŒ–&#x2F;è¿˜åŸã€ç½®é¡¶&#x2F;ç½®åº•ç­‰ã€‚ åŸºäº Microsoft Spy++ çš„ä»¥ä¸Šç¼ºé™·æˆ–ä¸è¶³ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ªæ¬¾ä¸ºWinSpyPlusçš„å·¥å…·ï¼Œè¯¥å·¥å…·è§£å†³äº†ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼Œè€Œä¸”åŠŸèƒ½ç‰¹æ€§è¿˜åœ¨ä¸æ–­æ‰©å……ä¸­ã€‚ ä¸‹è½½åœ°å€ Githubï¼ˆæ›´æ–°åŠæ—¶ï¼‰: https://github.com/winsoft666/winspyplus-bin å¥¶ç‰›å¿«ä¼ ï¼ˆæ›´æ–°å¯èƒ½å»¶åï¼‰ï¼š https://cowtransfer.com/s/aa5ab9c1ef2e46 è½¯ä»¶æˆªå›¾ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","categories":["Power By Me"]},{"title":"Windows APIçš„ä¸åŒè¿”å›çŠ¶æ€","path":"/post/2510508225.html","content":"åœ¨Windowsç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ¥è§¦åˆ°çš„Windows APIè¿”å›å€¼ç±»å‹æœ‰ï¼š BOOL HRESULT LSTATUS 1. é”™è¯¯ç BOOLç±»å‹é€šå¸¸æ˜¯0è¡¨ç¤ºå¤±è´¥ï¼Œé0è¡¨ç¤ºæˆåŠŸï¼Œåœ¨BOOLç±»å‹è¿”å›å¤±è´¥æ—¶ï¼Œé€šå¸¸è¿˜å¯ä»¥é€šè¿‡GetLastErrorå‡½æ•°è·å–é”™è¯¯ç ã€‚é”™è¯¯ç ä¸è°ƒç”¨çº¿ç¨‹ç›¸å…³è”ï¼Œæ¯ä¸ªçº¿ç¨‹çš„é”™è¯¯ç æ˜¯ç‹¬ç«‹çš„ï¼Œåœ¨è°ƒç”¨å®ŒWindows APIåï¼Œå¦‚ä¸‹è·å–é”™è¯¯ç ï¼Œåˆ™éœ€è¦ç«‹å³è·å–ï¼Œå¦åˆ™å¯èƒ½ä¼šè¢«åé¢è°ƒç”¨APIæ‰€è®¾ç½®çš„é”™è¯¯ç æ‰€è¦†ç›–ã€‚ åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥é€šè¿‡SetLastErrorå‡½æ•°æ¥è®¾ç½®é”™è¯¯ç ã€‚ Windows APIé€šå¸¸åœ¨æ²¡æœ‰é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå°†é”™è¯¯ç è®¾ç½®ä¸º0ï¼Œæœ‰é”™è¯¯å‘ç”Ÿæ—¶ï¼Œè§†å…·ä½“é”™è¯¯è€Œè®¾ç½®ä¸ºå…¶ä»–é0å€¼ã€‚ å¾®è½¯å®˜æ–¹æ–‡æ¡£ï¼šDebug system error codes å¸¸è§çš„é”™è¯¯ç 123ERROR_SUCCESS = 0 // æˆåŠŸERROR_OUTOFMEMORY // å†…å­˜ä¸è¶³... 2. HRESULT2.1 HRESULTç»“æ„HRESULTæ˜¯COMè¿”å›çš„é”™è¯¯ç ï¼Œæ€»å…±32ä½ï¼Œå®ƒç”±ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ç»„æˆï¼š é«˜1ä½è¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼Œ1è¡¨ç¤ºå¤±è´¥ï¼‰ã€‚ ä¸­é—´11ä½ç¼–ç æŒ‡ç¤ºé”™è¯¯æ¥æºçš„è®¾æ–½&#x2F;è®¾å¤‡ã€‚ ä½16ä½ç¼–ç é”™è¯¯ç¼–å·ã€‚ 0~32ä½çš„ä½œç”¨åˆ†åˆ«å¦‚ä¸‹ï¼š 123456789101112131415161718S - ä¸¥é‡åº¦ - è¡¨ç¤ºæˆåŠŸ/å¤±è´¥ 0 - æˆåŠŸ 1 - å¤±è´¥ (COERROR)R - reserved portion of the facility code, corresponds to NT&#x27;s second severity bit.C - reserved portion of the facility code, corresponds to NT&#x27;s C field.N - reserved portion of the facility code. Used to indicate a mapped NT status value.r - reserved portion of the facility code. Reserved for internal use. Used to indicate HRESULT values that are not status values, but are instead message ids for display strings.Facility - è®¾å¤‡/è®¾æ–½ç Code - è®¾å¤‡/è®¾æ–½çš„çŠ¶æ€ç  åœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸éœ€è¦å…³å¿ƒå…¶æ¯ä¸€ä½çš„å…·ä½“ä½œç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨æ›´å¤šçš„æ˜¯ä¸‹é¢çš„å‡ ä¸ªå®ï¼š ä½¿ç”¨SUCCEEDED(hr)å®åˆ¤æ–­æ˜¯å¦æˆåŠŸï¼ˆå³hr&gt;&#x3D; 0ï¼‰ï¼ŒFAILED(hr)åˆ¤æ–­æ˜¯å¦å¤±è´¥(å³hr&lt; 0)ã€‚ ä½¿ç”¨HRESULT_CODE(hr)å®è·å–é”™è¯¯ç ã€‚ ä½¿ç”¨HRESULT_FACILITY(hr)å®è·å–è®¾å¤‡ç ã€‚ 4å­—èŠ‚ï¼ˆ32ä½ï¼‰æ•´æ•°èƒ½è¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•°ä¸º7FFF FFFFFï¼ˆæœ€é«˜ä½ä¸º0ï¼‰ï¼Œå½“æœ€é«˜ä½ä¸º1æ—¶ï¼Œåˆ™ä¸ºè´Ÿæ•°ã€‚æ‰€ä»¥HRESULTèƒ½é€šè¿‡æ˜¯å¦ä¸ºè´Ÿæ•°æ¥åˆ¤æ–­æˆåŠŸä¸å¦ã€‚ 2.2 å¸¸è§çš„HRESULTå€¼123S_OK // æˆåŠŸS_FALSE // å¤±è´¥E_FAIL // å¤±è´¥ 2.3 APIé”™è¯¯ç ä¸HRESULTæˆ‘ä»¬å¯ä»¥ä½¿ç”¨HRESULT_FROM_WIN32å®å°†ä¸Šä¸€èŠ‚ä»‹ç»çš„â€œWindows APIçš„é”™è¯¯ç â€è½¬æˆHRESULTã€‚ 3. LSTATUSåœ¨Windows APIä¸­å¯¹LSTATUSçš„å®šä¹‰æ¯”è¾ƒæ¨¡ç³Šï¼Œæ¯”å¦‚æ³¨å†Œè¡¨APIï¼ˆå¦‚RegCreateExç­‰ï¼‰è¿”å›çš„LSTATUSå®é™…å°±æ˜¯ç¬¬ä¸€èŠ‚ä»‹ç»çš„Windowsé”™è¯¯ç ã€‚ æ‰€ä»¥å½“é‡åˆ°è¿”å›LSTATUSç±»å‹çš„APIæ—¶ï¼Œéœ€è¦å‚è€ƒAPIçš„æ–‡æ¡£è¯´æ˜ã€‚","tags":["Windows"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Qtè‡ªå®šä¹‰å’Œç¾åŒ–èœå•","path":"/post/711494356.html","content":"åœ¨Qtä¸­å¯ä»¥é€šè¿‡QSSå¯¹èœå•è¿›è¡Œæ ·å¼è®¾ç½®ï¼Œè€Œä¸”å¯¹äºéæ ‡å‡†èœå•é¡¹æˆ‘ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰Widgetçš„æ–¹æ³•æ¥å®ç°ï¼Œæœ¬æ–‡è®²è¿°åœ¨Qtä¸­QMenuçš„ä½¿ç”¨æ–¹æ³•ã€‚ ä¸€ã€èœå•åŸºæœ¬ä½¿ç”¨ä¸‹é¢ç¤ºä¾‹æ¼”ç¤ºäº†å³é”®èœå•çš„åˆ›å»ºæ–¹æ³•ï¼Œè¯¥èœå•åŒ…å«äº†å›¾æ ‡ã€é€‰ä¸­&#x2F;æœªé€‰ä¸­çŠ¶æ€ã€äºŒçº§èœå•ã€äº’æ–¥é€‰æ‹©ç­‰å¸¸ç”¨èœå•ç‰¹æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960QIcon settingIcon(&quot;:/MenuBeauty/setting.png&quot;);// å®šä¹‰ActionsQAction* action1 = new QAction(&quot;åŠ¨ä½œ1&quot;);QAction* action2 = new QAction(settingIcon, &quot;åŠ¨ä½œ2 æœ‰å›¾æ ‡&quot;);QAction* action3 = new QAction(&quot;åŠ¨ä½œ3 [æœªé€‰ä¸­]&quot;);action3-&gt;setCheckable(true);action3-&gt;setChecked(false);connect(action3, &amp;QAction::triggered, this, [action3](bool checked) &#123; action3-&gt;setText(checked ? &quot;åŠ¨ä½œ3 [é€‰ä¸­]&quot; : &quot;åŠ¨ä½œ3 [æœªé€‰ä¸­]&quot;);&#125;);QAction* action4 = new QAction(&quot;Action4 åŠ¨ä½œå››æµ‹è¯•&quot;);QAction* action5 = new QAction(settingIcon, &quot;åŠ¨ä½œ5 ç¦ç”¨&quot;);action5-&gt;setEnabled(false);QAction* action6 = new QAction(settingIcon, &quot;åŠ¨ä½œ6 å­èœå•&quot;);&#123; // åŠ¨ä½œ6çš„å­åŠ¨ä½œ QAction* action6_1 = new QAction(&quot;åŠ¨ä½œ6.1&quot;); action6_1-&gt;setCheckable(true); QAction* action6_2 = new QAction(&quot;åŠ¨ä½œ6.1&quot;); action6_2-&gt;setCheckable(true); QAction* action6_3 = new QAction(&quot;åŠ¨ä½œ6.1&quot;); action6_3-&gt;setCheckable(true); // åŠ¨ä½œ6çš„å­èœå• QMenu* action6SubMenu = new QMenu(this); action6SubMenu-&gt;addAction(action6_1); action6SubMenu-&gt;addAction(action6_2); action6SubMenu-&gt;addAction(action6_3); // äº’æ–¥å­èœå•é¡¹ï¼ŒåŒæ—¶åªèƒ½é€‰æ‹©ä¸€ä¸ª QActionGroup* action6Group = new QActionGroup(this); action6Group-&gt;setExclusive(true); action6Group-&gt;addAction(action6_1); action6Group-&gt;addAction(action6_2); action6Group-&gt;addAction(action6_3); action6-&gt;setMenu(action6SubMenu);&#125;// å®šä¹‰èœå•QMenu* menu = new QMenu(this);// æ·»åŠ Actionmenu-&gt;addActions(&#123;action1, action2, action3&#125;);menu-&gt;addSeparator();menu-&gt;addActions(&#123;action4, action5, action6&#125;);// é¼ æ ‡å³é”®å¼¹å‡ºèœå•this-&gt;setContextMenuPolicy(Qt::CustomContextMenu);connect(this, &amp;QWidget::customContextMenuRequested, this, [this, menu](const QPoint&amp; pos) &#123; menu-&gt;exec(this-&gt;mapToGlobal(pos));&#125;); ä¸Šè¿°èœå•æœªç»è¿‡ä»»ä½•ç¾åŒ–ï¼Œæ ·å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äºŒã€ä½¿ç”¨QSSç¾åŒ–èœå•ç°åœ¨æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹QSSå¯¹ä¸Šé¢åˆ›å»ºçš„èœå•è¿›è¡Œç¾åŒ–ï¼Œå¯ä»¥ç¾åŒ–çš„é¡¹åŒ…å«èƒŒæ™¯ã€æ–‡æœ¬é¢œè‰²ã€è¾¹è·ã€å›¾æ ‡ç­‰ã€‚ ä¸ºäº†ä½¿å¤§å®¶ä¸è¢«é¢œè‰²å€¼æ‰€å›°æ‰°ï¼Œä¸‹é¢QSSä¸­çš„é¢œè‰²ç»Ÿä¸€ä½¿ç”¨é¢œè‰²åç§°è¡¨ç¤ºã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172/* èœå•çš„å±æ€§ */QMenu &#123; border: 1px solod red; /* åœ†è§’ç”Ÿæ•ˆçš„å‰ææ˜¯èœå•çª—å£èƒŒæ™¯é€æ˜ */ border-radius: 10px; background-color: blue; font-size: 14px; font-family: &quot;Microsoft YaHei&quot;; /* è®¾ç½®èœå•é¡¹æœ€å°å®½åº¦ï¼Œæ­¤å¤„æœ‰bugï¼šè™½å¯è‡ªåŠ¨å¢é•¿ä½†å®é™…å®½åº¦æ¯”æ‰€éœ€å®½åº¦å° */ min-width: 160px; /* èœå•å†…å®¹ä¸Šä¸‹è¾¹è·ä¸º10pxï¼Œé¢„ç•™åœ†è§’åŒºåŸŸ */ padding: 10px 0px 10px 0px;&#125;/* èœå•é¡¹çš„å±æ€§ */QMenu::item &#123; border: none; background-color: transparent; color: white; /* è®¾ç½®èœå•é¡¹æœ€å°é«˜åº¦ï¼Œå¯ä»¥è®©èœå•é¡¹çš„é«˜é€‚åº”å†…å®¹è‡ªåŠ¨å¢é•¿ */ min-height: 20px; /* è®¾ç½®èœå•é¡¹æœ€å°å®½åº¦ï¼Œæ­¤å¤„æœ‰bugï¼šè™½å¯è‡ªåŠ¨å¢é•¿ä½†å®é™…å®½åº¦æ¯”æ‰€éœ€å®½åº¦å° */ min-width: 160px; /* ä½¿èœå•é¡¹ä¹‹é—´åŠèœå•é¡¹å’Œå›¾æ ‡ä¹‹é—´ä¿æŒä¸€å®šé—´éš”ï¼Œè®¾ç½®ä¸Šä¸‹å·¦å³è¾¹è·ä¸º8pxï¼Œæ­¤å¤„ä¸èƒ½ç”¨margin */ padding: 8px 8px;&#125;/* èœå•é¡¹-é¼ æ ‡ç§»å…¥æ—¶çš„å±æ€§ */QMenu::item:selected &#123; background-color: green; color: black;&#125;/* èœå•é¡¹-ç¦ç”¨æ—¶çš„å±æ€§ */QMenu::item:disabled &#123; background-color: gray; color: white;&#125;/* åˆ†å‰²çº¿çš„å±æ€§ */QMenu::separator &#123; height: 1px; background-color: red; /* å·¦å³è¾¹è·ï¼š6px */ margin: 0x 6px 0px 6px;&#125;/* å›¾æ ‡çš„å±æ€§ */QMenu::icon &#123; width: 12px; height: 12px; /* å·¦è¾¹è·ï¼š12px */ margin: 0 0 0 12px;&#125;/* æŒ‡ç¤ºå™¨çš„å±æ€§ *//* è¿™é‡Œå°†äº’æ–¥å’Œéäº’æ–¥Actionçš„æŒ‡ç¤ºå™¨æ ·å¼è®¾ç½®ä¸ºä¸€æ ·çš„ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä¸ä¸€æ · */QMenu::indicator:non-exclusive:checked, QMenu::indicator:exclusive:checked &#123; width: 12px; height: 12px; /* å·¦è¾¹è·ï¼š8px */ margin: 0 0 0 8px; image: url(:/MenuBeauty/check.png);&#125;QMenu::indicator:non-exclusive:unchecked, QMenu::indicator:exclusive:unchecked &#123; width: 12px; height: 12px; /* å·¦è¾¹è·ï¼š8px */ margin: 0 0 0 8px; image: url(:/MenuBeauty/unchecked.png);&#125; ä¸ºäº†ä½¿èœå•çš„åœ†è§’ç”Ÿæ•ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç§»é™¤èœå•çš„è¾¹æ¡†ã€é˜´å½±ï¼Œå¹¶å°†èƒŒæ™¯è®¾ç½®ä¸ºé€æ˜ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345menu-&gt;setWindowFlags(action6SubMenu-&gt;windowFlags() | Qt::FramelessWindowHint | // æ— è¾¹æ¡† Qt::NoDropShadowWindowHint // ç§»é™¤ç³»ç»Ÿé˜´å½±);menu-&gt;setAttribute(Qt::WA_TranslucentBackground); // èƒŒæ™¯é€æ˜ ç¾åŒ–åçš„èœå•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š QSSç¾å¥½QMenuQMenuæ”¯æŒQSSç›’å­æ¨¡å‹ï¼Œå…¶é€šç”¨å±æ€§å¦‚ä¸‹ï¼š 12345678borderborder-radiusmarginpaddingbackgroundcolorfontborder-image QSSè¿˜å¯ä»¥å¯¹QMenuçš„å­æ§ä»¶è¿›è¡Œè®¾ç½®ï¼Œæ”¯æŒQMenuå­æ§ä»¶å¦‚ä¸‹ï¼š 1234567itemindicatorseparatorright-arrowleft-arrowscrollertearoff QMenuä¸æ”¯æŒä¼ªçŠ¶æ€ï¼Œåªæœ‰å…¶å­æ§ä»¶æ”¯æŒä¼ªçŠ¶æ€ï¼Œæ”¯æŒçš„ä¼ªçŠ¶æ€å¦‚ä¸‹ï¼š 1234defaultselectedexclusivenon-exclusive å…·ä½“çš„å­æ§ä»¶å’Œä¼ªçŠ¶æ€çš„å«ä¹‰ï¼Œå¯ä»¥å‚è€ƒ QSSåŸºæœ¬ä½¿ç”¨æ–¹æ³• æ–‡ç« ã€‚ ä¸‰ã€è‡ªå®šä¹‰èœå•é¡¹å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸Šè¿°å¸¸è§„çš„èœå•é¡¹å°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œä½†åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„èœå•é¡¹å¯èƒ½ç”±æ›´åŠ å¤æ‚çš„Widgetç»„åˆè€Œæˆï¼Œæ¯”å¦‚ä¸‹é¢æ’­æ”¾å™¨çš„èœå•ï¼š æˆ‘ä»¬å¯ä»¥ä½¿ç”¨QWidgetActionæ¥å®ç°ä¸Šè¿°èœå•æ•ˆæœï¼ŒQWidgetActionå¯ä»¥å°†ä¸€ä¸ªQWidgetæ”¾å…¥èœå•é¡¹çš„å®¹å™¨å†…ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰èœå•é¡¹ã€‚ ä¸‹é¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªåŒ…å«3ä¸ªæŒ‰é’®çš„èœå•é¡¹ï¼Œç‚¹å‡»æŒ‰é’®ä¼šå¼¹å‡ºå¯¹è¯æ¡†ï¼š 123456789101112131415161718192021QWidgetAction* action7 = new QWidgetAction(this);&#123; QWidget* widget = new QWidget(); QHBoxLayout* hl = new QHBoxLayout(widget); auto createPushButtonFn = [this](QString title) &#123; QPushButton* btn = new QPushButton(title); connect(btn, &amp;QPushButton::clicked, this, [this]() &#123; QMessageBox::information(this, &quot;Clicked&quot;, ((QPushButton*)sender())-&gt;text()); &#125;); return btn; &#125;; hl-&gt;addWidget(createPushButtonFn(&quot;Button1&quot;)); hl-&gt;addWidget(createPushButtonFn(&quot;Button2&quot;)); hl-&gt;addWidget(createPushButtonFn(&quot;Button3&quot;)); action7-&gt;setDefaultWidget(widget);&#125;menu-&gt;addAction(action7); æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨QSSå¯¹èœå•é¡¹å†…çš„æ§ä»¶è¿›è¡Œæ ·å¼è®¾ç½®ï¼Œå¦‚ï¼š 123456QMenu QPushButton &#123; border: none; border-radius: 10px; background-color: black; color: white;&#125;","tags":["Qt","QMenu"],"categories":["Qt"]},{"title":"ä¸ºä»€ä¹ˆSetParentä¼šå¤±è´¥","path":"/post/3832058229.html","content":"SetParentæ˜¯Windowsæä¾›çš„è®¾ç½®çª—å£çˆ¶çª—ä½“çš„APIï¼Œå‡½æ•°åŸå‹æ¯”è¾ƒç®€å•ï¼š 1234HWND SetParent( [in] HWND hWndChild, [in, optional] HWND hWndNewParent); æˆ‘ä»¬é€šå¸¸çš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼š 123if(!SetParent(hChild, hParent)) &#123; // Failed&#125; è¿™ç§ä½¿ç”¨æ–¹æ³•åœ¨å¤§å¤šæƒ…å†µä¸‹ä¸ä¼šå¤±è´¥ï¼Œä½†æœ‰æ—¶å´ä¼šå¤±è´¥ã€‚ç©¶å…¶åŸå› ï¼Œå…¶åœ¨å¾®è½¯å®˜æ–¹æ–‡æ¡£ä¸­å·²æœ‰è¯´æ˜SetParent Docã€‚ ç”±äºå…¼å®¹æ€§é—®é¢˜ï¼ŒSetParentå‡½æ•°ä¸ä¼šä¿®æ”¹hWndChildçª—å£çš„WS_CHILDå’ŒWS_POPUPæ ·å¼ï¼Œå› æ­¤ï¼š å¦‚æœhWndNewParentä¸ºNULLï¼Œä½ éœ€è¦åœ¨è°ƒç”¨SetParentå‡½æ•°åæ¸…é™¤WS_CHILDå¹¶è®¾ç½®WS_POPUPæ ·å¼ã€‚ å¦‚æœhWndNewParentä¸ä¸ºNULLå¹¶ä¸”hWndChildä¹‹å‰æ˜¯æ¡Œé¢çš„å­çª—å£ï¼Œä½ éœ€è¦åœ¨è°ƒç”¨SetParentå‡½æ•°å‰æ¸…é™¤WS_POPUPå¹¶è®¾ç½®WS_CHILDæ ·å¼ã€‚ æ€»ç»“ä¸Šè¿°åŸå› ï¼ŒSetParentçš„æ­£ç¡®ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324bool SetWinParent(HWND hChild, HWND hNewParent) &#123; HWND hOldParent = NULL; if (hNewParent) &#123; LONG newStyle = GetWindowLong(hChild, GWL_STYLE); newStyle &amp;= ~WS_POPUP; newStyle |= WS_CHILD; SetWindowLong(hChild, GWL_STYLE, newStyle); hOldParent = ::SetParent(hChild, hNewParent); &#125; else &#123; hOldParent = ::SetParent(hChild, hNewParent); LONG newStyle = GetWindowLong(hChild, GWL_STYLE); newStyle &amp;= ~WS_CHILD; newStyle |= WS_POPUP; SetWindowLong(hChild, GWL_STYLE, newStyle); &#125; return !!hOldParent;&#125;","tags":["çª—å£æ ·å¼"],"categories":["Windowsç¼–ç¨‹"]},{"title":"çª—å£å¦‚ä½•é€ƒè„±æ˜¾ç¤ºæ¡Œé¢æŒ‡ä»¤","path":"/post/2065788833.html","content":"åœ¨Windowsç³»ç»Ÿä¸­ï¼Œåœ¨æŒ‰ä¸‹Win+Då¿«æ·é”®ç­‰æ“ä½œæ‰§è¡Œâ€œæ˜¾ç¤ºæ¡Œé¢â€æ—¶ï¼Œä¼šå°†æ¡Œé¢ä¸Šçš„æ‰€æœ‰çª—å£éƒ½æœ€å°åŒ–åˆ°ä»»åŠ¡æ ï¼Œå†æ¬¡æŒ‰ä¸‹è¿˜åŸçª—å£ã€‚åœ¨æ˜¾ç¤ºæ¡Œé¢æ—¶ï¼Œæœ‰äº›çª—å£ä»ç„¶ä¿æŒæ˜¾ç¤ºçŠ¶æ€ï¼Œä¸è¢«æœ€å°è¯ï¼Œå³ç§°ä¹‹ä¸ºé€ƒè„±æ˜¾ç¤ºæ¡Œé¢æŒ‡ä»¤ã€‚ å®ç°é€ƒè„±æ˜¾ç¤ºæ¡Œé¢çš„æ–¹å¼æœ‰ä¸‰ç§ï¼Œæ¯ç§æ–¹å¼æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚ ä¸€ã€ç½®é¡¶çª—å£çš„æ–¹å¼é¦–å…ˆåˆ›å»º WS_EX_TOOLWINDOW é£æ ¼çš„çª—å£ï¼ŒWS_EX_TOOLWINDOWé£æ ¼çš„çª—å£ä¸ä¼šå‡ºç°åœ¨ä»»åŠ¡æ ï¼Œè€Œä¸”æŒ‰ALT+TABæ—¶ä¹Ÿä¸ä¼šæ˜¾ç¤ºï¼Œç„¶åä¸ºè¯¥çª—å£è®¾ç½®WS_EX_TOPMOSTæ ·å¼ï¼Œä½¿å…¶å§‹ç»ˆç½®é¡¶ã€‚ å¯ä»¥åœ¨åˆ›å»ºçª—å£æ—¶é€šè¿‡æ‰©å±•æ ·å¼æ¥æŒ‡å®šWS_EX_TOOLWINDOWå’ŒWS_EX_TOPMOSTæ ·å¼ï¼š 12345678910111213HWND hWnd = CreateWindowExW( WS_EX_TOOLWINDOW | WS_EX_TOPMOST, szWindowClass, szTitle, WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, nullptr, nullptr, hInstance, nullptr); ä¹Ÿå¯ä»¥å…ˆåˆ›å»ºçª—å£ï¼Œç„¶åä¿®æ”¹çª—å£æ ·å¼ï¼š 1234LONG_PTR oldStyle = GetWindowLongPtr(hWnd, GWL_EXSTYLE);oldStyle |= WS_EX_TOOLWINDOW;SetWindowLongPtr(hWnd, GWL_EXSTYLE, oldStyle); å¹¶é€šè¿‡SetWindowPoså‡½æ•°æ¥ç½®é¡¶çª—å£ï¼š 1SetWindowPos(hWnd, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOSIZE | SWP_NOMOVE); è¿™ç§æ–¹å¼å¯¹ç³»ç»Ÿçš„å…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œç»æµ‹è¯•å¯ä»¥æ”¯æŒWindows XP&#x2F;7&#x2F;8&#x2F;10&#x2F;11ç³»ç»Ÿã€‚ä½†è¿™ç§æ–¹å¼ä¼šå¯¼è‡´çª—å£ä¸€ç›´ç½®é¡¶æ˜¾ç¤ºï¼Œå¯¹äºä¸éœ€è¦ç½®é¡¶æ˜¾ç¤ºçš„çª—å£ï¼Œè¿™ç§æ–¹å¼å°±ä¸é€‚ç”¨äº†ã€‚ äºŒã€æ”¹å˜çª—å£æ‰€æœ‰è€…çš„æ–¹å¼åœ¨æ‰§è¡Œæ˜¾ç¤ºæ¡Œé¢æŒ‡ä»¤æ—¶ï¼Œæ¡Œé¢ä»ç„¶ä¼šæ˜¾ç¤ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†çª—å£çš„æ‰€æœ‰è€…è®¾ç½®ä¸ºæ¡Œé¢çª—å£ï¼Œæ¥ç¡®ä¿çª—å£ä¸å—â€œæ˜¾ç¤ºæ¡Œé¢â€æŒ‡ä»¤çš„å½±å“ã€‚ 2.1 æŸ¥æ‰¾æ¡Œé¢çª—å£åœ¨Win7åŠä¹‹å‰çš„ç³»ç»Ÿä¸­ï¼Œæ¡Œé¢çª—å£æ˜¯Program Managerçª—å£çš„å­çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è€Œåœ¨Win8åŠä»¥åçš„ç³»ç»Ÿï¼Œæ¡Œé¢çª—å£å˜æˆäº†WorkerWçª—å£çš„å­çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å› æ­¤åœ¨æŸ¥æ‰¾æ¡Œé¢çª—å£å¥æŸ„æ—¶ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„ç³»ç»Ÿç¯å¢ƒé‡‡ç”¨ä¸åŒçš„æŸ¥æ‰¾æ–¹å¼ã€‚ 123456789101112131415161718192021HWND FindShellDefViewWnd() &#123; HWND hShellDefView = nullptr; // Try Win7 and later HWND hProgmanWnd = FindWindowW(L&quot;Progman&quot;, L&quot;Program Manager&quot;); if (hProgmanWnd) &#123; hShellDefView = FindWindowExW(hProgmanWnd, NULL, L&quot;SHELLDLL_DefView&quot;, NULL); &#125; // Try &gt; Win7 if (!hShellDefView) &#123; // When this fails, then look for the WorkerW windows list to get the correct desktop list handle. HWND hDesktop = GetDesktopWindow(); HWND hWorkerW = NULL; do &#123; hWorkerW = FindWindowExW(hDesktop, hWorkerW, L&quot;WorkerW&quot;, NULL); hShellDefView = FindWindowExW(hWorkerW, NULL, L&quot;SHELLDLL_DefView&quot;, NULL); &#125; while (hShellDefView == NULL &amp;&amp; hWorkerW != NULL); &#125; return hShellDefView;&#125; 2.2 è®¾ç½®çª—å£æ‹¥æœ‰è€…ç°åœ¨æˆ‘ä»¬å°†çª—å£çš„æ‹¥æœ‰è€…è®¾ç½®ä¸ºSHELLDLL_DefViewçª—å£å³å¯é€ƒè„±æ˜¾ç¤ºæ¡Œé¢çš„æŒ‡ä»¤äº†ã€‚ 12345678bool EscapeShowDesktop(HWND hWnd) &#123; HWND hShellDefView = FindShellDefViewWnd(); if (hShellDefView) &#123; SetWindowLongPtr(hWnd, GWL_HWNDPARENT, (LONG_PTR)hShellDefView); return true; &#125; return false;&#125; éœ€è¦æ³¨æ„ï¼š é‡‡ç”¨è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å½“å‰çš„æ´»åŠ¨æ¡Œé¢å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªè¡Œä¸ºä¼šå¯¹æŸäº›Windows APIäº§ç”Ÿå½±å“ï¼Œå¦‚ä¼šå¯¼è‡´GetAsyncKeyStateå¤±æ•ˆã€‚ ä¸‰ã€ä½¿ç”¨Appbaræœºåˆ¶å®ç°Windowsæä¾›äº†APIæ¥ä½¿åº”ç”¨ç¨‹åºå…·æœ‰æ¨¡æ‹Ÿç³»ç»Ÿä»»åŠ¡æ çš„èƒ½åŠ›ï¼Œé€šå¸¸å°†æ¨¡æ‹Ÿç³»ç»Ÿä»»åŠ¡æ çš„ç¨‹åºæˆä¸ºAppbarï¼ˆapplication desktop toolbarï¼‰ã€‚Appbarçª—å£ä¸å—æ˜¾ç¤ºæ¡Œé¢æŒ‡ä»¤çš„æ§åˆ¶ï¼Œä½†è¯¥çª—å£ä¼šå’Œä»»åŠ¡æ ä¸€æ ·å æ®ä¸€éƒ¨åˆ†æ¡Œé¢å¯ç”¨ç©ºé—´ï¼Œå¯ä»¥é€šè¿‡APIæ§åˆ¶å ç”¨ç©ºé—´çš„å¤§å°å’Œä½ç½®ã€‚ å…³äºå¦‚ä½•ä½¿ç”¨Appbarçš„APIï¼Œå¯ä»¥å‚è€ƒWindowså®˜æ–¹æ–‡æ¡£:Using Application Desktop Toolbars","tags":["çª—å£æ ·å¼"],"categories":["Windowsç¼–ç¨‹"]},{"title":"è®¤è¯†Windowsé¡¶çº§(top-level)çª—å£","path":"/post/1431775047.html","content":"åœ¨Windows APIä¸­ç»å¸¸ä¼šå‡ºç°å…³äºé¡¶çº§çª—å£çš„æè¿°ï¼Œå¦‚ EnumWindowså‡½æ•°çš„è¯´æ˜ï¼š Enumerates all top-level windows on the screen by passing the handle to each window, in turn, to an application-defined callback function. EnumWindows continues until the last top-level window is enumerated or the callback function returns FALSE. é‚£ä¹ˆä»€ä¹ˆæ ·çš„çª—å£æ‰ç®—å¾—ä¸Šæ˜¯é¡¶çº§çª—å£äº†ï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æ²¡æœ‰WM_CHILDå±æ€§çš„çª—å£éƒ½å¯ä»¥ç§°ä¸ºé¡¶çº§çª—å£ã€‚","tags":["çª—å£æ ·å¼"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Qtä¸­å›¾ç‰‡æŒ‰ä¹å®«æ ¼æ¨¡å¼ç¼©æ”¾","path":"/post/333631906.html","content":"æˆ‘ä»¬åœ¨ç¼©æ”¾å›¾ç‰‡æ—¶éƒ½æœŸæœ›èƒ½ä¿æŒåŸé•¿å®½æ¯”ä¸å˜ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å›¾ç‰‡å˜å½¢ï¼Œä½†äº‹ä¸æ„¿è¿ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬æ²¡åŠæ³•ä¿æŒåŸå›¾çš„é•¿å®½æ¯”ä¸å˜ï¼Œæ¯”å¦‚éœ€è¦åœ¨ä¿æŒå›¾ç‰‡é«˜åº¦ä¸å˜çš„æƒ…å†µä¸‹ä»…æ¨ªå‘æ‹‰ä¼¸ç­‰ï¼Œæ­¤æ—¶å°±ä¼šå¯¼è‡´å›¾ç‰‡å˜å½¢ã€‚ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¹å®«æ ¼æ¨¡å¼è¿›è¡Œå›¾ç‰‡çš„ç¼©æ”¾ã€‚ ä¹å®«æ ¼æ¨¡å¼å°±æ˜¯å°†å›¾ç‰‡åˆ‡åˆ†ä¸ºä¹å—ï¼ˆä¸å¼ºåˆ¶ç­‰åˆ†ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨å›¾ç‰‡ç¼©æ”¾æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¿æŒ1ã€3ã€7ã€9å››ä¸ªé¡¶ç‚¹ä½ç½®çš„å›¾ç‰‡ä¸å˜ï¼Œå¯¹2ã€4ã€5ã€6ã€8äº”ä¸ªåŒºåŸŸè¿›è¡Œç¼©æ”¾ã€‚ 1. ä½¿ç”¨QSSå®ç°åœ¨Qtä¸­å®ç°å›¾ç‰‡æŒ‰ä¹å®«æ ¼ç¼©æ”¾æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨QSSçš„border-imageå±æ€§æ¥å®ç°ï¼Œé€šè¿‡ä¸Šä¸‹å·¦å³å››ä¸ªè¾¹æ¡†çš„å®½åº¦æˆ–é«˜åº¦æ¥è®¾ç½®1ã€3ã€7ã€9å››ä¸ªé¡¶ç‚¹çš„å¤§å°ã€‚ 12345border-image: url(:/Sample/image/NinePatchTest.png);border-left: 210px;border-top: 180px;border-right: 300px;border-bottom: 227px; ä¸ºäº†ä¾¿äºæµ‹è¯•ï¼Œæˆ‘åˆ¶ä½œäº†ä¸€ä¸ªä¹å®«æ ¼æµ‹è¯•å›¾ç‰‡ï¼ˆæ•´ä¸ªå›¾ç‰‡çš„å®½é«˜ä¸º1280*720ï¼‰ï¼š é€šè¿‡è¿™ç§æ–¹æ³•å®ç°çš„ä¹å®«æ ¼ç¼©æ”¾æœ‰ä¸€ä¸ªå¼Šç«¯ï¼š è¯¥æ–¹æ¡ˆä¼šå§‹ç»ˆä¿æŒ1ã€3ã€7ã€9å››ä¸ªåŒºåŸŸå›¾ç‰‡çš„å®½é«˜ä¸å˜ï¼Œå¦‚1å·åŒºåŸŸæ˜¯210*180ï¼Œå½“æˆ‘ä»¬å¯¹å›¾ç‰‡è¿›è¡Œæ”¾å¤§æ—¶ï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†å½“æˆ‘ä»¬ç¼©å°å›¾ç‰‡æ—¶ï¼Œç¼©å°åçš„å›¾ç‰‡å®½é«˜ä¸è¶³ä»¥å®¹çº³4ä¸ªé¡¶è§’å›¾ç‰‡æ—¶ï¼Œç¼©å°æ“ä½œå°±ä¼šå‡ºç°éé¢„æœŸçš„è¡Œä¸ºï¼Œå¯èƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™ç§å¼Šç«¯è¿˜ä¼šä½“ç°åœ¨æ”¯æŒé«˜DPIç¼©æ”¾çš„Qtç¨‹åºä¸­ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªæ”¯æŒDPIç¼©æ”¾çš„ç¨‹åºä¸­ï¼Œä¸ºå®½é«˜ä¸º640*360çš„QWidgetè®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œæˆ‘ä»¬çŸ¥é“ä¸åŒçš„ devicePixelRatio ä¼šå¯¼è‡´å®é™…æ¸²æŸ“çš„å›¾ç‰‡å®½é«˜ä¸åŒï¼Œå¦‚devicePixelRatioä¸º1æ—¶ï¼Œå›¾ç‰‡æ¸²æŸ“åŒºåŸŸä¸º640*360ï¼Œ è€ŒdevicePixelRatioä¸º2æ—¶ï¼Œå®é™…æ¸²æŸ“åŒºåŸŸä¸º1280*720ï¼Œä¸ºäº†ä¿è¯ç¨‹åºåœ¨ä¸åŒDPIçš„ç¯å¢ƒä¸‹éƒ½æœ‰æ¯”è¾ƒå¥½çš„ç•Œé¢å‘ˆç°ï¼Œæˆ‘ä»¬é€šå¸¸ç®€å•å¾—æŒ‡å®šä¸€ä¸ªå€å›¾ï¼ˆå¦‚2å€å›¾ï¼‰è®©ç¨‹åºè‡ªåŠ¨è¿›è¡Œå›¾ç‰‡ç¼©æ”¾ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨SVGæˆ–é’ˆå¯¹ä¸åŒDPIä½¿ç”¨ä¸åŒçš„å›¾ç‰‡ï¼‰ã€‚ è€Œä½¿ç”¨ border-left ç­‰å±æ€§æŒ‡å®šçš„å®½åº¦æ˜¯å›ºå®šçš„ï¼Œé¡¶ç‚¹å›¾ç‰‡æ— æ³•å‚ä¸åˆ°è‡ªåŠ¨ç¼©æ”¾ä¸­æ¥ï¼Œä»è€Œä¼šå¯¼è‡´è¿™ä¸€ DPI é€‚é…æœºåˆ¶å¤±æ•ˆã€‚ä¸‹ä¸€èŠ‚ä»‹ç»çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸€å¼Šç«¯ã€‚ 2. ä½¿ç”¨ä»£ç å®ç°ä¹å®«æ ¼ç¼©æ”¾æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨ä»£ç å®ç°å›¾ç‰‡ä¹å®«æ ¼æ¨¡å¼ç¼©æ”¾ï¼Œå®ç°åŸç†å¤§è‡´å¦‚ä¸‹ï¼š æå–ä¹ä¸ªåŒºåŸŸçš„å›¾ç‰‡ï¼Œä¿æŒ1ã€3ã€7ã€9å››ä¸ªå›¾ç‰‡ä¸å˜ï¼Œå¯¹2ã€4ã€5ã€6ã€8äº”ä¸ªåŒºåŸŸå›¾ç‰‡è¿›è¡Œç¼©æ”¾ï¼Œåˆ†åˆ«å¾—åˆ°æ–°çš„å›¾ç‰‡ï¼Œæœ€åå†å°†ä¹ä¸ªåŒºåŸŸçš„å›¾ç‰‡åˆå¹¶æˆä¸€å¼ å›¾ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°QSSæ–¹æ¡ˆçš„å¼Šç«¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–å…ˆå°†å›¾ç‰‡åœ¨ä¿æŒé•¿å®½æ¯”çš„æƒ…å†µç¼©æ”¾åˆ°ç›¸åº”å°ºå¯¸ï¼š 1QPixmap keepRatioScaledPix = src.scaled(destSize, Qt::KeepAspectRatio, Qt::SmoothTransformation); ç”±äºkeepRatioScaledPixå®é™…å°ºå¯¸è‚¯å®šä¸æˆ‘ä»¬æƒ³è¦å¾—åˆ°çš„destSizeä¸åŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æŠŠkeepRatioScaledPixå›¾ç‰‡æŒ‰ä¹å®«æ ¼æ¨¡å¼ç¼©æ”¾ã€‚ å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384QPixmap ScaleByNinePatch(const QPixmap&amp; src, // åŸå›¾ QSize destSize, // ç›®æ ‡å°ºå¯¸ bool keepVertexImageSize, // æ˜¯å¦ä¿æŒ1ã€3ã€7ã€9é¡¶ç‚¹å›¾ç‰‡å¤§å°ä¸å˜ï¼Œè®¾ç½®ä¸ºtrueåˆ™ä¸QSSæ–¹å¼æ•ˆæœç±»ä¼¼ï¼ˆä»…ç±»ä¼¼ï¼Œå› ä¸ºè¯¥å‡½æ•°æ˜¯ç›´æ¥è¿”å›åŸå›¾ï¼‰ int pos1Width, int pos1Height, int pos3Width, int pos7Height, Qt::TransformationMode mode = Qt::SmoothTransformation) &#123; // å‚æ•°æ ¡å‡† pos1Width = qMax(pos1Width, 0); pos1Height = qMax(pos1Height, 0); pos3Width = qMax(pos3Width, 0); pos7Height = qMax(pos7Height, 0); int handlePixW = 0, handlePixH = 0; const QPixmap* handlePix = nullptr; QPixmap keepRatioScaledPix; if (keepVertexImageSize) &#123; // ä¿æŒé¡¶ç‚¹å›¾ç‰‡å¤§å°ä¸å˜çš„æƒ…å†µï¼Œå¦‚æœé¡¶ç‚¹å›¾ç‰‡å®½æˆ–é«˜å·²ç»å¤§äºäº†ç›®æ ‡å®½é«˜ï¼Œåˆ™ç›´æ¥è¿”å›åŸå›¾ if (pos1Width + pos3Width &gt; destSize.width() || pos1Height + pos7Height &gt; destSize.height()) return src; handlePixW = src.width(); handlePixH = src.height(); handlePix = &amp;src; &#125; else &#123; const qreal srcW = src.width(); const qreal srcH = src.height(); // å…ˆç­‰æ¯”ç¼©æ”¾åˆ°é€‚åˆçš„å°ºå¯¸ keepRatioScaledPix = src.scaled(destSize, Qt::KeepAspectRatio, mode); handlePixW = keepRatioScaledPix.width(); handlePixH = keepRatioScaledPix.height(); qreal krsPixWidth = handlePixW; qreal krsPixHeight = handlePixH; // æŒ‰ç…§ä¹‹å‰çš„æ¯”ä¾‹è·å–æ–°é¡¶ç‚¹å›¾ç‰‡çš„å¤§å° pos1Width = krsPixWidth * (qreal)pos1Width / srcW; pos1Height = krsPixHeight * (qreal)pos1Height / srcH; pos3Width = krsPixWidth * (qreal)pos3Width / srcW; pos7Height = krsPixHeight * (qreal)pos7Height / srcH; handlePix = &amp;keepRatioScaledPix; &#125; // æå‰å„ä¸ªåŒºåŸŸå›¾ç‰‡ QPixmap pix1 = handlePix-&gt;copy(0, 0, pos1Width, pos1Height); QPixmap pix2 = handlePix-&gt;copy(pos1Width, 0, qMax(handlePixW - pos1Width - pos3Width, 0), pos1Height); QPixmap pix3 = handlePix-&gt;copy(qMax(handlePixW - pos3Width, 0), 0, pos3Width, pos1Height); QPixmap pix4 = handlePix-&gt;copy(0, pos1Height, pos1Width, qMax(handlePixH - pos1Height - pos7Height, 0)); QPixmap pix5 = handlePix-&gt;copy(pos1Width, pos1Height, qMax(handlePixW - pos1Width - pos3Width, 0), qMax(handlePixH - pos1Height - pos7Height, 0)); QPixmap pix6 = handlePix-&gt;copy(qMax(handlePixW - pos3Width, 0), pos1Height, pos3Width, qMax(handlePixH - pos1Height - pos7Height, 0)); QPixmap pix7 = handlePix-&gt;copy(0, qMax(handlePixH - pos7Height, 0), pos1Width, pos7Height); QPixmap pix8 = handlePix-&gt;copy(pos1Width, qMax(handlePixH - pos7Height, 0), qMax(handlePixW - pos1Width - pos3Width, 0), pos7Height); QPixmap pix9 = handlePix-&gt;copy(qMax(handlePixW - pos3Width, 0), qMax(handlePixH - pos7Height, 0), pos3Width, pos7Height); // å¯¹2ã€4ã€5ã€6ã€8åŒºåŸŸå›¾ç‰‡è¿›è¡Œç¼©æ”¾ pix2 = pix2.scaled(qMax(destSize.width() - pos1Width - pos3Width, 0), pos1Height, Qt::IgnoreAspectRatio, mode); pix4 = pix4.scaled(pos1Width, qMax(destSize.height() - pos1Height - pos7Height, 0), Qt::IgnoreAspectRatio, mode); pix5 = pix5.scaled(qMax(destSize.width() - pos1Width - pos3Width, 0), qMax(destSize.height() - pos1Height - pos7Height, 0), Qt::IgnoreAspectRatio, mode); pix6 = pix6.scaled(pos3Width, qMax(destSize.height() - pos1Height - pos7Height, 0), Qt::IgnoreAspectRatio, mode); pix8 = pix8.scaled(qMax(destSize.width() - pos1Width - pos3Width, 0), pos7Height, Qt::IgnoreAspectRatio, mode); // æ‹¼æ¥æ–°çš„å›¾ç‰‡ QPixmap dest(destSize); dest.fill(Qt::transparent); // ä½¿ç”¨é€æ˜è‰²å¡«å……å›¾ç‰‡ QPainter painter(&amp;dest); painter.drawPixmap(0, 0, pix1); painter.drawPixmap(pos1Width, 0, pix2); painter.drawPixmap(qMax(destSize.width() - pos3Width, 0), 0, pix3); painter.drawPixmap(0, pos1Height, pix4); painter.drawPixmap(pos1Width, pos1Height, pix5); painter.drawPixmap(qMax(destSize.width() - pos3Width, 0), pos1Height, pix6); painter.drawPixmap(0, qMax(destSize.height() - pos7Height, 0), pix7); painter.drawPixmap(pos1Width, qMax(destSize.height() - pos7Height, 0), pix8); painter.drawPixmap(qMax(destSize.width() - pos3Width, 0), qMax(destSize.height() - pos7Height, 0), pix9); painter.end(); return dest;&#125; è°ƒè¯•å°æŠ€å·§ï¼š å¯ä»¥æŠŠæ¯ä¸ªåŒºåŸŸçš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼ŒæŸ¥çœ‹å›¾ç‰‡æ˜¯å¦æ­£ç¡®ï¼Œå¦‚ï¼š 123456789pix1.save(&quot;D:\\\\1.png&quot;);pix2.save(&quot;D:\\\\2.png&quot;);pix3.save(&quot;D:\\\\3.png&quot;);pix4.save(&quot;D:\\\\4.png&quot;);pix5.save(&quot;D:\\\\5.png&quot;);pix6.save(&quot;D:\\\\6.png&quot;);pix7.save(&quot;D:\\\\7.png&quot;);pix8.save(&quot;D:\\\\8.png&quot;);pix9.save(&quot;D:\\\\9.png&quot;); é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt","ä¹å®«æ ¼"],"categories":["Qt"]},{"title":"å°æ‡’ã€è½¬è½½ã€‘","path":"/post/2501563677.html","content":"äººç”Ÿäºä¸–ï¼Œä¸€å‘³å‹¤ï¼Œä¸è§å¾—æ˜¯å¥½äº‹ã€‚ ä¸äººå¤„ï¼Œå¾—å°æ‡’ã€‚ç®¡å¤´ç®¡è„šï¼Œå¤§åˆ°åŸåˆ™é—®é¢˜ï¼Œå°è‡³é¸¡æ¯›è’œçš®ï¼Œæ ·æ ·éƒ½æƒ³æ’ä¸€æ‰‹ã€‚è¿™æ ·çš„ç›¸å¤„æ¨¡å¼ï¼Œé™¤äº†æƒ¹äººåŒï¼Œå†éš¾æœ‰å…¶ä»–ç»“æœã€‚å®¹ä»–äººè—ç‚¹éšç§ï¼Œç»™å½¼æ­¤ç•™ç‚¹ç©ºé—´ï¼Œè¿™æ ·çš„å°æ‡’ï¼Œæ¯”èµ·æ‰€è°“çš„æ— å¾®ä¸è‡³æ›´ä»¤äººæ¬£èµã€‚ ä¸äººè¨€ï¼Œä¹Ÿå¾—å°æ‡’ã€‚è¯ä¸èƒ½è¯´å¾—å¤ªæ»¡ï¼Œæ„çŠ¹æœªå°½ä¹‹å¤„ï¼Œäºäººäºå·²éƒ½æ˜¯ä½™åœ°ã€‚ç•™æœ‰è¿™æ ·çš„ä½™åœ°ï¼Œæ—¥åæ‰å¥½è½¬åœœã€‚åŒæ ·çš„æ„æ€ï¼Œæ¨ªå†²ç›´æ’ä¸å©‰è½¬ç•™ä½™ï¼Œå¯èƒ½å¸¦æ¥ä¸åŒçš„ç»“æœã€‚ç•™ä¸€çº¿ï¼Œå¥½ç›¸è§ï¼Œè¿™æ ·çš„ç•™ï¼Œè‡ªç„¶æ˜¯å°æ‡’ã€‚ è¨€è¯­ä¸­çš„å°æ‡’ï¼Œè¿˜åœ¨äºå€¾å¬ã€‚è¯ä¸è¯´æ»¡ï¼Œè¿™æ»¡æ˜¯è¯æ„ï¼Œä¹Ÿæ˜¯è¯é¢‘ã€‚ä¸€å‘³ç…§ç€è‡ªå·±çš„é¢‘ç‡è¯´ï¼Œä¸é¡¾å¯¹æ–¹çš„æ„Ÿå—ï¼Œä¹Ÿä¸ç†ä¼šå¯¹æ–¹çš„æƒ³æ³•ã€‚è¿™ç§å•æ–¹é¢çš„æ‰€è°“æ²Ÿé€šï¼Œæ¯”èµ·æ— è¨€çš„æ§›å°¬ï¼Œæ›´ä»¤äººå¿ƒç”Ÿåº†çƒ¦ã€‚è¯ä¸èƒ½è¯´å¾—å¤ªæ»¡ï¼Œä¹Ÿä¸èƒ½è¯´å¾—å¤ªå‹¤ï¼Œæ—¶æ—¶å¸¦ç€ç‚¹å°æ‡’ï¼Œå…³æ³¨å¯¹æ–¹çš„å¿ƒæ€ï¼Œç»™å¯¹æ–¹è¡¨è¾¾çš„æœºä¼šï¼Œè¿™æ‰æ˜¯ä¸¤ç›¸å®œçš„æ²Ÿé€šæ–¹å¼ã€‚ ç‹¬å¤„ï¼Œä¹Ÿå¾—å¸¦ç‚¹å°æ‡’ã€‚å¿™å¿™ç¢Œç¢Œï¼Œä¿—åŠ¡ç¼ èº«ï¼Œè¿™æ˜¯å¾ˆå¤šäººçš„å¸¸æ€ã€‚ä½†å†å¿™ï¼Œæ€»å¾—æœ‰é‚£ä¹ˆä¸€äº›æ—¶å…‰ï¼Œä¸€ä¸ªäººï¼Œä¸€æœ¬ä¹¦ï¼Œä¸€ç›èŒ¶ï¼Œé™äº«é—²æš‡ä¹‹ä¹ã€‚ç´§ç»·ä¸å°æ‡’ï¼ŒåŠ³ä¸é€¸ï¼Œä¸¤ç›¸ç»“åˆï¼Œäººç”Ÿçš„è·¯æ‰èƒ½èµ°å¾—æ›´è¿œã€‚ å…»å„¿è‚²å¥³ï¼Œå…¶å®ä¹Ÿéœ€è¦å°æ‡’ã€‚èƒ½å¹²çš„çˆ¶æ¯ï¼Œå®¹æ˜“å…»å‡ºæ‡’æƒ…çš„å„¿å¥³ã€‚äº‹æ— å·¨ç»†ï¼Œå¤§åŒ…å¤§æ½ï¼Œè‡ªç„¶ä¼šè®©å„¿å¥³å…»æˆä¾èµ–çš„ä¹ æƒ¯ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œä¹ æƒ¯å°±æˆäº†æœ¬æ€§ã€‚åˆ°é‚£æ—¶ï¼Œå†æ€ä¹ˆæ€¨å¹ï¼Œä¹Ÿæ— æµäºäº‹ã€‚ äººç”Ÿçš„å°æ‡’ï¼Œä¸åŒäºå½»åº•èººå¹³çš„å¤§æ‡’ï¼Œä¹Ÿä¸æ˜¯ä»»ç”±æœ¬æ€§çš„æ”¾çºµã€‚ä¸€è·¯å¥”è·‘ä¹‹ä½™ï¼Œæ€»å¾—ç•™æœ‰é‚£ä¹ˆä¸€ç‚¹å„¿æ—¶å…‰ï¼Œæ¥æ”¾ä»»è‡ªå·±çš„å°æ‡’ã€‚è¿™æ ·çš„å°æ‡’ï¼Œå¦‚æ˜¥æ—¥çš„é˜³å…‰ï¼Œåˆä¼¼ç§‹æ—¥çš„å¾®é£ï¼Œä¸å¤šä¸å°‘ï¼Œå´åˆšåˆšå¥½ã€‚ ä½œè€…ï¼šéƒ­åæ‚¦","categories":["ç¾æ–‡èµæ"]},{"title":"MSVCç‰ˆæœ¬çš„äºŒè¿›åˆ¶å…¼å®¹æ€§","path":"/post/3437796039.html","content":"Visual Studio 2013 åŠæ›´æ—©ç‰ˆæœ¬ä¸­çš„ Microsoft C++ (MSVC) ç¼–è¯‘å™¨å·¥å…·é›†ä¸ä¿è¯ä¸»ç‰ˆæœ¬é—´çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œæ— æ³•é“¾æ¥ç”±ä¸åŒç‰ˆæœ¬å·¥å…·é›†ç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶ã€é™æ€åº“ã€åŠ¨æ€åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºABIã€å¯¹è±¡æ ¼å¼å’Œè¿è¡Œæ—¶åº“ä¸å…¼å®¹ã€‚ å¾®è½¯åœ¨ Visual Studio 2015 åŠæ›´é«˜ç‰ˆæœ¬ä¸­æ”¹å˜äº†è¿™ä¸ªè¡Œä¸ºã€‚å¯¹äºè‡ª Visual Studio 2015 ä»¥æ¥çš„æ‰€æœ‰ç‰ˆæœ¬ï¼ˆè¯¥ç‰ˆæœ¬å·éƒ½ä»¥ 14 å¼€å¤´ï¼Œå¦‚Visual Studio 2015ã€2017ã€2019 å’Œ 2022å·¥å…·é›†çš„ç‰ˆæœ¬åˆ†åˆ«ä¸º v140ã€v141ã€v142 å’Œ v143ï¼‰ç”±å…¶ä¸­ä»»ä¸€ç‰ˆæœ¬ç¼–è¯‘å™¨ç¼–è¯‘çš„è¿è¡Œæ—¶åº“å’Œåº”ç”¨éƒ½å…·æœ‰äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ å‡è®¾ä½ ä½¿ç”¨ Visual Studio 2015 ç”Ÿæˆç¬¬ä¸‰æ–¹åº“ï¼Œä½ ä»å¯åœ¨ Visual Studio 2017ã€2019 æˆ– 2022 ç”Ÿæˆçš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ï¼Œæ— éœ€ä½¿ç”¨åŒ¹é…å·¥å…·é›†é‡æ–°ç¼–è¯‘ã€‚ åŒæ—¶æœ€æ–°ç‰ˆæœ¬çš„ Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…ï¼ˆè¿è¡Œæ—¶åº“ï¼‰ä¹Ÿå…¼å®¹æ‰€æœ‰è€ç‰ˆæœ¬ï¼Œæ— éœ€ä¸ºä¸åŒç‰ˆæœ¬å®‰è£…ä¸åŒçš„è¿è¡Œæ—¶åº“ï¼Œç»Ÿä¸€å®‰è£…æœ€æ–°ç‰ˆæœ¬å³å¯ã€‚ å¯¹äºŒè¿›åˆ¶å…¼å®¹æ€§çš„é™åˆ¶v140ã€v141ã€v142 å’Œ v143 å·¥å…·é›†ä¸æ¬¡è¦ç‰ˆæœ¬å·æ›´æ–°ä¹‹é—´çš„äºŒè¿›åˆ¶å…¼å®¹æ€§æ–¹é¢å­˜åœ¨ä¸‰ä¸ªé‡è¦é™åˆ¶ï¼š ä½ å¯ä»¥æ··åˆä½¿ç”¨ç”± v140ã€v141ã€v142 å’Œ v143 å·¥å…·é›†çš„ä¸åŒç‰ˆæœ¬ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œå¿…é¡»ä½¿ç”¨è‡³å°‘ä¸åº”ç”¨ä¸­æœ€æ–°äºŒè¿›åˆ¶æ–‡ä»¶åŒæ ·æ–°çš„å·¥å…·é›†è¿›è¡Œé“¾æ¥ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼šå¯ä»¥å°†ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬çš„v141å·¥å…·é›†ï¼ˆç‰ˆæœ¬ 15.0 åˆ° 15.9ï¼‰ç¼–è¯‘çš„åº”ç”¨é“¾æ¥åˆ°ä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.2 (v142) ç¼–è¯‘çš„é™æ€åº“ã€‚ åªæ˜¯å¿…é¡»ä½¿ç”¨ç‰ˆæœ¬ 16.2 æˆ–æ›´é«˜ç‰ˆæœ¬å·¥å…·é›†é“¾æ¥å®ƒä»¬ã€‚åªè¦ä½¿ç”¨ 16.4 æˆ–æ›´é«˜ç‰ˆæœ¬å·¥å…·é›†ï¼Œä¾¿å¯ä»¥å°†ç‰ˆæœ¬ 16.2 åº“é“¾æ¥åˆ°ç‰ˆæœ¬ 16.4 åº”ç”¨ã€‚ åº”ç”¨ä½¿ç”¨çš„å¯å†å‘è¡Œç¨‹åºåŒ…å…·æœ‰ç±»ä¼¼çš„äºŒè¿›åˆ¶å…¼å®¹æ€§é™åˆ¶ã€‚ æ··åˆä½¿ç”¨ç”±å·¥å…·é›†çš„ä¸åŒå—æ”¯æŒç‰ˆæœ¬ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯å†å‘è¡Œç¨‹åºåŒ…ç‰ˆæœ¬å¿…é¡»è‡³å°‘ä¸ä»»ä½•åº”ç”¨ç»„ä»¶ä½¿ç”¨çš„æœ€æ–°å·¥å…·é›†ä¸€æ ·æ–°ã€‚ ä½¿ç”¨ &#x2F;GLï¼ˆå…¨ç¨‹åºä¼˜åŒ–ï¼‰ç¼–è¯‘å™¨å¼€å…³ç¼–è¯‘æˆ–æ˜¯ä½¿ç”¨ &#x2F;LTCGï¼ˆé“¾æ¥æ—¶é—´ä»£ç ç”Ÿæˆï¼‰é“¾æ¥çš„é™æ€åº“æˆ–å¯¹è±¡æ–‡ä»¶ä¸åœ¨å„ä¸ªç‰ˆæœ¬é—´äºŒè¿›åˆ¶å…¼å®¹ï¼ˆåŒ…æ‹¬æ¬¡è¦ç‰ˆæœ¬æ›´æ–°ï¼‰ã€‚ ä½¿ç”¨ /GL å’Œ /LTCG ç¼–è¯‘çš„æ‰€æœ‰å¯¹è±¡æ–‡ä»¶å’Œåº“å¿…é¡»å°†å®Œå…¨ç›¸åŒçš„å·¥å…·é›†ç”¨äºç¼–è¯‘å’Œæœ€ç»ˆé“¾æ¥ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.7 å·¥å…·é›†ä¸­çš„ /GL ç”Ÿæˆçš„ä»£ç æ— æ³•é“¾æ¥åˆ°ä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.8 å·¥å…·é›†ä¸­çš„ /GLç”Ÿæˆçš„ä»£ç ã€‚ ç¼–è¯‘å™¨ä¼šå‘å‡ºé”™è¯¯ C1047ã€‚ ä» Visual Studio 2015 åŠæ›´é«˜ç‰ˆæœ¬å‡çº§ Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…å¯¹äº Visual Studio 2015ã€2017ã€2019 å’Œ 2022ï¼Œå¾®è½¯å°† Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…çš„ä¸»ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬ä¸€æ¬¡åªèƒ½å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…çš„ä¸€ä¸ªå®ä¾‹ã€‚ è¾ƒæ–°ç‰ˆæœ¬ä¼šè¦†ç›–å·²å®‰è£…çš„ä»»ä½•è¾ƒæ—§ç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šä» Visual Studio 2015 å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ éšåå¦ä¸€ä¸ªåº”ç”¨ä» Visual Studio 2022 å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ 2022 ç‰ˆæœ¬ä¼šè¦†ç›–è¾ƒæ—§ç‰ˆæœ¬ï¼Œä½†ç”±äºå®ƒä»¬å…·æœ‰äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œæ—©æœŸåº”ç”¨ä»å¯æ­£å¸¸å·¥ä½œã€‚ å¾®è½¯ç¡®ä¿æœ€æ–°ç‰ˆæœ¬çš„å¯å†å‘è¡Œç¨‹åºåŒ…å…·æœ‰æ‰€æœ‰æœ€æ–°çš„åŠŸèƒ½ã€å®‰å…¨æ›´æ–°å’Œ bug ä¿®è¡¥ç¨‹åºã€‚ è¿™ä¾¿æ˜¯ä¸ºä»€ä¹ˆå¾®è½¯å§‹ç»ˆå»ºè®®å‡çº§åˆ°æœ€æ–°å¯ç”¨ç‰ˆæœ¬ã€‚ åŒæ ·ï¼Œå·²å®‰è£…äº†è¾ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œæ— æ³•å®‰è£…è¾ƒæ—§çš„å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ å¦‚æœå°è¯•ï¼Œåˆ™å®‰è£…ç¨‹åºä¼šæŠ¥å‘Šé”™è¯¯ã€‚ å¦‚æœåœ¨å·²å…·æœ‰ 2022 ç‰ˆæœ¬çš„è®¡ç®—æœºä¸Šå®‰è£… 2017 æˆ– 2019 å¯å†å‘è¡Œç¨‹åºï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é”™è¯¯ï¼š 10x80070666 - Another version of this product is already installed. Installation of this version cannot continue. To configure or remove the existing version of this product, use Add/Remove Programs on the Control Panel. æ­¤é”™è¯¯æ˜¯å¾®è½¯æ•…æ„è¿™æ ·è®¾è®¡çš„ï¼Œä»¥ç¡®ä¿Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…ä¸ºæœ€æ–°ç‰ˆæœ¬ã€‚ æœ¬æ–‡å‚è€ƒï¼šVisual Studio ç‰ˆæœ¬ä¹‹é—´çš„ C++ äºŒè¿›åˆ¶å…¼å®¹æ€§","tags":["ABI","MSVC","Visual Studio"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"Vcpkgä½¿ç”¨ä»“åº“æœ€æ–°ä»£ç ","path":"/post/2065175920.html","content":"åœ¨å‘Vcpkgæäº¤portæ—¶ï¼Œæˆ‘ä»¬ä¼šä¸æ–­åœ°å¯¹ä»“åº“è¿›è¡Œä¿®æ”¹å’Œè°ƒè¯•ã€‚å¦‚æœé‡‡ç”¨REFæ–¹å¼æŒ‡å®šæºç ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦ä¸æ–­åœ°ä¿®æ”¹REFå’ŒSHA512ï¼Œè°ƒè¯•èµ·æ¥æ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨HEAD_REFçš„æ–¹å¼æ¥ç®€åŒ–è°ƒè¯•æµç¨‹ã€‚ åœ¨portfile.cmakeæ–‡ä»¶ä¸­æŒ‡å®šHEAD_REFï¼Œå¦‚ï¼š 123456vcpkg_from_github( OUT_SOURCE_PATH SOURCE_PATH REPO winsoft666/ashe HEAD_REF main AUTHORIZATION_TOKEN $ENV&#123;GITHUB_TOKEN&#125;) å®‰è£…æ—¶æŒ‡å®š--headå‚æ•°ï¼š 1vcpkg install ashe:x64-windows-static --head","tags":["CMake","Vcpkg","Github"],"categories":["CMake"]},{"title":"CMakeæŒ‰ç›®å½•å±‚çº§è¿›è¡Œåˆ†ç»„","path":"/post/1531265402.html","content":"ä¸ºäº†æé«˜é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä¸åŒç”¨é€”çš„ä»£ç æ–‡ä»¶æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚å¤´æ–‡ä»¶æ”¾åˆ°includeç›®å½•ï¼Œæºæ–‡ä»¶æ”¾åˆ°srcç›®å½•ï¼Œç¬¬ä¸‰æ–¹åº“æ”¾åˆ°3rdç›®å½•ç­‰ã€‚ å½“ä½¿ç”¨CMakeç”ŸæˆVisual Studioå·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬äº¦å¸Œæœ›åœ¨Visual Studioä¸­èƒ½çœ‹åˆ°è¿™æ ·çš„æ–‡ä»¶ç»“æ„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨source_groupæŒ‡ä»¤è¿›è¡Œæ·»åŠ ï¼Œä½†å½“ç›®å½•å’Œå±‚çº§å¾ˆå¤šæ—¶ï¼Œè¿™æ ·æ·»åŠ èµ·æ¥å°±æ˜¾å¾—æ¯”è¾ƒç¹çäº†ï¼Œæœ¬æ–‡ä»‹ç»ä¸€ç§æ‡’äººæ–¹æ³•ã€‚ å‡½æ•°group_sourcesç”¨äºéå†ä¼ å…¥æ–‡ä»¶å¹¶æ ¹æ®æ–‡ä»¶æ‰€åœ¨ç›®å½•æ·»åŠ source_groupæŒ‡ä»¤ã€‚ 1234567891011121314151617function(group_sources) foreach(_source IN ITEMS $&#123;ARGN&#125;) if (IS_ABSOLUTE &quot;$&#123;_source&#125;&quot;) file(RELATIVE_PATH _source_rel &quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;&quot; &quot;$&#123;_source&#125;&quot;) else() set(_source_rel &quot;$&#123;_source&#125;&quot;) endif() # è·å–æ–‡ä»¶æ‰€åœ¨ç›®å½• get_filename_component(_source_path &quot;$&#123;_source_rel&#125;&quot; PATH) # æ›¿æ¢ä¸ºWindowsè·¯å¾„æ ·å¼ string(REPLACE &quot;/&quot; &quot;\\\\&quot; _source_path_msvc &quot;$&#123;_source_path&#125;&quot;) source_group(&quot;$&#123;_source_path_msvc&#125;&quot; FILES &quot;$&#123;_source&#125;&quot;) endforeach()endfunction(group_sources) å‡½æ•°group_sourcesæ”¯æŒä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 12345file(GLOB_RECURSE HEADER_FILES ./include/*.hpp ./include/*.h)file(GLOB_RECURSE SOURCE_FILES ./src/*.cc ./src/*.cpp)# å®‰è£…ç›®å½•å±‚çº§å¯¹$&#123;HEADER_FILES&#125;å’Œ$&#123;SOURCE_FILES&#125;ä¸­çš„æ–‡ä»¶è¿›è¡Œåˆ†ç»„group_sources($&#123;HEADER_FILES&#125; $&#123;SOURCE_FILES&#125;)","tags":["CMake"],"categories":["CMake"]},{"title":"åšäººåšäº‹åšç®¡ç†ã€è½¬è½½ã€‘","path":"/post/1719474789.html","content":"å¤§é“è‡³ç®€ï¼Œè¶Šæ˜¯æ ¹æºå’ŒåŸºæœ¬çš„é—®é¢˜ï¼Œé“ç†å®é™…ä¸Šè¶Šç®€å•ã€‚å…³äºå¦‚ä½•åšäººã€åšäº‹ã€åšç®¡ç†çš„ä¹¦å¾ˆå¤šï¼Œæˆ‘çœ‹å¾—ä¸å¤šï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™äº›ä¹¦æ›´å¤šæ˜¯ä¾§é‡æŠ€æœ¯å’Œå®ç°ç»†èŠ‚ä¸Šçš„ï¼Œè€Œå¾ˆå°‘ä»äººçš„æ€æƒ³å’Œè§‚å¿µå»è®²ã€‚ä»å®é™…æ ¹æœ¬ä¸Šå»è¯´ï¼Œå¦‚ä½•åšäººåšäº‹æ˜¯ä¸–ç•Œè§‚çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå“²å­¦è¯é¢˜ã€‚å¾ˆå¤šäººå’Œæˆ‘ä¸€æ ·ï¼Œå·²ç»åˆ°äº†30çš„å¹´çºªï¼Œæ˜¯éœ€è¦å»æ€è€ƒä¸€ä¸‹åº”è¯¥å¦‚ä½•åšäººå¦‚ä½•åšäº‹çš„ï¼Œä¹Ÿéœ€è¦ä¸€å¥—ç®€å•ã€æœ‰æ•ˆã€å®Œæ•´çš„ä½“ç³»æ¥æŒ‡å¯¼è‡ªå·±ï¼Œè€Œè¿™å¥—ä½“ç³»å°†æ˜¯è®©è‡ªå·±å®‰èº«ç«‹å‘½äºè¿™ä¸ªä¸–ç•Œçš„åŸºçŸ³ã€‚ èŒåœºä¸Šå¦‚ä½•åšäººå…³äºåœ¨èŒåœºä¸Šå¦‚ä½•åšäººï¼Œæˆ‘åªè°¨è®°ä¸¤ä¸ªå­—ï¼ï¼æœåŠ¡ã€‚ ä½ è¦æŠŠè‡ªå·±å½“æˆä¸€ä¸ªå“ç‰Œå»çˆ±æƒœï¼Œå½“æˆä¸€å®¶å…¬å¸å»ç»è¥ï¼Œä½ è¦ç‰¢ç‰¢è®°ä½ä½ ä¹‹æ‰€ä»¥èƒ½åœ¨ä¸€å®¶å…¬å¸ç«‹è¶³ï¼Œæ˜¯å› ä¸ºå…¬å¸éœ€è¦ä½ çš„æœåŠ¡ã€‚ æˆ‘ä»¬ç»å¸¸ä¼šæŠ±æ€¨æŸæŸé“¶è¡Œçš„å·¥ä½œäººå‘˜æœåŠ¡æ€åº¦ä¸å¥½ã€æŸæŸå•†å“çš„å”®åæœåŠ¡ä¸å¥½ï¼Œä½†ä»æ¥ä¸å»æ€è€ƒè‡ªå·±å¯¹å…¬å¸çš„æœåŠ¡å¥½ä¸å¥½ï¼Ÿå…¬å¸çš„ä»»åŠ¡æœ‰æ²¡æœ‰å¦‚æœŸå®Œæˆï¼Œæœ‰æ²¡æœ‰å“ªä¸ªä»»åŠ¡æ˜¯æå‰å®Œæˆçš„ï¼Œæ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½æ‹–åˆ°â€œæœ€åæœŸé™â€ï¼Ÿå·¥ä½œå®Œæˆçš„å¤Ÿä¸å¤Ÿå½»åº•ï¼Œæ˜¯ä¸æ˜¯ç­”å¤å·²ç»å®Œæˆäº†ï¼Œç»“æœåé¢åˆå‡ºçŠ¶å†µï¼Ÿå®Œæˆåæœ‰æ²¡æœ‰å‘ä¸Šçº§åé¦ˆï¼Œæ˜¯ä¸æ˜¯ç­‰åˆ°ä¸Šçº§é—®ä½ å®Œæˆäº†æ²¡æœ‰ï¼Œä½ æ‰å»æŠ¥å‘Šè¿›åº¦ï¼Ÿæ‹–å»¶çš„ä»»åŠ¡æœ‰æ²¡æœ‰æŒç»­è·Ÿè¿›ï¼Œæ˜¯ä¸æ˜¯ä¸Šçº§ä¸è¿½äº†è¿™ä¸ªä»»åŠ¡æœ€åå°±ä¸äº†äº†ä¹‹äº†ï¼Ÿä¸Šé¢è¿™äº›é—®é¢˜æˆ‘éƒ½æ˜¯åå¤é‡è§ï¼Œå…¶å®æ ¹æœ¬åŸå› å°±æ˜¯æ²¡æœ‰æ„è¯†åˆ°ä½ å…¶å®åœ¨åšä¸€é¡¹æœåŠ¡ï¼Œä½ åœ¨å…¬å¸çš„å‘å±•å‰æ™¯ï¼Œå…¨éƒ½å–å†³ä½ å¯¹å…¬å¸çš„æœåŠ¡å¤Ÿä¸å¤Ÿå¥½ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœäº¤ç»™ä½ çš„æ¯ä»¶äº‹æƒ…éƒ½å¯ä»¥è¿åˆƒè€Œè§£ã€åŒ–é™©ä¸ºå¤·ï¼Œè®©äººæ„Ÿè§‰ç¨³å¦¥ã€æ”¾å¿ƒã€è¸å®ï¼Œä½ è‡ªç„¶ä¼šæ”¶åˆ°æ›´å¤šæ›´é‡è¦çš„â€œè®¢å•â€ã€‚å½“ä½ çš„å•å¤šåˆ°ä½ å¿™ä¸è¿‡æ¥çš„æ—¶å€™æ€ä¹ˆåŠï¼Ÿæ‹›ä¸‹å±å•Šï¼Œå‘µå‘µï¼Œæ­å–œä½ ï¼Œä½ å·²ç»æ˜¯é¢†å¯¼äº†ï¼ˆå½“ç„¶æˆ‘ä»¬ä¹Ÿè¦æ’é™¤æå°‘æ•°çš„ä»»äººå”¯äº²çš„å…¬å¸ï¼Œå¤§å±€é¢æ˜¯ç§¯æå‘ä¸Šçš„ï¼‰ã€‚åä¹‹ï¼Œå¦‚æœç»™ä½ ä¸€ä»¶äº‹æƒ…ä½ è¦æ‹–å»¶ï¼Œç»™ä½ ä¸€ä»¶äº‹æƒ…ä½ åŠä¸å¥½ï¼Œç»™ä½ ä¸€ä»¶äº‹æƒ…å°±æ²¡äº†ä¸‹æ–‡äº†ï¼Œè®©äººä¸æ”¾å¿ƒï¼Œä¹…è€Œä¹…ä¹‹ä½ å°±â€œæ— å•å¯åšâ€äº†ï¼Œé‚£ä¹ˆå…¬å¸é‡æ–°è¯·ä¸€ä¸ªäººå°±å¯ä»¥äº†ï¼Œå¹²å˜›éè¦ç”¨ä½ å‘¢ï¼Ÿ æœåŠ¡ä¸å…‰æ˜¯å¯¹äºè‡ªå·±ä¾›èŒçš„å…¬å¸ï¼Œå¯¹äºå…¬å¸çš„å®¢æˆ·ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¯ä¸€æ¬¡å»å®¢æˆ·é‚£é‡Œå‡ºå·®å‰ï¼Œæˆ‘æ€»æ˜¯å†ä¸‰å®å˜±è‡ªå·±ï¼Œæˆ‘æ­¤æ¬¡ä¹‹è¡Œæ˜¯ä¸ºå®¢æˆ·åšæœåŠ¡çš„ï¼Œæ˜¯å»ä¸ºå®¢æˆ·è§£å†³é—®é¢˜çš„ã€‚è¿™ä¸ªå¿ƒæ€éå¸¸é‡è¦ï¼Œæˆ‘ä»¬åšè½¯ä»¶ç³»ç»Ÿçš„ï¼Œå»è§å®¢æˆ·é™¤äº†åšæ¼”ç¤ºã€åšåŸ¹è®­ï¼Œå¾ˆå¤šæ—¶å€™å°±æ˜¯å¤„ç†ç°åœºé—®é¢˜ï¼Œéš¾å…é‡åˆ°å®¢æˆ·å¯¹ç³»ç»Ÿçš„æŠ•è¯‰ï¼Œæ¯”å¦‚ç³»ç»Ÿé€Ÿåº¦æ…¢ã€bugå¤šç­‰é—®é¢˜ã€‚å½“ä½ æœ‰äº†è¿™æ ·çš„å¿ƒæ€ï¼Œä½ å°±ä¼šè°¦è™šåœ°æ¥å—å®¢æˆ·çš„æ‰¹è¯„ï¼Œç»†è‡´åœ°è®°å½•å®¢æˆ·æå‡ºçš„é—®é¢˜ï¼Œç„¶åä¸€é¡¹é¡¹åœ°å»æ€è€ƒå¦‚ä½•è§£å†³ï¼Œå¹¶ä¸”åº”è¯¥ç»™å®¢æˆ·ä¸€ä»½è¯¦å°½çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰äº†è¿™æ ·çš„å¿ƒæ€ï¼Œä½ ä¼šä¸è‡ªè§‰åœ°ã€è‡ªç„¶è€Œç„¶åœ°ä¸å®¢æˆ·ç«™åœ¨ä¸€è¾¹ï¼Œè®©ä»–æ„Ÿåˆ°ä½ æ˜¯åœ¨ä¸ºä»–ç€æƒ³ï¼Œå¸®åŠ©ä»–å»è§£å†³é—®é¢˜çš„ã€‚åœ¨ä½ é¢å¯¹å®¢æˆ·æ—¶ï¼Œåº”è¯¥æœ‰è¿™æ ·ä¸€ä¸ªè™”è¯šçš„ä¿¡å¿µï¼šæˆ‘æ˜¯å»ä¸ºå®¢æˆ·æœåŠ¡çš„ï¼Œä¸ºä»–è§£å†³ä»–æ‰€è§£å†³ä¸äº†çš„é—®é¢˜çš„ã€‚å¦‚æœä½ æ²¡æœ‰è¿™æ ·çš„å¿ƒæ€ï¼Œé¢å¯¹æŠ•è¯‰å¾ˆå¯èƒ½å°±ä¼šäº§ç”ŸåŒçƒ¦ï¼Œè€Œä¸”å®¹æ˜“ä¸ºè‡ªå·±çš„é—®é¢˜è¿›è¡Œè¾©è§£ã€‚è¿™ç§åšæ³•ç»™å®¢æˆ·çš„æ„Ÿè§‰å°±æ˜¯ä½ ç«­åŠ›åœ¨è¯æ˜ä½ æ˜¯å¯¹çš„ä»–æ˜¯é”™çš„ï¼Œè¿™æ ·ä½ å°±ç«™åœ¨å®¢æˆ·çš„å¯¹é¢äº†ã€‚ åœ¨å®¢æˆ·é¢å‰çš„è¡¨ç°å¯¹ä½ çš„èŒåœºå‘å±•ä¹Ÿæ˜¯éå¸¸æœ‰å¥½å¤„çš„ï¼Œå°¤å…¶æ˜¯æ¥è§¦åˆ°ä¸€äº›è·¨å›½ä¼ä¸šæ—¶ï¼Œä½ ä¼˜è‰¯çš„èŒä¸šç´ å…»ä¼šä¸ºä½ èµ¢æ¥å®¢æˆ·çš„è®¤åŒä¸å°Šæ•¬ã€‚è¿™æ ·å½“ä½ å“ªå¤©å¸Œæœ›å¯»æ‰¾æ›´é«˜çš„å¹³å°ï¼Œåªè¦æ”¾ä¸ªå£é£å‡ºå»ï¼Œç«‹å³å°±ä¼šæœ‰Offeräº†ã€‚æ‰€ä»¥è®¤çœŸæœåŠ¡å¥½å®¢æˆ·åªèµšä¸èµ”ã€‚ èŒåœºä¸Šå¦‚ä½•åšäº‹å…³äºå¦‚ä½•åšäº‹ï¼Œä¹Ÿæœ‰å¾ˆå¤šçš„ç†è®ºï¼Œæ¯”å¦‚è¦äº‹ç¬¬ä¸€ï¼ŒæŠŠäº‹æƒ…åˆ†ä¸ºç´§æ€¥ã€é‡è¦ç­‰ç­‰ï¼Œè¿™äº›æˆ‘éƒ½ä¸è®¨è®ºäº†ï¼Œæˆ‘åªå°±æˆ‘è‡ªå·±çš„ç»éªŒæ¥è°ˆä¸€è°ˆã€‚ å¯¹äºå¦‚ä½•åšäº‹ï¼Œæˆ‘ä¹Ÿæªå®ˆä¸€ä¸ªä¿¡æ¡ï¼šä¸ç„¦ä¸ç‡¥ï¼ŒæŠŠå¿ƒæ²‰ä¸‹å»ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­äºè¦è§£å†³çš„é—®é¢˜ä¸Šã€‚ æˆ‘çœ‹è¿‡è¿™æ ·ä¸€ä¸ªæ•…äº‹ï¼Œæ˜¯è¯´ä»å‰æœ‰ä¸€æˆ·äººå®¶ï¼Œå®¶é‡Œçš„èœå›­ä¸­æœ‰ä¸€å—å¤§çŸ³å¤´ï¼Œç»å¸¸ä¼šæœ‰äººä¸å°å¿ƒæ’åˆ°ï¼›å„¿å­å°±é—®ï¼šä¸ºä»€ä¹ˆä¸æŠŠä»–æŒ–èµ°å‘¢ï¼Ÿä»–çš„çˆ¸çˆ¸è¯´ï¼šè¿™ä¸ªçŸ³å¤´çˆ·çˆ·çš„æ—¶ä»£å°±æœ‰äº†ï¼Œå°±æ˜¯å› ä¸ºå®ƒé‚£ä¹ˆå¤§ï¼Œä¸å¥½æŒ–æ‰ä¸€ç›´åœ¨é‚£é‡Œï¼›åˆè¿‡äº†ä¸€ä»£äººï¼Œå®¶é‡Œçš„ä¸€ä¸ªåª³å¦‡å®åœ¨å—ä¸äº†ï¼Œå°±æ‰›ç€é”„å¤´å»æŒ–äº†ï¼Œå¥¹å·²ç»åšå¥½äº†å¿ƒç†å‡†å¤‡è¦æŒ–å‡ å¤©çš„æ—¶é—´ï¼Œç»“æœä¸€å¤©å°±æŒ–å®Œäº†â€¦ â€¦åŸæ¥é‚£ä¸ªçŸ³å¤´çš„ä¸­é—´æ˜¯ç©ºçš„ã€‚ æˆ‘ä»¬é‡åˆ°çš„å¾ˆå¤šäº‹æƒ…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œçœ‹ä¼¼æ£˜æ‰‹ã€éš¾ä»¥è§£å†³ï¼Œå®é™…ä¸Šåªè¦ä½ è®¤çœŸåœ°å»åˆ†æã€å»æ€è€ƒï¼Œç„¶åæ”¾æ‰‹å»åšï¼Œå¾€å¾€å¹¶æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆå›°éš¾ã€‚ä½ éœ€è¦å…‹æœå¿ƒä¸­çš„é¡½çŸ³ã€‚æˆ‘å‘ç°ä¸€äº›äººé‡åˆ°é—®é¢˜åï¼Œå¾ˆè½»æ˜“åœ°å°±ä¼šè¯´ï¼šè¿™ä¸ªæˆ‘åšä¸äº†ï¼Œè¿™ä¸ªå®ç°ä¸äº†ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ²¡åŠæ³•ã€‚å…¶å®å°±å¥½åƒçœ‹åˆ°è¿™å—å¤§çŸ³å¤´ä¸€æ ·ï¼Œè¢«å®ƒçš„â€œå¤–è¡¨â€å“ä½äº†ï¼Œè€Œæ”¾å¼ƒäº†åº”æœ‰çš„è¡ŒåŠ¨ã€‚ è€Œä¸”æˆ‘å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œä¸ç®¡å¤šä¹ˆå›°éš¾çš„é—®é¢˜ï¼Œåªè¦ä½ æ²‰ä¸‹å¿ƒå»æ€è€ƒå¦‚ä½•è§£å†³ï¼Œå°±å¥½åƒåœ¨å†¥å†¥ä¹‹ä¸­ä¸Šè‹åœ¨çœ‹ç€ä½ ä¸€æ ·ï¼Œå½“ä½ æ‹¼åˆ°æœ€åå°±è¦æ‰“ç®—è®¤è¾“çš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‡ºç°æ–°çš„å¥‘æœºå’Œæ–¹æ³•ã€‚ å¦å¤–ï¼Œæˆ‘å‘ç°æœ‰äº›äººé‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œä»–æƒ³çš„æ˜¯è¿™ä»¶äº‹å¦‚ä½•å›°éš¾å¦‚ä½•éš¾ä»¥å®Œæˆï¼Œè¿™æ ·çš„æ€ç»´æ–¹å¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ˜¯ä¸€ç§ä¿å®ˆä¸”é€€ç¼©çš„æ€ç»´ï¼›é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œæƒ³çš„åº”è¯¥æ˜¯å¦‚ä½•æ‰èƒ½å¤Ÿå®Œæˆã€‚æˆ‘ä¸€èˆ¬é‡‡å–è¿™æ ·å‡ ä¸ªæ­¥éª¤ï¼š1ã€åˆ—å‡ºæ‰€æœ‰çš„å¯èƒ½æ€§ï¼›2ã€åˆ†æå„ç§å¯èƒ½æ€§ï¼›3ã€é€‰æ‹©ä¸€ç§å®ç°èµ·æ¥æœ€ç®€å•ã€å¿«é€Ÿçš„å¯èƒ½æ€§ï¼›4ã€å»å®ç°ã€‚ é™¤æ­¤ä»¥å¤–ï¼Œæˆ‘å‘ç°ä¸€äº›äººåœ¨åšäº‹çš„æ—¶å€™ï¼Œä¼šä»¥â€œè¿™æ ·åšå¾ˆéº»çƒ¦â€æ¥ä½œä¸ºä¸é‡‡çº³æ–¹æ¡ˆçš„ç†ç”±ï¼Œè€Œä¸æ˜¯â€œè¿™æ ·æ˜¯å¦å¿…è¦â€æˆ–è€…â€œè¿™æ ·æ˜¯å¦æ›´å¥½â€æ¥ä½œä¸ºæ ‡å‡†ï¼Œå®é™…ä¸Šâ€œéº»çƒ¦â€åº”è¯¥æ˜¯æ’åœ¨â€œæ˜¯å¦å¿…è¦â€ã€â€œæ˜¯å¦æ›´å¥½â€åé¢è¿›è¡Œè€ƒè™‘çš„ã€‚å¦‚æœä¸€ç§å®ç°æ–¹å¼ï¼Œè™½ç„¶éº»çƒ¦ï¼Œä½†æ˜¯å¾ˆæœ‰å¿…è¦ï¼Œä¸”å¯¹å®¢æˆ·æ¥è¯´æ›´å¥½ï¼Œé‚£ä¹ˆå°±ç®—éº»çƒ¦ä¹Ÿè¦å»åšã€‚ä½†æ˜¯ç¨‹åºå‘˜å¾€å¾€å…³å¿ƒçš„æ˜¯ä¼šä¸ä¼šå¾ˆéº»çƒ¦ï¼Œæ˜¯ä¸æ˜¯è¦ä¿®æ”¹å¾ˆå¤šåœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯ç»™è‡ªå·±å¸¦æ¥å¾ˆå¤šå·¥ä½œé‡â€¦ â€¦å‘Šè¯‰ä½ ï¼Œä½ å…³å¿ƒçš„è¿™äº›ä¸æ˜¯æœ€é‡è¦çš„ã€‚ èŒåœºä¸Šå¦‚ä½•åšç®¡ç†å’Œä¸Šé¢ä¸€æ ·ï¼Œåšç®¡ç†ä¹Ÿæœ‰å¾ˆå¤šçš„ç»†èŠ‚ï¼Œæˆ‘ä¹Ÿéƒ½ä¸è°ˆäº†ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯ä¸€æœ¬ä¹¦ä¸€æœ¬ä¹¦çš„è®²ï¼Œè€Œæˆ‘è§‰å¾—è¦ç®€å•ã€æœ‰æ•ˆã€å¥½æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä¹Ÿåªè¯´ä¸‰ç‚¹ã€‚ æˆ‘è§‰å¾—åšå¥½ä¸€ä¸ªæŠ€æœ¯ç»ç†ï¼Œåªè¦ä¸‹é¢çš„ä¸‰ç‚¹å°±å¥½äº†ï¼š 1ã€å¾·è¡Œå¾·è¡Œå…¶å®å°±æ˜¯å“å¾·ï¼Œç®€å•åœ°è®²å°±æ˜¯è¦å–„è‰¯ã€è¯šæ³ã€‚æœ€é‡è¦çš„ï¼Œä½ åšäº‹çš„å‡ºå‘ç‚¹è¦æ˜¯å¥½çš„ï¼Œå¯¹åˆ«äººæ˜¯æ²¡æœ‰åå¿ƒçš„ã€‚ ä¸ºä»€ä¹ˆè¯´å‡ºå‘ç‚¹ä¸€å®šè¦æ˜¯å¥½çš„å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ä»¥æœåŠ¡å®¢æˆ·çš„ä¾‹å­æ¥è¯´ï¼Œåœ¨ä¸ºå®¢æˆ·è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬çš„å‡ºå‘ç‚¹æ˜¯å¥½çš„ï¼Œæ˜¯ç«™åœ¨å®¢æˆ·ä¸€è¾¹å°½å¿ƒå°½åŠ›å»ä¸ºå®¢æˆ·è§£å†³é—®é¢˜çš„ï¼Œé‚£ä¹ˆå³ä¾¿ç”±äºæ–¹æ³•ã€èƒ½åŠ›ã€æ¡ä»¶ç­‰å„æ–¹é¢çš„åŸå› ï¼Œäº‹æƒ…æç ¸äº†æˆ–è€…æ²¡æœ‰åšå¥½ï¼Œä¹Ÿå¾ˆå®¹æ˜“è·å¾—å®¢æˆ·çš„ç†è§£å’ŒåŸè°…ã€‚å¾ˆå¯èƒ½çš„æƒ…å½¢æ˜¯ï¼Œä½ å°±ç®—åšå¤±è´¥äº†ä¹Ÿä¸€æ ·èµ¢å¾—å®¢æˆ·ï¼›ç›¸åï¼Œå¦‚æœä½ çš„å‡ºå‘ç‚¹æ˜¯â€œçœéº»çƒ¦â€ï¼Œâ€œèµ¶ç´§äº¤å·®äº†äº‹â€ï¼Œâ€œå®Œæˆä»»åŠ¡â€ï¼Œå¦‚æœäº‹æƒ…åšæˆäº†ä¹Ÿå°±ç®—äº†ï¼Œä¸€æ—¦å¤±è´¥äº†ï¼Œä½ çœ‹çœ‹å®¢æˆ·ä¼šæ€ä¹ˆæ ·ï¼Ÿå‘Šè¯‰ä½ ï¼Œå¥½çš„å®¢æˆ·ä¼šæ‰¹è¯„ä½ ã€æŠ•è¯‰ä½ ï¼Œå› ä¸ºä»–å¯¹ä½ è¿˜æœ‰æœŸæœ›ï¼›æ›´å¤šçš„å®¢æˆ·æ˜¯ä»€ä¹ˆè¯ä¹Ÿä¸è¯´ï¼Œç›´æ¥æ¢ä¸ªä¾›åº”å•†å°±æ˜¯äº†ï¼Œæ‰æ‡’å¾—ç†ä½ ã€‚ è®°ä½æ°¸è¿œä¸è¦æŠŠå®¢æˆ·å½“æˆå‚»ç“œï¼Œä½ æ˜¯å¦‚ä½•åšäº‹æƒ…çš„ï¼Œå®¢æˆ·æ˜¯å¾ˆå®¹æ˜“æ„Ÿå—å¾—åˆ°çš„ã€‚æ‰€ä»¥ï¼Œé¢å¯¹å’ŒæœåŠ¡å®¢æˆ·æ²¡æœ‰é‚£ä¹ˆå¤šçš„æŠ€å·§ï¼Œä½ ä¸éœ€è¦æœ‰å¤šå¥½çš„å£æ‰å’Œé­…åŠ›ï¼Œä¹Ÿç”¨ä¸ç€å¿½æ‚ å’Œå¤¸å¤§å…¶è¯(æˆ‘å‘ç°å¾ˆå¤šé”€å”®äººå‘˜éƒ½æ˜¯è¿™æ ·ï¼Œä½ å¯ä»¥éª—å®¢æˆ·ä¸€æ¬¡ï¼Œä½†å°±æ²¡æœ‰ç¬¬äºŒæ¬¡äº†)ï¼Œä½ åªéœ€è¦æ”¾ä¸‹èº«æ®µï¼Œå…¢å…¢ä¸šä¸šåœ°ä¸ºå®¢æˆ·ç€æƒ³ï¼Œè®¾èº«å¤„åœ°åœ°è§£å†³ä»–çš„é—®é¢˜å°±å¯ä»¥ã€‚å¯¹å¾…ä¸‹å±ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½ å¯¹ä»–çš„å¥–åŠ±ä¹Ÿå¥½ï¼Œæƒ©ç½šä¹Ÿå¥½ï¼Œå‡ºå‘ç‚¹ä¸€å®šè¦æ˜¯å¥½çš„ã€‚æˆ‘å¯¹å¾…ä¸‹å±éµå¾ªçš„åŸåˆ™å°±æ˜¯ï¼šæˆ‘æ˜¯åœ¨å¸®åŠ©ä½ ï¼Œå¸®ä½ æŠŠå·¥ä½œåšçš„æ›´å¥½ï¼Œå¸®ä½ è·å¾—æ›´å¤§çš„æé«˜ï¼Œè€Œä¸æ˜¯è¯´æ‰¾ä½ èŒ¬å„¿ï¼Œè·Ÿä½ è¿‡æ„ä¸å»ï¼Œæˆ–è€…æ˜¯æŒ¤å…‘ä½ å‹è¿«ä½ ã€‚å¾·è¡Œæ˜¯åŸºæœ¬çš„ï¼Œæœ‰ä¸€ä¸ªå¥½çš„å¾·è¡Œï¼Œè‡³å°‘å¯ä»¥ä¿è¯ä½ çš„ä¸‹å±ä¸ä¼šè®¨åŒä½ ã€‚ è¿™ä¸€ç‚¹æ”¾åœ¨åšäº§å“ä¸Šä»ç„¶æœ‰æ•ˆï¼Œåšä¸€ä¸ªå¥½çš„äº§å“åŒæ ·ä¸éœ€è¦é‚£ä¹ˆå¤šçš„æŠ€å·§å’ŒèŠ±æ ·ï¼Œä»ç”¨æˆ·å®é™…éœ€æ±‚å‡ºå‘ï¼Œæƒ³ç”¨æˆ·æ‰€æƒ³ï¼Œåšç”¨æˆ·æƒ³è¦çš„ï¼Œç”¨æˆ·è‡ªç„¶ä¹°å•ï¼Œç›ˆåˆ©ä¹Ÿæ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ã€‚ 2ã€æ•¬ä¸šå¦‚æœæœ‰äººé—®æˆ‘ï¼Œä¸‹å±å’Œç»ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆã€‚æˆ‘ä¼šå‘Šè¯‰ä»–ï¼šä¸‹å±ç­‰ç€åˆ«äººäº¤ä»£äº‹æƒ…åšï¼Œç»ç†æƒ³ç€è¿˜æœ‰å“ªäº›äº‹æƒ…å¯ä»¥åšã€‚ è¿™å…¶å®æ˜¯ä¸€ä¸ªç§¯æå¿ƒæ€çš„é—®é¢˜ï¼Œä½œä¸ºä¸€ä¸ªä¸­å±‚å¹²éƒ¨ï¼Œä½ éœ€è¦å°†å…¬å¸çš„äº‹æƒ…å½“æˆè‡ªå·±å®¶çš„äº‹æƒ…æ¥å¤„ç†ï¼Œå½“ä½ æœ‰è¿™æ ·çš„å¿ƒæ€ï¼Œä½ å°±æ˜¯å†æ€ä¹ˆåŠ ç­éƒ½ä¸ä¼šæœ‰æ€¨è¨€çš„ï¼Œå³ä¾¿åˆ†æ–‡ä¸å–â€¦ ï¼ˆæœ‰è°è§è¿‡ç»™è‡ªå·±å®¶è£…ä¿®å«è‹¦ä¸è¿­çš„ï¼Ÿï¼‰å¦‚æœä½ å¯ä»¥é•¿æœŸä¿æŒè¿™æ ·çš„çŠ¶æ€ï¼Œä½ çš„è¿™ç§çŒ®èº«ç²¾ç¥å’Œæ•¬ä¸šç²¾ç¥ï¼Œä¼šå¾ˆè½»æ˜“åœ°æ„ŸæŸ“ä½ çš„ä¸‹å±å’Œä½ çš„åŒäº‹ï¼Œä½ ä¼šæ„Ÿè§‰åˆ°åœ¨å…¬å¸å·¦å³é€¢æºï¼Œè€Œä¸”ä½ ä¹Ÿä¼šæ›´æœ‰è¯è¯­æƒï¼Œå¤§å®¶ä¼šæ›´é‡è§†ä½ çš„æ„è§ï¼ŒåŒäº‹å’Œä¸‹å±ä¹Ÿä¼šå¯¹ä½ æŠ¥ä»¥æ›´å¤šçš„ä¿¡ä»»ã€‚å½“è¿™ç§æƒ…å†µå‡ºç°æ—¶ï¼Œç®¡ç†èµ·ä¸‹å±è¿˜ä¼šå›°éš¾å—ï¼Ÿä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ çš„æ•¬ä¸šç²¾ç¥ä¸æ˜¯è¯´ä½“ç°åœ¨æ— ä¼‘æ­¢çš„åŠ ç­ä¸Šï¼Œå·¥ä½œå¼‚å¸¸ç¹å¿™ã€ç»å¸¸æ€§åŠ ç­å…¶å®æ˜¯å·¥ä½œæ²¡æœ‰åšå¥½çš„è¡¨ç°ä¹‹ä¸€ï¼ŒåŠ ç­åªåº”è¯¥å‡ºç°åœ¨ç´§æ€¥æƒ…å†µå‘ç”Ÿçš„æ—¶å€™ï¼Œè€Œä¸åº”è¯¥æ˜¯ä¸€ç§å¸¸æ€ã€‚ 3ã€æŠ€æœ¯å¦‚æœæœ‰äººé—®æˆ‘ï¼ŒæŠ€æœ¯äººå‘˜å’Œå…¶ä»–äººå‘˜æœ€å¤§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆã€‚æˆ‘ä¼šå‘Šè¯‰ä»–ï¼šæŠ€æœ¯äººå‘˜ä¸ªä¸ªè‡ªä»¥ä¸ºæ˜¯ï¼Œè®¤ä¸ºåˆ«äººçš„æŠ€æœ¯éƒ½ä¸å¦‚è‡ªå·±ã€‚ å¯èƒ½å¤§å®¶ä¸çˆ±å¬ï¼Œä½†æˆ‘è§‚å¯Ÿåˆ°çš„ç°è±¡å°±æ˜¯è¿™æ ·çš„ï¼Œè€Œä¸”å¾€å¾€é‚£äº›è‡ªè®¤ä¸ºæ‡‚å¾—å¾ˆå¤šçš„äººï¼Œå®é™…æ˜¯è¿˜æ²¡æ•²å¼€çŸ¥è¯†çš„å¤§é—¨ã€‚ å¾ˆå°‘æœ‰äººæ„¿æ„å»è¯»åˆ«äººçš„ä»£ç ï¼Œå½¼æ­¤éƒ½è§‰å¾—å†™å¾—å¥½çƒ‚ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³èµ¢å¾—æŠ€æœ¯äººå‘˜çš„é’¦ä½©ï¼Œä½ éœ€è¦æœ‰å‹å€’æ€§çš„æŠ€æœ¯èƒ½åŠ›ã€‚è¿™ä¸ªå‹å€’æ€§çš„ä¼˜åŠ¿ï¼Œä¸æ˜¯ä¸‹å±70åˆ†ï¼Œä½ 80åˆ†ï¼Œè€Œæ˜¯ä¸‹å±70åˆ†ï¼Œä½ è¦åšåˆ°100åˆ†ï¼›ä¸‹å±100åˆ†ï¼Œä½ è¦åšåˆ°150åˆ†ã€‚æ‰€ä»¥ï¼Œç¼ºä¹æŠ€æœ¯èƒ½åŠ›çš„äººå»ç®¡ç†æŠ€æœ¯äººå‘˜å¾€å¾€æ˜¯åƒåŠ›ä¸è®¨å¥½çš„ï¼Œå¯èƒ½ä¸‹å±è¡¨é¢ä¸Šæœä»ä½ ï¼Œå¿ƒé‡Œæ ¹æœ¬ä¸å½“ä½ ä¸€å›äº‹å„¿ï¼Œè¿™æ ·ç®¡ç†èµ·æ¥å°±å­˜åœ¨éšœç¢äº†ã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„å¾·è¡Œéå¸¸å¥½ï¼Œä¹Ÿéå¸¸æ•¬ä¸šï¼ŒæŠ€æœ¯å°±æ˜¾å¾—ä¸é‚£ä¹ˆé‡è¦äº†ï¼›è€Œå¦‚æœä½ å·²ç»æ»¡è¶³äº†å‰é¢ä¸¤æ¡ï¼ŒåŒæ—¶æŠ€æœ¯ä¹Ÿå¾ˆç²¾æ¹›ï¼Œé‚£è‡ªç„¶æ˜¯é”¦ä¸Šæ·»èŠ±äº†ã€‚ ä¸Šé¢å°±æ˜¯ä¸€ç‚¹ç‚¹å¿ƒå¾—ï¼Œæ¬¢è¿äº¤æµã€‚","categories":["é¡¹ç›®ç®¡ç†"]},{"title":"Electronåˆ¤æ–­ç¨‹åºè¿è¡Œç¯å¢ƒ","path":"/post/612028078.html","content":"Electronå®˜æ–¹æœªæä¾›åˆ¤æ–­å½“å‰ç¨‹åºè¿è¡Œç¯å¢ƒçš„æ–¹æ³•ã€‚æˆ‘è®¤ä¸ºå®˜æ–¹ä¸æä¾›è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯è¯´çš„è¿‡å»çš„ï¼Œå› ä¸ºElectronæ‰®æ¼”çš„æ˜¯åº”ç”¨å¼€å‘æ¡†æ¶çš„è§’è‰²ï¼Œè€Œè¿è¡Œç¯å¢ƒè¿™äº›ä¸œè¥¿æœ¬èº«å±äºå¼€å‘è€…è‡ªå·±çš„äº‹æƒ…ï¼Œæœ‰çš„å¼€å‘è€…å–œæ¬¢å®šä¹‰â€œå¼€å‘ã€æµ‹è¯•ã€é¢„ç”Ÿäº§ã€ç”Ÿæˆâ€å››ä¸ªç¯å¢ƒï¼Œè€Œæœ‰çš„å¼€å‘è€…å´åªå®šä¹‰äº†ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œè¿™äº›éƒ½ä¸æ˜¯æ¡†æ¶éœ€è¦å‚ä¸çš„äº‹æƒ…ã€‚ æœ¬æ–‡æä¾›äº†å‡ ä¸ªå®šä¹‰å’Œåˆ¤æ–­ç¨‹åºè¿è¡Œç¯å¢ƒçš„æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰å–ç›¸åº”çš„æ–¹æ³•ã€‚ 1. app.isPackagedElectronå®˜æ–¹æä¾›äº†app.isPackagedå±æ€§æ¥åˆ¤æ–­åº”ç”¨æ˜¯å¦æ˜¯ç»è¿‡æ‰“åŒ…çš„ã€‚ app.isPackaged çš„åŸç†æ˜¯åˆ¤æ–­è¿›ç¨‹åç§°æ˜¯å¦ä¸º electron æˆ– electron.exeï¼Œå¦‚æœåç§°åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰åˆ™æ˜¯æ‰“åŒ…ç¯å¢ƒã€‚ é€šå¸¸å°†æ‰“åŒ…ç¯å¢ƒå½“ä½œç”Ÿäº§ç¯å¢ƒï¼Œä½†è¿™å¹¶ä¸æ˜¯å¼ºåˆ¶æ€§çš„è§„åˆ™ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±é€šè¿‡ä»£ç å®ç°åˆ¤æ–­ç¨‹åºè¿›ç¨‹åï¼š 123456789101112131415function isProduction() &#123; if (!process.versions.electron) &#123; // Node.js process return false; &#125; if (process.platform === &quot;darwin&quot;) &#123; return !/\\/Electron\\.app\\//.test(process.execPath); &#125; if (process.platform === &quot;win32&quot;) &#123; return !/\\\\electron\\.exe$/.test(process.execPath); &#125; if (process.platform === &quot;linux&quot;) &#123; return !/\\/electron$/.test(process.execPath); &#125;&#125; 2. æ ¹æ®å‘½ä»¤è¡Œå‚æ•°åˆ¤æ–­é€šè¿‡åœ¨ä¸åŒç¯å¢ƒä¸­ä¸ºç¨‹åºæ·»åŠ ä¸åŒçš„å¯åŠ¨å‚æ•°ï¼Œç„¶ååœ¨è¿è¡Œæ—¶æ ¡éªŒè¿™äº›å‘½ä»¤è¡Œå‚æ•°æ¥åˆ¤æ–­å½“å‰çš„è¿è¡Œç¯å¢ƒã€‚ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸æ·»åŠ ä»»ä½•å¯åŠ¨å‚æ•°ï¼Œå› æ­¤æ²¡æœ‰å¯åŠ¨å‚æ•°çš„å°±ä¸ºç”Ÿäº§ç¯å¢ƒï¼›å¦‚æœæœ‰å¯åŠ¨å‚æ•°ï¼Œå†æ ¹æ®å‚æ•°åˆ¤æ–­æ˜¯å¦ä¸ºæµ‹è¯•æˆ–é¢„å‘å¸ƒç­‰ç¯å¢ƒã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ä¸åŒçš„ç¯å¢ƒæ·»åŠ å¯åŠ¨å‚æ•°çš„æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒä¸éœ€è¦æ‰“åŒ…ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼æ·»åŠ ï¼š 1electron . --env=development è€Œéå¼€å‘ç¯å¢ƒå¾€å¾€éœ€è¦æ‰“åŒ…ï¼Œéœ€è¦åœ¨å‘½ä»¤è¡Œä¸­æ‰‹åŠ¨æ·»åŠ ï¼Œå¦‚ï¼š 1Demo.exe --env=test åˆ¤æ–­æ–¹æ³•å¦‚ä¸‹ï¼š 12345678910111213141516function isProduction() &#123; if (!process.versions.electron) &#123; // Node.js process return false; &#125; for (const v of process.argv) &#123; if (v === &quot;--env=development&quot; || // å¼€å‘ç¯å¢ƒ v === &quot;--env=test&quot; // æµ‹è¯•ç¯å¢ƒ ) &#123; return false; &#125; &#125; return true;&#125; 3. é€šè¿‡ç¯å¢ƒå˜é‡åˆ¤æ–­è¿™ä¸ªåˆ¤æ–­æ–¹æ³•ä¸æ–¹æ³•2ç±»ä¼¼ï¼Œä¸åšè¿‡å¤šä»‹ç»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWindowså’ŒUnixä¸Šæ·»åŠ ç¯å¢ƒå˜é‡çš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚ Windows: 1set APP_ENV=dev &amp;&amp; electron . Unix: 1APP_ENV=dev electron . åœ¨Electronä¸­é€šè¿‡process.env.APP_ENVæ–¹å¼å°±å¯ä»¥è·å–åˆ°APP_ENVç¯å¢ƒå˜é‡ã€‚","tags":["Electron"],"categories":["Electron"]},{"title":"Electronå¯åŠ¨å’Œç¦ç”¨è°ƒè¯•å·¥å…·çš„æ–¹æ³•","path":"/post/2191045165.html","content":"1. å¯ç”¨è°ƒè¯•å·¥å…·Electronä¸­æ‰“å¼€è°ƒè¯•çª—å£çš„æ–¹æ³•æœ‰å¤šç§ï¼Œä½†å‰æéƒ½éœ€è¦åœ¨åˆ›å»ºBrowser Windowæ—¶å¯ç”¨devToolsç‰¹æ€§ï¼Œå¦‚ï¼š 12345678const win = new BrowserWindow(&#123; width: 1080, height: 768, title: &quot;test window&quot;, webPreferences: &#123; devTools: true &#125;&#125;); å¯ç”¨devToolsç‰¹æ€§åï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼æ‰“å¼€è°ƒè¯•çª—å£ï¼š æ–¹å¼1åœ¨ä»£ç ä¸­ä½¿ç”¨BrowserWindow.webContents.openDevTools()æ‰“å¼€è°ƒè¯•çª—å£ã€‚ æ–¹å¼2é€šè¿‡å¿«æ·é”®Ctrl+Shift+Iæ‰“å¼€è°ƒè¯•çª—å£ã€‚ æ–¹å¼3åœ¨ç¨‹åºçš„å¯åŠ¨å‘½ä»¤è¡Œä¸­æ·»åŠ --remote-debugging-port=8888å‚æ•°ï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è°ƒè¯•é¡µé¢http://127.0.0.1:8888å³å¯è¿›è¡Œè°ƒè¯•ã€‚ è¿™ç§æ–¹å¼é»˜è®¤è°ƒè¯•çš„æ˜¯æ¸²æŸ“è¿›ç¨‹ï¼Œå¦‚éœ€è°ƒè¯•ä¸»è¿›ç¨‹åˆ™éœ€è¦ä½¿ç”¨--inspect=8888å‚æ•°ã€‚ å¦å¤–ï¼Œå¦‚æœæ‰“å¼€è°ƒè¯•é¡µé¢æ—¶æç¤ºWebSockets request was expectedè€Œæ— æ³•æ˜¾ç¤ºè°ƒè¯•å·¥å…·ï¼Œéœ€è¦ä½¿ç”¨è®¿é—®chrome://inspect/æ‰“å¼€inspecté¡µé¢ï¼Œé…ç½®å¯¹åº”çš„å‘ç°ipå’Œç«¯å£ï¼Œå¦‚localhost:8888ï¼š é…ç½®å®Œæˆåï¼Œåˆ·æ–°inspecté¡µé¢ååœ¨Remote Targetä¸­é€‰æ‹©å¯¹åº”çš„è°ƒè¯•ç›®æ ‡è¿›è¡Œè°ƒè¯•ã€‚ 2. ç¦ç”¨è°ƒè¯•å·¥å…·åœ¨è½¯ä»¶ä¸Šçº¿å‘å¸ƒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒå®Œå…¨ç¦ç”¨è°ƒè¯•å·¥å…·ï¼Œæ­¤æ—¶åªéœ€è¦å°†devToolså±æ€§è®¾ç½®ä¸ºfalseå³å¯ï¼Œå¦‚ï¼š 12345678const win = new BrowserWindow(&#123; width: 1080, height: 768, title: &quot;test window&quot;, webPreferences: &#123; devTools: false &#125;&#125;); ä¸Šé¢çš„ä»£ç è™½ç„¶å¯ä»¥ç¦ç”¨è°ƒè¯•å·¥å…·ï¼Œä½†åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦æ‰“å¼€è°ƒè¯•å·¥å…·ï¼Œå› æ­¤åœ¨æ¯æ¬¡â€œå¼€å‘-&gt;å‘å¸ƒç‰ˆæœ¬â€æ—¶éƒ½éœ€è¦æ¥å›ä¿®æ”¹devToolsï¼Œå®¹æ˜“å‡ºç°æ¼æ”¹çš„æƒ…å†µã€‚ å¯ä»¥ä½¿ç”¨Electronåˆ¤æ–­ç¨‹åºè¿è¡Œç¯å¢ƒä»‹ç»çš„æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒï¼Œå¯ç”¨&#x2F;ç¦ç”¨devToolsçš„ä»£ç å¯ä»¥ä¼˜åŒ–ä¸ºï¼š 12345678const win = new BrowserWindow(&#123; width: 1080, height: 768, title: &quot;test window&quot;, webPreferences: &#123; devTools: !isProduction() &#125;&#125;);","tags":["Electron","DevTools"],"categories":["Electron"]},{"title":"å¦‚ä½•åœ¨æ‰¹å¤„ç†ä¸­æ‰§è¡ŒSQL","path":"/post/4169328538.html","content":"ç¤ºä¾‹å¦‚ä¸‹ï¼š 123&quot;%~dp0\\mysql-5.6.19-win32\\bin\\mysql.exe&quot; ^ -h127.0.0.1 -P31060 -uroot ^ --execute=&quot;update mysql.user SET password=PASSWORD(&#x27;123456&#x27;) WHERE user=&#x27;root&#x27;;&quot;;","tags":["MySQL","æ‰¹å¤„ç†"],"categories":["Windowsæ‰¹å¤„ç†"]},{"title":"ç”±HANDLEè¿”å›å€¼ä¸ç¡®å®šæ€§å¼•å‘çš„æ€è€ƒ","path":"/post/3906615635.html","content":"HANDLEç±»å‹è¿”å›å€¼çš„ä¸ç¡®å®šæ€§æŒ‡çš„æ˜¯Windows APIå‡½æ•°çš„è¿”å›å€¼ä¸ºHANDLEç±»å‹æ—¶ï¼Œæœ‰ä¸¤ç§è¡¨ç¤ºå¤±è´¥çš„æ–¹å¼ï¼š HANDLE &#x3D;&#x3D; NULLï¼Œå¦‚CreateEventç­‰ HANDLE &#x3D;&#x3D; INVALID_HANDLE_VALUEï¼Œå¦‚CreateFileç­‰ å…¶ä¸­ï¼ŒNULLçš„å€¼å§‹ç»ˆä¸º0ï¼Œè€ŒINVALID_HANDLE_VALUEçš„å€¼ä¸º-1ï¼Œå…¶åœ¨32ä½å’Œ64ä½ç¨‹åºä¸­åˆ†åˆ«ç­‰äº0xFFFFFFFFå’Œ0xFFFFFFFFFFFFFFFFã€‚ å…·ä½“å“ªäº›å‡½æ•°å¤±è´¥æ—¶è¿”å›NULLï¼Œå“ªäº›è¿”å›INVALID_HANDLE_VALUEäº†ï¼Ÿè¿™ä¸ªéœ€è¦æŸ¥é˜…MSDNæ–‡æ¡£æ¥ç¡®å®šã€‚ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸¤ç§æƒ…å†µäº†ï¼Ÿæ ¹æ®Windowså¼ºå¤§çš„å…¼å®¹æ€§ï¼Œæˆ‘ä»¬ä¸èƒ½çŒœæµ‹å‡ºè¿™ä¹ˆåšæ˜¯ä¸ºäº†å‘å‰å…¼å®¹ï¼Œä¸ºäº†å…¼å®¹ä»¥å‰çš„16ä½ç¨‹åºï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰æ”¹å˜ã€‚ åœ¨16ä½ç¨‹åºä¸­æ— æ•ˆçš„HANDLEå€¼ä¸ºINVALID_HANDLE_VALUEï¼Œåœ¨16ä½ç¨‹åºä¸­-1ä¸º0xFFFFï¼Œè€Œåˆ°äº†32ä½ï¼ˆæˆ–64ä½ï¼‰æ—¶ä»£ï¼Œ-1åˆ™ä¸º0xFFFFFFFFï¼ˆæˆ–0xFFFFFFFFFFFFFFFFï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ¤æ–­HANDLEæ˜¯å¦åˆæ³•æ—¶ï¼Œè¦ç‰¹åˆ«ç•™æ„ï¼Œéœ€è¦æ ¹æ®APIçš„ä¸åŒæ¥åšä¸åŒçš„åˆ¤æ–­ã€‚ éœ€è¦æ³¨æ„GetCurrentProcess()ç”¨äºè·å–å½“å‰è¿›ç¨‹çš„ä¼ªå¥æŸ„ï¼Œå½“å‰è¿›ç¨‹çš„ä¼ªå¥æŸ„å€¼æ˜¯-1ï¼Œæ°å¥½ä¸INVALID_HANDLE_VALUEå€¼ç›¸ç­‰ã€‚ å› æ­¤ç”¨ WaitForSingleObject ç­‰å¾… INVALID_HANDLE_VALUE ä¹Ÿå°±æ˜¯ç­‰åŒäºç­‰å¾…å½“å‰è¿›ç¨‹ç»“æŸã€‚","tags":["å¥æŸ„"],"categories":["Windowsç¼–ç¨‹"]},{"title":"ç•™è¨€æ¿","path":"/post/2185937873.html","content":"æ¥éƒ½æ¥äº†ï¼Œé‚£å°±ç•™ä¸‹ç‚¹ä»€ä¹ˆå§ï¼"},{"title":"ğŸ”¥åŒ å¿ƒä¹‹ä½œ","path":"/post/3416050985.html","content":"æœ¬ç¯‡æ±‡æ€»äº†åœ¨æœ¬ç«™ä¸­æåŠçš„ã€ç”±æˆ‘å¼€å‘çš„å°å·¥å…·å’Œå¼€æºé¡¹ç›®ã€‚ å·¥å…·æ‰€æœ‰å·¥å…·ä»å®ç”¨æ€§å‡ºå‘ï¼ŒåŠ›æ±‚æ¯ä¸ªåŠŸèƒ½èƒ½å¤Ÿç®€å•æ˜“ç”¨ï¼Œä¸å•çº¯åœ°åšåŠŸèƒ½çš„å †ç Œè€…ï¼Œäº¦ä¸åšå¹¿å‘Šçš„ä¼ æ’­è€…ã€‚ ä¸€é”®å¯åŠ¨ç¥å™¨ä¹‹1key.run TinyTu-è·¨å¹³å°å›¾ç‰‡å‹ç¼©è½¯ä»¶ Windowsçª—å£è°ƒè¯•åˆ©å™¨-WinSpyPlus å¼€æºåº“ åŸºäºå…±äº«å†…å­˜çš„è·¨å¹³å°RPCæ¡†æ¶ - Veigar é«˜é€Ÿæ–‡ä»¶ä¸‹è½½å™¨çš„å®ç° åŸºäºQtçš„æ— è¾¹æ¡†çª—ä½“å®ç° äº§å“çº§çš„Electroné¡¹ç›®æ¨¡æ¿ æ›´å¤šå¼€æºé¡¹ç›®å’Œå·¥å…·è§æˆ‘çš„Githubã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","categories":["Power By Me"]},{"title":"çª—å£æ— æ³•æ¥æ”¶WM_LBUTTONDBLCLKæ¶ˆæ¯","path":"/post/1955778079.html","content":"åœ¨å¼€å‘ä¸­é‡åˆ°äº†å¦‚ä¸‹é—®é¢˜ï¼š é€šè¿‡é¼ æ ‡é’©å­è·å–æŸçª—å£çš„æ¶ˆæ¯ï¼Œå‘ç°å¯ä»¥æ¥æ”¶åˆ°WM_LBUTTONDOWNæ¶ˆæ¯ï¼Œä½†å§‹ç»ˆæ— æ³•æ¥æ”¶åˆ°WM_LBUTTONDBLCLKæ¶ˆæ¯ã€‚ ç»è¿‡ä¸€ç•ªæ’æŸ¥ï¼Œå‘ç°Windowsçª—å£åªæœ‰åœ¨æ‹¥æœ‰CS_DBLCLKSç±»æ ·å¼æ—¶æ‰èƒ½æ¥æ”¶åˆ°é¼ æ ‡åŒå‡»äº‹ä»¶ï¼Œå³åœ¨RegisterClassExå‡½æ•°çš„WNDCLASSEX.styleå‚æ•°ä¸­æŒ‡å®šCS_DBLCLKSæ ·å¼ã€‚ ä½†æ˜¯çª—å£ä¸æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ï¼Œèƒ½å¦é€šè¿‡SetClassLongPtrå‡½æ•°æ¥é€šè¿‡å¥æŸ„æ”¹å˜çª—å£ç±»æ ·å¼ï¼Œç»è¿‡å¤šæ–¹å°è¯•æœ€ç»ˆä»¥å¤±è´¥å‘Šç»ˆï¼ˆSetClassLongPtrè¿”å›å€¼0ï¼ŒGetLastErrorä¹Ÿä¸º0ï¼‰ã€‚","tags":["çª—å£æ¶ˆæ¯"],"categories":["Windowsç¼–ç¨‹"]},{"title":"TinyTu-è·¨å¹³å°å›¾ç‰‡å‹ç¼©è½¯ä»¶","path":"/post/2053741240.html","content":"æˆ‘å¹³æ—¶å‹ç¼©å›¾ç‰‡é€šå¸¸ä¼šä½¿ç”¨ç±»ä¼¼ tinify è¿™æ ·çš„åœ¨çº¿å‹ç¼©ç½‘ç«™ï¼Œè¿™äº›ç½‘ç«™æœ‰å¾ˆå¤šï¼Œä½†ä½¿ç”¨èµ·æ¥æ€»æ˜¯æ„Ÿè§‰ä¸å¤ªèˆ’çˆ½ï¼Œä¼¼ä¹å·®äº†ç‚¹ä»€ä¹ˆï¼Œä»”ç»†æƒ³æƒ³å®ƒä»¬æˆ–å¤šæˆ–å°‘æœ‰è¿™äº›ç¼ºç‚¹ï¼š æœ‰çš„ç½‘ç«™éœ€è¦æ”¶è´¹æˆ–è€…åŠæ”¶è´¹ã€‚ æ”¯æŒå›¾ç‰‡æ ¼å¼ä¸å…¨ï¼Œä¾‹å¦‚æœ‰çš„ç½‘ç«™ä»…PNGæ ¼å¼ï¼Œè€Œæœ‰çš„ç½‘ç«™åˆä¸æ”¯æŒjpgã€gifç­‰ã€‚ é€šå¸¸è¿˜ä¼šé™åˆ¶ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡å’Œå¤§å°ï¼Œæ¯•ç«Ÿä¸Šä¼ å’Œä¸‹è½½éƒ½ä¼šæ¶ˆè€—æœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ï¼Œç½‘ç«™ä¸ºäº†èŠ‚çœæˆæœ¬åšå‡ºæ­¤é™åˆ¶ã€‚ å›¾ç‰‡çš„å‹ç¼©é€Ÿåº¦è¾ƒæ…¢ï¼Œæ¯•ç«Ÿå‹ç¼©é€Ÿåº¦è¶Šå¿«å¯¹æœåŠ¡å™¨çš„ç¡¬ä»¶è¦æ±‚è¶Šé«˜ï¼Œæˆæœ¬ä¹Ÿä¼šè¶Šé«˜ã€‚ 1. TinyTuè¿™äº›æ¯›ç—…æˆ‘å·²ç»å¿äº†è®¸ä¹…ï¼Œä»Šå¤©æˆ‘ä¸æƒ³å†å¿äº†ï¼Œç»è¿‡æˆ‘ä¸€é¡¿æŠ˜è…¾ï¼ˆä¸å¾—ä¸è¯´ï¼Œæƒ³åšå¾—å¥½ç”¨è¿˜å¾—è´¹ç‚¹å¿ƒæ€ï¼‰ï¼Œä¸€æ¬¾åä¸ºTinyTuçš„å›¾ç‰‡å‹ç¼©è½¯ä»¶åº”è¿è€Œç”Ÿã€‚å› ä¸ºTinyTuæ˜¯æœ¬åœ°å®¢æˆ·ç«¯è½¯ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šé™åˆ¶å›¾ç‰‡çš„æ•°é‡ã€å¤§å°ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨æœ¬æœºGPUè¿›è¡Œç¡¬ä»¶åŠ é€Ÿï¼Œæå‡å›¾ç‰‡å‹ç¼©é€Ÿåº¦ã€‚ TinyTuèµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä¸éœ€è¦é¢å¤–é…ç½®ï¼Œåªéœ€è¦æ‹–å…¥å›¾ç‰‡ï¼Œç„¶åç‚¹å‡»â€œç«‹å³å‹ç¼©â€å³å¯ã€‚ ç›®å‰æ”¯æŒçš„å›¾ç‰‡æ ¼å¼æœ‰ï¼š PNG JPEG Gif TTF ä¸æ–­æ‰©å±•ä¸­â€¦ 2. ä¸‹è½½ Githubï¼ˆæ›´æ–°åŠæ—¶ï¼‰ https://github.com/winsoft666/TinyTu-Setup/releases å¥¶ç‰›å¿«ä¼ ï¼ˆæ›´æ–°å¯èƒ½å»¶åï¼‰ https://cowtransfer.com/s/7a17d7cc96e242 3. å‹ç¼©æ¨¡å¼TinyTuç›®å‰æ”¯æŒå›¾åƒæ¸…æ™°åº¦ä¼˜å…ˆã€æ™®é€šå‹ç¼©ã€æé™å‹ç¼©ä¸‰ä¸ªæŒ¡ä½çš„å‹ç¼©æ¨¡å¼ã€‚ è¿™æ ·æå¤§ç®€åŒ–äº†ç”¨æˆ·è®¾ç½®ï¼Œç”¨æˆ·åªéœ€é€‰æ‹©æŸä¸ªå‹ç¼©æ¨¡å¼ï¼ŒTinyTuä¼šè‡ªåŠ¨åœ¨æ–‡ä»¶å¤§å°å’Œå›¾ç‰‡è´¨é‡é—´è¿›è¡Œæƒè¡¡ï¼Œè¾¾åˆ°æœ€ç†æƒ³çš„å‹ç¼©æ•ˆæœã€‚ é»˜è®¤å€¼ä¸ºâ€œæ™®é€šå‹ç¼©â€ï¼Œè¯¥æŒ¡ä½å·²å¯ä»¥åª²ç¾å¾ˆå¤šåœ¨çº¿ç½‘ç«™çš„å‹ç¼©æ•ˆæœã€‚ 3.1 é«˜çº§é€‰é¡¹å¦‚æœé¢„è®¾çš„ä¸‰ç§å‹ç¼©æ¨¡å¼æ— æ³•æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œæˆ–è€…æ‚¨æƒ³è‡ªå®šä¹‰å‹ç¼©å‚æ•°ï¼Œå¯ä»¥é€šè¿‡å•å‡»æ–‡ä»¶åˆ—è¡¨ä¸­çš„â€œé«˜çº§é€‰é¡¹â€æŒ‰é’®æ‰“å¼€é€‰é¡¹ç•Œé¢è¿›è¡Œé…ç½®ã€‚ è¯¥åŠŸèƒ½éœ€è¦è¾“å…¥åºåˆ—å·æ¿€æ´»åæ‰èƒ½ä½¿ç”¨ã€‚ 4. è¾“å‡ºç­–ç•¥TinyTuç›®å‰æ”¯æŒä¸‰ç§ä¿å­˜å‹ç¼©åæ–°æ–‡ä»¶çš„æ–¹å¼ï¼š ç›´æ¥è¦†ç›–æºæ–‡ä»¶ã€‚ è¿™ç§æ–¹å¼ä¼šç›´æ¥ä½¿ç”¨å‹ç¼©åçš„æ–‡ä»¶è¦†ç›–æºæ–‡ä»¶ï¼ˆå³å‹ç¼©å‰çš„æ–‡ä»¶ï¼‰ã€‚ è¾“å‡ºåˆ°æºç›®å½•ï¼ˆé»˜è®¤ï¼‰ è¯¥æ–¹å¼ä¼šå°†å‹ç¼©åçš„æ–‡ä»¶è¾“å‡ºåˆ°å’Œæºæ–‡ä»¶ç›¸åŒçš„æ–‡ä»¶å¤¹ï¼Œä½†ä¼šåœ¨æ–°æ–‡ä»¶ååæ·»åŠ â€œTinyTuâ€å°¾ç¼€ï¼Œå¦‚test.pngå‹ç¼©åçš„å›¾ç‰‡ä¸ºtest_TinyTu.pngã€‚ è¾“å‡ºåˆ°å…¶ä»–ç›®å½•ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„æ–‡ä»¶å¤¹ä½œä¸ºå‹ç¼©åæ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚ 5. è·³è¿‡å·²å®Œæˆæ–‡ä»¶è¯¥é€‰é¡¹é»˜è®¤å¼€å¯ã€‚ æœ‰è¿™æ ·ä¸€ç§åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å‘åˆ—è¡¨ä¸­æ·»åŠ äº†5ä¸ªæ–‡ä»¶å¹¶å·²å‹ç¼©å®Œæˆï¼Œæ­¤æ—¶éœ€è¦å†æ·»åŠ æ–°çš„æ–‡ä»¶ç»§ç»­å‹ç¼©ï¼Œé€šè¿‡è®¾ç½®è¯¥é€‰é¡¹TinyTuä¼šè·³è¿‡ä¹‹å‰å·²ç»å®Œæˆçš„æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬æ¯æ¬¡æ·»åŠ æ–°æ–‡ä»¶å‰éƒ½è¦æ¸…ç©ºåˆ—è¡¨ã€‚ 6. å·¥ä½œçº¿ç¨‹æ•°é‡é»˜è®¤4ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥åŒæ—¶å‹ç¼©4ä¸ªæ–‡ä»¶ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["TinyTu"],"categories":["Power By Me"]},{"title":"QListWidgetä½¿ç”¨è®°å½•","path":"/post/3168359900.html","content":"1. è§£å†³æ— æ³•æ‹–å…¥æ–‡ä»¶åˆ°QListWidgetä¸€èˆ¬è€Œè¨€ï¼Œåªéœ€è¦åšå¦‚ä¸‹æ“ä½œï¼ŒQWidgetå³å¯æ”¯æŒæ‹–å…¥æ–‡ä»¶ï¼š 12345678setDragDropMode(QAbstractItemView::DropOnly); // ä»…æ”¯æŒæ‹–å…¥æ–‡ä»¶// é‡å†™dragEnterEventï¼Œå½“æ‹–å…¥æ–‡ä»¶è¿›å…¥æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¯¥å‡½æ•°ä¸­å–æ¶ˆæ‹–å…¥æ“ä½œvoid dragEnterEvent(QDragEnterEvent* e) override;// é‡å†™dropEventï¼Œå½“æ‹–å…¥æ–‡ä»¶å¹¶é‡Šæ”¾é¼ æ ‡æ—¶è¢«è°ƒç”¨void dropEvent(QDropEvent* e) override; ä½†åœ¨æ‰§è¡Œä¸Šè¿°æ“ä½œåï¼Œæˆ‘ä»¬æ‹–å…¥æ–‡ä»¶åˆ°QListWidgetæ—¶ï¼Œå´åªèƒ½æ”¶åˆ°dragEnterEventäº‹ä»¶ï¼Œå´æ— æ³•æ”¶åˆ°dropEventäº‹ä»¶ã€‚ å› ä¸ºè¿˜éœ€è¦é‡å†™dragMoveEventæ–¹æ³•ï¼Œå¦‚ï¼š 123void dragMoveEvent(QDragMoveEvent* e) &#123; e-&gt;acceptProposedAction();&#125; 2. QListWidgetItemè‡ªé€‚åº”å°ºå¯¸QListWidgetæ·»åŠ itemçš„æ–¹æ³•å¦‚ä¸‹ï¼š 123456QListWidget* list = new QListWidget();// ...QListWidgetItem* item = new QListWidgetItem();list-&gt;addItem(item); å¦‚éœ€è¦è‡ªå®šä¹‰Itemçš„å¸ƒå±€ï¼Œè¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰Widgetæ¥å®ç°ï¼Œå¦‚ï¼š 123456789QListWidget* list = new QListWidget();// ...QListWidgetItem* item = new QListWidgetItem();list-&gt;addItem(item);CustomWidget * customWidget = new CustomWidget();list-&gt;setItemWidget(item, customWidget); // è®¾ç½®Itemçš„è‡ªå®šä¹‰Widget æ­¤æ—¶ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºitemè®¾ç½®size hintï¼Œitemä¼šè‡ªåŠ¨æ ¹æ®itemçš„æ•°æ®ï¼ˆå¦‚textï¼‰è®¡ç®—size hintã€‚ä½†å¦‚æœæ˜¯è‡ªå®šä¹‰çš„Widgetï¼Œåˆ™æ— æ³•è‡ªåŠ¨è®¡ç®—size hintï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®size hintï¼Œå¦‚ï¼š 123456int vScrollbarWidth = 0;if (verticalScrollBar()) vScrollbarWidth = verticalScrollBar()-&gt;width();// å‡å»çºµåæ ‡çš„å®½åº¦item-&gt;setSizeHint(QSize(list-&gt;width() - vScrollbarWidth, widget-&gt;height())); QListWidgetçš„æ»šåŠ¨æ¡é»˜è®¤æ˜¾ç¤ºç­–ç•¥æ˜¯ScrollBarAsNeededï¼Œå½“å®½åº¦ä¸å¤Ÿæ˜¾ç¤ºItemæ—¶ï¼Œæ»šåŠ¨æ¡å°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ­¤æ—¶è™½ç„¶QListWidgetå®½åº¦æ”¹å˜äº†ï¼Œä½†Itemçš„å®½åº¦å´ä¸ä¼šæ”¹å˜ï¼ŒItemä¸ä¼šæ”¶åˆ°ResizeEventäº‹ä»¶ã€‚å¦‚éœ€Itemçš„å®½åº¦è·ŸéšQListWidgetå®½åº¦è€Œæ”¹å˜ï¼Œåˆ™éœ€è¦å…³é—­æ»šåŠ¨æ¡æ˜¾ç¤ºï¼Œå¹¶åœ¨ QListWidget çš„ ResizeEvent äº‹ä»¶ä¸­å®æ—¶è®¾ç½®æ¯ä¸ªItemçš„size hintï¼Œä»£ç å¦‚ä¸‹ï¼š 12// å…³é—­æ»šåŠ¨æ¡list-&gt;setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff); 123456789101112131415161718void FileList::resizeEvent(QResizeEvent* e) &#123; int vScrollbarWidth = 0; if (verticalScrollBar()) vScrollbarWidth = verticalScrollBar()-&gt;width(); int w = width(); int cnt = count(); for (int i = 0; i &lt; cnt; i++) &#123; QListWidgetItem* it = item(i); if (it) &#123; CustomWidget* customWidget = dynamic_cast&lt;CustomWidget*&gt;(itemWidget(it)); if (customWidget) &#123; it-&gt;setSizeHint(QSize(w - vScrollbarWidth, customWidget-&gt;height())); &#125; &#125; &#125; QListWidget::resizeEvent(e);&#125;","tags":["Qt","QListWidget"],"categories":["Qt"]},{"title":"Qté™æ€åº“ç¼–è¯‘","path":"/post/3406024791.html","content":"ä½¿ç”¨Qté™æ€åº“è¿èƒŒäº†Qtçš„å…è´¹ä½¿ç”¨åè®®ï¼ 1. ç¼–è¯‘ç¼–è¯‘Qtæºç éœ€è¦æå‰å®‰è£…å¦‚ä¸‹å·¥å…·ï¼š nasm perl gperf win_flex_bison llvm python2 openssl 2.1 Windowsç¼–è¯‘ä¸ºäº†æ–¹ä¾¿ç¼–è¯‘ï¼Œæˆ‘å·²å°†è¿™äº›å·¥å…·å’Œæ‰“åŒ…è„šæœ¬æäº¤åˆ°äº†æˆ‘çš„å¼€æºé¡¹ç›®qt-source-compileä¸­ã€‚ åªéœ€å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼Œé€‰æ‹©å¯¹åº”çš„æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆå¦‚msvc2022-5.15.2-x86-static-mt.batï¼‰ï¼Œç„¶åç¼–è¾‘è¯¥æ–‡ä»¶ä¸­çš„qt_src_folderå˜é‡ï¼ˆQtæºç è·¯å¾„ï¼‰å’Œvcvarsall_pathå˜é‡ï¼ˆVisual Studioè·¯å¾„ï¼‰ï¼Œæœ€åè¿è¡Œè¯¥æ‰¹å¤„ç†å³å¯ç¼–è¯‘ã€‚ 2. ç–‘éš¾é—®é¢˜opensslé“¾æ¥å¤±è´¥é”™è¯¯æç¤ºå¦‚ä¸‹ï¼š 1ERROR: Feature &#x27;openssl-linked&#x27; was enabled, but the pre-condition &#x27;!features.securetransport &amp;&amp; !features.schannel &amp;&amp; libs.openssl&#x27; failed. ä¸Šè¿°é”™è¯¯å¯èƒ½æ˜¯ç”±äºæŒ‡å®šopensslçš„includeã€libç›®å½•æœ€ååŒ…å«\\å¯¼è‡´ã€‚","tags":["Qt","ç¼–è¯‘"],"categories":["Qt"]},{"title":"Windowsçš„DLLå…¨å±€å…±äº«å˜é‡","path":"/post/3002178342.html","content":"åŒä¸€ä¸ªDLLæ–‡ä»¶å¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹åŠ è½½ã€‚å½“ä¸åŒçš„è¿›ç¨‹å°†DLLæ˜ å°„åˆ°è‡ªå·±çš„å†…å­˜ç©ºé—´æ—¶ï¼Œç³»ç»Ÿä¼šä¸ºDLLä¸­çš„å…¨å±€å’Œé™æ€å˜é‡åˆ›å»ºä¸åŒçš„å®ä¾‹ï¼Œè€Œä¸ä¼šå…±äº«åŒä¸€ä¸ªå˜é‡å®ä¾‹ã€‚ é‚£æˆ‘ä»¬å¦‚ä½•å®ç°åœ¨è¿›ç¨‹é—´å…±äº«DLLå…¨å±€å˜é‡å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨DLLä¸­ä½¿ç”¨å¦‚ä¸‹è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªæ®µï¼Œç”¨æ¥å­˜æ”¾é‚£äº›éœ€è¦å…±äº«çš„å˜é‡ï¼š 1234#pragma data_seg(&quot;AnyName&quot;) // å¼€å§‹// å£°æ˜å˜é‡// ....#pragma data_seg() // ç»“æŸ å…±äº«çš„å˜é‡éœ€è¦è¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”è¿˜è¦è®¾ç½®é“¾æ¥å™¨å¼€å…³ï¼Œä½¿è¯¥æ®µåœ¨æ‰€æœ‰æ˜ å°„DLLçš„è¿›ç¨‹ä¸­æˆä¸ºå…±äº«è¯»å†™å±æ€§ï¼š 12// å…±äº«è¯»å†™#pragma comment(linker,&quot;/SECTION:AnyName,RWS&quot;) ç»è¿‡ä¸Šè¿°æ“ä½œï¼Œå…±äº«çš„å˜é‡å°±å¯ä»¥è·¨ä¸åŒè¿›ç¨‹è¿›è¡Œè¯»å†™æ“ä½œäº†ã€‚","tags":["DLL","å…±äº«å˜é‡"],"categories":["Windowsç¼–ç¨‹"]},{"title":"æ‰¹å¤„ç†æ‚è®°","path":"/post/3801212176.html","content":"1. exitexitå‘½ä»¤ç”¨äºé€€å‡ºå½“å‰çš„æ‰¹å¤„ç†è„šæœ¬ï¼Œå¹¶è¿”å›ä¸€ä¸ªé€€å‡ºä»£ç ExitCodeï¼ˆå³è¿”å›å€¼ï¼‰ã€‚é€€å‡ºä»£ç é€šå¸¸æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºæŒ‡ç¤ºè„šæœ¬æ‰§è¡Œçš„çŠ¶æ€ï¼Œä¾‹å¦‚æˆåŠŸï¼ˆ0ï¼‰æˆ–å¤±è´¥ï¼ˆéé›¶å€¼ï¼‰ã€‚ exitå‘½ä»¤çš„è¯­æ³•ä¸ºï¼š 1exit [/b] [exitCode] å…¶ä¸­ /b é€‰é¡¹è¡¨ç¤ºä»…é€€å‡ºå½“å‰æ‰¹å¤„ç†è„šæœ¬çš„æ‰§è¡Œï¼Œè€Œä¸ä¼šå½±å“è°ƒç”¨è„šæœ¬çš„çˆ¶è¿›ç¨‹ã€‚å¦‚æœä¸ä½¿ç”¨ /b é€‰é¡¹ï¼Œåˆ™ exit å‘½ä»¤ä¼šç»ˆæ­¢å½“å‰æ•´ä¸ªçš„å‘½ä»¤å¤„ç†å™¨è¿›ç¨‹ï¼ˆCMD.EXEï¼‰ï¼Œå¹¶è¿”å›é€€å‡ºä»£ç ç»™è°ƒç”¨è€…ã€‚ exitCode æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šé€€å‡ºä»£ç ã€‚å¦‚æœæœªæŒ‡å®šé€€å‡ºä»£ç ï¼Œåˆ™é»˜è®¤è¿”å›ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºä»£ç ã€‚ 2. å˜é‡å»¶è¿Ÿæ‰©å±•SETLOCAL ENABLEDELAYEDEXPANSIONçš„ä½œç”¨æ˜¯è®¾ç½®æœ¬åœ°å˜é‡å»¶è¿Ÿæ‰©å±•ã€‚ CMDåœ¨æ‰§è¡Œå‘½ä»¤å‰ä¼šå¯¹è„šæœ¬è¿›è¡Œé¢„å¤„ç†ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ç±»ä¼¼%value%è¿™æ ·çš„å˜é‡å°±ä¼šå¯¹å…¶è¿›è¡Œè¯†åˆ«ï¼Œå¹¶ä¸”æŸ¥æ‰¾è¿™ä¸ªå˜é‡å¯¹åº”çš„å€¼ï¼Œä»è€Œç”¨è¯¥å€¼æ›¿æ¢æ‰å˜é‡ï¼Œè¿™ä¸ªæ›¿æ¢å€¼çš„è¿‡ç¨‹ï¼Œå°±å«å˜é‡æ‰©å±•ï¼Œè¿™ä¸ªç±»ä¼¼äºC&#x2F;C++ä¸­çš„å®ã€‚ è¯·çœ‹ä¸‹é¢ç¤ºä¾‹ï¼š 123@echo offset a=4set a=5 &amp; echo %a% ç»“æœï¼š4 ä¸ºä»€ä¹ˆè¾“å‡ºæ˜¯4è€Œä¸æ˜¯5å‘¢ï¼Ÿ åŸå› æ˜¯æ‰¹å¤„ç†æ˜¯æŒ‰è¡Œè¯»å–å‘½ä»¤çš„ï¼ˆå¦å¤–ä¾‹å¦‚forå‘½ä»¤ç­‰ï¼Œå…¶åç”¨ä¸€å¯¹åœ†æ‹¬å·é—­åˆçš„æ‰€æœ‰è¯­å¥ä¹Ÿå½“ä½œä¸€è¡Œï¼‰ï¼Œåœ¨æ‰§è¡Œä¹‹å‰è¦å®Œæˆå¿…è¦çš„é¢„å¤„ç†å·¥ä½œï¼Œè¿™å…¶ä¸­å°±åŒ…æ‹¬å¯¹è¯¥è¡Œå‘½ä»¤ä¸­çš„å˜é‡èµ‹å€¼ã€‚ä¸Šä¾‹ä¸­ï¼Œæ‰¹å¤„ç†åœ¨è¿è¡Œåˆ°set a=5 &amp; echo %a%ä¹‹å‰ï¼Œå…ˆæŠŠè¿™ä¸€æ•´å¥è¯»å–å¹¶åšäº†é¢„å¤„ç†ï¼ˆå¯¹å˜é‡aèµ‹äº†å€¼ï¼‰ï¼Œæ­¤æ—¶%a%å½“ç„¶å°±æ˜¯4ã€‚ æ˜ç™½è¿™ä¸ªé“ç†ä¹‹åï¼Œæˆ‘ä»¬å°†ä¸Šä¾‹ä¿®æ”¹ä¸ºå¦‚ä¸‹æ–¹å¼ï¼Œå°±å¯ä»¥è¾“å‡ºç»“æœ5ã€‚ 1234@echo offset a=4set a=5echo %a% ä¸ºäº†èƒ½å¤Ÿè®©æ‰¹å¤„ç†æ„ŸçŸ¥å˜é‡çš„åŠ¨æ€å˜åŒ–ï¼Œæ‰¹å¤„ç†è®¾è®¡äº†å˜é‡å»¶è¿Ÿï¼Œå³åœ¨è¯»å–äº†ä¸€æ¡å®Œæ•´çš„è¯­å¥ä¹‹åï¼Œä¸ç«‹å³å¯¹è¯¥è¡Œçš„å˜é‡èµ‹å€¼ï¼Œè€Œä¼šåœ¨å•æ¡è¯­å¥æ‰§è¡Œä¹‹å‰å†è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´â€œå»¶è¿Ÿâ€äº†å¯¹å˜é‡çš„èµ‹å€¼ã€‚ 1234@echo offSETLOCAL ENABLEDELAYEDEXPANSIONset a=4set a=5 &amp; echo !a! ç»“æœï¼š5 ç”±äºå¯åŠ¨äº†å˜é‡å»¶è¿Ÿï¼Œå¾—åˆ°äº†è¾“å‡ºç»“æœ5ã€‚ å˜é‡å»¶è¿Ÿçš„å¯åŠ¨è¯­å¥æ˜¯SETLOCAL ENABLEDELAYEDEXPANSIONï¼Œå¹¶ä¸”å˜é‡è¦ç”¨ä¸€å¯¹å¹å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™å°±æ²¡æœ‰å˜é‡å»¶è¿Ÿçš„æ•ˆæœã€‚ 3. è°ƒç”¨npmå‘½ä»¤æ— æ³•è¿”å›åŸæ‰¹å¤„ç†éœ€è¦ä½¿ç”¨callå‘½ä»¤ï¼Œå¦‚ï¼š 1call npm install å…·ä½“åŸå› å‚è€ƒï¼šæ‰¹å¤„ç†è¿è¡Œå¤–éƒ¨ç¨‹åº å¯ä»¥ä½¿ç”¨%errorlevel%è·å–å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆé€šå¸¸0è¡¨ç¤ºæˆåŠŸï¼‰ï¼Œå¦‚ï¼š 123456call npm run build-releaseif %errorlevel% NEQ 0 goto ERROR:ERRORecho Compile Failed 4. åˆ‡æ¢è„šæœ¬çš„å½“å‰ç›®å½•æœ‰äº›å‘½ä»¤ä¾èµ–æ‰¹å¤„ç†ç¨‹åºçš„å½“å‰ç›®å½•ï¼Œå¦‚npmã€yarnè¿™æ ·çš„å‘½ä»¤ã€‚å‡å¦‚é¡¹ç›®ä½äºD:\\A\\Bè·¯å¾„ï¼Œä½¿ç”¨æ‰¹å¤„ç†ï¼ˆæ–‡ä»¶ä½äºD:\\build.batï¼‰è¿›è¡Œè‡ªåŠ¨æ„å»ºï¼š 123@echo offcd D:\\A\\Bcall npm run build è¿è¡Œä¸Šé¢æ‰¹å¤„ç†ï¼Œæ„å»ºä¼šå¤±è´¥ï¼Œé€šå¸¸ä¼šæç¤ºè¯¸å¦‚â€œD:\\package.jsonä¸å­˜åœ¨â€çš„é”™è¯¯ï¼ŒåŸå› æ˜¯npmå‘½ä»¤æ˜¯æ‰¹å¤„ç†ç¨‹åºçš„å½“å‰ç›®å½•æŸ¥æ‰¾package.jsonæ–‡ä»¶çš„ï¼Œæ‰¹å¤„ç†ç¨‹åºçš„å½“å‰ç›®å½•é»˜è®¤ä¸ºæ‰¹å¤„ç†æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œå³D:\\ï¼ŒD:\\package.jsonä¸å­˜åœ¨ï¼Œå› æ­¤æ„å»ºå¤±è´¥ã€‚ å¯ä»¥ä½¿ç”¨ä¸ºcdå‘½ä»¤æŒ‡å®š/då‚æ•°æ¥åˆ‡æ¢æ‰¹å¤„ç†ç¨‹åºçš„å½“å‰ç›®å½•ï¼Œä¸Šé¢ç¤ºä¾‹å¯ä»¥ä¿®æ”¹ä¸ºï¼š 123@echo offcd /d D:\\A\\Bcall npm run build 5. æ‰¹å¤„ç†å‘½ä»¤æ¢è¡Œå½“æ‰¹å¤„ç†å‘½ä»¤è¿‡é•¿ï¼Œå¦‚æœéƒ½å†™åœ¨ä¸€è¡Œä¸ä¾¿äºé˜…è¯»ï¼Œå¯ä»¥ä½¿ç”¨^ç¬¦å·è¿›è¡Œåˆ†å‰²ã€‚ 123456call &quot;%qt_src_folder%\\configure.bat&quot; -silent -debug-and-release -force-debug-info -strip ^ -platform win32-msvc -static -static-runtime -no-opengl -no-dbus -no-icu ^ -nomake examples -nomake tests -skip qtwebengine -skip qtlocation ^ -qt-harfbuzz -qt-freetype -qt-zlib -qt-doubleconversion ^ -mp -optimize-size -ltcg -no-pch ^ OPENSSL_LIBS=&quot;-lUser32 -lAdvapi32 -lGdi32 -lWS2_32 -lCRYPT32 -llibcrypto32 -llibssl32&quot; 6. ECHO å¤„äºå…³é—­çŠ¶æ€é‡åˆ°â€œECHO å¤„äºå…³é—­çŠ¶æ€â€æç¤ºï¼Œé€šå¸¸æ˜¯å› ä¸ºè¾“å‡ºå˜é‡ä¸ºç©ºå¯¼è‡´ã€‚ æ­¤æ—¶éœ€è¦æ³¨æ„å¦‚ä¸‹æƒ…å†µï¼š æ‰¹å¤„ç†å˜é‡å·¦å³ä¸èƒ½æœ‰ç©ºæ ¼ã€‚å¦‚æœæœ‰ç©ºæ ¼ï¼Œç©ºæ ¼ä¼šè¢«å½“æˆå˜é‡åï¼Œå¦‚set a =1ï¼Œå˜é‡åå®é™…ä¸ºa ã€‚ å¼€å¯å˜é‡å»¶è¿Ÿæ‰©å±•åï¼Œå¼•ç”¨å˜é‡éœ€è¦ä½¿ç”¨ä¸¤ä¸ª!çš„æ–¹å¼ï¼Œå¦‚!str_a!ã€‚ 7. æ˜¾ç¤ºé€‰æ‹©é¡¹æç¤ºç”¨æˆ·é€‰æ‹©ä½¿ç”¨CHOICEå‘½ä»¤å¯ä»¥æä¾›ç”¨æˆ·åœ¨æŒ‡å®šçš„é€‰é¡¹ä¸­é€‰æ‹©ä¸€é¡¹ï¼Œå¹¶ä½¿ç”¨%ERRORLEVEL%è·å–é€‰æ‹©çš„å€¼ã€‚ CHOICEå‘½ä»¤è¯­æ³•å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031CHOICE [/C choices] [/N] [/CS] [/T timeout /D choice] [/M text]æè¿°: è¯¥å·¥å…·å…è®¸ç”¨æˆ·ä»é€‰æ‹©åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªé¡¹ç›®å¹¶è¿”å›æ‰€é€‰é¡¹ç›®çš„ç´¢å¼•ã€‚å‚æ•°åˆ—è¡¨: /C choices æŒ‡å®šè¦åˆ›å»ºçš„é€‰é¡¹åˆ—è¡¨ã€‚é»˜è®¤åˆ—è¡¨æ˜¯ &quot;YN&quot;ã€‚ /N åœ¨æç¤ºç¬¦ä¸­éšè—é€‰é¡¹åˆ—è¡¨ã€‚æç¤ºå‰é¢çš„æ¶ˆæ¯å¾—åˆ°æ˜¾ç¤ºï¼Œ é€‰é¡¹ä¾æ—§å¤„äºå¯ç”¨çŠ¶æ€ã€‚ /CS å…è®¸é€‰æ‹©åˆ†å¤§å°å†™çš„é€‰é¡¹ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå·¥å…· æ˜¯ä¸åˆ†å¤§å°å†™çš„ã€‚ /T timeout åšå‡ºé»˜è®¤é€‰æ‹©ä¹‹å‰ï¼Œæš‚åœçš„ç§’æ•°ã€‚å¯æ¥å—çš„å€¼æ˜¯ä» 0 åˆ° 9999ã€‚å¦‚æœæŒ‡å®šäº† 0ï¼Œå°±ä¸ä¼šæœ‰æš‚åœï¼Œé»˜è®¤é€‰é¡¹ ä¼šå¾—åˆ°é€‰æ‹©ã€‚ /D choice åœ¨ nnnn ç§’ä¹‹åæŒ‡å®šé»˜è®¤é€‰é¡¹ã€‚å­—ç¬¦å¿…é¡»åœ¨ç”¨ /C é€‰ é¡¹æŒ‡å®šçš„ä¸€ç»„é€‰æ‹©ä¸­; åŒæ—¶ï¼Œå¿…é¡»ç”¨ /T æŒ‡å®š nnnnã€‚ /M text æŒ‡å®šæç¤ºä¹‹å‰è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå·¥å…·åª æ˜¾ç¤ºæç¤ºã€‚ /? æ˜¾ç¤ºæ­¤å¸®åŠ©æ¶ˆæ¯ã€‚ æ³¨æ„: ERRORLEVEL ç¯å¢ƒå˜é‡è¢«è®¾ç½®ä¸ºä»é€‰æ‹©é›†é€‰æ‹©çš„é”®ç´¢å¼•ã€‚åˆ—å‡ºçš„ç¬¬ä¸€ä¸ªé€‰æ‹©è¿”å› 1ï¼Œç¬¬äºŒä¸ªé€‰æ‹©è¿”å› 2ï¼Œç­‰ç­‰ã€‚ å¦‚æœç”¨æˆ·æŒ‰çš„é”®ä¸æ˜¯æœ‰æ•ˆçš„é€‰æ‹©ï¼Œè¯¥å·¥å…·ä¼šå‘å‡ºè­¦å‘Šå“å£°ã€‚å¦‚æœè¯¥å·¥å…·æ£€æµ‹åˆ°é”™è¯¯çŠ¶æ€ï¼Œå®ƒä¼šè¿”å› 255 çš„ERRORLEVEL å€¼ã€‚ å¦‚æœç”¨æˆ·æŒ‰ Ctrl+Break æˆ– Ctrl+C é”®ï¼Œè¯¥å·¥å…·ä¼šè¿”å› 0çš„ ERRORLEVEL å€¼ã€‚ åœ¨ä¸€ä¸ªæ‰¹ç¨‹åºä¸­ä½¿ç”¨ ERRORLEVEL å‚æ•°æ—¶ï¼Œå°†å‚æ•°é™åºæ’åˆ—ã€‚ å¦‚ï¼š 1CHOICE /C YNC /M &quot;ç¡®è®¤è¯·æŒ‰ Yï¼Œå¦è¯·æŒ‰ Nï¼Œæˆ–è€…å–æ¶ˆè¯·æŒ‰ Cã€‚&quot;","tags":["æ‰¹å¤„ç†"],"categories":["Windowsæ‰¹å¤„ç†"]},{"title":"åŸºäºQtçš„æ— è¾¹æ¡†çª—ä½“å®ç°","path":"/post/2402568381.html","content":"Qtè™½ç„¶æä¾›äº†è¯¸å¦‚ Qt::FramelessWindowHint ä¹‹ç±»çš„å±æ€§å¯ä»¥ç§»é™¤çª—ä½“çš„è¾¹æ¡†ï¼Œä½†æ˜¯ç§»é™¤è¾¹æ¡†ä¹‹åï¼Œçª—ä½“çš„ä¸€äº›é»˜è®¤è¡Œä¸ºåŒæ—¶ä¹Ÿè¢«ç§»é™¤äº†ï¼Œå¦‚é¼ æ ‡æ‹–åŠ¨æ”¹å˜å¤§å°ã€åŒå‡»æ ‡é¢˜æ æœ€å¤§åŒ–ç­‰ï¼Œè¿™äº›è¡Œä¸ºéœ€è¦å¼€å‘è€…è‡ªå·±æ¥å®ç°ã€‚ æœ¬æ–‡ä¸»è¦ä»‹ç»å®ç°æ— è¾¹æ¡†çª—ä½“çš„å‡ ç§æ–¹æ¡ˆï¼Œå¹¶åœ¨æœ€ååˆ†äº«äº†ä½œè€…å®ç°çš„æ–¹æ¡ˆã€‚ ç¬”è€…è®¤ä¸ºï¼Œä¸€ä¸ªå®Œç¾çš„æ— è¾¹æ¡†çª—ä½“è§£å†³æ–¹æ¡ˆéœ€è¦æ”¯æŒå¦‚ä¸‹åŠŸèƒ½ï¼š æ”¯æŒé€šè¿‡ä½¿ç”¨é¼ æ ‡æ‹–æ‹½æ¥æ”¹å˜çª—ä½“ä½ç½®å’Œå¤§å°ï¼› æ”¯æŒåŒå‡»æ ‡é¢˜æ æœ€å¤§åŒ–çª—ä½“å’Œè¿˜åŸçª—ä½“ï¼› æ”¯æŒ Windows Areo Snap ç‰¹æ€§ï¼› æ”¯æŒç³»ç»Ÿé˜´å½±ï¼› æ”¯æŒè·¨ä¸åŒ DPI çš„å±å¹•æ‹–æ‹½ï¼› é€‚åº”åˆ†è¾¨ç‡å’Œ DPI æ”¹å˜ï¼› åœ¨Qtä¸­å®ç°æ— è¾¹æ¡†çª—ä½“æœ‰2ç§æ–¹æ¡ˆï¼š ä¸€ã€Hookæ–¹æ¡ˆé€šè¿‡é‡è½½ nativeEvent å‡½æ•°æ‹¦æˆª Windows æ¶ˆæ¯ï¼ˆå¦‚ WM_NCHITTESTï¼‰æ¥å®ç°ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š ç»™çª—ä½“è®¾ç½® WS_THICKFRAME | WS_CAPTION å±æ€§ä»è€Œè¿˜åŸçª—ä½“è¾¹æ¡†å’Œæ ‡é¢˜æ ï¼Œè¿™æ ·çª—ä½“å°±å¯ä»¥æ¥æ”¶åˆ° WM_NCHITTEST æ¶ˆæ¯ã€‚ åœ¨ WM_NCCALCSIZE æ¶ˆæ¯å¤„ç†ä¸­å†ç§»é™¤è¾¹æ¡†å’Œæ ‡é¢˜æ ã€‚ åœ¨ WM_NCHITTEST æ¶ˆæ¯å¤„ç†ä¸­é€šè¿‡åˆ¤æ–­é¼ æ ‡ä½ç½®æ¥è®¾ç½®é¼ æ ‡è¡Œä¸ºï¼ˆ HTLEFT, HTRIGHTç­‰ï¼‰ã€‚ è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ”¯æŒWindows Areo Snapå’Œç³»ç»Ÿé˜´å½±çš„ç‰¹æ€§ï¼Œä½†æ˜¯é’ˆå¯¹Windowsæ¶ˆæ¯å¤„ç†èµ·æ¥å¾ˆå¤æ‚è€Œä¸”éœ€è¦å…¼å®¹Qtçš„å„ä¸ªç‰ˆæœ¬ï¼Œç›®å‰æˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªé€šè¿‡è¿™ç§æ–¹æ¡ˆæ¥å®Œç¾å®ç°æ— è¾¹æ¡†çš„è§£å†³æ–¹æ¡ˆã€‚ æ®æˆ‘æ‰€çŸ¥ï¼Œæœ‰å¦‚ä¸‹çš„å¼€æºé¡¹ç›®æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ï¼Œä½†éƒ½æœ‰äº›è®¸é—®é¢˜ï¼Œå¦‚ä¸æ”¯æŒè·¨ä¸åŒDPIå±å¹•æ‹–æ‹½ã€ä¸èƒ½é€‚åº”åˆ†è¾¨ç‡å’ŒDPIæ”¹å˜ã€WM_NCHITTESTæœ‰æ—¶æ— å“åº”ç­‰ã€‚å¦å¤–ï¼Œåœ¨è®¾ç½®äº†èƒŒæ™¯é€æ˜å±æ€§ä¹‹åï¼ˆå¦‚ Qt::WA_TranslucentBackgroundï¼‰ï¼Œç³»ç»Ÿé˜´å½±ç‰¹æ€§ä¹Ÿå°†æ¶ˆå¤±ã€‚ qtdevs&#x2F;FramelessHelper: https://github.com/qtdevs/FramelessHelper wangwenx190&#x2F;framelesshelper: https://github.com/wangwenx190/framelesshelper äºŒã€çº¯Qtæ–¹æ¡ˆè¿™ç§æ–¹æ¡ˆä¸Hook windowsçš„ WM_NCHITTESTã€WM_NCCALCSIZE æ¶ˆæ¯ï¼Œä¹Ÿä¸æ”¹å˜çª—ä½“æ ·å¼ï¼Œé€šè¿‡çº¯Qtæ–¹å¼å®ç°ã€‚é€šè¿‡å¯¹æ¯ä¸ªWidgetè®¾ç½®MouseTrackingï¼Œæ¥ä½¿æ¯ä¸ªWidgetéƒ½å¯ä»¥å“åº”é¼ æ ‡äº‹ä»¶ï¼ˆmouseMoveEventã€mousePressEventã€mouseReleaseEventç­‰ï¼‰ï¼Œç„¶åè¿™äº›äº‹ä»¶ä¸­åˆ¤æ–­é¼ æ ‡ä½ç½®æ¥è®¾ç½®é¼ æ ‡çš„å½¢çŠ¶å’Œè¡Œä¸ºã€‚ è¿™ç§æ–¹å¼è™½ç„¶å¯¹é¼ æ ‡ä½ç½®çš„åˆ¤æ–­é€»è¾‘æ¯”è¾ƒç¹çï¼Œä½†å…¼å®¹æ€§è¾ƒå¥½ï¼Œè¾ƒçº¯ç²¹ï¼Œä¸éœ€è¦å¤„ç†Windowsçš„å„ä¸ªæ¶ˆæ¯ã€‚ ä¸‰ã€Qt-FramelessWindowğŸ‘‰ æˆ‘æ ¹å€¾å‘äºä½¿ç”¨çº¯Qtæ–¹æ¡ˆï¼Œç®€å•ã€ç¨³å®šã€å…¼å®¹æ€§å¥½ï¼Œä¸ç”¨å…³æ³¨é‚£äº›çƒ¦äººçš„Windowsæ¶ˆæ¯ã€‚é’ˆå¯¹è¯¥æ–¹æ¡ˆçš„å®ç°ï¼Œå¯ä»¥å‚è€ƒç¬”è€…çš„å¼€æºé¡¹ç›®ã€Qt-FramelessWindowã€‘ï¼Œç›®å‰å¯ä»¥æ”¯æŒä¸Šè¿°é™¤â€œWindows Areo Snapâ€å’Œâ€œç³»ç»Ÿé˜´å½±â€ç‰¹æ€§ä¹‹å¤–çš„æ‰€æœ‰æ— è¾¹æ¡†çª—ä½“çš„ç‰¹æ€§ï¼Œè€Œä¸”ä»…æœ‰ä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ Qt-FramelessWindow: https://github.com/winsoft666/Qt-FramelessWindow é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt"],"categories":["Qt"]},{"title":"åŸºäºHexoæ­å»ºé™æ€åšå®¢","path":"/post/2737986840.html","content":"Hexoæ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ï¼Œä½¿ç”¨Hexoå¯ä»¥å¿«é€Ÿåœ°ç”Ÿæˆé™æ€åšå®¢æ¡†æ¶ã€‚åœ¨æ¡†æ¶ç”Ÿæˆå®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨è¯­æ³•ä¹¦å†™åšå®¢ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Markdownè¯­æ³•ä¹¦å†™åšå®¢ï¼ŒHexoåœ¨ç”Ÿæˆåšå®¢æ—¶ä¼šè‡ªåŠ¨å°†Markdownè§£ææˆHtmlé™æ€é¡µé¢ã€‚ Hexoå®˜ç½‘ï¼šhttps://hexo.io/zh-cn/Hexoä¸­æ–‡æ–‡æ¡£ï¼šhttps://hexo.io/zh-cn/docs/ ä¸€ã€ç©æ³•è¯´æ˜ä½¿ç”¨Hexoå†™åšå®¢çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š ç”Ÿæˆåšå®¢æ¡†æ¶ é…ç½®åšå®¢ é€‰æ‹©è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ é…ç½®åšå®¢å’Œä¸»é¢˜ å†™æ–‡ç«  ç”Ÿæˆåšå®¢ å‘å¸ƒåšå®¢åˆ°æœåŠ¡å™¨ å…¶ä¸­ï¼Œç¬¬1~4æ­¥ä¸ºå‰ç½®æ“ä½œï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚ Hexoåªè´Ÿè´£ç”Ÿæˆé™æ€çš„HTMLæ–‡ä»¶ï¼Œä¸æä¾›æœåŠ¡å™¨ã€‚å¦‚éœ€å¯¹å¤–å‘å¸ƒåšå®¢ï¼Œæˆ‘ä»¬è¿˜éœ€å°†HTMLæ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥é€‰æ‹©å¦‚ä¸‹çš„æ–¹å¼ï¼š Github Pagesã€GitLab Pagesï¼Œå…è´¹ï¼Œè®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚ Gitee Pagesï¼Œæ”¶è´¹ã€‚ å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå¦‚é˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSã€ä¸ƒç‰›äº‘OSSç­‰ã€‚å½“è®¿é—®é‡å¤§æ—¶ï¼Œéœ€æ­é…CDNä½¿ç”¨ï¼Œé¿å…å› æ•°æ®å›æºäº§ç”Ÿå·¨é¢æµé‡è´¹ç”¨ã€‚ è‡ªå·±è´­ä¹°æœåŠ¡å™¨ä½¿ç”¨Nginxæ­å»ºWebæœåŠ¡å™¨ã€‚å½“è®¿é—®é‡å¤§æ—¶ï¼ŒæœåŠ¡å™¨å‡ºå£å¸¦å®½è¦æ±‚è¾ƒé«˜ï¼Œæ­¤æ—¶ä»ç„¶éœ€è¦æ­é…å¯¹è±¡å­˜å‚¨æœåŠ¡å’ŒCDNä½¿ç”¨ã€‚ äºŒã€ç”Ÿæˆåšå®¢æ¡†æ¶2.1 ç¯å¢ƒå‡†å¤‡åœ¨æ­å»ºåšå®¢æ¡†æ¶ä¹‹å‰ï¼Œç¡®ä¿ç”µè„‘ä¸Šå·²ç»å®‰è£…å¦‚ä¸‹è½¯ä»¶ï¼ˆå»ºè®®å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Node.jsï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å…¼å®¹æœ€æ–°ç‰ˆæœ¬çš„Hexoï¼‰ï¼š Node.js Git 2.2 å®‰è£…Hexoåœ¨æ‰€æœ‰å¿…å¤‡çš„åº”ç”¨ç¨‹åºå®‰è£…å®Œæˆåï¼Œå³å¯ä½¿ç”¨ npm å…¨å±€å®‰è£… Hexoå·¥å…·ï¼š 1npm install -g hexo-cli 2.3 ç”Ÿæˆåšå®¢æ¡†æ¶å®‰è£… Hexo å®Œæˆåï¼Œåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨ç›®å½•ä¸‹æ–°å»ºåšå®¢æ‰€éœ€çš„æ–‡ä»¶ï¼š 123hexo init &lt;folder&gt;cd &lt;folder&gt;npm install å¦‚æœé‡åˆ°ç½‘ç»œé”™è¯¯ç­‰é—®é¢˜ï¼Œè¯·æ’é™¤æ˜¯å¦å› ä¸ºè®¿é—®å›½å¤–åŸŸåå¤±è´¥å¯¼è‡´ï¼Œå¯ä»¥å°è¯•å°†npmæºåˆ‡æ¢åˆ°å›½å†…ï¼Œå‚è€ƒï¼š NPMå’ŒYarnè®¾ç½®å›½å†…æº æ–°å»ºå®Œæˆåï¼ŒæŒ‡å®šæ–‡ä»¶å¤¹çš„ç›®å½•å¤§è‡´å¦‚ä¸‹ï¼š 12345678.â”œâ”€â”€ _config.ymlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffoldsâ”œâ”€â”€ source| â”œâ”€â”€ _drafts| â””â”€â”€ _postsâ””â”€â”€ themes _config.yml ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°ï¼Œéœ€è¦åŒºåˆ«äºä¸»é¢˜çš„_config.ymlé…ç½®æ–‡ä»¶ã€‚ package.json åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚ scaffolds æ¨¡ç‰ˆæ–‡ä»¶å¤¹ã€‚å½“æ–°å»ºæ–‡ç« æ—¶ï¼ŒHexoä¼šæ ¹æ®scaffoldæ¥åˆ›å»ºæ–‡ä»¶ã€‚Hexoçš„æ¨¡æ¿æ˜¯æŒ‡åœ¨æ–°å»ºçš„æ–‡ç« æ–‡ä»¶ä¸­é»˜è®¤å¡«å……çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¿®æ”¹ scaffold&#x2F;post.md ä¸­çš„ Front-matter ï¼ˆå³ä¸¤ä¸ª---ä¸­é—´çš„å†…å®¹ï¼‰å†…å®¹ï¼Œé‚£ä¹ˆæ¯æ¬¡æ–°å»ºä¸€ç¯‡æ–‡ç« æ—¶éƒ½ä¼šåŒ…å«è¿™ä¸ªä¿®æ”¹ã€‚ source èµ„æºæ–‡ä»¶å¤¹æ˜¯å­˜æ”¾ç”¨æˆ·èµ„æºçš„åœ°æ–¹ã€‚é™¤ _posts æ–‡ä»¶å¤¹ä¹‹å¤–ï¼Œå¼€å¤´å‘½åä¸º _ (ä¸‹åˆ’çº¿)çš„æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹å’Œéšè—çš„æ–‡ä»¶å°†ä¼šè¢«å¿½ç•¥ã€‚åœ¨ç”Ÿæˆåšå®¢æ—¶ï¼ŒMarkdown å’Œ HTML æ–‡ä»¶ä¼šè¢«è§£æå¹¶æ”¾åˆ° public æ–‡ä»¶å¤¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶ä¼šè¢«ç›´æ¥æ‹·è´è¿‡å»ã€‚ themes ä¸»é¢˜æ–‡ä»¶å¤¹ã€‚å°†ä¸‹è½½çš„ä¸»é¢˜æ–‡ä»¶æ”¾ç½®åˆ°è¯¥ç›®å½•ï¼ŒHexo ä¼šæ ¹æ®ä¸»é¢˜æ¥ç”Ÿæˆé™æ€é¡µé¢ã€‚ ä¸‰ã€é…ç½®åšå®¢Hexoçš„é…ç½®åˆ†åˆ«ç«™ç‚¹é…ç½®å’Œä¸»é¢˜é…ç½®ï¼Œç«™ç‚¹é…ç½®æ–‡ä»¶ä¸ºåšå®¢æ ¹ç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶ï¼Œä¸»é¢˜é…ç½®æ–‡ä»¶ä¸ºä½äºthemes\\&lt;ä¸»é¢˜ç›®å½•&gt;ä¸­çš„_config.ymlæ–‡ä»¶ã€‚ 3.1 ç«™ç‚¹é…ç½®æœ¬èŠ‚ä»‹ç»åšå®¢çš„ç«™ç‚¹é…ç½®ï¼Œéƒ¨åˆ†é…ç½®çš„å«ä¹‰å¦‚ä¸‹ï¼š title\tç½‘ç«™æ ‡é¢˜ subtitle\tç½‘ç«™å‰¯æ ‡é¢˜ description\tç½‘ç«™æè¿°ï¼Œä¸»è¦ç”¨äºSEO keywords\tç½‘ç«™çš„å…³é”®è¯ã€‚æ”¯æŒå¤šä¸ªå…³é”®è¯ã€‚ author ä½œè€…åå­— language\tç½‘ç«™ä½¿ç”¨çš„è¯­è¨€ã€‚å¯¹äºç®€ä½“ä¸­æ–‡ç”¨æˆ·æ¥è¯´ï¼Œä½¿ç”¨ä¸åŒçš„ä¸»é¢˜å¯èƒ½éœ€è¦è®¾ç½®æˆä¸åŒçš„å€¼ï¼Œè¯·å‚è€ƒä½ çš„ä¸»é¢˜çš„æ–‡æ¡£è‡ªè¡Œè®¾ç½®ï¼Œå¸¸è§çš„æœ‰ zh-Hanså’Œ zh-CNã€‚ timezone\tç½‘ç«™æ—¶åŒºã€‚å¯¹äºä¸­å›½å¤§é™†åœ°åŒºå¯ä»¥ä½¿ç”¨ Asia&#x2F;Shanghaiã€‚ theme\tå½“å‰ä¸»é¢˜åç§°ï¼Œåç§°ä¸ºthemesç›®å½•ä¸­çš„å­ç›®å½•åç§°ã€‚å€¼ä¸ºfalseæ—¶ç¦ç”¨ä¸»é¢˜ã€‚ per_page\tæ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« é‡ (0 &#x3D; å…³é—­åˆ†é¡µåŠŸèƒ½)ã€‚ pagination_dir\tæŒ‡å®šåšå®¢ç”Ÿæˆåï¼Œæ¯é¡µçš„index.htmlæ–‡ä»¶å­˜æ”¾ç›®å½•ã€‚ 3.2 åˆ©ç”¨Hexo-abbrlinkæ’ä»¶ç”Ÿæˆå”¯ä¸€æ–‡ç« é“¾æ¥Hexoåœ¨ç”Ÿæˆåšå®¢æ–‡ç« é“¾æ¥æ—¶ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å¹´/æœˆ/æ—¥/æ ‡é¢˜æ ¼å¼æ¥ç”Ÿæˆçš„ï¼Œå¯ä»¥åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šnew_post_nameçš„å€¼ï¼Œé»˜è®¤æ˜¯:year&#x2F;:month&#x2F;:day&#x2F;:titleè¿™æ ·çš„æ ¼å¼ã€‚å¦‚æœä½ çš„æ ‡é¢˜æ˜¯ä¸­æ–‡çš„è¯ï¼Œä½ çš„URLé“¾æ¥è¿˜ä¼šåŒ…å«ä¸­æ–‡ã€‚è€Œä¸”å½“æˆ‘ä»¬ä¿®æ”¹åŸæ–‡ç« çš„æ—¥æœŸæˆ–æ ‡é¢˜åï¼Œä¹‹å‰ç”Ÿæˆçš„é“¾æ¥å°†ä¼šå¤±æ•ˆã€‚ ä¸ºäº†ç»™æ¯ä¸€ç¯‡æ–‡ç« æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„ä¸å«ä¸­æ–‡çš„é“¾æ¥ï¼Œå¯ä»¥åˆ©ç”¨hexo-abbrlinkæ’ä»¶ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å…ˆå®‰è£…ä¸‹hexo-abbrlinkï¼š 1npm install hexo-abbrlink --save ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶(_config.yml)ï¼š 1234permalink: post/:abbrlink.htmlabbrlink: alg: crc32 # ç®—æ³•ï¼šcrc16(default) and crc32 rep: hex # è¿›åˆ¶ï¼šdec(default) and hex ç”Ÿæˆå®ŒååŸæ–‡ç« .mdæ–‡ä»¶çš„Front-matter å†…ä¼šå¢åŠ abbrlinkå­—æ®µï¼Œå€¼ä¸ºç”Ÿæˆçš„IDã€‚è¿™ä¸ªå­—æ®µç¡®ä¿äº†åœ¨æˆ‘ä»¬ä¿®æ”¹äº†Front-matterå†…çš„titleæˆ–dateå­—æ®µä¹‹åé“¾æ¥åœ°å€ä¸ä¼šæ”¹å˜ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æœ¬ç¯‡æ–‡ç« æœ‰äº†è‡ªå·±çš„ä¸“å±é“¾æ¥ã€‚ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸åŒçš„ç®—æ³•å’Œè¿›åˆ¶ï¼š crc16 &amp; hex https://post.zz173.com/posts/66c8.html crc16 &amp; dec https://post.zz173.com/posts/65535.html crc32 &amp; hex https://post.zz173.com/posts/8ddf18fb.html crc32 &amp; dec https://post.zz173.com/posts/1690090958.html æ³¨æ„ï¼Œé…ç½®å®Œæˆä¹‹åï¼Œä¹‹å‰çš„æ–‡ç« çš„é“¾æ¥æœ‰å¯èƒ½ä¼šå˜æˆäº†undefinedï¼Œéœ€è¦æ‰§è¡Œhexo cleanå¹¶é‡æ–°ç”Ÿæˆéƒ¨ç½²ã€‚ å››ã€é…ç½®ä¸»é¢˜æ¯ä¸ªä¸»é¢˜çš„é…ç½®å†…å®¹éƒ½ä¸ä¸€æ ·ï¼Œå…·ä½“å‚è€ƒä½¿ç”¨ä¸»é¢˜çš„å¸®åŠ©æ–‡æ¡£ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯hexo-theme-materyä¸»é¢˜ã€‚ 4.1 æ¨èä¸»é¢˜ hexo-theme-aircloud hexo-theme-new-yilia hexo-theme-vexo hexo-theme-next hexo-theme-butterfly hexo-theme-volantis hexo-theme-icarus å¯ä»¥åœ¨Githubä¸­æœç´¢Hexo Themeå‘ç°æ›´å¤šä¸»é¢˜ã€‚ äº”ã€å†™æ–‡ç« 5.1 ç”Ÿæˆæ–‡ç« ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆæ–°çš„æ–‡ç« : 1hexo new &lt;æ–‡ç« æ ‡é¢˜&gt; æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œä¼šåœ¨source_postsç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„.mdæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 5.2 Front-matterFront-matter æ˜¯æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ --- åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ–‡ä»¶çš„å˜é‡ã€‚Hexoé¢„å®šä¹‰äº†ä¸€äº›å˜é‡ï¼ŒåŒæ—¶æ¯ä¸ªä¸»é¢˜ä¹Ÿä¼šå®šä¹‰ä¸€äº›å˜é‡ã€‚ 5.2.1 Hexoé¢„å®šä¹‰å˜é‡ title\tæ ‡é¢˜ï¼Œé»˜è®¤ä¸ºæ–‡ç« çš„æ–‡ä»¶å date\tå»ºç«‹æ—¥æœŸï¼Œé»˜è®¤ä¸ºæ–‡ä»¶å»ºç«‹æ—¥æœŸ updated\tæ›´æ–°æ—¥æœŸï¼Œé»˜è®¤æ–‡ä»¶æ›´æ–°æ—¥æœŸ comments\tæ˜¯å¦å¼€å¯æ–‡ç« çš„è¯„è®ºåŠŸèƒ½ï¼Œtrue&#x2F;false. tags\tæ ‡ç­¾ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰ï¼Œæ”¯æŒå¤šä¸ªã€‚ categories\tåˆ†ç±»ï¼ˆä¸é€‚ç”¨äºåˆ†é¡µï¼‰ï¼Œæ”¯æŒå¤šä¸ªã€‚ permalink\tè¦†ç›–æ–‡ç« çš„æ°¸ä¹…é“¾æ¥ï¼Œæ°¸ä¹…é“¾æ¥åº”è¯¥ä»¥&#x2F;æˆ–.htmlç»“å°¾ã€‚ keywords: æ–‡ç« å…³é”®å­—ï¼Œç”¨äºSEOã€‚ å¦‚ï¼š 12345678910111213141516---title: ä»æ±‡ç¼–çš„è§’åº¦åˆ†æå‡½æ•°è°ƒç”¨è¿‡ç¨‹categories: - C++ - æ±‡ç¼–abbrlink: 4168021185date: 2022-01-21 15:53:01updated: 2023-01-21 15:53:01keywords: - å‡½æ•° - C++ - æ±‡ç¼–tags: - C++ - ä¼ å‚å½¢å¼--- 5.2.2 hexo-theme-materyä¸»é¢˜å®šä¹‰å˜é‡ é…ç½®é€‰é¡¹ é»˜è®¤å€¼ æè¿° title Markdown çš„æ–‡ä»¶æ ‡é¢˜ æ–‡ç« æ ‡é¢˜ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹ date æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¥æœŸæ—¶é—´ å‘å¸ƒæ—¶é—´ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹ author æ ¹ _config.yml ä¸­çš„ author æ–‡ç« ä½œè€… img featureImages ä¸­çš„æŸä¸ªå€¼ æ–‡ç« ç‰¹å¾å›¾ï¼Œæ¨èä½¿ç”¨å›¾åºŠ(è…¾è®¯äº‘ã€ä¸ƒç‰›äº‘ã€åˆæ‹äº‘ç­‰)æ¥åšå›¾ç‰‡çš„è·¯å¾„.å¦‚: http://xxx.com/xxx.jpg top true æ¨èæ–‡ç« ï¼ˆæ–‡ç« æ˜¯å¦ç½®é¡¶ï¼‰ï¼Œå¦‚æœ top å€¼ä¸º trueï¼Œåˆ™ä¼šä½œä¸ºé¦–é¡µæ¨èæ–‡ç«  hide false éšè—æ–‡ç« ï¼Œå¦‚æœhideå€¼ä¸ºtrueï¼Œåˆ™æ–‡ç« ä¸ä¼šåœ¨é¦–é¡µæ˜¾ç¤º cover false v1.0.2ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« æ˜¯å¦éœ€è¦åŠ å…¥åˆ°é¦–é¡µè½®æ’­å°é¢ä¸­ coverImg æ—  v1.0.2ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« åœ¨é¦–é¡µè½®æ’­å°é¢éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ–‡ç« çš„ç‰¹è‰²å›¾ç‰‡ password æ—  æ–‡ç« é˜…è¯»å¯†ç ï¼Œå¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„è¯ï¼Œå°±å¯ä»¥è®¾ç½® password çš„å€¼ï¼Œè¯¥å€¼å¿…é¡»æ˜¯ç”¨ SHA256 åŠ å¯†åçš„å¯†ç ï¼Œé˜²æ­¢è¢«ä»–äººè¯†ç ´ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ config.yml ä¸­æ¿€æ´»äº† verifyPassword é€‰é¡¹ toc true æ˜¯å¦å¼€å¯ TOCï¼Œå¯ä»¥é’ˆå¯¹æŸç¯‡æ–‡ç« å•ç‹¬å…³é—­ TOC çš„åŠŸèƒ½ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ config.yml ä¸­æ¿€æ´»äº† toc é€‰é¡¹ mathjax false æ˜¯å¦å¼€å¯æ•°å­¦å…¬å¼æ”¯æŒ ï¼Œæœ¬æ–‡ç« æ˜¯å¦å¼€å¯ mathjaxï¼Œä¸”éœ€è¦åœ¨ä¸»é¢˜çš„ _config.yml æ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å¼€å¯æ‰è¡Œ summary æ—  æ–‡ç« æ‘˜è¦ï¼Œè‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦ categories æ—  æ–‡ç« åˆ†ç±»ï¼Œæœ¬ä¸»é¢˜çš„åˆ†ç±»è¡¨ç¤ºå®è§‚ä¸Šå¤§çš„åˆ†ç±»ï¼Œåªå»ºè®®ä¸€ç¯‡æ–‡ç« ä¸€ä¸ªåˆ†ç±» tags æ—  æ–‡ç« æ ‡ç­¾ï¼Œä¸€ç¯‡æ–‡ç« å¯ä»¥å¤šä¸ªæ ‡ç­¾ keywords æ–‡ç« æ ‡é¢˜ æ–‡ç« å…³é”®å­—ï¼ŒSEO æ—¶éœ€è¦ reprintPolicy cc_by æ–‡ç« è½¬è½½è§„åˆ™ï¼Œ å¯ä»¥æ˜¯ cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint æˆ– pay ä¸­çš„ä¸€ä¸ª æ³¨æ„: å¦‚æœ img å±æ€§ä¸å¡«å†™çš„è¯ï¼Œæ–‡ç« ç‰¹è‰²å›¾ä¼šæ ¹æ®æ–‡ç« æ ‡é¢˜çš„ hashcode çš„å€¼å–ä½™ï¼Œç„¶åé€‰å–ä¸»é¢˜ä¸­å¯¹åº”çš„ç‰¹è‰²å›¾ç‰‡ï¼Œä»è€Œè¾¾åˆ°è®©æ‰€æœ‰æ–‡ç« çš„ç‰¹è‰²å›¾å„æœ‰ç‰¹è‰²ã€‚ å¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„åŠŸèƒ½ï¼Œä¸ä»…è¦åœ¨ Front-matter ä¸­è®¾ç½®é‡‡ç”¨äº† SHA256 åŠ å¯†çš„ password çš„å€¼ï¼Œè¿˜éœ€è¦åœ¨ä¸»é¢˜çš„ _config.yml ä¸­æ¿€æ´»äº†é…ç½®ã€‚æœ‰äº›åœ¨çº¿çš„ SHA256 åŠ å¯†çš„åœ°å€ï¼Œå¯ä¾›ä½ ä½¿ç”¨ï¼šå¼€æºä¸­å›½åœ¨çº¿å·¥å…·ã€chahuoã€ç«™é•¿å·¥å…·ã€‚ æ‚¨å¯ä»¥åœ¨æ–‡ç« mdæ–‡ä»¶çš„ front-matter ä¸­æŒ‡å®š reprintPolicy æ¥ç»™å•ä¸ªæ–‡ç« é…ç½®è½¬è½½è§„åˆ™ ä»¥ä¸‹ä¸ºæ–‡ç« çš„ Front-matter ç¤ºä¾‹ã€‚ æœ€ç®€ç¤ºä¾‹1234---title: typora-vue-themeä¸»é¢˜ä»‹ç»date: 2018-09-07 09:25:00--- æœ€å…¨ç¤ºä¾‹123456789101112131415161718---title: typora-vue-themeä¸»é¢˜ä»‹ç»date: 2018-09-07 09:25:00author: èµµå¥‡img: /source/images/xxx.jpgtop: truehide: falsecover: truecoverImg: /images/1.jpgpassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92toc: falsemathjax: falsesummary: è¿™æ˜¯ä½ è‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦categories: Markdowntags: - Typora - Markdown--- 5.3 å¼•ç”¨ç«™å†…æ–‡ç« è¯­æ³•å¦‚ä¸‹ï¼š 1&#123;% post_link slug [title] %&#125; å…¶ä¸­ï¼Œslug è¡¨ç¤º _post ç›®å½•ä¸‹çš„ Markdown æ–‡ä»¶åã€‚å¯ä»¥é€šè¿‡ title æŒ‡å®šé“¾æ¥æ ‡é¢˜ã€‚ 5.4 æŒ‰é’®è¯­æ³•å¦‚ä¸‹ï¼š 1&#123;% button /path/to/url/, text, icon [class], [alt] %&#125; å¦‚ï¼š 1&#123;% button https://jiangxueqiao.com, æ±Ÿé›ªæ¡¥çš„åšå®¢, home fa-fw fa-lg, æ±Ÿé›ªæ¡¥ %&#125; 5.5 æ’å…¥å›¾ç‰‡Markdown å¹¶ä¸ä¼šä¿å­˜æ’å…¥çš„å›¾ç‰‡èµ„æºæœ¬èº«ï¼Œåªæ˜¯è®°å½•äº†è·å–èµ„æºçš„é“¾æ¥ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€æ¬¾åˆé€‚çš„å›¾åºŠæ¥æ”¯æŒåšå®¢å†™ä½œï¼Œç›®å‰å„å¤§äº‘æœåŠ¡å•†éƒ½æä¾›äº†å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå¦‚ä¸ƒç‰›äº‘ KODOã€åˆæ‹äº‘ USSã€è…¾è®¯äº‘ COSã€é˜¿é‡Œäº‘ OSS ç­‰ã€‚ å¯ä»¥ä½¿ç”¨PicGoå·¥å…·ä¸Šä¼ å›¾ç‰‡åˆ°å›¾åºŠä¸Šã€‚ 5.6 æ”¯æŒemojiè¡¨æƒ…Hexoé»˜è®¤çš„ Markdown æ¸²æŸ“å™¨æ˜¯ hexo-renderer-markedï¼Œè¿™ä¸ªæ¸²æŸ“å™¨ä¸æ”¯æŒ emoji è¡¨æƒ…ã€‚å¯ä»¥åˆ©ç”¨ hexo-filter-github-emojisæ’ä»¶å®ç°æ”¯æŒ emoji è¡¨æƒ…ã€‚ å®‰è£…æ’ä»¶ï¼š 1npm install hexo-filter-github-emojis --save ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼ˆ_config.ymlï¼‰æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 123456githubEmojis: enable: true className: github-emoji inject: true styles: customEmojis: åœ¨emoji-cheat-sheetä¸­æ‰¾åˆ°æƒ³è¦çš„è¡¨æƒ…ï¼Œç²˜è´´åˆ°æ–‡ç« ä¸­å³å¯ã€‚ äº”ã€å‘å¸ƒä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆé™æ€HTMLæ–‡ä»¶ï¼š 1hexo g ç”Ÿæˆçš„HTMLæ–‡ä»¶ä½äºåšå®¢æ ¹ç›®å½•çš„publicä¸­ï¼Œå°†è¯¥ç›®å½•éƒ¨ç½²ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨å³å¯ã€‚","tags":["Hexo"],"categories":["çˆ±æŠ˜è…¾"]},{"title":"Redisæ…¢æ—¥å¿—ä¸BigKey","path":"/post/851648499.html","content":"1. æ…¢æ—¥å¿—è®¾ç½®1234# å½“å‘½ä»¤è€—æ—¶è¶…è¿‡5æ¯«ç§’æ—¶ï¼Œè®°å½•æ…¢æ—¥å¿—CONFIG SET slowlog-log-slower-than 5000# åªä¿ç•™æœ€è¿‘500æ¡æ…¢æ—¥å¿—CONFIG SET slowlog-max-len 500 2. æŸ¥çœ‹æ…¢æ—¥å¿—123456789101112131415127.0.0.1:6379&gt; SLOWLOG get 51) 1) (integer) 32693 # æ…¢æ—¥å¿—ID 2) (integer) 1593763337 # æ‰§è¡Œæ—¶é—´æˆ³ 3) (integer) 5299 # æ‰§è¡Œè€—æ—¶(å¾®ç§’) 4) 1) &quot;LRANGE&quot; # å…·ä½“æ‰§è¡Œçš„å‘½ä»¤å’Œå‚æ•° 2) &quot;user_list:2000&quot; 3) &quot;0&quot; 4) &quot;-1&quot;2) 1) (integer) 32692 2) (integer) 1593763337 3) (integer) 5044 4) 1) &quot;GET&quot; 2) &quot;user_info:1000&quot;... 3. BigKeyå¦‚æœæŸ¥è¯¢æ…¢æ—¥å¿—å‘ç°ï¼Œå¹¶ä¸æ˜¯å¤æ‚åº¦è¿‡é«˜çš„å‘½ä»¤å¯¼è‡´çš„ï¼Œè€Œéƒ½æ˜¯ SET &#x2F; DEL è¿™ç§ç®€å•å‘½ä»¤å‡ºç°åœ¨æ…¢æ—¥å¿—ä¸­ï¼Œæ­¤æ—¶éœ€è¦è€ƒè™‘å®ä¾‹å¦å†™å…¥äº† BigKeyã€‚ BigKey ä¿—ç§°â€œå¤§ keyâ€ï¼ŒRedis æ˜¯ key-value çš„å­˜å‚¨æ–¹å¼ï¼Œå½“ä¸€ä¸ª Key æ‰€å¯¹åº”çš„å­˜å‚¨æ•°å€¼è¿‡é•¿æ—¶ï¼Œå°±ä¼šå‡ºç°å¤§ key çš„æƒ…å†µã€‚ Redis åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œéœ€è¦ä¸ºæ–°çš„æ•°æ®åˆ†é…å†…å­˜ï¼Œç›¸å¯¹åº”çš„å½“ä» Redis ä¸­åˆ é™¤æ•°æ®æ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾å¯¹åº”çš„å†…å­˜ç©ºé—´ã€‚BigKey ä¼šå¯¼è‡´åˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„è€—æ—¶éƒ½æ¯”è¾ƒé•¿ã€‚ å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ‰«æ Redis ä¸­çš„ BigKeyï¼š 1234567891011121314151617181920$ redis-cli -h 127.0.0.1 -p 6379 --bigkeys -i 0.01...-------- summary -------Sampled 829675 keys in the keyspace!Total key length in bytes is 10059825 (avg len 12.13)Biggest string found &#x27;key:291880&#x27; has 10 bytesBiggest list found &#x27;mylist:004&#x27; has 40 itemsBiggest set found &#x27;myset:2386&#x27; has 38 membersBiggest hash found &#x27;myhash:3574&#x27; has 37 fieldsBiggest zset found &#x27;myzset:2704&#x27; has 42 members36313 strings with 363130 bytes (04.38% of keys, avg size 10.00)787393 lists with 896540 items (94.90% of keys, avg size 1.14)1994 sets with 40052 members (00.24% of keys, avg size 20.09)1990 hashs with 39632 fields (00.24% of keys, avg size 19.92)1985 zsets with 39750 members (00.24% of keys, avg size 20.03) å¯¹çº¿ä¸Šå®ä¾‹è¿›è¡Œ bigkey æ‰«ææ—¶ï¼ŒRedis çš„ OPS ä¼šçªå¢ï¼Œä¸ºäº†é™ä½æ‰«æè¿‡ç¨‹ä¸­å¯¹ Redis çš„å½±å“ï¼Œéœ€è¦æ§åˆ¶æ‰«æçš„é¢‘ç‡ï¼ŒæŒ‡å®š -i å‚æ•°å³å¯ï¼Œå®ƒè¡¨ç¤ºæ‰«æè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰«æåä¼‘æ¯çš„æ—¶é—´é—´éš”ï¼Œå•ä½æ˜¯ç§’ã€‚","tags":["Redis"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"ä½¿ç”¨Watchtowerè‡ªåŠ¨æ›´æ–°Docker","path":"/post/1404510687.html","content":"WatchÂ­tower å®˜ç½‘: https://github.com/containrrr/watchtower WatchÂ­tower å¯ä»¥ç”¨äºè‡ªåŠ¨æ›´æ–° Docker é•œåƒä¸å®¹å™¨ã€‚WatchÂ­tower ä¼šç›‘è§†æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä»¥åŠç›¸å…³çš„é•œåƒï¼Œå½“æ£€æµ‹åˆ° RegÂ­istry ä¸­çš„é•œåƒä¸æœ¬åœ°çš„é•œåƒæœ‰å·®å¼‚æ—¶ï¼Œä¼šæ‹‰å–æœ€æ–°é•œåƒå¹¶ä½¿ç”¨æœ€åˆéƒ¨ç½²æ—¶ç›¸åŒçš„å‚æ•°é‡æ–°å¯åŠ¨ç›¸åº”çš„å®¹å™¨ã€‚ 1. å®‰è£…è¿è¡ŒWatchÂ­tower æœ¬èº«è¢«æ‰“åŒ…ä¸º Docker é•œåƒï¼Œå› æ­¤å¯ä»¥åƒè¿è¡Œå…¶ä»–å®¹å™¨ä¸€æ ·è¿è¡Œå®ƒï¼š 1234567docker run -d \\ --name watchtower \\ --restart unless-stopped \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower \\ --cleanup \\ --interval 60 è¿è¡Œ WatchÂ­tower åï¼Œæ‰€æœ‰å®¹å™¨éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä¹ŸåŒ…æ‹¬ WatchÂ­tower æœ¬èº«ã€‚ é»˜è®¤æƒ…å†µä¸‹ WatchÂ­tower æ¯ 5 åˆ†é’Ÿä¼šè½®è¯¢ä¸€æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨--intervalå‚æ•°æŒ‡å®šï¼ˆå•ä½ç§’ï¼‰ã€‚ æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼š 1docker run --rm containrrr/watchtower -h 2. æ‰‹åŠ¨æ›´æ–°å‰é¢çš„ä½¿ç”¨æ–¹å¼æ˜¯è®© WatchÂ­tower ä»¥ detachedï¼ˆåå°ï¼‰æ¨¡å¼åœ¨è¿è¡Œå¹¶è‡ªåŠ¨æ›´æ–°å®¹å™¨ï¼Œè€Œ WatchÂ­tower ä¹Ÿæ”¯æŒä»¥ foregroundï¼ˆå‰å°ï¼‰æ¨¡å¼æ¥ä½¿ç”¨ï¼Œå³è¿è¡Œä¸€æ¬¡é€€å‡ºå¹¶åˆ æ‰å®¹å™¨ï¼Œæ¥å®ç°æ‰‹åŠ¨æ›´æ–°å®¹å™¨ã€‚è¿™å¯¹äºå¶å°”æ›´æ–°ä¸€æ¬¡é‚£äº›ä¸åœ¨è‡ªåŠ¨æ›´æ–°åˆ—è¡¨ä¸­çš„å®¹å™¨éå¸¸æœ‰ç”¨ã€‚ å¯¹äº foreground æ¨¡å¼ï¼Œéœ€è¦åŠ ä¸Š --run-once ï¼ˆ--run-once å¯ä»¥ç®€å†™ä¸º -Rï¼‰è¿™ä¸ªä¸“ç”¨çš„é€‰é¡¹ã€‚ä¸‹é¢çš„ä¾‹å­ Docker ä¼šè¿è¡Œä¸€æ¬¡ WatchÂ­tower å¹¶æ£€æŸ¥ aria2-pro å®¹å™¨çš„åŸºç¡€é•œåƒæ›´æ–°ï¼Œæœ€ååˆ æ‰æœ¬æ¬¡è¿è¡Œåˆ›å»ºçš„ WatchÂ­tower å®¹å™¨ã€‚ 12345docker run --rm \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower --cleanup \\ --run-once \\ aria2-pro 3. æ›´æ–°ç§æœ‰é•œåƒå¦‚æœæ˜¯ä»ç§æœ‰ Docker ä»“åº“è·å–é•œåƒï¼Œåˆ™éœ€æä¾›èº«ä»½éªŒè¯å‡­æ®å’Œç¯å¢ƒå˜é‡ REPO_USER å’Œ REPO_PASSï¼Œæˆ–è€…é€šè¿‡å°†å®¿ä¸»æœºçš„ docker é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„æ ¹ç›®å½•ä¸‹ã€‚ é€šè¿‡æ·»åŠ ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼š 123456docker run -d \\ --name watchtower \\ -e REPO_USER=username \\ -e REPO_PASS=password \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower container_to_watch --debug é€šè¿‡æŒ‚è½½å®¿ä¸»æœº docker é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼š 12345docker run -d \\ --name watchtower \\ -v /home/&lt;user&gt;/.docker/config.json:/config.json \\ -v /var/run/docker.sock:/var/run/docker.sock \\ containrrr/watchtower container_to_watch --debug","tags":["Docker","WatchÂ­tower"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"Rediså¸¸è§å¼‚å¸¸åŠå¤„ç†æ–¹æ¡ˆ","path":"/post/44844734.html","content":"1. ç¼“å­˜é›ªå´©åœ¨çŸ­æ—¶é—´å†…æœ¬åº”äº¤ç”± Redis å¤„ç†çš„å¤§é‡è¯·æ±‚ï¼Œéƒ½å‘é€åˆ°äº†æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œä»è€Œå¯¼è‡´å¯¹æ•°æ®åº“çš„å‹åŠ›è¿…é€Ÿå¢å¤§ï¼Œä¸¥é‡æ—¶æ•°æ®åº“å¯èƒ½å´©æºƒï¼Œä»è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œå°±åƒé›ªå´©ä¸€æ ·ï¼Œå¼•å‘è¿é”æ•ˆåº”ï¼Œæ‰€ä»¥å«ç¼“å­˜é›ªå´©ã€‚ å‡ºç°ä¸Šè¿°æƒ…å†µçš„å¸¸è§åŸå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š å¤§é‡ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æœ¬åº”è¯·æ±‚åˆ°ç¼“å­˜çš„éœ€é‡æ–°ä»æ•°æ®åº“ä¸­è·å–æ•°æ®ã€‚ redis æœ¬èº«å‡ºç°æ•…éšœï¼Œæ— æ³•å¤„ç†è¯·æ±‚ï¼Œé‚£è‡ªç„¶ä¼šå†è¯·æ±‚åˆ°æ•°æ®åº“é‚£é‡Œã€‚ é’ˆå¯¹å¤§é‡ç¼“å­˜æ•°æ®åŒæ—¶è¿‡æœŸçš„æƒ…å†µï¼š å®é™…è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œåº”å½“å°½é‡é¿å…å¤§é‡ key åŒæ—¶è¿‡æœŸçš„åœºæ™¯ï¼Œå¦‚æœçœŸçš„æœ‰ï¼Œé‚£å°±é€šè¿‡éšæœºã€å¾®è°ƒã€å‡åŒ€è®¾ç½®ç­‰æ–¹å¼è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…åŒä¸€æ—¶é—´è¿‡æœŸã€‚ æ·»åŠ äº’æ–¥é”ï¼Œä½¿å¾—æ„å»ºç¼“å­˜çš„æ“ä½œä¸ä¼šåœ¨åŒä¸€æ—¶é—´è¿›è¡Œã€‚ åŒ key ç­–ç•¥ï¼Œä¸» key æ˜¯åŸå§‹ç¼“å­˜ï¼Œå¤‡ key ä¸ºæ‹·è´ç¼“å­˜ï¼Œä¸» key å¤±æ•ˆæ—¶ï¼Œå¯ä»¥è®¿é—®å¤‡ keyï¼Œä¸» key ç¼“å­˜å¤±æ•ˆæ—¶é—´è®¾ç½®ä¸ºçŸ­æœŸï¼Œå¤‡ key è®¾ç½®ä¸ºé•¿æœŸã€‚ åå°æ›´æ–°ç¼“å­˜ç­–ç•¥ï¼Œé‡‡ç”¨å®šæ—¶ä»»åŠ¡æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼è¿›è¡Œ redis ç¼“å­˜æ›´æ–°æˆ–ç§»é™¤ç­‰ã€‚ é’ˆå¯¹ Redis æœ¬èº«å‡ºç°æ•…éšœçš„æƒ…å†µï¼š åœ¨é¢„é˜²å±‚é¢ï¼Œå¯ä»¥é€šè¿‡ä¸»ä»èŠ‚ç‚¹çš„æ–¹å¼æ„å»ºé«˜å¯ç”¨çš„é›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯å®ç°ä¸» Redis å®ä¾‹æŒ‚æ‰åï¼Œèƒ½æœ‰å…¶ä»–ä»åº“å¿«é€Ÿåˆ‡æ¢ä¸ºä¸»åº“ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚ å¦‚æœäº‹æƒ…å·²ç»å‘ç”Ÿäº†ï¼Œé‚£å°±è¦ä¸ºäº†é˜²æ­¢æ•°æ®åº“è¢«å¤§é‡çš„è¯·æ±‚æå´©æºƒï¼Œå¯ä»¥é‡‡ç”¨æœåŠ¡ç†”æ–­æˆ–è€…è¯·æ±‚é™æµçš„æ–¹æ³•ã€‚å½“ç„¶æœåŠ¡ç†”æ–­ç›¸å¯¹ç²—æš´ä¸€äº›ï¼Œåœæ­¢æœåŠ¡ç›´åˆ° redis æœåŠ¡æ¢å¤ï¼Œè¯·æ±‚é™æµç›¸å¯¹æ¸©å’Œä¸€äº›ï¼Œä¿è¯ä¸€äº›è¯·æ±‚å¯ä»¥å¤„ç†ï¼Œä¸æ˜¯ä¸€åˆ€åˆ‡ï¼Œä¸è¿‡è¿˜æ˜¯çœ‹å…·ä½“ä¸šåŠ¡æƒ…å†µé€‰æ‹©åˆé€‚çš„å¤„ç†æ–¹æ¡ˆã€‚ 2. ç¼“å­˜å‡»ç©¿ç¼“å­˜å‡»ç©¿ä¸€èˆ¬å‡ºç°åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œæ˜¯å¤§é‡ç”¨æˆ·åŒæ—¶å¹¶å‘è¯·æ±‚ç¼“å­˜ä¸­æ²¡æœ‰ä½†æ•°æ®åº“ä¸­æœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶è¯» Redis ç¼“å­˜ï¼Œä½†ç¼“å­˜ä¸­æ²¡è¯»åˆ°æ•°æ®ï¼ŒåˆåŒæ—¶å»æ•°æ®åº“å»å–æ•°æ®ï¼Œå¼•èµ·æ•°æ®åº“å‹åŠ›ç¬é—´å¢å¤§ã€‚ å’Œç¼“å­˜é›ªå´©ä¸åŒçš„æ˜¯ï¼Œç¼“å­˜å‡»ç©¿æŒ‡å¹¶å‘æŸ¥åŒä¸€æ¡æ•°æ®ï¼Œç¼“å­˜é›ªå´©æ˜¯ä¸åŒæ•°æ®éƒ½è¿‡æœŸäº†ï¼Œå¾ˆå¤šæ•°æ®éƒ½æŸ¥ä¸åˆ°ä»è€ŒæŸ¥æ•°æ®åº“ã€‚ å‡ºç°è¿™ç§æƒ…å†µä¸€èˆ¬å› ä¸ºæŸä¸ªçƒ­ç‚¹æ•°æ®ç¼“å­˜è¿‡æœŸï¼Œç”±äºæ˜¯çƒ­ç‚¹æ•°æ®ï¼Œè¯·æ±‚å¹¶å‘é‡å¤§ï¼Œæ‰€ä»¥è¿‡æœŸçš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰å¤§é‡è¯·æ±‚åŒæ—¶è¿‡æ¥ï¼Œæ¥ä¸åŠæ›´æ–°ç¼“å­˜å°±å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“äº†ã€‚ é’ˆå¯¹è¿™ç§æƒ…å†µæœ‰ä¸¤ç§å¸¸è§çš„å¤„ç†æ–¹æ¡ˆï¼š ç®€å•ç²—æš´çš„å¯¹çƒ­ç‚¹æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·ä¸ä¼šè¿‡æœŸï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µäº†ï¼Œå¦‚æœåç»­æƒ³æ¸…ç†ï¼Œå¯ä»¥é€šè¿‡åå°è¿›è¡Œæ¸…ç†ã€‚ æ·»åŠ äº’æ–¥é”ï¼Œå³å½“è¿‡æœŸä¹‹åï¼Œé™¤äº†è¯·æ±‚è¿‡æ¥çš„ç¬¬ä¸€ä¸ªæŸ¥è¯¢çš„è¯·æ±‚å¯ä»¥è·å–åˆ°é”è¯·æ±‚åˆ°æ•°æ®åº“ï¼Œå¹¶å†æ¬¡æ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œå…¶ä»–çš„ä¼šè¢«é˜»å¡ä½ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼ŒåŒæ—¶æ–°çš„ç¼“å­˜ä¹Ÿè¢«æ›´æ–°ä¸Šå»äº†ï¼Œåç»­è¯·æ±‚åˆä¼šè¯·æ±‚åˆ°ç¼“å­˜ä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ç¼“å­˜å‡»ç©¿äº†ã€‚ 3. ç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€æ˜¯æŒ‡æ•°æ®æ—¢ä¸åœ¨ Redis ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±å¯¼è‡´æ¯æ¬¡è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°å¯¹åº” key ä¹‹åï¼Œæ¯æ¬¡éƒ½è¿˜è¦å»æ•°æ®åº“å†æŸ¥è¯¢ä¸€éï¼Œå‘ç°æ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œç›¸å½“äºè¿›è¡Œäº†ä¸¤æ¬¡æ— ç”¨çš„æŸ¥è¯¢ã€‚ è¿™æ ·è¯·æ±‚å°±å¯ä»¥ç»•è¿‡ç¼“å­˜ç›´æ¥æŸ¥æ•°æ®åº“ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰äººæƒ³æ¶æ„æ”»å‡»ç³»ç»Ÿï¼Œå°±å¯ä»¥æ•…æ„ä½¿ç”¨ç©ºå€¼æˆ–è€…å…¶ä»–ä¸å­˜åœ¨çš„å€¼è¿›è¡Œé¢‘ç¹è¯·æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹æ•°æ®åº“é€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚ é’ˆå¯¹ç¼“å­˜ç©¿é€ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸‰ç§å¤„ç†æ–¹æ¡ˆï¼š éæ³•è¯·æ±‚çš„é™åˆ¶ï¼Œä¸»è¦æ˜¯æŒ‡å‚æ•°æ ¡éªŒã€é‰´æƒæ ¡éªŒç­‰ï¼Œä»è€Œä¸€å¼€å§‹å°±æŠŠå¤§é‡çš„éæ³•è¯·æ±‚æ‹¦æˆªåœ¨å¤–ï¼Œè¿™åœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­æ˜¯å¿…è¦çš„æ‰‹æ®µã€‚ ç¼“å­˜ç©ºå€¼æˆ–è€…é»˜è®¤å€¼ï¼Œå¦‚æœä»ç¼“å­˜å–ä¸åˆ°çš„æ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰å–åˆ°ï¼Œé‚£æˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼ŒåŒæ—¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚é€šè¿‡è¿™ä¸ªè®¾ç½®çš„é»˜è®¤å€¼å­˜æ”¾åˆ°ç¼“å­˜ï¼Œè¿™æ ·ç¬¬äºŒæ¬¡åˆ°ç¼“å­˜ä¸­è·å–å°±æœ‰å€¼äº†ï¼Œè€Œä¸ä¼šç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œå¯ä»¥é˜²æ­¢æœ‰å¤§é‡æ¶æ„è¯·æ±‚æ˜¯åå¤ç”¨åŒä¸€ä¸ª key è¿›è¡Œæ”»å‡»ã€‚ ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚ é‚£ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨å‘¢ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯ä»¥å¼•å…¥äº†å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°ï¼Œä¿è¯åœ¨ç»™å®šçš„ç©ºé—´å’Œè¯¯åˆ¤ç‡ä¸‹ï¼Œå®Œæˆå…ƒç´ åˆ¤é‡ã€‚å› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œå­˜åœ¨ hash ç¢°æ’è¿™æ ·ä¸€ç§æƒ…å†µï¼Œé‚£å¦‚æœåªä½¿ç”¨ä¸€ä¸ª hash å‡½æ•°ï¼Œåˆ™ç¢°æ’å†²çªçš„æ¦‚ç‡æ˜æ˜¾ä¼šå˜å¤§ï¼Œé‚£ä¸ºäº†å‡å°‘è¿™ç§å†²çªï¼Œæˆ‘ä»¬å¯ä»¥å¤šå¼•å…¥å‡ ä¸ª hash å‡½æ•°ï¼Œè€Œå¸ƒéš†è¿‡æ»¤å™¨ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨å¤šä¸ªä¸åŒçš„ hash å‡½æ•°æ¥è§£å†³è¿™æ ·ä¸€ç§å†²çªã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡é«˜ï¼ŒæŸ¥è¯¢æ—¶é—´çŸ­ï¼Œè¿œè¶…å…¶ä»–ç®—æ³•ï¼Œè€Œå®ƒçš„ç¼ºç‚¹å°±æ˜¯ä¼šå­˜åœ¨ä¸€å®šçš„è¯¯è¯†åˆ«ç‡ï¼Œå®ƒä¸èƒ½å®Œå…¨ä¿è¯è¯·æ±‚è¿‡æ¥çš„ key é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¡éªŒå°±ä¸€å®šæœ‰è¿™ä¸ªæ•°æ®ï¼Œæ¯•ç«Ÿç†è®ºä¸Šè¿˜æ˜¯ä¼šå­˜åœ¨å†²çªæƒ…å†µï¼Œæ— è®ºæ¦‚ç‡å¤šå°ã€‚ä½†æ˜¯ï¼Œåªè¦æ²¡æœ‰é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨çš„æ ¡éªŒï¼Œé‚£ä¹ˆè¿™ä¸ª key å°±ä¸€å®šä¸å­˜åœ¨ï¼Œåªè¦åˆ©ç”¨è¿™ä¸€ç‚¹å…¶å®å°±å·²ç»å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†ä¸å­˜åœ¨çš„ key çš„è¯·æ±‚äº†ï¼Œåœ¨æ­£å¸¸åœºæ™¯ä¸‹å·²ç„¶è¶³å¤Ÿäº†ã€‚ 4. ç¼“å­˜é¢„çƒ­ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿å‰åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿä¸­å»ï¼Œè€Œä¸ä¾èµ–ç”¨æˆ·è§¦å‘è¯·æ±‚æ—¶æ‰åŠ å…¥ã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“å†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ã€‚ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼Œè¿™æ ·å¯ä»¥é¿å…é‚£ä¹ˆç³»ç»Ÿä¸Šçº¿åˆæœŸï¼Œå¯¹äºé«˜å¹¶å‘çš„æµé‡ï¼Œéƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ä¸­ï¼Œå¯¹æ•°æ®åº“é€ æˆæµé‡çš„å‹åŠ›ã€‚ æ ¹æ®æ•°æ®ä¸åŒé‡çº§ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§åšæ³•ï¼š æ•°æ®é‡ä¸å¤§ï¼šé¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ã€‚ æ•°æ®é‡è¾ƒå¤§ï¼šåå°å®šæ—¶åˆ·æ–°ç¼“å­˜ã€‚ æ•°æ®é‡æå¤§ï¼šåªé’ˆå¯¹çƒ­ç‚¹æ•°æ®è¿›è¡Œé¢„åŠ è½½ç¼“å­˜æ“ä½œã€‚ 5. ç¼“å­˜é™çº§å½“ç¼“å­˜å¤±æ•ˆæˆ–ç¼“å­˜æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†é˜²æ­¢æ•°æ®åº“å‘ç”Ÿé›ªå´©è€Œä¸å»è®¿é—®æ•°æ®åº“ï¼Œä½†æ­¤æ—¶ä»ç„¶æƒ³è¦ä¿è¯æœåŠ¡çš„ä¸»ä½“åŠŸèƒ½æ˜¯åŸºæœ¬å¯ç”¨çš„ã€‚å› æ­¤å¯¹äºä¸é‡è¦çš„ç¼“å­˜æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–æœåŠ¡é™çº§ç­–ç•¥ã€‚ ä¸€èˆ¬åšæ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š ç›´æ¥è®¿é—®å†…å­˜éƒ¨åˆ†çš„æ•°æ®ç¼“å­˜ã€‚ ç›´æ¥è¿”å›ç³»ç»Ÿè®¾ç½®çš„é»˜è®¤å€¼ã€‚","tags":["Redis"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"Windowså¹³å°æ–‡ä»¶è‡ªç­¾å","path":"/post/667140500.html","content":"æœ¬æ–‡ä½¿ç”¨çš„å·¥å…·éƒ½æ˜¯ Windows SDK è‡ªå¸¦çš„ï¼Œå¯ä»¥é‡‡ç”¨å•ç‹¬å®‰è£… Windows SDKçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®‰è£… Visual Studio æ¥é™„å¸¦å®‰è£… Windows SDKã€‚ 123456# åœ¨å¼¹å‡ºç•Œé¢è®¾ç½®å¯†ç 123456makecert.exe -sv test.pvk -r -n &quot;CN=test.com&quot; test.cercert2spc.exe test.cer test.spcpvk2pfx.exe -pvk test.pvk -pi 123456 -spc test.spc -pfx test.pfx -f ä½¿ç”¨ SignTool å·¥å…·å¯¹ EXE æ–‡ä»¶ç­¾åï¼š 1signtool.exe sign /f test.pfx /p 123456 Setup.exe","tags":["ç­¾å","æ•°å­—è¯ä¹¦"],"categories":["Windowsç¼–ç¨‹"]},{"title":"WindowséŸ³é¢‘ç¯å›å½•åˆ¶","path":"/post/2236960039.html","content":"æ‰€è°“éŸ³é¢‘ç¯å›å½•åˆ¶å°±æ˜¯å½•åˆ¶æ‰¬å£°å™¨æ’­æ”¾çš„å£°éŸ³ã€‚æ’­æ”¾åˆ°æ‰¬å£°å™¨çš„å£°éŸ³å·²ç»è¿‡æ··åˆï¼ŒWindows æä¾›äº† WASAPI æ¥è·å–è¿™ç§æ··åˆçš„éŸ³é¢‘ä¿¡å·ã€‚ æœ¬æ–‡å°†å½•åˆ¶åˆ°åŸå§‹éŸ³é¢‘æ ·æœ¬æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨Audacityå¯¼å…¥åŸå§‹æ•°æ®è¯•å¬ã€‚ åœ¨ Audacity ä¸­å¯¼å…¥åŸå§‹æ•°æ®æ—¶éœ€è¦é€‰æ‹©æ­£ç¡®çš„éŸ³é¢‘å‚æ•°ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ— æ³•æ’­æ”¾ã€‚ åˆå§‹åŒ–è®¾å¤‡å£°æ˜ç›¸å…³å˜é‡ï¼š 12345IMMDeviceEnumerator* pDeviceEnum = NULL;IMMDevice* pDevice = NULL;IAudioClient* pAudioClient = NULL;WAVEFORMATEX* pWaveFormat = NULL;IAudioCaptureClient* pAudioCaptureClient = NULL; è·å–é»˜è®¤éŸ³é¢‘è¾“å‡ºè®¾å¤‡å¹¶åˆå§‹åŒ–ç¯å›å½•åˆ¶æœåŠ¡ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455HRESULT InitRecord() &#123; HRESULT hr; hr = CoCreateInstance(CLSID_MMDeviceEnumerator, NULL, CLSCTX_ALL, IID_IMMDeviceEnumerator, (void**)&amp;pDeviceEnum); if (FAILED(hr)) &#123; printf(&quot;Create device enumerator failed, hr: 0x%x&quot;, hr); return hr; &#125; hr = pDeviceEnum-&gt;GetDefaultAudioEndpoint(eRender, eConsole, &amp;pDevice); if (FAILED(hr)) &#123; printf(&quot;Get default audio device failed, hr: 0x%x&quot;, hr); return hr; &#125; hr = pDevice-&gt;Activate(IID_IAudioClient, CLSCTX_ALL, NULL, (void**)&amp;pAudioClient); if (FAILED(hr)) &#123; printf(&quot;Create audio client failed, hr: 0x%x&quot;, hr); return hr; &#125; hr = pAudioClient-&gt;GetMixFormat(&amp;pWaveFormat); if (FAILED(hr)) &#123; printf(&quot;Get mix format failed, hr: 0x%x&quot;, hr); return hr; &#125; printf(&quot;Channel: %d, SamplesPerSec: %d, BitsPerSample: %d &quot;, pWaveFormat-&gt;nChannels, pWaveFormat-&gt;nSamplesPerSec, pWaveFormat-&gt;wBitsPerSample); hr = pAudioClient-&gt;Initialize(AUDCLNT_SHAREMODE_SHARED, AUDCLNT_STREAMFLAGS_LOOPBACK, BUFFER_TIME_100NS, 0, pWaveFormat, NULL); if (FAILED(hr)) &#123; // å…¼å®¹NahimicéŸ³é¢‘é©±åŠ¨ // https://github.com/rainmeter/rainmeter/commit/0a3dfa35357270512ec4a3c722674b67bff541d6 // https://social.msdn.microsoft.com/Forums/windowsdesktop/en-US/bd8cd9f2-974f-4a9f-8e9c-e83001819942/iaudioclient-initialize-failure // åˆå§‹åŒ–å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ç«‹ä½“å£°æ ¼å¼è¿›è¡Œåˆå§‹åŒ– pWaveFormat-&gt;nChannels = 2; pWaveFormat-&gt;nBlockAlign = (2 * pWaveFormat-&gt;wBitsPerSample) / 8; pWaveFormat-&gt;nAvgBytesPerSec = pWaveFormat-&gt;nSamplesPerSec * pWaveFormat-&gt;nBlockAlign; hr = pAudioClient-&gt;Initialize(AUDCLNT_SHAREMODE_SHARED, AUDCLNT_STREAMFLAGS_LOOPBACK, BUFFER_TIME_100NS, 0, pWaveFormat, NULL); if (FAILED(hr)) &#123; printf(&quot;Initialize audio client failed, hr: 0x%x&quot;, hr); return hr; &#125; &#125; hr = pAudioClient-&gt;GetService(IID_IAudioCaptureClient, (void**)&amp;pAudioCaptureClient); if (FAILED(hr)) &#123; printf(&quot;Get audio capture client failed, hr: 0x%x&quot;, hr); return hr; &#125; return S_OK;&#125; é‡‡æ ·åœ¨åˆå§‹åŒ–æˆåŠŸåï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹æŒ‰å›ºå®šé—´éš”è·å–ç¼“å†²åŒºä¸­çš„éŸ³é¢‘æ ·æœ¬ã€‚exitFlagç”¨äºæ§åˆ¶çº¿ç¨‹æ˜¯å¦é€€å‡ºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// çº¿ç¨‹å¤„ç†å‡½æ•°void QueryAudioSampleThread() &#123; UINT32 bufferFrameCount = 0; HRESULT hr = pAudioClient-&gt;GetBufferSize(&amp;bufferFrameCount); if (FAILED(hr)) &#123; printf(&quot;Get buffer frame count failed, hr: 0x%x&quot;, hr); return; &#125; // æ ¹æ®å®é™…ç¼“å†²åŒºä¸­çš„æ ·æœ¬æ•°è®¡ç®—å®é™…å¡«æ»¡ç¼“å†²åŒºéœ€è¦çš„æ—¶é—´ REFERENCE_TIME hnsActualDuration = (double)BUFFER_TIME_100NS * bufferFrameCount / pWaveFormat-&gt;nSamplesPerSec; UINT32 packetLength = 0; BYTE* buffer = NULL; UINT32 numFramesAvailable = 0; DWORD flags = 0; while (!exitFlag.load()) &#123; // ç­‰å¾…åŠä¸ªç¼“å†²å‘¨æœŸ Sleep(hnsActualDuration / 10000 / 2); hr = pAudioCaptureClient-&gt;GetNextPacketSize(&amp;packetLength); if (FAILED(hr)) &#123; printf(&quot;Get next package size failed, hr: 0x%x&quot;, hr); break; &#125; while (packetLength &gt; 0) &#123; hr = pAudioCaptureClient-&gt;GetBuffer(&amp;buffer, &amp;numFramesAvailable, &amp;flags, NULL, NULL); if (FAILED(hr)) &#123; printf(&quot;Get capture buffer failed, hr: 0x%x&quot;, hr); break; &#125; // å°†æ•è·åˆ°çš„æ ·æœ¬å†™å…¥æ–‡ä»¶ if (!WriteSample(buffer, numFramesAvailable * pWaveFormat-&gt;nChannels * pWaveFormat-&gt;wBitsPerSample / 8)) &#123; printf(&quot;Write sample to file failed&quot;); &#125; hr = pAudioCaptureClient-&gt;ReleaseBuffer(numFramesAvailable); if (FAILED(hr)) &#123; printf(&quot;Release capture buffer failed, hr: 0x%x&quot;, hr); break; &#125; hr = pAudioCaptureClient-&gt;GetNextPacketSize(&amp;packetLength); if (FAILED(hr)) &#123; printf(&quot;Get next package size failed, hr: 0x%x&quot;, hr); break; &#125; &#125; &#125;&#125; Sampleå’ŒFrameçš„å«ä¹‰pWaveFormat-&gt;nSamplesPerSecè¡¨ç¤ºæ¯ç§’é‡‡æ ·çš„æ¬¡æ•°ï¼Œå¦‚48000çš„é‡‡æ ·ç‡å°±æ˜¯æ¯ç§’é‡‡48000ä¸ªSampleï¼Œä¸€ä¸ªSample æ˜¯ä¸€ä¸ªå£°é“çš„ä¸€ä¸ªé‡‡æ ·ã€‚ è€ŒFrame åˆ™æ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹çš„Sampleé›†åˆï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªçº¿æ€§çš„PCM åŒå£°é“éŸ³é¢‘æ–‡ä»¶æ¯ä¸ªFrameæœ‰2ä¸ªSampleï¼Œä¸€ä¸ªå·¦å£°é“Sampleï¼Œå’Œä¸€ä¸ªå³å£°é“Sampleã€‚ é‡Šæ”¾è®¾å¤‡å’Œå†…å­˜åœ¨å½•åˆ¶ç»“æŸåé‡Šæ”¾è®¾å¤‡å’Œå†…å­˜ï¼š 1234567891011void UnInitRecord() &#123; if (pWaveFormat) &#123; CoTaskMemFree(pWaveFormat); pWaveFormat = NULL; &#125; SAFE_RELEASE(pDeviceEnum); SAFE_RELEASE(pDevice); SAFE_RELEASE(pAudioClient); SAFE_RELEASE(pAudioCaptureClient);&#125; å®Œæ•´ç¤ºä¾‹ä»£ç è§ï¼šAudioLoopbackRecord.cpp","tags":["WASAPI","Loopback","Audacity","ç¯å›å½•åˆ¶"],"categories":["Windowsç¼–ç¨‹"]},{"title":"å²é“ç”Ÿï¼šèŒä¸šäº‹ä¸šï¼ˆèŠ‚é€‰ï¼‰ã€è½¬è½½ã€‘","path":"/post/1173742882.html","content":"é€‰æ‹©ä¸€é¡¹äº‹ä¸šï¼ˆæˆ–è€…æ‰¾ä¸€æ¡èƒ½å¤Ÿè½½æ¸¡ç²¾ç¥çš„èˆ¹ï¼‰çš„æ—¶å€™ï¼Œåº”è¯¥æƒ³èµ·å…µä¹¦ä¸Šçš„ä¸€å¥è¯ï¼šçŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†ã€‚æ²¡æœ‰è°æ˜¯ä¸ºäº†å¤±è´¥è€Œå·¥ä½œçš„ï¼Œå› ä¸ºæ³¨å®šçš„å¤±è´¥ä¸èƒ½å¼•å¯¼å‡ºä¸€ä¸ªå¦‚é†‰å¦‚ç—´çš„è¿‡ç¨‹ã€‚ æ‰€è°“çŸ¥å·±ï¼Œå°±æ˜¯è¦çŸ¥é“è‡ªå·±çš„å…´è¶£ä½•åœ¨ï¼Ÿè‡ªå·±çš„ç¦€èµ‹ä½•åœ¨ï¼Ÿå¦‚æœä½ å–œæ¬¢æ–‡å­¦ï¼Œå¯ä½ ååä¸è‚¯èˆå¼ƒä¸€ä¸ªå­¦åŒ–å­¦çš„æœºä¼šï¼Œä¸”ä¸è¯´æ²¡æœ‰å…´è¶£ä½ çš„åŒ–å­¦å¾ˆéš¾å­¦å¥½ï¼Œå³ä¾¿ä½ å°æœ‰æˆå°±é‚£ä¹Ÿæ˜¯ä½ çš„æ‚²å‰§ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæ•°å­¦å¤©æ‰ï¼Œæ¯”å¦‚è¯´æ˜¯ä¸€ä¸ªæ½œåœ¨çš„é™ˆæ™¯æ¶¦ï¼Œå¯ä½ å¯¹æ­¤æ˜ç„¶ä¸çŸ¥åè¦å»å½“ä¸€ä¸ªå†™å°è¯´çš„ï¼Œç»“æœå¤šåŠä¸å¦™ã€‚ æ‰€è°“çŸ¥å½¼ï¼Œå°±æ˜¯å¾—çŸ¥é“å®¢è§‚æ¡ä»¶å…è®¸ä½ å¹²ä»€ä¹ˆã€‚å¦‚æœä½ çƒ­çˆ±èµ·è¶³çƒçš„æ—¶å€™å·²ç» 40 å¤šå²ï¼Œä½ æœ€å¥½å®‰å¿ƒä½œä¸€ä¸ªçƒè¿·ï¼Œåƒä¸‡åˆ«å­¦é©¬æ‹‰å¤šçº³äº†ã€‚å¦‚æœä½ ç¾¡æ…•ä¸‰æ¯›ï¼Œä½ ä¹Ÿæœ‰æ–‡å­¦æ‰èƒ½ï¼Œä½†æ˜¯ä½ çš„åŒè…¿ä¸€åŠ¨éƒ½ä¸èƒ½åŠ¨ï¼Œä½ å°±ä¸è¦å‘å¾€æ’’å“ˆæ‹‰ï¼Œä½ ä¸å¦‚å†™ä¸€å†™è‡ªå·±å¿ƒä¸­çš„æ²™æ¼ ã€‚ æˆ‘ä¸€è´¯ç›¸ä¿¡ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„æ‰€é•¿ï¼Œå€˜èƒ½æ‰¬é•¿é¿çŸ­è°éƒ½èƒ½æœ‰æ‰€ä½œä¸ºï¼›ç›¸åå¦‚æœå¼ƒé•¿å–çŸ­ï¼Œå¤©æ‰ä¹Ÿèƒ½æˆä¸ºè ¢æ‰ï¼Œä¸ä¿¡è®©é™ˆæ™¯æ¶¦ä¸æ‰˜å°”æ–¯æ³°è°ƒæ¢ä¸€ä¸‹å·¥ä½œè¯•è¯•çœ‹ã€‚å¯¹äº‹ä¸šçš„é€‰æ‹©ï¼Œè¦æ ¹æ®â€œçŸ¥å·±çŸ¥å½¼â€çš„åŸåˆ™ï¼Œå¯åˆ«ä¸ºâ€œçƒ­é—¨â€æˆ–æ—¶é«¦æ‰€å·¦å³ã€‚ ç„¶åè¿˜å¾—éœ€è¦ç‚¹å‹‡æ°”ï¼Œéœ€è¦å†’ä¸€ç‚¹é£é™©ï¼Œæ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½ä¿è¯ä½ è‚¯å®šæœ‰ä¸€æ¡é‡‘å…‰å¤§é“ã€‚æˆ‘å¼€å§‹æƒ³å†™ä½œçš„æ—¶å€™ï¼Œäººä»¬æé†’æˆ‘è¯´ï¼Œä½ å“ªå„¿éƒ½å»ä¸äº†ä¸èƒ½æ·±å…¥ç”Ÿæ´»ï¼Œä½ å‡­ä»€ä¹ˆèƒ½å¹²è¿™ä¸€è¡Œå‘¢ï¼Ÿæˆ‘è‡ªå·±å¿ƒé‡Œä¹Ÿæ‰“é¼“ã€‚å¯æ˜¯æˆ‘å¿ä¸ä½åœ°æƒ³å†™ã€‚æˆ‘æœ‰çº¸ä¹Ÿæœ‰ç¬”ï¼Œè¿˜æœ‰å¥½å¤šæƒ³æ³•ï¼Œåˆ«äººä¸€å¤©æœ‰ 24 å°æ—¶çš„ç”Ÿæ´»ï¼Œæˆ‘ä¸€å¤©ä¹Ÿæœ‰ 24 å°æ—¶çš„ç”Ÿæ´»ï¼Œæ‰€æœ‰çš„ç”Ÿæ´»ä¸€æ ·éƒ½æœ‰å“å‘³ä¸å°½çš„æ·±æ„ï¼Œæˆ‘å°±å·å·åœ°å†™äº†ä¸€ç‚¹ï¼Œè‡ªå·±è§‰å¾—è¿˜æœ‰å¸Œæœ›ï¼Œäºæ˜¯è±å‡ºå»äº†ï¼Œå†™ï¼å¦‚æœä½ çœ‹ä¸å‡ºä½ çš„é€‰æ‹©æœ‰ä»€ä¹ˆä¸å¯¹å¤´ï¼Œä½ å¾—è±å¾—å‡ºå»ï¼Œä½ å¾—æ•¢äºè¯•è¯•ï¼Œä¸€æ¡é“èµ°åˆ°é»‘æˆ–è€…ä¸æ’å—å¢™ä¸å›å¤´ã€‚å½“ç„¶é‚£æ—¶æˆ‘å·²ç»åœ¨è¡—é“ç”Ÿæ´»ç»„æŒ£ç€è‡ªå·±çš„é¥­é’±äº†ï¼Œæˆ‘æƒ³æˆ‘æœ€ä¸æµæ˜¯ä¸ª 0ï¼Œä¸ä¼šæ˜¯ä¸ªè´Ÿæ•°äº†ã€‚","tags":["å²é“ç”Ÿ"],"categories":["ç¾æ–‡èµæ"]},{"title":"C++è·å–å…¶ä»–Windowsè¿›ç¨‹å‘½ä»¤è¡Œ","path":"/post/3666245140.html","content":"æœ¬æ–‡ä»‹ç»å¦‚ä½•æ ¹æ®è¿›ç¨‹ ID è·å–è¿›ç¨‹å‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨ NTDLL æä¾›çš„æœªå…¬å¼€ API å®ç°ã€‚ ç”±äºéœ€è¦ä½¿ç”¨åº”ç”¨å±‚æœªå…¬å¼€çš„ APIï¼Œè¿™äº› API åœ¨ Windows æä¾›çš„å¤´æ–‡ä»¶æœªæä¾›å‡½æ•°çš„å®šä¹‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨GetProcessAddressåŠ¨æ€åœ°ä» ntdll.dll ä¸­è·å–å‡½æ•°åœ°å€ã€‚ åœ¨æ¶‰åŠè°ƒç”¨å‡½æ•°æ¯”è¾ƒå¤šæ—¶ï¼ŒåŠ¨æ€çš„è·å–å‡½æ•°åœ°å€å°±ä¼šæ˜¾å¾—æ¯”è¾ƒç¹çï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„åº“æ¥ç®€åŒ–ä¸Šè¿°æ“ä½œã€‚https://github.com/winsoft666/ndk ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨ndkåº“æ¥æ ¹æ®è¿›ç¨‹ ID è·å–è¿›ç¨‹å‘½ä»¤è¡Œå‚æ•°ã€‚ é¦–å…ˆéœ€è¦åŒ…å«å¤´æ–‡ä»¶ï¼š 1234extern &quot;C&quot; &#123;#pragma warning(disable : 4005)#include &quot;ntndk.h&quot;&#125; å¹¶å¼•å…¥å¯¹åº” libï¼šx86 tdll.libæˆ–x64 tdll.libã€‚ æ‹¿å»ç”¨å§å…·ä½“è·å–å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼å·²å°è£…åˆ°ä¸‹é¢GetProcessCommandLineå‡½æ•°ï¼Œæ–¹ä¾¿è¯»è€…é£Ÿç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990// è¿”å›å€¼ä¸º0è¡¨ç¤ºæˆåŠŸDWORD GetProcessCommandLine(unsigned int pid, std::wstring&amp; strResult) &#123; BOOL result = false; SetLastError(0); HANDLE hProcess = NULL; PPEB ppebCopy = NULL; PRTL_USER_PROCESS_PARAMETERS pRtlProcParamCopy = NULL; PWSTR wBufferCopy = NULL; do &#123; hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid); if (!hProcess) break; PROCESS_BASIC_INFORMATION basicInfo; ZeroMemory(&amp;basicInfo, sizeof(PROCESS_BASIC_INFORMATION)); NTSTATUS status = NtQueryInformationProcess(hProcess, ProcessBasicInformation, &amp;basicInfo, sizeof(PROCESS_BASIC_INFORMATION), NULL); if (!NT_SUCCESS(status)) break; PPEB ppeb = basicInfo.PebBaseAddress; ppebCopy = (PPEB)malloc(sizeof(PEB)); if (!ppebCopy) break; result = ReadProcessMemory(hProcess, ppeb, ppebCopy, sizeof(PEB), NULL); if (!result) break; PRTL_USER_PROCESS_PARAMETERS pRtlProcParam = ppebCopy-&gt;ProcessParameters; pRtlProcParamCopy = (PRTL_USER_PROCESS_PARAMETERS)malloc(sizeof(RTL_USER_PROCESS_PARAMETERS)); if (!pRtlProcParamCopy) break; result = ReadProcessMemory(hProcess, pRtlProcParam, pRtlProcParamCopy, sizeof(RTL_USER_PROCESS_PARAMETERS), NULL); if (!result) break; PWSTR wBuffer = pRtlProcParamCopy-&gt;CommandLine.Buffer; USHORT len = pRtlProcParamCopy-&gt;CommandLine.Length; wBufferCopy = (PWSTR)malloc(len + 2); if (!wBufferCopy) break; memset(wBufferCopy, 0, len + 2); result = ReadProcessMemory(hProcess, wBuffer, wBufferCopy, // command line goes here len, NULL); if (result) strResult = wBufferCopy; &#125; while (false); DWORD dwGLE = 0; if (!result) &#123; dwGLE = GetLastError(); &#125; if (ppebCopy) free(ppebCopy); if (pRtlProcParamCopy) free(pRtlProcParamCopy); if (wBufferCopy) free(wBufferCopy); if (hProcess) CloseHandle(hProcess); return dwGLE;&#125;","tags":["è¿›ç¨‹"],"categories":["Windowsç¼–ç¨‹"]},{"title":"å¼€æºåº“rpclibä½¿ç”¨å¤‡å¿˜","path":"/post/1963116418.html","content":"rpclibæ˜¯ä¸€ä¸ª C++çš„ RPC åº“ï¼ŒåŸºäº MessagePack è¿›è¡ŒäºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œåº•å±‚ä½¿ç”¨ TCP è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚å…¶åŠŸèƒ½ä¸ Facebook çš„ Thriftã€Google çš„ Protocol Buffers ç›¸ä¼¼ï¼Œä½† rpclib æ›´åŠ è½»é‡çº§ï¼Œä¸éœ€è¦ä¾èµ– Boostï¼Œè€Œä¸”ä¸ç”¨å£°æ˜æ¥å£æè¿°æ–‡ä»¶ã€‚ rpclib å®˜ç½‘ï¼š https://github.com/rpclib/rpclib 1. ç¼–è¯‘ä½¿ç”¨ CMake ç”Ÿæˆå¯¹åº”ç¼–è¯‘ç³»ç»Ÿçš„é¡¹ç›®æ–‡ä»¶ï¼Œç¼–è¯‘å³å¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ vcpkg è¿›è¡Œå®‰è£…ï¼Œå¦‚ï¼š 1vcpkg install rpclib:x86-windows-static 2. ç®€å•åº”ç”¨rpclib æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¦‚å¿µï¼Œåªèƒ½ç”±å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯ï¼Œæ¥å—æœåŠ¡ç«¯çš„è¿”å›å€¼ï¼ŒæœåŠ¡ç«¯ä¸èƒ½ä¸»åŠ¨è°ƒç”¨å®¢æˆ·ç«¯å‡½æ•°ã€‚å¦‚éœ€å®ç°ä¸¤ç«¯åŒå‘è°ƒç”¨ï¼Œåˆ™éœ€è¦åœ¨ä¸¤ç«¯åˆ†åˆ«å¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œå¹¶å½¼æ­¤ç›¸è¿ã€‚ rpclib åº“çš„é”™è¯¯æ˜¯é€šè¿‡ C++å¼‚å¸¸æŠ›å‡ºçš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨è¯¥åº“æ—¶éœ€è¦ä½¿ç”¨ try...catch è¿›è¡Œå¼‚å¸¸æ•è·ã€‚ 2.1 æœåŠ¡ç«¯åœ¨æœåŠ¡ç«¯å®Œæˆç«¯å£ç›‘å¬ï¼ŒåŠå‡½æ•°çš„ç»‘å®šæ“ä½œã€‚ 12345678910111213141516#include &quot;rpc/server.h&quot;try &#123; std::shared_ptr&lt;rpc::server&gt; rpcServer = std::make_shared&lt;rpc::server&gt;(&quot;0.0.0.0&quot;, 8001); // 8001ä¸ºç›‘å¬ç«¯å£ // ç»‘å®šAddå‡½æ•°ï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨ rpcServer-&gt;bind(&quot;Add&quot;, [](int x, int y) -&gt; int &#123; return x + y; &#125;); rpcServer-&gt;async_run(); // å¼‚æ­¥å¯åŠ¨Serverå¾ªç¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨run()åŒæ­¥å¯åŠ¨&#125;catch(std::exception&amp; e) &#123; // ...&#125; 2.2 å®¢æˆ·ç«¯å®¢æˆ·ç«¯é€šè¿‡ IP å’Œç«¯å£è¿æ¥æœåŠ¡ç«¯ï¼Œå¹¶è°ƒç”¨æœåŠ¡ç«¯çš„å‡½æ•°ã€‚ 1234567891011121314#include &quot;rpc/client.h&quot;try &#123; std::shared_ptr&lt;rpc::client&gt; rpcClient = std::make_shared&lt;rpc::client&gt;(&quot;127.0.0.1&quot;, 8001); // æœåŠ¡ç«¯ç›‘å¬ç«¯å£ rpcClient-&gt;set_timeout(200); // è®¾ç½®åŒæ­¥è°ƒç”¨çš„è¶…æ—¶æ—¶é—´ int result = rpcClient-&gt;call(&quot;Add&quot;, 100, 200).as&lt;int&gt;(); // è°ƒç”¨Addå‡½æ•°ï¼Œå‚æ•°ä¸º100,200 // resultä¸ºAddå‡½æ•°çš„è¿”å›å€¼&#125;catch(std::exception&amp; e) &#123; // ...&#125; 2.3 æ”¯æŒçš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹rpclib ä½¿ç”¨ MessagePack è¿›è¡Œåºåˆ—åŒ–ï¼Œæ”¯æŒçš„æ•°æ®ç±»å‹ä¸ MessagePack ç›¸åŒã€‚æ”¯æŒå¦‚ä¸‹ C++ç±»å‹ï¼š bool char* double float charï¼Œä¸æ”¯æŒ wchar_t short int long long long std::stringï¼Œä¸æ”¯æŒ std::wstring std::vector std::array std::map std::shared_ptr std::unique_ptr 3. å¹¿å‘Šåœ¨è¿™é‡Œæ¨èæˆ‘çš„veigaræ¡†æ¶ï¼Œä¸€ä¸ªåŸºäºå…±äº«å†…å­˜çš„rpcæ¡†æ¶ï¼Œä¸rpclibç›¸æ¯”æœ‰å¦‚ä¸‹çš„ä¼˜åŠ¿ï¼š æ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ¦‚å¿µï¼Œæ¯ä¸ªVeigarå®ä¾‹é—´éƒ½å¯ä»¥ç›¸äº’è°ƒç”¨ã€‚ æ²¡æœ‰ç½‘ç»œé—®é¢˜ï¼Œå¦‚ç«¯å£å ç”¨ã€åŠå…³é—­çŠ¶æ€ç­‰ã€‚ æ²¡æœ‰è¯¡å¼‚çš„ç«¯å£å‡å¯ç”¨æ€§é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯åœ¨Windowsç³»ç»Ÿä¸Šï¼‰ã€‚","tags":["RPC"],"categories":["å¼€æºåº“"]},{"title":"æ­å»ºJavaScriptå’ŒTypeScriptå¼€å‘è°ƒè¯•ç¯å¢ƒ","path":"/post/997636699.html","content":"ä¸€ã€å®‰è£…Visual Studio CodeVisual Studio Codeï¼ˆç®€ç§°VSCodeï¼‰æ˜¯ç”±å¾®è½¯å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ä»£ç ç¼–è¾‘å™¨ã€‚Visual Studio Codeçš„ä¼˜åŠ¿å°±æ˜¯æœ‰ä¸°å¯Œçš„æ‰©å±•åŒ…ï¼Œå¤§å¤šæ•°åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡å®‰è£…æ‰©å±•åŒ…çš„æ–¹å¼æ¥å®ç°ã€‚ æ‰“å¼€Visual Studio Codeå®˜ç½‘https://code.visualstudio.com/ï¼Œæ ¹æ®ç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…ï¼š å®‰è£…é€‰é¡¹å¯ä»¥æ ¹æ®ä¸ªäººå–œæ¬¢æ¥æŒ‡å®šï¼Œæ²¡æœ‰å¼ºåˆ¶çš„è¦æ±‚ã€‚ä½†å»ºè®®å‹¾é€‰å¦‚ä¸‹4é¡¹ï¼š äºŒã€é…ç½®Visual Studio Code2.1 å°†é»˜è®¤è¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡å®‰è£…å®ŒVisual Studio Codeä¹‹åï¼Œå…¶ç•Œé¢çš„é»˜è®¤è¯­è¨€æ˜¯è‹±æ–‡ï¼Œæˆ‘ä»¬åªéœ€è¦å®‰è£…â€œç®€ä½“ä¸­æ–‡çš„è¯­è¨€åŒ…â€å°±å¯ä»¥å°†è¯­è¨€ä¿®æ”¹ä¸ºä¸­æ–‡ï¼šç‚¹å‡»å·¦ä¾§â€œæ‰©å±•â€å›¾æ ‡ï¼Œæ‰“å¼€æ‰©å±•å·¥å…·æ ï¼Œè¾“å…¥â€œChineseâ€æœç´¢ç®€ä½“ä¸­æ–‡è¯­è¨€æ‰©å±•åŒ…ï¼Œå®‰è£…å®Œé‡å¯Visual Studio Codeå³å¯ã€‚ ä¸‰ã€è°ƒè¯•ç¯å¢ƒé€‰æ‹©å¯åŠ¨Visual Studio Codeï¼ŒæŒ‰ä¸‹å¿«æ·é”®F5ï¼Œå¯ä»¥çœ‹åˆ°Visual Studio Codeå·²ç»å†…ç½®äº†å‡ ç§è°ƒè¯•ç¯å¢ƒçš„é…ç½®ï¼šä½†æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™äº›é…ç½®è¿˜éœ€è¦å®‰è£…å¯¹åº”çš„è¿è¡Œæ—¶ç¯å¢ƒå¦‚Node.jsã€Chromeã€‚ Visual Studio Codeä¹Ÿå¯ä»¥è°ƒè¯•C++ï¼ŒC#ï¼ŒPythonï¼ŒGoï¼ŒC++ç­‰è¯­è¨€ï¼Œä½†éœ€è¦åœ¨launch.jsonä¸­è¿›è¡Œé€‚å½“çš„é…ç½®ï¼Œåé¢åœ¨è®²è§£ä½¿ç”¨Node.jsè°ƒè¯•TypeScriptçš„æ—¶å€™ä¼šä»‹ç»å¦‚ä½•é…ç½®launch.jsonã€‚ å› ä¸ºNode.jså¯ä»¥ç›´æ¥è¿è¡ŒJavascriptè„šæœ¬æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨Node.jsæ¥è°ƒè¯•JavaScriptã€‚ åœ¨å¼€å§‹è°ƒè¯•å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…Node.jsè¿è¡Œæ—¶ç¯å¢ƒï¼Œæ‰“å¼€Node.jsä¸­æ–‡å®˜ç½‘https://nodejs.org/zh-cn/ï¼Œé€‰æ‹©é•¿æœŸæ”¯æŒç‰ˆï¼Œä¸‹è½½å®‰è£…å³å¯ï¼ˆå®‰è£…å®Œæˆä¹‹åå¯èƒ½éœ€è¦é‡å¯Visual Studio Codeï¼‰ï¼š å››ã€è°ƒè¯•JavaScriptæ‰“å¼€Visual Studio Codeï¼Œæ–°å»ºä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼Œè¾“å…¥ä»»æ„JavaScriptä»£ç å¹¶ä¿å­˜ï¼Œå¦‚ï¼šç‚¹å‡»å·¦ä¾§å·¥å…·æ çš„â€œè¿è¡Œâ€å›¾æ ‡ï¼ˆå¿«æ·é”®Ctrl+Shift+Dï¼‰å¹¶é€‰æ‹©â€œè¿è¡Œå’Œè°ƒè¯•â€ï¼ˆæˆ–è€…æŒ‰F5å¿«æ·é”®ï¼‰ï¼Œåœ¨å¼¹å‡ºçš„è°ƒè¯•ç¯å¢ƒä¸‹æ‹‰æ¡†ä¸­ä¸­é€‰æ‹©â€œNode.jsâ€ï¼Œæ­¤æ—¶å°±ä¼šä½¿ç”¨Node.jsæ¥è¿è¡Œå½“å‰è„šæœ¬ã€‚ æ­¤æ—¶æ˜¯çœ‹ä¸åˆ°console.logçš„è¾“å‡ºï¼Œå› ä¸ºå…¶è¾“å‡ºåˆ°äº†â€è°ƒè¯•æ§åˆ¶å°â€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨â€œæŸ¥çœ‹â€èœå•ä¸­æ‰“å¼€â€œè°ƒè¯•æ§åˆ¶å°â€ï¼Œå†æ¬¡ä½¿ç”¨ä¸Šé¢æ­¥éª¤è¿è¡ŒJavaScriptæ–‡ä»¶å³å¯åœ¨â€œè°ƒè¯•æ§åˆ¶å°â€çœ‹åˆ°è¿è¡Œçš„è¾“å‡ºäº†ã€‚ 4.1 æ–­ç‚¹è®¾ç½®&#x2F;å–æ¶ˆæ–­ç‚¹ï¼šç”¨é¼ æ ‡ç‚¹å‡»è¡Œå·å·¦ä¾§åŒºåŸŸï¼ˆå³ä¸‹å›¾ç”»ç»¿æ¡†çš„åŒºåŸŸï¼‰å³å¯è®¾ç½®æ–­ç‚¹ï¼Œå†æ¬¡ç‚¹å‡»ä¾¿æ˜¯å–æ¶ˆæ–­ç‚¹ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨å¿«æ·é”®F9æ¥è®¾ç½®&#x2F;å–æ¶ˆæ–­ç‚¹.è®¾ç½®æ–­ç‚¹åï¼ŒF5å¼€å§‹è°ƒè¯•ä»£ç ï¼Œä»£ç è¿è¡Œåˆ°æ–­ç‚¹å¤„ä¾¿ä¼šæš‚åœï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨å·¦ä¾§åŒºåŸŸæŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡æ¶‰åŠçš„â€å±€éƒ¨å˜é‡â€å’Œâ€å…¨å±€å˜é‡â€ã€â€è°ƒç”¨å †æ ˆâ€ã€ä»¥åŠâ€æ–­ç‚¹åˆ—è¡¨â€ã€‚ 4.2 è°ƒè¯•å¿«æ·é”® F5 å¼€å§‹è°ƒè¯•æˆ–åœ¨ä»£ç æš‚åœåç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€å¤„æ–­ç‚¹ F10 å•æ­¥æ‰§è¡Œ F11 å•æ­¥æ­¥å…¥ï¼ŒF10é‡åˆ°å‡½æ•°ä¸ä¼šè°ƒè¯•è¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œè€ŒF11å´å¯ä»¥æ­¥å…¥åˆ°å‡½æ•°å†…éƒ¨ Shift+F11 å•æ­¥è·³å‡º Shift+F5 åœæ­¢è°ƒè¯• äº”ã€è°ƒè¯•TypeScriptNode.jsæ˜¯ä¸èƒ½ç›´æ¥è¿è¡ŒTypeScriptè„šæœ¬çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨Node.jsè¿è¡ŒTypeScriptè„šæœ¬ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•ï¼šä½¿ç”¨TypeScriptå®˜æ–¹æä¾›çš„tcså·¥å…·å°†TypeScriptè„šæœ¬è½¬åŒ–ä¸ºJavaScriptï¼Œç„¶åå†ä½¿ç”¨Node.jsè¿è¡Œjsè„šæœ¬ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š 12tcs --outFile index.js index.tsnode index.js è€ŒNode.jsçš„æ‰©å±•æ¨¡å—ts-nodeå¯ä»¥ç®€åŒ–ä¸Šè¿°æ“ä½œï¼ˆå…¶å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨çš„tcså’Œnodeï¼‰ï¼Œå°†ä¸Šé¢äºŒæ­¥æ“ä½œåˆäºŒä¸ºä¸€ï¼š 1ts-node index.ts æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ts-nodeæ¨¡å—æ¥ä½œä¸ºTypeScriptè„šæœ¬çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ ç”±äºæˆ‘ä»¬é‡‡ç”¨äº†ts-nodeå·¥å…·æ¥è¿è¡ŒTypeScriptè„šæœ¬ï¼ŒVisual Studio Codeæ²¡æœ‰å†…ç½®è¯¥å·¥å…·çš„è°ƒè¯•é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨luanch.jsonä¸­è‡ªå®šä¹‰ä¸€ä¸ªé€‚ç”¨äºts-nodeçš„è°ƒè¯•ç¯å¢ƒé…ç½®ã€‚ æ³¨æ„ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œé‚£ä¹ˆå·¥ç¨‹æ–‡ä»¶å¿…é¡»åœ¨ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶ä½¿ç”¨Visual Studio Codeæ‰“å¼€è¿™ä¸ªç›®å½•ï¼ˆå¯¹ç€ç›®å½•ç‚¹å³é”®é€‰æ‹©ä½¿ç”¨Visual Studio Codeæ‰“å¼€å³å¯ï¼‰ å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š æ–°å»ºé¡¹ç›®ç›®å½•ï¼ˆå‡è®¾å«TSDemoï¼‰ ä½¿ç”¨Visual Studio Codeæ‰“å¼€è¯¥ç›®å½•ï¼Œå¹¶åœ¨â€œæŸ¥çœ‹â€èœå•ä¸­é€‰æ‹©æ‰“å¼€â€œç»ˆç«¯â€ï¼ˆä¹‹æ‰€ä»¥åœ¨Visual Studio Codeä¸­æ‰“å¼€ç»ˆç«¯ï¼Œçº¯å±æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œå› ä¸ºåœ¨Visual Studio Codeä¸­æ‰“å¼€ç»ˆç«¯ï¼Œç»ˆç«¯ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°é¡¹ç›®å½“å‰ç›®å½•ï¼Œä¸”ä¸ç”¨å¤šä¸ªçª—å£ä¹‹é—´åˆ‡æ¢ï¼‰ã€‚ åœ¨ç»ˆç«¯ä¸­ä¾æ­¤æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 12345678# ç”Ÿæˆpackage.jsonæ–‡ä»¶npm init -y# å®‰è£…typescriptnpm install typescript -S # å®‰è£…ts-node npm install ts-node -S luanch.jsonçš„è·¯å¾„ä¸ºé¡¹ç›®ç›®å½•\\.vscode\\luanch.jsonï¼ŒæŒ‰ç…§ä¸‹å›¾ä¾æ­¤ç‚¹å‡»å·¦ä¾§å·¥å…·æ â€œè¿è¡Œâ€-&gt;â€œåˆ›å»ºlaunch.jsonæ–‡ä»¶â€ï¼š æ‰“å¼€è‡ªåŠ¨ç”Ÿæˆçš„luanch.jsonæ–‡ä»¶ï¼Œåœ¨configurationsèŠ‚æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516&#123; &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ &#123; &quot;name&quot;: &quot;Current TS File&quot;, &quot;type&quot;: &quot;node&quot;, &quot;request&quot;: &quot;launch&quot;, &quot;program&quot;: &quot;$&#123;workspaceRoot&#125;/node_modules/ts-node/dist/bin.js&quot;, &quot;args&quot;: [ &quot;$&#123;relativeFile&#125;&quot; ], &quot;cwd&quot;: &quot;$&#123;workspaceRoot&#125;&quot;, &quot;protocol&quot;: &quot;inspector&quot; &#125; ]&#125; æ‰“å¼€éœ€è¦è°ƒè¯•çš„TypeScriptæ–‡ä»¶ï¼Œå¿«æ·é”®F5å¼€å§‹è°ƒè¯•ã€‚ å› ä¸ºts-nodeæ—¢å¯ä»¥æ‰§è¡ŒTypeScriptï¼Œä¹Ÿå¯ä»¥æ‰§è¡ŒJavaScriptï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ç”¨æ¥è°ƒè¯•JavaScriptè„šæœ¬ã€‚","tags":["TypeScript","JavaScript"],"categories":["Webç¼–ç¨‹"]},{"title":"æ­£åˆ™è§„åˆ™é€ŸæŸ¥","path":"/post/3005885000.html","content":"æœ¬æ–‡ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼çš„æ•™ç¨‹ï¼Œä»…é€‚ç”¨äºå·²æŒæ¡æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼Œéœ€è¦è¿›è¡Œè§„åˆ™é€ŸæŸ¥çš„å¼€å‘äººå‘˜ã€‚ ä¸€ã€å…ƒå­—ç¬¦ å­—ç¬¦ è¯´æ˜ ^ ä¸€è¡Œå¼€å§‹ $ ä¸€è¡Œç»“æŸ \\b å•è¯çš„å¼€å§‹æˆ–ç»“æŸ . é™¤æ¢è¡Œç¬¦å¤–çš„ä»»æ„å­—ç¬¦ \\w å•è¯å­—ç¬¦ï¼ˆåŒ…æ‹¬å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ±‰å­—ï¼‰ \\W ä»»æ„çš„éå•è¯å­—ç¬¦ï¼ˆåŒ…æ‹¬å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œæ±‰å­—ï¼‰ \\s ä»»æ„çš„ç©ºç™½å­—ç¬¦ï¼Œå¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€ä¸­æ–‡å…¨è§’ç©ºæ ¼ç­‰ \\S ä»»æ„çš„éç©ºç™½å­—ç¬¦ \\d ä»»æ„çš„æ•°å­— \\D ä»»æ„çš„éæ•°å­—å­—ç¬¦ äºŒã€å­—ç¬¦é›†åˆ å­—ç¬¦é›†åˆ è¯´æ˜ [aeiou] aeiou å­—ç¬¦é›†ä¸­çš„ä»»ä½•å­—ç¬¦ [^aeiou] é™¤ aeiou å­—ç¬¦é›†ä¹‹å¤–çš„å­—ç¬¦ [0-9a-z] å­—ç¬¦é›†åˆ 0 åˆ° 9ï¼Œa åˆ° z ä¸­çš„ä»»ä½•å­—ç¬¦ [^0-9a-z] é™¤å­—ç¬¦é›†åˆ 0 åˆ° 9ï¼Œ a åˆ° z ä¸­çš„ä»»ä½•å­—ç¬¦ ä¸‰ã€é™å®šç¬¦ å­—ç¬¦ è¯´æ˜ {n} é‡å¤æ¬¡æ•°&#x3D;n æ¬¡ {n,} é‡å¤æ¬¡æ•°&gt;&#x3D;n æ¬¡ {n,m} n&lt;&#x3D;é‡å¤æ¬¡æ•°&lt;&#x3D;m * é‡å¤æ¬¡æ•°&gt;&#x3D;0 + é‡å¤æ¬¡æ•°&gt;&#x3D;1 ? 0&lt;&#x3D;é‡å¤æ¬¡æ•°&lt;&#x3D;1 *? å°½å¯èƒ½å°‘åœ°ä½¿ç”¨é‡å¤çš„ç¬¬ä¸€ä¸ªåŒ¹é… +? å°½å¯èƒ½å°‘åœ°ä½¿ç”¨é‡å¤ä½†è‡³å°‘ä½¿ç”¨ä¸€æ¬¡ ?? ä½¿ç”¨é›¶æ¬¡é‡å¤ï¼ˆå¦‚æœ‰å¯èƒ½ï¼‰æˆ–ä¸€æ¬¡é‡å¤ å››ã€åˆ†ç»„åˆ†ç»„åˆç§°ä¸ºå­è¡¨è¾¾å¼ï¼Œå³æŠŠä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„å…¨éƒ¨æˆ–éƒ¨åˆ†åˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªç»„ã€‚å…¶ä¸­ï¼Œåˆ†ç»„ä½¿ç”¨çš„å­—ç¬¦ä¸º(å’Œ)ï¼Œå³å·¦åœ†æ‹¬å·å’Œå³åœ†æ‹¬å·ã€‚åˆ†ç»„ä¹‹åï¼Œå¯ä»¥å°†å­—ç¬¦ä¸º(å’Œ)ä¹‹ä¸­çš„è¡¨è¾¾å¼çœ‹æˆä¸€ä¸ªæ•´ä½“æ¥å¤„ç†ã€‚ ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ¹é…é‡å¤å‡ºç°å­—ç¬¦ä¸²â€œabcâ€ä¸€æ¬¡æˆ–ä¸¤æ¬¡çš„å­—ç¬¦ä¸²ã€‚æ­¤æ—¶ï¼Œè¡¨è¾¾å¼å°†â€œabcâ€çœ‹æˆä¸€ä¸ªæ•´ä½“æ¥è¿›è¡Œé‡å¤åŒ¹é…ã€‚ 1(abc)&#123;1,2&#125; å½“ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¢«åˆ†ç»„ä¹‹åï¼Œæ¯ä¸€ä¸ªç»„å°†è‡ªåŠ¨è¢«èµ‹äºˆä¸€ä¸ªç»„å·ï¼Œè¯¥ç»„å·å¯ä»¥ä»£è¡¨è¯¥ç»„çš„è¡¨è¾¾å¼ã€‚å…¶ä¸­ï¼Œç»„å·çš„ç¼–åˆ¶è§„åˆ™ä¸ºï¼šä»å·¦åˆ°å³ã€ä»¥åˆ†ç»„çš„å·¦æ‹¬å·(ä¸ºæ ‡å¿—ï¼Œç¬¬ä¸€ä¸ªåˆ†ç»„çš„ç»„å·ä¸º 1ï¼Œç¬¬äºŒä¸ªåˆ†ç»„çš„ç»„å·ä¸º 2ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¯ä»¥ä½¿ç”¨ \\æ•°å­— çš„æ–¹å¼æ¥å¼•ç”¨åˆ†ç»„ã€‚å¦‚\\1ï¼Œ\\2ã€‚ äº”ã€è´ªå©ªä¸éè´ªå©ªæ¯”å¦‚è¯´åŒ¹é…è¾“å…¥ä¸² A:Â 101000000000100 ä½¿ç”¨1.*1å°†ä¼šåŒ¹é…åˆ° 1010000000001, åŒ¹é…æ–¹æ³•: å…ˆåŒ¹é…è‡³è¾“å…¥ä¸² A çš„æœ€å, ç„¶åå‘å‰åŒ¹é…, ç›´åˆ°å¯ä»¥åŒ¹é…åˆ° 1, ç§°ä¹‹ä¸ºè´ªå©ªåŒ¹é…ã€‚ ä½¿ç”¨1.*?1å°†ä¼šåŒ¹é…åˆ° 101, åŒ¹é…æ–¹æ³•: *åŒ¹é…ä¸‹ä¸€ä¸ª 1 ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦, ç§°ä¹‹ä¸ºéè´ªå©ªåŒ¹é…ã€‚ æ‰€æœ‰å¸¦æœ‰é‡è¯çš„éƒ½æ˜¯éè´ªå©ªåŒ¹é…:Â .*?,Â .+?,Â .&#123;2,6&#125;?, .??ã€‚ å…­ã€åœ¨çº¿æ­£åˆ™éªŒè¯å·¥å…· https://c.runoob.com/front-end/854/ http://www.yunjson.com/reg/ https://tool.oschina.net/regex/","tags":["æ­£åˆ™"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"Gitæ‚è®°","path":"/post/2042033077.html","content":"æœ¬æ–‡è®°å½• Git ä½¿ç”¨ä¸­çš„ä¸€äº›é›¶ç¢çŸ¥è¯†ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥é˜…ï¼Œäº¦å¸Œæœ›æˆäººä¹‹ç¾ã€‚ ä¸€ã€gitignore æ–‡ä»¶è§„åˆ™ æ‰€æœ‰ç©ºè¡Œæˆ–#å¼€å¤´çš„è¡Œéƒ½ä¼šè¢«å¿½ç•¥ï¼› æ–‡ä»¶æˆ–ç›®å½•å‰åŠ  &#x2F;è¡¨ç¤ºä»“åº“æ ¹ç›®å½•ï¼› åŒ¹é…æ¨¡å¼æœ€åè·Ÿåæ–œæ  &#x2F; æŒ‡æ˜æ˜¯ç›®å½•è€Œéæ–‡ä»¶ï¼Œå¿½ç•¥è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä½†ä¸å¿½ç•¥è¯¥ç›®å½•ï¼› åœ¨æ¨¡å¼å‰åŠ !ï¼ŒæŒ‡æ˜ä¸å¿½ç•¥æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼› æ”¯æŒæ ‡å‡†çš„ glob æ¨¡å¼åŒ¹é… * åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼› ? åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼› [abc]åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦ï¼› [0-9] è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ 0 åˆ° 9 çš„æ•°å­—ï¼ŒåŒç†æœ‰[a-z]ç­‰ï¼› äºŒã€æ¸…ç©ºä»“åº“å†å²æäº¤1234567891011121314151617# 1. åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¦‚åç§°latest_branchgit checkout --orphan latest_branch# 2. æ·»åŠ æ‰€æœ‰æ–‡ä»¶git add .# 3. æäº¤git commit -m &quot;è‡ªå®šä¹‰æäº¤è¯´æ˜&quot;# 4. åˆ é™¤åŸæ¥çš„ä¸»åˆ†æ”¯ï¼ˆmasterï¼‰git branch -D master# 5. å°†å½“å‰åˆ†æ”¯é‡å‘½åä¸ºmastergit branch -m master# 6. å¼ºåˆ¶æ¨é€åˆ°è¿œç«¯git push -f origin master æœ‰äº›ä»“åº“æœ‰ master åˆ†æ”¯ä¿æŠ¤ï¼Œä¸å…è®¸å¼ºåˆ¶ pushï¼Œéœ€è¦åœ¨è¿œç¨‹ä»“åº“é¡¹ç›®æŠŠåˆ†æ”¯ä¿æŠ¤å…³æ‰æ‰èƒ½æ¨é€ã€‚ æ¨é€å‰éœ€è¦ä½¿ç”¨git remote -v æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“çš„ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯è¿œç¨‹åº“çš„åˆ«åï¼‰ã€‚è™½ç„¶è¿œç¨‹åº“çš„åˆ«åé»˜è®¤æ˜¯ origin ,ä½†å¯èƒ½è®¾ç½®è¿‡å…¶ä»–çš„åˆ«åï¼ˆè€Œé originï¼‰ã€‚","tags":["Git"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"QtåŠ è½½å­—ä½“æ–‡ä»¶","path":"/post/2767065786.html","content":"æœ¬æ–‡ä»…ç®€å•è®°å½•å¦‚ä½•ä½¿ç”¨ Qt åŠ è½½å¤–éƒ¨å­—ä½“æ–‡ä»¶ï¼Œå¹¶éå†å­—ä½“åç§°å’Œæ ·å¼åç§°ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738bool LoadFont(const QString&amp; fontPath) &#123; const int fontId = QFontDatabase::addApplicationFont(fontPath); if (fontId == -1) &#123; return false; &#125; // éå†å­—ä½“åå’Œæ ·å¼å#if QT_VERSION &gt;= QT_VERSION_CHECK(6, 0, 0) const QStringList fontFamilyList = fontDb.applicationFontFamilies(fontId); QString fontFamily; foreach (fontFamily, fontFamilyList) &#123; qDebug() &lt;&lt; &quot;Family:&quot; &lt;&lt; fontFamily; const QStringList fontStyleList = QFontDatabase::styles(fontFamily); QString fontStyle; foreach (fontStyle, fontStyleList) &#123; qDebug() &lt;&lt; &quot;\\tStyle:&quot; &lt;&lt; fontStyle; &#125; &#125;#else QFontDatabase fontDb; const QStringList fontFamilyList = fontDb.applicationFontFamilies(fontId); QString fontFamily; foreach (fontFamily, fontFamilyList) &#123; qDebug() &lt;&lt; &quot;Family:&quot; &lt;&lt; fontFamily; const QStringList fontStyleList = fontDb.styles(fontFamily); QString fontStyle; foreach (fontStyle, fontStyleList) &#123; qDebug() &lt;&lt; &quot;\\tStyle:&quot; &lt;&lt; fontStyle; &#125; &#125;#endif return true;&#125; é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt","å­—ä½“"],"categories":["Qt"]},{"title":"èŠèŠæ¡Œé¢å®¢æˆ·ç«¯å¼€å‘çš„æŠ€æœ¯é€‰å‹","path":"/post/3110746169.html","content":"æ¡Œé¢å®¢æˆ·ç«¯ä¹Ÿå« PC å®¢æˆ·ç«¯ï¼Œæ¡Œé¢æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowsã€MacOSã€Ubuntu ç­‰ç³»ç»Ÿï¼‰ä¸Šçš„è½¯ä»¶éƒ½å¯ä»¥ç§°ä¸ºæ¡Œé¢å®¢æˆ·ç«¯è½¯ä»¶ï¼Œå®¢æˆ·ç«¯è½¯ä»¶çš„å¼€å‘æœ‰å¤šç§æŠ€æœ¯é€‰å‹æ–¹å¼ï¼Œè€Œä¸”æ¯ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ã€‚ é‡‡ç”¨ä¸åŒçš„æ–¹å¼é€šå¸¸ä¼šå¯¼è‡´åœ¨å¼€å‘å‘¨æœŸã€æŠ€æœ¯äººå‘˜æ‹›è˜ã€è½¯ä»¶æ€§èƒ½ã€å®‰è£…åŒ…ä½“ç§¯ï¼ˆç½‘ç»œå¸¦å®½ï¼‰ç­‰æ–¹é¢æœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ã€‚æœ¬æ–‡ç»“åˆæˆ‘è¿™äº›å¹´çš„å®¢æˆ·ç«¯å¼€å‘ç»éªŒï¼ŒèŠä¸€èŠåœ¨å®¢æˆ·ç«¯å¼€å‘æ–¹é¢çš„å„ç§æŠ€æœ¯é€‰å‹ã€‚ 1. WinFormsWinFormsï¼ˆWindows Formsï¼‰æ˜¯å¾®è½¯æ¨å‡ºçš„ UI æ¡†æ¶ï¼Œå¯ä»¥ä½¿ç”¨ C#å’Œ Visual Basic ä½œä¸ºå¼€å‘è¯­è¨€ã€‚ WinForms æ¡†æ¶é€‚åˆå¼€å‘ä¼ ç»Ÿ UI å…ƒç´ å’Œç•Œé¢çš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚å·¥ä¸šã€åŒ»ç–—é¢†åŸŸçš„ç®¡ç†ã€æ§åˆ¶è½¯ä»¶ã€‚ å½“ç„¶ï¼ŒWinForms ä¹Ÿèƒ½å¼€å‘å‡ºç»šä¸½ã€éæ ‡å‡†åŒ–çš„ç•Œé¢æ•ˆæœï¼Œä½†éœ€è¦èŠ±è´¹è¾ƒå¤šçš„æ—¶é—´ï¼Œå¯¹å¼€å‘äººå‘˜çš„æŠ€æœ¯è¦æ±‚ä¹Ÿæ›´é«˜ã€‚ åŸºäº WinForms å¼€å‘çš„åº”ç”¨ç¨‹åºéœ€è¦ä¾èµ–.Net Framework è¿è¡Œæ—¶ï¼Œå¦‚æœç”¨æˆ·ç”µè„‘ä¸Šæœªå®‰è£….Net Framework è¿è¡Œæ—¶ï¼Œè½¯ä»¶å®‰è£…åŒ…éœ€è¦è‡ªå¸¦è¿è¡Œæ—¶ï¼Œå¹¶è‡ªåŠ¨ä¸ºç”¨æˆ·å®‰è£…ï¼Œå¦åˆ™ç¨‹åºä¼šæ— æ³•è¿è¡Œã€‚ ä½¿ç”¨ WinForms å¼€å‘çš„åº”ç”¨ç¨‹åºä½“ç§¯æœ¬èº«å¾ˆå°ï¼Œä½†ä¸ºäº†é€‚åº”ä¸åŒçš„ç”¨æˆ·ç”µè„‘ç¯å¢ƒï¼Œå®‰è£…åŒ…éœ€è¦æ£€æµ‹ç”¨æˆ·ç”µè„‘ä¸Šçš„.Net Framework è¿è¡Œæ—¶ç‰ˆæœ¬æ˜¯å¦ä¸è½¯ä»¶æ‰€éœ€ç‰ˆæœ¬åŒ¹é…ï¼Œå¦‚æœä¸åŒ¹é…åˆ™éœ€è¦è‡ªåŠ¨å®‰è£…ç›¸åº”çš„.Net Framework è¿è¡Œæ—¶ã€‚ .Net Framework å¾ˆéš¾åšæˆä¾¿æºç‰ˆï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨å¾®è½¯æä¾›çš„å®‰è£…åŒ…è¿›è¡Œå®‰è£…ï¼Œå®‰è£….Net Framework è¿è¡Œæ—¶åˆ†ä¸ºåœ¨çº¿å’Œç¦»çº¿å®‰è£…ä¸¤ç§æ–¹å¼ï¼š ç¦»çº¿å®‰è£…æ–¹å¼ã€‚å°†å¾®è½¯æä¾›çš„.Net Framework ç¦»çº¿å®‰è£…åŒ…ï¼ˆä¸åŒç‰ˆæœ¬ä½“ç§¯ä¸åŒï¼Œå¦‚ 4.8 ç‰ˆæœ¬çš„ç¦»çº¿å®‰è£…åŒ…çº¦ 115M å·¦å³ï¼‰æ‰“åŒ…è¿›ç¨‹åºå®‰è£…åŒ…ï¼Œå®‰è£…æ—¶è¿›è¡Œé‡Šæ”¾å’Œå®‰è£…ã€‚è¿™ç§æ–¹å¼ä¼šå¢åŠ ç¨‹åºå®‰è£…åŒ…çš„ä½“ç§¯ã€‚ åœ¨çº¿å®‰è£…æ–¹å¼ã€‚å°†å¾®è½¯æä¾›çš„.Net Framework åœ¨çº¿å®‰è£…å·¥å…·ï¼ˆä½“ç§¯å¾ˆå°ï¼Œçº¦ 1.5M å·¦å³ï¼‰æ‰“åŒ…è¿›ç¨‹åºå®‰è£…åŒ…ï¼Œå®‰è£…æ—¶è¿›è¡Œé‡Šæ”¾å’Œåœ¨çº¿å®‰è£…ï¼Œè¿™ç§æ–¹å¼è™½ç„¶å¯ä»¥å‡å°‘å®‰è£…åŒ…ä½“ç§¯ï¼Œä½†åœ¨çº¿å®‰è£…éœ€è¦å®æ—¶ä»å¾®è½¯æœåŠ¡å™¨ä¸‹è½½èµ„æºï¼Œå—é™äºç”¨æˆ·ç½‘ç»œç¯å¢ƒï¼Œå¾ˆå¯èƒ½ä¼šå®‰è£…å¤±è´¥ã€‚ 1.1 .Net Framework ç‰ˆæœ¬å…¼å®¹æ€§åœ¨.Net Framework 4.5 ç‰ˆæœ¬ä¹‹å‰ï¼Œå…¶å„ä¸ªç‰ˆæœ¬ä¹‹é—´ä¸ç›¸äº’å…¼å®¹ï¼ˆæ— è®ºæ˜¯å‘å‰è¿˜æ˜¯å‘åéƒ½æ— æ³•å…¼å®¹ï¼‰ï¼Œä½†ä» 4.5 åŠä»¥åçš„ç‰ˆæœ¬å°±å¯ä»¥ä¿è¯å‘åå…¼å®¹äº†ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼š å¦‚æœç¨‹åºä½¿ç”¨.Net Framework 3.5 ç‰ˆæœ¬å¼€å‘ï¼Œåˆ™åªèƒ½åŸºäºè¯¥ç‰ˆæœ¬çš„è¿è¡Œæ—¶è¿è¡Œã€‚ å¦‚æœç¨‹åºä½¿ç”¨.Net Framework 4.6 ç‰ˆæœ¬å¼€å‘ï¼Œåˆ™ç”¨æˆ·ç”µè„‘ä¸Šåªéœ€è¦å®‰è£…&gt;=4.6 ç‰ˆæœ¬çš„è¿è¡Œæ—¶å³å¯è¿è¡Œã€‚ 1.2 ç³»ç»Ÿè‡ªå¸¦.Net Framework ç‰ˆæœ¬ä» Windows Vista å¼€å§‹ï¼ŒWindows ç³»ç»Ÿä¼šè‡ªå¸¦.Net Framework è¿è¡Œæ—¶ï¼Œä½†å„ä¸ªç³»ç»Ÿè‡ªå¸¦çš„è¿è¡Œæ—¶ç‰ˆæœ¬ä¸åŒã€‚ ä¸‹è¡¨åˆ—å‡ºäº†ä¸åŒç³»ç»Ÿè‡ªå¸¦çš„.Net Framework è¿è¡Œæ—¶çš„æœ€ä½ç‰ˆæœ¬ï¼š ä¸ºä»€ä¹ˆæ˜¯æœ€ä½ç‰ˆæœ¬äº†ï¼Ÿå› ä¸ºç”¨æˆ·å¯èƒ½é€šè¿‡ç³»ç»Ÿå‡çº§çš„æ–¹å¼æ›´æ–°äº†.Net Framework è¿è¡Œæ—¶çš„ç‰ˆæœ¬ã€‚ æ“ä½œç³»ç»Ÿ .Net Framework è¿è¡Œæ—¶ç‰ˆæœ¬ Windows XP 1.0 Windows Vista 2.0 Windows 7 3.5 Windows 8 4.5 Windows 10 4.6 ~ 4.7 Windows 11 4.8+ ä¸åŒç³»ç»Ÿæ‰€æ”¯æŒçš„.Net Framework æœ€é«˜ç‰ˆæœ¬ä¹Ÿæœ‰æ‰€ä¸åŒï¼š Windows XP æœ€é«˜æ”¯æŒ.NET Framework 4.0 Windows 7 æœ€é«˜æ”¯æŒ.NET Framework 4.6.2 Windows 8.1 æœ€é«˜æ”¯æŒ.NET Framework 4.6.2 Windows 10 å’Œ Windows 11 å¯ä»¥æ”¯æŒä»»æ„ç‰ˆæœ¬çš„.NET Framework 1.3 .Net Core .Net Core å®˜ç½‘ï¼š https://dotnet.microsoft.com/en-us/ .Net Core æ˜¯å¾®è½¯å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ï¼ˆæ”¯æŒ Windowsã€MacOSã€Linux ç­‰ç³»ç»Ÿï¼‰é€šç”¨è½¯ä»¶å¼€å‘æ¡†æ¶ã€‚åœ¨.Net Core å‡ºç°ä¹‹å‰ï¼Œå¼€å‘äººå‘˜åªèƒ½åŸºäº.Net Framwork å¼€å‘ WinForms åº”ç”¨ç¨‹åºï¼Œ.Net Core å‡ºç°ä¹‹åï¼Œå¼€å‘äººå‘˜å¤šäº†ä¸€ç§é€‰æ‹©ã€‚ .Net Core ä¸.Net Framework æœ€å¤§çš„ä¸åŒåœ¨äº.Net Core æ˜¯å¼€æºå’Œè·¨å¹³å°çš„ï¼ŒåŸºäº.Net Core å¼€å‘çš„åº”ç”¨ç¨‹åºå¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šï¼Œå¦‚ Windowsã€Linuxã€MacOSã€‚ .Net Core è¿˜å¤„äºå¿«é€Ÿçš„æ›´æ–°è¿­ä»£ä¸­ï¼Œä¹‹å‰çš„è€ç‰ˆæœ¬å¯¹ WinForms åŠ WPF çš„æ”¯æŒä¸å¤ªå¥½ï¼ˆç”šè‡³ä¸æ”¯æŒï¼‰ï¼Œå»ºè®®é‡‡ç”¨æœ€æ–°ç‰ˆæœ¬çš„.Net Core è¿›è¡Œå¼€å‘ã€‚ ä½¿ç”¨.Net Core å¼€å‘çš„åº”ç”¨çš„ä½“ç§¯æœ¬èº«éå¸¸å°ï¼Œä½†åœ¨æ‰“åŒ…åˆ†å‘æ—¶ä¹Ÿéœ€è¦æºå¸¦.Net Core è¿è¡Œæ—¶ã€‚ä¸åŒäº.Net Frameworkï¼Œ.Net Core è¿è¡Œæ—¶æ—¢æ”¯æŒå®‰è£…åŒ…çš„æ–¹å¼ï¼Œä¹Ÿæ”¯æŒä¾¿æºç‰ˆçš„æ–¹å¼ã€‚ ä»¥.Net Core 6.0 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¾®è½¯å®˜æ–¹æä¾›çš„ WindowsDesktop çš„è¿è¡Œæ—¶å¤§å°ä¸º 50Mï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç¨‹åºå®é™…ä¾èµ–æƒ…å†µï¼Œå®‰è£…åŒ…åªåŒ…å«ç¨‹åºä¾èµ–çš„æ–‡ä»¶ï¼Œä»è€Œç¼©å‡å®‰è£…åŒ…ä½“ç§¯ï¼ˆç¼©å‡åçº¦ 20M å·¦å³ï¼‰ã€‚ 2. WPFWPFï¼ˆWindows Presentation Foundationï¼‰ä¹Ÿæ˜¯å¾®è½¯æ¨å‡ºçš„ UI æ¡†æ¶ã€‚ä¸ WinForms ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ C#å’Œ Visual Basic è¯­è¨€è¿›è¡Œå¼€å‘ï¼ŒWPFä¹Ÿæ”¯æŒ.Net Framework å’Œ.Net Core ä¸¤ç§å¼€å‘å¹³å°ã€‚ ä½¿ç”¨ WPF æ¡†æ¶å¼€å‘çš„åº”ç”¨ç¨‹åºç•Œé¢æ›´åŠ ç‚«é…·ï¼Œç•Œé¢ç»„ä»¶å¯éšæ„å®šåˆ¶åŒ–ï¼Œé€‚åˆç”¨äºå¯¹ç•Œé¢è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ã€‚ WPF ç¨‹åºçš„æ€§èƒ½ç¨é€Šä¸ WinForms åº”ç”¨ï¼Œä¸è¿‡è¿™ç§æ€§èƒ½å·®åˆ«åœ¨è®¡ç®—æœºç¡¬ä»¶æ€§èƒ½å¿«é€Ÿæå‡çš„ä»Šå¤©å·²åœ¨é€æ¸çš„è¢«æ·¡åŒ–ï¼Œå› æ­¤åœ¨è¿›è¡ŒæŠ€æœ¯é€‰å‹æ—¶åŸºæœ¬å¯ä»¥å¿½ç•¥çš„ WPF æ€§èƒ½é—®é¢˜äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWPF åº”ç”¨åœ¨å¯åŠ¨æ—¶é€šå¸¸è¾ƒæ…¢ï¼Œæ¯”å¦‚ç”¨æˆ·æ‰“å¼€åº”ç”¨åéœ€è¦èŠ±è´¹å¤§æ¦‚ 1 ç§’å·¦å³çš„æ—¶é—´æ‰èƒ½çœ‹è§ä¸»ç•Œé¢ã€‚ 3. MFCMFCï¼ˆMicrosoft Foundation Classesï¼‰æ˜¯å¾®è½¯æä¾›çš„ä¸€ä¸ªåŸºç¡€ç±»åº“ï¼Œå¯¹ Windows ç³»ç»Ÿ API è¿›è¡Œäº†å°è£…ï¼ŒåŒ…å«ä¸€äº›åŸºç¡€æ§ä»¶ï¼Œä»è€Œå‡å°‘åº”ç”¨å¼€å‘äººå‘˜çš„å·¥ä½œé‡ã€‚MFC åº”ç”¨ç¨‹åºçš„å¼€å‘è¯­è¨€ä¸º C++ï¼ŒMFC æä¾›çš„æ§ä»¶éƒ½æ˜¯å¸¸è§„çš„ Windows é£æ ¼ï¼Œå’Œ WinForms ä¸€æ ·ï¼Œå¦‚æœéœ€è¦å¼€å‘ç‚«ä¸½ã€äº¤äº’å¤æ‚çš„ç•Œé¢ï¼Œéœ€è¦å¼€å‘äººå‘˜èŠ±è´¹ç²¾åŠ›è‡ªå·±ç»˜åˆ¶ï¼Œä¼šé™ä½ä¸å°‘å¼€å‘æ•ˆç‡ã€‚ MFC æ¯”è¾ƒé€‚åˆåº”ç”¨åœ¨å¯¹è½¯ä»¶æ€§èƒ½è¦æ±‚è¾ƒé«˜ã€è°ƒç”¨ç³»ç»Ÿ API è¾ƒå¤šã€ç•Œé¢äº¤äº’è¾ƒç®€å•çš„è½¯ä»¶ä¸Šã€‚ å°çŸ¥è¯†ï¼šMFCåˆè¢«æˆç§°ä¸ºâ€œéº»çƒ¦Câ€ï¼Œå¤§æŠµæ˜¯å› ä¸ºç”¨å®ƒå¼€å‘ç•Œé¢æ¯”è¾ƒéº»çƒ¦å§ã€‚ 4. DirectUIDirectUI æ˜¯ä¸€ç±»æŠ€æœ¯çš„ç»Ÿç§°ï¼Œå³ Paint on parent dc directlyï¼Œç›´æ¥åœ¨çˆ¶çª—ä½“ä¸Šè¿›è¡Œç»˜åˆ¶ã€‚è¯¥æŠ€æœ¯æ˜¯å¯¹ MFC çš„ä¸€ç§æ”¹è¿›ï¼Œä½¿ç”¨DirectUIå¼€å‘çš„ç•Œé¢ï¼Œæ•´ä¸ªçª—å£åªæœ‰ä¸€ä¸ªå¥æŸ„ï¼Œè€Œä¸æ˜¯åƒ MFC ä¸€æ ·ï¼Œæ¯ä¸ªæ§ä»¶éƒ½æœ‰ä¸€ä¸ªå¥æŸ„ã€‚ ç›®å‰æµè¡Œçš„ DirectUI ç•Œé¢åº“å¤§å¤šç”±ä¸ªäººå¼€å‘å¹¶å¼€æºï¼Œç”±äºæ²¡æœ‰ä¸“é—¨çš„å›¢é˜Ÿè¿›è¡Œç»´æŠ¤ï¼Œå› æ­¤ä½¿ç”¨è¯¥ç±»ç•Œé¢åº“çš„å…¬å¸é€šå¸¸éœ€è¦è‡ªå·±ç»´æŠ¤ä¸€ä¸ªåˆ†æ”¯è¿›è¡Œ Bug ä¿®å¤å’Œæ·»åŠ æ–°åŠŸèƒ½ã€‚ å¸¸ç”¨çš„ DirectUI ç•Œé¢åº“æœ‰ï¼š duilib ä½œè€…å·²åŸºæœ¬ä¸ç»´æŠ¤ã€‚ DuiLib_Ultimate å…¶ä»–äººç»´æŠ¤çš„ä¸€ä¸ª duilib ç‰ˆæœ¬ã€‚ GacUI â€¦â€¦ å»ºè®®é€‰æ‹©å…¬å¸æŠ€æœ¯äººå‘˜æ¯”è¾ƒç†Ÿæ‚‰çš„DirectUIåº“ï¼Œæœ€å¥½èƒ½ç†Ÿæ‚‰æºç ï¼Œå¯ä»¥è¿›è¡Œ Bug ä¿®å¤å’ŒåŠŸèƒ½å®šåˆ¶å¼€å‘ã€‚ DirectUI ç•Œé¢åº“é€šå¸¸éƒ½æ˜¯è½»é‡çº§çš„ï¼Œå› æ­¤å…¶å¼€å‘çš„åº”ç”¨ç¨‹åºä½“ç§¯éƒ½ä¼šæ¯”è¾ƒå°ã€‚ 5. QtQt æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ C++å›¾åƒç•Œé¢å¼€å‘æ¡†æ¶ï¼Œä¸ä»…æ”¯æŒ Windowsã€MacOSã€Linux ç­‰ PC æ“ä½œç³»ç»Ÿï¼Œè¿˜æ”¯æŒåµŒå…¥å¼ QNXã€VxWorks åŠ Androidã€iOS ç­‰æ“ä½œç³»ç»Ÿã€‚ Qt çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„ C++ å›¾åƒç•Œé¢æ¡†æ¶ã€‚Qt åº”ç”¨ç¨‹åºçš„å¼€å‘è¯­è¨€ä¸º C++ï¼ŒQt æ¯” MFC ä¸Šæ‰‹æ›´å¿«ï¼Œè€Œä¸”åœ¨æ§ä»¶å®šåˆ¶ã€ UI ç»˜åˆ¶ä¸Šä¹Ÿæ¯” MFC æ–¹ä¾¿ã€‚ ä»¥ Qt 5.15.2 ç‰ˆæœ¬ä¸ºä¾‹ï¼ŒQt åº”ç”¨ç¨‹åºæ‰“åŒ…åçš„ä½“ç§¯æœ€å°åˆ° 6MB å·¦å³ï¼Œå¦‚æœä½¿ç”¨æ›´è€ç‰ˆæœ¬çš„ Qtï¼Œä½“ç§¯è¿˜å¯ä»¥æ›´å°ã€‚ 5.1 Qt ç‰ˆæƒé—®é¢˜Qt åˆ†ä¸ºå¼€æºç‰ˆæœ¬å’Œå•†ä¸šç‰ˆæœ¬ï¼Œå¼€æºç‰ˆæœ¬å¯ä»¥å…è´¹ä½¿ç”¨ï¼Œå•†ä¸šç‰ˆæœ¬éœ€è¦ä»˜è´¹æ‰èƒ½ä½¿ç”¨ã€‚ å¼€æºç‰ˆæœ¬æ—¢å¯ä»¥å…è´¹ä½¿ç”¨ä¹Ÿå¯ä»¥ç”¨äºå•†ä¸šç”¨é€”ï¼Œä½†éœ€è¦éµå®ˆç›¸åº”çš„è§„åˆ™ã€‚Qtä¸­çš„å¤§å¤šæ•°æ¨¡å—é‡‡ç”¨LGPLå¼€æºåè®®ï¼Œå°‘éƒ¨åˆ†æ¨¡å—é‡‡ç”¨çš„æ˜¯GPLåè®®ï¼Œåœ¨å¼€å‘å•†ä¸šè½¯ä»¶æ˜¯æˆ‘ä»¬åº”é€‰æ‹©LGPLåè®®çš„æ¨¡å—ï¼Œå¹¶é‡‡ç”¨QtåŠ¨æ€é“¾æ¥åº“çš„æ–¹å¼ï¼ˆè€Œä¸æ˜¯é™æ€åº“çš„æ–¹å¼ï¼‰ã€‚ å¯¹åº”æœ‰äº›å¿…é¡»é™æ€é“¾æ¥çš„æ¨¡å—ï¼Œå¦‚QtMainï¼ŒQté‡‡ç”¨BSDåè®®ï¼Œå…è®¸åœ¨å•†ä¸šè½¯ä»¶ä¸­ä½¿ç”¨ã€‚ æ…ç”¨é‡‡ç”¨GPLåè®®çš„æ¨¡å—ï¼Œè¯¥åè®®å…·æœ‰ä¼ æŸ“æ€§ï¼Œå®ƒè¦æ±‚æ‰€æœ‰ä½¿ç”¨è¿™äº›æ¨¡å—çš„è½¯ä»¶éƒ½è¦å¼€æºï¼Œå› æ­¤è¦æ…ç”¨GPLåè®®çš„æ¨¡å—ã€‚ å¯ä»¥åœ¨https://www.qt.io/product/featuresç½‘ç«™æŸ¥è¯¢Qtæ¨¡å—å¯¹åº”çš„å¼€æºåè®®ã€‚ å¦å¤–å¦‚æœæœ‰å¯¹ Qt æºç è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦å…¬å¸ƒä¿®æ”¹éƒ¨åˆ†çš„æºç ã€‚ 5.2 Qtç‰ˆæœ¬é€‰æ‹©Qt 5.6ç‰ˆæœ¬æ˜¯Qtæœ€åä¸€ä¸ªæ”¯æŒWindows XPçš„ç‰ˆæœ¬ï¼Œè€ŒQt 6 ä¹Ÿä¸å†æ”¯æŒWindows 7åŠå…¶ä»¥ä¸‹çš„ç‰ˆæœ¬ã€‚ å¦å¤–ï¼Œä»Qt 6ç‰ˆæœ¬å¼€å§‹ï¼Œå®˜æ–¹ä¸åœ¨æä¾›32ä½çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 6. CEF CEF å®˜ç½‘ï¼š https://bitbucket.org/chromiumembedded/cef/wiki/Homeã€‚ CEFï¼ˆChromium Embedded Framework ï¼‰æ˜¯ Google å…¬å¸å¼€å‘çš„ä¸€ä¸ªè·¨å¹³å°çš„æµè§ˆå™¨å†…æ ¸æ¡†æ¶ï¼ˆå·ç§°ä¸ Chrome æµè§ˆå™¨ä¸ºåŒä¸€å†…æ ¸ï¼‰ï¼Œä»¥å¼€æºåº“çš„æ–¹å¼æä¾›ï¼Œå¯ä»¥å†…åµŒåˆ°ç¬¬ä¸‰æ–¹ç¨‹åºä¸­ç”¨äºæ˜¾ç¤ºç½‘é¡µä»¥åŠä¸ç½‘é¡µè¿›è¡Œäº¤äº’ã€‚ CEF è‡ªèº«ä¸»è¦ä½¿ç”¨ C++è¿›è¡Œå¼€å‘ï¼Œç›®å‰ä¹Ÿæœ‰ CEF çš„å…¶ä»–è¯­è¨€çš„ç»‘å®šï¼Œæ¯”å¦‚ CefSharp å°±æ˜¯ C#çš„ç»‘å®šã€‚å› æ­¤åŸºäº CEF æŠ€æœ¯æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ C++ã€C#æˆ–å…¶ä»–è¯­è¨€ä½œä¸ºå¼€å‘è¯­è¨€ï¼Œä½†æ®æˆ‘äº†è§£å¤§å¤šä½¿ç”¨çš„è¿˜æ˜¯ C++ã€‚ åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ä¼šç›´æ¥ä½¿ç”¨ CEFï¼Œè€Œæ˜¯è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œå°†å…¶å°è£…æˆç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨äºæ‰“å¼€ Web é¡µé¢ï¼Œç”± Web é¡µé¢è´Ÿè´£ç•Œé¢äº¤äº’ï¼Œå¹¶é€šè¿‡Javascript å’Œ C++æˆ– C#äº¤äº’ã€‚ ä¸ºäº†èŠ‚çœå¼€å‘æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘å°è£…çš„QCefWidgetç»„ä»¶ã€‚ CEF ç»å†äº† CEF1 å’Œ CEF3 ä¸¤ä¸ªå¤§ç‰ˆæœ¬ï¼ŒCEF1 ç°å·²åŸºæœ¬è¢«æ·˜æ±°ï¼Œç›®å‰ä¸»æµçš„æ˜¯ CEF3ï¼ˆCEF 2623 ç‰ˆæœ¬æ˜¯æœ€åä¸€ä¸ªæ”¯æŒ Windows XP çš„ç‰ˆæœ¬ï¼‰ã€‚ ç”±äºç‰ˆæƒé—®é¢˜ï¼ŒCEF é»˜è®¤ä¸æ”¯æŒ MP4 è§£ç ï¼Œå¦‚éœ€æ”¯æŒï¼Œéœ€è¦è‡ªè¡Œä¸‹è½½æºç è¿›è¡Œç¼–è¯‘ï¼ˆè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šè€—æ—¶ 1 å¤©å·¦å³ï¼‰ã€‚ äº¦å¯ä»¥ä½¿ç”¨æˆ‘ç¼–è¯‘å¥½çš„CEFï¼šhttps://github.com/winsoft666/cef_binary é‡‡ç”¨ CEF å†…åµŒ Web é¡µé¢çš„æ–¹å¼ï¼Œè™½ç„¶å¯ä»¥å€ŸåŠ© Web å¼€å‘çš„ä¼˜åŠ¿ï¼Œæå¤§æå‡è½¯ä»¶å¼€å‘æ•ˆç‡ï¼ŒWeb é¡µé¢æ›´æ–°èµ·æ¥ä¹Ÿæ¯”å®¢æˆ·ç«¯çš„å‡çº§æ›´åŠ æ–¹ä¾¿ï¼Œä½†ç”±äºå…¶æœ¬è´¨è¿˜æ˜¯å®¢æˆ·ç«¯å†…åµŒæµè§ˆå™¨ï¼Œå› æ­¤è½¯ä»¶å†…å­˜å ç”¨ä¼šæ¯”è¾ƒé«˜ï¼Œé€šå¸¸ä¸€ä¸ªç®€å•çš„ç¨‹åºå¯èƒ½ä¼šå ç”¨ 100MB å·¦å³å†…å­˜ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œä¹Ÿè¿œè¿œä¸åŠä¸Šé¢ä»‹ç»çš„å…¶ä»–åŸç”Ÿå¼€å‘æ–¹å¼ã€‚ CEF ä¸åŒç‰ˆæœ¬çš„ä½“ç§¯å·®è·è¾ƒå¤§ï¼Œ2623 ç‰ˆæœ¬å‹ç¼©åå¤§çº¦ 25MBï¼Œè€Œ 89.0.18 ç‰ˆæœ¬å‹ç¼©åå¤§çº¦ 60MBã€‚ä¸åŒç‰ˆæœ¬å¯¹ Web æ–°ç‰¹æ•ˆçš„æ”¯æŒç¨‹åº¦ä¸åŒï¼Œåœ¨ä¸åœ¨ä¹å®‰è£…åŒ…ä½“ç§¯çš„æƒ…å†µä¸‹å¯ä»¥é€‰æ‹©æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœéœ€è¦è€ƒè™‘å®‰è£…åŒ…ä½“ç§¯ï¼Œåˆ™éœ€è¦åšå‡ºæƒè¡¡ã€‚ é‡‡ç”¨è¯¥æŠ€æœ¯æ–¹æ¡ˆéœ€è¦ç”± Web å¼€å‘è€…å¼€å‘å®¢æˆ·ç«¯å†…åµŒé¡µé¢ï¼ŒC++å¼€å‘è€…å¼€å‘å®¢æˆ·ç«¯ä¸»ä½“æ¡†æ¶ã€‚ç”±äº Web é¡µé¢æ— æ³•ç›´æ¥è®¿é—®ç³»ç»Ÿèµ„æºï¼Œå› æ­¤è¿˜éœ€ Web ä¸ C++è¿›è¡Œäº¤äº’ï¼Œå¹¶ç”± C++å®Œæˆç³»ç»ŸåŠŸèƒ½çš„å¼€å‘ã€‚ 7. Electronå‰é¢æåˆ°ä½¿ç”¨ CEF æ—¶éœ€è¦äºŒæ¬¡å°è£…ï¼Œè€Œ CEF çš„æ¥å£åˆä¸æ˜¯é‚£ä¹ˆæ˜“äºä½¿ç”¨ï¼Œæ‰€ä»¥å°è£…ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç¨³å®šè¿è¡Œçš„ CEF ç»„ä»¶éœ€è¦èŠ±è´¹ä¸å°‘æ—¶é—´ã€‚Electron åˆ™æ˜¯åŸºäº CEF è¿›è¡Œäº†æ·±å±‚æ¬¡çš„å°è£…ï¼ŒElectron ç›¸æ¯”è‡ªå·±å°è£… CEF ä¼šæ›´åŠ ç¨³å®šï¼Œè¿˜å¯ä»¥èŠ‚çœå¼€å‘å’ŒåæœŸç»´æŠ¤çš„æ—¶é—´ã€‚ Electron å’Œ CEF æœ€å¤§çš„ä¸åŒä¹‹å¤„æ˜¯ Electron å¯ä»¥ç›´æ¥è°ƒç”¨ Node.js çš„æ¨¡å—ï¼Œå¦‚æ–‡ä»¶ã€ç³»ç»Ÿã€ç½‘ç»œç­‰æ¨¡å—ï¼ŒåŸºäºè¿™äº›æ¨¡å—ï¼Œç†è®ºä¸Šå¯ä»¥ä½¿ç”¨ JavaScript å®Œæˆå®¢æˆ·ç«¯åº”ç”¨çš„å¼€å‘ï¼Œä½†è¿™ä¹Ÿä»…é™äºç†è®ºä¸Šï¼Œå®é™…ä¸Šå¤§å¤šæ•°çš„ Web å¼€å‘è€…ç¼ºå°‘å®¢æˆ·ç«¯è½¯ä»¶å¼€å‘ç»éªŒï¼Œç”šè‡³ç¼ºå°‘ç³»ç»Ÿæ–¹é¢çš„ç†è®ºåŸºç¡€ï¼Œå› æ­¤å¾ˆéš¾å®Œå…¨ä¾é  Web å¼€å‘è€…å¼€å‘å‡ºåŠŸèƒ½å®Œå¤‡çš„å®¢æˆ·ç«¯è½¯ä»¶ã€‚ åŸºäº Electron å¼€å‘å®¢æˆ·ç«¯æ—¶ï¼Œå¤§å¤šæ•°æ—¶å€™è¿˜éœ€è¦ C++å¼€å‘è€…å¼€å‘ Node æ¨¡å—æ¥ä¾› JavaScript è°ƒç”¨ã€‚ 8. å…¶ä»–å›¾åƒç•Œé¢åº“é™¤äº†ä¸Šé¢ä»‹ç»çš„æ–¹æ¡ˆï¼Œè¿˜è¦å¾ˆå¤šå…¶ä»–çš„ä¼˜ç§€ç•Œé¢åº“ï¼Œè¿™äº›åº“å„æœ‰ç‰¹è‰²ï¼Œç›®å‰å®ƒä»¬çš„ä½¿ç”¨è€…è¿˜æ²¡æœ‰ä¸Šé¢çš„å¤šã€‚ ä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›æˆ‘æ‰€çŸ¥é“çš„ä¼˜ç§€ç•Œé¢åº“ï¼Œæ¬¢è¿è¡¥å……ï¼š RmlUi yue elements imgui","categories":["é¡¹ç›®ç®¡ç†"]},{"title":"æˆ´å»ºä¸šï¼šé˜…è¯»ä¹ æƒ¯ä¸äººç”Ÿæœªæ¥ã€è½¬è½½ã€‘","path":"/post/1878076142.html","content":"äººæœ‰ä¸‘ä¿Šï¼Œä¹¦æœ‰æµ…æ·±ã€‚å°±åƒäººæœ‰ç§ç§è‰²è‰²ä¸€æ ·ï¼Œä¹¦ä¹Ÿåˆ†ä¸åŒçš„æ€§è´¨å’Œå±‚æ¬¡ã€‚ ä¸œæ±‰æ€æƒ³å®¶ç‹å……å°†å½“æ—¶çš„ä¹¦åˆ†ä¸ºä¸‰ç§ï¼šä½œã€è¿°ã€è®ºã€‚ä»–çš„åè‘—ã€Šè®ºè¡¡ã€‹åˆšæ€é’æ—¶ï¼Œæœ‰äººæ­ç»´ä»–â€œå¯è°“ä½œè€…â€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–çš„è‘—ä½œç®—å¾—ä¸Šæ˜¯â€œä½œâ€ã€‚ç‹å……è°¦é€Šåœ°è¯´è‡ªå·±çš„ä¹¦â€œéä½œä¹Ÿï¼Œäº¦éè¿°ä¹Ÿï¼Œè®ºä¹Ÿâ€ã€‚ä»–æŠŠè‡ªå·±çš„ä»£è¡¨ä½œå–åä¸ºã€Šè®ºè¡¡ã€‹ã€‚åŸåˆ›æ€§è‘—ä½œå¯ç§°ä¸ºâ€œä½œâ€ï¼Œå®ƒä»¬æ¨ªç©ºå‡ºä¸–è€Œè‡ªé“¸ä¼Ÿè¯ï¼Œå±äºå‰æ— å¤äººä¸”åå¯æ¥è€…çš„ç»å…¸ã€‚æˆ–é˜è¿°ä»–äººä¹‹æ€ï¼Œæˆ–ç»¼è´¯ç™¾å®¶ä¹‹ç»ªï¼Œæˆ–å¼•ç”³å‰äººä¹‹å­¦ï¼Œè™½ç„¶æ²¡æœ‰åŸåˆ›æ€§ï¼Œä½†èƒ½è‡ªæˆä¸€å®¶è¨€ï¼Œè¿™ä¸€ç±»ä¹¦ç±ç§°ä¸ºâ€œè¿°â€ï¼›æˆ–è®°å½•â€œæ€æƒ³ç«èŠ±â€ï¼Œæˆ–æ›´æ­£å½“æ—¶é‚ªè¯´ï¼Œæˆ–åˆ†æä¸€æ—¶å˜æ•…ï¼ŒæŒ‰ç‹å……çš„è¯´æ³•ï¼Œå±äºâ€œæ‚è¯´â€ä¸€ç±»çš„ä¸œè¥¿ç»Ÿç§°ä¹‹ä¸ºâ€œè®ºâ€ã€‚ ä»Šå¤©ä¹¦ç±çš„ç§ç±»æ›´ä¸ºç¹å¤šï¼Œæœ‰ç»å…¸è‘—ä½œä¸æµè¡Œä¹¦ç±ä¹‹åˆ«ï¼Œæœ‰ä¸“ä¸šè‘—ä½œä¸å¤§ä¼—è¯»ç‰©ä¹‹æ®Šï¼Œæœ‰æ–‡å­—è¯»ç‰©ä¸è§†é¢‘è¯»ç‰©ä¹‹å¼‚â€¦â€¦ç½‘ç»œä¸Šçš„ç»å¤§å¤šæ•°è¯»ç‰©æ²¡æœ‰â€œä¹¦â€çš„å½¢æ€ï¼Œä½†å®ƒä»¬èµ¢å¾—äº†ç»å¤§å¤šæ•°è¯»è€…ã€‚è¿™äº›ä¸œè¥¿å¤šæ•°ä¸ä¼šæˆä¹¦ï¼Œå®ƒä»¬çš„ä½œè€…ä¹Ÿä¸æƒ³è‘—ä¹¦ã€‚ å¯å–œçš„æ˜¯ï¼Œéšç€äº’è”ç½‘çš„å‘è¾¾å’Œæ‰‹æœºçš„æ™®åŠï¼Œäººç±»æœ‰å¯èƒ½çœŸæ­£å®ç°â€œçŸ¥è¯†çš„æ™®æƒ â€ï¼Œä»»ä½•å±‚æ¬¡ä»»ä½•å½¢å¼çš„ä¹¦ç±éƒ½èƒ½è½»æ˜“å¾—åˆ°ï¼Œå‰äººè”‘è§†çš„â€œå¼•è½¦å–æµ†ä¹‹æµâ€éƒ½èƒ½é˜…è¯»ã€‚åœ°é“é‡Œï¼Œå…¬äº¤ä¸Šï¼Œä¼‘æ¯æ—¶ï¼Œéšæ—¶éšåœ°éƒ½èƒ½çœ‹åˆ°â€œä½å¤´ä¸€æ—â€ã€‚ â€œå¼•è½¦å–æµ†ä¹‹æµâ€æ„æ€æ˜¯æ‹‰å¤§è½¦çš„ï¼Œåšå°ä¹°å–çš„ã€‚æŒ‡å¹³æ°‘ç™¾å§“ã€‚ ä¸è¿‡ï¼Œè¿™ç§æƒ…å†µè®©äººâ€œäº¦å–œäº¦å¿§â€â€”â€”éšç€çŸ¥è¯†çš„æ—¥ç›Šæ™®åŠåŒ–ï¼ŒçŸ¥è¯†ä¹Ÿæ—¥ç›Šæµ…è¡¨åŒ–å’Œç¢ç‰‡åŒ–ã€‚ çŸ¥è¯†çš„æµ…è¡¨åŒ–ä¸ä»…åœ¨ç¤¾ä¼šå¤§ä¼—ä¸­å­˜åœ¨ï¼Œåœ¨ç ”ç©¶ç”Ÿå’Œå­¦è€…ä¸­ä¹Ÿå¾ˆæ™®éï¼ŒåŒºåˆ«åªåœ¨äº”åæ­¥ä¸ç™¾æ­¥ä¹‹é—´ã€‚è­¬å¦‚è¦å†™ä¸€ç¯‡æç™½è¯—ä¸­â€œæœˆäº®â€æ„è±¡çš„è®ºæ–‡ï¼Œå‰äººå°±å¾—é€šè¯»æç™½å…¨é›†ï¼Œä»Šäººåªéœ€è¦åœ¨ç”µè„‘ä¸­æ•²ä¸Šâ€œæœˆäº®â€äºŒå­—ï¼Œæç™½è¯—æ­Œä¸­æ‰€æœ‰ä¸â€œæœˆäº®â€æœ‰å…³çš„è¯—å¥éƒ½è¹¦äº†å‡ºæ¥ã€‚ä½ æ ¹æœ¬ç”¨ä¸ç€è¯»æç™½é›†ï¼Œç”šè‡³ç”¨ä¸ç€å»å®Œæ•´åœ°è¯»ä¸€é¦–æç™½è¯—ï¼Œä¸€ç¯‡ä¸Šä¸‡å­—çš„è®ºæ–‡å°±ç³Šå¼„å‡ºæ¥äº†ã€‚å‰äººè¯´æç™½è¯—â€œè±ªæ”¾é£˜é€¸â€ï¼Œæè¯—ä½•ä»¥â€œè±ªæ”¾â€ï¼Œåˆå¦‚ä½•â€œé£˜é€¸â€ï¼Œå†™æ–‡ç« çš„ä½œè€…å¯èƒ½ä¸¤çœ¼èŒ«ç„¶ï¼Œå¯¹å‰äººçš„è¯„è®ºç¼ºä¹æ·±åˆ»çš„ç†è§£ï¼Œå¯¹æç™½è¯—æ­Œä¹Ÿç¼ºä¹æ·±åº¦çš„ä½“éªŒã€‚é’±é”ºä¹¦è°ˆåˆ°æç™½è¯—ä¸­çš„æœˆäº®ï¼Œä»Šå¤©å­¦è€…ä¹Ÿè°ˆåˆ°æç™½è¯—ä¸­çš„æœˆäº®ï¼Œè¡¨é¢ä¸Šçœ‹â€œæœˆäº®è¿˜æ˜¯é‚£ä¸ªæœˆäº®â€ï¼Œä½†æ­¤â€œæœˆäº®â€éå½¼â€œæœˆäº®â€ã€‚ çŸ¥è¯†ç¢ç‰‡åŒ–çš„æƒ…å†µæ›´ä¸ºä¸¥é‡ã€‚è¿‡å»è·å–çŸ¥è¯†å¤§å¤šæ¥äºä¹¦æœ¬ï¼Œä¹¦æœ¬ä¸Šçš„çŸ¥è¯†å…·æœ‰ä¸€å®šçš„ç³»ç»Ÿæ€§ï¼Œè€Œä¸”è¿˜éœ€è¦ä¸€å®šçš„é€»è¾‘è¯æ˜æˆ–äº‹å®ä¾æ®ï¼Œè¿™ç§çŸ¥è¯†å¾€å¾€ç³»ç»Ÿå®Œæ•´ï¼Œè€Œä¸”è¿˜å…·æœ‰é€»è¾‘ä¸Šçš„è¿è´¯æ€§ã€‚ä»Šå¤©ï¼Œæ— è®ºæ˜¯æ—¥å¸¸ç”Ÿæ´»ï¼Œè¿˜æ˜¯å­¦æœ¯ç ”ç©¶ï¼Œæˆ‘ä»¬éƒ½ä¸å¿…ç§¯ç´¯å¤§é‡çš„çŸ¥è¯†ï¼Œæ›´ä¸å¿…å»ºç«‹è‡ªå·±çš„çŸ¥è¯†ç»“æ„ï¼Œä»€ä¹ˆçŸ¥è¯†éƒ½å¯ä»¥â€œè°·æ­Œâ€â€œç™¾åº¦â€ï¼Œä»€ä¹ˆææ–™éƒ½å¯ä»¥å»æ–‡çŒ®æ£€ç´¢ã€‚æ— é¡»ç©·ç»çš“é¦–ï¼Œæ— é¡»åšé—»å¼ºè®°ï¼Œæ— é¡»å­¦è¯†æ¸Šåšï¼Œåœ¨ç”Ÿæ´»ä¸ç ”ç©¶ä¸­ç…§æ ·ç•…é€šæ— é˜»ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªé¢†åŸŸéƒ½æ½‡æ´’æ— å¿§ã€‚åªè¦ä½ ä¼šâ€œè°·æ­Œâ€ï¼Œä¼šâ€œç™¾åº¦â€ï¼Œä¼šæœç´¢ï¼Œæ— çŸ¥å¯ä»¥æ˜¾å¾—æœ‰çŸ¥ï¼Œä¸å­¦ä¹Ÿå¯ä»¥æ˜¾å¾—åšå­¦ã€‚ é•¿æ­¤ä»¥å¾€ï¼Œæˆ‘ä»¬æ—¢éš¾ä»¥è®¤çŸ¥å“²äººç†è®ºä½“ç³»çš„æ·±åˆ»ä¸¥è°¨ï¼Œä¹Ÿéš¾ä»¥ä½“éªŒè¯—äººæƒ…æ„Ÿçš„åšå¤§å´‡é«˜ï¼Œç”šè‡³æ— æ³•æ„Ÿå—è‰ºæœ¯ä½œå“çš„ç»†è…»ç¾å¦™ï¼Œå› è€Œè®¤è¯†ä¼šè¶Šæ¥è¶Šæµ®æµ…ï¼Œå¿ƒçµä¼šè¶Šæ¥è¶Šè’èŠœï¼Œå®¡ç¾ä¼šè¶Šæ¥è¶Šåº¸ä¿—ã€‚ä»æ¥ä¸å»ç¢°ä¸€ç¢°åŸåˆ›æ€§çš„ç»å…¸ï¼Œæˆ‘ä»¬è‡ªå·±æ€ä¹ˆå¯èƒ½ä¼šæœ‰åŸåˆ›æ€§ï¼Ÿ é˜…è¯»å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šæ¶ˆé£æ€§é˜…è¯»ã€é‰´èµæ€§é˜…è¯»ä¸æŒ‘æˆ˜æ€§é˜…è¯»ã€‚ æ¶ˆé£æ€§é˜…è¯»çº¯ç²¹æ˜¯ä¸ºäº†æ¶ˆç£¨æ—¶å…‰ï¼Œæ¯”å¦‚åœ¨æ‰‹æœºä¸Šåˆ·åˆ·å¤©å—åœ°åŒ—çš„å¥‡é—»ï¼Œçœ‹çœ‹ç”·å¥³æ˜æ˜Ÿçš„æ©æ€¨ï¼Œä¸Šè´­ç‰©ç½‘ä¸Šçœ‹çœ‹ä»Šå¹´ç©¿ä»€ä¹ˆè£™å­ï¼Œä¸Šæ—…æ¸¸ç½‘ä¸Šçœ‹çœ‹å»å“ªäº›åœ°æ–¹è‡ªé©¾æ¸¸â€¦â€¦è¿™ç§é˜…è¯»è¡¨é¢ä¸Šæ˜¯åœ¨â€œçœ‹â€ï¼Œå…¶å®æ˜¯ä¸€æ— æ‰€â€œçœ‹â€ï¼Œå› ä¸ºä»–æœ¬æ¥å°±æ²¡æœ‰æ‰“ç®—å»â€œçœ‹â€ä»€ä¹ˆï¼Œæ‰€ä»¥ä»–æ‰ä¼šä»€ä¹ˆéƒ½â€œçœ‹â€ã€‚ä»–é˜…è¯»åªæ˜¯ä¸ºäº†æ’é£æ— èŠï¼Œå¸Œæœ›è¿™ç™¾æ— èŠèµ–çš„æ—¥å­èµ¶å¿«æºœèµ°ï¼Œç›¼åªç›¼â€œé©¬å„¿å‘€å¿«å¿«åœ°èµ°â€ï¼Œè¿™å°±æ˜¯æ‰€è°“â€œä¸åšæ— èŠä¹‹äº‹ï¼Œä½•ä»¥é£æœ‰æ¶¯ä¹‹ç”Ÿâ€ã€‚ é‰´èµæ€§é˜…è¯»åŒ…æ‹¬å¬è½»ç›ˆä¼˜ç¾çš„éŸ³ä¹ï¼Œçœ‹èµå¿ƒæ‚¦ç›®çš„ç”»å†Œï¼Œè¯»æ–‡å­—ä¼˜ç¾çš„æ¸¸è®°ï¼Œè¯»æƒ…èŠ‚æ›²æŠ˜çš„å°è¯´ç­‰ç­‰ã€‚è¿™ç±»é˜…è¯»è½»æ¾æ„‰å¿«ï¼Œç´§å¼ æ€è€ƒä¹‹ä½™ï¼Œä¸‹ç­å½’æ¥ä¹‹åï¼Œå¬å¬éŸ³ä¹ï¼Œç¿»ç¿»ç”»å†Œï¼Œå“å“å­—å¸–ï¼Œè¯»è¯»å°å“ï¼Œæ—¢èƒ½ä½¿è‡ªå·±èº«å¿ƒæ”¾æ¾ï¼Œåˆèƒ½æé«˜è‡ªå·±çš„å®¡ç¾èƒ½åŠ›ï¼Œè¿˜å¯ä»¥ä½¿è‡ªå·±æƒ…æ„Ÿä¸°å¯Œç»†è…»ï¼Œè¿™ç§é˜…è¯»æœ‰â€œä¸€çŸ³ä¸‰é¸Ÿâ€çš„å¤šé‡å¥½å¤„ã€‚ æœ€åä¸€ç§é˜…è¯»å°±æ˜¯æŒ‘æˆ˜æ€§é˜…è¯»ã€‚äººç±»æµä¼ ä¸‹æ¥çš„ä¼Ÿå¤§ç»å…¸ï¼Œè¿˜æœ‰ä¸“ä¸šå…¬è®¤çš„åè‘—ï¼Œè¿™ä¸€ç±»ç»å…¸è‘—ä½œéƒ½æ˜¯æŒ‘æˆ˜æ€§é˜…è¯»çš„è¯»ç‰©ã€‚è¦æƒ³æŒ‘æˆ˜è‡ªå·±çš„æ™ºåŠ›æé™ï¼Œè¦æƒ³æ”€ç™»çµé­‚çš„ç ç©†æœ—ç›å³°ï¼Œæœ€ä½³é€‰æ‹©å°±æ˜¯æŒ‘æˆ˜æ€§é˜…è¯»ï¼Œå»é˜…è¯»é‚£äº›ä¼Ÿå¤§çš„ç»å…¸ï¼Œå»ç»“äº¤é‚£äº›éå‡¡çš„æ™ºè€…æˆ–å´‡é«˜çš„ä¼Ÿäººã€‚ ä¸€ä½è¥¿æ–¹ä½œå®¶æ›¾ä¸æ— è°ƒä¾ƒåœ°è¯´ï¼Œæ‰€è°“â€œç»å…¸è‘—ä½œâ€å°±æ˜¯äººäººè¯´å¥½ï¼Œä½†äººäººä¸è¯»çš„é‚£äº›ä¹¦ç±ã€‚çš„ç¡®ï¼Œç»å…¸å¤§å¤šæ•°æ˜¯åœ¨äººä»¬ä¹¦æ¶ä¸Šè¢«â€œä¾›å¥‰â€ï¼Œå¹¶ä¸æ˜¯åœ¨äººä»¬æ¡ˆå¤´ä¸Šè¢«é˜…è¯»ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿæˆ–æ·±åº¦è¶…å‡ºäº†è‡ªå·±çš„æ™ºåŠ›èŒƒå›´ï¼Œåˆè¯»å¾€å¾€ä¸çŸ¥æ‰€äº‘ï¼Œå¦‚ç½—ç´ çš„ã€Šæ•°å­¦åŸç†ã€‹ã€å¼—é›·æ ¼çš„ã€Šç®—æœ¯åŸºç¡€ã€‹ï¼›æˆ–è¡Œæ–‡è¿‡äºæ™¦æ¶©è‰°æ·±ï¼Œè¶…å‡ºäº†ä¸€èˆ¬è¯»è€…å¿å—çš„æé™ï¼Œå¦‚åº·å¾·çš„ã€Šçº¯ç²¹ç†æ€§æ‰¹åˆ¤ã€‹ã€æµ·å¾·æ ¼å°”çš„ã€Šå­˜åœ¨ä¸æ—¶é—´ã€‹ï¼›æˆ–è‡ªå·±ç¼ºä¹å¿…è¦çš„çŸ¥è¯†å‡†å¤‡ï¼Œæˆ–æ—¶ä»£ç›¸éš”ååˆ†é¥è¿œï¼Œä»Šäººæ— æ³•é¢†ç•¥ä¹¦ä¸­çš„ç¾æ„Ÿï¼Œå¦‚å±ˆåŸçš„éªšèµ‹ã€æœç”«çš„è¯—æ­Œã€ä½†ä¸çš„ã€Šç¥æ›²ã€‹ã€‚è¿™äº›ç»å…¸æ˜¯äººç±»çš„ç²¾ç¥å®åº“ï¼Œä½†å¤§å¤šæ•°äººä¸å¾—å…¶é—¨è€Œå…¥ï¼Œå®ƒåªå‘é‚£äº›å‹¤å¥‹åšæ¯…è€…æ•å¼€å¤§é—¨ã€‚ ç»å…¸ç»ä¸èƒ½â€œéšä¾¿ç¿»ç¿»â€ï¼Œå†ä¸‰æ€è€ƒç¢ç£¨æ‰èƒ½æ¢éªŠå¾—ç ï¼Œåå¤å’€åš¼æ‰èƒ½å“å’‚å‡ºå®ƒçš„å‘³é“ã€‚ç»å…¸ä¸æ˜¯å¿ƒçµçš„â€œå¯å£å¯ä¹â€ï¼Œæˆ‘ä»¬å¯ä»¥å’•å™œå’•å™œåœ°ä¸€é¥®è€Œå°½ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ä¸æ–­é’»ç ”æ‰èƒ½å¸¸è¯»å¸¸æ–°ï¼Œå¦‚å…ˆç§¦çš„ã€Šåº„å­ã€‹ã€å¸é©¬è¿çš„ã€Šå²è®°ã€‹ã€é©¬å…‹æ€çš„ã€Šèµ„æœ¬è®ºã€‹ã€é»‘æ ¼å°”çš„ã€Šç²¾ç¥ç°è±¡å­¦ã€‹ï¼Œä½ è¶Šè¯»è¶Šè§‰å¾—å¥‡å¦™æ— æ¯”ã€‚å€˜è‹¥çœŸæ­£è¯»æ‡‚äº†è¿™äº›ç»å…¸ï¼Œä½ ä¼šæœ‰ä¸€ç§â€œä¸€è§ˆä¼—å±±å°â€çš„å¼€è±ï¼›å€˜è‹¥ç»ˆèº«æµ¸æ¶¦äºä¼Ÿå¤§çš„ç»å…¸ä¹‹ä¸­ï¼Œä½ å°†â€œèº«å¿ƒè·ç›Šé¡æ¶¯ï¼Œæ–‡ç¬”å¢åæœ‰æœ›â€ã€‚ â€œæ¢éªŠå¾—ç â€çš„åŸæ„æ˜¯éªŠç ï¼Œç›¸ä¼ ä¸ºè—åœ¨éªŠé¾™é¢”ä¸‹çš„å®ç ï¼ŒéªŠé¾™æ –æ¯æ·±æ¸Šä¸­ï¼Œæ¬²å–å¾—éªŠç ï¼Œå¿…é¡»æ½œå…¥æ·±æ¸Šï¼Œå¾…éªŠé¾™å…¥ç¡åï¼Œå†ä¿Ÿæœºçªƒå–ï¼›æŒ‡è·å¾—æä¸ºçè´µçš„å®ç‰©ï¼›åå¼•ç”³ä¸ºå†™ä½œæ–‡ç« èƒ½æŠ“ä½é‡ç‚¹ï¼Œæ·±å¾—é¢˜æ—¨çš„ç²¾é«“ã€‚ å¯æƒœï¼Œæœ‰â€œä¼šå½“å‡Œç»é¡¶â€é›„å¿ƒçš„äººå¾ˆå¤šï¼Œä½†æœ€åå®ç°â€œå‡Œç»é¡¶â€å¿—å‘çš„äººæå°‘ã€‚å¤äººå¸¸å¸¸æ„Ÿå¹ï¼Œâ€œå­¦è€…å¦‚ç‰›æ¯›ï¼Œæˆè€…å¦‚éºŸè§’â€ï¼Œå­¦æ— æ‰€æˆçš„åŸå› æ˜¯æ²¡æœ‰å®šåŠ›ã€‚äººä¸äººæ‹‰å¼€å·®è·çš„å…³é”®ï¼Œå¤§å¤šä¸æ˜¯æ™ºåŠ›çš„é«˜ä¸‹ï¼Œè€Œæ˜¯æ¯…åŠ›ä¸æ’å¿ƒçš„å¤§å°ã€‚åŒ…æ‹¬æˆ‘åœ¨å†…çš„è®¸å¤šæœ‹å‹ï¼Œâ€œä¼šå½“å‡Œç»é¡¶â€çš„é›„å¿ƒä¸è¿‡ä¸€æ—¶å¿ƒè¡€æ¥æ½®ï¼Œè¿˜æ²¡æœ‰çˆ¬åˆ°åŠå±±è…°å°±è§éš¾è€Œè¿”ã€‚ å¼ƒéš¾å›¾æ˜“æ˜¯äººçš„å¤©æ€§ï¼Œâ€œä¸œæµ·è¥¿æµ·ï¼Œå¿ƒåŒç†åŒâ€ï¼Œå¥—ç”¨ç‹å°”å¾·çš„è¯è¯´ï¼Œæ‰€æœ‰äººéƒ½æœ‰æƒ°æ€§ï¼Œè¿æˆ‘ä¹Ÿæœ‰æƒ°æ€§ï¼šåªè¦èƒ½è¯»æ¶ˆé£è¯»ç‰©æˆ‘å°±ä¸è¯»ç»å…¸ï¼Œåªè¦èƒ½è¯»ä¸­æ–‡æˆ‘å°±ä¸æƒ³è¯»è‹±æ–‡ï¼Œåªè¦èƒ½è¯»ç°ä»£æ–‡å­¦æˆ‘å°±ä¸æƒ³è¯»å¤ä»£æ–‡å­¦ï¼Œåªè¦èƒ½çœ‹ç”µè§†æˆ‘å°±ä¸æƒ³è¯»ä¹¦ï¼Œåªè¦èƒ½ç©æ‰‹æœºæˆ‘å°±ä¸ä¼šçœ‹ç”µè§†â€¦â€¦ å½“ç„¶ï¼Œä»Šå¤©äººä»¬æ— æ³•æ‹’ç»æ‰‹æœºé˜…è¯»å’Œç½‘ç»œé˜…è¯»ã€‚é—®é¢˜æ˜¯ï¼Œèƒ½å¦è®©ç½‘ç»œç©ºé—´ä¹Ÿé£˜æº¢ä¹¦é¦™ï¼Ÿæ˜¯å¦ä¹Ÿèƒ½åœ¨æ‰‹æœºä¸Šå’€åš¼ç»å…¸ï¼Ÿçœ‹æ¥äººä»¬å·²ç»å‘ç°äº†é—®é¢˜çš„ä¸¥é‡æ€§ï¼Œå°±åƒå¤§å®¶æ‹’ç»å¿«é¤é£Ÿå“ä¸€æ ·ï¼Œäººä»¬ä¼šé€æ¸æ”¹å˜æ¶ˆé£å¼æµè§ˆï¼Œåœ¨ç½‘ç»œç©ºé—´ä¸­åŸ¹å…»æŒ‘æˆ˜æ€§é˜…è¯»çš„ä¹ æƒ¯ï¼ŒåŒæ—¶åœ¨çº¸è´¨ä¹¦æœ¬ä¸ç½‘ç»œç©ºé—´åŸ¹æ¤æ·±åº¦é˜…è¯»çš„åœŸå£¤ã€‚ ç¨ç¨ç•™æ„ä¸€ä¸‹å°±ä¸éš¾å‘ç°ï¼Œä¸åŒçš„é˜…è¯»å’Œæ€è€ƒä¹ æƒ¯ï¼ŒçŸ­æ—¶é—´å†…çœ‹ä¸å‡ºæœ‰ä»€ä¹ˆå·®åˆ«ï¼Œæ—¶é—´ä¸€é•¿å°±å‡ºç°å¤©å·®åœ°åˆ«ï¼šæœ‰çš„æ‰åå‡ºä¼—ï¼Œæœ‰çš„â€œæ³¯ç„¶ä¼—äººâ€ã€‚ä½ è‡ªå·±é€‰æ‹©äº†ä»€ä¹ˆæ ·çš„é˜…è¯»ä¹ æƒ¯ï¼Œä½ å°±ä¸ºè‡ªå·±é€‰æ‹©äº†ä»€ä¹ˆæ ·çš„äººç”Ÿã€‚","tags":["æˆ´å»ºä¸š"],"categories":["ç¾æ–‡èµæ"]},{"title":"QPixmapä½¿ç”¨è¦ç‚¹","path":"/post/170290456.html","content":"æœ¬æ–‡è®°å½•åœ¨ä½¿ç”¨ QPixmap æ—¶å®¹æ˜“æ„Ÿåˆ°å›°æƒ‘å’ŒçŠ¯é”™çš„åœ°æ–¹ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥é˜…ï¼Œäº¦å¸Œæœ›èƒ½æˆäººä¹‹ç¾ã€‚ 1. QPixmap æˆå‘˜å‡½æ•° QPixmap::size()å€¼ä¸ç¨‹åº devicePixelRatio æ— å…³ï¼Œè¾“å‡ºçš„æ˜¯å›¾ç‰‡åŸå§‹å°ºå¯¸ã€‚ AspectRatioMode å–å€¼ï¼š Qt::IgnoreAspectRatio å¿½ç•¥å›¾ç‰‡åŸé•¿å®½æ¯”ï¼Œå°†å›¾ç‰‡ç¼©æ”¾åˆ°æŒ‡å®šå°ºå¯¸ Qt::KeepAspectRatio åœ¨ä¿æŒå›¾ç‰‡åŸé•¿å®½æ¯”å’Œå›¾ç‰‡æ‰€æœ‰å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¡«å……æ»¡ç›®æ ‡çŸ©å½¢ã€‚ Qt::KeepAspectRatioByExpanding åœ¨ä¿æŒé•¿å®½æ¯”çš„æƒ…å†µä¸‹ï¼Œæ‹‰ä¼¸å›¾ç‰‡ä¿è¯å¡«å……æ»¡ç›®æ ‡çŸ©å½¢ï¼Œå¯èƒ½ä¼šèˆå¼ƒéƒ¨åˆ†å›¾ç‰‡å…ƒç´ ã€‚ scaledToWidthã€scaledToHeight å‡½æ•°å¯ä»¥å®ç°åœ¨ä¿æŒåŸå›¾ç‰‡é•¿å®½æ¯”çš„å‰æä¸‹ï¼Œå°†å›¾ç‰‡ç¼©æ”¾åˆ°æŒ‡å®šçš„å®½æˆ–è€…é«˜ã€‚ drawPixmap å‡½æ•°çš„å‚æ•°ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼šç›®æ ‡åŒºåŸŸ -&gt; pix -&gt; æºåŒºåŸŸã€‚ç›®æ ‡åŒºåŸŸä¼šè€ƒè™‘å½“å‰ Widget çš„ devicePixelRatioï¼Œè€ŒæºåŒºåŸŸåˆ™ä¸ devicePixelRatio æ— å…³ã€‚ 2. å¼€å¯ç¨‹åº DPI ç¼©æ”¾12345 QGuiApplication::setAttribute(Qt::AA_EnableHighDpiScaling); QGuiApplication::setAttribute(Qt::AA_UseHighDpiPixmaps);#if (QT_VERSION &gt;= QT_VERSION_CHECK(5, 14, 0)) QGuiApplication::setHighDpiScaleFactorRoundingPolicy(Qt::HighDpiScaleFactorRoundingPolicy::PassThrough);#endif 3. QPixmap::devicePixelRatioé¦–å…ˆ QPixmap::devicePixelRatio ä»…é€‚ç”¨äºå¼€å¯äº† DPI ç¼©æ”¾çš„ç¨‹åºã€‚ é«˜åˆ†è¾¨ç‡ç‰ˆæœ¬çš„å›¾ç‰‡æœ‰å¤§äº 1 çš„è®¾å¤‡åƒç´ æ¯”ï¼ˆå³QPixmap::devicePixelRatioï¼‰ï¼Œå¦‚æœè¯¥å€¼åŒ¹é…åº•å±‚ QPaintDevice çš„å€¼ï¼Œå®ƒå°†ç›´æ¥ç»˜åˆ¶åˆ°è®¾å¤‡ä¸Šï¼Œè€Œä¸åº”ç”¨é¢å¤–çš„è½¬æ¢ã€‚ è¯¥å€¼ç”¨äºæŒ‡å®šå½“å‰ QPixmap å›¾ç‰‡æ˜¯åŸºäº 1 å€å›¾çš„å‡ å€ç¼©æ”¾å›¾ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨drawPixmapå‡½æ•°æ—¶ï¼Œå¦‚æœè¯¥ç›®æ ‡åŒºåŸŸå‚æ•°æœªæŒ‡å®šå®½å’Œé«˜ï¼ŒQPixmap::devicePixelRatio æ‰ç”Ÿæ•ˆã€‚ å¦‚ä¸‹é¢çš„ drawPixmap åŸå‹ï¼š 1234567void QPainter::drawPixmap(int x, int y, const QPixmap &amp;pixmap, int sx, int sy, int sw, int sh)void QPainter::drawPixmap(const QPointF &amp;point, const QPixmap &amp;pixmap, const QRectF &amp;source)void QPainter::drawPixmap(const QPoint &amp;point, const QPixmap &amp;pixmap, const QRect &amp;source)void QPainter::drawPixmap(const QPointF &amp;point, const QPixmap &amp;pixmap)void QPainter::drawPixmap(const QPoint &amp;point, const QPixmap &amp;pixmap)void QPainter::drawPixmap(int x, int y, const QPixmap &amp;pixmap) ç¤ºä¾‹ï¼ˆç¨‹åºå·²å¼€å¯ DPI ç¼©æ”¾ï¼‰ï¼š 123456789101112void QtWidgetsApplication1::paintEvent(QPaintEvent* e)&#123; qDebug() &lt;&lt; this-&gt;devicePixelRatioF(); // å½“å‰ç¨‹åºçš„DPIç¼©æ”¾ä¸º1.5 QPainter painter(this); QPixmap pix(&quot;D:\\\\gril.png&quot;); // gril.pngå›¾ç‰‡å®é™…å°ºå¯¸ä¸º400*400 // å‘ŠçŸ¥ç¨‹åºè¯¥å›¾ç‰‡æ˜¯åŸºäº1å€å›¾è¿›è¡Œ4å€æ”¾å¤§åçš„ï¼Œå³1å€å›¾ä¸ºå®½é«˜ä¸º400/4 pix.setDevicePixelRatio(4); // å®é™…ç»˜åˆ¶çš„å›¾ç‰‡å®½åº¦ä¸º150*150ï¼Œå·¦ä¸Šè§’åæ ‡ä¸º150*150 painter.drawPixmap(QPoint(100,100), pix);&#125; é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt","QPixmap"],"categories":["Qt"]},{"title":"QSSè®¾ç½®æ»šåŠ¨æ¡æ ·å¼","path":"/post/140071237.html","content":"æœ¬æ–‡ç®€å•è®°å½•å¦‚ä½•ä½¿ç”¨ QSS è®¾ç½®æ»šåŠ¨æ¡çš„æ ·å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163/*å‚ç›´æ»šåŠ¨æ¡*/QScrollBar:vertical &#123; background: transparent; /*èƒŒæ™¯è‰²*/ width: 10px; /*å®½åº¦*/ margin: 0px 0px 0px 0px; /**/ padding-top: 12px; /*è·ç¦»ä¸Šé¢12px*/ padding-bottom: 12px; /*è·ç¦»åº•éƒ¨12px*/&#125;/*æ¨ªå‘æ»šåŠ¨æ¡*/QScrollBar:horizontal &#123; background: transparent; /*èƒŒæ™¯è‰²*/ height: 10px; /*é«˜åº¦*/ margin: 0px 0px 0px 0px; padding-left: 12px; /*è·ç¦»å·¦è¾¹12px*/ padding-right: 12px; /*è·ç¦»å³è¾¹12px*/&#125;/*å‚ç›´/æ¨ªå‘æ»šåŠ¨æ¡Hoveræ•ˆæœ*/QScrollBar:vertical:hover,QScrollBar:horizontal:hover &#123; background: rgba(0, 0, 0, 30); /*èƒŒæ™¯è‰²*/ border-radius: 5px; /*åœ†è§’*/&#125;/*å‚ç›´æ»šåŠ¨æ¡ - æ»‘å—*/QScrollBar::handle:vertical &#123; background: rgba(0, 0, 0, 50); width: 10px; border-radius: 5px; border: none;&#125;/*æ¨ªå‘æ»šåŠ¨æ¡ - æ»‘å—*/QScrollBar::handle:horizontal &#123; background: rgba(0, 0, 0, 50); height: 10px; border-radius: 5px; border: none;&#125;/*å‚ç›´/æ¨ªå‘æ»šåŠ¨æ¡æ»‘å—Hoveræ•ˆæœ*/QScrollBar::handle:vertical:hover,QScrollBar::handle:horizontal:hover &#123; background: rgba(0, 0, 0, 100);&#125;/*å‚ç›´æ»šåŠ¨æ¡ä¸‹éƒ¨åˆ†å—*/QScrollBar::add-page:vertical &#123; width: 10px; background: transparent;&#125;/*å‚ç›´æ»šåŠ¨æ¡ä¸Šé¢éƒ¨åˆ†å—*/QScrollBar::sub-page:vertical &#123; width: 10px; background: transparent;&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å³è¾¹éƒ¨åˆ†å—*/QScrollBar::add-page:horizontal &#123; height: 10px; background: transparent;&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å·¦è¾¹éƒ¨åˆ†å—*/QScrollBar::sub-page:horizontal &#123; height: 10px; background: transparent;&#125;/* ----------- å¯¹äºæ‰å¹³åŒ–è®¾è®¡é£æ ¼ï¼Œä¸‹é¢çš„æ ·å¼å¯ä»¥ä¸ç”¨è®¾ç½® ----------- *//*å‚ç›´æ»šåŠ¨æ¡é¡¶éƒ¨ä¸‰è§’å½¢ä½ç½®*/QScrollBar::sub-line:vertical &#123; height: 12px; width: 10px; background: transparent; subcontrol-position: top;&#125;/*å‚ç›´æ»šåŠ¨æ¡é¡¶éƒ¨ä¸‰è§’å½¢å›¾æ ‡*/QScrollBar::up-arrow:vertical &#123; image: url(:/client/images/scrollbar_arrowup_normal.png);&#125;/*å‚ç›´æ»šåŠ¨æ¡é¡¶éƒ¨ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡Hoveræ•ˆæœ*/QScrollBar::up-arrow:vertical:hover &#123; image: url(:/client/images/scrollbar_arrowup_down.png);&#125;/*å‚ç›´æ»šåŠ¨æ¡é¡¶éƒ¨ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡æŒ‰ä¸‹æ•ˆæœ*/QScrollBar::up-arrow:vertical:pressed &#123; image: url(:/client/images/scrollbar_arrowup_highlight.png);&#125;/*å‚ç›´æ»šåŠ¨æ¡åº•éƒ¨ä¸‰è§’å½¢ä½ç½®*/QScrollBar::add-line:vertical &#123; height: 12px; width: 10px; background: transparent; subcontrol-position: bottom;&#125;/*å‚ç›´æ»šåŠ¨æ¡åº•éƒ¨ä¸‰è§’å½¢å›¾æ ‡*/QScrollBar::down-arrow:vertical &#123; image: url(:/client/images/scrollbar_arrowdown_normal.png);&#125;/*å‚ç›´æ»šåŠ¨æ¡åº•éƒ¨ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡Hoveræ•ˆæœ*/QScrollBar::down-arrow:vertical:hover &#123; image: url(:/client/images/scrollbar_arrowdown_down.png);&#125;/*å‚ç›´æ»šåŠ¨æ¡åº•éƒ¨ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡æŒ‰ä¸‹æ•ˆæœ*/QScrollBar::down-arrow:vertical:pressed &#123; image: url(:/client/images/scrollbar_arrowdown_highlight.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å·¦ä¾§ä¸‰è§’å½¢ä½ç½®*/QScrollBar::sub-line:horizontal &#123; height: 10px; width: 12px; background: transparent; subcontrol-position: left;&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å·¦ä¾§ä¸‰è§’å½¢å›¾æ ‡*/QScrollBar::left-arrow:horizontal &#123; image: url(:/client/images/scrollbar_arrowleft_normal.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å·¦ä¾§ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡Hoveræ•ˆæœ*/QScrollBar::left-arrow:horizontal:hover &#123; image: url(:/client/images/scrollbar_arrowleft_down.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å·¦ä¾§ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡æŒ‰ä¸‹æ•ˆæœ*/QScrollBar::left-arrow:horizontal:pressed &#123; image: url(:/client/images/scrollbar_arrowleft_highlight.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å³ä¾§ä¸‰è§’å½¢éƒ¨åˆ†*/QScrollBar::add-line:horizontal &#123; height: 10px; width: 12px; background: transparent; subcontrol-position: right;&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å³ä¾§ä¸‰è§’å½¢å›¾æ ‡*/QScrollBar::right-arrow:horizontal &#123; image: url(:/client/images/scrollbar_arrowright_normal.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å³ä¾§ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡Hoveræ•ˆæœ*/QScrollBar::right-arrow:horizontal:hover &#123; image: url(:/client/images/scrollbar_arrowright_down.png);&#125;/*æ¨ªå‘æ»šåŠ¨æ¡å³ä¾§ä¸‰è§’å½¢å›¾æ ‡ é¼ æ ‡æŒ‰ä¸‹æ•ˆæœ*/QScrollBar::right-arrow:horizontal:pressed &#123; image: url(:/client/images/scrollbar_arrowright_highlight.png);&#125;","tags":["Qt","QSS","æ»šåŠ¨æ¡"],"categories":["Qt"]},{"title":"Qtå­çº¿ç¨‹ä¸­æ›´æ–°UI","path":"/post/3531733309.html","content":"æœ¬æ–‡ä»‹ç»ä¸¤ç§åœ¨Qtå­çº¿ç¨‹ï¼ˆéUIçº¿ç¨‹ï¼‰ä¸­æ›´æ–°UIç»„ä»¶çš„å¸¸ç”¨æ–¹æ³•ã€‚ 1. ä½¿ç”¨ä¿¡å·æ§½è¿™æ˜¯ä¸€ç§éå¸¸å¸¸è§„çš„æ–¹å¼ï¼Œé€šè¿‡è‡ªå®šä¹‰ä¿¡å·ã€æ§½ï¼Œè¿æ¥è¯¥ä¿¡å·å’Œæ§½ï¼Œåœ¨å­çº¿ç¨‹ä¸­å‘é€ä¿¡å·ï¼Œåœ¨æ§½ä¸­æ›´æ–° UIã€‚ å®šä¹‰ä¿¡å·å’Œæ§½ï¼š 1234signals: void updateUi(int v);private slots: void onUpdateUi(int v); åœ¨å­çº¿ç¨‹ä¸­å‘é€ä¿¡å·ï¼š 12345678910// è¿æ¥ä¿¡å·connect(this, &amp;UpdateUIInSubThread::updateUi, this, &amp;UpdateUIInSubThread::onUpdateUi, Qt::AutoConnection);std::thread t = std::thread([this]() &#123; for (int i = 0; i &lt; 10000; i++) &#123; emit updateUi(i); // å‘é€ä¿¡å· std::this_thread::sleep_for(std::chrono::milliseconds(50)); &#125;&#125;);t.detach(); åœ¨æ§½å‡½æ•°ä¸­æ›´æ–° UIï¼š 1234void UpdateUIInSubThread::onUpdateUi(int v)&#123; ui.label-&gt;setText(QString::number(v));&#125; è¿™ç§æ–¹å¼éœ€è¦å•ç‹¬é¢å¤–å®šä¹‰ä¿¡å·å’Œæ§½ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç¹çã€‚ 2. ä½¿ç”¨invokeMethodQMetaObject::invokeMethod å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š 1template &lt;typename Functor, typename FunctorReturnType&gt; bool QMetaObject::invokeMethod(QObject *context, Functor function, Qt::ConnectionType type = Qt::AutoConnection, FunctorReturnType *ret = nullptr) è¯¥å‡½æ•°å¯ä»¥åœ¨contextçš„äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œfunctionå‡½æ•°ã€‚ 123456789101112std::thread t = std::thread([this]() &#123; for (int i = 0; i &lt; 10000; i++) &#123; if (QMetaObject::invokeMethod(this, [i, this]() &#123; ui.label-&gt;setText(QString::number(i)); &#125;)) &#123; qDebug() &lt;&lt; &quot;Update UI success&quot;; &#125; std::this_thread::sleep_for(std::chrono::milliseconds(50)); &#125;&#125;);t.detach(); ç”±äºåœ¨å­çº¿ç¨‹ä¸­æ›´æ–° UIï¼Œå› æ­¤ä¿¡å·å’Œæ§½è‚¯å®šä½¿ç”¨çš„æ˜¯ QueuedConnection çš„è¿æ¥æ–¹å¼ï¼Œæ‰€ä»¥æ— æ³•å°†FunctorReturnTypeè¿”å›ç»™è°ƒç”¨è€…ï¼Œå¦åˆ™ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š 1QMetaObject::invokeMethod: Unable to invoke methods with return values in queued connections å½“ç„¶ä¸Šè¿°ç¤ºä¾‹ä¸­ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ lambda è¡¨è¾¾å¼ï¼Œç›´æ¥è°ƒç”¨æ§½å‡½æ•°ï¼š 12345678std::thread t = std::thread([this]() &#123; for (int i = 0; i &lt; 10000; i++) &#123; QMetaObject::invokeMethod(this, &quot;onUpdateUi&quot;, Qt::AutoConnection, Q_ARG(int, i)); std::this_thread::sleep_for(std::chrono::milliseconds(50)); &#125;&#125;);t.detach();","tags":["Qt","çº¿ç¨‹"],"categories":["Qt"]},{"title":"Qtå¼¹çª—å¤–éƒ¨ç‚¹å‡»æ—¶è‡ªåŠ¨å…³é—­","path":"/post/3677374843.html","content":"æœ¬æ–‡ä»‹ç»åœ¨ Qt ç¼–ç¨‹ä¸­å¦‚ä½•å®ç°å½“é¼ æ ‡ç‚¹å‡»å¼¹çª—å¤–éƒ¨åŒºåŸŸæ—¶ï¼Œè¯¥å¼¹çª—å¯ä»¥è‡ªåŠ¨å…³é—­çš„æ•ˆæœã€‚ 1. ActivationChange äº‹ä»¶å¼¹çª—é€šè¿‡ç›‘å¬ Activation æ”¹å˜äº‹ä»¶ï¼Œæ¥åˆ¤æ–­è‡ªèº«æ˜¯å¦è¿˜æ˜¯å½“å‰çš„æ´»åŠ¨çª—å£ï¼Œå¦‚æœä¸æ˜¯åˆ™å…³é—­è‡ªèº«ã€‚ åœ¨ QWidget é‡Œé¢é‡å†™ eventï¼Œæ•è· QEvent::ActivationChange äº‹ä»¶ï¼š 123456789bool UserCenterDlg::event(QEvent* e) &#123; if (e-&gt;type() == QEvent::ActivationChange) &#123; QWidget* curActiveWin = QApplication::activeWindow(); if (curActiveWin != this) &#123; this-&gt;close(); &#125; &#125; return QWidget::event(e);&#125; 2. Qt::WA_NoMouseReplay ä»‹ç» æ‘˜è‡ª Qt å¸®åŠ©æ–‡æ¡£ï¼š Qt::WA_NoMouseReplay: Used for pop-up widgets. Indicates that the most recent mouse press event should not be replayed when the pop-up widget closes. The flag is set by the widgetâ€™s author and cleared by the Qt kernel every time the widget receives a new mouse event. Qt::WA_NoMouseReplay å±æ€§å¯ä»¥ç”¨æ¥é¿å…å¦‚ä¸‹æƒ…å†µçš„å‘ç”Ÿï¼šåœ¨é¼ æ ‡ç‚¹å‡» Popup Widget å¤–éƒ¨åŒºåŸŸæ—¶ï¼Œè¯¥ Widget æ¥æ”¶åˆ°è‡ªèº«çš„ Activation çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå…³é—­è‡ªèº«ï¼Œä½†åœ¨è¯¥ Widget åœ¨å…³é—­åï¼ŒQt ä¾ç„¶ä¼šå°†é¼ æ ‡ç‚¹å‡»äº‹ä»¶ç»§ç»­å‘ä¸‹ä¼ é€’ï¼Œä»è€Œçª—å£å¤–åŒºåŸŸä¸‹é¢çš„æ§ä»¶ä¹Ÿä¼šè¢«ç‚¹å‡»ã€‚ ç”±äº Qt::WA_NoMouseReplay å±æ€§åªå¯¹å…·æœ‰ Popup å±æ€§çš„ Widget èµ·ä½œç”¨ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ QWidgetï¼Œä¸èƒ½ä½¿ç”¨ QDialogï¼Œå¹¶è®¾ç½® Qt::Popup å±æ€§ã€‚ 1setWindowFlags(windowFlags() | Qt::Popup); ä½•æ—¶è®¾ç½® Qt::WA_NoMouseReplay å±æ€§äº†ï¼Ÿ é‡å†™ mousePressEventï¼Œåœ¨é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè®¾ç½® Qt::WA_NoMouseReplay å±æ€§ã€‚ 1234void UserCenterDlg::mousePressEvent(QMouseEvent* e) &#123; setAttribute(Qt::WA_NoMouseReplay); QWidget::mousePressEvent(e);&#125; 3. è‡ªå®šä¹‰ closed ä¿¡å·QWidget æ²¡æœ‰å…³é—­ä¿¡å·ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å…³é—­ä¿¡å·ï¼Œè¯¥ä¿¡å·åœ¨ closeEvent ä¸­è§¦å‘ã€‚ 1234void UserCenterDlg::closeEvent(QCloseEvent* e) &#123; emit closed(); QWidget::closeEvent(e);&#125; é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt"],"categories":["Qt"]},{"title":"å¼€æºåº“nlohmann jsonä½¿ç”¨å¤‡å¿˜","path":"/post/1128187204.html","content":"nlohmann&#x2F;json æ˜¯ä¸€ä¸ªç”¨äºè§£æ JSON çš„å¼€æº C++åº“ï¼Œå£ç¢‘ä¸€æµï¼Œæ— éœ€é¢å¤–å®‰è£…å…¶ä»–ç¬¬ä¸‰æ–¹åº“ï¼Œè¿˜æ”¯æŒå•ä¸ªå¤´æ–‡ä»¶æ¨¡å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ç›´è§‚ã€‚ 1. ç¼–è¯‘ä»å®˜ç½‘https://github.com/nlohmann/jsonçš„ Release é¡µé¢ä¸‹è½½å•ä¸ªjson.hppå³å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å•ç‹¬ç¼–è¯‘ã€‚ 2. ä½¿ç”¨ç¤ºä¾‹ä¸‹é¢ä»¥ç¤ºä¾‹çš„æ–¹å¼ç½—åˆ— nlohmann&#x2F;json åº“çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚ 2.1 ç”Ÿæˆ JSONæ–¹å¼ 112345678910111213141516171819int main()&#123; using json = nlohmann::json; json j; j[&quot;pi&quot;] = 3.141; j[&quot;happy&quot;] = true; j[&quot;name&quot;] = &quot;Niels&quot;; j[&quot;nothing&quot;] = nullptr; j[&quot;answer&quot;][&quot;everything&quot;] = 42; j[&quot;list&quot;] = &#123; 1, 0, 2 &#125;; j[&quot;object&quot;] = &#123; &#123;&quot;currency&quot;, &quot;USD&quot;&#125;, &#123;&quot;value&quot;, 42.99&#125; &#125;; // è½¬æˆå­—ç¬¦ä¸² std::string strJSON = j.dump(2); // 2ä¸ªç©ºæ ¼çš„ç¼©è¿› std::cout &lt;&lt; strJSON; return 0;&#125; è¾“å‡ºå¦‚ä¸‹ï¼š 1234567891011121314&#123; &quot;answer&quot;: &#123; &quot;everything&quot;: 42 &#125;, &quot;happy&quot;: true, &quot;list&quot;: [1, 0, 2], &quot;name&quot;: &quot;Niels&quot;, &quot;nothing&quot;: null, &quot;object&quot;: &#123; &quot;currency&quot;: &quot;USD&quot;, &quot;value&quot;: 42.99 &#125;, &quot;pi&quot;: 3.141&#125; æ–¹å¼ 212345678910111213141516171819int main()&#123; using json = nlohmann::json; json j = &#123; &#123;&quot;pi&quot;, 3.141&#125;, &#123;&quot;happy&quot;, true&#125;, &#123;&quot;name&quot;, &quot;Niels&quot;&#125;, &#123;&quot;nothing&quot;, nullptr&#125;, &#123;&quot;answer&quot;, &#123;&#123;&quot;everything&quot;, 42&#125;&#125;&#125;, &#123;&quot;list&quot;, &#123;1, 0, 2&#125;&#125;, &#123;&quot;object&quot;, &#123;&#123;&quot;currency&quot;, &quot;USD&quot;&#125;, &#123;&quot;value&quot;, 42.99&#125;&#125;&#125; &#125;; // è½¬æˆå­—ç¬¦ä¸² std::string strJSON = j.dump(2); std::cout &lt;&lt; strJSON; return 0;&#125; è¾“å‡ºå†…å®¹ä¸æ–¹å¼ 1 ä¸€æ ·ã€‚ æ–¹å¼ 312345678910111213141516171819202122232425262728293031323334int main()&#123; using json = nlohmann::json; json j; j[&quot;pi&quot;] = 3.141; j[&quot;happy&quot;] = true; j[&quot;name&quot;] = &quot;Niels&quot;; j[&quot;nothing&quot;] = nullptr; json j_answer; j_answer[&quot;everything&quot;] = 42; j[&quot;answer&quot;] = j_answer; json j_list = json::array(); j_list.push_back(1); j_list.push_back(0); j_list.push_back(2); j[&quot;list&quot;] = j_list; json j_object; j_object[&quot;currency&quot;] = &quot;USD&quot;; j_object[&quot;value&quot;] = 42.99; j[&quot;object&quot;] = j_object; // è½¬æˆå­—ç¬¦ä¸² std::string strJSON = j.dump(2); std::cout &lt;&lt; strJSON; return 0;&#125; è¾“å‡ºå†…å®¹ä¸æ–¹å¼ 1 ä¸€æ ·ã€‚ 2.2 è§£æ JSON12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849int main()&#123; using json = nlohmann::json; std::string strJSON = u8R&quot;( &#123; &quot;answer&quot;: &#123; &quot;everything&quot;: 42 &#125;, &quot;happy&quot;: true, &quot;list&quot;: [ 1, 0, 2 ], &quot;name&quot;: &quot;Niels&quot;, &quot;nothing&quot;: null, &quot;object&quot;: &#123; &quot;currency&quot;: &quot;USD&quot;, &quot;value&quot;: 42.99 &#125;, &quot;pi&quot;: 3.141 &#125; )&quot;; auto jsonObj = json::parse(strJSON); std::cout &lt;&lt; jsonObj[&quot;pi&quot;].get&lt;float&gt;() &lt;&lt; std::endl; // 3.141 std::cout &lt;&lt; jsonObj[&quot;pi&quot;].get&lt;double&gt;() &lt;&lt; std::endl; // 3.141 std::cout &lt;&lt; std::boolalpha &lt;&lt; jsonObj[&quot;happy&quot;].get&lt;bool&gt;() &lt;&lt; std::endl; // true std::cout &lt;&lt; jsonObj[&quot;name&quot;].get&lt;std::string&gt;() &lt;&lt; std::endl; // Niels assert(jsonObj[&quot;nothing&quot;] == nullptr); std::cout &lt;&lt; jsonObj[&quot;answer&quot;][&quot;everything&quot;].get&lt;int&gt;() &lt;&lt; std::endl; // 42 std::cout &lt;&lt; jsonObj[&quot;list&quot;].size() &lt;&lt; std::endl; // 3 std::cout &lt;&lt; jsonObj[&quot;list&quot;][0].get&lt;int&gt;() &lt;&lt; std::endl; // 1 std::cout &lt;&lt; jsonObj[&quot;list&quot;][1].get&lt;int&gt;() &lt;&lt; std::endl; // 0 std::cout &lt;&lt; jsonObj[&quot;list&quot;][2].get&lt;int&gt;() &lt;&lt; std::endl; // 2 std::cout &lt;&lt; jsonObj[&quot;object&quot;][&quot;currency&quot;].get&lt;std::string&gt;() &lt;&lt; std::endl; // USD std::cout &lt;&lt; jsonObj[&quot;object&quot;][&quot;value&quot;].get&lt;float&gt;() &lt;&lt; std::endl; // 42.99 // ä¾æ¬¡è¾“å‡º: // 1 // 0 // 2 for (json::iterator it = jsonObj[&quot;list&quot;].begin(); it != jsonObj[&quot;list&quot;].end(); ++it) &#123; std::cout &lt;&lt; *it &lt;&lt; std::endl; &#125; return 0;&#125; 3. å¼‚å¸¸å¤„ç†å½“è§£æå’Œç”Ÿæˆ JSON å‡ºé”™æ—¶ï¼Œnlohmann&#x2F;json ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤åœ¨è§£æå’Œç”Ÿæˆ JSON æ—¶ï¼Œéœ€è¦è¿›è¡Œå¼‚å¸¸æ•è·ã€‚ 1234567891011121314151617181920int main()&#123; using json = nlohmann::json; std::string strJSON = u8R&quot;( &#123; &quot;pi&quot;: 3.141 &#125; )&quot;; try &#123; auto jsonObj = json::parse(strJSON); std::cout &lt;&lt; jsonObj[&quot;ppp&quot;].get&lt;float&gt;() &lt;&lt; std::endl; &#125; catch (std::exception&amp; e) &#123; std::cout &lt;&lt; e.what() &lt;&lt; std::endl; &#125; return 0;&#125; 4. åˆ¤æ–­æˆå‘˜æ˜¯å¦å­˜åœ¨12345678910111213141516int main()&#123; using json = nlohmann::json; std::string strJSON = u8R&quot;( &#123; &quot;pi&quot;: 3.141 &#125; )&quot;; auto jsonObj = json::parse(strJSON); std::cout &lt;&lt; std::boolalpha &lt;&lt; jsonObj.contains(&quot;pi&quot;) &lt;&lt; std::endl; // true std::cout &lt;&lt; std::boolalpha &lt;&lt; jsonObj.contains(&quot;ppp&quot;) &lt;&lt; std::endl; // false return 0;&#125;","tags":["JSON"],"categories":["å¼€æºåº“"]},{"title":"C++å­—ç¬¦ä¸²å’Œå­—ç¬¦å­—é¢é‡","path":"/post/487899896.html","content":"C++æ”¯æŒå„ç§å­—ç¬¦ä¸²å’Œå­—ç¬¦ç±»å‹ï¼Œå¹¶æä¾›äº†è¡¨è¾¾æ¯ç§ç±»å‹å­—é¢å€¼çš„æ–¹æ³•ã€‚åœ¨æºä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å­—ç¬¦é›†æ¥è¡¨ç¤ºå­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨é€šç”¨å­—ç¬¦åå’Œè½¬ä¹‰å­—ç¬¦æ¥é€šè¿‡åŸºæœ¬çš„æºå­—ç¬¦é›†è¡¨ç¤ºä»»ä½•å­—ç¬¦ä¸²ã€‚è€ŒåŸå§‹å­—ç¬¦ä¸²èƒ½å¤Ÿé¿å…å¯¹è½¬ä¹‰å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶å¯ç”¨äºè¡¨ç¤ºæ‰€æœ‰ç±»å‹çš„å­—ç¬¦ä¸²ã€‚ 1. å­—ç¬¦å’Œå­—ç¬¦ä¸²å­—é¢é‡1234567891011121314151617181920int main()&#123; // Character literals auto c0 = &#x27;A&#x27;; // char auto c1 = u8&#x27;A&#x27;; // char auto c2 = L&#x27;A&#x27;; // wchar_t auto c3 = u&#x27;A&#x27;; // char16_t auto c4 = U&#x27;A&#x27;; // char32_t // Multicharacter literals auto m0 = &#x27;abcd&#x27;; // int, value 0x61626364 // String literals auto s0 = &quot;hello&quot;; // const char* auto s1 = u8&quot;hello&quot;; // const char* before C++20, encoded as UTF-8, // const char8_t* in C++20 auto s2 = L&quot;hello&quot;; // const wchar_t* auto s3 = u&quot;hello&quot;; // const char16_t*, encoded as UTF-16 auto s4 = U&quot;hello&quot;; // const char32_t*, encoded as UTF-32&#125; 2. åŸå§‹å­—ç¬¦ä¸²12345678910int main()&#123; // Raw string literals containing unescaped \\ and &quot; auto R0 = R&quot;(&quot;Hello \\ world&quot;)&quot;; // const char* auto R1 = u8R&quot;(&quot;Hello \\ world&quot;)&quot;; // const char* before C++20, encoded as UTF-8, // const char8_t* in C++20 auto R2 = LR&quot;(&quot;Hello \\ world&quot;)&quot;; // const wchar_t* auto R3 = uR&quot;(&quot;Hello \\ world&quot;)&quot;; // const char16_t*, encoded as UTF-16 auto R4 = UR&quot;(&quot;Hello \\ world&quot;)&quot;; // const char32_t*, encoded as UTF-32&#125; 3. å­—ç¬¦ä¸²åç¼€å­—ç¬¦ä¸²åç¼€å°±æ˜¯åœ¨å­—ç¬¦ä¸²åé¢åŠ sï¼Œå¦‚ï¼š 1234567891011121314auto S0 = &quot;hello&quot;s; // std::stringauto S1 = u8&quot;hello&quot;s; // std::string before C++20, std::u8string in C++20auto S2 = L&quot;hello&quot;s; // std::wstringauto S3 = u&quot;hello&quot;s; // std::u16stringauto S4 = U&quot;hello&quot;s; // std::u32stringstd::string_view sv = &quot;abc\\0\\0def&quot;sv;// å’ŒåŸå§‹å­—ç¬¦ä¸²ä¸€èµ·ä½¿ç”¨auto S5 = R&quot;(&quot;Hello \\ world&quot;)&quot;s; // std::string from a raw const char*auto S6 = u8R&quot;(&quot;Hello \\ world&quot;)&quot;s; // std::string from a raw const char* before C++20, encoded as UTF-8, // std::u8string in C++20auto S7 = LR&quot;(&quot;Hello \\ world&quot;)&quot;s; // std::wstring from a raw const wchar_t*auto S8 = uR&quot;(&quot;Hello \\ world&quot;)&quot;s; // std::u16string from a raw const char16_t*, encoded as UTF-16auto S9 = UR&quot;(&quot;Hello \\ world&quot;)&quot;s; // std::u32string from a raw const char32_t*, encoded as UTF-32 å’Œä¸åŠ åç¼€çš„åŒºåˆ«å¦‚ä¸‹ï¼š 12345678910111213141516171819202122#include &lt;iostream&gt;#include &lt;string&gt;void print_with_zeros(auto const note, std::string const&amp; s)&#123; std::cout &lt;&lt; note; for (const char c : s) c ? std::cout &lt;&lt; c : std::cout &lt;&lt; &quot;â‚€&quot;; std::cout &lt;&lt; &quot; (size = &quot; &lt;&lt; s.size() &lt;&lt; &quot;) &quot;;&#125;int main()&#123; using namespace std::string_literals; std::string s1 = &quot;abc\\0\\0def&quot;; std::string s2 = &quot;abc\\0\\0def&quot;s; print_with_zeros(&quot;s1: &quot;, s1); print_with_zeros(&quot;s2: &quot;, s2); std::cout &lt;&lt; &quot;abcdef&quot;s.substr(1,4) &lt;&lt; &#x27; &#x27;;&#125; è¾“å‡ºï¼š 123s1: abc (size = 3)s2: abcâ‚€â‚€def (size = 8)bcde 4. è‡ªå®šä¹‰å­—ç¬¦ä¸²åç¼€å­—ç¬¦ä¸²åç¼€æ˜¯é€šè¿‡æ“ä½œç¬¦çš„é‡è½½å®ç°çš„ï¼š 1std::string operator&quot;&quot;s( const char *str, std::size_t len ); æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ“ä½œç¬¦çš„é‡è½½æ¥å®ç°å…¶ä»–çš„å­—ç¬¦ä¸²åç¼€ï¼Œè‡ªå®šä¹‰çš„åç¼€å»ºè®®ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œå¦åˆ™ä¼šäº§ç”Ÿç¼–è¯‘è­¦å‘Šï¼š 1warning C4455: â€œoperator &quot;&quot;mmâ€: å·²ä¿ç•™ä¸ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡æœ¬åç¼€æ ‡è¯†ç¬¦ ä¸‹é¢è‡ªå®šä¹‰_mmã€_mã€_kmåç¼€åˆ†åˆ«è¡¨ç¤ºæ¯«ç±³ã€ç±³ã€åƒç±³ï¼š 1234567891011121314151617181920long double operator&quot;&quot; _mm(long double x) &#123; return x / 1000;&#125;long double operator&quot;&quot; _m(long double x) &#123; return x;&#125;long double operator&quot;&quot; _km(long double x) &#123; return x * 1000;&#125;int main()&#123; std::cout &lt;&lt; 1.0_mm &lt;&lt; std::endl; // 0.001 std::cout &lt;&lt; 1.0_m &lt;&lt; std::endl; // 1 std::cout &lt;&lt; 1.0_km &lt;&lt; std::endl; // 1000 return 0;&#125;","tags":["C++","å­—ç¬¦ä¸²"],"categories":["C++è¯­è¨€"]},{"title":"CentOS7ç”³è¯·å…è´¹LetsEncryptè¯ä¹¦å¹¶ç»­æœŸ","path":"/post/2025031576.html","content":"æœ¬æ–‡ä»‹ç»åœ¨ CentOS7 ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ Certbot ç”³è¯·å…è´¹çš„ Lets Encrypt SSL è¯ä¹¦ï¼Œå¹¶è‡ªåŠ¨ç»­æœŸã€‚ 1. ç¯å¢ƒå‡†å¤‡å®‰è£… Python3ï¼š 1yum install python3 å®‰è£… Certbot å’Œ Python è™šæ‹Ÿç¯å¢ƒï¼š 123456789# å‡è®¾certbotå®‰è£…åˆ°/root/certbotmkdir -p /root/certbotcd /root/certbotpython3 -m venv venvsource venv/bin/activate# å‡çº§pippip install --upgrade pip é˜¿é‡Œäº‘æ³¨å†Œå¹¶è§£æçš„åŸŸåï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 12# å®‰è£…certbotpip install certbot certbot-nginx certbot-dns-aliyun -i https://pypi.tuna.tsinghua.edu.cn/simple 2. é˜¿é‡Œäº‘å­è´¦å·åˆ›å»ºé˜¿é‡Œäº‘å­è´¦å·ï¼ˆhttps://ram.console.aliyun.comï¼‰ï¼Œå¹¶åˆ†é… AliyunDNSFullAccess æƒé™ã€‚ ä¸ºå­è´¦å·ç”Ÿæˆ access_key å’Œ access_secretã€‚ åˆ›å»º/root/certbot/aliyun.iniæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12dns_aliyun_access_key = XXXXXdns_aliyun_access_key_secret = XXXXX ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¿®æ”¹è¯¥æ–‡ä»¶æƒé™ï¼š 1chmod 600 /root/certbot/aliyun.ini 3. ç”³è¯·è¯ä¹¦ä»¥ç”³è¯· mytools123.com è¯ä¹¦ä¸ºä¾‹ï¼š 12345/root/certbot/venv/bin/certbot certonly \\-a dns-aliyun \\--dns-aliyun-credentials /root/certbot/aliyun.ini \\-d mytools123.com \\-d &quot;*.mytools123.com&quot; æ‰§è¡ŒæˆåŠŸåï¼Œç”Ÿæˆçš„è¯ä¹¦ä½äº/etc/letsencrypt/live/mytools123.comç›®å½• 4. æ‰‹åŠ¨ç»­æœŸLets Encrypt çš„è¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ 3 ä¸ªæœˆï¼Œåˆ°æœŸåéœ€è¦æ‰‹åŠ¨ç»­æœŸã€‚ 12345# --dry-run çš„æ˜¯æ¨¡æ‹Ÿæ›´æ–°è¯ä¹¦/root/certbot/venv/bin/certbot renew -a dns-aliyun --dns-aliyun-credentials /root/certbot/aliyun.ini --dry-run# æ­£å¼æ›´æ–°è¯ä¹¦/root/certbot/venv/bin/certbot renew -a dns-aliyun --dns-aliyun-credentials /root/certbot/aliyun.ini 5. è‡ªåŠ¨ç»­æœŸå¯ä»¥åˆ›å»ºå®šæ—¶ç»­æœŸè„šæœ¬ï¼Œæ¥å®ç°è‡ªåŠ¨ç»­æœŸã€‚ åˆ›å»ºè„šæœ¬æ–‡ä»¶/root/renew_cert.shï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12# æ›´æ–°è¯ä¹¦/root/certbot/venv/bin/certbot renew -a dns-aliyun --dns-aliyun-credentials /root/certbot/aliyun.ini ä¸º sh æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š 1chmod +x /root/renew_cert.sh æ–°å»ºå®šæ—¶ä»»åŠ¡ï¼š 1crontab -e æ–°å¢å¦‚ä¸‹å†…å®¹ï¼š 10 0,12 * * * python -c &#x27;import random; import time; time.sleep(random.random() * 3600)&#x27; &amp;&amp; /root/renew_cert.sh","tags":["CentOS","LetsEncrypt","SSL"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"Vcpkgè®¿é—®Githubç§æœ‰ä»“åº“","path":"/post/1904533666.html","content":"Vcpkg é»˜è®¤åªæ”¯æŒä»å…¬å…±ä»£ç ä»“åº“è¿›è¡Œä¸‹è½½ç¼–è¯‘ï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Vcpkg ä»ç§æœ‰ä»“åº“è¿›è¡Œæºç ä¸‹è½½&#x2F;ç¼–è¯‘&#x2F;å®‰è£…ã€‚ 1.åœ¨ Github ä¸­æ·»åŠ  TOKEN 2. æ·»åŠ  Windows ç¯å¢ƒå˜é‡ï¼šVCPKG_KEEP_ENV_VARSå€¼ä¸ºGITHUB_TOKEN GITHUB_TOKENå€¼ä¸ºç¬¬ä¸€æ­¥ç”Ÿæˆçš„ TOKEN 3.ä¿®æ”¹ portfile.cmakeåœ¨vcpkg\\portsç›®å½•ä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”åº“çš„ portfile.cmake æ–‡ä»¶ï¼ŒåŠ å…¥AUTHORIZATION_TOKENå‚æ•°ã€‚ 123456vcpkg_from_github( OUT_SOURCE_PATH SOURCE_PATH REPO xxx/xxx HEAD_REF main AUTHORIZATION_TOKEN $ENV&#123;GITHUB_TOKEN&#125;)","tags":["CMake","Vcpkg","Github"],"categories":["CMake"]},{"title":"Windowså®ç°æ–‡ä»¶å¼ºåˆ¶å ç”¨","path":"/post/434128163.html","content":"æœ¬æ–‡ä»‹ç»åœ¨ Windows ç³»ç»Ÿä¸Šå®ç°ä½¿æŸä¸ªæ–‡ä»¶æ— æ³•è¢«ç”¨æˆ·æˆ–å…¶ä»–ç¨‹åºåˆ é™¤ã€‚ å®ç°çš„åŸç†å¤§è‡´å¦‚ä¸‹ï¼š é€šè¿‡DuplicateHandleæ‹·è´æ–‡ä»¶å¥æŸ„ç»™å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¸€èˆ¬æ˜¯ç³»ç»Ÿè¿›ç¨‹ï¼‰ï¼Œå› ä¸ºç³»ç»Ÿè¿›ç¨‹ä¸ä¼šè¢«å…³é—­ï¼Œæ‰€ä»¥è¾¾åˆ°äº†å ç”¨æŸä¸ªæ–‡ä»¶ï¼Œä¸è®©å…¶ä»–è¿›ç¨‹åˆ é™¤ã€è¯»å–ã€å†™å…¥ç­‰ã€‚ DuplicateHandleçš„ç”¨æ³•å‚è€ƒï¼š- Windowså†…æ ¸å¯¹è±¡ å› ä¸ºéœ€è¦æ‹·è´æ–‡ä»¶å¥æŸ„ç»™ç³»ç»Ÿè¿›ç¨‹ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°æ‰“å¼€ç³»ç»Ÿè¿›ç¨‹ï¼Œå¯èƒ½éœ€è¦ææƒæ“ä½œï¼Œä¸€èˆ¬æˆæƒç»™è¿›ç¨‹SE_DEBUG_NAMEæƒé™å³å¯ã€‚ å®ç°ä¸€ä¸ªç”¨äºé”ä½æ–‡ä»¶çš„å‡½æ•°LockFileï¼Œå°†æ–‡ä»¶å¥æŸ„å¤åˆ¶ç»™ç³»ç»Ÿcsrss.exeè¿›ç¨‹ï¼Œå‡½æ•°å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758bool LockFile(LPCTSTR lpFilePath) &#123; if (lpFilePath == NULL) return false; // æŸ¥æ‰¾è¿›ç¨‹csrss.exe // DWORD dwCsrssProcessID = 0; PROCESSENTRY32 pe; pe.dwSize = sizeof(PROCESSENTRY32); HANDLE hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0); while (Process32Next(hSnapShot, &amp;pe)) &#123; if (lstrcmpi(pe.szExeFile, TEXT(&quot;csrss.exe&quot;)) == 0) &#123; dwCsrssProcessID = pe.th32ProcessID; break; &#125; &#125; CloseHandle(hSnapShot); // æœªæ‰¾åˆ° if (dwCsrssProcessID == 0) &#123; return false; &#125; HANDLE hProcess = OpenProcess(PROCESS_DUP_HANDLE, FALSE, dwCsrssProcessID); // æ‰“å¼€å¤±è´¥ï¼Œå¯èƒ½æ˜¯å½“å‰è¿›ç¨‹æœªææƒå¯¼è‡´ï¼Œéœ€è¦æå‰è¿›è¡Œææƒæ“ä½œ if (hProcess == NULL) &#123; return false; &#125; HANDLE hFile = CreateFile(lpFilePath, GENERIC_READ | GENERIC_EXECUTE | GENERIC_WRITE, 0, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); if (hFile == INVALID_HANDLE_VALUE) &#123; CloseHandle(hProcess); return false; &#125; HANDLE hTargetHandle = INVALID_HANDLE_VALUE; BOOL bRet = DuplicateHandle(GetCurrentProcess(), hFile, hProcess, &amp;hTargetHandle, 0, FALSE, DUPLICATE_SAME_ACCESS | DUPLICATE_CLOSE_SOURCE ); CloseHandle(hProcess); return (bRet == TRUE);&#125;","tags":["å¥æŸ„"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Vcpkgå®‰è£…portå†å²ç‰ˆæœ¬","path":"/post/1142527271.html","content":"æˆªè‡³ 2023-05-22ï¼švcpkg ä»…æ”¯æŒåœ¨ manifest æ¨¡å¼ä¸‹æŒ‡å®š port çš„ç‰ˆæœ¬ï¼Œåœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ä¸æ”¯æŒæŒ‡å®š port ç‰ˆæœ¬ã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Vcpkg å‘½ä»¤è¡Œæ¨¡å¼ä¸‹å®‰è£… port æ—¶å¦‚ä½•æŒ‡å®šç‰ˆæœ¬ã€‚ ä½¿ç”¨ Git å‘½ä»¤æŸ¥çœ‹å½“å‰ Vcpkg ä»“åº“çš„ baselineï¼š 1git rev-parse HEAD åˆ›å»ºvcpkg_jsonç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºvcpkg.jsonæ–‡ä»¶ï¼ˆä»¥ openssl ä¸ºä¾‹ï¼‰ï¼š 1234567891011&#123; &quot;name&quot;: &quot;cc&quot;, &quot;version&quot;: &quot;1.0.1&quot;, &quot;builtin-baseline&quot;: &quot;7b30311f0a79d395bf2d933d82fec1853c6a4e77&quot;, &quot;dependencies&quot;: [ &#123;&quot;name&quot;: &quot;openssl&quot;&#125; ], &quot;overrides&quot;: [ &#123; &quot;name&quot;: &quot;openssl&quot;, &quot;version-string&quot;: &quot;1.1.1n#1&quot; &#125; ]&#125; ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ï¼š 1vcpkg install --triplet &quot;x64-windows&quot; &quot;--x-manifest-root=D:\\vcpkg_json\\\\&quot; &quot;--x-install-root=D:CODE\\vcpkg\\installed\\\\&quot;","tags":["CMake","Vcpkg"],"categories":["CMake"]},{"title":"CentOS7æ›´æ–°å›½å†…é˜¿é‡Œæº","path":"/post/1822204079.html","content":"ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1yum install -y wget 12345# å¤‡ä»½å¹¶ä¸‹è½½é˜¿é‡Œäº‘çš„baseå’Œepelæºmv -f /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backupwget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repomv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.backupwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo 123yum clean allyum makecacheyum -y update","tags":["CentOS"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"CMakeä¾èµ–åº“æŸ¥æ‰¾ç›¸å…³é—®é¢˜","path":"/post/2291877732.html","content":"1. å¦‚ä½•æŸ¥æ‰¾ Vcpkg å®‰è£…çš„ä¾èµ–åº“åœ¨ CMake å·¥å…·ä¸­æŒ‡å®šè·¨å¹³å°å·¥å…·é“¾ï¼Œå¦‚å›¾ï¼š æŒ‡å®š Toolchain æ–‡ä»¶D:/sourcecode/vcpkg/scripts/buildsystems/vcpkg.cmakeã€‚ 2. å¦‚ä½•æŸ¥æ‰¾æœ¬æœºå®‰è£…çš„ Qt åº“è®¾ç½®ç¯å¢ƒå˜é‡CMAKE_PREFIX_PATHï¼Œå€¼ä¸º Qt çš„å®‰è£…ç›®å½•ï¼Œå¦‚C:\\Qt\\5.15.2\\msvc2019ï¼Œç„¶åå¯åŠ¨ CMake å³å¯ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ‰¹å¤„ç†æ¥ä¸´æ—¶è®¾ç½®å’Œå¯åŠ¨ï¼š 123@echo offset CMAKE_PREFIX_PATH=C:\\Qt\\5.15.2\\msvc2019start &quot;&quot; &quot;C:\\Program Files\\CMake\\bin\\cmake-gui.exe&quot;","tags":["CMake","Vcpkg"],"categories":["CMake"]},{"title":"NPMå’ŒYarnè®¾ç½®å›½å†…æº","path":"/post/908211703.html","content":"æ·˜å®é•œåƒæºçš„åŸŸåå·²ç”±ä¹‹å‰çš„npm.taobao.orgå˜æ›´ä¸ºnpmmirror.comï¼Œè§é˜¿é‡Œäº‘å…¬å‘Šã€‚ç›®å‰è€åŸŸåï¼ˆnpm.taobao.orgï¼‰çš„è¯ä¹¦å·²è¿‡æœŸï¼Œè‹¥ç»§ç»­ä½¿ç”¨è€åŸŸåä¼šå‡ºç°certificate has expiredçš„é”™è¯¯æç¤ºã€‚ 1. Yarn è®¾ç½®æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š 1yarn config get registry å…¨å±€ä¿®æ”¹ï¼š 12345678yarn config set registry https://registry.npmmirror.com -gyarn config set disturl https://npmmirror.com/dist -gyarn config set electron_mirror https://npmmirror.com/mirrors/electron/ -gyarn config set sass_binary_site https://npmmirror.com/mirrors/node-sass/ -gyarn config set phantomjs_cdnurl https://npmmirror.com/mirrors/phantomjs/ -gyarn config set chromedriver_cdnurl https://cdn.npmmirror.com/dist/chromedriver -gyarn config set operadriver_cdnurl https://cdn.npmmirror.com/dist/operadriver -gyarn config set fse_binary_host_mirror https://npmmirror.com/mirrors/fsevents -g ä¸´æ—¶ä¿®æ”¹ï¼š 1yarn save è½¯ä»¶å --registry https://registry.npmmirror.com/ 2. NPM è®¾ç½®æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„é•œåƒæºï¼š 1npm get registry å…¨å±€è®¾ç½®ï¼š 12345npm config set registry https://registry.npmmirror.comnpm config set disturl https://npmmirror.com/distnpm config set electron_mirror https://npmmirror.com/mirrors/electron/npm config set sass_binary_site https://npmmirror.com/mirrors/node-sass/npm config set phantomjs_cdnurl https://npmmirror.com/mirrors/phantomjs/ npm v9 ç‰ˆæœ¬ä¼šæŠ¥é”™ï¼šELECTRON_MIRROR is not a valid npm optionã€‚éœ€è¦åˆ‡æ¢ä¸º npm v8 ç‰ˆæœ¬ï¼šnpm install -g npm@^8","tags":["Web","Yarn","NPM"],"categories":["Webç¼–ç¨‹"]},{"title":"LLVM-Obfuscatorä»£ç æ··æ·†","path":"/post/2256274631.html","content":"LLVM-Obfuscator å¯ç”¨äºæ··æ·†ç¨‹åºçš„ä»£ç é€»è¾‘ï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ LLVM-Obfuscator è¿›è¡Œä»£ç é€»è¾‘çš„æ··æ·†ã€‚ 1. å®‰è£… VS Clang ç»„ä»¶ 2. ç¼–è¯‘ LLVM-Obfuscatorä½¿ç”¨ heroims çš„ Fork ç‰ˆæœ¬ï¼šheroims&#x2F;obfuscator 2.1 Clone æœ€æ–° 13.x åˆ†æ”¯1git clone -b llvm-13.x https://github.com/obfuscator-llvm/obfuscator.git 2.2 å®‰è£… mingwä»https://github.com/niXman/mingw-builds-binaries/releases ä¸‹è½½ 32 ä½å’Œ 64 ä½ MingW: i686-12.2.0-release-posix-dwarf-msvcrt-rt_v10-rev2.7z x86_64-12.2.0-release-posix-seh-msvcrt-rt_v10-rev2.7z åˆ†åˆ«è§£å‹åˆ°ä¸åŒçš„ç›®å½•ã€‚ 2.3 ç¼–è¯‘ 64 ä½ LLVM-Obfuscatoræ‰“å¼€ CMDï¼Œå°† 64 ä½ MingW çš„ bin ç›®å½•æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡ï¼š 1SET PATH=%PATH%;C:\\mingw64\\x86_64-12.2.0-release-posix-seh-msvcrt-rt_v10-rev2\\bin åœ¨å‘½ä»¤è¡Œè¿›å…¥ LLVM-Obfuscator æ‰€åœ¨ç›®å½•ï¼Œå¼€å§‹ç¼–è¯‘ï¼š 123456mkdir build64cd build64cmake -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS=&quot;clang&quot; -DLLVM_CREATE_XCODE_TOOLCHAIN=ON -DLLVM_ENABLE_NEW_PASS_MANAGER=OFF -G &quot;MinGW Makefiles&quot; ../llvmmingw32-make.exe -j8 2.4 ç¼–è¯‘ 32 ä½ LLVM-Obfuscatoré‡æ–°æ‰“å¼€ CMDï¼Œå°† 32 ä½ MingW çš„ bin ç›®å½•æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡ï¼š 1SET PATH=%PATH%;C:\\mingw32\\i686-12.2.0-release-posix-dwarf-msvcrt-rt_v10-rev2\\bin åœ¨å‘½ä»¤è¡Œè¿›å…¥ LLVM-Obfuscator æ‰€åœ¨ç›®å½•ï¼Œå¼€å§‹ç¼–è¯‘ï¼š 1234mkdir build32cd build32cmake -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS=&quot;clang&quot; -DLLVM_CREATE_XCODE_TOOLCHAIN=ON -DLLVM_ENABLE_NEW_PASS_MANAGER=OFF -G &quot;MinGW Makefiles&quot; ../llvmmingw32-make.exe -j8 3. ç”¨ç¼–è¯‘è¾“å‡ºè¦†ç›–åˆ° VS ClangVisual Studio çš„ Clang ä½äºC:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\Llvmç›®å½•ï¼Œåˆ†åˆ«å°†ç¼–è¯‘çš„ 32 ä½å’Œ 64 ä½binç›®å½•ä¸­çš„æ–‡ä»¶è¦†ç›–åˆ° VS Clang çš„binç›®å½•ä¸­ï¼ˆæ³¨æ„ï¼šåœ¨è¦†ç›–ä¹‹å‰ï¼Œæœ€å¥½å…ˆå¤‡ä»½ï¼‰ã€‚ 4. è®¾ç½®ç¯å¢ƒå˜é‡åœ¨ç¼–è¯‘å®Œä¹‹åï¼Œå°† 32 ä½å’Œ 64 ä½ MingW çš„binç›®å½•è·¯å¾„éƒ½æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡ä¸­ã€‚å› ä¸º VS ç¼–è¯‘æ—¶ä¼šå¯åŠ¨ clang.exeï¼Œè€Œ clang.exe éœ€è¦ä¾èµ– MingWã€‚ 5. VS å·¥ç¨‹é…ç½® å‘½ä»¤è¡Œå…¶ä»–é€‰é¡¹å¦‚ä¸‹ï¼š 1-D__CUDACC__ -D_ALLOW_COMPILER_AND_STL_VERSION_MISMATCH -mllvm -bcf -mllvm -bcf_prob=73 -mllvm -bcf_loop=1 -mllvm -sub -mllvm -sub_loop=5 -mllvm -fla -mllvm -split_num=5 -mllvm -aesSeed=DEADBEEFDEADCODEDEADBEEFDEADCODE 6. æ··æ·†é…ç½®å‚æ•°å¼€å¯æ§åˆ¶æµæ‰å¹³åŒ–-mllvm -fla å¼€å¯æ§åˆ¶æµæ‰å¹³åŒ– -mllvm -split æ¿€æ´»åŸºæœ¬å—åˆ’åˆ†ã€‚ä¸€èµ·ä½¿ç”¨æ—¶èƒ½æé«˜æ‰“å¹³èƒ½åŠ›ã€‚ -mllvm -split_num=3 å¦‚æœæ¿€æ´»æ§åˆ¶æµæ‰“å¹³ï¼Œå¯¹æ¯ä¸€ä¸ªåŸºæœ¬å—åº”ç”¨ä¸‰æ¬¡æ§åˆ¶æµæ‰“å¹³ã€‚é»˜è®¤ä½¿ç”¨ 1 æ¬¡ã€‚ å¼€å¯æŒ‡ä»¤æ›¿æ¢-mllvm -sub å¼€å¯æŒ‡ä»¤æ›¿æ¢ -mllvm -sub_loop=3 å¦‚æœæ¿€æ´»äº†æŒ‡ä»¤æ›¿æ¢ï¼Œä½¿ç”¨è¿™ä¸ªé€‰é¡¹åœ¨ä¸€ä¸ªå‡½æ•°ä¸­åº”ç”¨ 3 æ¬¡æŒ‡ä»¤æ›¿æ¢ã€‚é»˜è®¤åº”ç”¨ 1 æ¬¡ã€‚ å¼€å¯è™šå‡æ§åˆ¶æµ-mllvm -bcf å¼€å¯è™šå‡æ§åˆ¶æµã€‚ bcfå¯ä»¥é…åˆä¸‹é¢å‚æ•°ä½¿ç”¨ï¼š -mllvm -bcf_loop=3 è®¾ç½®å‡½æ•°æ··æ·†æ¬¡æ•°ä¸º 3 æ¬¡ ä¸åŠ æ­¤é€‰é¡¹é»˜è®¤ä¸º 1 æ¬¡ã€‚ -mllvm -bcf_prob=40 è®¾ç½®ä»£ç å—è¢«æ··æ·†çš„æ¦‚ç‡æ˜¯ 40%ï¼Œé»˜è®¤ 30% 7. CMakeList ä¸­é…ç½®æ··æ·†å‚æ•°12345678910111213141516#debug and release all enableSET(CMAKE_CXX_FLAGS &quot;-mllvm -fla -mllvm -sub -mllvm -sobf &quot;)#soä½“ç§¯ä¼˜åŒ–ï¼Œï¼ˆæŒ‰éœ€å¼€å¯ï¼‰#SET(CMAKE_CXX_FLAGS_DEBUG &quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g2 -ggdb&quot;)#SET(CMAKE_CXX_FLAGS_RELEASE &quot;$ENV&#123;CXXFLAGS&#125; -Os -Wall -s&quot;)#è®¾ç½®llvm debugæ¨¡å¼æ··æ·†ç¼–è¯‘SET(CMAKE_C_FLAGS_DEBUG &quot;$&#123;CMAKE_C_FLAGS_DEBUG&#125; -mllvm -fla&quot;)SET(CMAKE_CXX_FLAGS_DEBUG &quot;$&#123;CMAKE_CXX_FLAGS_DEBUG&#125; -mllvm -fla&quot;)#è®¾ç½®llvm releaseæ¨¡å¼æ··æ·†ç¼–è¯‘SET(CMAKE_C_FLAGS_RELEASE &quot;$&#123;CMAKE_C_FLAGS_RELEASE&#125; -mllvm -fla -mllvm -sub -mllvm -bcf&quot;)SET(CMAKE_CXX_FLAGS_RELEASE &quot;$&#123;CMAKE_CXX_FLAGS_RELEASE&#125; -mllvm -fla -mllvm -sub -mllvm -bcf&quot;)SET(CMAKE_CXX_FLAGS_RELEASE &quot;$&#123;CMAKE_CXX_FLAGS_RELEASE&#125; -s -O3 -Wall -fvisibility=hidden -mllvm -fla&quot;)","tags":["C++","LLVM","æ··æ·†"],"categories":["C++è¯­è¨€"]},{"title":"ä¸€ä¸ªDockerfileåŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹","path":"/post/2409581593.html","content":"Docker å®¹å™¨çš„å“²å­¦æ˜¯ä¸€ä¸ª Docker å®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚ ä½†å¦‚æœéœ€è¦åœ¨ä¸€ä¸ªå®¹å™¨å†…è¿è¡Œå¤šä¸ªè¿›ç¨‹æˆ–æœåŠ¡ï¼Œå¯ä»¥é‡‡å–å°†å…¥å£æ–‡ä»¶è®¾ç½®ä¸º Bash Shell è„šæœ¬ï¼Œåœ¨è„šæœ¬å†…è¿è¡Œå¤šä¸ªç¨‹åºçš„æ–¹å¼ã€‚ 1234567891011#!/bin/bash# start 1start1 &gt; /var/log/start1.log 2&gt;&amp;1 &amp;# start 2start2 &gt; /var/log/start2.log 2&gt;&amp;1 &amp;# just keep this script runningwhile [[ true ]]; do sleep 1done åœ¨ Dockerfile çš„å…¥å£ä¸­è¿è¡Œ run.shï¼š 1234FROM ubuntu:latest...COPY ./run.sh /ENTRYPOINT [&quot;run.sh&quot;]","tags":["Docker"],"categories":["æœåŠ¡ç«¯å¼€å‘"]},{"title":"C++æ„é€ å‡½æ•°æ’é›·","path":"/post/3768553066.html","content":"ä¸€ã€é»˜è®¤æ„é€ å‡½æ•°1.1 ä»€ä¹ˆæ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼Ÿæˆ‘ä»¬ä¸€èˆ¬ä¼šè®¤ä¸ºé»˜è®¤æ„é€ å‡½æ•°å°±æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„é‚£ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶å®è¿™ç§ç†è§£ä¸å…¨é¢ã€‚å‡†ç¡®çš„è¯´ï¼Œé»˜è®¤æ„é€ å‡½æ•°å°±æ˜¯åœ¨è°ƒç”¨æ—¶ä¸éœ€è¦æ˜¾ç¤ºåœ°ä¼ å…¥å®å‚çš„æ„é€ å‡½æ•°ã€‚æ ¹æ®è¿™ä¸ªåŸåˆ™ï¼Œä¸‹é¢ 2 ç§æ„é€ å‡½æ•°éƒ½æ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼š 1234567class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•°ã€‚ Sample() &#123; // do something &#125;&#125;; 1234567class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•°ã€‚è™½ç„¶æœ‰å½¢å‚ï¼Œä½†æœ‰é»˜è®¤å€¼ï¼Œè°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¸æ˜¾ç¤ºçš„ä¼ å…¥å®å‚ã€‚ Sample(int m = 10) &#123; // do something &#125;&#125;; 1.2 é»˜è®¤æ„é€ å‡½æ•°è°ƒç”¨æ—¶æœºå¦‚æœå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ—¶æ²¡æœ‰ä½¿ç”¨åˆå§‹åŒ–å¼ï¼Œç¼–è¯‘å™¨å°±ä¼šä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚ï¼š 1Sample s; 1.3 ç¼–è¯‘å™¨ä½•æ—¶ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°æœ‰ä¸€å¥å¾ˆç»å…¸çš„è¯å¯ä»¥ç”¨æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼šæƒŸæœ‰é»˜è®¤æ„é€ å‡½æ•°â€è¢«ç¼–è¯‘å™¨éœ€è¦â€œçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨æ‰ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€‚ é‚£æˆ‘ä»¬åªéœ€çŸ¥é“ä»€ä¹ˆæ—¶å€™â€œè¢«ç¼–è¯‘å™¨éœ€è¦â€ï¼Œå°±å¯ä»¥çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°äº†ã€‚ä¸‹é¢å‡ ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘éœ€è¦ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼š å½“è¯¥ç±»çš„ç±»å¯¹è±¡æ•°æ®æˆå‘˜æœ‰é»˜è®¤æ„é€ å‡½æ•°æ—¶ã€‚ å½“è¯¥ç±»çš„åŸºç±»æœ‰é»˜è®¤æ„é€ å‡½æ•°æ—¶ã€‚ å½“è¯¥ç±»çš„åŸºç±»ä¸ºè™šåŸºç±»æ—¶ã€‚ å½“è¯¥ç±»æœ‰è™šå‡½æ•°æ—¶ã€‚ 1.4 æ³¨æ„äº‹é¡¹1. é¿å…â€œæ— å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°â€å’Œâ€œå¸¦ç¼ºçœå‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°â€åŒæ—¶å­˜åœ¨ æ— å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°å’Œå¸¦ç¼ºçœå‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°åŒæ—¶å­˜åœ¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”ŸäºŒä¹‰æ€§ï¼Œä»è€Œç”Ÿæˆç¼–è¯‘é”™è¯¯ã€‚ 12345678910111213141516171819202122class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•° Sample() &#123; // do something printf(&quot;Sample()&quot;); &#125; // é»˜è®¤æ„é€ å‡½æ•° Sample(int m = 10) &#123; // do something printf(&quot;Sample(int m = 10)&quot;); &#125;&#125;;int main()&#123; Sample s; // error C2668: â€œSample::Sampleâ€: å¯¹é‡è½½å‡½æ•°çš„è°ƒç”¨ä¸æ˜ç¡® return 0;&#125; 2. ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸åº”åœ¨å¯¹è±¡ååé¢åŠ ä¸Šæ‹¬å· ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸åº”åœ¨å¯¹è±¡ååé¢åŠ ä¸Šæ‹¬å·ï¼Œå¦åˆ™ä¼šäº§ç”Ÿç¼–è¯‘è­¦å‘Šâ€œwarning C4930: â€œSample s(void)â€: æœªè°ƒç”¨åŸå‹å‡½æ•°(æ˜¯å¦æ˜¯æœ‰æ„ç”¨å˜é‡å®šä¹‰çš„?)â€ã€‚å› ä¸ºç¼–è¯‘å™¨è¯¯è®¤ä¸ºSample s();è¯­å¥æ—¶è¦å£°æ˜è¿”å›å€¼ä¸ºSampleå¯¹è±¡çš„å‡½æ•°sï¼Œè€Œåˆæ²¡æ‰¾åˆ°å‡½æ•°sçš„å®šä¹‰ï¼Œæ‰€ä»¥äº§ç”Ÿäº†è­¦å‘Šã€‚ 12345678910111213141516class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•° Sample() &#123; // do something printf(&quot;Sample()&quot;); &#125;&#125;;int main()&#123; Sample s(); // warning C4930: â€œSample s(void)â€: æœªè°ƒç”¨åŸå‹å‡½æ•°(æ˜¯å¦æ˜¯æœ‰æ„ç”¨å˜é‡å®šä¹‰çš„?) return 0;&#125; äºŒã€æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨2.1 ä½•ä¸ºæ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨1234567891011121314class Sample &#123;public: // æ„é€ å‡½æ•°å†…éƒ¨èµ‹å€¼ Sample(int a) &#123; a_ = a; &#125; // æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ Sample(int a) : a_(a) &#123; &#125;private: int a_;&#125;; ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒSampleç±»çš„ 2 ä¸ªæ„é€ å‡½æ•°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆå§‹åŒ–æˆå‘˜å˜é‡a_ï¼ŒåŒºåˆ«åœ¨äºä¸€ä¸ªé‡‡ç”¨çš„æ˜¯æ„é€ å‡½æ•°å†…éƒ¨èµ‹å€¼çš„æ–¹å¼æ¥åˆå§‹åŒ–çš„ï¼Œå¦ä¸€ä¸ªé‡‡ç”¨çš„æ˜¯æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨åˆå§‹åŒ–åˆ—è¡¨çš„æ–¹å¼æ¥åˆå§‹åŒ–çš„ã€‚ 2.1 ä½•æ—¶å¿…é¡»ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å¦‚æœæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„ï¼Œæ—¢ç„¶ 2 ç§åˆå§‹åŒ–æˆå‘˜å˜é‡çš„æ–¹å¼æ‰€èµ·å¾—ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆåœ¨å“ªäº›æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨çš„äº†ï¼Ÿä¸‹é¢ 2 ç§æƒ…å†µçš„æˆå‘˜å˜é‡å¿…é¡»ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨çš„æ–¹å¼æ¥åˆå§‹åŒ–ï¼š æˆå‘˜å˜é‡æ˜¯ const å¸¸é‡ã€‚ æˆå‘˜å˜é‡æ˜¯å¼•ç”¨ç±»å‹ã€‚ ä¸‹é¢ä¾‹å­æ¼”ç¤ºäº†æˆå‘˜å˜é‡æ˜¯constå¸¸é‡å’Œå¼•ç”¨ç±»å‹æ—¶ï¼Œå¦‚ä½•åˆå§‹åŒ–å®ƒä»¬ï¼š 123456789class Sample &#123;public: Sample() : kCount(11), name_(std::string(&quot;jeff&quot;)) &#123; &#125;private: std::string &amp;name_; const int kCount;&#125;; 2.3 åˆå§‹åŒ–åˆ—è¡¨çš„é¡ºåºé—®é¢˜ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨è¿›è¡Œæˆå‘˜å˜é‡åˆå§‹åŒ–æ—¶ï¼Œè¦æ³¨æ„æˆå‘˜å˜é‡çš„åˆå§‹åŒ–é¡ºåºã€‚ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼Œç°æœ‰ç±»SeqSampleæœ‰ 3 ä¸ªæˆå‘˜å˜é‡a_, b_, c_ï¼Œæ„é€ å‡½æ•°è¢«è®¾è®¡ä¸ºå°†a_, b_, c_éƒ½åˆå§‹åŒ–ä¸ºmï¼Œä¹Ÿå°±æ˜¯a_ == b_ == c_ == mï¼š 123456789101112131415161718192021class SeqSample &#123;public: SeqSample(int m) : a_(m), b_(a_), c_(b_) &#123; &#125;private: int b_; int a_; int c_;&#125;;int main()&#123; SeqSample ss(1); return 0;&#125; é€šè¿‡è°ƒè¯•å™¨è§‚å¯Ÿåˆ°æ‰§è¡Œæ„é€ å‡½æ•°åˆå§‹åŒ–ä¹‹åï¼Œæˆå‘˜å˜é‡a_, b_, c_çš„å€¼åˆ†åˆ«ä¸ºï¼š 123b_ = -858993460a_ = 1c_ = -858993460 è€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„a_ = 1 b_ = 1 c_ = 1ã€‚ å‡ºç°è¿™ç§é—®é¢˜çš„åŸå› åœ¨äºï¼šç¼–è¯‘å™¨å¯¹æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å˜é‡è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¸æ˜¯æŒ‰ç…§å˜é‡åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„é¡ºåºæ¥è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œè€Œæ˜¯æŒ‰ç…§å˜é‡åœ¨ç±»ä¸­çš„å£°æ˜é¡ºåºæ¥åˆå§‹åŒ–çš„ã€‚ æ‰€ä»¥ï¼Œåœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­çš„å˜é‡æœ‰ä¾èµ–å…³ç³»æ—¶ï¼ˆå¦‚ä¸Šé¢çš„b_ä¾èµ–äºa_çš„åˆå§‹åŒ–ç»“æœï¼‰ï¼Œè¦ç‰¹åˆ«æ³¨æ„è¿™ç§æƒ…å†µã€‚ 2.4 åˆå§‹åŒ–åˆ—è¡¨çš„å¦ä¸€ä¸ªå¥½å¤„å…ˆæ¨¡ç³Šçš„æŠŠè¿™ä¸ªå¥½å¤„è¯´å‡ºæ¥ï¼Œä¸å¤ªæ˜ç™½çš„ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼šè‹¥æˆå‘˜å˜é‡æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨å¯ä»¥å‡å°‘ä¸€æ¬¡é»˜è®¤æ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼ˆå£°æ˜äº†ä¸€ä¸ªAppleç±»ï¼Œä¸€ä¸ªTestç±»ï¼ŒTest ç±»ä¸­æœ‰ 2 ä¸ª Apple å¯¹è±¡apple1_, apple2_ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œapple1_é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ï¼Œapple2_é€šè¿‡å‡½æ•°ä½“ä¸­çš„èµ‹å€¼è¯­å¥æ¥åˆå§‹åŒ–ï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334class Apple &#123;public: Apple() &#123; printf(&quot;é»˜è®¤æ„é€ å‡½æ•° &quot;); &#125; Apple(const Apple &amp;that) &#123; printf(&quot;å¤åˆ¶æ„é€ å‡½æ•° &quot;); &#125; Apple&amp; operator = (const Apple&amp;that) &#123; printf(&quot;èµ‹å€¼è¿ç®—ç¬¦é‡è½½ &quot;); return *this; &#125;&#125;;class Test &#123;public: Test(const Apple &amp;apple) : apple1_(apple) &#123; apple2_ = apple; &#125;private: Apple apple1_; Apple apple2_;&#125;;int main()&#123; Apple apple; Test t(apple); return 0;&#125; è¿è¡Œç»“æœï¼š 1234é»˜è®¤æ„é€ å‡½æ•°å¤åˆ¶æ„é€ å‡½æ•°é»˜è®¤æ„é€ å‡½æ•°èµ‹å€¼è¿ç®—ç¬¦é‡è½½ 4 è¡Œè¾“å‡ºåˆ†åˆ«ç”±ä¸åŒçš„è¯­å¥äº§ç”Ÿï¼Œå¦‚å›¾ï¼š apple1_(apple)ç›´æ¥æ‰§è¡Œçš„å¤åˆ¶æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥åªäº§ç”Ÿä¸€è¡Œè¾“å‡ºï¼›è€Œapple2_ = apple;å´æ˜¯å…ˆä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°æ„é€ äº†ä¸€ä¸ª apple2å¯¹è±¡ï¼Œç„¶åå†é€šè¿‡èµ‹å€¼è¿ç®—ç¬¦å°† apple çš„å†…å®¹æ›´æ–°åˆ° apple2ä¸­ï¼Œæ‰€ä»¥äº§ç”Ÿäº† 2 è¡Œè¾“å‡ºã€‚ 2.5 æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨çš„å¼‚å¸¸æ•è·æ„é€ çš„å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨å¼‚å¸¸æ•è·ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 12345678910111213class Foo &#123;public: Foo::Foo(int n) try :size(n), array(new int[n]) &#123; //... &#125; catch (const std::bad_alloc&amp; e) &#123; printf(&quot;%s &quot;, e.what()); &#125;private: int size; int *array;&#125;;","tags":["C++","æ„é€ å‡½æ•°"],"categories":["C++è¯­è¨€"]},{"title":"C++ç”Ÿæˆæ¡å½¢ç ","path":"/post/3756556672.html","content":"æ¡å½¢ç (barcode)æ˜¯å°†å®½åº¦ä¸ç­‰çš„å¤šä¸ªé»‘æ¡å’Œç©ºç™½ï¼ŒæŒ‰ç…§ä¸€å®šçš„ç¼–ç è§„åˆ™æ’åˆ—ï¼Œç”¨ä»¥è¡¨è¾¾ä¸€ç»„ä¿¡æ¯çš„å›¾å½¢æ ‡è¯†ç¬¦ã€‚å¸¸è§çš„æ¡å½¢ç æ˜¯ç”±åå°„ç‡ç›¸å·®å¾ˆå¤§çš„é»‘æ¡ï¼ˆç®€ç§°æ¡ï¼‰å’Œç™½æ¡ï¼ˆç®€ç§°ç©ºï¼‰æ’æˆçš„å¹³è¡Œçº¿å›¾æ¡ˆã€‚ ä¸€ã€æ¡å½¢ç ä»‹ç»æ¡ç ç§ç±»å¾ˆå¤šï¼Œå¸¸è§çš„å¤§æ¦‚æœ‰äºŒåå¤šç§ç åˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šCode39 ç ï¼ˆæ ‡å‡† 39 ç ï¼‰ã€Codabar ç ï¼ˆåº“å¾·å·´ç ï¼‰ã€Code25 ç ï¼ˆæ ‡å‡† 25 ç ï¼‰ã€ITF25 ç ï¼ˆäº¤å‰ 25 ç ï¼‰ã€Matrix25 ç ï¼ˆçŸ©é˜µ 25 ç ï¼‰ã€UPC-A ç ã€UPC-E ç ã€EAN-13 ç ï¼ˆEAN-13 å›½é™…å•†å“æ¡ç ï¼‰ã€EAN-8 ç ï¼ˆEAN-8 å›½é™…å•†å“æ¡ç ï¼‰ã€ä¸­å›½é‚®æ”¿ç ï¼ˆçŸ©é˜µ 25 ç çš„ä¸€ç§å˜ä½“ï¼‰ã€Code-B ç ã€MSI ç ã€Code11 ç ã€Code93 ç ã€ISBN ç ã€ISSN ç ã€Code128 ç ï¼ˆCode128 ç ï¼ŒåŒ…æ‹¬ EAN128 ç ï¼‰ã€Code39EMSï¼ˆEMS ä¸“ç”¨çš„ 39 ç ï¼‰ç­‰ä¸€ç»´æ¡ç å’Œ PDF417 ç­‰äºŒç»´æ¡ç ã€‚ ç›®å‰ï¼Œå›½é™…å¹¿æ³›ä½¿ç”¨çš„æ¡ç ç§ç±»æœ‰ï¼š EAN ç  â€”â€” å›½é™…ç‰©å“ç¼–ç åä¼šåˆ¶å®šçš„ä¸€ç§å•†å“ç”¨æ¡ç ï¼Œé€šç”¨äºå…¨ä¸–ç•Œã€‚EAN ç ç¬¦å·æœ‰æ ‡å‡†ç‰ˆï¼ˆEAN-13ï¼‰å’Œç¼©çŸ­ç‰ˆï¼ˆEAN-8ï¼‰ä¸¤ç§ï¼Œæˆ‘å›½çš„é€šç”¨å•†å“æ¡ç ä¸å…¶ç­‰æ•ˆï¼Œæ—¥å¸¸è´­ä¹°çš„å•†å“åŒ…è£…ä¸Šæ‰€å°çš„æ¡ç ä¸€èˆ¬å°±æ˜¯ EAN ç ã€‚ UPC ç  â€”â€” UPC ç æ˜¯ç¾å›½ç»Ÿä¸€ä»£ç å§”å‘˜ä¼šåˆ¶å®šçš„ä¸€ç§å•†å“ç”¨æ¡ç ï¼Œä¸»è¦ç”¨äºç¾å›½å’ŒåŠ æ‹¿å¤§åœ°åŒºï¼Œæˆ‘ä»¬åœ¨ç¾å›½è¿›å£çš„å•†å“ä¸Šå¯ä»¥çœ‹åˆ°ã€‚ Code39 ç  â€”â€” å› å…¶å¯é‡‡ç”¨æ•°å­—ä¸å­—æ¯å…±åŒç»„æˆçš„æ–¹å¼è€Œåœ¨å„è¡Œä¸šå†…éƒ¨ç®¡ç†ä¸Šè¢«å¹¿æ³›ä½¿ç”¨ã€‚ Code93 ç  â€”â€” Code 93 ç ä¸ 39 ç å…·æœ‰ç›¸åŒçš„å­—ç¬¦é›†ï¼Œä½†å®ƒçš„å¯†åº¦è¦æ¯” 39 ç é«˜ï¼Œæ‰€ä»¥åœ¨é¢ç§¯ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨ 93 ç ä»£æ›¿ 39 ç  Codebar ç  â€”â€” å¯è¡¨ç¤ºæ•°å­— 0 - 9ï¼Œå­—ç¬¦$ã€+ã€ -ã€è¿˜æœ‰åªèƒ½ç”¨ä½œèµ·å§‹&#x2F;ç»ˆæ­¢ç¬¦çš„ a,b,c d å››ä¸ªå­—ç¬¦ï¼Œå¯å˜é•¿åº¦ï¼Œæ²¡æœ‰æ ¡éªŒä½ï¼Œå¤šç”¨äºè¡€åº“,å›¾ä¹¦é¦†å’Œç…§åƒé¦†çš„ä¸šåŠ¡ä¸­ã€‚ Code128 ç  â€”â€” 128 å¯è¡¨ç¤º ASCII 0 åˆ° ASCII 127 å…±è®¡ 128 ä¸ª ASCII å­—ç¬¦ã€‚ CodeI2of5 ç  â€”â€” åªèƒ½è¡¨ç¤ºæ•°å­— 0 -9 å¯å˜é•¿åº¦ï¼Œè¿ç»­æ€§æ¡å½¢ç ï¼Œæ‰€æœ‰æ¡ä¸ç©ºéƒ½è¡¨ç¤ºä»£ç ï¼Œç¬¬ä¸€ä¸ªæ•°å­—ç”±æ¡å¼€å§‹ï¼Œç¬¬äºŒä¸ªæ•°å­—ç”±ç©ºç»„æˆï¼Œç©ºç™½åŒºæ¯”çª„æ¡å®½ 10 å€ï¼Œåº”ç”¨äºå•†å“æ‰¹å‘ã€ä»“åº“ã€æœºåœºã€ç”Ÿäº§&#x2F;åŒ…è£…è¯†åˆ«ã€å·¥ä¸šä¸­ï¼Œæ¡å½¢ç çš„è¯†è¯»ç‡é«˜ï¼Œå¯é€‚ç”¨äºå›ºå®šæ‰«æå™¨å¯é æ‰«æï¼Œåœ¨æ‰€æœ‰ä¸€ç»´æ¡å½¢ç ä¸­çš„å¯†åº¦æœ€é«˜ã€‚ äºŒã€C++æ–¹å¼å®ç°barcode.h ä¸­å®ç°äº† Code39ã€Code93ã€Code128ã€CodeI2of5 ç­‰ 4 ç§æ ¼å¼çš„æ¡å½¢ç çš„ç”Ÿæˆã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•ï¼šè°ƒç”¨å¯¹åº”ç±»çš„DrawBarcodeå‡½æ•°å°†æ¡å½¢ç ç»˜åˆ¶åˆ° HDC ä¸Šï¼Œç»˜åˆ¶åˆ° HDC ä¸Šä¹‹åå¯ä»¥ä¿å­˜ä¸ºå›¾ç‰‡æˆ–è€…æ˜¾ç¤ºåˆ°ç•Œé¢ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230123112321233123412351236123712381239124012411242#ifndef BARCODE_H_#define BARCODE_H_#pragma onceclass Barcode39;class Barcode93;class BarcodeIof5;class Barcode128;static const int ga2_Code128[2][207] =&#123; &#123; 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, &#125;, &#123; -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, &#125;,&#125;;class BarcodeBase &#123;public: BarcodeBase() &#123; Clear(); i_Ratio = 3; &#125; void operator=(const BarcodeBase&amp;bc) &#123; i_LenBuf = bc.i_LenBuf; i_Ratio = bc.i_Ratio; memcpy(ia_Buf, bc.ia_Buf, sizeof(ia_Buf)); &#125; void Clear() &#123; memset(ia_Buf, 0, sizeof(ia_Buf)); i_LenBuf = 0; &#125; int GetEncodeLength() const &#123; BYTE*pb = (BYTE*)ia_Buf; int i, iLen = 0; for (i = 0; i &lt; i_LenBuf; i++) &#123; //wide is 3 if (*pb &amp; 2) iLen += (i_Ratio - 1); pb++; &#125; return iLen + i_LenBuf; &#125; int GetBufferLength() const &#123; return i_LenBuf; &#125; const BYTE&amp;GetAt(int i) const &#123; return ia_Buf[i]; &#125; int GetRatio() const &#123; return i_Ratio; &#125; int SetRatio(int iRatio) &#123; i_Ratio = iRatio; if (i_Ratio &lt;= 0) i_Ratio = 1; &#125; void DrawBarcode(HDC hDC, int iX, int iY0, int iY10, int iY11, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; HPEN hPenBar = ::CreatePen(PS_SOLID, iPenW, clrBar); HPEN hPenSpace = ::CreatePen(PS_SOLID, iPenW, clrSpace); HPEN hPenOld = (HPEN)::SelectObject(hDC, hPenBar); BYTE*pb = ia_Buf; int i0, iNum0 = i_LenBuf; BYTE bBar; int i1, iNum1; int iY; for (i0 = 0; i0 &lt; iNum0; i0++) &#123; bBar = *pb &amp; 0x01; iNum1 = (*pb &amp; 0x02) ? i_Ratio : 1; iY = (*pb &amp; 0x04) ? iY11 : iY10; for (i1 = 0; i1 &lt; iNum1; i1++) &#123; if (bBar) ::SelectObject(hDC, hPenBar); else ::SelectObject(hDC, hPenSpace); ::MoveToEx(hDC, iX, iY0, 0); ::LineTo(hDC, iX, iY); iX += iPenW; &#125; pb++; &#125; ::SelectObject(hDC, hPenOld); ::DeleteObject(hPenBar); ::DeleteObject(hPenSpace); &#125;protected: BYTE ia_Buf[4096]; int i_LenBuf; int i_Ratio; struct IntString &#123; int ch; char*psz; &#125;;&#125;;class Barcode39 : public BarcodeBase &#123; //[n/a][n/a][n/a][n/a][n/a][n/a][w-n][b-s]public: Barcode39() &#123; &#125; ~Barcode39() &#123; &#125; BOOL Encode39(const char*pszCodeIn) &#123; int iLen = strlen(pszCodeIn); char*pszCode = new char[iLen + 3]; sprintf(pszCode, &quot;*%s*&quot;, pszCodeIn); strupr(pszCode); BYTE*pFst = ia_Buf; BYTE*p0 = pFst, *p1; iLen += 2; int i; for (i = 0; i &lt; iLen; i++) &#123; p1 = P_GetNarrowWideBarSpace39(pszCode[i], p0); if (p1 == 0) return 0; p0 = p1; &#125; i_LenBuf = p1 - pFst; delete[]pszCode; return 1; &#125; void Draw39(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW); &#125;private: BYTE*P_GetNarrowWideBarSpace39(char ch, BYTE*pb) &#123; IntString infs[] = &#123; &#123;&#x27;1&#x27;, &quot;wnnwnnnnwn&quot;&#125;, &#123;&#x27;2&#x27;, &quot;nnwwnnnnwn&quot;&#125;, &#123;&#x27;3&#x27;, &quot;wnwwnnnnnn&quot;&#125;, &#123;&#x27;4&#x27;, &quot;nnnwwnnnwn&quot;&#125;, &#123;&#x27;5&#x27;, &quot;wnnwwnnnnn&quot;&#125;, &#123;&#x27;6&#x27;, &quot;nnwwwnnnnn&quot;&#125;, &#123;&#x27;7&#x27;, &quot;nnnwnnwnwn&quot;&#125;, &#123;&#x27;8&#x27;, &quot;wnnwnnwnnn&quot;&#125;, &#123;&#x27;9&#x27;, &quot;nnwwnnwnnn&quot;&#125;, &#123;&#x27;0&#x27;, &quot;nnnwwnwnnn&quot;&#125;, &#123;&#x27;A&#x27;, &quot;wnnnnwnnwn&quot;&#125;, &#123;&#x27;B&#x27;, &quot;nnwnnwnnwn&quot;&#125;, &#123;&#x27;C&#x27;, &quot;wnwnnwnnnn&quot;&#125;, &#123;&#x27;D&#x27;, &quot;nnnnwwnnwn&quot;&#125;, &#123;&#x27;E&#x27;, &quot;wnnnwwnnnn&quot;&#125;, &#123;&#x27;F&#x27;, &quot;nnwnwwnnnn&quot;&#125;, &#123;&#x27;G&#x27;, &quot;nnnnnwwnwn&quot;&#125;, &#123;&#x27;H&#x27;, &quot;wnnnnwwnnn&quot;&#125;, &#123;&#x27;I&#x27;, &quot;nnwnnwwnnn&quot;&#125;, &#123;&#x27;J&#x27;, &quot;nnnnwwwnnn&quot;&#125;, &#123;&#x27;K&#x27;, &quot;wnnnnnnwwn&quot;&#125;, &#123;&#x27;L&#x27;, &quot;nnwnnnnwwn&quot;&#125;, &#123;&#x27;M&#x27;, &quot;wnwnnnnwnn&quot;&#125;, &#123;&#x27;N&#x27;, &quot;nnnnwnnwwn&quot;&#125;, &#123;&#x27;O&#x27;, &quot;wnnnwnnwnn&quot;&#125;, &#123;&#x27;P&#x27;, &quot;nnwnwnnwnn&quot;&#125;, &#123;&#x27;Q&#x27;, &quot;nnnnnnwwwn&quot;&#125;, &#123;&#x27;R&#x27;, &quot;wnnnnnwwnn&quot;&#125;, &#123;&#x27;S&#x27;, &quot;nnwnnnwwnn&quot;&#125;, &#123;&#x27;T&#x27;, &quot;nnnnwnwwnn&quot;&#125;, &#123;&#x27;U&#x27;, &quot;wwnnnnnnwn&quot;&#125;, &#123;&#x27;V&#x27;, &quot;nwwnnnnnwn&quot;&#125;, &#123;&#x27;W&#x27;, &quot;wwwnnnnnnn&quot;&#125;, &#123;&#x27;X&#x27;, &quot;nwnnwnnnwn&quot;&#125;, &#123;&#x27;Y&#x27;, &quot;wwnnwnnnnn&quot;&#125;, &#123;&#x27;Z&#x27;, &quot;nwwnwnnnnn&quot;&#125;, &#123;&#x27;-&#x27;, &quot;nwnnnnwnwn&quot;&#125;, &#123;&#x27;.&#x27;, &quot;wwnnnnwnnn&quot;&#125;, &#123;&#x27; &#x27;, &quot;nwwnnnwnnn&quot;&#125;, &#123;&#x27;*&#x27;, &quot;nwnnwnwnnn&quot;&#125;, &#123;&#x27;$&#x27;, &quot;nwnwnwnnnn&quot;&#125;, &#123;&#x27;/&#x27;, &quot;nwnwnnnwnn&quot;&#125;, &#123;&#x27;+&#x27;, &quot;nwnnnwnwnn&quot;&#125;, &#123;&#x27;%&#x27;, &quot;nnnwnwnwnn&quot;&#125;, &#125;; int i0, iNum0 = sizeof(infs) / sizeof(infs[0]); int i1; for (i0 = 0; i0 &lt; iNum0; i0++) &#123; IntString&amp;inf = infs[i0]; if (inf.ch == ch) &#123; for (i1 = 0; i1 &lt; 10; i1++) &#123; if (inf.psz[i1] == &#x27;w&#x27;) *pb += 2; if (i1 % 2 == 0) *pb += 1; pb++; &#125; return pb; &#125; &#125; return 0; &#125;&#125;;class BarcodeI2of5 :public BarcodeBase &#123; //[n/a][n/a][n/a][n/a][n/a][n/a][w-n][b-s]public: BarcodeI2of5() &#123; &#125; ~BarcodeI2of5() &#123; &#125; BOOL EncodeI2of5(const char*pszCode) &#123; Clear(); BYTE*pFst = ia_Buf; BYTE*pb = pFst; const int iNum = strlen(pszCode); int i; //&quot;nnnn&quot; for (i = 0; i &lt; 4; i++) &#123; if (i % 2 == 0) *pb += 1; pb++; &#125; int iV; for (i = 0; i &lt; iNum; i += 2) &#123; iV = pszCode[i] - &#x27;0&#x27;; iV = iV * 10; iV += pszCode[i + 1] - &#x27;0&#x27;; pb = P_GetNarrorWideBarSpaceI2of5(pb, iV); if (pb == 0) return 0; &#125; //&quot;wnn&quot; *pb += 3; pb++; *pb += 0; pb++; *pb += 1; pb++; i_LenBuf = pb - pFst; return 1; &#125; void DrawI2of5(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW); &#125;private: BYTE*P_GetNarrorWideBarSpaceI2of5(BYTE*pb, int ch) &#123; if (ch &lt; 0) return 0; if (ch &gt; 99) return 0; IntString infs[] = &#123; &#123;0, &quot;nnnnwwwwnn&quot;&#125;, &#123;1, &quot;nwnnwnwnnw&quot;&#125;, &#123;2, &quot;nnnwwnwnnw&quot;&#125;, &#123;3, &quot;nwnwwnwnnn&quot;&#125;, &#123;4, &quot;nnnnwwwnnw&quot;&#125;, &#123;5, &quot;nwnnwwwnnn&quot;&#125;, &#123;6, &quot;nnnwwwwnnn&quot;&#125;, &#123;7, &quot;nnnnwnwwnw&quot;&#125;, &#123;8, &quot;nwnnwnwwnn&quot;&#125;, &#123;9, &quot;nnnwwnwwnn&quot;&#125;, &#123;10, &quot;wnnnnwnwwn&quot;&#125;, &#123;11, &quot;wwnnnnnnww&quot;&#125;, &#123;12, &quot;wnnwnnnnww&quot;&#125;, &#123;13, &quot;wwnwnnnnwn&quot;&#125;, &#123;14, &quot;wnnnnwnnww&quot;&#125;, &#123;15, &quot;wwnnnwnnwn&quot;&#125;, &#123;16, &quot;wnnwnwnnwn&quot;&#125;, &#123;17, &quot;wnnnnnnwww&quot;&#125;, &#123;18, &quot;wwnnnnnwwn&quot;&#125;, &#123;19, &quot;wnnwnnnwwn&quot;&#125;, &#123;20, &quot;nnwnnwnwwn&quot;&#125;, &#123;21, &quot;nwwnnnnnww&quot;&#125;, &#123;22, &quot;nnwwnnnnww&quot;&#125;, &#123;23, &quot;nwwwnnnnwn&quot;&#125;, &#123;24, &quot;nnwnnwnnww&quot;&#125;, &#123;25, &quot;nwwnnwnnwn&quot;&#125;, &#123;26, &quot;nnwwnwnnwn&quot;&#125;, &#123;27, &quot;nnwnnnnwww&quot;&#125;, &#123;28, &quot;nwwnnnnwwn&quot;&#125;, &#123;29, &quot;nnwwnnnwwn&quot;&#125;, &#123;30, &quot;wnwnnwnwnn&quot;&#125;, &#123;31, &quot;wwwnnnnnnw&quot;&#125;, &#123;32, &quot;wnwwnnnnnw&quot;&#125;, &#123;33, &quot;wwwwnnnnnn&quot;&#125;, &#123;34, &quot;wnwnnwnnnw&quot;&#125;, &#123;35, &quot;wwwnnwnnnn&quot;&#125;, &#123;36, &quot;wnwwnwnnnn&quot;&#125;, &#123;37, &quot;wnwnnnnwnw&quot;&#125;, &#123;38, &quot;wwwnnnnwnn&quot;&#125;, &#123;39, &quot;wnwwnnnwnn&quot;&#125;, &#123;40, &quot;nnnnwwnwwn&quot;&#125;, &#123;41, &quot;nwnnwnnnww&quot;&#125;, &#123;42, &quot;nnnwwnnnww&quot;&#125;, &#123;43, &quot;nwnwwnnnwn&quot;&#125;, &#123;44, &quot;nnnnwwnnww&quot;&#125;, &#123;45, &quot;nwnnwwnnwn&quot;&#125;, &#123;46, &quot;nnnwwwnnwn&quot;&#125;, &#123;47, &quot;nnnnwnnwww&quot;&#125;, &#123;48, &quot;nwnnwnnwwn&quot;&#125;, &#123;49, &quot;nnnwwnnwwn&quot;&#125;, &#123;50, &quot;wnnnwwnwnn&quot;&#125;, &#123;51, &quot;wwnnwnnnnw&quot;&#125;, &#123;52, &quot;wnnwwnnnnw&quot;&#125;, &#123;53, &quot;wwnwwnnnnn&quot;&#125;, &#123;54, &quot;wnnnwwnnnw&quot;&#125;, &#123;55, &quot;wwnnwwnnnn&quot;&#125;, &#123;56, &quot;wnnwwwnnnn&quot;&#125;, &#123;57, &quot;wnnnwnnwnw&quot;&#125;, &#123;58, &quot;wwnnwnnwnn&quot;&#125;, &#123;59, &quot;wnnwwnnwnn&quot;&#125;, &#123;60, &quot;nnwnwwnwnn&quot;&#125;, &#123;61, &quot;nwwnwnnnnw&quot;&#125;, &#123;62, &quot;nnwwwnnnnw&quot;&#125;, &#123;63, &quot;nwwwwnnnnn&quot;&#125;, &#123;64, &quot;nnwnwwnnnw&quot;&#125;, &#123;65, &quot;nwwnwwnnnn&quot;&#125;, &#123;66, &quot;nnwwwwnnnn&quot;&#125;, &#123;67, &quot;nnwnwnnwnw&quot;&#125;, &#123;68, &quot;nwwnwnnwnn&quot;&#125;, &#123;69, &quot;nnwwwnnwnn&quot;&#125;, &#123;70, &quot;nnnnnwwwwn&quot;&#125;, &#123;71, &quot;nwnnnnwnww&quot;&#125;, &#123;72, &quot;nnnwnnwnww&quot;&#125;, &#123;73, &quot;nwnwnnwnwn&quot;&#125;, &#123;74, &quot;nnnnnwwnww&quot;&#125;, &#123;75, &quot;nwnnnwwnwn&quot;&#125;, &#123;76, &quot;nnnwnwwnwn&quot;&#125;, &#123;77, &quot;nnnnnnwwww&quot;&#125;, &#123;78, &quot;nwnnnnwwwn&quot;&#125;, &#123;79, &quot;nnnwnnwwwn&quot;&#125;, &#123;80, &quot;wnnnnwwwnn&quot;&#125;, &#123;81, &quot;wwnnnnwnnw&quot;&#125;, &#123;82, &quot;wnnwnnwnnw&quot;&#125;, &#123;83, &quot;wwnwnnwnnn&quot;&#125;, &#123;84, &quot;wnnnnwwnnw&quot;&#125;, &#123;85, &quot;wwnnnwwnnn&quot;&#125;, &#123;86, &quot;wnnwnwwnnn&quot;&#125;, &#123;87, &quot;wnnnnnwwnw&quot;&#125;, &#123;88, &quot;wwnnnnwwnn&quot;&#125;, &#123;89, &quot;wnnwnnwwnn&quot;&#125;, &#123;90, &quot;nnwnnwwwnn&quot;&#125;, &#123;91, &quot;nwwnnnwnnw&quot;&#125;, &#123;92, &quot;nnwwnnwnnw&quot;&#125;, &#123;93, &quot;nwwwnnwnnn&quot;&#125;, &#123;94, &quot;nnwnnwwnnw&quot;&#125;, &#123;95, &quot;nwwnnwwnnn&quot;&#125;, &#123;96, &quot;nnwwnwwnnn&quot;&#125;, &#123;97, &quot;nnwnnnwwnw&quot;&#125;, &#123;98, &quot;nwwnnnwwnn&quot;&#125;, &#123;99, &quot;nnwwnnwwnn&quot;&#125;, &#125;; IntString&amp;inf = infs[ch]; int i; for (i = 0; i &lt; 10; i++) &#123; if (inf.psz[i] == &#x27;w&#x27;) *pb += 2; if (i % 2 == 0) *pb += 1; pb++; &#125; return pb; &#125;&#125;;class Barcode93 :public BarcodeBase &#123; //[n/a][n/a][n/a][n/a][n/a][n/a][n/a][b-s]public: Barcode93() &#123; &#125; ~Barcode93() &#123; &#125; BOOL Encode93(const char* pszCode) &#123; Clear(); const int iNum = strlen(pszCode); BYTE*pFst = ia_Buf; BYTE*pb = pFst; pb = P_GetBarSpace93(pb, 47); if (pb == 0) return 0; BOOL b; int i, iFirst, iSecond; for (i = 0; i &lt; iNum; i++) &#123; b = P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond); if (b == 0) return 0; pb = P_GetBarSpace93(pb, iFirst); if (pb == 0) return 0; if (iSecond != -1) &#123; pb = P_GetBarSpace93(pb, iSecond); if (pb == 0) return 0; &#125; &#125; pb = P_GetCheckDigits(pb, pszCode); if (pb == 0) return 0; pb = P_GetBarSpace93(pb, 48); if (pb == 0) return 0; i_LenBuf = pb - pFst; return 1; &#125; void Draw93(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW); &#125;private: BYTE*P_GetBarSpace93(BYTE*pb, int ch) &#123; if (ch &lt; 0) return 0; if (ch &gt; 48) return 0; IntString infs[] = &#123; &#123;0, &quot;bsssbsbss&quot;&#125;, &#123;1, &quot;bsbssbsss&quot;&#125;, &#123;2, &quot;bsbsssbss&quot;&#125;, &#123;3, &quot;bsbssssbs&quot;&#125;, &#123;4, &quot;bssbsbsss&quot;&#125;, &#123;5, &quot;bssbssbss&quot;&#125;, &#123;6, &quot;bssbsssbs&quot;&#125;, &#123;7, &quot;bsbsbssss&quot;&#125;, &#123;8, &quot;bsssbssbs&quot;&#125;, &#123;9, &quot;bssssbsbs&quot;&#125;, &#123;10, &quot;bbsbsbsss&quot;&#125;, &#123;11, &quot;bbsbssbss&quot;&#125;, &#123;12, &quot;bbsbsssbs&quot;&#125;, &#123;13, &quot;bbssbsbss&quot;&#125;, &#123;14, &quot;bbssbssbs&quot;&#125;, &#123;15, &quot;bbsssbsbs&quot;&#125;, &#123;16, &quot;bsbbsbsss&quot;&#125;, &#123;17, &quot;bsbbssbss&quot;&#125;, &#123;18, &quot;bsbbsssbs&quot;&#125;, &#123;19, &quot;bssbbsbss&quot;&#125;, &#123;20, &quot;bsssbbsbs&quot;&#125;, &#123;21, &quot;bsbsbbsss&quot;&#125;, &#123;22, &quot;bsbssbbss&quot;&#125;, &#123;23, &quot;bsbsssbbs&quot;&#125;, &#123;24, &quot;bssbsbbss&quot;&#125;, &#123;25, &quot;bsssbsbbs&quot;&#125;, &#123;26, &quot;bbsbbsbss&quot;&#125;, &#123;27, &quot;bbsbbssbs&quot;&#125;, &#123;28, &quot;bbsbsbbss&quot;&#125;, &#123;29, &quot;bbsbssbbs&quot;&#125;, &#123;30, &quot;bbssbsbbs&quot;&#125;, &#123;31, &quot;bbssbbsbs&quot;&#125;, &#123;32, &quot;bsbbsbbss&quot;&#125;, &#123;33, &quot;bsbbssbbs&quot;&#125;, &#123;34, &quot;bssbbsbbs&quot;&#125;, &#123;35, &quot;bssbbbsbs&quot;&#125;, &#123;36, &quot;bssbsbbbs&quot;&#125;, &#123;37, &quot;bbbsbsbss&quot;&#125;, &#123;38, &quot;bbbsbssbs&quot;&#125;, &#123;39, &quot;bbbssbsbs&quot;&#125;, &#123;40, &quot;bsbbsbbbs&quot;&#125;, &#123;41, &quot;bsbbbsbbs&quot;&#125;, &#123;42, &quot;bbsbsbbbs&quot;&#125;, &#123;43, &quot;bssbssbbs&quot;&#125;, &#123;44, &quot;bbbsbbsbs&quot;&#125;, &#123;45, &quot;bbbsbsbbs&quot;&#125;, &#123;46, &quot;bssbbssbs&quot;&#125;, &#123;47, &quot;bsbsbbbbs&quot;&#125;, &#123;48, &quot;bsbsbbbbsb&quot;&#125;, &#125;; IntString&amp;inf = infs[ch]; int i; for (i = 0; i &lt; 9; i++) &#123; if (inf.psz[i] == &#x27;b&#x27;) *pb += 1; pb++; &#125; if (ch == 48) &#123; *pb += 1; pb++; &#125; return pb; &#125;private: BYTE*P_GetCheckDigits(BYTE*pb, const char*&amp;pszCode) &#123; int i, iSum, iWeight, iFirst, iSecond; // &quot;C&quot; check digit character iWeight = 1; iSum = 0; const int iNum = strlen(pszCode); for (i = iNum - 1; i &gt; -1; i--) &#123; P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond); iSum += (iWeight*iFirst); iWeight++; if (iWeight &gt; 20) iWeight = 1; if (iSecond != -1) &#123; iSum += (iWeight*iSecond); iWeight++; if (iWeight &gt; 20) iWeight = 1; &#125; &#125; pb = P_GetBarSpace93(pb, iSum % 47); if (pb == 0) return 0; iWeight = 2; iSum = iSum % 47; for (i = iNum - 1; i &gt; -1; i--) &#123; P_AscIItoCode93Sequence((int)pszCode[i], iFirst, iSecond); iSum += (iWeight * iFirst); iWeight++; if (iWeight &gt; 15) iWeight = 1; if (iSecond != -1) &#123; iSum += (iWeight * iSecond); iWeight++; if (iWeight &gt; 15) iWeight = 1; &#125; &#125; pb = P_GetBarSpace93(pb, iSum % 47); if (pb == 0) return 0; return pb; &#125; BOOL P_AscIItoCode93Sequence(int iValue, int&amp;iFirst, int&amp;iSecond) &#123; if (iValue &lt; 0) return 0; if (iValue &gt; 127) return 0; struct I3 &#123; int iV, iFirst, iSecond; &#125;; I3 i3s[] = &#123; &#123;0, 44,\t30&#125;, &#123;1, 43,\t10&#125;, &#123;2, 43,\t11&#125;, &#123;3, 43,\t12&#125;, &#123;4, 43,\t13&#125;, &#123;5, 43,\t14&#125;, &#123;6, 43,\t15&#125;, &#123;7, 43,\t16&#125;, &#123;8, 43,\t17&#125;, &#123;9, 43,\t18&#125;, &#123;10,43, 19&#125;, &#123;11,43, 20&#125;, &#123;12,43, 21&#125;, &#123;13,43, 22&#125;, &#123;14,43, 23&#125;, &#123;15,43, 24&#125;, &#123;16,43, 25&#125;, &#123;17,43, 26&#125;, &#123;18,43, 27&#125;, &#123;19,43, 28&#125;, &#123;20,43, 29&#125;, &#123;21,43, 30&#125;, &#123;22,43, 31&#125;, &#123;23,43, 32&#125;, &#123;24,43, 33&#125;, &#123;25,43, 34&#125;, &#123;26,43, 35&#125;, &#123;27,44, 10&#125;, &#123;28,44, 11&#125;, &#123;29,44, 12&#125;, &#123;30,44, 13&#125;, &#123;31,44, 14&#125;, &#123;32,38, -1&#125;, &#123;33,45, 10&#125;, &#123;34,45, 11&#125;, &#123;35,45, 12&#125;, &#123;36,39, -1&#125;, &#123;37,42, -1&#125;, &#123;38,45, 15&#125;, &#123;39,45, 16&#125;, &#123;40,45, 17&#125;, &#123;41,45, 18&#125;, &#123;42,45, 19&#125;, &#123;43,41, -1&#125;, &#123;44,45, 21&#125;, &#123;45,36, -1&#125;, &#123;46,37, -1&#125;, &#123;47,40, -1&#125;, &#123;48,0, -1&#125;, &#123;49,1, -1&#125;, &#123;50,2, -1&#125;, &#123;51,3, -1&#125;, &#123;52,4, -1&#125;, &#123;53,5, -1&#125;, &#123;54,6, -1&#125;, &#123;55,7, -1&#125;, &#123;56,8, -1&#125;, &#123;57,9, -1&#125;, &#123;58,45, 35&#125;, &#123;59,44, 15&#125;, &#123;60,44, 16&#125;, &#123;61,44, 17&#125;, &#123;62,44, 18&#125;, &#123;63,44, 19&#125;, &#123;64,44, 31&#125;, &#123;65,10, -1&#125;, &#123;66,11, -1&#125;, &#123;67,12, -1&#125;, &#123;68,13, -1&#125;, &#123;69,14, -1&#125;, &#123;70,15, -1&#125;, &#123;71,16, -1&#125;, &#123;72,17, -1&#125;, &#123;73,18, -1&#125;, &#123;74,19, -1&#125;, &#123;75,20, -1&#125;, &#123;76,21, -1&#125;, &#123;77,22, -1&#125;, &#123;78,23, -1&#125;, &#123;79,24, -1&#125;, &#123;80,25, -1&#125;, &#123;81,26, -1&#125;, &#123;82,27, -1&#125;, &#123;83,28, -1&#125;, &#123;84,29, -1&#125;, &#123;85,30, -1&#125;, &#123;86,31, -1&#125;, &#123;87,32, -1&#125;, &#123;88,33, -1&#125;, &#123;89,34, -1&#125;, &#123;90,35, -1&#125;, &#123;91,44, 20&#125;, &#123;92,44, 21&#125;, &#123;93,44, 22&#125;, &#123;94,44, 23&#125;, &#123;95,44, 24&#125;, &#123;96,44, 32&#125;, &#123;97,46, 10&#125;, &#123;98,46, 11&#125;, &#123;99,46, 12&#125;, &#123;100,46,13&#125;, &#123;101,46,14&#125;, &#123;102,46,15&#125;, &#123;103,46,16&#125;, &#123;104,46,17&#125;, &#123;105,46,18&#125;, &#123;106,46,19&#125;, &#123;107,46,20&#125;, &#123;108,46,21&#125;, &#123;109,46,22&#125;, &#123;110,46,23&#125;, &#123;111,46,24&#125;, &#123;112,46,25&#125;, &#123;113,46,26&#125;, &#123;114,46,27&#125;, &#123;115,46,28&#125;, &#123;116,46,29&#125;, &#123;117,46,30&#125;, &#123;118,46,31&#125;, &#123;119,46,32&#125;, &#123;120,46,33&#125;, &#123;121,46,34&#125;, &#123;122,46,35&#125;, &#123;123,44,25&#125;, &#123;124,44,26&#125;, &#123;125,44,27&#125;, &#123;126,44,28&#125;, &#123;127,44,29&#125;, &#125;; I3&amp;i3 = i3s[iValue]; iFirst = i3.iFirst; iSecond = i3.iSecond; return 1; &#125;&#125;;class Barcode128 :public BarcodeBase &#123;public: Barcode128() &#123; &#125; ~Barcode128() &#123; &#125; BOOL Encode128A(const char* pszCode) &#123; return P_Encode128((char*)pszCode, SUB::SETA); &#125; BOOL Encode128B(const char* pszCode) &#123; return P_Encode128((char*)pszCode, SUB::SETB); &#125; BOOL Encode128C(const char* pszCode) &#123; return P_Encode128((char*)pszCode, SUB::SETC); &#125; void Draw128(HDC hDC, int iX, int iY0, int iY1, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; DrawBarcode(hDC, iX, iY0, iY1, iY1, clrBar, clrSpace, iPenW); &#125;private: struct SUB &#123; enum &#123; SETA = 0, SETB = 1, SETC = 2, &#125;; &#125;; BOOL P_Encode128(char*pszCode, const int iSetIn) &#123; Clear(); BYTE*pFst = ia_Buf; BYTE*pb = pFst; if (iSetIn == SUB::SETA) pb = P_GetBarSpace128(pb, 103); else if (iSetIn == SUB::SETB) pb = P_GetBarSpace128(pb, 104); else pb = P_GetBarSpace128(pb, 105); if (pb == 0) return 0; const int iCheckDigit = GetCheckDigit(iSetIn, pszCode); const int iNum = strlen(pszCode); int iChar, iCharNext; int iPosition = 0; int iSet = iSetIn; while (iPosition &lt; iNum) &#123; if (iSet == SUB::SETC) &#123; if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 101) &#123; pb = P_GetBarSpace128(pb, 101); iPosition++; iSet = SUB::SETA; &#125; else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 100) &#123; pb = P_GetBarSpace128(pb, 100); iPosition++; iSet = SUB::SETB; &#125; else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 102) &#123; pb = P_GetBarSpace128(pb, 100); iPosition++; &#125; else &#123; char chT = pszCode[iPosition + 2]; pszCode[iPosition + 2] = 0; iChar = atoi(&amp;pszCode[iPosition]); pszCode[iPosition + 2] = chT; pb = P_GetBarSpace128(pb, iChar); if (pb == 0) return 0; iPosition += 2; &#125; &#125; else &#123; int iTemp2 = pszCode[iPosition]; if (iTemp2 &lt; -1) iTemp2 = iTemp2 &amp; 255; iChar = ga2_Code128[iSet][iTemp2]; pb = P_GetBarSpace128(pb, iChar); if (pb == 0) return 0; iPosition++; if (iSet == SUB::SETA) &#123; if (iChar == 100) iSet = SUB::SETB; else if (iChar == 99) iSet = SUB::SETC; &#125; else if (iSet == SUB::SETB) &#123; if (iChar == 101) iSet = SUB::SETA; else if (iChar == 99) iSet = SUB::SETC; &#125; else if (iChar == 98) &#123; if (iSet == SUB::SETA) iCharNext = ga2_Code128[SUB::SETB][pszCode[iPosition]]; else iCharNext = ga2_Code128[SUB::SETA][pszCode[iPosition]]; pb = P_GetBarSpace128(pb, iChar); if (pb == 0) return 0; iPosition++; &#125; &#125; &#125; pb = P_GetBarSpace128(pb, iCheckDigit); if (pb == 0) return 0; pb = P_GetBarSpace128(pb, 106); i_LenBuf = pb - pFst; return 1; &#125; BYTE*P_GetBarSpace128(BYTE*pb, int iV) &#123; if (iV &lt; 0) return 0; if (iV &gt; 106) return 0; IntString infs[] = &#123; &#123;0, &quot;bbsbbssbbss&quot;&#125;, &#123;1, &quot;bbssbbsbbss&quot;&#125;, &#123;2, &quot;bbssbbssbbs&quot;&#125;, &#123;3, &quot;bssbssbbsss&quot;&#125;, &#123;4, &quot;bssbsssbbss&quot;&#125;, &#123;5, &quot;bsssbssbbss&quot;&#125;, &#123;6, &quot;bssbbssbsss&quot;&#125;, &#123;7, &quot;bssbbsssbss&quot;&#125;, &#123;8, &quot;bsssbbssbss&quot;&#125;, &#123;9, &quot;bbssbssbsss&quot;&#125;, &#123;10, &quot;bbssbsssbss&quot;&#125;, &#123;11, &quot;bbsssbssbss&quot;&#125;, &#123;12, &quot;bsbbssbbbss&quot;&#125;, &#123;13, &quot;bssbbsbbbss&quot;&#125;, &#123;14, &quot;bssbbssbbbs&quot;&#125;, &#123;15, &quot;bsbbbssbbss&quot;&#125;, &#123;16, &quot;bssbbbsbbss&quot;&#125;, &#123;17, &quot;bssbbbssbbs&quot;&#125;, &#123;18, &quot;bbssbbbssbs&quot;&#125;, &#123;19, &quot;bbssbsbbbss&quot;&#125;, &#123;20, &quot;bbssbssbbbs&quot;&#125;, &#123;21, &quot;bbsbbbssbss&quot;&#125;, &#123;22, &quot;bbssbbbsbss&quot;&#125;, &#123;23, &quot;bbbsbbsbbbs&quot;&#125;, &#123;24, &quot;bbbsbssbbss&quot;&#125;, &#123;25, &quot;bbbssbsbbss&quot;&#125;, &#123;26, &quot;bbbssbssbbs&quot;&#125;, &#123;27, &quot;bbbsbbssbss&quot;&#125;, &#123;28, &quot;bbbssbbsbss&quot;&#125;, &#123;29, &quot;bbbssbbssbs&quot;&#125;, &#123;30, &quot;bbsbbsbbsss&quot;&#125;, &#123;31, &quot;bbsbbsssbbs&quot;&#125;, &#123;32, &quot;bbsssbbsbbs&quot;&#125;, &#123;33, &quot;bsbsssbbsss&quot;&#125;, &#123;34, &quot;bsssbsbbsss&quot;&#125;, &#123;35, &quot;bsssbsssbbs&quot;&#125;, &#123;36, &quot;bsbbsssbsss&quot;&#125;, &#123;37, &quot;bsssbbsbsss&quot;&#125;, &#123;38, &quot;bsssbbsssbs&quot;&#125;, &#123;39, &quot;bbsbsssbsss&quot;&#125;, &#123;40, &quot;bbsssbsbsss&quot;&#125;, &#123;41, &quot;bbsssbsssbs&quot;&#125;, &#123;42, &quot;bsbbsbbbsss&quot;&#125;, &#123;43, &quot;bsbbsssbbbs&quot;&#125;, &#123;44, &quot;bsssbbsbbbs&quot;&#125;, &#123;45, &quot;bsbbbsbbsss&quot;&#125;, &#123;46, &quot;bsbbbsssbbs&quot;&#125;, &#123;47, &quot;bsssbbbsbbs&quot;&#125;, &#123;48, &quot;bbbsbbbsbbs&quot;&#125;, &#123;49, &quot;bbsbsssbbbs&quot;&#125;, &#123;50, &quot;bbsssbsbbbs&quot;&#125;, &#123;51, &quot;bbsbbbsbsss&quot;&#125;, &#123;52, &quot;bbsbbbsssbs&quot;&#125;, &#123;53, &quot;bbsbbbsbbbs&quot;&#125;, &#123;54, &quot;bbbsbsbbsss&quot;&#125;, &#123;55, &quot;bbbsbsssbbs&quot;&#125;, &#123;56, &quot;bbbsssbsbbs&quot;&#125;, &#123;57, &quot;bbbsbbsbsss&quot;&#125;, &#123;58, &quot;bbbsbbsssbs&quot;&#125;, &#123;59, &quot;bbbsssbbsbs&quot;&#125;, &#123;60, &quot;bbbsbbbbsbs&quot;&#125;, &#123;61, &quot;bbssbssssbs&quot;&#125;, &#123;62, &quot;bbbbsssbsbs&quot;&#125;, &#123;63, &quot;bsbssbbssss&quot;&#125;, &#123;64, &quot;bsbssssbbss&quot;&#125;, &#123;65, &quot;bssbsbbssss&quot;&#125;, &#123;66, &quot;bssbssssbbs&quot;&#125;, &#123;67, &quot;bssssbsbbss&quot;&#125;, &#123;68, &quot;bssssbssbbs&quot;&#125;, &#123;69, &quot;bsbbssbssss&quot;&#125;, &#123;70, &quot;bsbbssssbss&quot;&#125;, &#123;71, &quot;bssbbsbssss&quot;&#125;, &#123;72, &quot;bssbbssssbs&quot;&#125;, &#123;73, &quot;bssssbbsbss&quot;&#125;, &#123;74, &quot;bssssbbssbs&quot;&#125;, &#123;75, &quot;bbssssbssbs&quot;&#125;, &#123;76, &quot;bbssbsbssss&quot;&#125;, &#123;77, &quot;bbbbsbbbsbs&quot;&#125;, &#123;78, &quot;bbssssbsbss&quot;&#125;, &#123;79, &quot;bsssbbbbsbs&quot;&#125;, &#123;80, &quot;bsbssbbbbss&quot;&#125;, &#123;81, &quot;bssbsbbbbss&quot;&#125;, &#123;82, &quot;bssbssbbbbs&quot;&#125;, &#123;83, &quot;bsbbbbssbss&quot;&#125;, &#123;84, &quot;bssbbbbsbss&quot;&#125;, &#123;85, &quot;bssbbbbssbs&quot;&#125;, &#123;86, &quot;bbbbsbssbss&quot;&#125;, &#123;87, &quot;bbbbssbsbss&quot;&#125;, &#123;88, &quot;bbbbssbssbs&quot;&#125;, &#123;89, &quot;bbsbbsbbbbs&quot;&#125;, &#123;90, &quot;bbsbbbbsbbs&quot;&#125;, &#123;91, &quot;bbbbsbbsbbs&quot;&#125;, &#123;92, &quot;bsbsbbbbsss&quot;&#125;, &#123;93, &quot;bsbsssbbbbs&quot;&#125;, &#123;94, &quot;bsssbsbbbbs&quot;&#125;, &#123;95, &quot;bsbbbbsbsss&quot;&#125;, &#123;96, &quot;bsbbbbsssbs&quot;&#125;, &#123;97, &quot;bbbbsbsbsss&quot;&#125;, &#123;98, &quot;bbbbsbsssbs&quot;&#125;, &#123;99, &quot;bsbbbsbbbbs&quot;&#125;, &#123;100, &quot;bsbbbbsbbbs&quot;&#125;, &#123;101, &quot;bbbsbsbbbbs&quot;&#125;, &#123;102, &quot;bbbbsbsbbbs&quot;&#125;, // &#123;103,\t&quot;bbsbsbbbbss&quot;&#125;, &#123;103, &quot;bbsbssssbss&quot;&#125;, &#123;104, &quot;bbsbssbssss&quot;&#125;, &#123;105, &quot;bbsbssbbbss&quot;&#125;, &#123;106, &quot;bbsssbbbsbsbb&quot;&#125;, &#125;; int i; IntString&amp;inf = infs[iV]; for (i = 0; i &lt; 11; i++) &#123; if (inf.psz[i] == &#x27;b&#x27;) *pb += 1; pb++; &#125; if (iV == 106) &#123; *pb += 1; pb++; *pb += 1; pb++; &#125; return pb; &#125;private: int GetCheckDigit(const int iSet, char*pszCode) &#123; int iSum = 0, iCurSet = 0, iChar128, iCharNext, iWeight, iPosition; iCurSet = iSet; if (iSet == SUB::SETA) &#123; iSum = 103; &#125; else if (iSet == SUB::SETB) &#123; iSum = 104; &#125; else if (iSet == SUB::SETC) &#123; iSum = 105; &#125; iPosition = 0; iWeight = 1; const int iNum = strlen(pszCode); while (iPosition &lt; iNum) &#123; if (iCurSet == SUB::SETC) &#123; if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 101) &#123; iChar128 = 101; iSum += (iWeight*iChar128); iPosition++; iWeight++; iCurSet = SUB::SETA; &#125; else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 100) &#123; iChar128 = 100; iSum += (iWeight*iChar128); iPosition++; iWeight++; iCurSet = SUB::SETB; &#125; else if (ga2_Code128[SUB::SETA][pszCode[iPosition]] == 102) &#123; iChar128 = 102; iSum += (iWeight*iChar128); iPosition++; iWeight++; &#125; else &#123; char chT = pszCode[iPosition + 2]; pszCode[iPosition + 2] = 0; iChar128 = atol(&amp;pszCode[iPosition]); pszCode[iPosition + 2] = chT; iSum += (iWeight*iChar128); iPosition += 2; iWeight++; &#125; &#125; else &#123; int iTemp2 = pszCode[iPosition]; if (iTemp2 &lt; -1) iTemp2 = iTemp2 &amp; 255; iChar128 = ga2_Code128[iCurSet][iTemp2]; iSum += (iWeight*iChar128); iPosition++; iWeight++; if (iCurSet == SUB::SETA) &#123; if (iChar128 == 100) iCurSet = SUB::SETB; else if (iChar128 == 99) iCurSet = SUB::SETC; &#125; else if (iCurSet == SUB::SETB) &#123; if (iChar128 == 101) iCurSet = SUB::SETA; else if (iChar128 == 99) iCurSet = SUB::SETC; &#125; else if (iChar128 == 98) &#123; if (iCurSet == SUB::SETA) iCharNext = ga2_Code128[SUB::SETB][pszCode[iPosition]]; else iCharNext = ga2_Code128[SUB::SETA][pszCode[iPosition]]; iSum += (iWeight*iCharNext); iPosition++; iWeight++; &#125; &#125; &#125; return iSum % 103; &#125;&#125;;//=============================================class BarcodeEan13 :public BarcodeBase &#123;public: BarcodeEan13() &#123; &#125; ~BarcodeEan13() &#123; &#125; BOOL EncodeEan13(const char*pszCodeIn) &#123; Clear(); //only allow 12 characters as input char szCode[14]; const int iLen = strlen(pszCodeIn); if (iLen &gt; 12) &#123; strncpy(szCode, pszCodeIn, 12); &#125; else &#123; strcpy(szCode, pszCodeIn); while (strlen(szCode) &lt; 12) strcat(szCode, &quot;0&quot;); &#125; BYTE*pFst = ia_Buf; BYTE*pb = pFst; //&quot;bsb&quot;-long *pb += 5; pb++; *pb += 4; pb++; *pb += 5; pb++; BYTE iaCountryCode[6]; BOOL b = P_GetCountryCode(szCode[0], iaCountryCode); if (b == 0) return 0; pb = P_GetLeftOddParity(pb, szCode[1]); int i; for (i = 2; i &lt; 7; i++) &#123; if (iaCountryCode[i - 2] == &#x27;O&#x27;) &#123; pb = P_GetLeftOddParity(pb, szCode[i]); &#125; else if (iaCountryCode[i - 2] == &#x27;E&#x27;) &#123; pb = P_GetLeftEvenParity(pb, szCode[i]); &#125; &#125; //&quot;sbsbs&quot;-long *pb += 4; pb++; *pb += 5; pb++; *pb += 4; pb++; *pb += 5; pb++; *pb += 4; pb++; for (i = 7; i &lt; 12; i++) &#123; pb = P_GetRightPattern(pb, szCode[i]); &#125; i = P_GetCheckSumDigit(szCode); pb = P_GetRightPattern(pb, (char)i); //&quot;bsb&quot;-long *pb += 5; pb++; *pb += 4; pb++; *pb += 5; pb++; i_LenBuf = pb - pFst; return 1; &#125; void DrawEan13(HDC hDC, int iX, int iY0, int iY10, int iY11, const COLORREF clrBar, const COLORREF clrSpace, const int iPenW) &#123; DrawBarcode(hDC, iX, iY0, iY10, iY11, clrBar, clrSpace, iPenW); &#125;private: BOOL P_GetCountryCode(char ch, BYTE*pbCountryCode) &#123; const int iV = ch - &#x27;0&#x27;; if (iV &lt; 0) return 0; if (iV &gt; 9) return 0; IntString infs[] = &#123; &#123;0, &quot;OOOOO&quot;&#125;, &#123;1, &quot;OEOEE&quot;&#125;, &#123;2, &quot;OEEOE&quot;&#125;, &#123;3, &quot;OEEEO&quot;&#125;, &#123;4, &quot;EOOEE&quot;&#125;, &#123;5, &quot;EEOOE&quot;&#125;, &#123;6, &quot;EEEOO&quot;&#125;, &#123;7, &quot;EOEOE&quot;&#125;, &#123;8, &quot;EOEEO&quot;&#125;, &#123;9, &quot;EEOEO&quot;&#125;, &#125;; memcpy(pbCountryCode, infs[iV].psz, 5); return 1; &#125; BYTE*P_GetLeftOddParity(BYTE*pb, char ch) &#123; const int iV = ch - &#x27;0&#x27;; if (iV &lt; 0) return 0; if (iV &gt; 9) return 0; IntString infs[] = &#123; &#123;0, &quot;sssbbsb&quot;&#125;, &#123;1, &quot;ssbbssb&quot;&#125;, &#123;2, &quot;ssbssbb&quot;&#125;, &#123;3, &quot;sbbbbsb&quot;&#125;, &#123;4, &quot;sbsssbb&quot;&#125;, &#123;5, &quot;sbbsssb&quot;&#125;, &#123;6, &quot;sbsbbbb&quot;&#125;, &#123;7, &quot;sbbbsbb&quot;&#125;, &#123;8, &quot;sbbsbbb&quot;&#125;, &#123;9, &quot;sssbsbb&quot;&#125;, &#125;; IntString&amp;inf = infs[iV]; int i; for (i = 0; i &lt; 7; i++) &#123; if (inf.psz[i] == &#x27;b&#x27;) *pb += 1; pb++; &#125; return pb; &#125; BYTE*P_GetLeftEvenParity(BYTE*pb, char ch) &#123; const int iV = ch - &#x27;0&#x27;; if (iV &lt; 0) return 0; if (iV &gt; 9) return 0; IntString infs[] = &#123; &#123;0, &quot;sbssbbb&quot;&#125;, &#123;1, &quot;sbbssbb&quot;&#125;, &#123;2, &quot;ssbbsbb&quot;&#125;, &#123;3, &quot;sbssssb&quot;&#125;, &#123;4, &quot;ssbbbsb&quot;&#125;, &#123;5, &quot;sbbbssb&quot;&#125;, &#123;6, &quot;ssssbsb&quot;&#125;, &#123;7, &quot;ssbsssb&quot;&#125;, &#123;8, &quot;sssbssb&quot;&#125;, &#123;9, &quot;ssbsbbb&quot;&#125;, &#125;; char*psz = infs[iV].psz; int i; for (i = 0; i &lt; 7; i++) &#123; if (psz[i] == &#x27;b&#x27;) *pb += 1; pb++; &#125; return pb; &#125; BYTE*P_GetRightPattern(BYTE*pb, char ch) &#123; const int iV = ch - &#x27;0&#x27;; if (iV &lt; 0) return 0; if (iV &gt; 9) return 0; IntString infs[] = &#123; &#123;0, &quot;bbbssbs&quot;&#125;, &#123;1, &quot;bbssbbs&quot;&#125;, &#123;2, &quot;bbsbbss&quot;&#125;, &#123;3, &quot;bssssbs&quot;&#125;, &#123;4, &quot;bsbbbss&quot;&#125;, &#123;5, &quot;bssbbbs&quot;&#125;, &#123;6, &quot;bsbssss&quot;&#125;, &#123;7, &quot;bsssbss&quot;&#125;, &#123;8, &quot;bssbsss&quot;&#125;, &#123;9, &quot;bbbsbss&quot;&#125;, &#125;; char*psz = infs[iV].psz; int i; for (i = 0; i &lt; 7; i++) &#123; if (psz[i] == &#x27;b&#x27;) *pb += 1; pb++; &#125; return pb; &#125; char P_GetCheckSumDigit(const char*pszCode) &#123; const int iLen = strlen(pszCode); int i, iSum = 0, iItem; for (i = iLen; i &gt;= 1; i--) &#123; iItem = i % 2 ? (pszCode[i - 1] - &#x27;0&#x27;) * 1 : (pszCode[i - 1] - &#x27;0&#x27;) * 3; iSum += iItem; &#125; iSum %= 10; return &#x27;0&#x27; + (10 - iSum) % 10; &#125;&#125;;#endif","tags":["C++","æ¡å½¢ç "],"categories":["C++è¯­è¨€"]},{"title":"æ‰¹å¤„ç†è¿è¡Œå¤–éƒ¨ç¨‹åº","path":"/post/2372684836.html","content":"æœ¬æ–‡ä»‹ç»äº†æ‰¹å¤„ç†ä¸­å¯åŠ¨å¤–éƒ¨ç¨‹åºå’Œæ‰¹å¤„ç†çš„å‡ ç§ä¸åŒæ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•è·å–å‘½ä»¤è¿”å›å€¼ï¼Œæœ€åè¿˜ä»‹ç»äº†æ‰¹å¤„ç†ä¸­å‘½ä»¤é¡ºåºæ‰§è¡Œçš„å‡ ç§æ–¹æ³•çš„åŒºåˆ«ã€‚ 1. startã€call å’Œç›´æ¥è¿è¡Œ1.1 startä½¿ç”¨ start å‘½ä»¤æ—¶ï¼Œå½“å‰æ‰¹å¤„ç†ä¸ä¼šç­‰å¾…å¤–éƒ¨ç¨‹åºè¿è¡Œç»“æŸï¼Œè€Œæ˜¯ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ ä½¿ç”¨ start å‘½ä»¤è¿è¡Œå…¶ä»–æ‰¹å¤„ç†å’Œ windows å‘½ä»¤è¡Œç¨‹åºæ—¶ï¼Œè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£ï¼Œå¹¶å°†åœ¨æ–°çš„çª—å£ä¸­è¿è¡Œæ–°çš„ç¨‹åºï¼Œå¦‚ï¼š 123456789@echo offecho 1start ping baidu.comecho 2start notepad.exeecho 3start other.batecho 4pause 1.2 callä½¿ç”¨ call å‘½ä»¤æ—¶ï¼Œå½“å‰æ‰¹å¤„ç†ä¼šç­‰å¾…å¤–éƒ¨ç¨‹åºæˆ–æ‰¹å¤„ç†è¿è¡Œç»“æŸï¼Œç„¶åæ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚å¹¶ä¸”å§‹ç»ˆåœ¨å½“å‰å‘½ä»¤è¡Œçª—å£ä¸­è¿è¡Œå…¶ä»–æ‰¹å¤„ç†å’Œå‘½ä»¤è¡Œç¨‹åºã€‚ 1.3 ç›´æ¥è¿è¡Œç›´æ¥è¿è¡Œä¸ä½¿ç”¨ call å‘½ä»¤ä¸€æ ·ã€‚ä½†ç›´æ¥è¿è¡Œå¤–éƒ¨æ‰¹å¤„ç†æ—¶ä¼šç ´åå½“å‰æ‰¹å¤„ç†çš„è¿è¡Œæµç¨‹ï¼Œä¼šå¯¼è‡´æ‰§è¡Œæµç¨‹æ— æ³•è¿”å›åˆ°å½“å‰æ‰¹å¤„ç†ç»§ç»­æ‰§è¡Œã€‚ 123456789@echo offecho 1ping baidu.comecho 2notepad.exeecho 3other.batecho 4pause ä¸Šè¿°ç¤ºä¾‹ï¼Œæ‰§è¡Œother.batåï¼Œæ— æ³•è¿”å›åˆ°å½“å‰æ‰¹å¤„ç†ï¼Œä»è€Œæ— æ³•æ‰§è¡Œecho 4åŠåé¢è¯­å¥ã€‚ 2. è·å–å‘½ä»¤çš„è¿”å›å€¼åœ¨ Windows æ‰¹å¤„ç†ä¸­ï¼Œ%errorlevel%å˜é‡ä¿å­˜ç€ä¸Šä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼ˆå³mainå‡½æ•°çš„è¿”å›å€¼ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ0 è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œé 0 åˆ™è¡¨ç¤ºæ‰§è¡Œå¤±è´¥ï¼Œå…·ä½“çš„é 0 å€¼çš„å«ä¹‰åˆ™å–å†³äºå…·ä½“çš„å‘½ä»¤ã€‚ åœ¨æ‰¹å¤„ç†è„šæœ¬ä¸­ï¼Œå¯ä»¥æ ¹æ®%errorlevel%çš„å€¼æ¥è¿›è¡Œåç»­çš„å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚ï¼š 1234567891011@echo offREM æ‰§è¡Œä¸€ä¸ªå‘½ä»¤start un-exist.exeREM åˆ¤æ–­å‘½ä»¤æ‰§è¡Œç»“æœif %errorlevel% equ 0 ( echo success) else ( echo failed with: %errorlevel%)pause è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123ç³»ç»Ÿæ‰¾ä¸åˆ°æ–‡ä»¶ un-exist.exeã€‚failed with: 9059è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . . %errorlevel%æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œå› æ­¤ä¸Šé¢ä¾‹å­ä¸­çš„ 9059 æ˜¯ start å‘½ä»¤çš„ç»“æœï¼Œè€Œä¸æ˜¯ un-exist.exe è¿”å›çš„ç»“æœã€‚ 3. é¡ºåºæ‰§è¡ŒWindows æ‰¹å¤„ç†æä¾›äº†&amp;ã€&amp;&amp;ã€||ã€|ã€&gt;ã€&gt;&gt;ç­‰é¡ºåºæ‰§è¡Œæ–¹å¼ï¼Œå®ƒä»¬åŒºåˆ«å¦‚ä¸‹ï¼ˆä¸‹é¢è¯´çš„æ‰§è¡ŒæˆåŠŸæŒ‡çš„æ˜¯å‘½ä»¤è¿”å›å€¼ä¸º 0ï¼‰ï¼š &amp; é¡ºåºæ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œè€Œä¸ç®¡å‰é¢å‘½ä»¤æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ &amp;&amp; é¡ºåºæ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œå½“å‰é¢å‘½ä»¤æ‰§è¡Œå‡ºé”™ï¼Œåé¢çš„å‘½ä»¤å°†ä¸ä¼šæ‰§è¡Œã€‚ || é¡ºåºæ‰§è¡Œå¤šæ¡å‘½ä»¤ï¼Œç›´åˆ°é‡åˆ°æ‰§è¡ŒæˆåŠŸçš„å‘½ä»¤ã€‚ | ç®¡é“å‘½ä»¤ï¼Œå°†å‰ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœè¾“å‡ºåˆ°åä¸€ä¸ªå‘½ä»¤ å¦‚ï¼šhelp|moreã€‚ &gt; æ–‡ä»¶å†™å…¥å‘½ä»¤ï¼Œæ¸…é™¤åŸæ–‡ä»¶ä¸­çš„å†…å®¹åå†å†™å…¥ã€‚ &gt;&gt; æ–‡ä»¶è¿½åŠ å†™å…¥å‘½ä»¤","tags":["æ‰¹å¤„ç†"],"categories":["Windowsæ‰¹å¤„ç†"]},{"title":"å‰åç«¯å¸¸ç”¨æ¦‚å¿µæ‰«ç›²","path":"/post/1162897275.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»å‰åç«¯åŠå®¢æˆ·ç«¯å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›å¸¸ç”¨çš„æŠ€æœ¯æ¦‚å¿µï¼Œæœ¬æ–‡ä¸ä¼šæ¶‰åŠå¤ªæ·±å¥¥çš„æŠ€æœ¯ç»†èŠ‚ã€‚ 1. æµè§ˆå™¨å†…æ ¸åœ¨ Web å¤§è¡Œå…¶é“çš„æ—¶ä»£ï¼Œç½‘æ°‘éœ€è¦ä¸Šç½‘æµè§ˆç½‘é¡µå°±éœ€è¦ä¾èµ–æµè§ˆå™¨è¿™ä¸ªè½¯ä»¶ï¼ŒæŒæ¡äº†æµè§ˆå™¨å°±æŒæ¡äº†æµé‡çš„å…¥å£ï¼Œäºæ˜¯å„å¤§è½¯ä»¶å…¬å¸å¼€å§‹ç ”å‘è‡ªå·±å“ç‰Œçš„æµè§ˆå™¨ï¼Œä¸åŒå“ç‰Œçš„æµè§ˆå™¨å…¶å®ç°åŸç†å½“ç„¶æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™ä¸ªå®ç°åŸç†å°±æ˜¯æµè§ˆå™¨çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ç§°å…¶æµè§ˆå™¨å†…æ ¸ã€‚ ç°åœ¨å¸‚é¢ä¸Šæœ‰è¿™ä¹ˆå¤šçš„æµè§ˆå™¨ï¼Œå¦‚ Chromeï¼ŒQQ æµè§ˆå™¨ï¼Œæœç‹—æµè§ˆå™¨ï¼Œè¿™äº›æµè§ˆå™¨å‚å•†æ˜¯ä¸æ˜¯éƒ½æ˜¯è‡ªå·±ç ”å‘æµè§ˆå™¨å†…æ ¸äº†ï¼Ÿä¸æ˜¯çš„ï¼ å› ä¸ºæœ‰äº›å…¬å¸æˆ–è€…å›¢ä½“å°†æµè§ˆå™¨å†…æ ¸è¿›è¡Œäº†å¼€æºï¼Œæ–¹ä¾¿å…¶ä»–äººåŸºäºè¯¥å†…æ ¸è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå¸¸è§çš„å¼€æºæµè§ˆå™¨å†…æ ¸æœ‰ Chromiumã€WebKitã€Geckoã€‚ æ­£å› ä¸ºæœ‰äº†è¿™äº›å¼€æºå†…æ ¸çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨è‡ªå·±å¼€å‘å†…æ ¸ä¹Ÿå¯ä»¥å¼€å‘å±äºè‡ªå·±å“ç‰Œçš„æµè§ˆå™¨ï¼Œæ¯”å¦‚ QQ æµè§ˆå™¨ï¼Œæœç‹—æµè§ˆå™¨ï¼Œ360 æµè§ˆå™¨éƒ½æ˜¯åŸºäº IE å†…æ ¸å’Œ Chromium å†…æ ¸äºŒæ¬¡å°è£…è€Œæˆï¼Œç¾å…¶åæ›°åŒå¼•æ“ï¼ˆåŒå†…æ ¸ï¼‰ã€‚ ç›®å‰å¸‚é¢ä¸Šæµè¡Œçš„æ‹¥æœ‰è‡ªä¸»å†…æ ¸çš„æµè§ˆå™¨ï¼š æµè§ˆå™¨ å†…æ ¸ Chrome Chromium Safari WebKit Firefox Gecko IE IE å†…æ ¸ 2. JavaScript, ECMAScript, ES6, TypeScriptJavaScriptæ˜¯ä¸€ä¸ªç¼–ç¨‹è¯­è¨€çš„åç§°ï¼Œç±»ä¼¼ Javaï¼ŒC++ï¼ŒPHPï¼Œæ˜¯ç”± Netscape å…¬å¸å¼€å‘çš„ä¸€ç§è§£é‡Šæ€§ç¼–ç¨‹è¯­è¨€ï¼Œå…¶è¿è¡Œçš„å®¿ä¸»ç¯å¢ƒå¤§å¤šæ˜¯æµè§ˆå™¨ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç¯å¢ƒï¼Œå¦‚ Nodeã€‚ å› ä¸º Netscape å…¬å¸å¸Œæœ›JavaScriptæˆä¸ºä¸€ç§æµè§ˆå™¨è„šæœ¬è¯­è¨€çš„æ ‡å‡†è§„èŒƒï¼Œäºæ˜¯åœ¨ 1996 å¹´å°† JavaScript æäº¤ç»™æ ‡å‡†åŒ–ç»„ç»‡ ECMAã€‚æ¬¡å¹´ï¼ŒECMA å°±å‘å¸ƒäº†æ ‡å‡†æ–‡ä»¶ï¼ˆECMA-262ï¼‰çš„ç¬¬ä¸€ç‰ˆï¼Œè§„å®šäº†æµè§ˆå™¨è„šæœ¬è¯­è¨€çš„æ ‡å‡†ï¼Œå¹¶å°†è¿™ç§æ ‡å‡†ç§°ä¸º ECMAScriptã€‚ æ‰€ä»¥è¯´ï¼ŒECMAScriptæ˜¯ä¸€ä¸ªçš„æµè§ˆå™¨è„šæœ¬è¯­è¨€çš„æ ‡å‡†è§„èŒƒã€‚ ä¸åŒçš„æµè§ˆå™¨å†…æ ¸åŠä¸åŒçš„ç‰ˆæœ¬å¯¹ECMAScriptè§„èŒƒçš„æ”¯æŒæƒ…å†µä¸åŒï¼Œ æˆªè‡³ 2012 å¹´ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½å®Œæ•´çš„æ”¯æŒECMAScript 5.1ï¼› ä»ECMAScript 6å¼€å§‹ï¼Œæ ‡å‡†åˆ¶å®šè€…å†³å®šä¸å†ç”¨è¯¸å¦‚â€3.1, 5.0â€è¿™æ ·çš„ç‰ˆæœ¬å·æ¥å‘½åï¼Œè€Œæ˜¯æ¯å¹´ 6 æœˆå‘å¸ƒä¸€ä¸ª ECMAScript çš„æ­£å¼ç‰ˆï¼Œå¹¶ä¸”ä»¥å½“å¹´çš„å¹´ä»½æ¥å‘½åï¼Œ å¦‚ 2015 å¹´ 6 æœˆ 17 æ—¥ ECMA å›½é™…ç»„ç»‡å‘å¸ƒäº† ECMAScript çš„ç¬¬å…­ç‰ˆï¼Œè¯¥ç‰ˆæœ¬æ­£å¼åç§°ä¸ºECMAScript 2015ã€‚ ES6åªæ˜¯ECMAScript 6ç‰ˆæœ¬çš„ç®€ç§°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ECMAScript 6æ¥ç»Ÿç§°ECMAScript 2015åŠå…¶ä»¥åçš„ç‰ˆæœ¬ã€‚ TypeScriptæ˜¯ç”±å¾®è½¯å¼€å‘çš„ä¸€ç§å¼€æºçš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒæ˜¯ JavaScript çš„ä¸€ä¸ªä¸¥æ ¼è¶…é›†ï¼Œå¹¶æ·»åŠ äº†é™æ€ç±»å‹åŠå…¶ä»–ç‰¹æ€§ã€‚TypeScriptç›®å‰å·²ç»æ”¯æŒECMAScript 2015ã€‚ 3. CSS, CSS3CSSå³Cascading Style Sheetså±‚å æ ·å¼è¡¨çš„ç®€ç§°ï¼Œåœ¨ Web å¼€å‘ä¸­ç”¨æ¥å®šä¹‰å…ƒç´ æ ·å¼çš„ä¸€ç§æ ‡è®°å‹è¯­è¨€ã€‚CSS3æ˜¯ CSSï¼ˆå±‚å æ ·å¼è¡¨ï¼‰çš„å‡çº§ç‰ˆæœ¬ï¼Œ2001 å¹´ 5 æœˆ 23 æ—¥ W3C å®Œæˆäº† CSS3 çš„å·¥ä½œè‰æ¡ˆã€‚ 4. V8, Node, Node.js, npm, YarnV8ï¼Œæˆ‘ä»¬é€šå¸¸å«åš V8 å¼•æ“ï¼Œç„¶è€Œå…¶å¹¶ä¸æ˜¯æ±½è½¦å‘åŠ¨æœºçš„ V8 å¼•æ“ï¼Œè€Œæ˜¯ç”± Google å¼€å‘å¹¶å¼€æºçš„ä¸€ä¸ªé¡¹ç›®ï¼Œå¯ä»¥è§£é‡Šå’Œæ‰§è¡Œ JavaScriptï¼Œå› ä¸ºå…¶æ€§èƒ½éå¸¸é«˜ï¼Œç›®å‰å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå¦‚ Node.js å°±æ˜¯åŸºäºè¯¥å¼•æ“è€Œå¼€å‘ã€‚ Node.js å’Œ Node æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼ŒNode æ˜¯ Node.js çš„ç®€ç§°ã€‚ npmï¼ˆnode package managementï¼‰æ˜¯ Node.js çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œç›®å‰å·²ç»å†…ç½®åˆ°äº† Node.js ä¸­ï¼Œä¸éœ€è¦å†å•ç‹¬å®‰è£…ã€‚ yarnä¹Ÿæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œç”± Facebookã€Googleã€Exponent å’Œ Tilde è”åˆæ¨å‡ºï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å¼¥è¡¥ npm çš„ä¸€äº›ç¼ºé™·ã€‚ 5. React, Vue, Angularè¿™ 3 ä¸ªè¯´ç™½äº†éƒ½æ˜¯ Javascript åº“ã€‚ æˆ‘ä»¬æœ€åˆå¼€å‘ Web çš„æ—¶å€™ç”¨çš„æ˜¯HTML+CSS+JavaScriptï¼Œåæ¥æœ‰äººè§‰å¾—ç”¨çº¯ js æ’¸å¤ªç¹çäº†ï¼Œå°±æœ‰äº†åæ¥çš„ jQuery è¿™æ ·çš„ JavaScript åº“ï¼Œä½†éšç€ä¸šåŠ¡çš„æ‰©å¢ï¼Œæ•°æ®äº¤äº’è¶Šæ¥è¶Šå¤æ‚ï¼Œä½¿ç”¨ jQuery ä¹Ÿå¤ªç¹çäº†ï¼Œäºæ—¶åˆæœ‰äº† React, Vue, Angular è¿™æ ·çš„åº“ã€‚ æ€»ä¹‹ï¼Œå‰ç«¯ç”Ÿæ€çœŸç¹è£ã€‚ã€‚ã€‚ã€‚ 6. Ant Design, Element UIå‰é¢è¯´åˆ°äº† React, Vue, Angularï¼Œè™½ç„¶åˆäº†è¿™äº›åº“ï¼Œæ•°æ®äº¤äº’æ–¹é¢å˜å¾—ç®€å•äº†ï¼Œä½†é¡µé¢æ•ˆæœè¿˜æ˜¯éœ€è¦ CSS å’Œ JS ä¸€è¡Œè¡Œä»£ç æ¥å®ç°çš„ï¼Œæ¯”å¦‚è¦å®ç°ä¸€ä¸ªä¸‹æ‹‰åˆ—è¡¨ï¼ŒåŠ¨æ€æŒ‰é’®ç­‰ã€‚äºæ—¶ç°åœ¨åˆå‡ºç°äº†ä¸€äº›åŸºäº React, Vue å’Œ Angular è¿™äº›åº“çš„ UI ç»„ä»¶åº“ï¼Œè¿™äº› UI åº“å°†å¸¸ç”¨çš„ç»„ä»¶å°è£…å¥½äº†ï¼Œåœ¨å¼€å‘ä¸­ç›´æ¥å¼•å…¥ä½¿ç”¨ï¼Œæ”¹æ”¹å±æ€§ï¼Œè®¾ç½®ä¸‹å‚æ•°å³å¯ã€‚ 7. Scaffold(è„šæ‰‹æ¶)é€šä¿—çš„è®²å°±æ˜¯å°†ä¸€äº›é‡å¤æ€§çš„äº‹æƒ…æ•´åˆæˆä¸€ä¸ªå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å°±å¯ä»¥å«è„šæ‰‹æ¶ã€‚ 8. MySQL, Redis, MongoDB, Oracle, PostgreSQL, NoSQLæ•°æ®åº“ç›®å‰åˆ†ä¸ºå…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®ï¼ˆå³ NoSQLï¼‰ï¼Œä¸åŒç±»å‹çš„æ•°æ®å„æœ‰å…¶ç‰¹ç‚¹ã€‚åŒæ ·ï¼ŒåŒä¸€ç±»å‹ä½†ä¸åŒå“ç‰Œçš„æ•°æ®åº“ä¹Ÿå„æœ‰å…¶ç‰¹ç‚¹å’Œåº”ç”¨é¢†åŸŸ ã€‚ ä¸èƒ½å•çº¯çš„è¯„åˆ¤å“ªç§æ•°æ®åº“çš„å¥½åï¼Œä¸€ä¸ªé¡¹ç›®ä¸­å¯èƒ½åŒæ—¶ç”¨åˆ°å¤šä¸ªä¸åŒç§ç±»çš„æ•°æ®åº“ã€‚ 1ã€å…³ç³»æ•°æ®åº“MySQLã€MariaDBã€PostgreSQLã€Microsoft Accessã€Microsoft SQL Serverã€Oracleã€Sybase ç­‰ç­‰ã€‚ 2ã€éå…³ç³»å‹æ•°æ®åº“ï¼ˆNoSQLï¼‰BigTableï¼ˆGoogleï¼‰ã€Cassandraã€MongoDBã€CouchDBã€Redis ç­‰ç­‰ã€‚ 9. Nginx, Apacheéƒ½æ˜¯ Web æœåŠ¡å™¨ï¼Œä¸åŒçš„å›¢é˜Ÿç ”å‘ï¼Œå„æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚ 10. åå‘ä»£ç†åå‘ä»£ç†å•çº¯ä»åå­—ä¸Šç†è§£å°±æ˜¯æ­£å‘ä»£ç†çš„åæ–¹å‘ã€‚ é‚£ä»€ä¹ˆæ˜¯æ­£å‘ä»£ç†ï¼Ÿä»£ç†å†…éƒ¨ç½‘ç»œè®¿é—®å¤–éƒ¨ç½‘ç»œçš„ä»£ç†å°±æ˜¯æ­£å‘ä»£ç†ï¼Œæ¯”å¦‚ä½ éœ€è¦ä»å…¬å¸å±€åŸŸç½‘ä¸­çš„ç”µè„‘ A ç»è¿‡ä»£ç†æœåŠ¡å™¨ B è®¿é—®ç½‘ç«™ Cï¼š 1A --&gt; B --&gt; C å¦‚æœä½ è®¤ä¸º A æ˜¯å†…éƒ¨ç½‘ç»œï¼ŒC æ˜¯å¤–éƒ¨ç½‘ç»œï¼Œé‚£ B å°±æ˜¯æ­£å‘ä»£ç†ï¼› å¦‚æœä½ è®¤ä¸º A æ˜¯å¤–éƒ¨ç½‘ç»œï¼ŒC æ˜¯å†…éƒ¨ç½‘ç»œï¼ˆå½“ç„¶æˆ‘ä»¬ä¸€èˆ¬ä¸è¿™ä¹ˆè®¤ä¸ºï¼‰ï¼Œé‚£ä¹ˆ B å°±æ˜¯åå‘ä»£ç†ã€‚ 11. RESTfulä¸€åˆ‡å…·æœ‰ REST ç‰¹æ€§çš„æœåŠ¡éƒ½å¯ä»¥æˆä¸º RESTful æœåŠ¡ï¼Œé‚£ä¹ˆ REST ç‰¹æ€§æ˜¯ä»€ä¹ˆäº†ï¼Ÿ REST æ˜¯Representational state transferçš„ç¼©å†™ï¼Œç»´åŸºç™¾ç§‘ä¸Šçš„è§£é‡Šä¸ºï¼š 1Representational State Transfer (REST) is a software architecture style consisting of guidelines and best practices for creating scalable web services. REST is a coordinated set of constraints applied to the design of components in a distributed hypermedia system that can lead to a more performant and maintainable architecture. REST æ˜¯ä¸€ç§æ¶æ„é£æ ¼, åªæœ‰æ»¡è¶³è¿™äº›çº¦æŸï¼Œæ‰èƒ½ç§°ä¹‹ä¸ºç¬¦åˆ REST æ¶æ„é£æ ¼ã€‚REST çš„çº¦æŸå¤§è‡´åŒ…æ‹¬ï¼š å®¢æˆ·ç«¯-æœåŠ¡å™¨ç»“æ„ æ— çŠ¶æ€ å¯ç¼“å­˜ æŒ‰éœ€ä»£ç ï¼ˆå¯é€‰ï¼‰ ç»Ÿä¸€æ¥å£ æŒç»­æ›´æ–°ä¸­â€¦.","tags":["Web"],"categories":["Webç¼–ç¨‹"]},{"title":"TypescriptåŸºç¡€è¯­æ³•","path":"/post/2248228478.html","content":"å¦‚æœä½ è¿˜ä¸äº†è§£ TypeScript æ˜¯ä»€ä¹ˆï¼Œæˆ–è€…å…¶ä¸ JavaScript ä¹‹å‰çš„å…³ç³»ï¼Œå¯ä»¥å‚è€ƒï¼š- å‰åç«¯å¸¸ç”¨æ¦‚å¿µæ‰«ç›² TypeScript æ˜¯ JavaScript çš„ä¸€ä¸ªè¶…é›†ï¼Œæ”¯æŒ ES6 çš„è¯­æ³•è§„èŒƒï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å¢å¼ºï¼ŒäºŒè€…æœ€å¤§çš„ä¸åŒåœ¨äºï¼šTypeScript æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œè€Œ JavaScript æ˜¯å¼±ç±»å‹çš„è¯­è¨€ã€‚ æœ¬æ–‡å°†ç€é‡ä»‹ç»äºŒè€…çš„ä¸åŒä¹‹å¤„ã€‚ ä¸€ã€å˜é‡å£°æ˜TypeScript æ”¯æŒä½¿ç”¨varã€letã€constè¿›è¡Œå˜é‡å£°æ˜ï¼Œä½†å»ºè®®ä¸è¦ä½¿ç”¨varã€‚TypeScript å£°æ˜å˜é‡æ—¶ï¼Œå¯ä»¥å¼ºåˆ¶æŒ‡å®šå˜é‡ç±»å‹æˆ–è€…ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ä»â€œå€¼â€æ¨å¯¼å‡ºå˜é‡ç±»å‹ï¼Œä½†æ— è®ºå“ªç§æƒ…å†µï¼Œä¸€æ—¦ç¡®å®šäº†ç±»å‹ï¼Œåé¢ä¸èƒ½å†æ¬¡è¢«èµ‹å€¼ä¸ºå…¶ä»–ç±»å‹ï¼š 123456789let a = 1;a = 10;a = &quot;x&quot;; âŒlet b : number = 12;let c : number = &quot;x&quot;; âŒlet fibonacci: number[] = [1, 1, 2, 3, 5];let fibonacci: number[] = [1, &#x27;1&#x27;, 2, 3, 5];âŒ äºŒã€å‡½æ•°å‚æ•°TypeScript è¦æ±‚ï¼šè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸å‡½æ•°å£°æ˜çš„å‚æ•°ä¸€è‡´ï¼ˆä¸ªæ•°åŠç±»å‹ï¼‰ï¼Œå¦‚ï¼š 123456function sum(x: number, y: number): number &#123; return x + y;&#125;sum(1, 2, 3); âŒsum(1);âŒsum(1, &quot;x&quot;); âŒ TypeScript è¦æ±‚ï¼šå¯é€‰å‚æ•°å¿…é¡»åœ¨å‚æ•°åˆ—è¡¨çš„æœ€åï¼Œå¦‚ï¼š 1234567function buildName(firstName?: string, lastName: string) &#123;âŒ if (firstName) &#123; return firstName + &#x27; &#x27; + lastName; &#125; else &#123; return lastName; &#125;&#125; ä¸‰ã€æšä¸¾æšä¸¾æ˜¯ TypeScript ç‰¹æœ‰çš„ï¼šç¬¬ä¸€ä¸ªå…ƒç´ æ²¡æœ‰èµ‹å€¼ï¼Œåˆ™é»˜è®¤ä¸º 0ï¼Œåé¢çš„å…ƒç´ çš„å€¼ä¾æ­¤é€’å¢ï¼š 123456789enum Days &#123; Sun, // 0 Mon, // 1 Tue, // 2 Wed, Thu, Fri, Sat&#125;; ä¹Ÿæ”¯æŒï¼š 123456789enum Days &#123; Sun = 1, // 1 Mon, // 2 Tue, // 3 Wed = 10, // 10 Thu, // 11 Fri, // 12 Sat // 13&#125;; æšä¸¾å…ƒç´ å¯ä»¥æ˜¯å¸¸é‡å€¼æˆ–æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘æœŸè®¡ç®—å¾—å‡ºçš„å€¼ï¼š 123456789enum FileAccess &#123; // å¸¸é‡å€¼ None, // 0 Read = 1 &lt;&lt; 1, Write = 1 &lt;&lt; 2, ReadWrite = Read | Write, // è®¡ç®—å¾—å‡ºçš„å€¼ G = &quot;123&quot;.length&#125; å››ã€ç±»ç›¸æ¯”ES6ï¼ŒTypeScriptæ–°å¢äº†ç»§æ‰¿ã€æˆå‘˜è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ã€‚è¶Šæ¥è¶Šæœ‰ Javaã€C++çš„å‘³é“äº†ã€‚ 4.1 ç»§æ‰¿ã€æˆå‘˜è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦TypeScript ç»§æ‰¿éœ€è¦ä½¿ç”¨extendså…³é”®å­—ï¼Œåªæ”¯æŒå•ç»§æ‰¿ï¼Œè¿™ç‚¹ä¸åŒäº C++ã€‚ç±»ç»§æ‰¿åï¼Œå­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536class Person &#123; private id: string; // ç§æœ‰çš„ï¼Œåªèƒ½è¢«è‡ªèº«è®¿é—® protected name: string; // å—ä¿æŠ¤ï¼Œå¯ä»¥è¢«å…¶è‡ªèº«ä»¥åŠå…¶å­ç±»å’Œçˆ¶ç±»è®¿é—® protected age: number; // å…¬å¼€çš„ public getId() : string &#123; return this.id; &#125; public getName() : string &#123; return this.name; &#125; public getAge() : number &#123; return this.age; &#125; public print() : void &#123; console.log(&quot;name:&quot; + this.name + &quot;, age:&quot; + this.age); &#125;&#125;class Student extends Person &#123; private grade : number; public getGrade() : number &#123; return this.grade; &#125; public print() : void &#123; // é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³• super.print(); // ä½¿ç”¨superç›´æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³• console.log(&quot;grade:&quot; + this.grade); &#125;&#125; 4.2 instanceofinstanceof è¿ç®—ç¬¦ç”¨äºåˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯æŒ‡å®šçš„ç±»å‹ï¼Œå¦‚æœæ˜¯è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ 123class Person &#123;&#125;let obj = new Person();let isPerson: boolean = obj instanceof Person; 4.3 interface æ¥å£TypeScript æ–°å¢ interface æ¥å£çš„æ¦‚å¿µï¼Œè¿™ä¸ªæ¥å£çš„æ¦‚å¿µå’Œ Java ä¸­çš„ interface ç±»ä¼¼ï¼Œå³ï¼šåªæœ‰å®šä¹‰æ²¡æœ‰å®ç°ã€‚ åŒæ—¶ï¼Œæ¥å£ä¹Ÿæ”¯æŒç»§æ‰¿ã€‚ 1234567891011121314interface IPerson &#123; name: string;&#125;interface IStudent extends IPerson &#123; // æ¥å£çš„ç»§æ‰¿ grade: number;&#125;class Student implements IStudent &#123; // å®ç°æ¥å£çš„ç±» name: string; grade: number;&#125; äº”ã€å‘½åç©ºé—´TypeScript ä¸­çš„å‘½åç©ºé—´çš„æ¦‚å¿µå’Œ C++ä¸­çš„å‘½åç©ºé—´çš„æ¦‚å¿µä¸€æ ·ï¼Œè€Œä¸”å…³é”®å­—ä¹Ÿéƒ½æ˜¯namespaceã€‚ ç¨æœ‰ä¸åŒçš„æ˜¯ï¼ŒC++ä¸éœ€è¦å°†å‘½åç©ºé—´ä¸­çš„å†…å®¹æš´éœ²å‡ºæ¥ï¼ŒC++é»˜è®¤å°±æ˜¯å…¨éƒ¨æš´éœ²çš„ï¼Œè€Œ TypeScript éœ€è¦æ‰‹åŠ¨æ·»åŠ  export å…³é”®å­—å°†å‘½åç©ºé—´çš„ä¸­çš„å†…å®¹æš´éœ²å‡ºæ¥ï¼š 12345678910namespace XYZ &#123; export let name : string; export class Person &#123; &#125; export interface IPerson &#123; &#125;&#125;XYZ.name = &quot;jeff&quot;;","tags":["Web","TypeScript"],"categories":["Webç¼–ç¨‹"]},{"title":"ECMAScript6åŸºç¡€è¯­æ³•","path":"/post/51642520.html","content":"ECMAScript æ ‡å‡†çš„å‘å±•ç»å†äº†ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œä» 1997 å¹´å‘å¸ƒçš„ECMAScript 1.0ï¼Œåˆ° 2011 å¹´çš„ECMAScript 5.1ï¼Œå†åˆ° 2015 å¹´çš„ECMAScript 2015ï¼Œä»¥åŠåé¢æ¯å¹´éƒ½ä¼šå‘å¸ƒçš„ä¸€ä¸ªæ–°çš„ ECMAScript ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¼—å¤šï¼Œè€Œä¸”æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰æ–°ç‰¹æ€§çš„åŠ å…¥ã€‚ æˆ‘ä»¬é€šå¸¸ç”¨ECMAScript 6æ¥ç»Ÿç§°ECMAScript 2015åŠå…¶ä¹‹åçš„çš„ç‰ˆæœ¬ã€‚ ä½†ECMAScript 2015å¯è°“æ˜¯ ECMAScript æ ‡å‡†çš„åˆ†æ°´å²­ï¼Œå…¶ä»åˆ¶å®šåˆ°å‘å¸ƒå‰åç»å†äº† 15 å¹´ã€‚ç›®å‰ç»å¤§å¤šæ•°æµè§ˆå™¨éƒ½å·²æ”¯æŒECMAScript 2015ç‰¹æ€§ï¼Œå¹¶éƒ¨åˆ†çš„æ”¯æŒäº†åé¢ç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼Œæ‰€ä»¥å¯¹äºéœ€è¦å¿«é€Ÿå…¥é—¨çš„åˆå­¦è€…ï¼Œåªéœ€è¦ç›´æ¥å­¦ä¹ ECMAScript 2015æ ‡å‡†å³å¯ï¼Œç¼–å†™å®Œå…¨éµå®ˆECMAScript 2015æ ‡å‡†çš„ä»£ç ä¸ä»…æ›´åŠ ä¸¥è°¨ï¼Œè€Œä¸”å¯ä»¥èŠ‚çœä¸å°‘å­¦ä¹ æ—¶é—´ã€‚ å³ä¾¿å¯¹äºé‚£äº›ä¸æ”¯æŒECMAScript 6çš„æµè§ˆå™¨ï¼ˆå¦‚ IE11ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Babelä¹‹ç±»çš„å·¥å…·å°†å…¶è½¬æ¢ä¸ºECMAScript 5æ ‡å‡†çš„ä»£ç ã€‚ æŸ¥çœ‹æµè§ˆå™¨å¯¹ ES ç‰¹æ€§çš„æ”¯æŒæƒ…å†µï¼Œå¯ä»¥è®¿é—®ï¼šhttps://kangax.github.io/compat-table/es6/ ä¸‹æ–‡è®²è¿°çš„éƒ½æ˜¯æ”¯æŒ ECMAScript 6 æ ‡å‡†çš„ JavaScript è¯­æ³• é›¶ JavaScript æ˜¯å¤§å°å†™æ•æ„Ÿçš„ åœ¨æ¯è¡Œåªå†™ä¸€æ¡è¯­å¥æ—¶ï¼Œç»“å°¾å¯ä»¥ä¸åŠ åˆ†å·;ï¼Œä½†å»ºè®®æ¯æ¡è¯­å¥éƒ½ä»¥åˆ†å·ç»“å°¾ ä¸€ã€ä¸ƒç§åŸºæœ¬æ•°æ®ç±»å‹åŸºæœ¬æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹ 7 ç§ï¼š undefined null Boolean String Number Object Symbol JavaScript è™½ç„¶æ˜¯å¼±ç±»å‹çš„è¯­è¨€ï¼Œä½†ä¸ä»£è¡¨å…¶æ²¡æœ‰æ•°æ®ç±»å‹ï¼Œå…¶å¼±ç±»å‹æŒ‡çš„æ˜¯åœ¨å£°æ˜å˜é‡çš„æ—¶å€™ä¸éœ€è¦ï¼ˆä¹Ÿä¸èƒ½ï¼‰æŒ‡æ˜å˜é‡ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®â€œå€¼â€çš„ç±»å‹è‡ªåŠ¨å°†å˜é‡è½¬æ¢æˆåˆé€‚çš„ç±»å‹ã€‚ æ‰€ä»¥æ— è®ºæ˜¯å€¼è¿˜æ˜¯å˜é‡ç»ˆç©¶è¿˜æ˜¯æœ‰ç±»å‹çš„ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œä¸éœ€è¦å…³æ³¨ä»€ä¹ˆç±»å‹çš„å€¼åº”è¯¥èµ‹å€¼ç»™ä»€ä¹ˆç±»å‹çš„å˜é‡ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typeofæŸ¥çœ‹æ¯ä¸ªå˜é‡æˆ–å€¼çš„ç±»å‹ï¼š 1234567console.log(typeof 123); // numberconsole.log(typeof &quot;abc&quot;); // stringconsole.log(typeof true); // booleanconsole.log(typeof undefined); // undefinedconsole.log(typeof null); // objectconsole.log(typeof [1, 2, 3, 4]); // objectconsole.log(typeof function () &#123;&#125;); // function å€¼å¾—æ³¨æ„çš„æ˜¯undefinedçš„ç±»å‹æ˜¯undefinedï¼Œä½†nullçš„ç±»å‹æ˜¯objectï¼Œä¸‹é¢çš„ç« èŠ‚ä¼šä»‹ç»undefinedå’Œnullçš„åŒºåˆ«ã€‚ äºŒã€å˜é‡å£°æ˜æ–¹å¼å£°æ˜å˜é‡çš„æ–¹å¼æœ‰ 3 ç§ï¼š let ç”¨æ¥å£°æ˜å˜é‡ var ä¹Ÿæ˜¯ç”¨æ¥å£°æ˜å˜é‡çš„ const ç”¨æ¥å£°æ˜å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™èµ‹åˆå§‹å€¼ï¼Œä¸”ä»¥åä¸èƒ½å†ä¿®æ”¹ varæ˜¯ES6ä¹‹å‰çš„ï¼Œå»ºè®®ä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨ varï¼Œè¿™æ ·å¯ä»¥é¿å…å¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜ï¼Œæ¯”å¦‚å˜é‡æå‡ã€æš‚æ—¶æ€§æ­»åŒºç­‰ï¼Œæœ¬æ–‡ä¹Ÿåªè®²è¿°letå’Œconstï¼Œå¿˜è®°varå§ï¼Œä¸€èµ·èµ°å‘æ–°ä¸–ç•Œã€‚ 2.1 å˜é‡å…·æœ‰ä½œç”¨åŸŸçš„æ¦‚å¿µç”¨ let å’Œ const å£°æ˜çš„å˜é‡æˆ–å¸¸é‡çš„ä½œç”¨åŸŸå¯ä»¥ç²¾ç¡®åˆ°â€œå—çº§åˆ«â€ 12345&#123; let a = 1; console.log(a); // 1&#125;console.log(a); // ReferenceError: a is not defined 1234for (let i = 0; i &lt; 10; i++) &#123; console.log(i); // ä¾æ¬¡è¾“å‡º0~9&#125;console.log(i); // ReferenceError: i is not defined 1234567let a = 123;if (true) &#123; let a = 789;&#125;console.log(a); // 123 12345678910// æ— è®ºæ˜¯letè¿˜æ˜¯constéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†…ä¸èƒ½é‡å¤å£°æ˜&#123; let a = 123; let a = 456; // SyntaxError: Identifier &#x27;a&#x27; has already been declared&#125;&#123; let a = 123; const a = 456; // SyntaxError: Identifier &#x27;a&#x27; has already been declared&#125; 2.2 å—çº§ä½œç”¨åŸŸå†…çš„ letåªè¦â€œå—çº§ä½œç”¨åŸŸå†…â€å­˜åœ¨ let å‘½ä»¤ï¼Œå®ƒæ‰€å£°æ˜çš„å˜é‡å°±â€œç»‘å®šâ€åˆ°è¿™ä¸ªåŒºåŸŸï¼Œä¸å†å—å¤–éƒ¨çš„å½±å“ 12345678let a = 123;if (true) &#123; a = 456; // ReferenceError: Cannot access &#x27;a&#x27; before initialization let a = 789;&#125;console.log(a); // 123 è¿™ä¸ªå’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œå¦‚æœæ˜¯ C&#x2F;C++è¿™æ ·çš„è¯­è¨€æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œåªä¼šåœ¨let a = 789;ç»™å‡ºâ€œå±€éƒ¨å˜é‡è¦†ç›–äº†å…¨å±€å˜é‡â€çš„è­¦å‘Šã€‚ ä½†åœ¨ ES6 ä¸­å´ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ä¸ºâ€œå¼ºé¾™å‹ä¸è¿‡åœ°å¤´è›‡â€ï¼šæˆ‘ç”¨let a = 789;åœ¨è“è‰²åŒºåŸŸå†…å£°æ˜äº†å˜é‡aï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè“è‰²åŒºåŸŸçš„ä¸€äº©ä¸‰åˆ†åœ°å†…çš„éƒ½æ˜¯æˆ‘è¯´äº†ç®—ï¼Œa = 456;æ•¢åœ¨æˆ‘è¿˜æ²¡å£°æ˜å‰éƒ½èµ‹å€¼ï¼Œé‚£æˆ‘è¿˜ä¸ç»™ä½ æŠ¥ä¸ªé”™ã€‚ 2.3 for å¾ªç¯çš„å˜é‡ä½œç”¨åŸŸfor å¾ªç¯è®¾ç½®å¾ªç¯å˜é‡çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ªçˆ¶ä½œç”¨åŸŸï¼Œè€Œå¾ªç¯ä½“å†…éƒ¨æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­ä½œç”¨åŸŸ 1234for (let i = 0; i &lt; 10; i++) &#123; let i = &quot;abc&quot;; console.log(i); // abc&#125; è™½ç„¶ç¼–è¯‘å™¨æ²¡æœ‰æŠ¥é”™ï¼Œä½†å°½é‡ä¸è¦å†™è¿™æ ·ä»£ç ï¼Œä¸åˆ©äºåæœŸç»´æŠ¤ã€‚ ä¸‰ã€Object ä¸ ClassObjectï¼ˆå¯¹è±¡ï¼‰æ˜¯ ES5 å°±å·²ç»æœ‰çš„æ¦‚å¿µï¼ŒClassï¼ˆç±»ï¼‰æ˜¯ ES6 å¼•å…¥çš„æ¦‚å¿µã€‚ 3.1 å…³äº JavaScript ä¸­ç±»å’Œå¯¹è±¡çš„å«æ³•å­¦è¿‡ä»»ä½•ä¸€ä¸ªé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„åŒå­¦éƒ½çŸ¥é“ï¼Œå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œæ¯”å¦‚åœ¨ Java ä¸­ï¼š 1A a = new A(); aä¸ºå¯¹è±¡ï¼ŒAä¸ºç±»ï¼Œä¹Ÿå°±æ˜¯â€œå¯¹è±¡ a ä¸ºç±»å‹ A çš„å®ä¾‹â€ã€‚ è€Œå¤§å®¶å¯èƒ½ä¹Ÿå‘ç°äº†å¾ˆå¤š JavaScript æ•™ç¨‹ç§°Objectã€Numberã€Stringä¸ºå¯¹è±¡ï¼Œå¦‚æœæ ¹æ®è¿™ä¸ªç§°å‘¼æ¥ï¼Œä¸‹é¢çš„ä»£ç å²‚ä¸æ˜¯â€œå¯¹è±¡ a ä¸ºå¯¹è±¡ Number çš„å®ä¾‹â€ï¼Œå¾ˆæ˜¾ç„¶åœ¨è¿™ç§å«æ³•å¾ˆåˆ«æ‰­ï¼Œä¹Ÿä¸ç§‘å­¦ï¼š 1let a = new Number(123); ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§è¹©è„šçš„å«æ³•äº†ï¼Ÿå› ä¸ºåœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript ä¸­æ²¡æœ‰å®Œå…¨å¼•å…¥Classç±»çš„æ¦‚å¿µï¼Œå…¶æœ€å¤šåªèƒ½ç®—æ˜¯ä¸€ä¸ªä¼ªçš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä¼°è®¡ä¹Ÿæ˜¯ä¸ºäº†é™ä½å­¦ä¹ ç†è§£çš„éš¾åº¦ï¼Œæ‰€ä»¥ç»Ÿç§°ä¸ºå¯¹è±¡å§ã€‚ æ—¢ç„¶åœ¨ ES6 ä¸­æ˜ç¡®å¼•å…¥äº† Class æ¦‚å¿µï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ çš„æ—¶å€™å°±è¦æ˜ç¡®åŒºåˆ†â€œç±»â€å’Œâ€œå¯¹è±¡â€çš„æ¦‚å¿µäº†ã€‚ 3.2 ä¸‡ç‰©çš†å¯¹è±¡åœ¨ JavaScript ä¸­ä¸‡ç‰©çš†å¯¹è±¡ã€‚å­¦è¿‡å…¶ä»–é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„åŒå­¦çŸ¥é“ï¼Œå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œæ¯ä¸ªç±»éƒ½å¯ä»¥æœ‰æ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€å±æ€§å’Œæ–¹æ³•ã€‚ åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ„é€ å‡½æ•°ã€å±æ€§ã€æ–¹æ³•ï¼Œä½†æ²¡æœ‰ææ„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥éªŒè¯â€œä¸‡ç‰©çš†å¯¹è±¡â€ï¼š 1234console.log(&quot;John&quot;.constructor); // [Function: String]console.log((3.14).constructor); // [Function: Number]console.log(false.constructor); // [Function: Boolean]console.log(&#123; name: &quot;John&quot;, age: 34 &#125;.constructor); // [Function: Object] 3.2.1 éšå¼å£°æ˜å¯¹è±¡JavaScript è®¿é—®å±æ€§å’Œæ–¹æ³•çš„æ–¹å¼å’Œå…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ç±»ä¼¼ï¼š 1234567891011let msg1 = &quot;Hello World!&quot;; // msg1ä¸ºå¯¹è±¡ï¼ŒStringç±»çš„å®ä¾‹let x = msg1.length; // è®¿é—®lengthå±æ€§console.log(x); // 12let msg2 = &quot;Hello world!&quot;; // // msg2ä¸ºå¯¹è±¡ï¼ŒStringç±»çš„å®ä¾‹let y = msg2.toUpperCase(); // è®¿é—®toUpperCaseæ–¹æ³•console.log(y); // HELLO WORLD!let car = &#123; name: &quot;BMW&quot;, price: 123000 &#125;; // carä¹Ÿä¸ºå¯¹è±¡ï¼Œ&#123;name: &quot;BMW&quot;, price: 123000&#125;ç±»çš„å®ä¾‹console.log(car.name); // BMWconsole.log(car.price); // 123000 å¤§å®¶å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ä»£ç ä¸­éƒ½æ²¡æœ‰ä½¿ç”¨newæ¥å£°æ˜å¯¹è±¡ï¼Œä½†è¿™äº›å¯¹è±¡ç¡®ç¡®å®å®å­˜åœ¨äº†ï¼Œä¸ç„¶æˆ‘ä»¬ä¹Ÿæ— æ³•è®¿é—®å…¶â€œå±æ€§â€å’Œâ€œæ–¹æ³•â€ï¼Œæˆ‘ä»¬å¯ä»¥å§‘ä¸”è®¤ä¸ºè¿™æ˜¯ JavaScript çš„è¯­æ³•ç³–å§ï¼Œæˆ–è€…å«â€œéšå¼å£°æ˜å¯¹è±¡â€å§ã€‚ 3.2.2 æ˜¾å¼å£°æ˜å¯¹è±¡å‰é¢ä»‹ç»çš„ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹ä¸­é™¤äº†nullå’Œundefinedä¹‹å¤–ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ new æ¥æ˜¾ç¤ºçš„å£°æ˜å¯¹è±¡ï¼š 12345678910111213let a1 = new Number(123);console.log(a1); // [Number: 123]console.log(1 + a1); // 124let a2 = new Function();console.log(a2); // [Function: anonymous]let a3 = new String(&quot;xyz&quot;);console.log(a3); // [String: &#x27;xyz&#x27;]let a4 = new null(); // TypeError: null is not a constructorlet a5 = new undefined(); // TypeError: null is not a constructor 3.3 ä½¿ç”¨ Class å®šä¹‰ç±»åœ¨ ES6 ä¸­å¯ä»¥ä½¿ç”¨ Class å…³é”®å­—å®šä¹‰ç±»ï¼Œä¸”æ¯ä¸ªç±»éƒ½æœ‰é»˜è®¤çš„ name å±æ€§ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738class Rectangle &#123; // æ„é€ å‡½æ•° // constructoræ–¹æ³•åç§°ä¸èƒ½ä¿®æ”¹ // é€šè¿‡newå‘½ä»¤ç”Ÿæˆå¯¹è±¡å®ä¾‹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚ // ä¸€ä¸ªç±»å¿…é¡»æœ‰constructoræ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œä¸€ä¸ªç©ºçš„constructoræ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ  constructor(h, w) &#123; this.height = h; this.width = w; &#125; // Getter get area() &#123; return this.calcArea(); &#125; // Settter set setWidth(w) &#123; this.width = w; &#125; // æ–¹æ³• calcArea() &#123; return this.height * this.width; &#125; // é™æ€æ–¹æ³• static printInfo(w, h) &#123; console.log(&quot;width:&quot; + w + &quot;, height:&quot; + h); &#125;&#125;// æ³¨æ„ï¼šè¿™ä¸ªnameå±æ€§æ˜¯é€šè¿‡ç±»æœ¬èº«æ¥è®¿é—®çš„ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹æ¥è®¿é—®çš„ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹ä¹±äº†ã€‚ã€‚ã€‚console.log(Rectangle.name); // Rectanglelet rect = new Rectangle(5, 6);console.log(rect.area); // 30//rect.printInfo(); // TypeError: rect.printInfo is not a functionRectangle.printInfo(5, 6); // width:5, height:6 Class çš„æˆå‘˜éƒ½æ˜¯å…¬å…±çš„ï¼Œå¤–éƒ¨éƒ½å¯ä»¥è®¿é—®ï¼Œç›®å‰æ²¡æœ‰ä»è¯­æ³•å±‚é¢è§„å®šå¦‚ä½•å®šä¹‰ä¸€ä¸ªç§æœ‰çš„æˆå‘˜ ç±»è¡¨è¾¾å¼ä¸€ä¸ªç±»è¡¨è¾¾å¼æ˜¯å®šä¹‰ä¸€ä¸ªç±»çš„å¦ä¸€ç§æ–¹å¼ã€‚ç±»è¡¨è¾¾å¼å¯ä»¥æ˜¯å…·åçš„æˆ–åŒ¿åçš„ã€‚ ä¸€ä¸ªå…·åç±»è¡¨è¾¾å¼çš„åç§°æ˜¯ç±»å†…çš„ä¸€ä¸ªå±€éƒ¨å±æ€§ï¼Œå®ƒå¯ä»¥é€šè¿‡ç±»çš„ name å±æ€§æ¥è·å–ã€‚ 1234567891011121314151617// åŒ¿åç±»let Rectangle1 = class &#123; constructor(height, width) &#123; this.height = height; this.width = width; &#125;&#125;;console.log(Rectangle1.name); // Rectangle1// å…·åç±»let RectangleX = class Rectangle2 &#123; constructor(height, width) &#123; this.height = height; this.width = width; &#125;&#125;;console.log(RectangleX.name); // Rectangle2 å››ã€å‡½æ•°4.1 å‡½æ•°å‚æ•°æ˜¯é»˜è®¤å£°æ˜çš„å˜é‡123function foo1(x) &#123; let x = 0; // SyntaxError: Identifier &#x27;x&#x27; has already been declared&#125; 4.2 å‡½æ•°å‚æ•°å¯ä»¥æœ‰é»˜è®¤å€¼1234function foo2(x, y = 1) &#123; console.log(x + y);&#125;foo2(1); // 2 ä¸ C++ä¸åŒï¼ŒJavaSript æ²¡æœ‰è¦æ±‚æ‹¥æœ‰é»˜è®¤å€¼çš„å‚æ•°å¿…é¡»æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„å°¾éƒ¨ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å†™ï¼š 123function foo2(x = 1, y) &#123; console.log(x + y);&#125; ä½†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œè¿™æ ·å†™å¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ã€‚ å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°å‚æ•°çš„é»˜è®¤å€¼æ˜¯æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶éƒ½ä¼šåŠ¨æ€è®¡ç®—çš„ï¼š 123456789let x = 99;function foo(p = x + 1) &#123; console.log(p);&#125;foo(); // 100x = 100;foo(); // 101 4.3 ç®­å¤´å‡½æ•°123456789function foo(x, y) &#123; return x + y;&#125;// ç­‰åŒäº(x, y) =&gt; &#123; return x + y;&#125;; å¦‚æœå‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼š 123456789101112131415function foo(x) &#123; return x * x;&#125;// ç­‰åŒäº(x) =&gt; &#123; return x * x;&#125;;// æ‹¬å·å¯ä»¥çœç•¥ï¼Œç­‰åŒäº(x) =&gt; &#123; return x * x;&#125;; å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å€¼å¤§æ‹¬å·å¯ä»¥çœç•¥ï¼š 1234567function foo() &#123; console.log(&quot;hi&quot;);&#125;// å¤§æ‹¬å·å¯ä»¥çœç•¥ï¼Œç­‰åŒäº() =&gt; console.log(&quot;hi&quot;); 4.4 å‡½æ•°çš„ nameï¼Œlength å±æ€§nameå¯ä»¥è¿”å›å‡½æ•°åï¼›lengthå¯ä»¥è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°ï¼› äº”ã€æ•°æ®ç»“æ„5.1 Objectæˆ‘ä»¬å¯ä»¥å‘ Object å¯¹è±¡æ·»åŠ ä»»ä½•å±æ€§ï¼Œæ‰€ä»¥ Object ä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨æˆ–é›†åˆï¼š 12345678910let obj = new Object(&quot;hello&quot;);console.log(obj); // [String: &#x27;hello&#x27;]obj.name = &quot;jeff&quot;;console.log(obj.name); // jeffobj.print = function () &#123; console.log(&quot;I&#x27;m object&quot;);&#125;;obj.print(); // I&#x27;m object 5.2 æ•°ç»„JavaScript ä¸­ä½¿ç”¨ Array ç±»åˆ›å»ºæ•°ç»„å¯¹è±¡ï¼š 12345678910111213141516171819202122232425// ä½¿ç”¨Arrayç±»åˆ›å»ºæ•°ç»„let cars1 = new Array(&quot;Saab&quot;, &quot;Volvo&quot;, &quot;BMW&quot;);// ä½¿ç”¨Arrayç±»åˆ›å»ºæ•°ç»„let cars2 = new Array();cars2[0] = &quot;Saab&quot;; // æ”¯æŒ[]æ–¹å¼è®¿é—®å’Œèµ‹å€¼ï¼Œä¸‹æ ‡ä»0å¼€å§‹cars2[1] = &quot;Volvo&quot;;cars2[2] = &quot;BMW&quot;;// ç®€å†™æ–¹å¼let cars3 = [&quot;Saab&quot;, &quot;Volvo&quot;, &quot;BMW&quot;];console.log(cars3.length); // 3// æ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥ä¸ºä¸åŒçš„ç±»å‹let a = [1, &quot;x&quot;, true];console.log(a[1]); // xconsole.log(a[5]); // undefinedï¼Œè®¿é—®æ•°ç»„ä¸­ä¸å­˜åœ¨çš„å…ƒç´ ä¼šè¿”å›undefinedï¼Œä¸ä¼šæŠ¥é”™a.testProp = &quot;xyz&quot;; // å¯ä»¥å‘Arrayå¯¹è±¡æ·»åŠ ä»»æ„å±æ€§console.log(a.testProp); // xyza.print = function () &#123; console.log(&quot;I&#x27;m a&quot;);&#125;;a.print(); // I&#x27;m a 5.2.1 Array ç±»å®Œæ•´çš„å±æ€§ å±æ€§ æè¿° length è®¾ç½®æˆ–è·å–æ•°ç»„å…ƒç´ çš„ä¸ªæ•° prototype å…è®¸ä½ å‘æ•°ç»„å¯¹è±¡æ·»åŠ å±æ€§æˆ–æ–¹æ³• 5.2.2 Array ç±»å®Œæ•´çš„æ–¹æ³• æ–¹æ³• æè¿° concat() è¿æ¥ä¸¤ä¸ªæˆ–æ›´å¤šçš„æ•°ç»„ï¼Œå¹¶è¿”å›ç»“æœ copyWithin() ä»æ•°ç»„çš„æŒ‡å®šä½ç½®æ‹·è´å…ƒç´ åˆ°æ•°ç»„çš„å¦ä¸€ä¸ªæŒ‡å®šä½ç½®ä¸­ entries() è¿”å›æ•°ç»„çš„å¯è¿­ä»£å¯¹è±¡ every() æ£€æµ‹æ•°å€¼å…ƒç´ çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ç¬¦åˆæ¡ä»¶ fill() ä½¿ç”¨ä¸€ä¸ªå›ºå®šå€¼æ¥å¡«å……æ•°ç»„ filter() æ£€æµ‹æ•°å€¼å…ƒç´ ï¼Œå¹¶è¿”å›ç¬¦åˆæ¡ä»¶æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ find() è¿”å›ç¬¦åˆä¼ å…¥æµ‹è¯•ï¼ˆå‡½æ•°ï¼‰æ¡ä»¶çš„æ•°ç»„å…ƒç´  findIndex() è¿”å›ç¬¦åˆä¼ å…¥æµ‹è¯•ï¼ˆå‡½æ•°ï¼‰æ¡ä»¶çš„æ•°ç»„å…ƒç´ ç´¢å¼• forEach() æ•°ç»„æ¯ä¸ªå…ƒç´ éƒ½æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•° from() é€šè¿‡ç»™å®šçš„å¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªæ•°ç»„ includes() åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ indexOf() æœç´¢æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›å®ƒæ‰€åœ¨çš„ä½ç½® isArray() åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ join() æŠŠæ•°ç»„çš„æ‰€æœ‰å…ƒç´ æ”¾å…¥ä¸€ä¸ªå­—ç¬¦ä¸² keys() è¿”å›æ•°ç»„çš„å¯è¿­ä»£å¯¹è±¡ï¼ŒåŒ…å«åŸå§‹æ•°ç»„çš„é”®(key) lastIndexOf() æœç´¢æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶è¿”å›å®ƒæœ€åå‡ºç°çš„ä½ç½® map() é€šè¿‡æŒ‡å®šå‡½æ•°å¤„ç†æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›å¤„ç†åçš„æ•°ç»„ pop() åˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆ é™¤çš„å…ƒç´  push() å‘æ•°ç»„çš„æœ«å°¾æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ reduce() å°†æ•°ç»„å…ƒç´ è®¡ç®—ä¸ºä¸€ä¸ªå€¼ï¼ˆä»å·¦åˆ°å³ï¼‰ reduceRight() å°†æ•°ç»„å…ƒç´ è®¡ç®—ä¸ºä¸€ä¸ªå€¼ï¼ˆä»å³åˆ°å·¦ï¼‰ reverse() åè½¬æ•°ç»„çš„å…ƒç´ é¡ºåº shift() åˆ é™¤å¹¶è¿”å›æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´  slice() é€‰å–æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ some() æ£€æµ‹æ•°ç»„å…ƒç´ ä¸­æ˜¯å¦æœ‰å…ƒç´ ç¬¦åˆæŒ‡å®šæ¡ä»¶ sort() å¯¹æ•°ç»„çš„å…ƒç´ è¿›è¡Œæ’åº splice() ä»æ•°ç»„ä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´  toString() æŠŠæ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç»“æœ unshift() å‘æ•°ç»„çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªæˆ–æ›´å¤šå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦ valueOf() è¿”å›æ•°ç»„å¯¹è±¡çš„åŸå§‹å€¼ 5.2.3 æ•°ç»„çš„å¤åˆ¶123456let a1 = [1, 2, 3];let a2 = a1;a2[1] = 4;console.log(a1[1]); // 4 ä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ç°æ”¹å˜æ•°ç»„a2[1]çš„å€¼æ—¶ï¼Œæ•°ç»„a1[1]çš„å€¼ä¹Ÿéšç€æ”¹å˜äº†ï¼Œè¿™è¯´æ˜ a1 å’Œ a2 æŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåœ¨ C&#x2F;C++ä¸­å°±æ˜¯æŒ‡é’ˆçš„æ¦‚å¿µï¼Œlet a2 = a1; åšçš„æ˜¯æµ…æ‹·è´æ“ä½œã€‚ å¦‚æœéœ€è¦åšæ·±æ‹·è´ï¼Œä¹Ÿå°±æ˜¯å°†æ•°ç»„ a1 çš„æ‰€æœ‰å…ƒç´ å…‹éš†ä¸€ä»½ç»™ a2ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¸¤ç§æ–¹å¼ï¼š 123456let a1 = [1, 2, 3];let a2 = a1.concat();a2[1] = 4;console.log(a1[1]); // 2 123456let a1 = [1, 2, 3];let a2 = [...a1]; // ä¹Ÿå¯ä»¥å†™æˆ let [...a2] = a1;a2[1] = 4;console.log(a1[1]); // 2 5.3 MapMap å¯¹è±¡ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹(key-value)ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®°ä½é”®çš„åŸå§‹æ’å…¥é¡ºåºã€‚ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”®æˆ–å€¼ã€‚åœ¨ Map ä¸­ Key æ˜¯å”¯ä¸€çš„ã€‚ 1234567891011121314151617181920212223242526272829303132let myMap = new Map();let keyObj = &#123;&#125;;let keyFunc = function () &#123;&#125;;let keyString = &quot;a string&quot;;// æ·»åŠ é”®myMap.set(keyString, &quot;å’Œé”®&#x27;a string&#x27;å…³è”çš„å€¼&quot;);myMap.set(keyObj, &quot;å’Œé”®keyObjå…³è”çš„å€¼&quot;);myMap.set(keyFunc, &quot;å’Œé”®keyFuncå…³è”çš„å€¼&quot;);console.log(myMap.size); // 3// è¯»å–å€¼console.log(myMap.get(keyString)); // å’Œé”®&#x27;a string&#x27;å…³è”çš„å€¼console.log(myMap.get(&quot;a string&quot;)); // å’Œé”®&#x27;a string&#x27;å…³è”çš„å€¼console.log(myMap.get(keyObj)); // å’Œé”®keyObjå…³è”çš„å€¼console.log(myMap.get(keyFunc)); // å’Œé”®keyFuncå…³è”çš„å€¼console.log(myMap.get(&#123;&#125;)); // undefined, å› ä¸ºkeyObj !== &#123;&#125;console.log(myMap.get(function () &#123;&#125;)); // undefined, å› ä¸ºkeyFunc !== function () &#123;&#125;console.log(myMap.size); // 3ï¼Œè¿”å›æœ‰å¤šå°‘ä¸ªé”®å€¼å¯¹// å’ŒArrayä¸€æ ·ï¼Œå¯ä»¥æ·»åŠ ä»»æ„å±æ€§å’Œæ–¹æ³•myMap.test = &quot;a&quot;;console.log(myMap.test);myMap.print = function () &#123; console.log(&quot;I&#x27;m map&quot;);&#125;;myMap.print(); // I&#x27;m map 5.3.1 Map ä¸ Array ç›¸äº’è½¬æ¢Array &#x3D;&gt; Map 123456let map = new Map([ [1, &quot;one&quot;], [2, &quot;two&quot;],]);console.log(map); // Map &#123; 1 =&gt; &#x27;one&#x27;, 2 =&gt; &#x27;two&#x27; &#125; Map &#x3D;&gt; Array 123456let map = new Map();map.set(1, &quot;one&quot;);map.set(2, &quot;tow&quot;);let arr2 = Array.from(map);console.log(arr2); // [ [ 1, &#x27;one&#x27; ], [ 2, &#x27;two&#x27; ] ] 5.3.2 Map çš„å¤åˆ¶Map åœ¨ç›´æ¥èµ‹å€¼çš„æ—¶å€™ä¼šé‡åˆ°å’Œ Array åŒæ ·çš„â€œæµ…æ‹·è´â€çš„é—®é¢˜ï¼Œå¦‚ï¼š 123456789let map1 = new Map();map1.set(1, &quot;one&quot;);map1.set(2, &quot;tow&quot;);let map2 = map1;map2.set(1, &quot;three&quot;);console.log(map1.get(1)); // threeï¼Œä¿®æ”¹map2ä¼šå¯¼è‡´map1çš„å€¼ä¹Ÿè¢«ä¿®æ”¹äº† å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼å®Œæˆ Map çš„æ·±æ‹·è´ï¼š 12345678910let map1 = new Map();map1.set(1, &quot;one&quot;);map1.set(2, &quot;tow&quot;);let map2 = new Map(map1);map2.set(1, &quot;three&quot;);console.log(map1.get(1)); // oneconsole.log(map2.get(1)); // three 5.4 SetMap æ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œè€Œ Set åˆ™åªæ˜¯é”®ï¼ˆkeyï¼‰çš„é›†åˆã€‚ Set ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ã€‚ ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥ä½œä¸º Set çš„å…ƒç´ ã€‚ 1234567891011121314let keys = [1, 1, 2, 3, &quot;str&quot;];let s = new Set(keys);// è‡ªåŠ¨å»é‡äº†console.log(s); // Set &#123; 1, 2, 3, &#x27;str&#x27; &#125;// æ–°å¢ä½¿ç”¨Adds.add(9);s.add(function () &#123;&#125;);console.log(s); // Set &#123; 1, 2, 3, &#x27;str&#x27;, 9, [Function] &#125;// åˆ é™¤ä½¿ç”¨deletes.delete(1);console.log(s); // Set &#123; 2, 3, &#x27;str&#x27;, 9, [Function] &#125; 5.5 è¿­ä»£å™¨å‰é¢ä»‹ç» Objectã€Arrayã€Mapã€Set è¿™äº›å®¹å™¨çš„æ—¶å€™ï¼Œéƒ½é¿å¼€äº†ä¸€ä¸ªè¯é¢˜ï¼šéå†ã€‚æœ¬èŠ‚ä¸»è¦ä»‹ç»å¦‚ä½•éå† JavaScript ä¸­çš„å®¹å™¨æˆ–é›†åˆã€‚ è¿­ä»£å™¨ï¼ˆIteratorï¼‰å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„éå†è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦å®ç° Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œã€‚ åœ¨å­¦ä¹ å¦‚ä½•è‡ªå®šä¹‰è¿­ä»£å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸€ä¸‹å¦‚ä½•éå† JavaScript å¸¸ç”¨çš„æ•°æ®é›†åˆï¼š 5.5.1 éå†å­—ç¬¦ä¸²12345678910111213let str = &quot;hello&quot;;for (let v of str) &#123; console.log(v);&#125;/*hello*/ 5.5.2 éå†æ•°ç»„123456789let arr = [1, &quot;str&quot;, 2];for (let v of arr) &#123; console.log(v);&#125;/*1str2*/ 5.5.3 éå† Map123456789101112131415let map = new Map([ [1, &quot;one&quot;], [2, &quot;two&quot;], [3, function () &#123;&#125;],]);for (let [k, v] of map) &#123; console.log(k + &quot;:&quot; + v);&#125;/*1:one2:two3:function () &#123; &#125;*/ å…­ã€è§£æ„èµ‹å€¼è§£æ„(Destructuring)èµ‹å€¼åˆ†ä¸ºâ€œæ•°ç»„çš„è§£æ„èµ‹å€¼â€å’Œâ€œå¯¹è±¡çš„è§£æ„èµ‹å€¼â€ã€‚ 6.1 æ•°ç»„çš„è§£æ„èµ‹å€¼123456789101112131415161718192021222324252627282930313233343536373839404142434445let [a, b, c] = [1, 2, 3]; // æ ¹æ®ä½ç½®ä¾æ¬¡å–å€¼// a = 1// b = 2// c = 3let [foo, [[bar], baz]] = [1, [[2], 3]];// foo = 1// bar = 2// baz = 3let [ , , third] = [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;];// third = &quot;baz&quot;let [head, ...tail] = [1, 2, 3, 4];// head = 1// tail = [2,3,4]let [x, y, ...z] = [&quot;a&quot;];// x = &quot;a&quot;// y = undefined// z = []let [foo] = []; // foo = undefinedlet [bar, foo] = [1]; // foo = undefinedlet [bar, foo = true] = [1]; // å¯ä»¥èµ‹é»˜è®¤å€¼// bar = 1// foo = truelet [x, y] = [1, 2, 3];// x = 1// y = 2let [a, [b], d] = [1, [2, 3], 4];// a = 1// b = 2// d = 4 6.2 å¯¹è±¡çš„è§£æ„èµ‹å€¼1234567891011let &#123; foo, bar &#125; = &#123; foo: &quot;aaa&quot;, bar: &quot;bbb&quot; &#125;; // å’Œé¡ºåºæ²¡å…³ç³»ï¼Œæ ¹æ®å±æ€§åæ¥å–å€¼// foo = &quot;aaa&quot;// bar = &quot;bbb&quot;let &#123; foo &#125; = &#123; bar: &quot;baz&quot; &#125;;// foo = undefined// å¯¹è±¡çš„è§£æ„èµ‹å€¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†ç°æœ‰å¯¹è±¡çš„æ–¹æ³•ï¼Œèµ‹å€¼åˆ°æŸä¸ªå˜é‡// å¦‚ï¼šconsoleå¯¹è±¡æœ‰logæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼šconst &#123; log &#125; = console;log(&quot;hello&quot;); // hello ä¸ƒã€promiseã€asyncã€awaitpromiseã€asyncã€await è¿™ä¸‰ä¸ªå…³é”®å­—éƒ½å’Œå¼‚æ­¥ç¼–ç¨‹æœ‰å…³ã€‚ 7.1 PromisePromise ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œæ‰¿è¯ºâ€çš„æ„æ€ï¼Œå£°æ˜ä¸€ä¸ª Promise å°±æ˜¯ç«‹ä¸‹äº†ä¸€ä¸ªæ‰¿è¯ºï¼Œæ— è®ºæ€ä¹ˆæ ·ï¼Œéƒ½ä¼šç»™è¢«æ‰¿è¯ºäººä¸€ä¸ªç»“æœï¼Œè€Œä¸”è¿™ä¸ªç»“æœæ˜¯æ¿ä¸Šé’‰é’‰çš„ï¼Œä¸ä¼šå†å˜ã€‚ Promise å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼špendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€fulfilledï¼ˆå·²æˆåŠŸï¼‰å’Œ rejectedï¼ˆå·²å¤±è´¥ï¼‰ã€‚ å£°æ˜ Promise å¯¹è±¡æ—¶éœ€è¦ä¼ å…¥ä¸€ä¸ªå‡½æ•°å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹è±¡çš„ 2 ä¸ªå‚æ•°ä¹Ÿæ˜¯å‡½æ•°å¯¹è±¡ï¼ˆresolve, rejectï¼‰ï¼Œresolveå’Œrejectä¸éœ€è¦å¼€å‘è€…å®šä¹‰ï¼ŒJavascript å¼•æ“ä¼šè‡ªåŠ¨ç”Ÿæˆè¿™ 2 ä¸ªå‡½æ•°ã€‚ å½“ Promise å¯¹è±¡ç”Ÿæˆåä¼šç«‹å³å˜æˆpendingçŠ¶æ€ï¼Œè°ƒç”¨resolveå‡½æ•°ä¼šå°† Promise å¯¹è±¡æ ‡è®°ä¸ºfulfilledçŠ¶æ€ï¼Œè€Œè°ƒç”¨rejectå‡½æ•°åˆ™ä¼šå°†å½“å‰ Promise å¯¹è±¡æ ‡è®°rejectedçŠ¶æ€ã€‚ resolveå’Œrejectedå‡½æ•°ï¼Œæˆ‘ä»¬åªèƒ½è°ƒç”¨å®ƒä»¬ä¸­çš„ä¸€ä¸ªï¼Œä¸èƒ½å³è°ƒç”¨resolveåˆè°ƒç”¨rejectedã€‚å¦‚æœæˆ‘ä»¬å…ˆè°ƒç”¨äº†resolveï¼Œæ­¤æ—¶ Promise çŠ¶æ€ä¼šæ ‡è®°ä¸ºfulfilledï¼Œç„¶ååˆè°ƒç”¨äº†rejectedå‡½æ•°ï¼Œæ­¤æ—¶ Promise çŠ¶æ€å¹¶ä¸ä¼šå†æ”¹å˜ï¼Œä»ç„¶ä½¿fulfilledçŠ¶æ€ï¼Œå› ä¸ºæ‰¿è¯ºçš„ç»“æœæ˜¯æ¿ä¸Šé’‰é’‰çš„ï¼Œä¸ä¼šå†å˜ã€‚å»ºè®®å°†resolveå’Œrejectä½œä¸ºæœ€åä¸€è¡Œä»£ç è°ƒç”¨ï¼Œç®€å•èµ·è§ï¼Œå¯ä»¥åœ¨è¿™ 2 ä¸ªå‡½æ•°å‰é¢åŠ ä¸Šreturn, å³return resolve();æˆ–return reject(); 123456789101112// Promiseçš„å‚æ•°ä¸ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå‡½æ•°æœ‰2ä¸ªå‚æ•°resolve, rejectlet promise = new Promise((resolve, reject) =&gt; &#123; // åšä¸€äº›è€—æ—¶çš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå»¶æ—¶å™¨æ¥æ¨¡æ‹Ÿè€—æ—¶çš„ç½‘ç»œè¯·æ±‚ setTimeout(() =&gt; &#123; // å»¶æ—¶1000msä¹‹åæˆåŠŸ resolve(&quot;ok&quot;); &#125;, 1000); // æˆåŠŸåˆ™è°ƒç”¨ resolve(); // å¤±è´¥åˆ™è°ƒç”¨ reject();&#125;); é‚£ä¹ˆï¼Œæˆ‘æƒ³åœ¨è¿™ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆä¹‹åï¼Œå†æ ¹æ®ç»“æœï¼ˆæ˜¯æˆåŠŸäº†ï¼Œè¿˜æ˜¯å¤±è´¥äº†ï¼‰æ¥ç»§ç»­åšä¸‹ä¸€ä»¶äº‹æƒ…ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåšäº†ï¼ŸPromise å¯¹è±¡æä¾›äº†thenæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å— 2 ä¸ªå‡½æ•°å¯¹è±¡ä½œä¸ºå‚æ•°ï¼šç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸ºresolvedæ—¶è°ƒç”¨;ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯ Promise å¯¹è±¡çš„çŠ¶æ€å˜ä¸ºrejectedæ—¶è°ƒç”¨ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯å¯é€‰çš„ï¼Œä¸ä¸€å®šè¦æä¾›ã€‚æ¯ä¸ªå›è°ƒå‡½æ•°éƒ½å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯ä¸Šä¸€æ­¥è°ƒç”¨ resolve æˆ– reject æ—¶ä¼ å…¥çš„ã€‚ 12345678910111213// ä¸Šé¢çš„è€—æ—¶æ“ä½œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦æ ¹æ®ç»“æœæ¥ç»§ç»­åšä¸€äº›äº‹æƒ…// æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨thenï¼Œthenå‡½æ•°æœ‰2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º2ä¸ªå‡½æ•°å¯¹è±¡ã€‚// ä¸Šä¸€æ­¥æ“ä½œä¸­ï¼Œå¦‚æœè°ƒç”¨resolve(data)ï¼Œåˆ™thenå‡½æ•°ç¬¬ä¸€ä¸ªå‡½æ•°å¯¹è±¡å‚æ•°ä¼šè¢«è°ƒç”¨ï¼›// å¦‚æœè°ƒç”¨reject(data)ï¼Œåˆ™thenå‡½æ•°ç¬¬äºŒä¸ªå‡½æ•°å¯¹è±¡å‚æ•°ä¼šè¢«è°ƒç”¨promise.then( (data) =&gt; &#123; console.log(&quot;resolve1: &quot; + data); return &quot;hello&quot;; &#125;, (data) =&gt; &#123; console.log(&quot;reject1: &quot; + data); &#125;); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ç›´æ¥é€šè¿‡ return è¿”å›äº†â€helloâ€å­—ç¬¦ä¸²ï¼Œé‚£è¿™ä¸ªè¿”å›å€¼çš„æ„ä¹‰åœ¨å“ªé‡Œäº†ï¼Ÿè¿˜æœ‰å…¶ä»–äººå¯ä»¥ä½¿ç”¨åˆ°è¿™ä¸ªè¿”å›å€¼å—ï¼Ÿæ˜¯çš„ï¼Œè¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚å› ä¸ºthençš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè™½ç„¶æˆ‘åªæ˜¯ä½¿ç”¨çš„return &quot;hello&quot;;ï¼Œå¹¶æ²¡æœ‰new Promiseï¼Œä½† JavaScript å¼•æ“ä¼šè‡ªåŠ¨åŒ…è£…æˆä¸€ä¸ª Promise å¯¹è±¡ï¼Œç­‰åŒäºï¼š 1234567891011promise.then( (data) =&gt; &#123; console.log(&quot;resolve1: &quot; + data); return new Promise((resolve, reject) =&gt; &#123; return resolve(&quot;hello&quot;); &#125;); &#125;, (data) =&gt; &#123; console.log(&quot;reject1: &quot; + data); &#125;); åˆ°è¿™å„¿äº†ï¼Œæˆ‘ä»¬çŸ¥é“äº†thençš„è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚æ—¢ç„¶thenè¿”å›çš„æ˜¯Promiseå¯¹è±¡ï¼Œé‚£ä¹ˆPromiseå°±å¯ä»¥ç»§ç»­thenå‘€ï¼Œç„¶åä¸€ç›´thenä¸‹å»â€¦.è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ç³»åˆ—å¼‚æ­¥çš„æ“ä½œä¸²è”èµ·æ¥äº†ï¼š 12345678910111213let p = new Promise((resolve, reject) =&gt; &#123; // ... // resolve(); æˆ– reject();&#125;) .then(() =&gt; &#123; // ... &#125;) .then(() =&gt; &#123; // ... &#125;) .then(() =&gt; &#123; // ... &#125;); ä½†å¤šä¸ªå¼‚æ­¥æ“ä½œä¸²è”æ‰§è¡Œï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 1234567891011121314151617let promise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; // å»¶æ—¶1000ms resolve(&quot;ok1&quot;); &#125;, 1000);&#125;) .then((data) =&gt; &#123; console.log(&quot;resolve1: &quot; + data); setTimeout(() =&gt; &#123; // å»¶æ—¶1000ms return &quot;ok2&quot;; &#125;, 1000); &#125;) .then((data) =&gt; &#123; console.log(&quot;resolve2: &quot; + data); &#125;); æˆ‘ä»¬æœŸæœ›çš„è¾“å‡ºæ˜¯ï¼š 12resolve1: ok1;resolve2: ok2; ä½†å®é™…çš„è¾“å‡ºå´æ˜¯ï¼š 12resolve1: ok1;resolve2: undefined; é—®é¢˜å‡ºåœ¨ç¬¬äºŒä¸ª setTimeout æ¨¡æ‹Ÿçš„è€—æ—¶æ“ä½œï¼Œæˆ‘ä»¬ä»¥ä¸ºç¨‹åºä¼šç­‰ç¬¬äºŒä¸ª setTimeout æ‰§è¡Œå®Œäº†å†æ‰§è¡Œç¬¬äºŒä¸ª thenï¼Œä½†äº‹å®ä¸Š setTimeout ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè™½ç„¶å…¶å»¶æ—¶äº†ä¸€ç§’æ‰§è¡Œå…¶å›è°ƒå‡½æ•°ï¼Œä½† setTimeout è¿™æ¡è¯­å¥å´é©¬ä¸Šæ‰§è¡Œå®Œæˆäº†ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ª then æ²¡æœ‰ä»»ä½•è¿”å›ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å°†ä»£ç æ”¹æˆä¸‹é¢çš„ï¼š 12345678910111213141516171819let promise = new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; // å»¶æ—¶1000ms resolve(&quot;ok1&quot;); &#125;, 1000);&#125;) .then((data) =&gt; &#123; console.log(&quot;resolve1: &quot; + data); return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; // å»¶æ—¶1000ms resolve(&quot;ok2&quot;); &#125;, 1000); &#125;); &#125;) .then((data) =&gt; &#123; console.log(&quot;resolve2: &quot; + data); &#125;); 7.2 Promise å¼‚å¸¸æ•è·Promise å¯¹è±¡è¿˜æä¾›äº†catchæ–¹æ³•ï¼Œç”¨æ¥æ•è·å¼‚å¸¸ã€‚åœ¨ä»‹ç»catchå‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314let promise = new Promise((resolve, reject) =&gt; &#123; throw new Error(&quot;an error&quot;); resolve(&quot;ok&quot;);&#125;).then( (data) =&gt; &#123; console.log(&quot;resolve: &quot; + data); &#125;, (data) =&gt; &#123; console.log(&quot;reject: &quot; + data); &#125;);// è¾“å‡ºï¼š// reject: Error: an error æˆ‘ä»¬åœ¨ Promise ä¸­äººä¸ºæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯ç¨‹åºå´è¿˜æ˜¯æ²¡æœ‰ä¸­æ­¢ï¼Œè€Œæ˜¯è¿è¡Œåˆ°äº† reject è¿‡ç¨‹ä¸­å»äº†ã€‚ è¿™æ˜¯å› ä¸º Promise é»˜è®¤ä¼šæ•è·å…¶æ“ä½œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ï¼Œå¦‚æœæœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå…¶çŠ¶æ€å°±ä¼šè‡ªåŠ¨å˜æˆrejectedï¼Œè¿˜è®°å¾—å‰é¢è¯´è¿‡ Promise çŠ¶æ€ä¸€æ—¦ç¡®å®šå°±ä¸ä¼šå†æ”¹å˜äº†å§ï¼Œæ‰€ä»¥å³ä¾¿åé¢çš„resolve(&quot;ok&quot;);æ‰§è¡Œäº†ï¼Œä¹Ÿä¸ä¼šæ”¹å˜ promise çŠ¶æ€ï¼ˆäº‹å®ä¸Š throw è¯­å¥åçš„ä»£ç å¹¶æ²¡æœ‰æœºä¼šæ‰§è¡Œï¼‰ã€‚ é‚£ä¹ˆï¼Œå‡å¦‚æˆ‘ä»¬æ²¡æœ‰å†™ reject å›è°ƒå‡½æ•°ä¼šæ€ä¹ˆæ ·äº†ï¼Ÿçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š 123456let promise = new Promise((resolve, reject) =&gt; &#123; throw new Error(&quot;an error&quot;); resolve(&quot;ok&quot;);&#125;).then((data) =&gt; &#123; console.log(&quot;resolve: &quot; + data);&#125;); ä¸Šé¢çš„ä»£ç ä¸­ç”±äºæ²¡æœ‰æŒ‡å®šå¼‚å¸¸å¤„ç†å‡½æ•°ï¼Œæ‰€ä»¥ç¨‹åºæŠ›å‡ºäº†å¼‚å¸¸ä¿¡æ¯ï¼Œä¸­æ­¢æ‰§è¡Œäº†ã€‚ å¦å¤–ï¼ŒPromise çš„å¼‚å¸¸æ˜¯ä¼šä¸€ç›´å‘ä¸‹ä¼ é€’çš„ï¼Œç›´åˆ°æœ€åæœ‰äººå¤„ç†ï¼Œå¦‚æœå§‹ç»ˆæ²¡äººå¤„ç†ï¼Œç¨‹åºå°±ä¼šæŠ›å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œç„¶åä¸­æ­¢ï¼š 123456789101112131415161718let promise = new Promise((resolve, reject) =&gt; &#123; throw new Error(&quot;an error&quot;); resolve(&quot;ok&quot;);&#125;) .then((data) =&gt; &#123; console.log(&quot;resolve1: &quot; + data); &#125;) .then( (data) =&gt; &#123; console.log(&quot;resolve2: &quot; + data); &#125;, (data) =&gt; &#123; console.log(&quot;reject2: &quot; + data); &#125; );// è¾“å‡ºï¼š// reject: Error: an error ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ª then æ²¡æœ‰å¤„ç†å¼‚å¸¸ï¼Œå¼‚å¸¸å‘ä¸‹ä¼ é€’ç»™ç¬¬äºŒä¸ª then, ç¬¬äºŒä¸ª then å¤„ç†äº†è¯¥å¼‚å¸¸ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚ ç°åœ¨ç†è§£Promise.catch()æ–¹æ³•å°±å®¹æ˜“å¤šäº†ã€‚catch()æ–¹æ³•å…¶å®å°±æ˜¯.then(null, rejectiion)æˆ–.then(undefined, rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚ æˆ‘ä»¬ä¸€èˆ¬æ€»æ˜¯å»ºè®®ï¼ŒPromise å¯¹è±¡åé¢è¦è·Ÿ catch()æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å¤„ç† Promise å†…éƒ¨å‘ç”Ÿçš„é”™è¯¯ã€‚catch()æ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨ then()æ–¹æ³•ã€‚ 7.3 async, awaitasync æ˜¯ES7æ‰æœ‰çš„ä¸å¼‚æ­¥æ“ä½œæœ‰å…³çš„å…³é”®å­—ï¼Œéœ€è¦å’ŒPromiseé…åˆä½¿ç”¨ï¼Œasyncå‡½æ•°è¿”å›ä¸€ä¸ª Promiseå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨thenæ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ï¼š 12345678910111213async function helloAsync() &#123; return &quot;helloAsync&quot;;&#125;console.log(helloAsync());helloAsync().then((v) =&gt; &#123; console.log(v);&#125;);// è¾“å‡ºï¼š// Promise &#123; &#x27;helloAsync&#x27; &#125;// helloAsync awaitå…³é”®å­—åªèƒ½ç”¨åœ¨è¢«asyncæ ‡è®°çš„å‡½æ•°ä½“å†…ï¼Œasyncå‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æœé‡åˆ°awaitå°±ä¼šå…ˆæš‚åœæ‰§è¡Œï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ¢å¤asyncå‡½æ•°çš„æ‰§è¡Œå¹¶è¿”å›è§£æå€¼ã€‚ 123456789101112131415161718function testAwait() &#123; return new Promise((resolve) =&gt; &#123; setTimeout(function () &#123; console.log(&quot;testAwait&quot;); resolve(); &#125;, 1000); &#125;);&#125;async function helloAsync() &#123; await testAwait(); console.log(&quot;helloAsync&quot;);&#125;helloAsync();// è¾“å‡ºï¼š// testAwait// helloAsync","tags":["Web","JavaScript"],"categories":["Webç¼–ç¨‹"]},{"title":"QSSçš„å‡ ç§å›¾ç‰‡è®¾ç½®æ–¹æ³•","path":"/post/830332637.html","content":"å¤§å®¶åœ¨ä½¿ç”¨ QSS è¿›è¡Œå›¾ç‰‡è®¾ç½®æ—¶ï¼Œä¹Ÿè®¸è¢«image, border-image, background-imageè¿™å‡ ä¸ªå±æ€§çš„å·®å¼‚å›°æ‰°è¿‡ã€‚æœ¬æ–‡å°±æ¥è®²è§£ä¸€ä¸‹è¿™ä¸ªå‡ ä¸ªå±æ€§çš„å¼‚åŒç‚¹ã€‚ ä¸€ã€background-imagebackground-imageæŒ‰å›¾ç‰‡å®é™…å°ºå¯¸æ˜¾ç¤ºå›¾ç‰‡ï¼Œè¶…è¿‡æ§ä»¶æ˜¾ç¤ºåŒºåŸŸçš„éƒ¨åˆ†ä¼šè¢«è£å‰ªæ‰ã€‚ è™½èƒ½æ˜¾ç¤º SVGï¼Œä½†æ— æ³•å¯¹ SVG è¿›è¡Œæ— æŸç¼©æ”¾ï¼› å…³äºbackground-imageçš„å‡ ä¸ªé™„å±å±æ€§çš„ä½œç”¨ï¼Œå¯ä»¥ä¸€å¥è¯æ¦‚æ‹¬ä¸ºï¼šä»background-originåŒºåŸŸçš„background-positionä½ç½®å¼€å§‹ç»˜åˆ¶å›¾åƒï¼Œå¹¶ä»¥background-repeatæ–¹å¼è¿›è¡Œé‡å¤ï¼›æœ€åå°†å›¾åƒbackground-clipåŒºåŸŸä»¥å¤–çš„èŒƒå›´è£å‰ªæ‰ï¼ˆå³ä¸æ˜¾ç¤ºï¼‰ã€‚ äºŒã€imageimageä¼šå°†å›¾ç‰‡æŒ‰å›¾ç‰‡åŸé•¿å®½æ¯”è¿›è¡Œç¼©æ”¾ï¼Œå¹¶ä¿è¯å¡«å……æ»¡æ§ä»¶ content åŒºåŸŸã€‚ imageæ”¯æŒ SVG çŸ¢é‡å›¾æ˜¾ç¤ºå’Œæ— æŸç¼©æ”¾ã€‚ image å¯ä»¥ä½¿ç”¨image-positionæ¥æŒ‡å®šå›¾ç‰‡å¼€å§‹æ˜¾ç¤ºçš„ä½ç½®ï¼ˆå‚è€ƒä¸Šé¢background-positionï¼‰ã€‚ ä¸‰ã€border-imageæŒ‰æ§ä»¶ border åŒºåŸŸçš„é•¿å®½æ¯”æ¥ç¼©æ”¾å›¾ç‰‡ï¼Œä¿è¯å¡«å……æ»¡æ§ä»¶ border åŒºåŸŸï¼Œæ”¯æŒ SVG çŸ¢é‡å›¾æ˜¾ç¤ºå’Œæ— æŸç¼©æ”¾; å››ã€ç»˜åˆ¶é¡ºåºå¦‚æœåœ¨ä¸€ä¸ªæ§ä»¶ä¸­åŒæ—¶æŒ‡å®šbackground-imageï¼Œborder-imageï¼Œimageè¿™ä¸‰ä¸ªå±æ€§ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºè¿›è¡Œç»˜åˆ¶ï¼š 123å…ˆç»˜åˆ¶ background-imageç„¶å border-imageæœ€å image äº”ã€ç¤ºä¾‹1234567891011QPushButton#pushButton4 &#123; border: 20px solid rgba(0,0,255,0.5); padding: 20px; margin: 20px; background-image: url(:/QssUsage/Image/å¤´åƒ.png); /*ä¸‹å›¾ä¸­çš„åœ†å½¢å¤´åƒ*/ background-origin: margin; background-position:top left; background-repeat:repeat-x; background-clip: margin;&#125;","tags":["Qt","QSS"],"categories":["Qt"]},{"title":"QSSåŸºæœ¬ä½¿ç”¨æ–¹æ³•","path":"/post/749849405.html","content":"Qt QSS é€‰æ‹©å™¨å’Œ CSS2ã€CSS3 çš„é€‰æ‹©å™¨ç±»ä¼¼ï¼Œå»ºè®®å…ˆå­¦ä¹ æˆ–è€…å¤ä¹ CSS é€‰æ‹©å™¨çš„è¯­æ³•ã€‚QSS æ¥æºä¸ CSS ï¼Œä½†æœ‰ä¹Ÿç¨è®¸ä¸åŒï¼Œè€Œä¸”æ”¯æŒçš„è¯­æ³•ä¹Ÿæ²¡ CSS é‚£ä¹ˆå¤šã€‚ ä¸€ã€é€‰æ‹©å™¨ç±»å‹1.1 ç±»é€‰æ‹©å™¨12345678910111213/*åŒ¹é…QPushButtonçš„å®ä¾‹åŠå…¶å­ç±»*/QPushButton &#123; color: blue;&#125;/*åŒ¹é…QPushButtonçš„å®ä¾‹ï¼Œä½†ä¸åŒ…å«å­ç±»*/.QPushButton &#123; color: blue;&#125; 1.2 é€‰æ‹©å™¨åˆ†ç»„123456/*åŒæ—¶åŒ¹é…QPushButtonã€QLineEditçš„å®ä¾‹*/QPushButton,QLineEdit &#123; color: blue;&#125; 1.3 ID é€‰æ‹©å™¨1234567891011121314151617181920/*åŒ¹é…æ‰€æœ‰objectNameä¸ºbtnOKçš„å®ä¾‹*/*#btnOK &#123; font-weight: bold;&#125;/*å’Œ*#btnOKä¸€æ ·ï¼ŒåŒ¹é…æ‰€æœ‰objectNameä¸ºbtnOKçš„å®ä¾‹*/#btnOK &#123; font-weight: bold;&#125;/*åŒ¹é…æ‰€æœ‰objectNameä¸ºbtnOKçš„QPushButtonå®ä¾‹*/QPushButton#btnOK &#123; font-weight: bold;&#125; 1.4 å±æ€§é€‰æ‹©å™¨123456789101112131415161718192021222324252627/*åŒ¹é…åŒ…å«flatå±æ€§çš„æ‰€æœ‰å®ä¾‹*/*[flat] &#123; color: red;&#125;/*åŒ¹é…åŒ…å«flatå±æ€§çš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/QPushButton[flat] &#123; color: red;&#125;/*åŒ¹é…flatå±æ€§ä¸ºtrueçš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/QPushButton[flat=&quot;true&quot;] &#123; color: red;&#125;/*åŒ¹é…faltå±æ€§ä¸ºtrueä¸”defaultå±æ€§ä¸ºfalseçš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/QPushButton[flat=&quot;true&quot;][default=&quot;false&quot;] &#123; color: red;&#125; 1.5 åä»£é€‰æ‹©å™¨123456/*åŒ¹é…å±äºQDialogåä»£ï¼ˆå­©å­ï¼Œå­™å­ç­‰ï¼‰çš„QPushButtonæ‰€æœ‰å®ä¾‹*/QDialog QPushButton &#123; color: red;&#125; 1.6 å­å…ƒç´ é€‰æ‹©å™¨123456/*åŒ¹é…å±äºQDialogç›´æ¥å­ç±»çš„QPushButtonæ‰€æœ‰å®ä¾‹*/QDialog &gt; QPushButton &#123; color: red;&#125; 1.7 ä¼ªçŠ¶æ€1234567891011121314151617181920/*åŒ¹é…hoverçŠ¶æ€çš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/QPushButton:hover &#123; color: white;&#125;/*åŒ¹é…åŒæ—¶ä¸ºhoverå’ŒenabledçŠ¶æ€çš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/QPushButton:hover:enabled &#123; color: white;&#125;/*åŒ¹é…ä¸ä¸ºhoverçŠ¶æ€çš„æ‰€æœ‰QPushButtonçš„å®ä¾‹*/qradiobutton: !hover &#123; color: red;&#125; 1.8 å­æ§ä»¶é€‰æ‹©å™¨123QRadioButton::indicator::unchecked:disabled &#123; image: url(:/qss/radiobutton_unchecked_disable.png);&#125; äºŒã€é€‰æ‹©å™¨ä¼˜å…ˆçº§ä¸€å¥è¯å½’çº³ä¸ºï¼šä¼˜å…ˆä½¿ç”¨æ›´å…·ä½“çš„é€‰æ‹©å™¨ã€‚ å…·ä½“å®ä¾‹å¦‚ä¸‹ï¼š 123456789/*QPushButton#okButtoné€‰æ‹©å™¨æ¯”QPushButtonæ›´å…·ä½“ï¼Œæ‰€ä»¥é€‰æ‹©QPushButton#okButton*/QPushButton#okButton &#123; color: gray;&#125;QPushButton &#123; color: red;&#125; 12345678910/*å¦‚ä¸‹2ä¸ªè§„åˆ™åº”ç”¨äºQPushButtonå®ä¾‹æ—¶ï¼šå› ä¸ºQPushButtonç»§æ‰¿QAbstractButtonï¼Œæ‰€ä»¥QPushButtonæ¯”QAbstractButtonæ›´å…·ä½“ï¼Œé€‰æ‹©QPushButton*/QPushButton &#123; color: red;&#125;QAbstractButton &#123; color: gray;&#125; 123456789/*æŒ‡å®šä¼ªçŠ¶æ€æ¯”ä¸æŒ‡å®šä¼ªçŠ¶æ€çš„é€‰æ‹©å™¨æ›´å…·ä½“ï¼Œæ‰€ä»¥å½“é¼ æ ‡æ‚¬åœæ—¶é€‰æ‹©QPushButton:hoverï¼Œå¦åˆ™é€‰æ‹©QPushButton*/QPushButton:hover &#123; color: white;&#125;QPushButton &#123; color: red;&#125; 1234567891011/*å¦‚ä¸‹2ä¸ªè§„åˆ™åº”ç”¨äºå¤„äºEnabledçŠ¶æ€çš„QPushButtonå®ä¾‹æ—¶ï¼šé¼ æ ‡æ‚¬åœæ—¶ï¼ŒQPushButton:hoveræ›´èƒ½å…·ä½“æè¿°å½“å‰çŠ¶æ€ï¼Œæ‰€ä»¥é€‰æ‹©QPushButton:hoverå…¶ä»–æ—¶å€™é€‰æ‹©QPushButton:enabled*/QPushButton:enabled &#123; color: red;&#125;QPushButton:hover &#123; color: white;&#125; 1234567891011121314/*å¦‚ä¸‹2ä¸ªè§„åˆ™åº”ç”¨äºå¤„äºEnabledçŠ¶æ€çš„QPushButtonå®ä¾‹æ—¶ï¼šé¼ æ ‡æ‚¬åœæ—¶ï¼ŒQPushButton:enabled:hoveræ›´èƒ½å…·ä½“æè¿°å½“å‰çŠ¶æ€ï¼Œæ‰€ä»¥é€‰æ‹©QPushButton:enabled:hoverå…¶ä»–æ—¶å€™é€‰æ‹©QPushButton:enabled*/QPushButton:enabled &#123; color: red;&#125;QPushButton:hover &#123; color: white;&#125;QPushButton:enabled:hover &#123; color: white;&#125; ä¸‰ã€QSS æ”¯æŒçš„ç±»å‹ã€å±æ€§ã€ä¼ªçŠ¶æ€ã€å­æ§ä»¶å…³äº QSS æ”¯æŒå“ªäº›ç±»å‹ã€æ¯ç§ç±»å‹æ”¯æŒå“ªäº›å±æ€§ã€ä¼ªçŠ¶æ€å’Œå­æ§ä»¶ï¼Œåœ¨ Qt çš„å®˜æ–¹çš„è‹±æ–‡æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ï¼šã€ŠQt Style Sheets Referenceã€‹ ä¹Ÿå¯ä»¥åœ¨Qt Assistantä¸­æœç´¢â€Qt Style Sheets Referenceâ€æ‰“å¼€å¸®åŠ©æ–‡æ¡£ã€‚ 3.1 ä¼ªçŠ¶æ€åˆ—è¡¨ä¸ºäº†æ–¹ä¾¿æŸ¥é˜…ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ºQSSç›®å‰æ”¯æŒçš„æ‰€æœ‰ä¼ªçŠ¶æ€ã€‚ ä¼ªçŠ¶æ€éƒ½æ˜¯ä»¥ä¸€ä¸ªå†’å·:å¼€å¤´ï¼Œå¦‚:activeã€‚ ä¼ªçŠ¶æ€ æè¿° :active æ­¤çŠ¶æ€åœ¨Widgeté©»ç•™åœ¨æ´»åŠ¨çª—å£æ—¶è®¾ç½® :adjoins-item æ­¤çŠ¶æ€åœ¨QTreeViewçš„::branchä¸ä¸€ä¸ªitemç›¸é‚»æ—¶è®¾ç½® :alternate å½“QAbstractItemView::alternatingRowColors()è®¾ç½®ä¸ºçœŸæ—¶ï¼Œåœ¨ç»˜åˆ¶QAbstractItemViewçš„è¡Œæ—¶ï¼Œä¸ºæ¯ä¸ªäº¤æ›¿è¡Œè®¾ç½®æ­¤çŠ¶æ€ :bottom æ­¤itemä½äºåº•éƒ¨æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBaræœ‰ä½äºåº•éƒ¨çš„é€‰é¡¹å¡ :checked æ­¤itemè¢«é€‰ä¸­æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQAbstractButtonçš„checkedçŠ¶æ€ :closable æ­¤itemå¯ä»¥è¢«å…³é—­æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQDockWidgetçš„QDockWidget::DockWidgetClosableç‰¹æ€§å¼€å¯æ—¶ :closed æ­¤itemå¤„äºå…³é—­çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTreeViewä¸­æœªå±•å¼€çš„item :default æ­¤itemçš„é»˜è®¤çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªdefaultçš„QPushButtonæˆ–QMenuä¸­çš„ä¸€ä¸ªé»˜è®¤åŠ¨ä½œ :disabled æ­¤itemè¢«ç¦ç”¨æ—¶è®¾ç½® :editable å¦‚QComboBoxæ˜¯å¯ç¼–è¾‘æ—¶è®¾ç½® :edit-focus æ­¤itemå…·æœ‰ç¼–è¾‘ç„¦ç‚¹(å‚è€ƒQStyle::State_HasEditFocus)æ—¶è®¾ç½®ã€‚æ­¤çŠ¶æ€ä»…å¯¹Qtæ‰©å±•åº”ç”¨ç¨‹åºå¯ç”¨ :enabled æ­¤itemå·²å¯ç”¨æ—¶è®¾ç½® :exclusive æ­¤itemæ˜¯å±äºæŸä¸ªç‹¬å ç»„æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œç‹¬å QActionGroupä¸­çš„èœå•é¡¹ :first æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„ç¬¬ä¸€é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBarä¸­çš„ç¬¬ä¸€ä¸ªé€‰é¡¹å¡ :flat æ­¤itemæ˜¯æ‰å¹³æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ‰å¹³çš„QPushButton :floatable æ­¤itemå¯ä»¥æµ®åŠ¨æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQDockWidgetçš„QDockWidget::DockWidgetFloatableçš„ç‰¹æ€§å¼€å¯æ—¶ :focus æ­¤itemå…·æœ‰è¾“å…¥ç„¦ç‚¹æ—¶è®¾ç½® :has-children æ­¤itemå…·æœ‰å­å¯¹è±¡æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTreeViewä¸­å…·æœ‰å­é¡¹çš„é¡¹ :has-sibling æ­¤itemå…·æœ‰å…„å¼Ÿå¯¹è±¡æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTreeViewä¸­ä¸ä¹‹ç›¸é‚»çš„é¡¹ :horizontal æ­¤itemå¤„äºæ°´å¹³æ–¹å‘æ—¶è®¾ç½® :hover é¼ æ ‡æ‚¬æµ®åœ¨æ­¤itemä¸Šæ—¶è®¾ç½® :indeterminate æ­¤itemå¤„äºä¸ç¡®å®šçŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQCheckBoxæˆ–QRadioButtonè¢«éƒ¨åˆ†é€‰ä¸­ :last æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBarä¸­çš„æœ€åä¸€ä¸ªé€‰é¡¹å¡ :left æ­¤itemä½äºå·¦ä¾§æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBaræœ‰ä½äºå·¦ä¾§çš„é€‰é¡¹å¡ :maximized æ­¤itemå¤„äºæœ€å¤§åŒ–çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ€å¤§åŒ–çš„QMdiSubWindow :middle æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„ä¸­é—´ä¸€é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸åœ¨QTabBarä¸­çš„å¼€å¤´æˆ–ç»“å°¾çš„é€‰é¡¹å¡ :minimized æ­¤itemå¤„äºæœ€å°åŒ–çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ€å°åŒ–çš„QMdiSubWindow :movable æ­¤itemå¯ä»¥è¢«ç§»åŠ¨æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œ QDockWidgetçš„QDockWidget::DockWidgetMovableç‰¹æ€§å¼€å¯æ—¶ :no-frame æ­¤itemæ²¡æœ‰è¾¹æ¡†æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰è¾¹æ¡†çš„QSpinBoxæˆ–QLineEdit :non-exclusive æ­¤itemæ˜¯å±äºéç‹¬å ç»„æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œéç‹¬å QActionGroupä¸­çš„èœå•é¡¹ :off å¯¹å¯ä»¥åˆ‡æ¢çš„itemsï¼Œè¿™é€‚ç”¨äºå¤„äºoffçŠ¶æ€çš„item :on å¯¹å¯ä»¥åˆ‡æ¢çš„itemsï¼Œè¿™é€‚ç”¨äºå¤„äºonçŠ¶æ€çš„widget :only-one æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„å”¯ä¸€é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåœ¨QTabBarä¸­å•ç‹¬çš„é€‰é¡¹å¡ :open æ­¤itemå¤„äºæ‰“å¼€çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTreeViewä¸­çš„å±•å¼€é¡¹ï¼Œæˆ–å¸¦æœ‰èœå•çš„QComboBoxæˆ–QPushButton :next-selected æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªè¢«é€‰ä¸­çš„é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨QTabBarä¸­å½“å‰é€‰é¡¹å¡çš„ä¸‹ä¸€ä¸ªè¦é€‰ä¸­çš„é€‰é¡¹å¡ :pressed é¼ æ ‡æ­£åœ¨æŒ‰å‹åœ¨æ­¤itemä¸Šæ—¶è®¾ç½® :previous-selected æ­¤itemæ˜¯åˆ—è¡¨ä¸­çš„ä¸Šä¸€ä¸ªè¢«é€‰ä¸­çš„é¡¹æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨QTabBarä¸­å½“å‰é€‰é¡¹å¡çš„ä¸Šä¸€ä¸ªè¦é€‰ä¸­çš„é€‰é¡¹å¡ :read-only æ­¤itemå¤„äºåªè¯»æˆ–ä¸å¯ç¼–è¾‘çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåªè¯»QLineEditæˆ–ä¸å¯ç¼–è¾‘çš„QComboBox :right æ­¤itemä½äºå³ä¾§æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBaræœ‰ä½äºå³ä¾§çš„é€‰é¡¹å¡ :selected æ­¤itemå¤„äºé€‰ä¸­çŠ¶æ€æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåœ¨QTabBarä¸­è¢«é€‰ä¸­çš„é€‰é¡¹å¡æˆ–ä¸€ä¸ªåœ¨èœå•ä¸­è¢«é€‰ä¸­çš„èœå•é¡¹ :top æ­¤itemä½äºé¡¶éƒ¨æ—¶è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQTabBaræœ‰ä½äºé¡¶éƒ¨çš„é€‰é¡¹å¡ :unchecked æ­¤itemå¤„äºæœªè¢«é€‰ä¸­çŠ¶æ€æ—¶è®¾ç½® :vertical æ­¤itemå¤„äºå‚ç›´æ–¹å‘æ—¶è®¾ç½® :window Widgetæ˜¯ä¸€ä¸ªçª—å£(ä¾‹å¦‚ï¼Œä¸€ä¸ªé¡¶å±‚Widget)æ—¶è®¾ç½® 3.2 å­æ§ä»¶åˆ—è¡¨ ä¼ªçŠ¶æ€éƒ½æ˜¯ä»¥ä¸¤ä¸ªå†’å·::å¼€å¤´ï¼Œå¦‚::itemã€‚ å­æ§ä»¶ æè¿° ::add-line åœ¨QScrollBarä¸­è·³è½¬ä¸‹ä¸€è¡Œçš„æŒ‰é’® ::add-page åœ¨QScrollBarä¸­æ»‘åŠ¨æ¡å’Œadd-lineä¹‹é—´çš„åŒºåŸŸ ::branch åœ¨QTreeViewä¸­çš„åˆ†æ”¯æŒ‡ç¤ºå™¨ ::chunk åœ¨QProgressBarä¸­çš„è¿›åº¦å— ::close-button åœ¨QDockWidgetæˆ–QTabBaré€‰é¡¹å¡çš„å…³é—­æŒ‰é’® ::corner åœ¨QAbstractScrollAreaä¸­ä¸¤ä¸ªæ»šåŠ¨æ¡ä¹‹é—´çš„è§’è½ ::down-arrow åœ¨QComboBoxã€QHeaderView(æ’åºæŒ‡ç¤ºå™¨)ã€QScrollBaræˆ–QSpinBoxçš„å‘ä¸‹ç®­å¤´ ::down-button åœ¨QScrollBaræˆ–QSpinBoxä¸­çš„å‘ä¸‹æŒ‰é’® ::drop-down åœ¨QComboBoxä¸­çš„ä¸‹æ‹‰æ¡† ::float-button åœ¨QDockWidgetä¸­çš„æµ®åŠ¨æŒ‰é’® ::groove åœ¨QSliderä¸­çš„æ»‘åŠ¨æ§½ ::indicator åœ¨QAbstractItemVIewã€QCheckBoxã€QRadioButtonã€å¯é€‰ä¸­çš„èœå•é¡¹æˆ–å¯é€‰ä¸­çš„QGroupBoxä¸­çš„æŒ‡ç¤ºå™¨ ::handle åœ¨QScrollBarã€QSplitterå’ŒQSliderä¸­çš„æ“ä½œæ¡(æ»‘åŠ¨æ¡) ::icon åœ¨QAbstractItemVIewæˆ–QMenuä¸­çš„å›¾æ ‡ ::item åœ¨QAbstractItemVIewã€QMenuBarã€QMenuæˆ–QStatuBarä¸­çš„ä¸€é¡¹ ::left-arrow åœ¨QScrollBarä¸­çš„å‘å·¦ç®­å¤´ ::left-corner åœ¨QTabWidgetä¸­çš„å·¦ä¸Šè§’ ::menu-arrow å¸¦æœ‰èœå•çš„QToolButtonä¸­çš„ç®­å¤´ ::menu-button åœ¨QToolButtonä¸­çš„èœå•æŒ‰é’® ::menu-indicator åœ¨QPushButtonä¸­çš„èœå•æŒ‡ç¤ºå™¨ ::right-arrow åœ¨QMenuæˆ–QScrollBarä¸­çš„å‘å³ç®­å¤´ ::pane åœ¨QTabWidgetä¸­çš„è¾¹æˆ–æ¡† ::right-corner åœ¨QTabWidgetä¸­çš„å³ä¸Šè§’ ::scroller åœ¨QMenuæˆ–QTabBarä¸­çš„æ»šåŠ¨æ¡ ::section åœ¨QHeaderViewä¸­çš„åŒºå— ::separator åœ¨QMenuæˆ–QMainWIndowä¸­åˆ†éš”æ¡ ::sub-line åœ¨QScrollBarä¸­è·³è½¬ä¸Šä¸€è¡Œçš„æŒ‰é’® ::sub-page åœ¨QScrollBarä¸­æ»‘åŠ¨æ¡å’Œsub-lineä¹‹é—´çš„åŒºåŸŸ ::tab åœ¨QTabBaræˆ–QToolBoxä¸­é€‰é¡¹å¡ ::tab-bar åœ¨QTabWidgetä¸­çš„é€‰é¡¹å¡æ  ::tear åœ¨QTabBarä¸­çš„tearæŒ‡ç¤ºå™¨ ::tearoff åœ¨QMenuä¸­çš„tear-offæŒ‡ç¤ºå™¨ ::text åœ¨QAbstractItemViewä¸­çš„æ–‡æœ¬ ::title åœ¨QGroupBoxæˆ–QDockWidgetä¸­çš„æ ‡é¢˜æ  ::up-arrow åœ¨QComboBoxã€QHeaderView(æ’åºæŒ‡ç¤ºå™¨)ã€QScrollBaræˆ–QSpinBoxçš„å‘ä¸Šç®­å¤´ ::up-button åœ¨QScrollBaræˆ–QSpinBoxä¸­çš„å‘ä¸ŠæŒ‰é’® ä½¿ç”¨ç¤ºä¾‹ï¼š 123QPushButton#btnTest::menu-indicator &#123; image: url(indicator.png);&#125; åŒæ—¶ä½¿ç”¨ä¼ªçŠ¶æ€å’Œå­æ§ä»¶æ—¶ï¼Œå…ˆæŒ‡å®šå­æ§ä»¶ï¼ŒåæŒ‡å®šä¼ªçŠ¶æ€ï¼š 123QComboBox::down-arrow:disabled&#123; image:none;&#125; å››ã€ç›’å­æ¨¡å‹åœ¨ä½¿ç”¨ QSS è®¾ç½®æ ·å¼æ—¶ï¼Œæœ‰ä¸€ä¸ªå…³é”®çš„æ¦‚å¿µéœ€è¦çŸ¥æ™“ï¼Œé‚£å°±æ˜¯â€œç›’å­æ¨¡å‹â€ï¼ˆå³Box Modelï¼‰ã€‚ æ¯ä¸ª Widget éƒ½è¢«è§†ä¸ºå…·æœ‰ 4 ä¸ªåŒå¿ƒçŸ©å½¢çš„æ¡†ï¼šMARGINçŸ©å½¢ã€BORDERçŸ©å½¢ã€PADDINGçŸ©å½¢å’ŒCONTENTçŸ©å½¢ï¼Œä¸Šå›¾æ ‡æ³¨äº†æ¯ä¸ªçŸ©å½¢çš„åŒºåŸŸã€‚ é»˜è®¤æƒ…å†µä¸‹MARGINçŸ©å½¢ã€BORDERçŸ©å½¢ã€PADDINGçŸ©å½¢çš„å®½åº¦éƒ½ä¸º 0ï¼Œè¿™æ ·åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ4 ä¸ªçŸ©å½¢å°±é‡åˆä¸º 1 ä¸ªCONTENTçŸ©å½¢äº†ã€‚ åŒæ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹background-imageæŒ‡å®šçš„èƒŒæ™¯ï¼Œåªåœ¨ border å†…çš„åŒºåŸŸç»˜åˆ¶ã€‚ä½†æˆ‘ä»¬è¦ä¹Ÿå¯ä»¥ä½¿ç”¨background-clipæˆ–background-originå±æ€§æ¥æ›´æ”¹è¿™ç§é»˜è®¤è¡Œä¸ºã€‚ å¦‚ä½•å®ç°èƒŒæ™¯å›¾åƒéš Widget å¤§å°è‡ªåŠ¨ç¼©æ”¾ï¼Ÿbackground-image æŒ‡å®šçš„èƒŒæ™¯å›¾åƒæ— æ³•éš Widget å¤§å°è‡ªåŠ¨ç¼©æ”¾ï¼Œè¦æä¾›å¯ä»¥éš Widget å¤§å°ç¼©æ”¾çš„èƒŒæ™¯å›¾åƒå¯ä»¥ä½¿ç”¨border-imageå’Œimageå±æ€§ï¼ŒäºŒè€…åŒºåˆ«å¦‚ä¸‹ï¼š border-image å±æ€§æŒ‡å®šçš„å›¾åƒä» border åŠå…¶å†…çš„åŒºåŸŸå¼€å§‹ç»˜åˆ¶ï¼Œä¼šå¯¼è‡´ border å±æ€§è¢«è¦†ç›–ã€‚ image å±æ€§æŒ‡å®šçš„å›¾åƒä»ç»˜åˆ¶åˆ° content åŒºåŸŸå†…ï¼Œimage æŒ‡å®šçš„ url ä¸º SVG å›¾åƒï¼Œåˆ™æ”¯æŒè‡ªåŠ¨ç¼©æ”¾ï¼Œé SVG å›¾åƒä»…æ”¯æŒè‡ªåŠ¨ç¼©å°ã€‚ äº”ã€åŠ¨æ€å±æ€§é€šè¿‡ setProperty æ–¹æ³•è®¾ç½® QWidget å¯¹è±¡å±æ€§ï¼Œåœ¨ QSS ä¸­å¯ä»¥æ ¹æ®ä¸åŒçš„å±æ€§å€¼åº”ç”¨ä¸åŒçš„æ ·å¼ã€‚ è®¾ç½® pushButtonMax æŒ‰é’®çš„ isMax å±æ€§ï¼Œè¡¨ç¤ºå½“å‰çª—å£æ˜¯å¦æœ€å¤§åŒ–ï¼š 1pushButtonMax-&gt;setProperty(&quot;isMax&quot;, this-&gt;isMaximized() ? true : false); åœ¨ QSS ä¸­æ ¹æ®ä¸åŒçš„å±æ€§å€¼åº”ç”¨ä¸åŒçš„æ ·å¼ï¼š 12345678910111213141516171819#pushButtonMax[isMax=&quot;false&quot;] &#123; width: 40px; height: 40px; background: gray;&#125;#pushButtonMax[isMax=&quot;false&quot;]:hover &#123; background: blue;&#125;#pushButtonMax[isMax=&quot;true&quot;] &#123; width: 40px; height: 40px; background: transparent;&#125;#pushButtonMax[isMax=&quot;true&quot;]:hover &#123; background: red;&#125; å…­ã€Q_PROPERTYåœ¨ Qt ä¸­å¯ä»¥ä½¿ç”¨Q_PROPERTYå®ä¸º QObject å¯¹è±¡ï¼ˆå«å­å¯¹è±¡ï¼‰å£°æ˜å±æ€§ï¼Œä»»ä½•è¢«Q_PROPERTYå£°æ˜çš„å±æ€§éƒ½èƒ½åœ¨ QSS ä¸­ä½¿ç”¨qproperty-&lt;property name&gt;è¯­æ³•è¿›è¡Œè®¾ç½®ã€‚ ä»¥ QToolButton ä¸ºä¾‹ï¼ŒQToolButton ç»§æ‰¿è‡³ QAbstractButtonï¼ŒQAbstractButton æ‹¥æœ‰ä»¥ä¸‹è¢« Q_PROPERTY å£°æ˜çš„å±æ€§ï¼š 12345678910111213141516171819class Q_WIDGETS_EXPORT QAbstractButton : public QWidget&#123; Q_OBJECT Q_PROPERTY(QString text READ text WRITE setText) Q_PROPERTY(QIcon icon READ icon WRITE setIcon) Q_PROPERTY(QSize iconSize READ iconSize WRITE setIconSize)#ifndef QT_NO_SHORTCUT Q_PROPERTY(QKeySequence shortcut READ shortcut WRITE setShortcut)#endif Q_PROPERTY(bool checkable READ isCheckable WRITE setCheckable) Q_PROPERTY(bool checked READ isChecked WRITE setChecked DESIGNABLE isCheckable NOTIFY toggled USER true) Q_PROPERTY(bool autoRepeat READ autoRepeat WRITE setAutoRepeat) Q_PROPERTY(bool autoExclusive READ autoExclusive WRITE setAutoExclusive) Q_PROPERTY(int autoRepeatDelay READ autoRepeatDelay WRITE setAutoRepeatDelay) Q_PROPERTY(int autoRepeatInterval READ autoRepeatInterval WRITE setAutoRepeatInterval) Q_PROPERTY(bool down READ isDown WRITE setDown DESIGNABLE false) ....&#125; åœ¨ QSS ä¸­å¯ä»¥ç›´æ¥å¯¹å±æ€§èµ‹å€¼ï¼Œå¦‚ï¼š 12345QToolButton &#123; qproperty-text: &quot;æ–‡æœ¬&quot;; qproperty-icon: url(://img/icon.png); qproperty-iconsize: 100px 100px;&#125; ä¸ƒã€Paddingå’ŒMarginçš„ä½¿ç”¨MarginæŒ‡æ§ä»¶å’Œå…¶ä»–æ§ä»¶çš„é—´è·ï¼Œè€ŒPaddingæŒ‡æ§ä»¶å†…çš„å†…å®¹ä¸è¾¹æ¡†çš„é—´è·ã€‚ äºŒè€…çš„è¯­æ³•ä¸CSSä¸­çš„ä¸€æ ·ï¼š 12margin: 25px 50px 75px 100px;padding: 25px 50px 75px 100px; ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼šä¸Šã€å³ã€ä¸‹ã€å·¦ã€‚ æ”¯æŒç®€å†™å½¢å¼ï¼š 12margin: 25px 50px;padding: 25px 50px; è¡¨ç¤ºï¼šä¸Šä¸‹é—´è·ä¸º25pxï¼Œå·¦å³é—´è·ä¸º50pxã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["Qt","QSS"],"categories":["Qt"]},{"title":"C++ é»˜è®¤æ„é€ å‡½æ•°","path":"/post/818165951.html","content":"æœ¬æ–‡å›´ç»• 3 ä¸ªé—®é¢˜æ¥ç†è§£ C++çš„é»˜è®¤æ„é€ å‡½æ•°ï¼š ä»€ä¹ˆæ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼Ÿ é»˜è®¤æ„é€ å‡½æ•°ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Ÿ ç¼–è¯‘å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼Ÿ ä¸€. ä»€ä¹ˆæ˜¯é»˜è®¤æ„é€ å‡½æ•°æˆ‘ä»¬ä¸€èˆ¬ä¼šè®¤ä¸ºé»˜è®¤æ„é€ å‡½æ•°å°±æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„é‚£ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶å®è¿™ç§ç†è§£ä¸å…¨é¢ã€‚ å‡†ç¡®çš„è¯´ï¼Œé»˜è®¤æ„é€ å‡½æ•°å°±æ˜¯åœ¨è°ƒç”¨æ—¶ä¸éœ€è¦æ˜¾ç¤ºåœ°ä¼ å…¥å®å‚çš„æ„é€ å‡½æ•°ã€‚ æ ¹æ®è¿™ä¸ªåŸåˆ™ï¼Œä¸‹é¢ä¸¤ç§æ„é€ å‡½æ•°éƒ½æ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼š 1234567class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•°ã€‚ Sample() &#123; // do something &#125;&#125;; 1234567class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•°ã€‚è™½ç„¶æœ‰å½¢å‚ï¼Œä½†æœ‰é»˜è®¤å€¼ï¼Œè°ƒç”¨çš„æ—¶å€™å¯ä»¥ä¸æ˜¾ç¤ºçš„ä¼ å…¥å®å‚ã€‚ Sample(int m = 10) &#123; // do something &#125;&#125;; äºŒ. é»˜è®¤æ„é€ å‡½æ•°ä½•æ—¶è¢«è°ƒç”¨å¦‚æœå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ—¶æ²¡æœ‰ä½¿ç”¨åˆå§‹åŒ–å¼ï¼Œç¼–è¯‘å™¨å°±ä¼šä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚ï¼š 1Sample s; ä¸‰. ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°æœ‰ä¸€å¥å¾ˆç»å…¸çš„è¯å¯ä»¥ç”¨æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼šæƒŸæœ‰é»˜è®¤æ„é€ å‡½æ•°è¢«ç¼–è¯‘å™¨éœ€è¦çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨æ‰ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€‚ é‚£æˆ‘ä»¬åªéœ€çŸ¥é“ä»€ä¹ˆæ—¶å€™â€œè¢«ç¼–è¯‘å™¨éœ€è¦â€ï¼Œå°±å¯ä»¥çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°äº†ã€‚ ä¸‹é¢å‡ ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘éœ€è¦ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ï¼š å½“è¯¥ç±»çš„ç±»å¯¹è±¡æ•°æ®æˆå‘˜æœ‰é»˜è®¤æ„é€ å‡½æ•°æ—¶ã€‚ å½“è¯¥ç±»çš„åŸºç±»æœ‰é»˜è®¤æ„é€ å‡½æ•°æ—¶ã€‚ å½“è¯¥ç±»çš„åŸºç±»ä¸ºè™šåŸºç±»æ—¶ã€‚ å½“è¯¥ç±»æœ‰è™šå‡½æ•°æ—¶ã€‚ å››. æ³¨æ„äº‹é¡¹4.1 é¿å…æ— å‚å’Œç¼ºçœåŒæ—¶å­˜åœ¨æ— å‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°å’Œå¸¦ç¼ºçœå‚æ•°çš„é»˜è®¤æ„é€ å‡½æ•°åŒæ—¶å­˜åœ¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”ŸäºŒä¹‰æ€§ï¼Œä»è€Œç”Ÿæˆç¼–è¯‘é”™è¯¯ã€‚ 12345678910111213141516171819202122class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•° Sample() &#123; // do something printf(&quot;Sample()&quot;); &#125; // é»˜è®¤æ„é€ å‡½æ•° Sample(int m = 10) &#123; // do something printf(&quot;Sample(int m = 10)&quot;); &#125;&#125;;int main()&#123; Sample s; // error C2668: â€œSample::Sampleâ€: å¯¹é‡è½½å‡½æ•°çš„è°ƒç”¨ä¸æ˜ç¡® return 0;&#125; 4.2 ä¸åº”åœ¨å¯¹è±¡ååé¢åŠ ä¸Šæ‹¬å·ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸åº”åœ¨å¯¹è±¡ååé¢åŠ ä¸Šæ‹¬å·ï¼Œå¦åˆ™ä¼šäº§ç”Ÿç¼–è¯‘è­¦å‘Š 1warning C4930: â€œSample s(void)â€: æœªè°ƒç”¨åŸå‹å‡½æ•°(æ˜¯å¦æ˜¯æœ‰æ„ç”¨å˜é‡å®šä¹‰çš„?) å› ä¸ºç¼–è¯‘å™¨è¯¯è®¤ä¸ºSample s()è¯­å¥æ˜¯è¦å£°æ˜ä¸€ä¸ªè¿”å›å€¼ä¸ºSampleå¯¹è±¡çš„å‡½æ•°sï¼Œè€Œå®ƒåˆæ²¡æ‰¾åˆ°å‡½æ•°sçš„å®šä¹‰ï¼Œæ‰€ä»¥äº§ç”Ÿäº†è­¦å‘Šã€‚ 12345678910111213141516class Sample &#123;public: // é»˜è®¤æ„é€ å‡½æ•° Sample() &#123; // do something printf(&quot;Sample()&quot;); &#125;&#125;;int main()&#123; Sample s(); // warning C4930: â€œSample s(void)â€: æœªè°ƒç”¨åŸå‹å‡½æ•°(æ˜¯å¦æ˜¯æœ‰æ„ç”¨å˜é‡å®šä¹‰çš„?) return 0;&#125;","tags":["C++","æ„é€ å‡½æ•°"],"categories":["C++è¯­è¨€"]},{"title":"C++å†…å­˜æ± å®ç°","path":"/post/581068365.html","content":"æœ¬æ–‡ä»å®é™…éœ€æ±‚å‡ºå‘ï¼Œä»‹ç»äº†å†…å­˜æ± çš„å®ç°åŸç†ï¼Œå¹¶ä¸”æä¾›äº†å…·ä½“çš„å®ç°æ–¹æ¡ˆã€‚ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å†…å­˜æ± åœ¨ C&#x2F;C++ ä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ mallocã€freeæˆ–newã€delete æ¥åŠ¨æ€åˆ†é…å†…å­˜ã€‚ä¸€æ–¹é¢ï¼Œå› ä¸ºè¿™äº›å‡½æ•°æ¶‰åŠåˆ°äº†ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥é¢‘ç¹çš„è°ƒç”¨å¿…ç„¶ä¼šå¯¼è‡´ç¨‹åºæ€§èƒ½çš„æŸè€—ï¼› å¦ä¸€æ–¹é¢ï¼Œé¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾å°å—å†…å­˜ä¼šå¯¼è‡´å¤§é‡çš„å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿï¼Œå½“ç¢ç‰‡ç§¯ç´¯åˆ°ä¸€å®šçš„é‡ä¹‹åï¼Œå°†æ— æ³•åˆ†é…åˆ°è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç³»ç»Ÿä¸å¾—ä¸è¿›è¡Œç¢ç‰‡æ•´ç†æ¥æ»¡è¶³åˆ†é…åˆ°è¿ç»­çš„ç©ºé—´ï¼Œè¿™æ ·ä¸ä»…ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½æŸè€—ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç¨‹åºå¯¹å†…å­˜çš„åˆ©ç”¨ç‡ä½ä¸‹ã€‚ å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºä¸éœ€è¦é¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾å°å—å†…å­˜ï¼Œé‚£å°±æ²¡æœ‰ä½¿ç”¨å†…å­˜æ± çš„å¿…è¦ï¼Œç›´æ¥ä½¿ç”¨malloc,freeæˆ–new,deleteå‡½æ•°å³å¯ã€‚ äºŒã€å†…å­˜æ± çš„å®ç°æ–¹æ¡ˆå†…å­˜æ± çš„å®ç°åŸç†å¤§è‡´å¦‚ä¸‹ï¼š æå‰ç”³è¯·ä¸€å—å¤§å†…å­˜äº¤ç”±å†…å­˜æ± ç®¡ç†ï¼Œå¹¶åˆ†æˆå°ç‰‡ä¾›ç»™ç¨‹åºä½¿ç”¨ã€‚ç¨‹åºä½¿ç”¨å®Œä¹‹åå°†å†…å­˜å½’è¿˜åˆ°å†…å­˜æ± ä¸­ï¼ˆå¹¶æ²¡æœ‰çœŸæ­£çš„ä»ç³»ç»Ÿé‡Šæ”¾ï¼‰ï¼Œå½“ç¨‹åºå†æ¬¡ä»å†…å­˜æ± ä¸­è¯·æ±‚å†…å­˜æ—¶ï¼Œå†…å­˜æ± å°†æ± å­ä¸­çš„å¯ç”¨å†…å­˜ç‰‡è¿”å›ç»™ç¨‹åºä½¿ç”¨ã€‚ æˆ‘ä»¬åœ¨è®¾è®¡å†…å­˜æ± çš„å®ç°æ–¹æ¡ˆæ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š å†…å­˜æ± æ˜¯å¦å¯ä»¥è‡ªåŠ¨å¢é•¿ï¼Ÿ å¦‚æœå†…å­˜æ± çš„æœ€å¤§ç©ºé—´æ˜¯å›ºå®šçš„ï¼ˆä¹Ÿå°±æ˜¯éè‡ªåŠ¨å¢é•¿ï¼‰ï¼Œé‚£ä¹ˆå½“å†…å­˜æ± ä¸­çš„å†…å­˜è¢«è¯·æ±‚å®Œä¹‹åï¼Œç¨‹åºå°±æ— æ³•å†æ¬¡ä»å†…å­˜æ± è¯·æ±‚åˆ°å†…å­˜ã€‚æ‰€ä»¥éœ€è¦æ ¹æ®ç¨‹åºå¯¹å†…å­˜çš„å®é™…ä½¿ç”¨æƒ…å†µæ¥ç¡®å®šæ˜¯å¦éœ€è¦è‡ªåŠ¨å¢é•¿ã€‚ å†…å­˜æ± çš„æ€»å†…å­˜å ç”¨æ˜¯å¦åªå¢ä¸å‡ï¼Ÿ å¦‚æœå†…å­˜æ± æ˜¯è‡ªåŠ¨å¢é•¿çš„ï¼Œå°±æ¶‰åŠåˆ°äº†â€œå†…å­˜æ± çš„æ€»å†…å­˜å ç”¨æ˜¯å¦æ˜¯åªå¢ä¸å‡â€è¿™ä¸ªé—®é¢˜äº†ã€‚è¯•æƒ³ï¼Œç¨‹åºä»ä¸€ä¸ªè‡ªåŠ¨å¢é•¿çš„å†…å­˜æ± ä¸­è¯·æ±‚äº† 1000 ä¸ªå¤§å°ä¸º 100KB çš„å†…å­˜ç‰‡ï¼Œå¹¶åœ¨ä½¿ç”¨å®Œä¹‹åå…¨éƒ¨å½’è¿˜ç»™äº†å†…å­˜æ± ï¼Œè€Œä¸”å‡è®¾ç¨‹åºä¹‹åçš„é€»è¾‘æœ€å¤šåªéœ€è¦ 10 ä¸ª 100KB çš„å†…å­˜ç‰‡ï¼Œè¯¥å†…å­˜æ± ä¸­çš„ 900 ä¸ª 100KB çš„å†…å­˜ç‰‡å°±ä¸€ç›´å¤„äºé—²ç½®çŠ¶æ€ï¼Œç¨‹åºå†…å­˜å ç”¨å°±ä¸€ç›´é™ä¸‹æ¥ã€‚å¯¹å†…å­˜å ç”¨å¤§å°æœ‰è¦æ±‚çš„ç¨‹åºéœ€è¦è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚ å†…å­˜æ± ä¸­å†…å­˜ç‰‡çš„å¤§å°æ˜¯å¦å›ºå®šï¼Ÿ å¦‚æœæ¯æ¬¡ä»å†…å­˜æ± ä¸­çš„è¯·æ±‚çš„å†…å­˜ç‰‡çš„å¤§å°å¦‚æœä¸å›ºå®šï¼Œé‚£ä¹ˆå†…å­˜æ± ä¸­çš„æ¯ä¸ªå¯ç”¨å†…å­˜ç‰‡çš„å¤§å°å°±ä¸ä¸€è‡´ï¼Œç¨‹åºå†æ¬¡è¯·æ±‚å†…å­˜ç‰‡çš„æ—¶å€™ï¼Œå†…å­˜æ± å°±éœ€è¦åœ¨â€œåŒ¹é…æœ€ä½³å¤§å°çš„å†…å­˜ç‰‡â€å’Œâ€œåŒ¹é…æ“ä½œæ—¶é—´â€ä¸Šä½œå‡ºè¡¡é‡ã€‚â€œæœ€ä½³å¤§å°çš„å†…å­˜ç‰‡â€è™½ç„¶å¯ä»¥å‡å°‘å†…å­˜çš„æµªè´¹ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´â€œåŒ¹é…æ—¶é—´â€å˜é•¿ã€‚ å†…å­˜æ± æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ æ˜¯å¦å…è®¸åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä»åŒä¸€ä¸ªå†…å­˜æ± ä¸­è¯·æ±‚å’Œå½’è¿˜å†…å­˜ç‰‡ï¼Ÿè¿™ä¸ªçº¿ç¨‹å®‰å…¨å¯ä»¥ç”±å†…å­˜æ± æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”±ä½¿ç”¨è€…æ¥ä¿è¯ã€‚ å†…å­˜ç‰‡åˆ†é…å‡ºå»ä¹‹å‰å’Œå½’è¿˜åˆ°å†…å­˜æ± ä¹‹åï¼Œå…¶ä¸­çš„å†…å®¹æ˜¯å¦éœ€è¦è¢«æ¸…é™¤ï¼Ÿ ç¨‹åºå¯èƒ½å‡ºç°å°†å†…å­˜ç‰‡å½’è¿˜ç»™å†…å­˜æ± ä¹‹åï¼Œä»ç„¶ä½¿ç”¨å†…å­˜ç‰‡çš„åœ°å€æŒ‡é’ˆè¿›è¡Œå†…å­˜è¯»å†™æ“ä½œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¸å¯é¢„æœŸçš„ç»“æœã€‚å°†å†…å®¹æ¸…é›¶åªèƒ½å°½é‡çš„ï¼ˆä¹Ÿä¸ä¸€å®šèƒ½ï¼‰å°†é—®é¢˜æŠ›å‡ºæ¥ï¼Œä½†å¹¶ä¸èƒ½è§£å†³ä»»ä½•é—®é¢˜ï¼Œè€Œä¸”å°†å†…å®¹æ¸…é›¶ä¼šæ¶ˆè€—ä¸€å®šçš„ CPU æ—¶é—´ã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆæœ€å¥½è¿˜æ˜¯éœ€è¦ç”±å†…å­˜æ± çš„ä½¿ç”¨è€…æ¥ä¿è¯è¿™ç§å®‰å…¨æ€§ã€‚ æ˜¯å¦å…¼å®¹ std::allocator ï¼Ÿ STL æ ‡å‡†åº“ä¸­çš„å¤§å¤šç±»éƒ½æ”¯æŒç”¨æˆ·æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„å†…å­˜åˆ†é…å™¨ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ std::allocatorï¼Œå¦‚ std::string ï¼š 1typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt; &gt; string; å¦‚æœæˆ‘ä»¬çš„å†…å­˜æ± å…¼å®¹ std::allocatorï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å†…å­˜æ± æ¥æ›¿æ¢é»˜è®¤çš„ std::allocator åˆ†é…å™¨ï¼Œå¦‚ï¼š 1typedef basic_string&lt;char, char_traits&lt;char&gt;, MemoryPoll&lt;char&gt; &gt; mystring; å…³äºå¦‚ä½•å…¼å®¹std::allocatorï¼Œå¯ä»¥å‚è€ƒï¼š http://www.cplusplus.com/reference/memory/allocator/ ä¸‰ã€å†…å­˜æ± çš„å…·ä½“å®ç°ç°åœ¨å®ç°ä¸€ä¸ªå†…å­˜æ± ï¼Œç±»åä¸ºMemoryPoolï¼Œå®ƒå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å†…å­˜æ± çš„æ€»å¤§å°è‡ªåŠ¨å¢é•¿ã€‚ å†…å­˜æ± ä¸­å†…å­˜ç‰‡çš„å¤§å°å›ºå®šã€‚ æ”¯æŒçº¿ç¨‹å®‰å…¨ã€‚ åœ¨å†…å­˜ç‰‡è¢«å½’è¿˜ä¹‹åï¼Œæ¸…é™¤å…¶ä¸­çš„å†…å®¹ã€‚ å…¼å®¹ std::allocator ã€‚ å› ä¸ºå†…å­˜æ± çš„å†…å­˜ç‰‡çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸æ¶‰åŠåˆ°éœ€è¦åŒ¹é…æœ€åˆé€‚å¤§å°çš„å†…å­˜ç‰‡ï¼Œç”±äºä¼šé¢‘ç¹çš„è¿›è¡Œæ’å…¥ã€ç§»é™¤çš„æ“ä½œï¼Œä½†æŸ¥æ‰¾æ¯”è¾ƒå°‘ï¼Œæ•…é€‰ç”¨é“¾è¡¨æ•°æ®ç»“æ„æ¥ç®¡ç†å†…å­˜æ± ä¸­çš„å†…å­˜ç‰‡ã€‚ MemoryPool ä¸­æœ‰ 2 ä¸ªé“¾è¡¨ï¼Œå®ƒä»¬éƒ½æ˜¯åŒå‘é“¾è¡¨ï¼ˆè®¾è®¡æˆåŒå‘é“¾è¡¨ä¸»è¦æ˜¯ä¸ºäº†åœ¨ç§»é™¤æŒ‡å®šå…ƒç´ æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®šä½è¯¥å…ƒç´ çš„å‰åå…ƒç´ ï¼Œä»è€Œåœ¨è¯¥å…ƒç´ è¢«ç§»é™¤åï¼Œå°†å…¶å‰åå…ƒç´ è¿æ¥èµ·æ¥ï¼Œä¿è¯é“¾è¡¨çš„å®Œæ•´æ€§ï¼‰ï¼š data_element_ è®°å½•ä»¥åŠåˆ†é…å‡ºå»çš„å†…å­˜ç‰‡ã€‚ free_element_ è®°å½•æœªè¢«åˆ†é…å‡ºå»çš„å†…å­˜ç‰‡ã€‚ 3.1 MemoryPoolå®ç°ä»£ç ä¸‹é¢æ˜¯å®Œæ•´çš„å†…å­˜æ± å®ç°çš„ä»£ç ï¼Œä»£ç ä¸­ä½¿ç”¨äº† std::mutex ç­‰ C++11 æ‰æ”¯æŒçš„ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦ç¼–è¯‘å™¨æœ€ä½æ”¯æŒ C++11ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302/* MemoryPool.hpp */#ifndef MEMORY_POOL_H_#define MEMORY_POOL_H_#include &lt;climits&gt;#include &lt;cstddef&gt;#include &lt;mutex&gt;template &lt;typename T, size_t BlockSize = 4096, bool ZeroOnDeallocate = true&gt;class MemoryPool &#123;public: /* Member types */ typedef T value_type; typedef T* pointer; typedef T&amp; reference; typedef const T* const_pointer; typedef const T&amp; const_reference; typedef size_t size_type; typedef ptrdiff_t difference_type; typedef std::false_type propagate_on_container_copy_assignment; typedef std::true_type propagate_on_container_move_assignment; typedef std::true_type propagate_on_container_swap; template &lt;typename U&gt; struct rebind &#123; typedef MemoryPool&lt;U&gt; other; &#125;; /* Member functions */ MemoryPool() noexcept; MemoryPool(const MemoryPool&amp; memoryPool) noexcept; MemoryPool(MemoryPool&amp;&amp; memoryPool) noexcept; template &lt;class U&gt; MemoryPool(const MemoryPool&lt;U&gt;&amp; memoryPool) noexcept; ~MemoryPool() noexcept; MemoryPool&amp; operator=(const MemoryPool&amp; memoryPool) = delete; MemoryPool&amp; operator=(MemoryPool&amp;&amp; memoryPool) noexcept; pointer address(reference x) const noexcept; const_pointer address(const_reference x) const noexcept; // Can only allocate one object at a time. n and hint are ignored pointer allocate(size_type n = 1, const_pointer hint = 0); void deallocate(pointer p, size_type n = 1); size_type max_size() const noexcept; template &lt;class U, class... Args&gt; void construct(U* p, Args&amp;&amp;... args); template &lt;class U&gt; void destroy(U* p); template &lt;class... Args&gt; pointer newElement(Args&amp;&amp;... args); void deleteElement(pointer p);private: struct Element_ &#123; Element_* pre; Element_* next; &#125;; typedef char* data_pointer; typedef Element_ element_type; typedef Element_* element_pointer; element_pointer data_element_; element_pointer free_element_; std::recursive_mutex m_; size_type padPointer(data_pointer p, size_type align) const noexcept; void allocateBlock(); static_assert(BlockSize &gt;= 2 * sizeof(element_type), &quot;BlockSize too small.&quot;);&#125;;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::size_type MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::padPointer(data_pointer p, size_type align) const noexcept &#123; uintptr_t result = reinterpret_cast&lt;uintptr_t&gt;(p); return ((align - result) % align);&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::MemoryPool() noexcept &#123; data_element_ = nullptr; free_element_ = nullptr;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::MemoryPool(const MemoryPool&amp; memoryPool) noexcept : MemoryPool() &#123;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::MemoryPool(MemoryPool&amp;&amp; memoryPool) noexcept &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); data_element_ = memoryPool.data_element_; memoryPool.data_element_ = nullptr; free_element_ = memoryPool.free_element_; memoryPool.free_element_ = nullptr;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;template&lt;class U&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::MemoryPool(const MemoryPool&lt;U&gt;&amp; memoryPool) noexcept : MemoryPool() &#123;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;&amp; MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::operator=(MemoryPool&amp;&amp; memoryPool) noexcept &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); if (this != &amp;memoryPool) &#123; std::swap(data_element_, memoryPool.data_element_); std::swap(free_element_, memoryPool.free_element_); &#125; return *this;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::~MemoryPool() noexcept &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); element_pointer curr = data_element_; while (curr != nullptr) &#123; element_pointer prev = curr-&gt;next; operator delete(reinterpret_cast&lt;void*&gt;(curr)); curr = prev; &#125; curr = free_element_; while (curr != nullptr) &#123; element_pointer prev = curr-&gt;next; operator delete(reinterpret_cast&lt;void*&gt;(curr)); curr = prev; &#125;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::pointer MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::address(reference x) const noexcept &#123; return &amp;x;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::const_pointer MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::address(const_reference x) const noexcept &#123; return &amp;x;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;void MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::allocateBlock() &#123; // Allocate space for the new block and store a pointer to the previous one data_pointer new_block = reinterpret_cast&lt;data_pointer&gt; (operator new(BlockSize)); element_pointer new_ele_pointer = reinterpret_cast&lt;element_pointer&gt;(new_block); new_ele_pointer-&gt;pre = nullptr; new_ele_pointer-&gt;next = nullptr; if (data_element_) &#123; data_element_-&gt;pre = new_ele_pointer; &#125; new_ele_pointer-&gt;next = data_element_; data_element_ = new_ele_pointer;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::pointer MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::allocate(size_type n, const_pointer hint) &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); if (free_element_ != nullptr) &#123; data_pointer body = reinterpret_cast&lt;data_pointer&gt;(reinterpret_cast&lt;data_pointer&gt;(free_element_) + sizeof(element_type)); size_type bodyPadding = padPointer(body, alignof(element_type)); pointer result = reinterpret_cast&lt;pointer&gt;(reinterpret_cast&lt;data_pointer&gt;(body + bodyPadding)); element_pointer tmp = free_element_; free_element_ = free_element_-&gt;next; if (free_element_) free_element_-&gt;pre = nullptr; tmp-&gt;next = data_element_; if (data_element_) data_element_-&gt;pre = tmp; tmp-&gt;pre = nullptr; data_element_ = tmp; return result; &#125; else &#123; allocateBlock(); data_pointer body = reinterpret_cast&lt;data_pointer&gt;(reinterpret_cast&lt;data_pointer&gt;(data_element_) + sizeof(element_type)); size_type bodyPadding = padPointer(body, alignof(element_type)); pointer result = reinterpret_cast&lt;pointer&gt;(reinterpret_cast&lt;data_pointer&gt;(body + bodyPadding)); return result; &#125;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline void MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::deallocate(pointer p, size_type n) &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); if (p != nullptr) &#123; element_pointer ele_p = reinterpret_cast&lt;element_pointer&gt;(reinterpret_cast&lt;data_pointer&gt;(p) - sizeof(element_type)); if (ZeroOnDeallocate) &#123; memset(reinterpret_cast&lt;data_pointer&gt;(p), 0, BlockSize - sizeof(element_type)); &#125; if (ele_p-&gt;pre) &#123; ele_p-&gt;pre-&gt;next = ele_p-&gt;next; &#125; if (ele_p-&gt;next) &#123; ele_p-&gt;next-&gt;pre = ele_p-&gt;pre; &#125; if (ele_p-&gt;pre == nullptr) &#123; data_element_ = ele_p-&gt;next; &#125; ele_p-&gt;pre = nullptr; if (free_element_) &#123; ele_p-&gt;next = free_element_; free_element_-&gt;pre = ele_p; &#125; else &#123; ele_p-&gt;next = nullptr; &#125; free_element_ = ele_p; &#125;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::size_type MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::max_size() const noexcept &#123; size_type maxBlocks = -1 / BlockSize; return (BlockSize - sizeof(data_pointer)) / sizeof(element_type) * maxBlocks;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;template &lt;class U, class... Args&gt;inline void MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::construct(U* p, Args&amp;&amp;... args) &#123; new (p) U(std::forward&lt;Args&gt;(args)...);&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;template &lt;class U&gt;inline void MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::destroy(U* p) &#123; p-&gt;~U();&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;template &lt;class... Args&gt;inline typename MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::pointer MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::newElement(Args&amp;&amp;... args) &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); pointer result = allocate(); construct&lt;value_type&gt;(result, std::forward&lt;Args&gt;(args)...); return result;&#125;template &lt;typename T, size_t BlockSize, bool ZeroOnDeallocate&gt;inline void MemoryPool&lt;T, BlockSize, ZeroOnDeallocate&gt;::deleteElement(pointer p) &#123; std::lock_guard&lt;std::recursive_mutex&gt; lock(m_); if (p != nullptr) &#123; p-&gt;~value_type(); deallocate(p); &#125;&#125;#endif 3.2 ä½¿ç”¨ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889#include &quot;MemoryPool.hpp&quot;#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;assert.h&gt;using namespace std;class Apple &#123;public: Apple() &#123; id_ = 0; cout &lt;&lt; &quot;Apple()&quot; &lt;&lt; endl; &#125; Apple(int id) &#123; id_ = id; cout &lt;&lt; &quot;Apple(&quot; &lt;&lt; id_ &lt;&lt; &quot;)&quot; &lt;&lt; endl; &#125; ~Apple() &#123; cout &lt;&lt; &quot;~Apple()&quot; &lt;&lt; endl; &#125; void SetId(int id) &#123; id_ = id; &#125; int GetId() &#123; return id_; &#125;private: int id_;&#125;;void ThreadProc(MemoryPool&lt;char&gt; *mp) &#123; int i = 0; while (i++ &lt; 100000) &#123; char* p0 = (char*)mp-&gt;allocate(); char* p1 = (char*)mp-&gt;allocate(); mp-&gt;deallocate(p0); char* p2 = (char*)mp-&gt;allocate(); mp-&gt;deallocate(p1); mp-&gt;deallocate(p2); &#125;&#125;int main()&#123; MemoryPool&lt;char&gt; mp; int i = 0; while (i++ &lt; 100000) &#123; char* p0 = (char*)mp.allocate(); char* p1 = (char*)mp.allocate(); mp.deallocate(p0); char* p2 = (char*)mp.allocate(); mp.deallocate(p1); mp.deallocate(p2); &#125; std::thread th0(ThreadProc, &amp;mp); std::thread th1(ThreadProc, &amp;mp); std::thread th2(ThreadProc, &amp;mp); th0.join(); th1.join(); th2.join(); Apple* apple = nullptr; MemoryPool&lt;Apple&gt; mp2; apple = mp2.newElement(10); assert(apple); int a = apple-&gt;GetId(); // 10 assert(a == 10); apple-&gt;SetId(12); mp2.deleteElement(apple); return 0;&#125;","tags":["C++","å†…å­˜æ± ","å¤šçº¿ç¨‹"],"categories":["C++è¯­è¨€"]},{"title":"ç§»é™¤Qtæ§ä»¶è™šçº¿æ¡†","path":"/post/2202762022.html","content":"æ–¹å¼ä¸€ï¼šä½¿ç”¨ StyleSheet123QWidget:focus &#123; outline: none; /* å»æ‰å¾—åˆ°ç„¦ç‚¹æ—¶çš„è™šçº¿æ¡† */&#125; æ–¹å¼äºŒï¼šç»§æ‰¿ QProxyStyleç»§æ‰¿ QProxyStyleï¼ŒPrimitiveElement ä¸º QStyle::PE_FrameFocusRect æ—¶ä¸ç»˜åˆ¶è™šçº¿æ¡†ï¼Œç„¶ååœ¨ main() å‡½æ•°é‡Œè°ƒç”¨ QApplication::setStyle() ä½¿ç”¨æ–°çš„æ ·å¼ã€‚ 123456789101112131415161718192021// æ–‡ä»¶å: NoFocusRectStyle.h#ifndef NOFOCUSRECTSTYLE_H#define NOFOCUSRECTSTYLE_H#include &lt;QProxyStyle&gt;class NoFocusRectStyle : public QProxyStyle&#123;public: NoFocusRectStyle(QStyle *baseStyle) : QProxyStyle(baseStyle) &#123;&#125; void drawPrimitive(PrimitiveElement element, const QStyleOption *option, QPainter *painter, const QWidget *widget = 0) const&#123; if (element == QStyle::PE_FrameFocusRect) &#123; return; &#125; QProxyStyle::drawPrimitive(element, option, painter, widget); &#125;&#125;;#endif // NOFOCUSRECTSTYLE_H 12345678910111213// æ–‡ä»¶å: main.cpp#include &quot;Widget.h&quot;#include &quot;NoFocusRectStyle.h&quot;#include &lt;QApplication&gt;int main(int argc, char *argv[])&#123; QApplication app(argc, argv); NoFocusRectStyle *style = new NoFocusRectStyle(app.style()); app.setStyle(style); // Ownership of the style object is transferred to QApplication Widget w; w.show(); return app.exec();&#125;","tags":["Qt"],"categories":["Qt"]},{"title":"WindbgåŸºæœ¬ä½¿ç”¨æ–¹æ³•","path":"/post/2711697202.html","content":"Windbg æ˜¯ Microsoft å…¬å¸æ¨å‡ºçš„å…è´¹çš„ã€å¸¦ GUI çš„è°ƒè¯•å™¨ï¼Œæ”¯æŒ Source å’Œ Assembly ä¸¤ç§æ¨¡å¼çš„è°ƒè¯•ã€‚ Windbg ä¸ä»…å¯ä»¥è°ƒè¯•åº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥è¿›è¡Œç³»ç»Ÿå†…æ ¸è°ƒè¯•ï¼ŒWindbg æ”¯æŒçš„å¹³å°åŒ…æ‹¬ X86ã€IA64ã€AMD64ã€‚ ä¸€ã€å®‰è£…ä»ä¸‹é¢çš„é“¾æ¥æˆ–å…¶ä»–é“¾æ¥ä¸‹è½½å®‰è£…ï¼šDownload Debugging tools for Windows äºŒã€é…ç½®å¸¸ç”¨çš„é…ç½®åŒ…å«ç¬¦å·æ–‡ä»¶æœç´¢è·¯å¾„ã€å¯æ‰§è¡Œæ–‡ä»¶æœç´¢è·¯å¾„ã€æºç æ–‡ä»¶æœç´¢è·¯å¾„é…ç½®ã€‚ 2.1 ç¬¦å·æ–‡ä»¶æœç´¢è·¯å¾„é…ç½®åœ¨èœå•é¡¹File -&gt; Symbol File Pathä¸­è®¾ç½®ï¼Œå¦‚ï¼š 1D:\\symbol_path;SRV*D:\\symbolslocal*http://msdl.microsoft.com/download/symbols æ„æ€æ˜¯å…ˆä»D:\\symbol_pathä¸­æ‰¾ç¬¦å·æ–‡ä»¶ï¼›å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±å»æœåŠ¡å™¨ä¸­ä¸‹è½½å¹¶ä¿å­˜åˆ°D:\\symbolslocalç›®å½•ä¸­ã€‚ å¯ä»¥ä½¿ç”¨.sympath+ å‘½ä»¤æ¥æ·»åŠ å…¶ä»–ç›®å½•åˆ°æœç´¢è·¯å¾„ä¸­ï¼Œå¦‚.sympath+ D:\\other_symbol_dirã€‚ ç„¶åä½¿ç”¨.reloadæ¥æ ¹æ®æ–°çš„è·¯å¾„é‡æ–°æœç´¢å¹¶åŠ è½½ç¬¦å·æ–‡ä»¶ã€‚ 2.2 å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„åœ¨èœå•é¡¹File -&gt; Image File Pathä¸­è®¾ç½®ï¼Œæ­¤é¡¹æ˜¯åœ¨åŠ è½½ dump æ—¶ï¼Œè®¾ç½®å¯æ‰§è¡Œæ–‡ä»¶ exeã€dll çš„è·¯å¾„çš„ã€‚ 2.3 æºä»£ç ç›®å½•é…ç½®åœ¨èœå•é¡¹File -&gt; Source File Pathä¸­è®¾ç½®æºä»£ç ç›®å½•ã€‚å¦‚æœå½“å‰æŒ‡ä»¤æŒ‡é’ˆåœ¨æºä»£ç èŒƒå›´å†…ï¼Œå°±ä¼šè‡ªåŠ¨è·³å‡ºæºæ–‡ä»¶çª—å£ã€‚æºæ–‡ä»¶çª—å£ä¸­çš„æ“ä½œå’Œ vs ç±»ä¼¼ã€‚å¦‚æœæ²¡æœ‰è·³å‡ºï¼Œå¯ä»¥å•æœºèœå•é¡¹ Open Source File æ‰‹åŠ¨é€‰æ‹©æºæ–‡ä»¶ 2.4 è®¾ç½®å¯åŠ¨äº§ç”Ÿå¯ä»¥é€šè¿‡å¯¹ windbg åŠ å…¥å¯åŠ¨å‚æ•°çš„æ–¹å¼æ¥æŒ‡å®šç¬¦å·æ–‡ä»¶è·¯å¾„å’Œæºç è·¯å¾„ç­‰ç­‰ã€‚ 1start &quot;&quot; &quot;%~dp0/Debuggers_x86/windbg.exe&quot; -Q -y &quot;D:\\symbolslocal*http://msdl.microsoft.com/download/symbols&quot; -srcpath &quot;srv*C:\\CodeCache&quot; ä¸‰ã€å¼€å§‹è°ƒè¯•å¯ä»¥é€šè¿‡èœå•é¡¹File -&gt; Open Executableæ¥åŠ è½½æœ¬åœ°çš„ä¸€ä¸ª exe æ¥è¿›è¡Œè°ƒè¯•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡èœå•é¡¹File -&gt; Attache to a Processæ¥åŠ è½½ä¸€ä¸ªå·²ç»è¿è¡Œçš„ exe æ¥è¿›è¡Œè°ƒè¯•ã€‚ å…·ä½“è°ƒè¯•æŒ‡ä»¤å¯ä»¥å‚è€ƒï¼šHelp -&gt; Contents -&gt; Debugging Tools for Windows -&gt; Debuggers -&gt; Debugger Reference å››ã€å·¥ä½œç©ºé—´Windbg ä¼šä¿å­˜æ¯ä¸ªä½ è°ƒè¯•çš„å·¥ç¨‹çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬è°ƒè¯•é¡¹ç›®çš„å±æ€§ã€å‚æ•°ã€ä¼šè¯çŠ¶æ€ã€è°ƒè¯•å™¨è®¾ç½®ã€åŠå›¾å½¢ç•Œé¢ä¿¡æ¯ï¼Œç±»ä¼¼äº ide çš„é¡¹ç›®æ–‡ä»¶ã€‚ æ¯ä¸ªè°ƒè¯•çš„å·¥ä½œç©ºé—´ä¿¡æ¯é»˜è®¤ä¿å­˜åœ¨HKEY_CURRENT_USER\\Software\\Microsoft\\Windbg\\Workspacesä¸­ï¼Œåœ¨è¿™ä¸ªé”®ä¸‹ä¸€èˆ¬æœ‰ 4 ä¸ªå­é”® Userã€Kernelã€Dumpã€Explicit, ä»–ä»¬åˆ†åˆ«ä¿å­˜ç”¨æˆ·æ€è°ƒè¯•ï¼Œå†…æ ¸æ€è°ƒè¯•ã€è½¬å‚¨æ–‡ä»¶è°ƒè¯•ã€ä»¥åŠæ‰‹åŠ¨ä¿å­˜ï¼ˆSave Workspace Asï¼‰çš„å·¥ä½œç©ºé—´ä¿¡æ¯ã€‚ äº”ã€çª—å£ç•Œé¢ä»‹ç» åç§° çƒ­é”® ç”¨é€” Command Atl+1 è¾“å…¥å‘½ä»¤ã€æ˜¾ç¤ºå‘½ä»¤ç»“æœå’Œè°ƒè¯•ä¿¡æ¯è¾“å‡º Watch Atl+2 è§‚å¯ŸæŒ‡ä»¤å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡å’Œå¯„å­˜å™¨çš„ä¿¡æ¯ Locals Atl+3 è‡ªåŠ¨æ˜¾ç¤ºå½“å‰å‡½æ•°çš„æ‰€æœ‰å±€éƒ¨å˜é‡ Registers Atl+4 è§‚å¯Ÿå’Œä¿®æ”¹å¯„å­˜å™¨çš„å€¼ Memory Atl+5 è§‚å¯Ÿå’Œä¿®æ”¹å†…å­˜æ•°æ® Call Stack Atl+6 æ ˆä¸­è®°å½•çš„å‡½æ•°è°ƒç”¨åºåˆ— Disassembly Atl+7 åæ±‡ç¼– Scratch Pad Atl+8 ç™½æ¿ï¼Œå¯ä»¥ç”¨æ¥åšè°ƒè¯•ç¬”è®°ç­‰ Processes and Threads Atl+9 æ˜¾ç¤ºæ‰€æœ‰è°ƒè¯•ç›®æ ‡çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬è¿›ç¨‹å’Œçº¿ç¨‹ç­‰ Command Browser Ctrl+N æ‰§è¡Œå’Œæµè§ˆå‘½ä»¤ å…­ã€å¸¸ç”¨å‘½ä»¤windbg å‘½ä»¤åˆ†ä¸ºæ ‡å‡†å‘½ä»¤ï¼Œå…ƒå‘½ä»¤å’Œæ‰©å±•å‘½ä»¤ã€‚ä»¥.å¼€å¤´çš„å…ƒå‘½ä»¤æä¾›æ ‡å‡†å‘½ä»¤æ²¡æœ‰æä¾›çš„åŠŸèƒ½ï¼Œä¹Ÿå†…å»ºåœ¨è°ƒè¯•å¼•æ“ä¸­ã€‚ä»¥!å¼€å¤´çš„æ‰©å±•å‘½ä»¤ç”¨äºæ‰©å±•æŸä¸€æ–¹é¢çš„è°ƒè¯•åŠŸèƒ½ï¼Œå®ç°åœ¨åŠ¨æ€åŠ è½½çš„æ‰©å±•æ¨¡å—ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657tabé”® è‡ªåŠ¨å®Œæˆå‘½ä»¤.hh æŸ¥çœ‹æŒ‡å®šå‘½ä»¤çš„å¸®åŠ©æ‰‹å†Œ.reload é‡æ–°åŠ è½½ç¬¦å·æ–‡ä»¶.restart é‡æ–°å¯åŠ¨è°ƒè¯•ç›®æ ‡bp $exentry åœ¨ç¨‹åºå…¥å£ç‚¹è®¾ç½®æ–­ç‚¹ï¼Œ$exentryæ˜¯ä¸€ä¸ªä¼ªå¯„å­˜å™¨bp 0x00401030 åœ¨åœ°å€0x00401030å¤„è®¾ç½®æ–­ç‚¹bp MyTestModule!MyTestFunc åœ¨MyTestModuleæ¨¡å—ä¸­çš„MyTestFuncå‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ï¼Œå‰ææ˜¯è¯¥æ¨¡å—ç¬¦å·å·²ç»åŠ è½½bp MyTestModule!MyTestClass::SetValue åœ¨æ¨¡å—MyTestModuleçš„MyTestClassç±»æˆå‘˜å‡½æ•°SetValueå¤„è®¾ç½®æ–­ç‚¹bp @@C++(MyTestModule!MyTestClass::SetValue) ä¸ä¸Šé¢ä¸€æ ·ï¼Œè¯­æ³•ä¸åŒï¼ŒC++è¯­æ³•ï¼Œä¸Šé¢çš„ä¸ºMASMè¯­æ³•bl æŸ¥çœ‹è®¾ç½®çš„æ–­ç‚¹be æ¿€æ´»æ–­ç‚¹bd ç¦ç”¨æ–­ç‚¹bc åˆ é™¤æŸä¸ªæ–­ç‚¹ba è®¾ç½®è®¿é—®æ–­ç‚¹ba r 1 0044108c åœ¨å†…å­˜0044108cçš„ä½ç½®å¼€å§‹çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„è¯»æ–­ç‚¹ba w4@@C++(&amp;i) ç»™å˜é‡iåœ°å€ä¸‹4ä¸ªå­—èŠ‚çš„å†™æ–­ç‚¹g è¿è¡Œç¨‹åºï¼Œç›¸å½“äºF5gu è¿”å›å‡½æ•°è°ƒç”¨å¤„ï¼Œç›¸å½“äºshift+F11u æŸ¥çœ‹å½“å‰æ­£è¦æ‰§è¡Œçš„ä»£ç k æŸ¥çœ‹å½“å‰è°ƒç”¨å †æ ˆ~*kb æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹è°ƒç”¨å †æ ˆ~ æŸ¥çœ‹è°ƒè¯•è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¿¡æ¯!teb çº¿ç¨‹ç¯å¢ƒå—~. å½“å‰çº¿ç¨‹ä¿¡æ¯~# å¯¼è‡´å½“å‰å¼‚å¸¸æˆ–è°ƒè¯•äº‹ä»¶çš„çº¿ç¨‹ä¿¡æ¯~[Number]s çº¿ç¨‹åˆ‡æ¢a ä¿®æ”¹å½“å‰æŒ‡ä»¤ï¼Œè¾“å…¥ä¿®æ”¹çš„æŒ‡ä»¤æŒ‰Enterç»“æŸs â€“a 00400000 L53000 â€œWrongâ€ ä»¥ASCIIç çš„å½¢å¼ä»00400000å¤„å¼€å§‹å¾€å53000ä¸ªå­—èŠ‚æœç´¢å­—ç¬¦ä¸²â€œWrongâ€db 400000 ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼æ˜¾ç¤ºå†…å­˜åœ°ä½ä¸º400000å¼€å§‹çš„å†…å®¹dd 400000 ä»¥DWORDç±»å‹æŸ¥çœ‹d æŒ‰ä¸Šä¸€æ¬¡çš„då‘½ä»¤çš„æ–¹å¼æ¥æ˜¾ç¤ºï¼Œå¦‚æœä¸å¸¦å‚æ•°ï¼Œåˆ™ä»ä¸Šä¸€æ¬¡æ˜¾ç¤ºç»“æŸçš„åœ°æ–¹ç»§ç»­æ˜¾ç¤º?i æŸ¥çœ‹å±€éƒ¨å˜é‡içš„å€¼ï¼Œä¼šä»¥10è¿›åˆ¶å’Œ16è¿›åˆ¶åŒæ—¶æ˜¾ç¤ºeb 0012ff78 &#x27;a&#x27; &#x27;b&#x27; ä»å†…å­˜åœ°å€0012ff78å¼€å§‹ä¾æ¬¡å†™å…¥åé¢çš„å€¼r ç”¨äºæŸ¥çœ‹æˆ–è€…ä¿®æ”¹å¯„å­˜å™¨æˆ–ä¼ªå¯„å­˜å™¨r $peb $pebæ˜¯ä¸€ä¸ªä¼ªå¯„å­˜å™¨ï¼Œè°ƒè¯•å™¨å°†å®ƒå®šä¹‰ä¸ºå½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç¯å¢ƒå—åœ°å€dt ç”¨äºæŸ¥çœ‹ç»“æ„ä½“å†…å®¹!address 400000 æŸ¥çœ‹æŒ‡å®šå†…å­˜åœ°å€çš„ä¿¡æ¯dv æŸ¥çœ‹å½“å‰ä½œç”¨åŸŸä¸‹å±€éƒ¨å˜é‡çš„ç±»å‹å’Œå€¼.ecxr å½“å‰å¼‚å¸¸çš„ä¸Šä¸‹æ–‡ä¿¡æ¯!analyze -v è¯¦ç»†æ˜¾ç¤ºå½“å‰å¼‚å¸¸ä¿¡æ¯ï¼Œå¸¸ç”¨äºåˆ†ædmpæ–‡ä»¶| æ‰€æœ‰è¿›ç¨‹åˆ—è¡¨|. å½“å‰è¿›ç¨‹ä¿¡æ¯|# å¯¼è‡´å½“å‰å¼‚å¸¸æˆ–è°ƒè¯•äº‹ä»¶çš„è¿›ç¨‹ä¿¡æ¯|[Number]s è¿›ç¨‹åˆ‡æ¢!peb è¿›ç¨‹ç¯å¢ƒå—!locks æŸ¥çœ‹è¿›ç¨‹ä¸­æœ‰äº›é”å¤„äºé”å®šçŠ¶æ€!cs -l æŸ¥çœ‹å¤„äºé”å®šçŠ¶æ€çš„å…³é”®åŒº!handle 000000c0 f æŸ¥çœ‹å¥æŸ„000000c0çš„ä¿¡æ¯ ä¸ƒã€å¸¸ç”¨è°ƒè¯•æ–¹æ³•7.1ã€é™„åŠ è¿›ç¨‹è°ƒè¯•ä½¿ç”¨ File èœå•ä¸­çš„ Attach to a Process é€‰é¡¹æ¥é€‰æ‹©è¦é™„åŠ è°ƒè¯•çš„è¿›ç¨‹. 7.2ã€å¯åŠ¨æ–°è¿›ç¨‹å¹¶è°ƒè¯• ä½¿ç”¨èœå•File-&gt; Open Executableé€‰é¡¹æ¥é€‰æ‹©è¦å¯åŠ¨è°ƒè¯•çš„è¿›ç¨‹ã€‚ å¯åŠ¨ windbg æ—¶å°†å¾…è°ƒè¯•çš„ç¨‹åºçš„æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°ä¼ é€’ç»™ windbgã€‚ æ–°å»ºæ³¨å†Œè¡¨é¡¹ã€‚åœ¨â€œHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Optionsâ€ä¸‹æ–°å»ºä¸€ä¸ªä»¥ç¨‹åºåå‘½åçš„å­é¡¹ï¼Œç„¶ååœ¨è¿™ä¸ªå­é¡¹ä¸­æ–°å»ºä¸€ä¸ªåä¸ºDebuggerçš„REG_SZç±»å‹çš„å€¼ï¼Œå°†å€¼è®¾ç½®ä¸º windbg çš„å…¨è·¯å¾„ï¼Œæ¯”å¦‚ï¼šC:\\Program Files (x86)\\Windows Kits\\8.1\\Debuggers\\x86\\windbg.exeã€‚ è¿™æ ·ï¼Œå†è¿è¡Œå¾…è°ƒè¯•çš„ç¨‹åºæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå…ˆå¯åŠ¨ windbgï¼Œå¹¶æŠŠè¦è°ƒè¯•ç¨‹åºçš„è·¯å¾„ä¼ é€’ç»™ä»–ã€‚ 7.3ã€è°ƒè¯•è½¬å‚¨æ–‡ä»¶ä½¿ç”¨ File èœå•ä¸­çš„ Open Crash Dump é€‰é¡¹æ¥åŠ è½½ dump æ–‡ä»¶ã€‚ 7.4ã€è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨ï¼ˆè¢«è°ƒè¯•ç¨‹åºçš„æœºå™¨ï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆå‘å‡ºè¿œç¨‹è¯·æ±‚çš„æœºå™¨ï¼‰éƒ½åº”è¯¥å®‰è£…ç‰ˆæœ¬ç›¸åŒçš„ windbgï¼Œåº”è¯¥æœ‰ç½‘ç»œè¿æ¥æˆ–è€…ä¸²è¡Œå£è¿æ¥ã€‚ ä»¥ tcp ç«¯å£æ–¹å¼ï¼šä»¥å‘½ä»¤è¡Œçš„æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ä¸­çš„ windbgï¼Œå¦‚ï¼šwindbg.exe -server tcp:port&#x3D;5005ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼å¯åŠ¨å®¢æˆ·ç«¯ä¸­çš„ windbgï¼Œå¦‚ï¼šwindbg.exe -remote tcp:port&#x3D;5005,server&#x3D;192.168.1.180 ä»¥ç®¡é“æ–¹å¼ï¼šä»¥å‘½ä»¤è¡Œçš„æ–¹å¼å¯åŠ¨æœåŠ¡å™¨ä¸­çš„ windbgï¼Œå¦‚ï¼šwindbg -server npipe:pipe&#x3D;advdbg ï¼ˆadbdbg ä¸ºå‘½åç®¡é“åç§°ï¼‰ã€‚åœ¨å®¢æˆ·ç«¯ä¸­ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼å¯åŠ¨ windbgï¼Œå¦‚ï¼šwindbg -remote npipe:server&#x3D;REMOTEHOSTNAME,pipe&#x3D;advdbg ï¼ˆREMOTEHOSTNAME ä¸ºè¿œç¨‹ä¸»æœºåï¼Œdbvdbg ä¸ºè¿œç¨‹ä¸»æœºåˆ›å»ºçš„å‘½åç®¡é“åï¼Œä¹Ÿå¯ä»¥é€‰æ‹© File èœå•ä¸­çš„ Connect to Remote Session,åœ¨å¼¹å‡ºæ¥çš„ç¼–è¾‘æ¡†ä¸­è¾“å…¥è¿œç¨‹å‚æ•° npipe:server&#x3D;REMOTEHOSTNAME,pipe&#x3D;advdbgï¼‰ æˆåŠŸè¿æ¥åï¼Œå‘½ä»¤è¡Œä¿¡æ¯åŒºä¼šæ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š 1...(npipe advdbg) connected at Thu Jul 11 14:22:02 2017 ä¹‹åå¯ä»¥åœ¨å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨çš„ windbg ä¸­æ‰§è¡Œå„ç§è°ƒè¯•å‘½ä»¤ï¼Œæ‰§è¡Œç»“æœä¼šåŒæ—¶æ˜¾ç¤ºåœ¨ä¸¤ä¸ªè°ƒè¯•å™¨ä¸­ã€‚ å…¶å®ƒçš„è¿œç¨‹è°ƒè¯•æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒ:https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/remode-debugging-using-windbg","tags":["Windbg"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"æ·±å…¥ç†è§£C++è™šå‡½æ•°","path":"/post/3162890435.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç» C++è™šå‡½æ•°çš„åº•å±‚å®ç°ï¼Œè™šææ„å‡½æ•°çš„ä½œç”¨ï¼Œè™šå‡½æ•°è¡¨çš„æ•°æ®ç»“æ„åŠå­˜å‚¨æ–¹å¼ï¼Œä»¥åŠ__declspec(novtable)çš„ä½œç”¨ã€‚ ä¸€. è™šå‡½æ•°ä»‹ç»C++ä¸­çš„è™šå‡½æ•°ä¸»è¦æ˜¯ç”¨æ¥å®ç°å¤šæ€ï¼ˆé¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ä¹‹ä¸€ï¼‰çš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°å¤šæ€çš„é”™è¯¯ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142// åŸºç±»//class Base &#123;public: Base() &#123; printf(&quot;Call Base::Base() &quot;); &#125; ~Base() &#123; &#125; void Name() &#123; printf(&quot;Call Base::Name() &quot;); &#125;&#125;;// æ´¾ç”Ÿç±»//class Derive : public Base &#123;public: Derive() &#123; printf(&quot;Call Derive::Derive() &quot;); &#125; ~Derive() &#123; &#125; void Name() &#123; printf(&quot;Call Derive::Name() &quot;); &#125;&#125;;int main()&#123; Base* pBase = new Derive(); pBase-&gt;Name(); delete pBase; return 0;&#125; ç¨‹åºè¾“å‡ºï¼š 123Call Base::Base()Call Derive::Derive()Call Base::Name() è¾“å‡ºå†…å®¹çš„ç¬¬ 3 è¡Œä¸ºï¼šCall Base::Name()ï¼Œå¹¶ä¸æ˜¯æœŸæœ›çš„Call Derive::Name()ã€‚å› ä¸ºvoid Name()å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œæ‰€ä»¥pBase-&gt;Name()è°ƒç”¨çš„æ˜¯åŸºç±»çš„ Name()å‡½æ•°ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„æ´¾ç”Ÿç±» Derive çš„ Name()å‡½æ•°ã€‚ å¦‚æœå°†åŸºç±»ä¸­void Name()æ”¹æˆè™šå‡½æ•°virtual void Name()ï¼Œç¨‹åºè¾“å‡ºå°±ä¼šå’Œæˆ‘ä»¬æœŸæœ›çš„ä¸€æ ·ï¼š 12345678910111213141516// åŸºç±»//class Base &#123;public: Base() &#123; printf(&quot;Call Base::Base() &quot;); &#125; ~Base() &#123; printf(&quot;Call Base::~Base() &quot;); &#125; virtual void Name() &#123; printf(&quot;Call Base::Name() &quot;); &#125;&#125;; äºŒã€ è™šææ„å‡½æ•°virtualä¸ä»…å¯ä»¥ä¿®é¥°æˆå‘˜å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°ææ„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è™šææ„å‡½æ•°ã€‚ ä¸‹é¢çš„ä¾‹å­ä¸­çš„åŸºç±»çš„ææ„å‡½æ•°æ²¡æœ‰ä½¿ç”¨ virtual ä¿®é¥°ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œç¨‹åºï¼Œè§‚å¯Ÿè¿è¡Œç»“æœï¼ˆç±»ä¼¼ä¸Šé¢çš„ç¨‹åºï¼Œåªæ˜¯åœ¨ææ„å‡½æ•°ä¸­å¤šåŠ å…¥äº†è¾“å‡ºæ‰“å°è¯­å¥ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142// åŸºç±»//class Base &#123;public: Base() &#123; printf(&quot;Call Base::Base() &quot;); &#125; ~Base() &#123; printf(&quot;Call Base::~Base() &quot;); &#125; virtual void Name() &#123; printf(&quot;Call Base::Name() &quot;); &#125;&#125;;// æ´¾ç”Ÿç±»//class Derive : public Base &#123;public: Derive() &#123; printf(&quot;Call Derive::Derive() &quot;); &#125; ~Derive() &#123; printf(&quot;Call Derive::~Derive() &quot;); &#125; void Name() &#123; printf(&quot;Call Derive::Name() &quot;); &#125;&#125;;int main()&#123; Base* pBase = new Derive(); pBase-&gt;Name(); delete pBase; return 0;&#125; ç¨‹åºè¾“å‡ºï¼š 1234Call Base::Base()Call Derive::Derive()Call Derive::Name()Call Base::~Base() ä»è¾“å‡ºå†…å®¹çš„ç¬¬ 4 è¡Œå¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œdelete pBaseè¯­å¥åªæœ‰åŸºç±» Base ç±»çš„ææ„å‡½æ•°è¢«è°ƒç”¨äº†ï¼Œè€Œæ´¾ç”Ÿç±» Derive çš„ææ„å‡½æ•°å´æ²¡æœ‰è¢«è°ƒç”¨ã€‚å¦‚æœæ­¤æ—¶æ´¾ç”Ÿç±» Derive ä¸­æœ‰éœ€è¦åœ¨ææ„å‡½æ•°æ‰§è¡Œçš„ä»£ç ï¼ˆå¦‚å†…å­˜é‡Šæ”¾ï¼Œå¥æŸ„å…³é—­ç­‰ï¼‰ï¼Œè¿™äº›ä»£ç å°†ä¸ä¼šæ‰§è¡Œï¼Œæœ‰å¯èƒ½å°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€å¥æŸ„æ³„æ¼ã€é€»è¾‘é”™è¯¯ç­‰é—®é¢˜ã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ï¼šä½¿ç”¨ virtual ä¿®é¥°åŸºç±»çš„ææ„å‡½æ•°ï¼Œå³è™šææ„å‡½æ•°ã€‚ 12345678910111213141516// åŸºç±»//class Base &#123;public: Base() &#123; printf(&quot;Call Base::Base() &quot;); &#125; virtual ~Base() &#123; printf(&quot;Call Base::~Base() &quot;); &#125; virtual void Name() &#123; printf(&quot;Call Base::Name() &quot;); &#125;&#125;; æ­¤æ—¶ç¨‹åºè¾“å‡ºä¸ºï¼š 12345Call Base::Base()Call Derive::Derive()Call Derive::Name()Call Derive::~Derive()Call Base::~Base() è°ƒç”¨delete pBaseä¹‹åï¼Œå…ˆæ‰§è¡Œäº†æ´¾ç”Ÿç±» Derive çš„ææ„å‡½æ•°ï¼Œç„¶åæ‰§è¡ŒåŸºç±» Base çš„ææ„å‡½æ•°ã€‚ åœ¨ã€ŠC++API è®¾è®¡ã€‹ä¸€ä¹¦ä¸­æœ‰æ˜ç¡®çš„è¯´åˆ°ï¼šâ€œå¦‚æœå¸Œæœ›ä¸€ä¸ªç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°†å®ƒçš„ææ„å‡½æ•°ä½¿ç”¨ virtual ä¿®é¥°ï¼›åè¿‡æ¥å¯ä»¥ç†è§£ä¸ºï¼Œå¦‚æœä¸€ä¸ªç±»çš„ææ„å‡½æ•°ä¸æ˜¯è™šçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»æ˜¯è¢«è®¾è®¡ä¸ºä¸å¯ç»§æ‰¿çš„ã€‚â€ ä¸‰ã€è™šå‡½æ•°çš„å®ç°åŸç†3.1 å®ç°åŸç†C++çš„è™šå‡½æ•°æ˜¯ä½¿ç”¨è™šå‡½æ•°è¡¨ï¼ˆå³æŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆï¼‰æ¥å®ç°çš„ã€‚ åªè¦åœ¨ç±»ä¸­å£°æ˜äº†è™šå‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¼šåœ¨ç±»çš„å¯¹è±¡ä¸­è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œä½†ä¸€ä¸ªå¯¹è±¡æœ€å¤šåªæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼Œä¸ç®¡è¿™ä¸ªç±»å£°æ˜äº†å¤šå°‘ä¸ªè™šå‡½æ•°ã€‚è™šå‡½æ•°è¡¨æ˜¯é’ˆå¯¹äºç±»çš„å¯¹è±¡çš„ã€‚ 3.2 è™šå‡½æ•°è¡¨ï¼ˆæŒ‡é’ˆï¼‰å­˜å‚¨ä½ç½®ä¸åŒçš„ç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆçš„è™šå‡½æ•°è¡¨æŒ‡é’ˆå­˜æ”¾çš„ä½ç½®ä¸åŒï¼Œæœ‰çš„å­˜æ”¾åœ¨ç±»å¯¹è±¡æ‰€å å†…å­˜çš„èµ·å§‹ä½ç½®ï¼Œæœ‰çš„å­˜æ”¾åœ¨ç±»å¯¹è±¡æ‰€å å†…å­˜çš„æœ«å°¾ã€‚ å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç æ¥åˆ¤æ–­ï¼š 1234567891011121314151617// è¿”å›å€¼ï¼š ture - è™šå‡½æ•°æŒ‡é’ˆå­˜æ”¾åœ¨å¯¹è±¡å†…å­˜èµ·å§‹ä½ç½®// false - è™šå‡½æ•°æŒ‡é’ˆå­˜æ”¾åœ¨å¯¹è±¡å†…å­˜æœ«å°¾ä½ç½®//bool VirtualTableAtFirst() &#123; class _C &#123; public: char _i; virtual void _f() &#123; &#125; &#125;; _C c; char * p1 = reinterpret_cast&lt;char*&gt;(&amp;c); char * p2 = reinterpret_cast&lt;char*&gt;(&amp;c._i); return p1 != p2;&#125; é€šè¿‡ MSVC2015 ç¼–è¯‘è¿è¡Œï¼Œè¿”å›true, è¯´æ˜ MSVC ç¼–è¯‘å™¨æ˜¯å°†è™šå‡½æ•°è¡¨æŒ‡é’ˆæ”¾ç½®åœ¨ç±»å¯¹è±¡å†…å­˜çš„èµ·å§‹ä½ç½®å¤„ã€‚ 3.3 è™šå‡½æ•°è¡¨å­˜å‚¨æ–¹å¼æ—¢ç„¶çŸ¥é“äº† C++æ˜¯ä½¿ç”¨è™šå‡½æ•°è¡¨çš„å½¢å¼æ¥å®ç°è™šå‡½æ•°çš„ï¼Œé‚£ä¸ªè™šå‡½æ•°è¡¨ä¸­çš„æ•°æ®æ˜¯ä»¥ä½•ç§å½¢å¼æ¥å­˜å‚¨çš„äº†ï¼Ÿ ç°åœ¨æˆ‘ä»¬æ ¹æ®ç±»çš„ç»§æ‰¿æ–¹å¼çš„ä¸åŒæ¥åˆ†åˆ«è¯´æ˜ã€‚ 3.3.1 å•ç»§æ‰¿æ— é‡è½½ç±»ç»“æ„å¦‚å›¾ï¼ŒDerive ç»§æ‰¿äº Baseï¼Œä½† Derive æ²¡æœ‰é‡è½½ Base ç±»ä¸­çš„ä»»ä½•å‡½æ•°ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå‡½æ•° f(), g(), h(), f1(), g1(), h1() å‡ä¸ºè™šå‡½æ•°ï¼Œè¿™ä¸ªåœ¨å›¾ä¸Šæ²¡æœ‰æ˜ç¡®çš„å†™å‡ºæ¥ï¼Œåé¢çš„å›¾ä¹Ÿæ˜¯ä¸€æ ·ã€‚ è¿™æ—¶Base b; å¯¹è±¡ b çš„è™šå‡½æ•°è¡¨ä¸ºï¼š Derive d; å¯¹è±¡ d çš„è™šå‡½æ•°è¡¨ä¸ºï¼š 3.3.2 å•ç»§æ‰¿æœ‰é‡è½½Derive é‡è½½ Base ç±»ä¸­çš„ f()å‡½æ•°ï¼š è¿™æ—¶Base b; å¯¹è±¡ b çš„è™šå‡½æ•°è¡¨ä¸å˜ï¼Œæ— è®ºç»§æ‰¿äºå®ƒæ´¾ç”Ÿç±»å¦‚ä½•é‡è½½ï¼Œéƒ½ä¸ä¼šå½±å“åŸºç±»çš„è™šå‡½æ•°ï¼š Derive d; å¯¹è±¡ d çš„è™šå‡½æ•°è¡¨ä¸ºï¼š æ´¾ç”Ÿç±»ä¸­é‡è½½åŸºç±»çš„ f()å‡½æ•°æŒ‡é’ˆæ›¿æ¢äº†åŸæ¥åŸºç±»ä¸­è™šå‡½æ•° Base::f()çš„æŒ‡é’ˆï¼› æ´¾ç”Ÿç±»ä¸­å…¶ä»–çš„è™šå‡½æ•°å­˜æ”¾åœ¨åŸºç±»è™šå‡½æ•°ä¹‹åã€‚ 3.3.3 å¤šç»§æ‰¿æ— é‡è½½ æ­¤æ—¶ï¼ŒDerive d; å¯¹è±¡ d çš„è™šå‡½æ•°è¡¨ä¸ºï¼š æ´¾ç”Ÿç±»è‡ªå·±çš„è™šå‡½æ•°å­˜æ”¾åœ¨ç¬¬ä¸€ä¸ªåŸºç±»çš„è™šå‡½æ•°è¡¨çš„æœ€åé¢ã€‚ 3.3.4 å¤šç»§æ‰¿æœ‰é‡è½½ æ­¤æ—¶ï¼ŒDerive d; å¯¹è±¡ d çš„è™šå‡½æ•°è¡¨ä¸ºï¼š å››ã€è™šå‡½æ•°è¡¨çš„åº”ç”¨æˆ‘ä»¬çŸ¥é“åœ¨ C++ä¸­è¦è°ƒç”¨ç±»çš„ç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‹å‘˜ï¼ˆfriendï¼‰çš„æ–¹å¼ã€‚ä½†å…¶å®å¦‚æœæˆ‘ä»¬çŸ¥é“ç±»çš„å®šä¹‰ï¼Œå®Œå…¨å¯ä»¥æ ¹æ®è¯¥ç±»å¯¹è±¡çš„å†…å­˜å¸ƒå±€æ¥ç›´æ¥è°ƒç”¨å®ƒçš„ç§æœ‰å‡½æ•°ã€‚ ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨è™šå‡½æ•°è¡¨çš„æ–¹å¼æ¥è°ƒç”¨è¯¥ç±»çš„ç§æœ‰è™šå‡½æ•°ã€‚ ç°æœ‰å¦‚ä¸‹Testç±»ï¼Œæä¾›äº†ä¸€ä¸ªç§æœ‰è™šå‡½æ•°virtual void Func()ï¼š 123456789101112131415class Test &#123;public: Test() &#123; &#125; virtual~ Test() &#123; &#125;private: virtual void Func() &#123; printf(&quot;Private Function &quot;); &#125;&#125;; ç°åœ¨æˆ‘ä»¬ä½¿ç”¨è™šå‡½æ•°è¡¨æ¥è°ƒç”¨Funcæˆå‘˜å‡½æ•°ï¼š 123456789101112131415typedef void(*PFN_Func)();int main()&#123; Test t; unsigned long **VirtualTable = (unsigned long **)(&amp;t); unsigned long FuncAddr = VirtualTable[0][1]; PFN_Func pfnFunc = (PFN_Func)FuncAddr; if (pfnFunc) &#123; pfnFunc(); &#125; return 0;&#125; æˆ‘ä»¬çŸ¥é“è™šå‡½æ•°è¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚å› ä¸ºç¤ºä¾‹ä¸­çš„Testç±»æ²¡æœ‰ç»§æ‰¿äºå…¶ä»–ç±»ï¼Œæ‰€ä»¥ç¬¬ä¸€ç»´åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼›åˆå› Testç±»æœ‰ 2 ä¸ªè™šå‡½æ•°ï¼Œæ•…ç¬¬äºŒç»´æœ‰ 2 ä¸ªå…ƒç´ ï¼Œä¸”Funcæ’åœ¨ç¬¬äºŒä¸ªï¼Œæ‰€ä»¥ç”¨VirtualTable[0][1]æ¥å–Funcå‡½æ•°åœ°å€ã€‚ å› ä¸ºè¯¥ç¤ºä¾‹è¿è¡Œåœ¨ MSVC ç¼–è¯‘å™¨ç¯å¢ƒï¼Œæ‰€ä»¥é»˜è®¤è®¤ä¸ºè™šå‡½æ•°è¡¨ä½äºç±»å¯¹è±¡å†…å­˜å¸ƒå±€çš„èµ·å§‹ä½ç½®ï¼Œæ•…ç›´æ¥ä½¿ç”¨äº†unsigned long **VirtualTable = (unsigned long **)(&amp;t);ã€‚ä¸¥è°¨çš„åšæ³•åº”è¯¥æ˜¯å…ˆåˆ¤æ–­è™šå‡½æ•°è¡¨æ˜¯å¦ä½äºå¯¹è±¡çš„å†…å­˜å¸ƒå±€èµ·å§‹ä½ç½®ã€‚ äº”ã€__declspec(novtable)Mircrosoft C++ä¸­æä¾›äº†__declspec(novtable)æ¥ä¿®é¥°ç±»ï¼Œ__declspec(novtable)ä¼šé˜»æ­¢ç¼–è¯‘å™¨ä¸ºè¯¥ç±»ç”Ÿæˆè™šå‡½æ•°è¡¨ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–è¯‘ç”Ÿæˆä»£ç çš„å¤§å°ï¼ŒåŒæ—¶ä¹Ÿçº¦æŸè¯¥ç±»æ— æ³•è¢«å®ä¾‹åŒ–ã€‚ 1234567891011121314151617181920// novtable.cpp#include &lt;stdio.h&gt;struct __declspec(novtable) X &#123; virtual void mf();&#125;;struct Y : public X &#123; void mf() &#123; printf_s(&quot;In Y &quot;); &#125;&#125;;int main() &#123; // X *pX = new X(); // pX-&gt;mf(); // å¯¼è‡´è¿è¡Œæ—¶è®¿é—®å†²çª Y *pY = new Y(); pY-&gt;mf();&#125; æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["C++","è™šå‡½æ•°"],"categories":["C++è¯­è¨€"]},{"title":"ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œæ‰¹å¤„ç†è„šæœ¬","path":"/post/3405299964.html","content":"åŸºæœ¬åŸç†ï¼š æ ¹æ® ç³»ç»Ÿè‡ªå¸¦çš„cacls.exe æ˜¯å¦èƒ½å¤Ÿè®¿é—®â€%SystemDrive%\\System Volume Informationâ€æ–‡ä»¶ï¼Œæ¥åˆ¤æ–­å½“å‰æ‰¹å¤„ç†è¿›ç¨‹æ˜¯å¦å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ åˆ›å»º vbs è„šæœ¬åˆ°ä¸´æ—¶ç›®å½•ï¼Œç„¶åä½¿ç”¨è¯¥è„šæœ¬ææƒæ‰§è¡Œå½“å‰ bat æ–‡ä»¶ã€‚ ä¸‹é¢æ˜¯æ‰¹å¤„ç†æ¨¡æ¿ï¼Œåœ¨æœ€åè¿½åŠ éœ€è¦æ‰§è¡Œçš„è„šæœ¬å³å¯ã€‚ 123456789101112131415@echo offcd /d &quot;%~dp0&quot;cacls.exe &quot;%SystemDrive%\\System Volume Information&quot; &gt;nul 2&gt;nulif %errorlevel%==0 goto Adminif exist &quot;%temp%\\getadmin.vbs&quot; del /f /q &quot;%temp%\\getadmin.vbs&quot;echo Set RequestUAC = CreateObject^(&quot;Shell.Application&quot;^)&gt;&quot;%temp%\\getadmin.vbs&quot;echo RequestUAC.ShellExecute &quot;%~s0&quot;,&quot;&quot;,&quot;&quot;,&quot;runas&quot;,1 &gt;&gt;&quot;%temp%\\getadmin.vbs&quot;echo WScript.Quit &gt;&gt;&quot;%temp%\\getadmin.vbs&quot;&quot;%temp%\\getadmin.vbs&quot; /fif exist &quot;%temp%\\getadmin.vbs&quot; del /f /q &quot;%temp%\\getadmin.vbs&quot;exit:Adminrem ---------- Here is the script to be run ------------","tags":["æ‰¹å¤„ç†","æƒé™"],"categories":["Windowsæ‰¹å¤„ç†"]},{"title":"é«˜é€Ÿæ–‡ä»¶ä¸‹è½½å™¨çš„å®ç°","path":"/post/3157704992.html","content":"æˆ‘ä»¬ä¸‹è½½æ–‡ä»¶æ—¶é€šå¸¸ä¼šä½¿ç”¨æµè§ˆå™¨æˆ–è€…è¿…é›·è¿™æ ·çš„ä¸‹è½½å·¥å…·ï¼Œè¿™äº›å·¥å…·å¤§å¤šå…·æœ‰é«˜é€Ÿä¸‹è½½ï¼ˆä¸‹è½½é€Ÿåº¦å¿«ï¼‰ã€æ–­ç‚¹ç»­ä¼ ï¼ˆå¯ä»¥æš‚åœä¹‹åç»§ç»­ä¸‹è½½ï¼‰ç­‰ç‰¹æ€§ã€‚ ç°åœ¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„åº”ç”¨è½¯ä»¶ä¸­ä¹Ÿéœ€è¦æ”¯æŒè¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾è®¡å’Œå®ç°äº†ï¼Ÿæœ¬æ–‡ä¸»è¦å›´ç»•è¿™ä¸€é—®é¢˜è¿›è¡Œè®ºè¿°ï¼Œå¹¶åœ¨æ–‡ç« æœ€ååˆ†äº«äº†ä½œè€…è‡ªå·±å¼€å‘çš„é«˜é€Ÿæ–‡ä»¶ä¸‹è½½åº“ã€‚ ä¸€ä¸ªå®Œå–„çš„æ–‡ä»¶ä¸‹è½½åº“éœ€è¦å…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š å¤šçº¿ç¨‹åˆ†ç‰‡ä¸‹è½½ æ–­ç‚¹ç»­ä¼  ç£ç›˜ç¼“å­˜ æœ€é«˜ä¸‹è½½é€Ÿç‡é™åˆ¶åŠå®æ—¶ä¸‹è½½é€Ÿç‡åé¦ˆï¼ˆå¯é€‰ï¼‰ å¤šåè®®æ”¯æŒï¼Œè·¨å¹³å°ï¼ˆå¯é€‰ï¼‰ 1. å¤šçº¿ç¨‹åˆ†ç‰‡ä¸‹è½½Chrome æµè§ˆå™¨å’Œè¿…é›·èƒ½å®ç°é«˜é€Ÿä¸‹è½½çš„æ ¸å¿ƒå°±æ˜¯å¤šçº¿ç¨‹åˆ†ç‰‡ä¸‹è½½ï¼ˆè¿™é‡Œå¿½ç•¥è¿…é›·çš„ç¦»çº¿åŠ é€Ÿç­‰æŠ€æœ¯ï¼‰ï¼Œä»¥ HTTP åè®®ä¸ºä¾‹ï¼ŒHTTP åè®®æ”¯æŒåœ¨è¯·æ±‚å¤´ä¸­æŒ‡æ˜éœ€è¦è¯·æ±‚æ•°æ®çš„èµ·å§‹å’Œç»“æŸä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œä¸åŒçš„ HTTP è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚åˆ†åˆ«è¯·æ±‚åŒä¸€æ–‡ä»¶çš„ä¸åŒä½ç½®ï¼Œæˆ‘ä»¬å°†æ¯ä¸ª HTTP è¯·æ±‚çš„å†…å®¹ç§°ä¸ºâ€œç‰‡â€ï¼Œåœ¨æ–‡ä»¶çš„æ‰€æœ‰ç‰‡ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†è¿›è¡Œç‰‡çš„åˆå¹¶ã€‚ libcurl ä¸­å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŒ‡å®šè¯·æ±‚æ–‡ä»¶çš„æŸä¸€åŒºåŸŸï¼š 1curl_easy_setopt(curl_, CURLOPT_RANGE, &quot;1024-2048&quot;); å¦‚ä½•ç¡®å®šåˆ†ç‰‡æ•°é‡ä»¥åŠæ¯ç‰‡å¤§å°ï¼Ÿæ–‡ä»¶åˆ†ç‰‡æœ‰ 2 ç§ç­–ç•¥ï¼š åˆ†ç‰‡æ•°é‡å›ºå®šé™¤æœ€åä¸€ç‰‡å¤–ï¼Œæ¯ç‰‡çš„Size &#x3D; æ–‡ä»¶æ€»Size &#x2F; åˆ†ç‰‡Num åˆ†ç‰‡å°ºå¯¸å›ºå®šåˆ†ç‰‡Num &#x3D; æ–‡ä»¶æ€»Size &#x2F; æ¯ç‰‡çš„Sizeï¼Œå¦‚æœä¸èƒ½æ•´é™¤ï¼Œè¿˜éœ€è¦æ–°å»ºä¸€ä¸ªåˆ†ç‰‡ï¼Œå°†ä½™æ•°æ”¾åˆ°è¯¥åˆ†ç‰‡ä¸­ æ— è®ºé‡‡ç”¨å“ªä¸€ç§åˆ†ç‰‡ç­–ç•¥ï¼Œåœ¨ç¡®å®šåˆ†ç‰‡ Num å’Œæ¯ç‰‡ Size ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å…ˆå‘æ–‡ä»¶æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªè¯·æ±‚æ¥è·å–åŸå§‹æ–‡ä»¶æ€» Sizeã€‚ 2. æ–­ç‚¹ç»­ä¼ è¯•æƒ³æˆ‘ä»¬æ­£åœ¨ä¸‹è½½ä¸€ä¸ª 4G å¤§å°çš„æ–‡ä»¶ï¼Œä¸‹è½½åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå¿½ç„¶å› ä¸ºæŸäº›åŸå› éœ€è¦ä¸­æ­¢ä¸‹è½½ï¼Œç­‰å¯ä»¥å†æ¬¡ä¸‹è½½çš„æ—¶å€™ï¼Œå´ä¸èƒ½ç»§ç»­ä¸Šæ¬¡çš„ä¸‹è½½è¿›åº¦è¿›è¡Œä¸‹è½½ï¼Œé‚£å²‚ä¸æ˜¯è®©äººå¾ˆæŠ“ç‹‚ã€‚æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å°±æ˜¯æ¥è§£å†³è¿™ç§é—®é¢˜çš„ï¼Œè™½ç„¶ç›®å‰å¸‚åœºä¸Šçš„ä¸‹è½½å™¨éƒ½æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å‘ä¸‹è½½å™¨çš„è¯ï¼Œè¿˜æ˜¯ä¸å¾—ä¸è‡ªå·±æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çš„ã€‚ æ–­ç‚¹ç»­ä¼ åŸç†ä¸»è¦æ˜¯å°†å·²ä¸‹è½½çš„æ•°æ®ä¿¡æ¯ï¼ˆåç§»ã€å¤§å°ç­‰ï¼‰è®°å½•åˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºç´¢å¼•æ–‡ä»¶ï¼‰ï¼Œä¸‹æ¬¡ä¸‹è½½å‰è¯»å–è¯¥æ–‡ä»¶ä¸­å·²ä¸‹è½½ä¿¡æ¯ï¼Œè·³è¿‡å·²ä¸‹è½½çš„å†…å®¹ï¼Œç›´æ¥ä¸‹è½½æœªä¸‹è½½çš„æ•°æ®ã€‚ æ–­ç‚¹ç»­ä¼ ä¸€èˆ¬éƒ½ä¼šå’Œå¤šçº¿ç¨‹åˆ†ç‰‡ä¸‹è½½ç»“åˆä½¿ç”¨ã€‚ 3. ç£ç›˜ç¼“å­˜æ–‡ä»¶ä¸‹è½½ä¸­æ¶‰åŠçš„ç£ç›˜ç¼“å­˜éƒ½æ˜¯ç£ç›˜çš„å†™ç¼“å­˜ï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…é¢‘ç¹çš„å¯¹ç£ç›˜è¿›è¡Œå†™æ“ä½œï¼Œé™ä½ç£ç›˜ IO çš„æ•ˆç‡ã€‚ åŸç†ï¼šå°†ç½‘ç»œä¸‹è½½æ•°æ®å­˜å…¥é¢„å…ˆåˆ†é…å¥½çš„å†…å­˜ç¼“å†²åŒºï¼Œå¾…å†…å­˜ç¼“å†²åŒºæ»¡ä¹‹åï¼Œå†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜ã€‚ å…³äºå†…å­˜ç¼“å†²åŒºï¼Œå»ºè®®é‡‡ç”¨åŒç¼“å†²æœºåˆ¶ï¼Œå› ä¸ºç£ç›˜å†™å…¥æ“ä½œæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„æ“ä½œï¼Œåœ¨å°†ç¼“å†²åŒºå†™å…¥ç£ç›˜æ—¶ï¼Œè¯¥ç¼“å†²åŒºæ˜¯ç¦æ­¢å†™å…¥çš„ï¼Œå› è€Œæ­¤æ—¶ç½‘ç»œä¸‹è½½çš„æ•°æ®å†™å…¥ç¼“å†²åŒºå°†è¢«é˜»å¡ï¼Œä»è€Œå½±å“ä¸‹è½½é€Ÿç‡ã€‚ 4. é™é€ŸåŠå®æ—¶é€Ÿç‡æœ€é«˜ä¸‹è½½é€Ÿç‡é™åˆ¶æœ‰åŠ©äºå‡å°‘ç”¨æˆ·ç”µè„‘å¸¦å®½å ç”¨ï¼Œè€Œå®æ—¶ä¸‹è½½é€Ÿç‡åé¦ˆå¯ä»¥è®©ç”¨æˆ·çœ‹åˆ°å®æ—¶çš„ä¸‹è½½é€Ÿåº¦ã€‚ å› ä¸ºé‡‡ç”¨çš„æ˜¯å¤šçº¿ç¨‹ä¸‹è½½ï¼Œå‡å¦‚æœ€é«˜ä¸‹è½½é€Ÿç‡é™åˆ¶ä¸º Nï¼Œåˆ™æ¯ä¸ªçº¿ç¨‹çš„æœ€å¤§ä¸‹è½½é€Ÿç‡ä¸º: N / çº¿ç¨‹Numï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°å°‘äºåˆå§‹çº¿ç¨‹æ•°æ—¶ï¼ˆå¦‚æœ‰çš„çº¿ç¨‹å·²ç»ä¸‹è½½å®Œäº†ï¼‰ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ¯ä¸ªçº¿ç¨‹çš„æœ€å¤§ä¸‹è½½é€Ÿç‡ï¼Œå¦åˆ™æ€»ä¸‹è½½é€Ÿç‡å°†ä¼šä¸‹è½½ï¼Œæ— æ³•è¾¾åˆ°æœ€é«˜ä¸‹è½½é€Ÿç‡ã€‚ zoeä»‹ç»zoe æ˜¯æˆ‘å¼€å‘çš„ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½åº“ï¼Œæ”¯æŒå¦‚ä¸Šæ‰€æœ‰ç‰¹æ€§çš„å¼€æºåº“ï¼Œé‡‡ç”¨ C++å¼€å‘ã€‚è¯¥åº“å·²ç»åœ¨å¤šä¸ªäº§å“ä¸­ä½¿ç”¨ï¼Œå…¶ç¨³å®šæ€§å¾—åˆ°äº†éªŒè¯ã€‚ è¯¥åº“åŸåä¸ºteemoï¼Œteemoä¸€è¯æ¥æºäºè‹±é›„è”ç›Ÿæ¸¸æˆä¸­çš„è¿…æ·æ–¥å€™ï¼Œç”±äºè¯¥åº“è¢«ç°äº§éæ³•ä½¿ç”¨ï¼Œå¯¼è‡´ä»£ç è¢«æ€æ¯’è½¯ä»¶åŠ å…¥ç‰¹å¾åº“ï¼Œæˆ‘é—­æºäº†åŸåº“ï¼Œåœ¨ä¿®æ”¹ä»£ç åé‡æ–°å¼€æºã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","categories":["Power By Me"]},{"title":"Windowså¹³å°ç”ŸæˆDumpæ–‡ä»¶","path":"/post/2648186181.html","content":"è½¬å‚¨æ–‡ä»¶ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ dump æ–‡ä»¶ï¼Œå¯ä»¥æŠŠè½¬å‚¨æ–‡ä»¶çœ‹æˆè½¯ä»¶çš„æŸä¸ªæ—¶åˆ»çš„ä¸€ä¸ªå¿«ç…§ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨è½¯ä»¶å‡ºç°é—®é¢˜æ—¶æ‰‹åŠ¨ç”Ÿæˆæˆ–è€…ç¨‹åºè‡ªåŠ¨ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ã€‚ ä¸€ã€å·¥å…·ç¯‡ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ç§å€ŸåŠ©ç¬¬ä¸‰æ–¹å·¥å…·ç”Ÿæˆè½¬å‚¨æ–‡ä»¶çš„æ–¹æ³•ã€‚ 1.1 ä»»åŠ¡ç®¡ç†å™¨ä»»åŠ¡ç®¡ç†å™¨å¯ä»¥è¯´æ˜¯æœ€æ˜“è·å–çš„ç³»ç»Ÿå·¥å…·ï¼ŒåŒæ—¶å®ƒå…·æœ‰ç”Ÿæˆè½¬å‚¨æ–‡ä»¶çš„åŠŸèƒ½ã€‚ä½†è¦æ³¨æ„çš„æ˜¯åœ¨ 64 ä½æ“ä½œç³»ç»Ÿä¸Šé¢ï¼Œé»˜è®¤å¯åŠ¨çš„æ˜¯ 64 ä½çš„ä»»åŠ¡ç®¡ç†å™¨ã€‚ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨ç”Ÿæˆè½¬å‚¨æ–‡ä»¶éœ€è¦éµå¾ªä¸€ä¸ªåŸåˆ™ï¼šç”¨ 32 ä½ä»»åŠ¡ç®¡ç†å™¨ç»™ 32 ä½è¿›ç¨‹ï¼ˆæ— è®ºè¯¥è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ 32 ä½è¿˜æ˜¯ 64 ä½ç³»ç»Ÿä¸Šé¢ï¼‰ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ï¼Œç”¨ 64 ä½ä»»åŠ¡ç®¡ç†å™¨ç»™ 64 ä½è¿›ç¨‹ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ã€‚ åœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œ32 ä½çš„ä»»åŠ¡ç®¡ç†å™¨ä½äºC:\\Windows\\SysWOW64\\taskmgr.exeã€‚ ç”Ÿæˆæ–¹æ³•ï¼šå³é”®è¿›ç¨‹ â€“&gt; åˆ›å»ºè½¬å‚¨æ–‡ä»¶â€“&gt;å¼¹å‡ºå¯¹è¯æ¡†æç¤ºç”ŸæˆæˆåŠŸï¼Œä»¥åŠ dmp æ–‡ä»¶ä½ç½®ã€‚ ç±»ä¼¼çš„å·¥å…·è¿˜æœ‰ï¼šProcess Explorerï¼ŒPCHunter ç­‰ã€‚ 1.2 æ³¨å†Œè¡¨å¯ä»¥é€šè¿‡åœ¨æ³¨å†Œè¡¨ä¸­è¿›è¡Œé…ç½®ï¼Œè®©æ“ä½œç³»ç»Ÿåœ¨ç¨‹åºå´©æºƒæ—¶è‡ªåŠ¨ç”Ÿæˆ dmp æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°æŒ‡å®šä½ç½®ã€‚åœ¨æ³¨å†Œè¡¨é¡¹ HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps ä¸‹é¢æ ¹æ®è¿›ç¨‹åï¼ˆå«.exeï¼‰æ–°å»ºå­é¡¹ï¼Œå¹¶é…ç½®å¦‚ä¸‹å€¼ï¼šåç§°ï¼šDumpCountï¼Œç±»å‹ï¼šREG_DWORDï¼Œæœ€å¤§ä¿ç•™ Dump ä¸ªæ•°ï¼Œé»˜è®¤ä¸º 10.åç§°ï¼šDumpTypeï¼Œç±»å‹ï¼šREG_DWORDï¼ŒDump ç±»å‹(1-Mini dump, 2-Full dump)ï¼Œé»˜è®¤ä¸º 1.åç§°ï¼šDumpFolderï¼Œç±»å‹ï¼šREG_EXPAND_SZï¼ŒDump æ–‡ä»¶ä¿å­˜çš„ä½ç½®ã€‚ 1.3 Windbgç”Ÿæˆæ–¹æ³•ï¼šFile èœå•â€“&gt;Attach to Processâ€“&gt;è¾“å…¥å‘½ä»¤.dump /ma /u d:\\test.dmpæç¤ºæˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨ D ç›˜çœ‹åˆ°ç”Ÿæˆ dmp æ–‡ä»¶åˆ° test_0bf0_2017-08-13_23-46-37-244_11cc.dmp æ–‡ä»¶ã€‚ 0bf0_2017-08-13_23-46-37-244_11cc æ˜¯&#x2F;u å‚æ•°é™„åŠ ä¸Šå»çš„ï¼Œæ„æ€æ˜¯ 2017 å¹´ 08 æœˆ 13 æ—¥ 23 æ—¶ 46 åˆ† 37 ç§’ 244 æ¯«ç§’ï¼Œè¿›ç¨‹ PID ä½ 11ccã€‚ .dump å‘½ä»¤å‚æ•°æ¯”è¾ƒå¤šï¼Œå¸¸ç”¨çš„ç»„åˆå°±æ˜¯/maï¼Œ&#x2F;m è¡¨ç¤ºç”Ÿæˆ minidumpï¼Œ&#x2F;a è¡¨ç¤º dmp åŒ…å«æ‰€æœ‰ä¿¡æ¯ï¼Œ&#x2F;u å‚æ•°å°±æ˜¯ä¸Šé¢è¯´çš„é™„åŠ æ—¶é—´å’Œ PID ä¿¡æ¯åˆ°æ–‡ä»¶åã€‚ 1.4 Windbg -IWindbg -I å¯ä»¥å°† Windbg è®¾ç½®ä¸ºåŠæ—¶è°ƒè¯•å™¨ï¼ˆå¼€å¯äº† UAC çš„ç³»ç»Ÿä¸Šé¢ï¼Œéœ€è¦ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ JIT è°ƒè¯•å™¨ã€‚è®¾ç½®æˆåŠŸä¹‹åï¼Œå¦‚é‡åˆ°ç¨‹åºå´©æºƒï¼ŒWindbg ä¼šè‡ªåŠ¨è¿è¡Œå¹¶é™„åŠ åˆ°å´©æºƒè¿›ç¨‹ã€‚ è®¾ç½®æˆåŠŸä¹‹åä¼šå¼¹å‡ºå¯¹è¯æ¡†æç¤ºè®¾ç½®æˆåŠŸã€‚å¦‚æœä¸æƒ³å¼¹å‡ºå¯¹è¯æ¡†ï¼Œå¯ä»¥åŠ ä¸Š Sï¼ˆslient é¦–å­—æ¯ï¼‰Windbg -IS. ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨é¡¹ AeDebug æ¥å®ç°å’Œ windbg -I åŒæ ·çš„åŠŸèƒ½ã€‚æ ¹æ® windbg ä½æ•°ï¼ˆ32&#x2F;64ï¼‰å’Œç³»ç»Ÿçš„ä½æ•°ï¼ˆ32&#x2F;64ï¼‰çš„ä¸åŒï¼Œä¿®æ”¹çš„æ³¨å†Œè¡¨é¡¹çš„ä½ç½®ä¹Ÿä¸åŒï¼š 32 ä½ windbgâ€“32 ä½ç³»ç»Ÿï¼šHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug 32 ä½ windbgâ€“64 ä½ç³»ç»Ÿï¼šHKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug 64 ä½ windbgâ€“64 ä½ç³»ç»Ÿï¼šHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AeDebug AeDebug é¡¹ä¸‹é¢æœ‰ 2 ä¸ªå€¼ï¼šåç§°ï¼šAutoï¼Œç±»å‹ï¼šREG_SZï¼Œ0 è¡¨ç¤ºå‡ºç°å´©æºƒå¼¹å‡ºå¯¹è¯æ¡†ï¼Œè®©ç”¨æˆ·é€‰æ‹©å…³é—­ç¨‹åºè¿˜æ˜¯è°ƒè¯•ç¨‹åºï¼›1 è¡¨ç¤ºè‡ªåŠ¨å¼¹å‡ºè®¾ç½®è°ƒè¯•å™¨ã€‚åç§°ï¼šDebuggerï¼Œç±»å‹ï¼šREG_SZï¼Œè°ƒè¯•å™¨å€¼ã€‚é»˜è®¤ä¸ºâ€C:\\WINDOWS\\system32\\vsjitdebugger.exeâ€ -p %ld -e %ldï¼Œè®¾ç½®ä¸º windbg éœ€æ›´æ”¹ä¸ºâ€C:\\Debuggers\\WinDbg\\x86\\windbg.exeâ€ -p %ld -e %ld -g çœ‹èµ·æ¥æŒºå¤æ‚ï¼Œå…¶å®æŒºå¥½ç†è§£çš„ã€‚ 1.5 Adplusadplus å·¥å…·ä½äº windbg å®‰è£…ç›®å½•ï¼Œæœ€æ—©å« adplus.vbsï¼Œä»¥ VBScript è„šæœ¬æä¾›ï¼Œæœ€æ–°ç‰ˆæ”¹æˆäº† adplus.exeã€‚adplus.exe ä¸ä»…å¯ä»¥åœ¨ç¨‹åºå´©æºƒæ—¶æ‰‹åŠ¨è¿è¡Œæ¥ç”Ÿæˆ dmp æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨å´©æºƒä¹‹å‰å°±è¿è¡Œå®ƒï¼Œå½“ç¨‹åºå´©æºƒæ—¶å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆ dmp æ–‡ä»¶ï¼›ç”šè‡³å¯ä»¥åœ¨ç¨‹åºæ²¡æœ‰è¿è¡Œä¹‹å‰å°±å…ˆè¿è¡Œ adplusï¼Œå½“ç¨‹åºå´©æºƒæ—¶å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆ dmp æ–‡ä»¶ã€‚å¦‚ï¼šadplus -pn powerpnt.exe -pn wincmd32.exe -hang -o c:\\test Adplus ç”¨æ³•ï¼š 1234ADPlus &lt;RunMode&gt; -o &lt;OutputDirectory&gt; [Options]RunModeï¼š-hangæˆ–-crash -hangÂ é™„åŠ åˆ°è¿›ç¨‹ï¼Œç”Ÿæˆdmpï¼Œç„¶åè§£é™¤é™„åŠ (detach)ã€‚å¤šç”¨äºç¨‹åºå¡æ­»çš„æƒ…å†µä¸‹ã€‚ -crashÂ é™„åŠ åˆ°è¿›ç¨‹ï¼Œç›´åˆ°ç¨‹åºå´©æºƒæˆ–è€…å…¶ä»–äº‹ä»¶å‘ç”Ÿï¼Œç”Ÿæˆdmpæ–‡ä»¶ï¼Œç„¶åè§£é™¤é™„åŠ ã€‚ å¸¸ç”¨å‚æ•°ï¼š -o ç›®å½•æŒ‡å®šç”Ÿæˆæ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚ -p è¿›ç¨‹ IDæŒ‡å®šè¿›ç¨‹ IDï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¬¡-p æ¥æŒ‡å®šå¤šä¸ªè¿›ç¨‹ã€‚ -pn è¿›ç¨‹åæŒ‡å®šè¿›ç¨‹åï¼Œæ”¯æŒé€šé…ç¬¦ï¼Œä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šæ¬¡-pn æ¥æŒ‡å®šå¤šä¸ªè¿›ç¨‹ï¼Œä½†è¿›ç¨‹åå¿…é¡»å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å¤±è´¥ã€‚ -po è¿›ç¨‹åå’Œ-pn ç±»ä¼¼ï¼Œä½†-po ä¸è¦æ±‚è¿›ç¨‹åå¿…é¡»å­˜åœ¨ã€‚å¯ä»¥åœ¨è¿›ç¨‹å¯åŠ¨ä¹‹å‰å°±å…ˆå¯åŠ¨ Adplus. -pmn è¿›ç¨‹åpmn ä¸º Process Monitor ç¼©å†™ã€‚é¡¾åæ€ä¹‰ï¼Œå¯ä»¥ç›‘è§†è¿›ç¨‹åˆ—è¡¨ï¼Œä¸€æ—¦æŒ‡å®šè¿›ç¨‹è¿è¡Œï¼Œåˆ™é™„åŠ ä¸Šå»ã€‚åªé€‚ç”¨äº-crash æ¨¡å¼ã€‚ â€‹# äºŒã€ä»£ç ç¯‡ä½¿ç”¨ä»£ç ç”Ÿæˆdumpæ–‡ä»¶çš„åŸç†å¤§è‡´æ˜¯ï¼š æ•è·å¼‚å¸¸ï¼Œå¦‚SetUnhandledExceptionFilterã€__try...__exceptã€‚ ä½¿ç”¨MiniDumpWriteDumpå†™å…¥dumpåˆ°æ–‡ä»¶ã€‚ ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œæˆ‘å°è£…äº†ä¸€ä¸ªæ•è·å¼‚å¸¸å¹¶å†™å…¥dumpçš„è¾…åŠ©ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970// EasyDump.h#pragma once#include &lt;windows.h&gt;#include &lt;tchar.h&gt;#include &lt;strsafe.h&gt;namespace cpp4j &#123; typedef struct _EXCEPTION_POINTERS EXCEPTION_POINTERS, *PEXCEPTION_POINTERS; int __cdecl RecordExceptionInfo(PEXCEPTION_POINTERS pExceptPtrs, const TCHAR *szDumpNamePrefix); TCHAR *lstrrchr(LPCTSTR string, int ch); void DumpMiniDump(HANDLE hFile, PEXCEPTION_POINTERS excpInfo);&#125;#define WINMAIN_BEGIN(szDumpNamePrefix) \\ int __96A9695E_RUN_WINMAIN_FUNC(HINSTANCE hInstance, LPTSTR lpCmdLine);\\ LONG WINAPI __96A9695E_UnhandledExceptionHandler( _EXCEPTION_POINTERS *pExceptionInfo ) \\ &#123; \\ OutputDebugString(TEXT(&quot;Create a dump file sine an exception occurred in sub-thread. &quot;)); \\ int iRet = cpp4j::RecordExceptionInfo(pExceptionInfo, szDumpNamePrefix); \\ return iRet; \\ &#125; \\ int APIENTRY _tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPTSTR lpCmdLine, int nCmdShow) \\ &#123; \\ UNREFERENCED_PARAMETER(hPrevInstance); \\ UNREFERENCED_PARAMETER(nCmdShow); \\ ::SetUnhandledExceptionFilter( __96A9695E_UnhandledExceptionHandler );\\ int ret = 0;\\ __try\\ &#123;\\ ret = __96A9695E_RUN_WINMAIN_FUNC(hInstance, lpCmdLine);\\ &#125;\\ __except(cpp4j::RecordExceptionInfo(GetExceptionInformation(), szDumpNamePrefix))\\ &#123;\\ OutputDebugString(TEXT(&quot;Create a dump file sine an exception occurred in main-thread. &quot;)); \\ &#125;\\ return ret;\\ &#125;\\ int __96A9695E_RUN_WINMAIN_FUNC(HINSTANCE hInstance, LPTSTR lpCmdLine) \\ &#123;#define WINMAIN_END &#125;#define MAIN_BEGIN(szDumpName) \\ int __96A9695E_RUN_MAIN_FUNC(int argc, _TCHAR* argv[]);\\ LONG WINAPI __96A9695E_UnhandledExceptionHandler( _EXCEPTION_POINTERS *pExceptionInfo ) \\ &#123; \\ OutputDebugString(TEXT(&quot;Create a dump file since an exception occurred in sub-thread. &quot;)); \\ int iRet = cpp4j::RecordExceptionInfo(pExceptionInfo, szDumpName); \\ return iRet; \\ &#125; \\ int _tmain(int argc, _TCHAR* argv[])\\ &#123; \\ ::SetUnhandledExceptionFilter( __96A9695E_UnhandledExceptionHandler );\\ int ret = 0;\\ __try\\ &#123;\\ ret = __96A9695E_RUN_MAIN_FUNC(argc, argv);\\ &#125;\\ __except(cpp4j::RecordExceptionInfo(GetExceptionInformation(), szDumpName))\\ &#123;\\ OutputDebugString(TEXT(&quot;Create a dump file since an exception occurred in main-thread. &quot;)); \\ &#125;\\ return ret;\\ &#125;\\ int __96A9695E_RUN_MAIN_FUNC(int argc, _TCHAR* argv[]) \\ &#123;#define MAIN_END &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596// EasyDump.cpp#include &quot;EasyDump.h&quot;#include &lt;DbgHelp.h&gt;#pragma comment(lib, &quot;Dbghelp.lib&quot;)namespace cpp4j &#123; TCHAR *lstrrchr(LPCTSTR string, int ch) &#123; TCHAR *start = (TCHAR *)string; while (*string++) ; while (--string != start &amp;&amp; *string != (TCHAR)ch) ; if (*string == (TCHAR)ch) return (TCHAR *)string; return NULL; &#125; inline void DumpMiniDump(HANDLE hFile, PEXCEPTION_POINTERS excpInfo) &#123; if (!excpInfo) &#123; static int iTimes = 0; if (iTimes++ &gt; 1) return; __try &#123; RaiseException(EXCEPTION_BREAKPOINT, 0, 0, NULL); &#125; __except (DumpMiniDump(hFile, GetExceptionInformation()), EXCEPTION_CONTINUE_EXECUTION) &#123; &#125; &#125; else &#123; MINIDUMP_EXCEPTION_INFORMATION eInfo; eInfo.ThreadId = GetCurrentThreadId(); eInfo.ExceptionPointers = excpInfo; eInfo.ClientPointers = FALSE; MiniDumpWriteDump( GetCurrentProcess(), GetCurrentProcessId(), hFile, MiniDumpNormal, excpInfo ? &amp;eInfo : NULL, NULL, NULL); &#125; &#125; int __cdecl RecordExceptionInfo(PEXCEPTION_POINTERS pExceptPtrs, const TCHAR *szDumpNamePrefix) &#123; static bool bFirstTime = true; if (!bFirstTime) return EXCEPTION_CONTINUE_SEARCH; bFirstTime = false; // Dmpæ–‡ä»¶å‘½åï¼šå‰ç¼€_å¹´æœˆæ—¥.æ—¶.åˆ†.ç§’.æ¯«ç§’.dmp // TCHAR szLocalTime[50] = &#123; 0 &#125;; SYSTEMTIME st; GetLocalTime(&amp;st); StringCchPrintf(szLocalTime, 50, TEXT(&quot;%04d%02d%02d.%02d.%02d.%02d.%04d&quot;), st.wYear, st.wMonth, st.wDay, st.wHour, st.wMinute, st.wSecond, st.wMilliseconds); TCHAR szExeDir[MAX_PATH + 1] = &#123; 0 &#125;; GetModuleFileName(NULL, szExeDir, MAX_PATH); if (TCHAR *p = lstrrchr(szExeDir, TEXT(&#x27;\\\\&#x27;))) &#123; *(p + 1) = 0; &#125; TCHAR szDumpFileName[MAX_PATH + 1] = &#123; 0 &#125;; _stprintf_s(szDumpFileName, MAX_PATH, TEXT(&quot;%s%s_%s.dmp&quot;), szExeDir, szDumpNamePrefix, szLocalTime); HANDLE hMiniDumpFile = CreateFile( szDumpFileName, GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL | FILE_FLAG_WRITE_THROUGH, NULL); if (hMiniDumpFile != INVALID_HANDLE_VALUE) &#123; DumpMiniDump(hMiniDumpFile, pExceptPtrs); CloseHandle(hMiniDumpFile); hMiniDumpFile = NULL; &#125; return EXCEPTION_EXECUTE_HANDLER; &#125;&#125; MAIN_BEGINå’ŒWINMAIN_BEGINä¸­çš„å‚æ•°ä¸ºç”Ÿæˆçš„ dump æ–‡ä»¶çš„å‰ç¼€ï¼Œdump æ–‡ä»¶å‘½åæ–¹å¼: å‰ç¼€*å¹´æœˆæ—¥.æ—¶.åˆ†.ç§’.æ¯«ç§’.dmpã€‚ ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨MAIN_BEGINæ›¿æ¢mainï¼ŒWINMAIN_BEGINæ›¿æ¢WinMainå³å¯ï¼š 123456789101112#include &quot;EasyDump.h&quot;MAIN_BEGIN(TEXT(&quot;Test&quot;))int i = 0;int *p = &amp;i;p = NULL;*p = 5;return 0;MAIN_END ä¸Šé¢çš„ä»£ç ä¼šåœ¨ç¨‹åºçš„å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º Test_20171101.14.49.57.0264.dmp çš„ dump æ–‡ä»¶ã€‚","tags":["Dump"],"categories":["Windowsç¼–ç¨‹"]},{"title":"ä¸€é”®å¯åŠ¨ç¥å™¨ä¹‹1key.run","path":"/post/776574933.html","content":"1key.runæ—¢æ˜¯äº§å“å®˜ç½‘åŸŸåï¼Œäº¦æ˜¯äº§å“åç§°ã€‚ é¡¾åæ€ä¹‰ï¼Œä¸»æ‰“ä¸€é”®å¯åŠ¨ï¼Œå¯ä»¥ä¸€é”®å¯åŠ¨æœ¬åœ°åº”ç”¨ã€ç½‘é¡µæœç´¢ï¼Œå¹¶å†…ç½®äº†ä¸€äº›å®ç”¨åŠŸèƒ½å¦‚æ—¥å†ã€ç§‘å­¦è®¡ç®—ã€æˆªå›¾ç­‰ã€‚ ä¸€ã€ä¸‹è½½ Githubï¼ˆæ›´æ–°åŠæ—¶ï¼‰ https://github.com/winsoft666/1key.run-Setup/releases å¥¶ç‰›å¿«ä¼ ï¼ˆæ›´æ–°å¯èƒ½å»¶åï¼‰ https://cowtransfer.com/s/f0c4a81b0e604b äºŒã€äº§å“ç‰¹è‰²äº§å“ç‰¹è‰²å½’çº³ä¸ºä¸‰ä¸ªå­—ï¼šè½»ã€å¿«ã€çˆ½ã€‚ 2.1 è½»â€œè½»â€ä¸ºè½»é‡åŒ–ã€‚å‡å°‘ç³»ç»Ÿèµ„æºçš„å ç”¨ï¼Œä¸é‡‡ç”¨è‡ƒè‚¿çš„ Electron æˆ– CEF ç­‰ Web æŠ€æœ¯æ¶æ„ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½é‡‡ç”¨çº¯ C++ Native å¼€å‘ã€‚è½¯ä»¶å®‰è£…åŒ…ä»…æœ‰ 15MBï¼ˆäº‹å®ä¸Šè¿˜å¯ä»¥æ›´å°ï¼‰ï¼Œè¿è¡Œæ—¶ä»…å ç”¨ 12MB å†…å­˜ã€‚ 2.2 å¿«â€œå¿«â€ä¸ºå¿«é€Ÿè¿è¡Œã€å¿«é€Ÿä¸Šæ‰‹ã€‚ 1. è¾“å…¥æœ¬åœ°åº”ç”¨çš„ç®€å†™ï¼ˆå¦‚æ‹¼éŸ³é¦–å­—æ¯ï¼‰å¯ä»¥å¿«é€Ÿå¯åŠ¨è¯¥åº”ç”¨ã€‚è¾“å…¥szqm: é»˜è®¤ä¼šé€‰ä¸­ç¬¬ä¸€é¡¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Alt + æ•°å­—å¿«æ·é”®å¿«é€Ÿå®šä½åˆ°å…¶ä»–é¡¹ã€‚ æŒ‰Enteré”®è¿è¡Œå½“å‰é¡¹ï¼Œè¿˜å¯ä»¥åœ¨å³é”®èœå•ä¸­å¯ä»¥é€‰æ‹©â€œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œâ€ã€‚ 2. è¾“å…¥æ•°å­¦è¡¨è¾¾å¼ï¼Œå¯ä»¥å¿«é€Ÿçš„è®¡ç®—è¯¥è¡¨è¾¾å¼çš„ç»“æœã€‚ è¾“å…¥sin(90)+cos(45)+(2+3)*4ï¼š ç§‘å­¦è®¡ç®—å™¨ä¸º 1key.run çš„å†…ç½®åŠŸèƒ½ï¼Œåœ¨è¡¨è¾¾å¼è®¡ç®—ç»“æœé¡¹ä¸ŠæŒ‰Enteré”®å¯ä»¥è¿›å…¥è¯¥åŠŸèƒ½è¯¦æƒ…é¡µï¼š ä¹Ÿå¯ä»¥è¾“å…¥kxjsqå¯åŠ¨è¯¥åŠŸèƒ½ï¼ŒæŒ‰Escé”®å¯ä»¥é€€å‡ºå½“å‰åŠŸèƒ½ã€‚ 3. å‰ªåˆ‡æ¿æ£€æµ‹å½“ 1key.run è¢«å”¤èµ·æ—¶ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥å‰ªåˆ‡æ¿ä¸­çš„æ•°æ®æ˜¯å¦å¯ä»¥è¢« 1key.run çš„æŸä¸ªåŠŸèƒ½æ¨¡å—æ‰€ä½¿ç”¨ã€‚å¦‚å¤åˆ¶sin(90)+cos(45)+(2+3)*4åˆ°å‰ªåˆ‡æ¿ï¼Œä½¿ç”¨å¿«æ·é”®Alt+ç©ºæ ¼å”¤èµ· 1key.runï¼Œä¼šè‡ªåŠ¨æ˜¾ç¤ºè®¡ç®—ç»“æœã€‚ 4. å¿«é€Ÿä¸Šæ‰‹æƒ³åˆ°åˆ™è¾“å…¥ï¼Œæ‰€è¾“å³æ‰€å¾—ã€‚ä¸ç”¨è®°å¿†ç¹ççš„å¿«æ·é”®ï¼Œåªéœ€çŸ¥é“ä¸‰ä¸ªå¿«æ·é”®å³å¯ä¸Šæ‰‹ä½¿ç”¨ï¼š Alt + ç©ºæ ¼å”¤èµ· 1key.run Enterä¸ºæ‰§è¡Œå½“å‰é€‰æ‹©é¡¹ Escä¸ºé€€å‡ºå½“å‰åŠŸèƒ½ 2.3 çˆ½å®Œå…¨å…è´¹ï¼Œå¸è½½æ— æ®‹ç•™ã€‚ å…è´¹ç‰ˆæœ¬å’Œ Pro ç‰ˆæœ¬ä»…åœ¨æ›´æ–°é€šé“ä¸Šæœ‰åŒºåˆ«ï¼ŒPro ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ç¨³å®šçš„æ›´æ–°é€šé“ã€‚åœ¨åŠŸèƒ½æ–¹é¢ï¼Œå…è´¹ç‰ˆæœ¬å’Œ Pro ç‰ˆæœ¬æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ ä¸‰ã€åŠŸèƒ½ä»‹ç»1key.run å°†åŠŸèƒ½åˆ’åˆ†æˆäº†ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼ŒåŒ…å«å¦‚ä¸‹åŠŸèƒ½æ¨¡å—ï¼š å¿«é€Ÿå¯åŠ¨ ç½‘é¡µæœç´¢ ç§‘å­¦è®¡ç®—å™¨ é¢œè‰²æ‹¾å– æ—¥å† æˆªå›¾ JSON æ ¼å¼åŒ– XML æ ¼å¼åŒ– æ–‡ä»¶å“ˆå¸Œè®¡ç®— å¯ä»¥åœ¨ 1key.run ä¸»æœç´¢æ¡†è¾“å…¥åŠŸèƒ½æ¨¡å—æ”¯æŒçš„æ•°æ®æ¥å”¤èµ·è¯¥åŠŸèƒ½ï¼Œå¦‚1+2+3ä¸ºç§‘å­¦è®¡ç®—å™¨æ”¯æŒçš„æ•°æ®ï¼Œ&#123;&quot;a&quot;:1&#125;ä¸º JSON æ ¼å¼åŒ–æ”¯æŒçš„æ•°æ®ã€‚ ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥åŠŸèƒ½æ¨¡å—çš„è§¦å‘å…³é”®å­—ï¼ˆå¯ä»¥åœ¨â€œè®¾ç½®â€ä¸­è‡ªå®šä¹‰ï¼‰æ¥å¯åŠ¨è¯¥åŠŸèƒ½ï¼Œå¦‚è¾“å…¥qsè§¦å‘é¢œè‰²æ‹¾å–åŠŸèƒ½ç­‰ã€‚ 3.1 å¿«é€Ÿå¯åŠ¨å¿«é€Ÿå¯åŠ¨å¯ä»¥ç”¨æ¥å¯åŠ¨æœ¬åœ°åº”ç”¨ï¼Œæ”¯æŒä¸­æ–‡æ‹¼éŸ³ç®€å†™ã€åˆ†è¯ï¼Œå¦‚ï¼š 123æœ‰é“ç¿»è¯‘ -&gt; ydfyVisual Studio Code -&gt; vscWinHex -&gt; wh å½“æœç´¢ç»“æœä¸è¶³æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ ç½‘é¡µæœç´¢å¼•æ“åˆ°åˆ—è¡¨çš„æœ«å°¾ã€‚ å¯ä»¥åœ¨â€œè®¾ç½®â€ä¸­è‡ªå®šä¹‰éœ€è¦æ£€ç´¢å’Œç›‘æ§çš„æ–‡ä»¶å¤¹ï¼Œ1key.run ä¼šè‡ªåŠ¨æ£€ç´¢è¯¥æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶å¤¹ä¸‹çš„å¯æ‰§è¡Œé¡¹(å¦‚.exeã€.bat æ–‡ä»¶)ï¼Œå¹¶æ·»åŠ åˆ°å¿«é€Ÿå¯åŠ¨ä¸­ã€‚ å½“æ–‡ä»¶å¤¹ä¸­æœ‰æ–‡ä»¶æ–°å¢æˆ–åˆ é™¤æ—¶ï¼Œ1key.run ä¼šè‡ªåŠ¨ç›‘æ§åˆ°è¿™äº›æ”¹å˜ï¼Œæ·»åŠ åˆ°å¯åŠ¨é¡¹æˆ–ä»ä¸­ç§»é™¤ã€‚ å¦‚æœæŸä¸ªç›®å½•ä¸‹æ–‡ä»¶æˆ–å­æ–‡ä»¶å¤¹å¤ªå¤šï¼Œæ£€ç´¢å’Œç›‘æ§ä¼šæ¶ˆè€—æ¯”è¾ƒå¤šçš„ç³»ç»Ÿèµ„æºï¼Œå¯ä»¥åœ¨æ’é™¤è¯¥ç›®å½•ã€‚ æœ€åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ å•ä¸ªå¯åŠ¨é¡¹ã€‚ 3.2 ç½‘é¡µæœç´¢1key.run å†…ç½®äº†ç™¾åº¦ã€è°·æ­Œã€å¿…åº”ã€ç™¾åº¦ç™¾ç§‘ã€Microsoft Docsã€Github ç­‰ä¸»æµæœç´¢å¼•æ“ï¼Œè¾“å…¥å¯¹çš„å¼•æ“åæˆ–ç®€å†™ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°è¯¥æœç´¢å¼•æ“ã€‚ å¦‚è¾“å…¥baiduå¹¶å›è½¦ï¼Œå®šä½å¹¶é€‰æ‹©ç™¾åº¦æœç´¢å¼•æ“ï¼š è¾“å…¥éœ€è¦æœç´¢çš„å†…å®¹ï¼Œå›è½¦å³å¯æœç´¢ã€‚ å¯ä»¥åœ¨â€œè®¾ç½®â€ä¸­ç®¡ç†æœç´¢å¼•æ“ï¼š 3.3 ç§‘å­¦è®¡ç®—å™¨æä¾›ä¼ ç»Ÿç§‘å­¦è®¡ç®—å™¨æ‰€æ‹¥æœ‰çš„å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚ 3.4 é¢œè‰²æ‹¾å–å®æ—¶æå–é¼ æ ‡ä½ç½®çš„é¢œè‰²å€¼ï¼Œå®æ—¶æ˜¾ç¤º RGB å’Œåå…­è¿›åˆ¶é¢œè‰²å€¼ã€‚ ä¸å…¶ä»–å–è‰²è½¯ä»¶ä¸åŒçš„æ˜¯ï¼Œ1key.run æä¾›çš„é¢œè‰²æ‹¾å–åŠŸèƒ½æ”¯æŒé€šè¿‡æ–¹å‘é”®è¿›è¡Œåƒç´ çº§çš„ç§»åŠ¨ã€‚ 3.5 æ—¥å†ä¼ ç»Ÿæ—¥å†ç³»ç»Ÿé€šå¸¸åªæ˜¾ç¤ºé˜´å†çš„â€œæ—¥â€ï¼Œè€Œä¸æ˜¾ç¤ºâ€œæœˆâ€ï¼Œæœ‰æ—¶ä¸ºäº†æŸ¥çœ‹å½“å‰é˜´å†çš„æœˆä»½ä¸å¾—å‰åç¿»é˜…ï¼Œéå¸¸ä¸ä¾¿ã€‚1key.run æä¾›çš„è½»é‡çº§çš„æ—¥å†è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œæ— éœ€è”ç½‘å³å¯ä½¿ç”¨ã€‚ 3.6 æˆªå›¾1key.run å†…ç½®çš„æˆªå›¾åŠŸèƒ½ï¼Œæ”¯æŒå¯¹çª—å£ã€çŸ©å½¢è¿›è¡Œæˆªå›¾ï¼Œå®æ—¶æ˜¾ç¤ºæˆªå–åŒºåŸŸåæ ‡å’Œå°ºå¯¸ã€‚è¾“å…¥jtå¯ä»¥å”¤èµ·è¯¥åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥åœ¨â€œè®¾ç½®â€ä¸­è‡ªå®šä¹‰å…¨å±€å¿«æ·é”®ã€‚ 3.7 JSON æ ¼å¼åŒ– 3.8 XML æ ¼å¼åŒ– 3.9 æ–‡ä»¶å“ˆå¸Œè®¡ç®—è®¡ç®—æ–‡ä»¶çš„å“ˆå¸Œå€¼ï¼Œæ”¯æŒMD5ã€CRC32ã€SHA-1ã€SHA-256ã€SHA-512ç­‰å“ˆå¸Œç±»å‹ã€‚ æ›´å¤šæ›´å¤šåŠŸèƒ½è¿˜åœ¨å¼€å‘å’Œå®Œå–„ä¸­ï¼Œè¯¥æ–‡æ¡£å¯èƒ½æ›´æ–°ä¸åŠæ—¶ï¼Œå·²å®é™…åº”ç”¨ä¸ºå‡†ã€‚ é™äºæ”¿ç­–åŸå› ï¼Œåœ¨æ‚¨çœ‹åˆ°è¯¥æ–‡ç« æ—¶ï¼Œåšå®¢å¯èƒ½å·²ç»å…³é—­äº†è¯„è®ºåŠŸèƒ½ğŸ¥º æ‚¨å¯ä»¥é€šè¿‡åœ¨ blog-comment é¡¹ç›®ä¸­æäº¤Issueæ¥é—´æ¥åœ°å‘è¡¨è¯„è®ºğŸ€","tags":["1key.run"],"categories":["Power By Me"]},{"title":"ä»æ±‡ç¼–çš„è§’åº¦åˆ†æå‡½æ•°è°ƒç”¨è¿‡ç¨‹","path":"/post/4168021185.html","content":"æœ¬æ–‡ä»æ±‡ç¼–çš„è§†è§’åˆ†æäº†å‡½æ•°çš„è°ƒç”¨æ–¹å¼ï¼ŒæŒæ¡è¯¥çŸ¥è¯†å¯¹ä½¿ç”¨ OllyDbg ç­‰åŠ¨æ€è°ƒè¯•å·¥å…·ä¼šå¤§æœ‰è£¨ç›Šã€‚ ä¸€ã€ å‡½æ•°å‚æ•°ä¼ é€’å½¢å¼å‡½æ•°çš„å‚æ•°ä¼ é€’æœ‰ 2 ç§æ–¹å¼ï¼š å †æ ˆæ–¹å¼ å¯„å­˜å™¨æ–¹å¼ å¦‚æœæ˜¯å †æ ˆæ–¹å¼ä¼ é€’çš„ï¼Œå°±éœ€è¦å®šä¹‰å‡½æ•°å‚æ•°åœ¨å †æ ˆä¸­çš„ä¼ é€’é¡ºåºï¼Œå¹¶çº¦å®šå‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œæ˜¯ç”±å‡½æ•°æ¥å¹³è¡¡å †æ ˆï¼Œè¿˜æ˜¯ç”±è°ƒç”¨è€…æ¥å¹³è¡¡å †æ ˆï¼› å¦‚æœæ˜¯å¯„å­˜å™¨æ–¹å¼ä¼ é€’çš„ï¼Œå°±éœ€è¦ç¡®å®šå‚æ•°å­˜æ”¾åœ¨å“ªä¸ªå¯„å­˜å™¨ä¸­ã€‚ ä¸¤ç§æ–¹å¼éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œè€Œä¸”ä¸ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æœ‰å…³ç³»ã€‚ æˆ‘ä»¬åœ¨å¼€å‘ä¸­ç»å¸¸é‡åˆ°è°ƒç”¨çº¦å®šç±»å‹ï¼Œå¦‚__cdeclã€stdcallã€PASCALã€fastcallï¼Œè¿™äº›è°ƒç”¨çº¦å®šç±»å‹å°±ç”¨æ¥æŒ‡å®šå‡½æ•°å‚æ•°çš„ä¼ é€’æ–¹å¼çš„ã€‚ ä¸Šé¢å‡ ç§çº¦å®šç±»å‹ï¼Œé™¤äº†fastcallæ˜¯ä½¿ç”¨å¯„å­˜å™¨æ–¹å¼ä¼ é€’å‚æ•°å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä½¿ç”¨å †æ ˆä¼ é€’å‚æ•°çš„ã€‚ Visual Studio ä¸­çš„ C++å·¥ç¨‹ï¼Œå¯ä»¥C++ â€“&gt; é«˜çº§ â€“&gt; è°ƒç”¨çº¦å®šä¸­è¿›è¡Œè°ƒç”¨çº¦å®šçš„è®¾ç½®ï¼š äºŒã€ä½¿ç”¨å †æ ˆæ–¹å¼ä¼ é€’å‡½æ•°å‚æ•°å †æ ˆæ˜¯ä¸€ç§â€œåè¿›å…ˆå‡ºâ€çš„æ•°æ®ç»“æ„ï¼ŒESPå¯„å­˜å™¨å§‹ç»ˆæŒ‡å‘æ ˆé¡¶ã€‚ ESPï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨(Extended Stack Pointer)ï¼Œæ°¸è¿œæŒ‡å‘æ ˆé¡¶ã€‚ æ ˆä¸­æ•°æ®çš„åœ°å€ä»åº•éƒ¨åˆ°é¡¶éƒ¨ä¾æ¬¡å‡å°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ ˆåº•å¯¹åº”é«˜åœ°å€ï¼Œæ ˆé¡¶å¯¹åº”ä½åœ°å€ã€‚ è°ƒç”¨å‡½æ•°æ—¶ï¼Œè°ƒç”¨è€…ä¾æ¬¡æŠŠå‚æ•°å‹æ ˆï¼Œç„¶åè°ƒç”¨å‡½æ•°ï¼Œå‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œåœ¨å †æ ˆä¸­å–å¾—å‚æ•°æ•°æ®ã€‚å‡½æ•°è°ƒç”¨ç»“æŸä»¥åï¼Œå †æ ˆéœ€è¦æ¢å¤åˆ°å‡½æ•°è°ƒç”¨ä¹‹å‰çš„æ ·å­ï¼Œè€Œåˆ°åº•æ˜¯ç”±è°ƒç”¨è€…æ¥æ¢å¤è¿˜æ˜¯å‡½æ•°è‡ªèº«æ¥æ¢å¤ï¼Œæ ¹æ®ä¸åŒçš„è°ƒç”¨çº¦å®šç±»å‹é‡‡ç”¨çš„æ–¹å¼ä¸åŒã€‚ çº¦å®šç±»å‹ __cdecl stdcall PASCAL fastcall å‚æ•°ä¼ é€’é¡ºåº ä»å³åˆ°å·¦ ä»å³åˆ°å·¦ ä»å·¦åˆ°å³ ä½¿ç”¨å¯„å­˜å™¨ å †æ ˆå¹³è¡¡è€… è°ƒç”¨è€… å‡½æ•°è‡ªèº« å‡½æ•°è‡ªèº« å‡½æ•°è‡ªèº« __cdcelæ˜¯ C&#x2F;C++&#x2F;MFC ç¨‹åºé»˜è®¤çš„è°ƒç”¨çº¦å®šã€‚ stdcallæ˜¯ç»å¤§å¤šæ•° Win32 API å‡½æ•°çš„çº¦å®šæ–¹å¼ï¼Œä¹Ÿæœ‰å°‘éƒ¨åˆ†ä½¿ç”¨__cdcelçº¦å®šæ–¹å¼ï¼ˆå¦‚ wsprintf ç­‰ï¼‰ã€‚ åœ¨ Windows C&#x2F;C++å¼€å‘ä¸­å¸¸ç”¨çš„å°±æ˜¯__cdeclå’Œstdcallè¿™ä¸¤ç§è°ƒç”¨çº¦å®šã€‚ ä¸¾ä¾‹è¯´æ˜ï¼ŒæŒ‰ç…§ä¸åŒçš„â€œè°ƒç”¨çº¦å®šâ€è°ƒç”¨å‡½æ•°int add(int a, int b)ã€‚ä»è°ƒç”¨è€…çš„è§†è§’æ¥çœ‹ï¼Œå…¶æ±‡ç¼–ä»£ç åˆ†åˆ«è¡¨ç¤ºå¦‚ä¸‹ï¼š __cdecl 1234push b ;å‚æ•°æŒ‰ä»å³åˆ°å·¦ä¼ é€’push acall addadd esp, 8 ;è°ƒç”¨è€…åœ¨å‡½æ•°å¤–éƒ¨å¹³è¡¡å †æ ˆ stdcall 123push b ;å‚æ•°æŒ‰ä»å³åˆ°å·¦ä¼ é€’push acall add ;å‡½æ•°è‡ªå·±å†…éƒ¨å¹³è¡¡å †æ ˆï¼Œè°ƒç”¨è€…ä¸éœ€è¦å¹³è¡¡å †æ ˆ åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå‚æ•°å…¥æ ˆçš„è¿‡ç¨‹å¦‚å›¾ï¼š ä¸Šå›¾ä¸­ï¼ŒEBPå’Œå‡½æ•°è¿”å›åœ°å€retéƒ½æ˜¯ 32 ä½åœ°å€ï¼Œå †æ ˆä¸­å¤‡ä»½äº†è€çš„EBPå€¼ï¼Œåœ¨å‡½æ•°è°ƒç”¨å®Œä¹‹åä¼šå°†EBPæ¢å¤ä¸ºå¤‡ä»½åœ¨å †æ ˆä¸­çš„è€EBPå€¼ï¼Œæ‰€ä»¥ä»è°ƒç”¨è€…è§’åº¦æ¥çœ‹ï¼Œåœ¨å‡½æ•°çš„è°ƒç”¨å¼€å§‹å‰å’Œç»“æŸåï¼ŒEBPæ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚ é€šå¸¸å‡½æ•°ä¸­çš„å‰2æ¡æŒ‡ä»¤éƒ½æ˜¯ï¼š 12push ebp mov ebp,esp é€šå¸¸ä½¿ç”¨æ–°çš„EBPè·å–å‡½æ•°å„ä¸ªå‚æ•°çš„å€¼ï¼š 12å‚æ•°a = EBP + 0x8å‚æ•°b = EBP + 0xC å½“ç„¶ä½¿ç”¨ESPè·å–å‚æ•°å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†ä½¿ç”¨EBPä¼šæ›´åŠ æ–¹ä¾¿ï¼Œå› ä¸ºESPä¸€ç›´æŒ‡å‘æ ˆé¡¶ï¼Œå› æ­¤ä¼šéšç€å±€éƒ¨å˜é‡çš„å‹æ ˆè€Œå˜åŒ–ï¼Œè€ŒESPæ˜¯ä¸ä¼šéšç€å…¥æ ˆ&#x2F;å‡ºæ ˆè€Œå˜åŒ–çš„ã€‚ ä¸‰ã€è°ƒç”¨è¿‡ç¨‹åˆ†æ123456789101112131415#include &lt;stdio.h&gt;int add(int a, int b) &#123; int c = 0; c = a + b; return c;&#125;int main()&#123; int r = add(1, 2); return 0;&#125; æˆ‘ä»¬ä½¿ç”¨Visual Studio 2017ç¼–è¯‘ä¸Šé¢ä»£ç ï¼Œå¹¶åœ¨åœ¨å·¥ç¨‹é…ç½®ä¸­å°†å‡½æ•°è°ƒç”¨çº¦å®šè®¾ç½®ä¸º__cdeclã€‚ åœ¨ç¨‹åºè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨Visual Studioçš„â€œåæ±‡ç¼–çª—å£â€ä¸­çœ‹åˆ° C++ä»£ç å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼Œä»¥åŠå¯„å­˜å™¨çª—å£ä¸­çœ‹åˆ°å„ä¸ªå¯„å­˜å™¨çš„å€¼ã€‚ mainå‡½æ•°çš„åæ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324int main()&#123;00DD1720 push ebp // å‚è§addå‡½æ•°ä¸­å…³äºè¿™ä¸€éƒ¨åˆ†çš„è§£æ00DD1721 mov ebp,esp00DD1723 sub esp,0CCh00DD1729 push ebx00DD172A push esi00DD172B push edi00DD172C lea edi,[ebp-0CCh]00DD1732 mov ecx,33h00DD1737 mov eax,0CCCCCCCCh00DD173C rep stos dword ptr es:[edi] int r = add(1, 2);00DD173E push 2 // å‚æ•°bå…¥æ ˆ00DD1740 push 1 // å‚æ•°aå…¥æ ˆ// è°ƒç”¨addå‡½æ•°ã€‚// CALLæŒ‡ä»¤ç›¸å½“äºæ‰§è¡Œä¸€æ¡PUSHæŒ‡ä»¤åŠ ä¸€æ¡JMPæŒ‡ä»¤ï¼ŒPUSHæŒ‡ä»¤ç”¨äºå‹å…¥è¯¥æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€åˆ°æ ˆä¸­ï¼Œç”¨äºæ‰§è¡Œå®Œå­å‡½æ•°ä¹‹åè¿”å›æ¥ã€‚// JMPæŒ‡ä»¤ç”¨äºè·³è½¬åˆ°å­å‡½æ•°æ‰€åœ¨ä½ç½®å¼€å§‹æ‰§è¡Œå­å‡½æ•°ã€‚00DD1742 call add (0DD1276h) 00DD1747 add esp,8 // å› ä¸ºæ˜¯__cdeclï¼Œæ‰€ä»¥ç”±è°ƒç”¨è€…æ¥å¹³è¡¡å †æ ˆ.00DD174A mov dword ptr [r],eax return 0;00DD174D xor eax,eax&#125; æ‰§è¡Œè¿›å…¥addå‡½æ•°åï¼Œaddå‡½æ•°å†…çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829int add(int a, int b) &#123;00DD16D0 push ebp // ebpå…¥æ ˆï¼Œç›¸å½“äºå¤‡ä»½ebpçš„å€¼00DD16D1 mov ebp,esp // å°†espèµ‹å€¼ç»™ebpï¼Œåœ¨è¯¥å‡½æ•°ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šå†æ”¹å˜ebpçš„å€¼ã€‚00DD16D3 sub esp,0CCh // åœ¨æ ˆä¸Šåˆ†é…0xCCå¤§å°çš„å±€éƒ¨å˜é‡å­˜å‚¨åŒºåŸŸ00DD16D9 push ebx // æš‚å­˜ebx00DD16DA push esi // æš‚å­˜esi00DD16DB push edi // æš‚å­˜edi00DD16DC lea edi,[ebp-0CCh] //ä¸‹é¢4è¡Œä»£ç ï¼ˆå«è¯¥æ¡ï¼‰å®ç°å°†0xCCå¤§å°çš„å±€éƒ¨å˜é‡å­˜å‚¨åŒºåŸŸå…¨éƒ¨èµ‹å€¼ä¸º0xCC00DD16E2 mov ecx,33h // ecxå­˜å‚¨å¾ªç¯æ¬¡æ•°ï¼Œç»“åˆrepæŒ‡ä»¤ä½¿ç”¨ã€‚ä¸ºä»€ä¹ˆæ˜¯0x33æ¬¡äº†ï¼Ÿå› ä¸ºæ˜¯æŒ‰ç…§4ä¸ªå­—èŠ‚èµ‹å€¼çš„ï¼Œ0x33 * 0x4 = 0xCC00DD16E7 mov eax,0CCCCCCCCh00DD16EC rep stos dword ptr es:[edi] // å¾ªç¯èµ‹å€¼ int c = 0;00DD16EE mov dword ptr [c],0 // å°†å±€éƒ¨å˜é‡cèµ‹å€¼ä¸º0 c = a + b;00DD16F5 mov eax,dword ptr [a]00DD16F8 add eax,dword ptr [b]00DD16FB mov dword ptr [c],eax return c;00DD16FE mov eax,dword ptr [c] // å°†ç»“æœå­˜å‚¨åˆ°eaxä¸­ã€‚åœ¨å‡½æ•°è°ƒç”¨ä¸­è¿”å›ç»“æœéƒ½æ˜¯å­˜å‚¨åœ¨eaxä¸­çš„ã€‚&#125;01191701 pop edi // å°†ediçš„å€¼è¿˜åŸåˆ°å‡½æ•°è°ƒç”¨å‰01191702 pop esi // å°†esiçš„å€¼è¿˜åŸåˆ°å‡½æ•°è°ƒç”¨å‰01191703 pop ebx // å°†ebxçš„å€¼è¿˜åŸåˆ°å‡½æ•°è°ƒç”¨å‰01191704 mov esp,ebp // ç§»åŠ¨æ ˆé¡¶åˆ°ebpä½ç½®ï¼Œä»è€Œè·³è¿‡äº†å±€éƒ¨å˜é‡å­˜å‚¨åŒºåŸŸ01191706 pop ebp // å°†ebpçš„å€¼è¿˜åŸåˆ°å‡½æ•°è°ƒç”¨å‰01191707 ret // retæŒ‡ä»¤ç­‰åŒäºï¼šå¼¹å‡ºæ­¤æ—¶æ ˆé¡¶çš„å€¼ç»™eipï¼Œ // å› ä¸ºæ­¤æ—¶æ ˆé¡¶å­˜å‚¨çš„åˆšå¥½æ˜¯å‡½æ•°è¿”å›åœ°å€ï¼Œæ‰€ä»¥ç›¸å½“äºå°†è¿”å›åœ°å€èµ‹å€¼ç»™eipï¼Œä»è€Œå®ç°äº†è¿”å›åˆ°å‡½æ•°è°ƒç”¨çš„åœ°æ–¹ã€‚ åœ¨ä¸Šé¢ä»£ç çš„æ³¨é‡Šä¸­å·²ç»åŒ…å«äº†è¯¦ç»†çš„è§£é‡Šï¼Œç‰¹åˆ«å€¼å¾—æ³¨æ„çš„å‡ ä¸ªåœ°æ–¹æ˜¯ï¼š rep stos dword ptr es:[edi]ç»“åˆedi, ecxæ¥åˆå§‹åŒ–å±€éƒ¨å­˜å‚¨åŒºåŸŸã€‚ å‡½æ•°callæŒ‡ä»¤ä¹‹å‰çš„å‚æ•°å‹æ ˆé¡ºåºã€‚ CALLæŒ‡ä»¤ç›¸å½“äºæ‰§è¡Œä¸€æ¡PUSHæŒ‡ä»¤åŠ ä¸€æ¡JMPæŒ‡ä»¤ï¼ŒPUSHæŒ‡ä»¤ç”¨äºå‹å…¥è¯¥æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€åˆ°æ ˆä¸­ï¼Œç”¨äºæ‰§è¡Œå®Œå­å‡½æ•°ä¹‹åè¿”å›æ¥ã€‚JMPæŒ‡ä»¤ç”¨äºè·³è½¬åˆ°å­å‡½æ•°æ‰€åœ¨ä½ç½®å¼€å§‹æ‰§è¡Œå­å‡½æ•°ã€‚ å› ä¸ºæ˜¯__cdeclè°ƒç”¨çº¦å®šï¼Œå› æ­¤åœ¨å‡½æ•°è°ƒç”¨å®Œä¹‹åï¼Œè°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨add esp,8æŒ‡ä»¤æ¥å¹³è¡¡å †æ ˆã€‚ retæŒ‡ä»¤ç­‰åŒäºï¼šå¼¹å‡ºæ­¤æ—¶æ ˆé¡¶çš„å€¼ç»™ eipï¼Œå·§å¦™ä¹‹å¤„åœ¨äºæ­¤æ—¶æ ˆé¡¶å­˜å‚¨çš„åˆšå¥½æ˜¯å‡½æ•°è¿”å›åœ°å€ï¼Œå› æ­¤å¯ä»¥ç»§ç»­æ‰§è¡Œå‡½æ•°ä¸‹é¢çš„è¯­å¥ã€‚","tags":["C++","æ±‡ç¼–"],"categories":["C++è¯­è¨€"]},{"title":"Windowsç¨‹åºå¦‚ä½•åˆ é™¤è‡ªèº«","path":"/post/3102005562.html","content":"æœ¬æ–‡ä»‹ç»å‡ ç§å®ç°åœ¨ç¨‹åºé€€å‡ºåï¼Œä»ç£ç›˜åˆ é™¤è‡ªèº« exe æ–‡ä»¶çš„æ–¹å¼ã€‚è¯¥æŠ€æœ¯é€šå¸¸åº”ç”¨äºå®‰è£…åŒ…å¸è½½ç¨‹åºä¸­ã€‚ ä¸€ã€å€Ÿç”¨ choice å‘½ä»¤å®ç°Windows æä¾›äº† choice å‘½ä»¤ï¼Œå…è®¸ç”¨æˆ·ä»é€‰æ‹©åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªé¡¹ç›®å¹¶è¿”å›æ‰€é€‰é¡¹ç›®çš„ç´¢å¼•ã€‚ 1234567891011121314151617181920212223242526272829303132C:\\Users\\akx&gt;choice /?CHOICE [/C choices] [/N] [/CS] [/T timeout /D choice] [/M text]æè¿°: è¯¥å·¥å…·å…è®¸ç”¨æˆ·ä»é€‰æ‹©åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªé¡¹ç›®å¹¶è¿”å›æ‰€é€‰é¡¹ç›®çš„ç´¢å¼•ã€‚å‚æ•°åˆ—è¡¨: /C choices æŒ‡å®šè¦åˆ›å»ºçš„é€‰é¡¹åˆ—è¡¨ã€‚é»˜è®¤åˆ—è¡¨æ˜¯ &quot;YN&quot;ã€‚ /N åœ¨æç¤ºç¬¦ä¸­éšè—é€‰é¡¹åˆ—è¡¨ã€‚æç¤ºå‰é¢çš„æ¶ˆæ¯å¾—åˆ°æ˜¾ç¤ºï¼Œ é€‰é¡¹ä¾æ—§å¤„äºå¯ç”¨çŠ¶æ€ã€‚ /CS å…è®¸é€‰æ‹©åˆ†å¤§å°å†™çš„é€‰é¡¹ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå·¥å…· æ˜¯ä¸åˆ†å¤§å°å†™çš„ã€‚ /T timeout åšå‡ºé»˜è®¤é€‰æ‹©ä¹‹å‰ï¼Œæš‚åœçš„ç§’æ•°ã€‚å¯æ¥å—çš„å€¼æ˜¯ä» 0 åˆ° 9999ã€‚å¦‚æœæŒ‡å®šäº† 0ï¼Œå°±ä¸ä¼šæœ‰æš‚åœï¼Œé»˜è®¤é€‰é¡¹ ä¼šå¾—åˆ°é€‰æ‹©ã€‚ /D choice åœ¨ nnnn ç§’ä¹‹åæŒ‡å®šé»˜è®¤é€‰é¡¹ã€‚å­—ç¬¦å¿…é¡»åœ¨ç”¨ /C é€‰ é¡¹æŒ‡å®šçš„ä¸€ç»„é€‰æ‹©ä¸­; åŒæ—¶ï¼Œå¿…é¡»ç”¨ /T æŒ‡å®š nnnnã€‚ /M text æŒ‡å®šæç¤ºä¹‹å‰è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå·¥å…·åª æ˜¾ç¤ºæç¤ºã€‚ç¤ºä¾‹: CHOICE /? CHOICE /C YNC /M &quot;ç¡®è®¤è¯·æŒ‰ Yï¼Œå¦è¯·æŒ‰ Nï¼Œæˆ–è€…å–æ¶ˆè¯·æŒ‰ Cã€‚&quot; CHOICE /T 10 /C ync /CS /D y CHOICE /C ab /M &quot;é€‰é¡¹ 1 è¯·é€‰æ‹© aï¼Œé€‰é¡¹ 2 è¯·é€‰æ‹© bã€‚&quot; CHOICE /C ab /N /M &quot;é€‰é¡¹ 1 è¯·é€‰æ‹© aï¼Œé€‰é¡¹ 2 è¯·é€‰æ‹© bã€‚&quot; å®ç°æ–¹å¼å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627bool DeleteSelf &#123; wchar_t szSystemDir[MAX_PATH] = &#123;0&#125;; if (GetSystemDirectoryW(szSystemDir, MAX_PATH) &gt; 0) &#123; PathAddBackslashW(szSystemDir); &#125; wchar_t szFullCmd[MAX_PATH] = &#123;0&#125;; StringCchPrintfW(szFullCmd, MAX_PATH, L&quot;%scmd.exe /C choice /C Y /N /D Y /T 4 &amp; rmdir \\&quot;%s\\&quot; /Q&quot;, szSystemDir, szPath); STARTUPINFOW si = &#123;sizeof(STARTUPINFOW)&#125;; PROCESS_INFORMATION pi; if (CreateProcessW(NULL, szFullCmd, NULL, NULL, FALSE, CREATE_NO_WINDOW, NULL, szSystemDir, &amp;si, &amp;pi)) &#123; if (pi.hThread) CloseHandle(pi.hThread); if (pi.hProcess) CloseHandle(pi.hProcess); return true; &#125; return false;&#125;int main() &#123; bool ret = DeleteSelf(); return 0;&#125; äºŒã€ä½¿ç”¨è®¡åˆ’ä»»åŠ¡å®ç°åœ¨ç¨‹åºé€€å‡ºå‰æ·»åŠ  Windows è®¡åˆ’ä»»åŠ¡ï¼Œè®¡åˆ’ä»»åŠ¡åœ¨ç¨‹åºé€€å‡ºå‡ ç§’åæ‰§è¡Œåˆ é™¤æ–‡ä»¶çš„æ“ä½œã€‚ è¿™ç§å®ç°æ–¹å¼éœ€è¦ç¨‹åºå…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚ æ­¤å¤„çœç•¥å…·ä½“çš„å®ç°æ–¹å¼ã€‚","tags":["è¿›ç¨‹","è®¡åˆ’ä»»åŠ¡","choice"],"categories":["Windowsç¼–ç¨‹"]},{"title":"C++æ ‡å‡†åº“çº¿ç¨‹çš„å¯åŠ¨ä¸é€€å‡º","path":"/post/2289160283.html","content":"æœ¬æ–‡ç®€è¦ä»‹ç»C++æ ‡å‡†åº“æä¾›çš„å‡ ç§çº¿ç¨‹æ“ä½œæ–¹æ³•ï¼Œä¸»è¦ä»‹ç»å¦‚ä½•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»ç»“æŸè¿è¡Œã€‚ ä¸€ã€std::threadstd::thread æœªæä¾›åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç»“æŸçš„æ–¹æ³•ã€‚ å¦‚æœçº¿ç¨‹æœªè¿›è¡Œ detach ä¸”æ­¤æ—¶è¯¥çº¿ç¨‹å¤„ç† joinable çŠ¶æ€ï¼Œææ„è¯¥çº¿ç¨‹å¯¹è±¡ä¼šè§¦å‘å¼‚å¸¸ã€‚ 12345678910111213141516171819202122232425262728#include &lt;iostream&gt;#include &lt;thread&gt;std::thread Thread1() &#123; std::thread t = std::thread([]() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(1000)); &#125;); return t;&#125;int main()&#123; std::thread t1 = Thread1(); t1.join(); //ç­‰å¾…çº¿ç¨‹ç»“æŸ std::thread t2 = std::thread([]() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(1000)); &#125;); std::cout &lt;&lt; &quot;thread id:&quot; &lt;&lt; t2.get_id() &lt;&lt; std::endl; std::cout &lt;&lt; &quot;joinable:&quot; &lt;&lt; t2.joinable() &lt;&lt; std::endl; // 1 t2.detach(); std::cout &lt;&lt; &quot;joinable:&quot; &lt;&lt; t2.joinable() &lt;&lt; std::endl; // 0 std::this_thread::sleep_for(std::chrono::milliseconds(2000)); return 0;&#125; äºŒã€std::asyncé€šè¿‡std::asyncå¯ä»¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç»“æŸè¿è¡Œã€‚ 123456789101112131415161718192021#include &lt;iostream&gt;#include &lt;future&gt;int main()&#123; std::future&lt;void&gt; f = std::async(std::launch::async, []() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(1000)); &#125;); bool isRunning = f.valid() &amp;&amp; f.wait_for(std::chrono::milliseconds(0)) == std::future_status::timeout; std::cout &lt;&lt; isRunning &lt;&lt; std::endl; f.wait(); isRunning = f.valid() &amp;&amp; f.wait_for(std::chrono::milliseconds(0)) == std::future_status::timeout; std::cout &lt;&lt; isRunning &lt;&lt; std::endl; return 0;&#125; 2.1 åˆ¤æ–­ std::future æ˜¯å¦ç»“æŸ12bool isRunning = f.valid() &amp;&amp; f.wait_for(std::chrono::milliseconds(0)) == std::future_status::timeout; 2.2 std::shared_futurestd::futureä¸æ”¯æŒèµ‹å€¼æ„é€ ï¼Œéœ€è¦ä½¿ç”¨std::shared_futureã€‚ 12345std::shared_future&lt;void&gt; f1 = std::async(std::launch::async, []() &#123; std::this_thread::sleep_for(std::chrono::milliseconds(1000)); &#125;);std::shared_future&lt;void&gt; f2 = f1;","tags":["C++","å¤šçº¿ç¨‹"],"categories":["C++è¯­è¨€"]},{"title":"åœ¨C++ä¸­ä½¿ç”¨Lamadaè¡¨è¾¾å¼","path":"/post/4208014138.html","content":"Lamada è¡¨è¾¾å¼æ˜¯ C++11 æœ€é‡è¦ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç‰¹æ€§ä¹‹ä¸€ã€‚Lamada æ¥æºäºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚ ä¸€ã€Lamada è¡¨è¾¾å¼å®šä¹‰ä¸‹å›¾å±•ç¤ºå‡ºäº† C++ Lamada è¡¨ç¤ºçš„ç»„æˆéƒ¨åˆ†ï¼š å…¶ä¸­ï¼šâ‘  æŒ‡æ˜æ•è·åˆ—è¡¨ã€‚â‘¡ æŒ‡æ˜å‚æ•°åˆ—è¡¨ã€‚â‘¢ mutableå¯é€‰é¡¹ã€‚å’Œå¸¸è§„çš„ mutable ç”¨æ³•ç±»ä¼¼ï¼Œå³å½“ lamada è¡¨è¾¾å¼å‚æ•°æ˜¯ const æ—¶ï¼Œä½¿ç”¨mutableå¯ä»¥å–æ¶ˆè¿™ç§ constã€‚â‘£ throwå¯é€‰é¡¹ã€‚å¯ä»¥ä½¿ç”¨noexceptæŒ‡æ˜&#x2F;çº¦æŸè¡¨è¾¾å¼å†…ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚â‘¤ æŒ‡å®šè¿”å›ç±»å‹ã€‚â‘¥ Lamada å‡½æ•°ä½“ã€‚ æ ¹æ®ä¸Šå›¾å®šä¹‰ä¸€ä¸ªå®Œæ•´çš„ lamada è¡¨è¾¾å¼ï¼š 1auto f = [](int a) noexcept -&gt; int &#123; return a + 1; &#125;; äºŒã€è¿”å›ç±»å‹å¾ˆå¤šæ—¶å€™ lamada è¡¨è¾¾å¼çš„è¿”å›å€¼ç±»å‹æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®returnè¯­å¥è‡ªåŠ¨æ¨å¯¼å‡ºè¿”å›ç±»å‹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥çœç•¥è¡¨è¾¾å¼çš„è¿”å›å€¼å®šä¹‰ï¼š 1auto x1 = [](int a) &#123;return a + 1&#125;; // OK: return type is int ä½†æ˜¯ï¼Œåˆå§‹åŒ–åˆ—è¡¨ä¸èƒ½ç”¨äºè¿”å›å€¼çš„è‡ªåŠ¨æ¨å¯¼ï¼š 1auto x2 = [](int a) &#123;return &#123;a+1, a+2&#125;; &#125;; // error: æ— æ³•æ¨å¯¼å‡ºè¿”å›å€¼ç±»å‹ ä¸‰ã€æ•è·åˆ—è¡¨lamada è¡¨è¾¾å¼å¯ä»¥é€šè¿‡æ•è·åˆ—è¡¨æ•è·ä¸€å®šèŒƒå›´å†…çš„å˜é‡ï¼š [] ä¸æ•è·ä»»ä½•å˜é‡ã€‚ [&amp;] æŒ‰å¼•ç”¨æ•è·ï¼šæ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰å˜é‡ï¼Œå¹¶ä½œä¸ºå¼•ç”¨åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ã€‚ [=] æŒ‰å€¼æ•è·ï¼šæ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰å˜é‡ï¼Œå¹¶ä½œä¸ºå‰¯æœ¬åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ã€‚ [=, &amp;foo] æŒ‰å€¼æ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰å˜é‡ï¼Œå¹¶æŒ‰å¼•ç”¨æ•è· foo å˜é‡ã€‚ [bar] æŒ‰å€¼æ•è· bar å˜é‡ï¼ŒåŒæ—¶ä¸æ•è·å…¶ä»–å˜é‡ã€‚ [this] æ•è· lamada æ‰€åœ¨çš„å½“å‰ç±»ä¸­çš„thisæŒ‡é’ˆï¼Œè®© lamada è¡¨è¾¾å¼æ‹¥æœ‰å’Œå½“å‰ç±»æˆå‘˜å‡½æ•°åŒæ ·çš„è®¿é—®æƒé™ã€‚å¦‚æœå·²ç»ä½¿ç”¨äº†&amp;æˆ–=ï¼Œå°±é»˜è®¤æ·»åŠ æ­¤é€‰é¡¹ã€‚æ•è· this çš„ç›®çš„æ˜¯å¯ä»¥åœ¨ lamada ä¸­ä½¿ç”¨å½“å‰ç±»çš„æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡ã€‚ å››ã€å¼‚å¸¸çº¦æŸå¯ä»¥ä½¿ç”¨noexceptæ¥æŒ‡å®šå’Œçº¦æŸ Lamada è¡¨è¾¾å†…ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿç¼–è¯‘è­¦å‘Šã€‚ 123456// throw_lambda_expression.cpp// compile with: /W4 /EHscint main() // äº§ç”Ÿç¼–è¯‘è­¦å‘ŠC4297&#123; []() noexcept &#123; throw 5; &#125;();&#125; äº”ã€mutableæ­£å¸¸æƒ…å†µä¸‹ï¼ŒæŒ‰å€¼æ•è·çš„å˜é‡ï¼Œå…¶å€¼åœ¨ Lamada è¡¨è¾¾å¼å†…æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼ˆéµå¾ªconst-by-valueï¼‰ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç¼–è¯‘ä¼šæŠ¥é”™ï¼š 123456 int n = 1;auto fuc = [n]() &#123; n = 2;&#125;;// error C3491: â€œnâ€: æ— æ³•åœ¨éå¯å˜ lambda ä¸­ä¿®æ”¹é€šè¿‡å¤åˆ¶æ•è· å¯ä»¥ä½¿ç”¨mutableå…³é”®å­—æ”¹å˜è¿™ç§è¡Œä¸ºï¼š 123456int n = 1;auto fuc = [n]() mutable &#123; n = 2;&#125;;printf(&quot;%d&quot;, n); // 1 è™½ç„¶åœ¨ Lamada è¡¨è¾¾å¼å†…å¯ä»¥ä¿®æ”¹nçš„å€¼ï¼Œä½†nä»æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œå› æ­¤å¤–éƒ¨nçš„å€¼æ²¡æœ‰è¢«æ”¹å˜ã€‚ å‚è€ƒï¼šhttps://msdn.microsoft.com/en-us/library/dd293608.aspx","tags":["C++","Lamada"],"categories":["C++è¯­è¨€"]},{"title":"NSISæ•™ç¨‹(12)-å¼€æºUIæ’ä»¶","path":"/post/2584392152.html","content":"ä¸€ã€é¡¹ç›®ä»‹ç»ä»‹ç»ä¸€ä¸ªæˆ‘å¼€å‘çš„å¼€æºNSIS UIæ’ä»¶ NSIS-UI-Pluginï¼ŒåŸºäº NSIS-UI-Plugin æ’ä»¶æˆ‘ä»¬å¯ä»¥å¿«é€Ÿä½¿ç”¨NSISåˆ¶ä½œç±»ä¼¼QQç­‰è½¯ä»¶é‚£æ ·çš„å®‰è£…åŒ…ã€‚ è¯¥æ’ä»¶é»˜è®¤ä½¿ç”¨Qtä½œä¸ºç•Œé¢åº“ï¼ˆä¸éœ€è¦ç¼–è¯‘Qté™æ€åº“ï¼Œå¯ä»¥ä½¿ç”¨QtåŠ¨æ€åº“ï¼‰ï¼Œä½†ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ‡æ¢ä½¿ç”¨å…¶ä»–ç•Œé¢åº“ï¼Œå¦‚DuiLibç­‰ã€‚ é¡¹ç›®åœ°å€ï¼š https://github.com/winsoft666/NSIS-UI-Plugin äºŒã€ä¾èµ–é¡¹ä½¿ç”¨NSIS-UI-Pluginæ’ä»¶éœ€è¦æå‰å®‰è£…å¦‚ä¸‹å·¥å…·ã€‚ 2.1 NSISä»https://nsis.sourceforge.io/Download ä¸‹è½½NSISå¹¶å®‰è£…ï¼Œæ–°å¢ç³»ç»Ÿç¯å¢ƒå˜é‡NSIS_DIRä¸ºNSISå®‰è£…ç›®å½•ã€‚ 2.2 Pythonä¹‹æ‰€ä»¥éœ€è¦å®‰è£…Pythonï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‰§è¡ŒNsisScriptGenerate.pyè„šæœ¬ã€‚ å°†Python.exeæ‰€åœ¨ç›®å½•æ·»åŠ åˆ°Pathç¯å¢ƒå˜é‡ã€‚ 2.3 Qtå› ä¸ºæ’ä»¶é»˜è®¤ä½¿ç”¨Qtä½œä¸ºç•Œé¢åº“ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…Qtã€‚ Qtå®‰è£…åŒ…ä¼šé»˜è®¤å°†å®‰è£…ç›®å½•æ·»åŠ QTDIRç¯å¢ƒå˜é‡ï¼Œå¦‚æœæ²¡æœ‰è‡ªåŠ¨æ·»åŠ ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚ ä¸‰ã€å¼€å§‹ä½¿ç”¨3.1 ç¼–è¯‘NSIS-UI-Pluginå®‰è£…å®Œä¸Šé¢ä¾èµ–é¡¹ä¹‹åï¼Œç¼–è¯‘NSIS-UI-Plugin\\NSIS-UI-Plugin.vcxprojå·¥ç¨‹ï¼ŒVisual Studioçš„ç”Ÿæˆåäº‹ä»¶ä¼šè‡ªåŠ¨å°†ç›®æ ‡æ–‡ä»¶ï¼ˆDebugç‰ˆï¼šnsQtPluginD.dllï¼Œ Releaseç‰ˆï¼šnsPlugin.dllï¼‰æ‹·è´åˆ°NSISæ’ä»¶ç›®å½•ï¼ˆNSIS_DIR\\Plugins\\x86-unicodeï¼‰ã€‚ 3.2 ç”Ÿæˆå®‰è£…åŒ…VimeoSetupæ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•åœ¨NSISä¸­ä½¿ç”¨è¯¥æ’ä»¶çš„ç¤ºä¾‹å·¥ç¨‹ï¼š 12345App -- æ”¾ç½®éœ€è¦æ‰“åŒ…åˆ°å®‰è£…åŒ…ä¸­çš„æ–‡ä»¶VCRuntimeDLL -- æ”¾ç½®VC++è¿è¡Œæ—¶åº“æ–‡ä»¶ï¼ˆDebugç‰ˆå’ŒReleaseç‰ˆï¼‰ï¼ŒQtç•Œé¢åº“é»˜è®¤é‡‡ç”¨MDæ¨¡å¼ç¼–è¯‘ï¼Œè¿è¡Œæ—¶éœ€è¦ä¾èµ–VC++è¿è¡Œæ—¶åº“vimeo-template.nsi -- NSISæ¨¡æ¿æ–‡ä»¶ï¼Œæ–‡ä»¶åçš„`-template`åç¼€å›ºå®šçš„ï¼ŒNsisScriptGenerate.pyä¼šæ ¹æ®è¯¥æ¨¡æ¿ç”Ÿæˆvimeo.nsibuild-setup [debug].bat -- ç”ŸæˆDebugç‰ˆçš„å®‰è£…åŒ…ï¼Œå³ä½¿ç”¨Debugç‰ˆçš„Qtå’ŒNSIS-UI-Pluginbuild-setup [debug].bat -- ç”ŸæˆReleaseç‰ˆçš„å®‰è£…åŒ… å°†éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶æ”¾ç½®åˆ°Appç›®å½•ï¼Œç„¶åè¿è¡Œbuild-setup.batç”Ÿæˆå®‰è£…åŒ…ã€‚ NsisScriptGenerate.pyè„šæœ¬åŠŸèƒ½ï¼šå› ä¸ºNSISæ²¡æœ‰æä¾›è·å–æ–‡ä»¶é‡Šæ”¾è¿›åº¦çš„åŠŸèƒ½ï¼Œæ‰€ä»¥NsisScriptGenerate.pyéå†Appç›®å½•ï¼Œé‡‡ç”¨Fileå‘½ä»¤æŒ¨ä¸ªæ·»åŠ æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨æ’ä»¶æ¥å£SetInstallStepDescriptioné€šçŸ¥å®‰è£…è¯¦æƒ…ã€‚ å››ã€æˆªå›¾ä»…ç”¨ä½œç¤ºä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»æ„ç•Œé¢åº“æ¥åˆ›å»ºä»»æ„çš„å®‰è£…&#x2F;å¸è½½ç•Œé¢ã€‚","tags":["NSIS"],"categories":["NSIS"]},{"title":"Windowsç”¨æˆ·ç•Œé¢ç‰¹æƒéš”ç¦»(UIPI)","path":"/post/2701401097.html","content":"åœ¨æ—©æœŸçš„ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œåœ¨åŒä¸€ç”¨æˆ·ä¸‹è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹æœ‰ç€ç›¸åŒçš„å®‰å…¨ç­‰çº§ï¼Œæ‹¥æœ‰ç›¸åŒçš„æƒé™ã€‚æ­¤æ—¶è¿›ç¨‹å¯ä»¥è‡ªç”±åœ°å‘é€Windows æ¶ˆæ¯åˆ°å…¶ä»–è¿›ç¨‹çš„çª—å£ã€‚ ä» Windows Vista å¼€å§‹ï¼Œå¯¹äºæŸäº› Windows æ¶ˆæ¯ï¼Œè¿™ä¸€æ–¹å¼å†ä¹Ÿè¡Œä¸é€šäº†ï¼Œè¿›ç¨‹ï¼ˆæˆ–è€…å…¶ä»–çš„å¯¹è±¡ï¼‰å¼€å§‹æ‹¥æœ‰ä¸€ä¸ªæ–°çš„å±æ€§â€“ç‰¹æƒç­‰çº§(Privilege Level)ã€‚æ­¤æ—¶ä¸€ä¸ªç‰¹æƒç­‰çº§è¾ƒä½çš„è¿›ç¨‹ä¸å†å¯ä»¥å‘ç‰¹æƒç­‰çº§è¾ƒé«˜çš„è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œå³ä¾¿ä»–ä»¬åœ¨ç›¸åŒçš„ç”¨æˆ·æƒé™ä¸‹è¿è¡Œä¹Ÿä¸è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç”¨æˆ·ç•Œé¢ç‰¹æƒéš”ç¦»(User Interface Privilege Isolation, ç®€ç§° UIPI)ã€‚ å¼•å…¥ UIPI çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ¶æ„ç¨‹åºå‘é€æ¶ˆæ¯ç»™é‚£äº›æ‹¥æœ‰è¾ƒé«˜æƒé™çš„çª—å£ï¼Œä»è€Œåˆ©ç”¨è¯¥è¿›ç¨‹çš„é«˜æƒé™è¾¾åˆ°æŸç§ç›®çš„ç­‰ç­‰ã€‚ ä¸€ã€UIPI çš„è¿è¡Œæœºåˆ¶åœ¨ Windows 7 ä¸­ï¼Œå½“ UAC(User Account Control)å¯ç”¨çš„æ—¶å€™ï¼ŒUIPI çš„è¿è¡Œå¯ä»¥å¾—åˆ°æœ€æ˜æ˜¾çš„ä½“ç°ã€‚åœ¨ UAC ä¸­ï¼Œå½“ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ç™»å½•ç³»ç»Ÿåï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºä¸¤ä¸ªä»¤ç‰Œå¯¹è±¡(Token Object)ï¼šä¸€ä¸ªæ˜¯ç®¡ç†å‘˜ä»¤ç‰Œï¼Œæ‹¥æœ‰å¤§å¤šæ•°ç‰¹æƒ(ç±»ä¼¼äº Windows Vista ä¹‹å‰çš„ System ä¸­çš„ç”¨æˆ·)ï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ç»è¿‡è¿‡æ»¤åçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œåªæ‹¥æœ‰æ™®é€šç”¨æˆ·çš„æƒé™ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä»¥æ™®é€šç”¨æˆ·æƒé™å¯åŠ¨çš„è¿›ç¨‹æ‹¥æœ‰æ™®é€šç‰¹æƒç­‰çº§ã€UIPI çš„ç­‰çº§åˆ’åˆ†ä¸ºä½ç­‰çº§(low)ï¼Œæ™®é€š(normal)ï¼Œé«˜ç­‰çº§(high)ï¼Œç³»ç»Ÿ(system)ã€‘ã€‚åŒæ ·çš„ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œçš„è¿›ç¨‹ï¼ˆä¾‹å¦‚ç”¨æˆ·å³é”®å•å‡»é€‰æ‹©â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€æˆ–è€…æ˜¯é€šè¿‡æ·»åŠ â€œrunasâ€å‚æ•°è°ƒç”¨ ShellExecute è¿è¡Œçš„è¿›ç¨‹ï¼‰æ‹¥æœ‰é«˜(high)ç‰¹æƒç­‰çº§ã€‚ ç³»ç»Ÿä¸­ä¼šè¿è¡Œå¤šç§ä¸åŒç±»å‹ã€ä¸åŒç‰¹æƒç­‰çº§çš„è¿›ç¨‹(å½“ç„¶ï¼Œä»æŠ€æœ¯ä¸Šè®²è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜¯åœ¨åŒä¸€ç”¨æˆ·ä¸‹)ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Windows Sysinternalså·¥å…·é›†ä¸­çš„Process ExploreræŸ¥çœ‹å„ä¸ªè¿›ç¨‹çš„ç‰¹æƒç­‰çº§ã€‚ æ‰€ä»¥ï¼Œå½“å‘ç°è¿›ç¨‹ä¹‹é—´ Windows æ¶ˆæ¯é€šä¿¡å‘ç”Ÿé—®é¢˜æ—¶ï¼Œä¸å¦¨ä½¿ç”¨Process ExploreræŸ¥çœ‹ä¸€ä¸‹ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯å¦æœ‰åˆé€‚çš„ç‰¹æƒç­‰çº§ã€‚ äºŒã€UIPI æ‰€å¸¦æ¥çš„é™åˆ¶æ­£å¦‚æˆ‘ä»¬å‰æ–‡æ‰€è¯´ï¼Œç­‰çº§çš„åˆ’åˆ†ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä»¥ä¸‹çŠ¯ä¸Šã€‚æ‰€ä»¥ï¼Œæœ‰äº†ç”¨æˆ·ç•Œé¢ç‰¹æƒéš”ç¦»ï¼Œä¸€ä¸ªè¿è¡Œåœ¨è¾ƒä½ç‰¹æƒç­‰çº§çš„åº”ç”¨ç¨‹åºçš„è¡Œä¸ºå°±å—åˆ°äº†è¯¸å¤šé™åˆ¶ï¼Œå®ƒä¸å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š éªŒè¯ç”±è¾ƒé«˜ç‰¹æƒç­‰çº§è¿›ç¨‹åˆ›å»ºçš„çª—å£å¥æŸ„ é€šè¿‡è°ƒç”¨ SendMessage å’Œ PostMessage å‘ç”±è¾ƒé«˜ç‰¹æƒç­‰çº§è¿›ç¨‹åˆ›å»ºçš„çª—å£å‘é€ Windows æ¶ˆæ¯ ä½¿ç”¨çº¿ç¨‹é’©å­å¤„ç†è¾ƒé«˜ç‰¹æƒç­‰çº§è¿›ç¨‹ ä½¿ç”¨æ™®é€šé’©å­(SetWindowsHookEx)ç›‘è§†è¾ƒé«˜ç‰¹æƒç­‰çº§è¿›ç¨‹ å‘ä¸€ä¸ªè¾ƒé«˜ç‰¹æƒç­‰çº§è¿›ç¨‹æ‰§è¡Œ DLL æ³¨å…¥ ä½†æ˜¯ï¼Œä¸€äº›ç‰¹æ®Š Windows æ¶ˆæ¯æ˜¯è¢«å®¹è®¸çš„ï¼Œå› ä¸ºè¿™äº›æ¶ˆæ¯å¯¹è¿›ç¨‹çš„å®‰å…¨æ€§æ²¡æœ‰å¤ªå¤§å½±å“ã€‚è¿™äº› Windows æ¶ˆæ¯åŒ…æ‹¬ï¼š 123456789101112 0x000 - WM_NULL 0x003 - WM_MOVE 0x005 - WM_SIZE 0x00D - WM_GETTEXT 0x00E - WM_GETTEXTLENGTH 0x033 - WM_GETHOTKEY 0x07F - WM_GETICON 0x305 - WM_RENDERFORMAT 0x308 - WM_DRAWCLIPBOARD 0x30D - WM_CHANGECBCHAIN 0x31A - WM_THEMECHANGED 0x313, 0x31B (WM_???) ä¸‰ã€ä¿®å¤ UIPI é—®é¢˜åŸºäº Windows Vista ä¹‹å‰çš„æ“ä½œç³»ç»Ÿè¡Œä¸ºæ‰€è®¾è®¡çš„åº”ç”¨ç¨‹åºï¼Œå¯èƒ½å¸Œæœ› Windows æ¶ˆæ¯èƒ½å¤Ÿåœ¨è¿›ç¨‹ä¹‹é—´è‡ªç”±çš„ä¼ é€’ä»¥å®Œæˆä¸€äº›ç‰¹æ®Šçš„å·¥ä½œã€‚å½“è¿™äº›åº”ç”¨ç¨‹åºåœ¨ Windows 7&#x2F;10&#x2F;11 ä¸Šè¿è¡Œæ—¶ï¼Œå› ä¸º UIPI æœºåˆ¶çš„å­˜åœ¨ï¼Œè¿™ç§æ¶ˆæ¯ä¼ é€’è¢«é˜»æ–­äº†ï¼Œåº”ç”¨ç¨‹åºå°±ä¼šé‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒWindows Vista å¼•å…¥äº†æ–°çš„ API å‡½æ•°ChangeWindowMessageFilterå’ŒChangeWindowMessageFilterExã€‚åœ¨ç‰¹æƒç­‰çº§è¾ƒé«˜çš„è¿›ç¨‹ä¸­åˆ©ç”¨è¿™ 2 ä¸ªå‡½æ•°å¯ä»¥æ·»åŠ æˆ–è€…åˆ é™¤èƒ½å¤Ÿé€šè¿‡ç‰¹æƒç­‰çº§éš”ç¦»çš„ Windows æ¶ˆæ¯ã€‚è¿™å°±åƒæ‹¥æœ‰è¾ƒé«˜ç‰¹æƒç­‰çº§çš„è¿›ç¨‹è®¾ç½®äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¢«å…è®¸é€šè¿‡çš„ Windows æ¶ˆæ¯éƒ½å°†è¢«æ·»åŠ åˆ°è¿™ä¸ªè¿‡æ»¤å™¨çš„ç™½åå•ï¼Œåªæœ‰åœ¨è¿™ä¸ªç™½åå•ä¸Šçš„æ¶ˆæ¯æ‰å…è®¸ä¼ é€’è¿›æ¥ã€‚ ä¸‹é¢å¯¹æ·»åŠ &#x2F;ç§»é™¤ç™½åå•åŠŸèƒ½è¿›è¡Œäº†ç®€å•å°è£…ï¼ˆUIPIMsgFilterå‡½æ•°ï¼‰ï¼Œè¯¥å‡½æ•°å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„çª—ä½“æ·»åŠ ã€ç§»é™¤æ¶ˆæ¯ç™½åå•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142BOOL UIPIMsgFilter(HWND hWnd, UINT uMessageID, BOOL bAllow) &#123; OSVERSIONINFO VersionTmp; VersionTmp.dwOSVersionInfoSize = sizeof(OSVERSIONINFO); GetVersionEx(&amp;VersionTmp); BOOL res = FALSE; if (VersionTmp.dwMajorVersion &gt;= 6) &#123; // vista above. BOOL(WINAPI * pfnChangeMessageFilterEx)(HWND, UINT, DWORD, PCHANGEFILTERSTRUCT); BOOL(WINAPI * pfnChangeMessageFilter)(UINT, DWORD); CHANGEFILTERSTRUCT filterStatus; filterStatus.cbSize = sizeof(CHANGEFILTERSTRUCT); HINSTANCE hlib = LoadLibrary(_T(&quot;user32.dll&quot;)); if (hlib != NULL) &#123; (FARPROC &amp;)pfnChangeMessageFilterEx = GetProcAddress(hlib, &quot;ChangeWindowMessageFilterEx&quot;); if (pfnChangeMessageFilterEx != NULL &amp;&amp; hWnd != NULL) &#123; res = pfnChangeMessageFilterEx(hWnd, uMessageID, (bAllow ? MSGFLT_ADD : MSGFLT_REMOVE), &amp;filterStatus); &#125; // If failed, try again. if (!res) &#123; (FARPROC &amp;)pfnChangeMessageFilter = GetProcAddress(hlib, &quot;ChangeWindowMessageFilter&quot;); if (pfnChangeMessageFilter != NULL) &#123; res = pfnChangeMessageFilter(uMessageID, (bAllow ? MSGFLT_ADD : MSGFLT_REMOVE)); &#125; &#125; &#125; if (hlib != NULL) &#123; FreeLibrary(hlib); &#125; &#125; else &#123; res = TRUE; &#125; return res;&#125; æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["UIPI"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowsæ³¨å†ŒURLåè®®","path":"/post/1343547595.html","content":"å½“ç”µè„‘å®‰è£…å®Œ Steam åï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®steam://run/123ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æç¤ºæ‰“å¼€ Steam ç¨‹åºã€‚ç±»ä¼¼çš„åŠŸèƒ½åœ¨è¿…é›·ã€QQ ç­‰äº§å“ä¸Šä¹Ÿéƒ½æœ‰ä½¿ç”¨ï¼Œæœ¬æ–‡è®²è¿°å¦‚ä½•å®ç°è¯¥åŠŸèƒ½ã€‚ å®ç°ä¸Šè¿°åŠŸèƒ½åªéœ€è¦åœ¨æ³¨å†Œè¡¨HKEY_CLASSES_ROOTé¡¹ä¸‹æ·»åŠ å¯¹åº”çš„å­é¡¹å³å¯ï¼Œä»¥æ³¨å†Œteståè®®ä¸ºä¾‹ï¼š 123456789101112131415Windows Registry Editor Version 5.00[HKEY_CLASSES_ROOT\\test]@=&quot;URL:test protocol&quot;&quot;URL Protocol&quot;=&quot;&quot;[HKEY_CLASSES_ROOT\\test\\DefaultIcon]@=&quot;mytest.exe&quot;[HKEY_CLASSES_ROOT\\test\\Shell][HKEY_CLASSES_ROOT\\test\\Shell\\Open][HKEY_CLASSES_ROOT\\test\\Shell\\Open\\Command]@=&quot;\\&quot;D:\\\\sourcecode\\\\mytest.exe\\&quot; -- \\&quot;%1\\&quot;&quot; ä¿®æ”¹å®Œä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥test://start/123å°±å¯ä»¥æ‰“å¼€D:\\\\sourcecode\\\\mytest.exeï¼Œå¹¶ä¸”ä¼ é€’ç»™mytest.exeçš„å‘½ä»¤è¡Œå‚æ•°ä¸ºtest://start/123ã€‚","tags":["URLåè®®"],"categories":["Windowsç¼–ç¨‹"]},{"title":"ç¼–è¯‘å™¨åŸºç¡€æ¦‚å¿µ","path":"/post/3064318708.html","content":"ä¸€ã€C++ä»£ç ç¼–è¯‘æµç¨‹ä»¥ä¸‹é¢ C++ä»£ç ä¸ºä¾‹ï¼š 1234567#include &lt;stdio.h&gt;â€‹int main()&#123; printf(&quot;Hello World&quot;); return 0;&#125; ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ç»è¿‡å¦‚ä¸‹ 4 ä¸ªè¿‡ç¨‹ï¼š é¢„ç¼–è¯‘ï¼šå°† hello.c å’Œ stdio.h é¢„ç¼–è¯‘ä¸º hello.i ç¼–è¯‘ï¼šå°† hello.i ç¼–è¯‘ä¸º hello.s æ±‡ç¼–ï¼šå°† hello.s ç¿»è¯‘ä¸ºæœºå™¨æŒ‡ä»¤ hello.oï¼ˆ.o ç›®æ ‡æ–‡ä»¶ï¼‰ é“¾æ¥ï¼šé“¾æ¥å„ç§éœ€è¦çš„åº“å’Œå…¶ä»–ç›®æ ‡æ–‡ä»¶ï¼ˆè¯¥ hello ç¨‹åºä¸éœ€è¦ï¼‰å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ hello.outï¼ˆç›¸å½“äº windows çš„.exeï¼‰ã€‚ äºŒã€ç¼–è¯‘å™¨æ¶æ„ç¼–è¯‘å™¨é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š å‰ç«¯ï¼ˆFrontEndï¼‰ ä¼˜åŒ–å™¨ï¼ˆOptimizerï¼‰ åç«¯ï¼ˆBackEndï¼‰ åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå‰ç«¯ä¸»è¦è´Ÿè´£è¯æ³•å’Œè¯­æ³•åˆ†æï¼Œå°†æºä»£ç è½¬åŒ–ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼›ä¼˜åŒ–å™¨åˆ™æ˜¯åœ¨å‰ç«¯çš„åŸºç¡€ä¸Šï¼Œå¯¹å¾—åˆ°çš„ä¸­é—´ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ä»£ç æ›´åŠ é«˜æ•ˆï¼›åç«¯åˆ™æ˜¯å°†å·²ç»ä¼˜åŒ–çš„ä¸­é—´ä»£ç è½¬åŒ–ä¸ºé’ˆå¯¹å„è‡ªå¹³å°çš„æœºå™¨ä»£ç ã€‚ 2.1 GCCGCC(GNU Compiler Collectionï¼ŒGNU ç¼–è¯‘å™¨é›†åˆ)æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘å™¨ï¼ŒåŒ…å« FrontEndã€Optimizer å’Œ BackEndã€‚ 2.2 LLVM æ¶æ„Clangæ˜¯ LLVM ç¼–è¯‘å™¨æ¶æ„çš„å‰ç«¯ï¼Œå¯ä»¥ç”¨æ¥ç¼–è¯‘ Cï¼ŒC++ï¼ŒObjectiveC ç­‰è¯­è¨€ï¼› LLVMæ˜¯è¯¥æ¶æ„çš„ä¼˜åŒ–å™¨å’Œåç«¯ï¼› äºŒè€…ç»Ÿç§°ä¸º LLVM æ¶æ„ã€‚ ä¸‰ã€ç¼–è¯‘ç‰ˆæœ¬é€‰æ‹©3.1 x86ã€x86-64ã€AMD64x86 æ˜¯æŒ‡ Intel çš„å¼€å‘çš„ä¸€ç§ 32 ä½æŒ‡ä»¤é›†ï¼Œä» 386 æ—¶ä»£å¼€å§‹ï¼Œä¸€ç›´æ²¿ç”¨è‡³ä»Šï¼Œæ‰€æœ‰ Intel æ—©æœŸçš„ cpuï¼Œä»¥åŠ amd æ—©æœŸçš„ cpu éƒ½æ”¯æŒè¿™ç§æŒ‡ä»¤é›†ã€‚ AMD é¢†å…ˆ Intel åˆ¶é€ å‡ºå…¼å®¹ x86 çš„å•†ç”¨ CPUï¼ŒAMD ç§°ä¹‹ä¸º AMD64ï¼Œä¸”å¾—åˆ°ç”¨æˆ·çš„è®¤åŒã€‚ Intel é€‰æ‹©è®¾è®¡äº†ä¸€ç§ä¸å…¼å®¹ x86 çš„å…¨æ–° 64 ä½æŒ‡ä»¤é›†ï¼Œç§°ä¹‹ä¸º IA-64ã€‚ç”±äºæ˜¯å…¨æ–°è®¾è®¡çš„ CPUï¼Œæ²¡æœ‰ç¼–è¯‘å™¨ã€ä¸æ”¯æŒ Windowsï¼Œåæ¥ä¸å¾—ä¸åœ¨æ—¶æœºè½åçš„æƒ…å†µä¸‹ä¹Ÿå¼€å§‹æ”¯æŒ AMD64 æŒ‡ä»¤é›†ã€‚å› æ­¤æ¢äº†ä¸ªåå­—å« x86_64ï¼Œè¡¨ç¤º x86 æŒ‡ä»¤é›†çš„ 64 ä½æ‰©å±•ã€‚ x86_64ã€x64ã€AMD64 åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬ç°åœ¨ç”¨çš„ intel&#x2F;amd çš„æ¡Œé¢çº§ CPU åŸºæœ¬ä¸Šéƒ½æ˜¯ x86_64ã€‚ 3.2 i386i386 å³ Intel 80386ã€‚ å…¶å® i386 é€šå¸¸è¢«ç”¨æ¥ä½œä¸ºå¯¹ Intelï¼ˆè‹±ç‰¹å°”ï¼‰32 ä½å¾®å¤„ç†å™¨çš„ç»Ÿç§°ã€‚ ä½†æ˜¯ç›®å‰æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¬è®¤ i386 ä¸º 32 ä½ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯ x86ã€‚ 3.3 i686i686 ä»ç„¶å±äº i386 ä½“ç³»ï¼Œä¸è¿‡ç›¸å¯¹äº 386 CPU çš„ç‰¹æ€§ä½œäº†æŒ‡ä»¤ä¼˜åŒ–ã€‚ 3.4 MSVC ç¼–è¯‘å™¨ç‰ˆæœ¬æè¿° x86ï¼šç¼–è¯‘å™¨ä¸º x86 ç‰ˆæœ¬ï¼Œè¾“å‡ºæ–‡ä»¶ä¸º x86ã€‚ amd64_x86ï¼šç¼–è¯‘å™¨ä¸º amd64 ç‰ˆæœ¬ï¼Œè¾“å‡ºæ–‡ä»¶ä¸º x86ã€‚ amd64ï¼šç¼–è¯‘å™¨ä¸º amd64 ç‰ˆæœ¬ï¼Œè¾“å‡ºæ–‡ä»¶ä¸º amd64ã€‚ x86_amd64ï¼šç¼–è¯‘å™¨ä¸º x86 ç‰ˆæœ¬ï¼Œè¾“å‡ºæ–‡ä»¶ä¸º amd64ã€‚","tags":["C++","LLVM","ç¼–è¯‘å™¨","GCC"],"categories":["C++è¯­è¨€"]},{"title":"QWidgetå­ç±»æ— æ³•åº”ç”¨QSSæ ·å¼çš„é—®é¢˜","path":"/post/10890071.html","content":"è¿™æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œåœ¨ä½¿ç”¨Qtè¿›è¡Œç•Œé¢å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç»§æ‰¿è‡ªQWidgetæ¥å®ç°è‡ªå®šä¹‰æ§ä»¶ï¼ˆå½“ç„¶è¿™é‡Œè¯´çš„æ˜¯éé¡¶çº§çª—å£ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å‘ç°åœ¨è¯¥è‡ªå®šä¹‰æ§ä»¶ä¸Šåº”ç”¨QSSæ ·å¼ä¼šæ— æ•ˆã€‚ å¯¼è‡´è¿™ä¸ªé—®é¢˜çš„ä¸»è¦åŸå› æ˜¯QWidgetçš„paintEventå‡½æ•°å®ç°ä¸ºç©ºï¼Œæœªåšä»»ä½•ç»˜åˆ¶ï¼Œä¹Ÿæ²¡æœ‰å¯¹æ ·å¼è¡¨è¿›è¡Œåˆå§‹åŒ–å’Œç»˜åˆ¶ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š 123void QWidget::paintEvent(QPaintEvent *)&#123;&#125; è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨QWidgetå­ç±»çš„paintEventå‡½æ•°ä¸­åˆå§‹åŒ–å¹¶ç»˜åˆ¶æ ·å¼è¡¨ï¼š 123456void CustomWidget::paintEvent(QPaintEvent* e) &#123; QStyleOption opt; opt.init(this); QPainter p(this); style()-&gt;drawPrimitive(QStyle::PE_Widget, &amp;opt, &amp;p, this);&#125; å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨å˜é€šçš„æ–¹æ³•ï¼Œæ”¹ä¸ºç»§æ‰¿è‡ªQFrameï¼Œå› ä¸ºQFrameé»˜è®¤åˆå§‹åŒ–å’Œç»˜åˆ¶äº†æ ·å¼è¡¨ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617void QFrame::paintEvent(QPaintEvent *)&#123; QPainter paint(this); drawFrame(&amp;paint);&#125;/*! \\internal Used by QLabel and QLCDNumber */void QFrame::drawFrame(QPainter *p)&#123; QStyleOptionFrame opt; initStyleOption(&amp;opt); style()-&gt;drawControl(QStyle::CE_ShapedFrame, &amp;opt, p, this);&#125;","tags":["Qt","QSS"],"categories":["Qt"]},{"title":"C++çš„APIè®¾è®¡è§„èŒƒ","path":"/post/128186902.html","content":"ã€ŠC++ API è®¾è®¡ã€‹æ˜¯ä¸€æœ¬éå¸¸ä¸é”™çš„ä¹¦ï¼Œè¯¥ä¹¦å†…å®¹è¿œè¿œè¶…è¿‡äº†å®ƒæ ‡é¢˜æ‰€æŒ‡çš„ C++ API è®¾è®¡ï¼Œå®ƒä¸ä»…ä»…è®²è¿°äº†ä¸ç¼–ç¨‹è¯­è¨€æ— å…³çš„ API è®¾è®¡éœ€è¦éµå¾ªçš„ä¸€äº›è§„èŒƒï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº†å¾ˆå¤š C++å¼€å‘ä¸­éœ€è¦éµå®ˆä¸€äº›å‡†åˆ™ï¼Œå¦‚æœåœ¨å¼€å‘ä¸­èƒ½éµå¾ªè¿™äº›å‡†åˆ™ï¼Œå°†æœ‰åˆ©äºæˆ‘ä»¬å†™å‡ºé«˜è´¨é‡çš„ä»£ç ã€‚ è¯»ç½¢è¯¥ä¹¦ï¼Œå—ç›ŠåŒªæµ…ï¼Œæœ¬æ–‡å°†è¯¥ä¹¦ä¸­æˆ‘è®¤ä¸ºæ¯”è¾ƒå—ç”¨çš„éƒ¨åˆ†æ‘˜å½•ä¸‹æ¥ã€‚ åªæœ‰ä¸¤ç§ç¼–ç¨‹è¯­è¨€ï¼šä¸€ç§æ˜¯å¤©å¤©æŒ¨éª‚çš„ï¼Œå¦ä¸€ç§æ˜¯æ²¡äººç”¨çš„ã€‚ è‰¯å¥½çš„ API è®¾è®¡çš„é¦–è¦ç›®æ ‡æ˜¯ï¼šåœ¨ä¸ºå®¢æˆ·æä¾›æ‰€éœ€åŠŸèƒ½çš„å‰æä¸‹ï¼Œä½¿ç”¨æ–°å‘å¸ƒçš„ API å¯¹å®¢æˆ·çš„ä»£ç é€ æˆçš„å½±å“åº”è¯¥æœ€å°ï¼Œç†æƒ³çš„æƒ…å†µä¸‹åº”è¯¥æ˜¯é›¶å½±å“ã€‚ C++ æ²¡æœ‰åŒ…ç§æœ‰çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä½¿ç”¨æ›´åŠ å®½æ³›çš„å‹å…ƒçš„æ¦‚å¿µï¼Œä»¥å…è®¸æŒ‡å®šçš„ç±»å’Œæ–¹æ³•è®¿é—®æŸä¸ªç±»çš„å—ä¿æŠ¤çš„å’Œç§æœ‰çš„æˆå‘˜ã€‚è™½ç„¶å‹å…ƒå¯ä»¥ç”¨æ¥åŠ å¼ºå°è£…ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒä¼šå‘ç”¨æˆ·æš´éœ²è¿‡å¤šçš„å†…éƒ¨ç»†èŠ‚ã€‚ ç±»çš„æ•°æ®æˆå‘˜åº”è¯¥å§‹ç»ˆå£°æ˜ä¸ºç§æœ‰çš„ï¼Œè€Œä¸æ˜¯å…¬æœ‰çš„æˆ–å—ä¿æŠ¤çš„ã€‚ ç±»åªåº”è¯¥å®šä¹‰åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯æ€ä¹ˆåšã€‚ä¸è¦å°†æŸä¸€ä¸ªåŠŸèƒ½çš„å…·ä½“å®ç°æ­¥éª¤æš´éœ²å‡ºæ¥ï¼Œå³ä¾¿å®šä¹‰ä¸ºç§æœ‰çš„ï¼Œä¹Ÿå°½é‡ä¸è¦è¿™æ ·åšã€‚å¯ä»¥ä½¿ç”¨PimplæŠ€å·§æ¥å°†æ‰€æœ‰çš„ç§æœ‰æ•°æ®æˆå‘˜å’Œå‡½æ•°éš”ç¦»åˆ°ä¸€ä¸ª.cpp æ–‡ä»¶ä¸­ç‹¬ç«‹å®ç°çš„ç±»æˆ–ç»“æ„ä½“å†…ã€‚ ä¸è¦è¿‡åº¦æ‰¿è¯ºã€‚å½“ä¸ç¡®å®šæ˜¯å¦éœ€è¦æŸä¸ªæ¥å£æ—¶ï¼Œå°±ä¸è¦æä¾›æ­¤æ¥å£ã€‚è°¨è®°å¥¥å¡å§†ï¼ˆOccamï¼‰å‰ƒåˆ€åŸç†ï¼šè‹¥æ— å¿…è¦ï¼Œå‹¿å¢å®ä½“ã€‚ è°¨æ…æ·»åŠ è™šå‡½æ•°ï¼Œä½¿ç”¨è™šå‡½æ•°è¦æ„è¯†åˆ°å…¶æ½œåœ¨çš„éšæ‚£ï¼š å¯¹åŸºç±»çœ‹ä¼¼æ— å®³çš„ä¿®æ”¹å¯èƒ½ä¼šç»™å®¢æˆ·å¸¦æ¥ä¸åˆ©çš„å½±å“ã€‚ å®¢æˆ·å¯èƒ½ä¼šä»¥ä½ æ ¹æœ¬æ— æ³•é¢„æ–™çš„æ–¹å¼æ¥ä½¿ç”¨ APIã€‚ å®¢æˆ·å¯èƒ½é‡‡ç”¨ä¸æ­£ç¡®çš„æˆ–æ˜“äºå‡ºé”™çš„æ–¹å¼æ¥æ‰©å±• APIã€‚ é‡å†™è™šå‡½æ•°å¯èƒ½ç ´åç±»çš„å†…éƒ¨åŸæœ‰é€»è¾‘çš„å®Œæ•´æ€§ã€‚ ä½¿ç”¨è™šå‡½æ•°è¦æ³¨æ„çš„æ–¹é¢ï¼š è™šå‡½æ•°çš„è°ƒç”¨å¿…é¡»åœ¨è¿è¡Œæ—¶æŸ¥è™šå‡½æ•°è¡¨æ‰èƒ½å†³å®šï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å†³å®šã€‚ ä½¿ç”¨è™šå‡½æ•°éœ€è¦ç»´æŠ¤è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼Œè¿›è€Œå¢åŠ å¯¹è±¡çš„å¤§å°ã€‚ æ·»åŠ ã€é‡æ’æˆ–è€…ç§»é™¤è™šå‡½æ•°ä¼šç ´åäºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚å› ä¸ºè™šå‡½æ•°è°ƒç”¨é€šå¸¸ç”¨ç±»çš„è™šå‡½æ•°è¡¨çš„æ•´å‹åç§»é‡æ¥è¡¨ç¤ºï¼Œæ‰€ä»¥æ”¹å˜è™šå‡½æ•°çš„é¡ºåºï¼Œæˆ–è€…æ‰§è¡Œå¯èƒ½ä¼šå¼•èµ·å…¶ä»–è™šå‡½æ•°çš„é¡ºåºå‘é€å˜åŒ–çš„æ“ä½œï¼Œéƒ½éœ€è¦é‡æ–°ç¼–è¯‘ç°æœ‰ä»£ç ã€‚ å¦‚æœç±»åŒ…å«äº†ä»»ä¸€è™šå‡½æ•°ï¼Œé‚£ä¹ˆå¿…é¡»å°†ææ„å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ã€‚è¿™æ ·å­ç±»å°±å¯ä»¥é‡Šæ”¾å…¶å¯èƒ½ç”³è¯·çš„é¢å¤–èµ„æºã€‚ ç»ä¸åœ¨æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°ï¼Œè¿™äº›è°ƒç”¨ä¸ä¼šæŒ‡å‘ä¹‹ç±»ã€‚ Sutter å»ºè®®æ¥å£åº”è¯¥æ˜¯éè™šçš„ï¼ŒåŒæ—¶åœ¨é€‚å½“çš„æƒ…å†µä¸‹ä½¿ç”¨æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€‚ ç»™å‡ºæ¸…æ™°çš„ã€æè¿°æ€§å¼ºçš„ä¸”æ°å½“çš„åå­—æ˜¯ API è®¾è®¡ä¸­æœ€å›°éš¾çš„ä»»åŠ¡ä¹‹ä¸€ã€‚ é¿å…ç¼–å†™æ‹¥æœ‰å¤šä¸ªç›¸åŒç±»å‹å‚æ•°çš„å‡½æ•°ã€‚ ä½¿ç”¨ä¸€è‡´çš„ï¼ˆç»Ÿä¸€è§„èŒƒï¼‰å‡½æ•°å‘½ä»¤å’Œå‚æ•°é¡ºåºã€‚ API æ¥å£åº”è¯¥æ˜¯å¹³å°ç‹¬ç«‹çš„ã€‚ä¸è¦å°†å¹³å°ç›¸å…³çš„#ifæˆ–#ifdefè¯­å¥æ”¾åœ¨å…¬å…±çš„ API ä¸­ï¼Œå› ä¸ºè¿™äº›è¯­å¥æš´éœ²äº†å®ç°çš„ç»†èŠ‚ï¼Œå¹¶ä½¿ API å› å¹³å°è€Œå¼‚ã€‚ ä¼˜ç§€çš„ API è¡¨ç°ä¸ºæ¾è€¦åˆå’Œé«˜å†…èšã€‚ é™¤éç¡®å®éœ€è¦#includeç±»çš„å®Œæ•´å®šä¹‰ï¼Œå¦åˆ™åº”è¯¥ä¸ºç±»ä½¿ç”¨å‰ç½®å£°æ˜ã€‚ é€šå¸¸ï¼Œä¼˜ç§€çš„è½¯ä»¶å·¥ç¨‹å®è·µçš„ç›®æ ‡æ˜¯å»é™¤å†—ä½™ï¼Œå³ç¡®ä¿æ¯ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹æˆ–è¡Œä¸ºæœ‰ä¸”ä»…æœ‰ä¸€æ¬¡å®ç°ã€‚è€Œä»£ç å¤ç”¨æ„å‘³ç€è€¦åˆï¼Œå› æ­¤ç•¥å¾®çš„å¢åŠ é‡å¤ä»¥æ–­ç»è¿‡åˆ†çš„è€¦åˆå…³ç³»æœ‰æ—¶æ˜¯å€¼å¾—çš„ã€‚ ã€ŠC++ API è®¾è®¡ã€‹[ç¾] Martin Reddy è‘—ï¼›åˆ˜æ™“å¨œï¼Œè‡§ç§€æ¶›ï¼Œæ—å¥ è¯‘","categories":["é¡¹ç›®ç®¡ç†"]},{"title":"Windowså†…æ ¸å¯¹è±¡","path":"/post/14744864.html","content":"ä¸€ã€ä»€ä¹ˆæ˜¯å†…æ ¸å¯¹è±¡æˆ‘ä»¬åœ¨ windows å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°å†…æ ¸å¯¹è±¡ï¼Œå¦‚äº‹ä»¶(Event)ï¼Œç®¡é“(Pipe)ï¼Œäº’æ–¥é‡(Mutex)ï¼Œå®Œæˆç«¯å£(IOCP)ï¼Œè¿›ç¨‹(Process)ï¼Œçº¿ç¨‹(Thread)ç­‰ï¼Œä»–ä»¬éƒ½æ˜¯å†…æ ¸å¯¹è±¡ã€‚è¿™äº›å†…æ ¸å¯¹è±¡è™½ç„¶é€šè¿‡ä¸åŒçš„ç³»ç»Ÿ API æ¥åˆ›å»ºï¼Œä½†è¿™äº› API éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼Œå°±æ˜¯éƒ½éœ€è¦ä¼ å…¥SECURITY_ATTRIBUTESå®‰å…¨æè¿°ç¬¦ç»“æ„ä½“æŒ‡é’ˆï¼Œå¹¶ä¸”è¿”å›å¥æŸ„(HANDLE)ã€‚ä¾æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•æ–¹æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯å†…æ ¸å¯¹è±¡ï¼Œå°±æ˜¯çœ‹åˆ›å»ºå®ƒçš„å‡½æ•°æ˜¯å¦å…è®¸ä¼ å…¥SECURITY_ATTRIBUTESå®‰å…¨æè¿°ç¬¦ã€‚ äºŒã€å†…æ ¸å¯¹è±¡çš„åˆ›å»ºå¤§å¤šæ•°åˆ›å»ºå†…æ ¸å¯¹è±¡çš„ç³»ç»Ÿ API å‡½æ•°ï¼Œå¦‚ CreateEvent, CreateMutex, CreateThread, CreateProcess, CreatePipe, CreateNamedPipe ç­‰éƒ½ä¼šè¿”å›ä¸€ä¸ª HANDLEï¼ˆæ— è®ºæ˜¯ä»¥è¿”å›å€¼çš„å½¢å¼ï¼Œè¿˜æ˜¯ä»¥æŒ‡é’ˆå‚æ•°çš„å½¢å¼è¿”å›ï¼‰ï¼Œåˆ›å»ºå†…æ ¸å¯¹è±¡æˆåŠŸæ—¶ HANDLE ä¸ºéNULLï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† HANDLE çš„å€¼ä¸ NULL è¿›è¡Œæ¯”è¾ƒï¼Œæ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚ä½†æ˜¯æœ‰äº›å‡½æ•°æ¯”è¾ƒä¾‹å¤–ï¼Œå¦‚CreateFileï¼Œè¿™äº›å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œè¿”å›çš„HANDLEçš„å€¼ä¸ºINVALID_HANDLE_VALUIEã€‚ ç›¸å…³æ–‡ç« ï¼šç”±HANDLEè¿”å›å€¼ä¸ç¡®å®šæ€§å¼•å‘çš„æ€è€ƒ ä¸‰ã€å†…æ ¸å¯¹è±¡çš„è®¿é—®è™½ç„¶å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸ï¼Œä½†åˆ›å»ºå‡½æ•°è¿”å›çš„HANDLEå¥æŸ„å´åªå’Œå½“å‰è¿›ç¨‹æœ‰å…³ï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¿™ä¸ªå¥æŸ„ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ã€‚å†…æ ¸å¯¹è±¡å±äºç³»ç»Ÿå†…æ ¸çº§åˆ«ï¼Œä¸ºäº†ç³»ç»Ÿå®‰å…¨æ€§ï¼ŒWindows ä¸å…è®¸æˆ‘ä»¬ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡çš„å†…å­˜åŒºåŸŸï¼Œåªå…è®¸æˆ‘ä»¬é€šè¿‡ Windows æä¾›çš„ä¸€ç³»åˆ— API æ¥è®¿é—®å†…æ ¸å¯¹è±¡ï¼Œå¦‚SetEvent, ResetEventç­‰ç­‰ï¼Œä½¿ç”¨è¿™äº›å‡½æ•°æ—¶æˆ‘ä»¬éƒ½ä¼šç”¨åˆ°HANDLEï¼Œwindows å¤´æ–‡ä»¶ä¸­HANDLEçš„å®šä¹‰å¦‚ä¸‹ï¼š 1typedef void *HANDLE; è™½ç„¶å®šä¹‰ä¸ºvoid*ç±»å‹ï¼Œä½†å¾ˆæ˜¾ç„¶è¿™ä¸ªHANDLEä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆã€‚ å¦‚ä½•è¯æ˜ HANDLE ä¸æ˜¯æŒ‡å‘å†…æ ¸å¯¹è±¡çš„æŒ‡é’ˆï¼Ÿä¸€æ–¹é¢ç›´æ¥æ‰§è¡Œå†…æ ¸å¯¹è±¡æ¯«æ— å®‰å…¨æ€§å¯è¨€ï¼›å¦ä¸€æ–¹é¢å†…æ ¸å¯¹è±¡ä¿å­˜åœ¨å†…æ ¸åœ°å€ç©ºé—´ï¼ˆ32 ä½ç³»ç»Ÿæ˜¯0x80000000 åˆ° 0xFFFFFFFFï¼Œ64 ä½ç³»ç»Ÿæ˜¯0x00000040 00000000åˆ°0xFFFFFFFF FFFFFFFFï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ç±»ä¼¼CreateEventçš„å‡½æ•°åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œè§‚å¯Ÿå…¶è¿”å›çš„ HANDLEï¼Œæ˜æ˜¾ä¸åœ¨å†…æ ¸åœ°å€ç©ºé—´çš„èŒƒå›´å†…ï¼Œä¸”å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚ é‚£ä¹ˆè¿™ä¸ªHANDLEå¥æŸ„æ˜¯å¦‚ä½•ä¸å†…æ ¸å¯¹è±¡å…³è”èµ·æ¥çš„äº†ï¼Ÿç­”æ¡ˆæ˜¯ï¼šè¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªå¥æŸ„è¡¨(Windows æ²¡æœ‰æä¾›å®˜æ–¹çš„æ–‡æ¡£æ¥ä»‹ç»å¥æŸ„è¡¨)ï¼Œå‚è€ƒã€ŠWindows æ ¸å¿ƒç¼–ç¨‹ã€‹å¾—çŸ¥å¥æŸ„è¡¨çš„ç»“æ„ï¼Œå¦‚å›¾ï¼š ç´¢å¼• æŒ‡å‘å†…æ ¸å¯¹è±¡å†…å­˜å—çš„æŒ‡é’ˆ è®¿é—®æ©ç  æ ‡å¿— 1 0x???????? 0x???????? 0x???????? 2 0x???????? 0x???????? 0x???????? â€¦ â€¦ â€¦ â€¦ å¦‚æˆ‘ä»¬è°ƒç”¨ç±»ä¼¼CreateEventçš„å‡½æ•°è¿”å›çš„å¥æŸ„HANDLEå°±æ˜¯å¥æŸ„è¡¨ä¸­çš„ç´¢å¼•ã€‚å› ä¸ºæ˜¯ç´¢å¼•ï¼Œæ‰€ä»¥å®ƒçš„å€¼ä¸€èˆ¬æ¯”è¾ƒå°ã€‚æˆ‘ä»¬å‘ windows API å‡½æ•°ä¼ å…¥è¿™ä¸ªç´¢å¼•ï¼ŒAPI å†é€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„å†…æ ¸å¯¹è±¡æŒ‡é’ˆã€‚ å››ã€å†…æ ¸å¯¹è±¡çš„é”€æ¯4.1 å¼•ç”¨è®¡æ•°å†…æ ¸å¯¹è±¡çš„æ‰€æœ‰è€…æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œè€Œä¸æ˜¯åˆ›å»ºå®ƒçš„è¿›ç¨‹ã€‚ å¤šä¸ªè¿›ç¨‹å¯ä»¥å¼•ç”¨ï¼ˆä½¿ç”¨ï¼‰åŒä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œæ“ä½œç³»ç»Ÿä½¿ç”¨äº†è®¡æ•°å™¨çš„æ–¹å¼æ¥ç®¡ç†å†…æ ¸å¯¹è±¡ï¼ˆè¿™ä¸ªå’Œ C++ä¸­çš„std::shared_ptræ™ºèƒ½æŒ‡é’ˆç±»ä¼¼ï¼‰ï¼Œä¸€ä¸ªå†…æ ¸å¯¹è±¡å…¶å®æœ‰ä¸¤ä¸ªè®¡æ•°å™¨ï¼šä¸€ä¸ªæ˜¯ç»™ç”¨æˆ·æ€(Ring3)ç”¨çš„å¥æŸ„è®¡æ•°ï¼›å¦ä¸€ä¸ªæ˜¯æŒ‡é’ˆè®¡æ•°ï¼Œä¹Ÿå«å¼•ç”¨è®¡æ•°ï¼Œå› ä¸ºæ ¸å¿ƒæ€ç¨‹åº(Ring0)ä¹Ÿç»å¸¸ç”¨åˆ°å†…æ ¸å¯¹è±¡ï¼Œä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œåœ¨æ ¸å¿ƒæ€çš„ä»£ç ç”¨æŒ‡é’ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼Œæ‰€ä»¥å†…æ ¸å¯¹è±¡çš„ç®¡ç†å™¨ä¹Ÿç»´æŠ¤äº†è¿™ä¸ªæŒ‡é’ˆå¼•ç”¨è®¡æ•°ã€‚åªæœ‰åœ¨å†…æ ¸å¯¹è±¡çš„å¥æŸ„è®¡æ•°å’Œå¼•ç”¨è®¡æ•°éƒ½ä¸º 0 æ—¶ï¼Œè¯¥å†…æ ¸å¯¹è±¡æ‰è¢«é‡Šæ”¾ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒæŒ‡é’ˆå¼•ç”¨è®¡æ•°å€¼æ¯”å¥æŸ„è®¡æ•°å€¼å¤§ã€‚ 4.2 æ­£ç¡®çš„é”€æ¯æ–¹å¼å½“ç¨‹åºä¸å†ä½¿ç”¨å†…æ ¸å¯¹è±¡æ—¶ï¼Œéœ€è¦è°ƒç”¨CloseHandleå°†å†…æ ¸å¯¹è±¡çš„è®¡æ•°å‡ 1ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸åœ¨è¯¥å¯¹è±¡è®¡æ•°ä¸º 0 æ—¶ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«ä»»ä½•ä¸œè¥¿å¼•ç”¨æ—¶ï¼‰å°†é”€æ¯è¯¥å¯¹è±¡ã€‚ å¹¶ä¸”åœ¨è°ƒç”¨CloseHandleä¹‹åï¼Œç¨‹åºè¿˜åº”è¯¥å°†HANDLEç½®ä¸ºNULLã€‚ å¦‚æœCloseHandleä¹‹åä¸å°†HANDLEç½®ä¸ºNULLï¼Œåè€Œå†æ¬¡ä½¿ç”¨è¯¥HANDLEï¼Œå°±ä¼šå‡ºç° 2 ç§æƒ…å†µï¼š è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥HANDLEæ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•å·²ç»è¢«æ¸…é™¤ï¼Œä¸”æ²¡æœ‰åˆ«çš„çº¿ç¨‹å†æ¬¡åœ¨è¯¥ç´¢å¼•åˆ›å»ºè®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„HANDLEè°ƒç”¨ Win32 API å‡½æ•°ï¼ŒWindows ä¼šè¿”å›æ— æ•ˆå‚æ•°é”™è¯¯ã€‚è¿™ç§æƒ…å†µè¿˜æ¯”è¾ƒå¥½è°ƒè¯•ã€‚ è¿›ç¨‹å¥æŸ„è¡¨ä¸­è¯¥HANDLEæ‰€åœ¨çš„ç´¢å¼•é¡¹çš„è®°å½•åŒæ ·ä¹Ÿå·²ç»è¢«æ¸…é™¤ï¼Œä½†å·²ç»æœ‰åˆ«çš„çº¿ç¨‹ï¼ˆè¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹ï¼‰åœ¨è¯¥ç´¢å¼•ä½ç½®åˆ›å»ºäº†è®°å½•é¡¹ï¼Œè‹¥æ­¤æ—¶ä½¿ç”¨è¿™ä¸ªè¿‡æœŸçš„HANDLEè°ƒç”¨ Win32 API å‡½æ•°ï¼Œè¯¥HANDLEå°±ä¼šå¼•ç”¨åˆ°å…¶ä»–çº¿ç¨‹æ–°å»ºçš„é‚£ä¸ªå†…æ ¸å¯¹è±¡ï¼Œä»è€Œå‡ºç°ä¸€äº›éš¾ä»¥é¢„æ–™çš„é”™è¯¯ã€‚è¿™ç§é”™è¯¯å¾ˆéš¾è°ƒè¯•ã€‚ 4.3 è·å–å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°è™½ç„¶ windows æ²¡æœ‰æä¾› API è®©ç”¨æˆ·åœ¨ç”¨æˆ·æ€ï¼ˆRing3ï¼‰æŸ¥è¯¢ä¸€ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„è®¡æ•°å’Œå¼•ç”¨è®¡æ•°ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»Ntdll.dllå¯¼å‡ºNtQueryObjectå‡½æ•°æ¥å®ç°æŸ¥è¯¢å†…æ ¸å¯¹è±¡çš„å½“å‰çŠ¶æ€(è¯¥å‡½æ•°æ²¡æœ‰è¢«æ–‡æ¡£åŒ–)ã€‚ NtQueryObjectå‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š 123456789// è¿”å›å€¼ï¼šå¦‚æœæˆåŠŸåˆ™è¿”å›0//DWORD WINAPI NtQueryObject(HANDLE handle, // å¾…æŸ¥è¯¢çš„å¥æŸ„DWORD nQueryIndex, // 0ä¸ºæŸ¥è¯¢å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å¥æŸ„è®¡æ•°ï¼Œå¼•ç”¨è®¡æ•°ç­‰ç­‰ã€‚VOID* pOutBuffer, // å­˜æ”¾æŸ¥è¯¢ç»“æœDWORD cbInBufferSize, // pOutBufferçš„å¤§å°ï¼Œå¦‚æœnQueryIndexä¸º0ï¼Œè¿™é‡Œä¸ºsizeof(SYSTEM_HANDLE_STATE)VOID* cbOutBufferSize // å®é™…å¤§å°); å°†NtQueryObjectå‡½æ•°è°ƒç”¨çš„ç»†èŠ‚å°è£…åˆ°GetKernelObjectRefCountå‡½æ•°ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051bool GetKernelObjectRefCount(HANDLE handle, DWORD &amp;handle_count, DWORD &amp;point_count) &#123; typedef struct _SYSTEM_HANDLE_STATE &#123; DWORD r1; DWORD GrantedAccess; DWORD HandleCount; // å‡1ä¸ºå¥æŸ„è®¡æ•° DWORD ReferenceCount; // å‡1ä¸ºæŒ‡é’ˆå¼•ç”¨è®¡æ•° DWORD r5; DWORD r6; DWORD r7; DWORD r8; DWORD r9; DWORD r10; DWORD r11; DWORD r12; DWORD r13; DWORD r14; &#125;SYSTEM_HANDLE_STATE, *PSYSTEM_HANDLE_STATE; typedef DWORD(WINAPI *PFN_NtQueryObject)(HANDLE handle, DWORD nQueryIndex, VOID* pOutBuffer, DWORD cbInBufferSize, VOID* cbOutBufferSize); static PFN_NtQueryObject pfnNtQueryObject = NULL; bool ret = false; do &#123; if (pfnNtQueryObject == NULL) &#123; HMODULE ntdll = GetModuleHandle(TEXT(&quot;Ntdll.dll&quot;)); if (ntdll == NULL) break; pfnNtQueryObject = (PFN_NtQueryObject)GetProcAddress(ntdll, &quot;NtQueryObject&quot;); if (pfnNtQueryObject == NULL) break; &#125; SYSTEM_HANDLE_STATE sys_handle_state; memset(&amp;sys_handle_state, 0, sizeof(SYSTEM_HANDLE_STATE)); DWORD out_buf_size = 0; ret = (pfnNtQueryObject(handle, 0, &amp;sys_handle_state, sizeof(SYSTEM_HANDLE_STATE), &amp;out_buf_size) == 0); if (ret) &#123; handle_count = sys_handle_state.HandleCount - 1; point_count = sys_handle_state.ReferenceCount - 1; &#125; &#125; while (false); return ret;&#125; äº”ã€å†…æ ¸å¯¹è±¡è·¨è¿›ç¨‹è®¿é—®è™½ç„¶å†…æ ¸å¯¹è±¡ä½äºç‹¬ç«‹äºè¿›ç¨‹ä¹‹å¤–çš„å†…æ ¸åŒºåŸŸï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­å´åªèƒ½é€šè¿‡è°ƒç”¨ Win32 API ä¼ å…¥ HANDLE å‚æ•°æ¥æ“ä½œå†…æ ¸å¯¹è±¡ï¼ˆå¦‚SetEventç­‰ï¼‰ã€‚ç„¶è€ŒHANDLEå¥æŸ„åªå¯¹å½“å‰è¿›ç¨‹æœ‰æ•ˆï¼Œç¦»å¼€äº†å½“å‰è¿›ç¨‹è¯¥å¥æŸ„å°±æ— æ•ˆäº†ã€‚æ‰€ä»¥è¯´ï¼Œè·¨è¿›ç¨‹è®¿é—®å†…æ ¸å¯¹è±¡çš„å…³é”®åœ¨äºæˆ‘ä»¬æ€ä¹ˆè·¨è¿›ç¨‹è®¿é—®å¥æŸ„HANDLEï¼Ÿ ä¸‹é¢ä»‹ç»å‡ ç§æ–¹æ³•æ¥å®ç°è·¨è¿›ç¨‹å…±äº«å†…æ ¸å¯¹è±¡ã€‚ 5.1 ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼åªæœ‰è¿›ç¨‹ä¹‹é—´æœ‰çˆ¶å­å…³ç³»æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨å¥æŸ„ç»§æ‰¿çš„æ–¹å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶å…è®¸å­è¿›ç¨‹è®¿é—®çˆ¶è¿›ç¨‹çš„å†…æ ¸å¯¹è±¡ã€‚ä¸ºäº†ä½¿è¿™ç§ç»§æ‰¿ç”Ÿæ•ˆï¼Œçˆ¶è¿›ç¨‹å¿…é¡»æ‰§è¡Œå‡ ä¸ªæ­¥éª¤ï¼šï¼ˆ1ï¼‰. çˆ¶è¿›ç¨‹åœ¨åˆ›å»ºä¸€ä¸ªå†…æ ¸å¯¹è±¡æ—¶ï¼Œçˆ¶è¿›ç¨‹å¿…é¡»å‘ç³»ç»ŸæŒ‡å®šå®ƒå¸Œæœ›è¿™ä¸ªå†…æ ¸å¯¹è±¡çš„å¥æŸ„æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯ç»§æ‰¿çš„å†…æ ¸å¯¹è±¡ï¼Œå¿…é¡»åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ªSECURITY_ATTRIBUTESç»“æ„ï¼Œå¦‚ï¼š 123456SECURITY_ATTRIBUTES sa;sa.nLength = sizeof(SECURITY_ATTRIBUTES);sa.bInheritHandle = TRUE; // å¯ç»§æ‰¿çš„sa.lpSecurityDescriptor = NULL;HANDLE h = CreateEvent(&amp;sa, TRUE, FALSE, NULL); ï¼ˆ2ï¼‰. çˆ¶è¿›ç¨‹é€šè¿‡ CreateProcess ç”Ÿæˆå­è¿›ç¨‹ï¼Œä¸”æŒ‡å®šbInheritHandlesä¸º TRUEï¼Œä»è€Œå…è®¸å­è¿›ç¨‹æ¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„é‚£äº›â€œå¯ç»§æ‰¿çš„å¥æŸ„â€ã€‚ 1234567891011121314151617181920212223// å¯åŠ¨å­è¿›ç¨‹TestB.exeï¼Œå°†å¥æŸ„hä½œä¸ºå¯åŠ¨å‚æ•°ä¼ ç»™è¿›ç¨‹TestB//TCHAR cmd_buf[MAX_PATH];StringCchPrintf(cmd_buf, MAX_PATH, TEXT(&quot;TestB.exe %ld&quot;), (long)h);STARTUPINFO si = &#123; sizeof(si) &#125;;PROCESS_INFORMATION pi;BOOL ret = CreateProcess( NULL, cmd_buf, NULL, NULL, TRUE, // æŒ‡å®šå­è¿›ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶è¿›ç¨‹çš„â€œå¯ç»§æ‰¿å¥æŸ„â€ 0, NULL, NULL, &amp;si, &amp;pi);CloseHandle(pi.hProcess);CloseHandle(pi.hThread); ç”±äºæˆ‘ä»¬ä¼ ç»™bInheritHandleså‚æ•°çš„å€¼æ˜¯TRUEï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼šå¤šåšä¸€ä»¶äº‹æƒ…ï¼šå®ƒä¼šéå†çˆ¶è¿›ç¨‹çš„å¥æŸ„è¡¨ï¼Œå¯¹å®ƒçš„æ¯ä¸€é¡¹è¿›è¡Œæ£€æŸ¥ï¼Œå‡¡æ˜¯åŒ…å«ä¸€ä¸ªæœ‰æ•ˆçš„â€œå¯ç»§æ‰¿çš„å¥æŸ„â€çš„é¡¹ï¼Œéƒ½ä¼šå°†è¯¥é¡¹å®Œæ•´çš„å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å¥æŸ„è¡¨ã€‚åœ¨å­è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­ï¼Œå¤åˆ¶é¡¹çš„ä½ç½®ä¸å®ƒåœ¨çˆ¶è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ä½ç½®å®Œå…¨ä¸€æ ·ï¼ˆåŒ…å«ç´¢å¼•ï¼‰ï¼Œè¿™ä¸ªå°±æ„å‘³ç€ï¼šåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­ï¼Œå¯¹ä¸€ä¸ªå†…æ ¸å¯¹è±¡è¿›è¡Œæ ‡è¯†çš„å¥æŸ„å€¼ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é€šè¿‡æŸç§æ–¹å¼ï¼ˆå¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„å¯åŠ¨å‚æ•°çš„æ–¹å¼ï¼Œæˆ–è€…ç¯å¢ƒå˜é‡çš„æ–¹å¼ç­‰ä»»ä½•è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼ï¼‰å°†è¿™ä¸ªå€¼å‘Šè¯‰å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°±å¯ä»¥å°†è¯¥å€¼è½¬æˆHANDLEï¼Œç„¶åä½¿ç”¨è¿™ä¸ªHANDLEæ¥è°ƒç”¨ç³»ç»Ÿ APIã€‚ 5.2 ä½¿ç”¨ DuplicateHandle æ–¹å¼DuplicateHandle å‡½æ•°å¯ä»¥å°†æŒ‡å®šâ€œæºè¿›ç¨‹çš„å¥æŸ„è¡¨â€ä¸­çš„æŸä¸€é¡¹å¤åˆ¶åˆ°â€œç›®çš„è¿›ç¨‹å¥æŸ„è¡¨â€ä¸­ï¼ˆé™¤äº†ç´¢å¼•ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥é¡¹åœ¨ç›®çš„è¿›ç¨‹å¥æŸ„è¡¨ä¸­çš„ç´¢å¼•ï¼ˆå³ HADNLEï¼‰ã€‚å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è°ƒç”¨ DuplicateHandle å‡½æ•°ï¼ŒDuplicateHandle å¯¹æºå¥æŸ„æ˜¯å¦æ˜¯å¯ç»§æ‰¿çš„æ²¡æœ‰è¦æ±‚ã€‚ å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š 123456789BOOL DuplicateHandle( HANDLE hSourceProcessHandle, HANDLE hSourceHandle, HANDLE hTargetProcessHandle, LPHANDLE lpTargetHandle, DWORD dwDesiredAccess, BOOL bInheritHandle, DWORD dwOptions); DuplicateHandle è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ MSDNï¼šhttps://msdn.microsoft.com/en-us/library/windows/desktop/ms724251(v=vs.85).aspx DuplicateHandle å‡½æ•°ä¸èƒ½å¤åˆ¶æ‰€æœ‰ç±»å‹çš„å¥æŸ„ï¼Œåªèƒ½å¤åˆ¶å¦‚ä¸‹ç±»å‹çš„å¥æŸ„ï¼ˆä» MSDN å¤åˆ¶è€Œæ¥ï¼‰ï¼š Object Description Access token The handle is returned by the CreateRestrictedToken, DuplicateToken, DuplicateTokenEx, OpenProcessToken, or OpenThreadToken function. Change notification The handle is returned by the FindFirstChangeNotification function. Communications device The handle is returned by the CreateFile function. Console input The handle is returned by the CreateFile function when CONIN$ is specified, or by the GetStdHandle function when STD_INPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process. Console screen buffer The handle is returned by the CreateFile function when CONOUT$ is specified, or by the GetStdHandle function when STD_OUTPUT_HANDLE is specified. Console handles can be duplicated for use only in the same process. Desktop The handle is returned by the GetThreadDesktop function. Event The handle is returned by the CreateEvent or OpenEvent function. File The handle is returned by the CreateFile function. File mapping The handle is returned by the CreateFileMapping function. Job The handle is returned by the CreateJobObject function. Mailslot The handle is returned by the CreateMailslot function. Mutex The handle is returned by the CreateMutex or OpenMutex function. Pipe A named pipe handle is returned by the CreateNamedPipe or CreateFile function. An anonymous pipe handle is returned by the CreatePipe function. Process The handle is returned by the CreateProcess, GetCurrentProcess, or OpenProcess function. Registry key The handle is returned by the RegCreateKey, RegCreateKeyEx, RegOpenKey, or RegOpenKeyEx function. Note that registry key handles returned by the RegConnectRegistry function cannot be used in a call to DuplicateHandle. Semaphore The handle is returned by the CreateSemaphore or OpenSemaphore function. Thread The handle is returned by the CreateProcess, CreateThread, CreateRemoteThread, or GetCurrentThread function Timer The handle is returned by the CreateWaitableTimer or OpenWaitableTimer function. Transaction The handle is returned by the CreateTransaction function. Window station The handle is returned by the GetProcessWindowStation function. ä¸åŒçš„äº‹ä»¶ç±»å‹å¯¹åº”çš„dwDesiredAccesså‚æ•°ä¸åŒï¼Œå…·ä½“å‚è€ƒMSDNã€‚ ç¤ºä¾‹è¿›ç¨‹ TestA æºç  123456789101112131415161718192021222324252627int main(int argc, char** argv) &#123; HANDLE h = CreateEvent(NULL, TRUE, FALSE, NULL); // å¯åŠ¨å­è¿›ç¨‹TestB.exe // TCHAR cmd_buf[MAX_PATH]; StringCchPrintf(cmd_buf, MAX_PATH, TEXT(&quot;D:\\\\TestB.exe&quot;), (long)h); STARTUPINFO si = &#123; sizeof(si) &#125;; PROCESS_INFORMATION pi; BOOL ret = CreateProcess(NULL, cmd_buf, NULL, NULL, TRUE, 0, NULL, NULL, &amp;si, &amp;pi); assert(ret); assert(pi.hProcess); HANDLE duplicated_h = NULL; ret = DuplicateHandle(GetCurrentProcess(), h, pi.hProcess, &amp;duplicated_h, 0, FALSE, DUPLICATE_SAME_ACCESS); WaitForSingleObject(pi.hProcess, INFINITE); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); bool has_signal = WaitForSingleObject(h, 0) == WAIT_OBJECT_0; assert(has_signal == true); return 0;&#125; å­è¿›ç¨‹ TestB æºç  12345678910111213141516int main(int argc, char** argv)&#123; long l = 0; printf(&quot;Input Handle:&quot;); scanf(&quot;%ld&quot;, &amp;l); HANDLE h = (HANDLE)l; bool has_signal = WaitForSingleObject(h, 0) == WAIT_OBJECT_0; assert(has_signal == false); SetEvent(h); return 0;&#125; åœ¨çˆ¶è¿›ç¨‹ TestA ä¸­åˆ›å»ºä¸€ä¸ªä¸å¯ç»§æ‰¿çš„äº‹ä»¶ -&gt; ç„¶åå¯åŠ¨å­è¿›ç¨‹ TestB -&gt; è°ƒç”¨ DuplicateHandle å¤åˆ¶å¥æŸ„é¡¹åˆ° TestB è¿›ç¨‹å¥æŸ„è¡¨ -&gt; å¹¶å‘ TestB è¾“å…¥å¥æŸ„å€¼ -&gt; TestB è®¿é—®è¯¥äº‹ä»¶å¥æŸ„ï¼Œå°†äº‹ä»¶ç½®ä¸ºæœ‰ä¿¡å·çŠ¶æ€ã€‚ 5.3 ä½¿ç”¨å‘½åçš„å†…æ ¸å¯¹è±¡çš„æ–¹å¼5.3.1 å®ç°åŸç†è¿™ç§æ–¹å¼ä¸¥æ ¼çš„è¯´å·²ç»ä¸æ˜¯æ–‡ç« å¼€å¤´è¯´åˆ°çš„è·¨è¿›ç¨‹è®¿é—®å¥æŸ„äº†ï¼Œæœ‰ç‚¹ç±»ä¼¼è·¨è¿›ç¨‹ç›´æ¥è®¿é—®å†…æ ¸å¯¹è±¡äº†ã€‚è¯¥æ–¹å¼å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨è°ƒç”¨åˆ›å»ºå†…æ ¸å¯¹è±¡çš„Create***å‡½æ•°æ—¶ï¼Œé€šè¿‡pszNameå‚æ•°ä¸ºå†…æ ¸å¯¹è±¡å–ä¸€ä¸ªåå­—ã€‚å¦‚åˆ›å»ºäº‹ä»¶ Event çš„å‡½æ•°CreateEventï¼š 1234567HANDLE WINAPI CreateEvent( LPSECURITY_ATTRIBUTES lpEventAttributes, BOOL bManualReset, BOOL bInitialState, LPCTSTR lpName // æŒ‡å®šåç§°); 1HANDLE h = CreateEvent(NULL, TRUE, FALSE, TEXT(&quot;TestA_Obj&quot;)); è‹¥åœ¨å…¶ä»–è¿›ç¨‹ä¸­è¦è®¿é—®è¿™ä¸ªå†…æ ¸å¯¹è±¡ï¼Œåªéœ€è¦ä½¿ç”¨æ‰“å¼€å‡½æ•°Open***æ‰“å¼€è¯¥å†…æ ¸å¯¹è±¡ï¼Œç³»ç»Ÿå°±ä¼šåœ¨è¿›ç¨‹çš„å¥æŸ„è¡¨ä¸­æ’å…¥ä¸€æ¡è®°å½•ï¼Œå¹¶è¿”å›è¿™æ¡è®°å½•çš„ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯å¥æŸ„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰“å¼€å†…æ ¸å¯¹è±¡æ—¶éœ€è¦ç•™æ„è¿”å›å€¼å’ŒGetLastErrorå‡½æ•°çš„è¿”å›å€¼ã€‚ç”±äºå†…æ ¸å¯¹è±¡æ˜¯æœ‰è®¿é—®æƒé™çš„ï¼Œæœ‰æ—¶å€™è™½ç„¶è¿™ä¸ªåå­—çš„å†…æ ¸å¯¹è±¡å­˜åœ¨ï¼Œä½†è¯¥è¿›ç¨‹å´ä¸è§å¾—æœ‰æƒé™å¯ä»¥æ‰“å¼€å®ƒï¼Œè¿™ä¸ªæ—¶å€™GetLastErrorå‡½æ•°ä¼šè¿”å›å¤±è´¥çš„åŸå› ã€‚ ä»¥æ‰“å¼€äº‹ä»¶çš„å‡½æ•°OpenEventä¸ºä¾‹ï¼š 123456HANDLE h = OpenEvent(READ_CONTROL, FALSE, TEXT(&quot;TestA_Obj&quot;));if (h == NULL) &#123; if (GetLastError() == ERROR_ACCESS_DENIED) &#123; // æ²¡æœ‰READ_CONTROLæƒé™ &#125;&#125; 5.3.2 å…¨å±€å‘½ä»¤ç©ºé—´ä¸åŒçš„ä¼šè¯ï¼ˆSessionï¼‰æœ‰ä¸åŒçš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼ˆå¦‚ windows æœåŠ¡ç¨‹åºä½äºSession 0ï¼Œè€Œæ™®é€šçš„ç”¨æˆ·è¿›ç¨‹ä½äºSession 1ï¼‰ï¼Œè¦é€šè¿‡åç§°è®¿é—®å…¶ä»–ä¼šè¯ä¸­çš„å†…æ ¸å¯¹è±¡ï¼Œéœ€è¦åœ¨åç§°å‰é¢åŠ ä¸ŠSession\\&lt;å½“å‰ä¼šè¯ID&gt;ã€‚Windows æä¾›äº†ä¸€ä¸ªå…¨å±€çš„å†…æ ¸å¯¹è±¡å‘½åç©ºé—´ï¼Œå¤„äºä»»ä½•ä¼šè¯ä¸­çš„è¿›ç¨‹éƒ½å¯ä»¥è®¿é—®è¯¥å‘½åç©ºé—´ï¼Œå°†å†…æ ¸å¯¹è±¡æ”¾å…¥å…¨å±€å‘½ä»¤ç©ºé—´çš„æ–¹å¼å¾ˆç®€å•ï¼šåªéœ€è¦åœ¨å†…æ ¸å¯¹è±¡åç§°å‰åŠ å…¥Global\\å³å¯ã€‚ å¦‚ï¼š 1HANDLE h = CreateEvent(NULL, TRUE, FALSE, TEXT(&quot;Global\\\\TestA_Obj&quot;));","tags":["Windows","å†…æ ¸"],"categories":["Windowsç¼–ç¨‹"]},{"title":"C++å®ç°ç¼–è¯‘æ—¶æ–­è¨€","path":"/post/4155207961.html","content":"C++è‡ª C++11 èµ·æ”¯æŒ static_assert ç¼–è¯‘æ—¶æ–­è¨€ï¼Œå¦‚ï¼š 12static_assert ( bool_constexpr , message ) (C++11 èµ·)static_assert ( bool_constexpr ) (C++17 èµ·) è‹¥ç¼–è¯‘å™¨ä¸æ”¯æŒ C++11ï¼ˆç»æµ‹è¯• VS2010 å·²ç»æ”¯æŒstatic_assertï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹å¼æ¥å®ç°ç¼–è¯‘æ–­è¨€ï¼š 1#define COMPILE_ASSERT(expression) switch (0) &#123;case 0: case expression:;&#125; ä½¿ç”¨æ–¹æ³•ï¼š 1COMPILE_ASSERT(1 != 1);","tags":["C++","æ–­è¨€"],"categories":["C++è¯­è¨€"]},{"title":"Windowsæ³¨å…¥ä¸æ‹¦æˆª(3)-çª—å£æŒ‚è½½","path":"/post/2804470458.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡ DLL æ³¨å…¥çš„æ–¹å¼æ¥å®ç°åœ¨æŒ‡å®šçª—å£çš„æ§ä»¶ä¸ŠæŒ‚è½½ä¸€ä¸ªè‡ªå®šä¹‰çª—å£ã€‚ ä½•è°“æŒ‚è½½ï¼Ÿå’Œèˆ°è½½æœºæŒ‚è½½å¯¼å¼¹ç±»ä¼¼ï¼Œå°†æˆ‘ä»¬è‡ªå·±çš„çª—å£æŒ‚åˆ°åŸæœ‰ç¨‹åºçš„çª—å£ä¹‹ä¸Šï¼Œå¯ä»¥å®ç°å¯¹åŸæœ‰çª—å£åŠŸèƒ½çš„è¦†ç›–å’Œæ‰©å±•ã€‚ ä¸€ã€å®ç°è¿‡ç¨‹æŒ‚è½½çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š é€šè¿‡è¿œç¨‹çº¿ç¨‹çš„æ–¹å¼ï¼ˆå…¶ä»–æ–¹å¼ä¹Ÿå¯ä»¥ï¼‰å°† DLL æ³¨å…¥åˆ°æŒ‡å®šçš„è¿›ç¨‹ï¼ˆå½“ç„¶æ˜¯è¢«æŒ‚è½½çª—å£æ‰€å±çš„è¿›ç¨‹ï¼‰ã€‚ åœ¨DllMainçš„DLL_PROCESS_ATTACHæ¡ä»¶åˆ†æ”¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ NewThreadï¼Œåé¢çš„å¤„ç†é€»è¾‘å°†æ”¾åˆ° NewThread ä¸­ï¼Œé˜²æ­¢DllMainé˜»å¡ã€‚ åœ¨ NewThread çº¿ç¨‹ä¸­æŸ¥æ‰¾è¢«æŒ‚è½½çš„çª—å£ï¼ˆæ³¨æ„æ˜¯çª—å£ä¸æ˜¯çª—å£ä¸Šçš„æ§ä»¶ï¼‰çš„å¥æŸ„ï¼ˆæŸ¥æ‰¾æ–¹å¼ï¼šEnumWindowsç»“åˆFindWindowExå®ç°ï¼Œè¯¦è§FindProcessWindowå‡½æ•°ï¼‰ã€‚ ä½¿ç”¨SetWindowLongä¿®æ”¹çª—ä½“çš„é»˜è®¤çš„æ¶ˆæ¯å¤„ç†è¿‡ç¨‹ï¼ˆå‡è®¾å°†çª—å£å¤„ç†è¿‡ç¨‹ä¿®æ”¹ä¸ºæˆ‘ä»¬ DLL ä¸­çš„WndProc_Trampolineå‡½æ•°ï¼‰ï¼Œç„¶åå‘çª—ä½“å‘é€ä¸€ä¸ªè‡ªå®šä¹‰æ¶ˆæ¯ï¼Œè¿™æ—¶WndProc_Trampolineå‡½æ•°å°±å¯ä»¥è·å–åˆ°è¯¥æ¶ˆæ¯é€šçŸ¥ï¼Œæˆ‘ä»¬åœ¨æ”¶åˆ°è¯¥æ¶ˆæ¯é€šçŸ¥åå°±å¯ä»¥å¼€å§‹æˆ‘ä»¬çš„æŒ‚è½½é€»è¾‘äº†ã€‚ä¹‹æ‰€ä»¥è¦é€šè¿‡å‘é€ä¸€ä¸ªè‡ªå®šä¹‰æ¶ˆæ¯çš„æ–¹å¼æ¥åšï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æ–°çº¿ç¨‹ NewThread ä¸­å¼€å§‹æˆ‘ä»¬çš„æŒ‚è½½é€»è¾‘ï¼Œæ˜¯å› ä¸ºè¿™æ ·åšå¯ä»¥ä¿è¯æˆ‘ä»¬çš„æŒ‚è½½é€»è¾‘ï¼ˆå¦‚åˆ›å»ºçª—å£ï¼‰æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œçš„ã€‚ æŒ‚è½½é€»è¾‘ä¸»è¦åŒ…å«ï¼šæŸ¥æ‰¾éœ€è¦æŒ‚è½½æ§ä»¶çš„å¥æŸ„ã€åˆ›å»ºæŒ‚è½½çª—å£ã€‚åˆ›å»ºæŒ‚è½½çª—å£çš„æ—¶å€™è¦è®¾ç½®WS_CHILDå­çª—å£å±æ€§ï¼Œå¹¶è®¾ç½®çˆ¶çª—ä½“çš„WS_CLIPCHILDRENå±æ€§æ¥è£å‰ªå­çª—å£ï¼Œé˜²æ­¢æˆ‘ä»¬æŒ‚è½½çš„å­çª—å£é—ªçƒã€‚ åœ¨WndProc_Trampolineå‡½æ•°çš„æœ€åä¸è¦å¿˜è®°è°ƒç”¨ä¹‹å‰è€çš„æ¶ˆæ¯å¤„ç†è¿‡ç¨‹ï¼Œå¦åˆ™åŸçª—å£çš„æ¶ˆæ¯å°†æ— æ³•å¾—åˆ°æ­£ç¡®çš„å“åº”ã€‚ äºŒã€å®ä¾‹ä»£ç 2.1 DllInjecter å·¥ç¨‹DllInjecter.exe å®ç°å°† DLL æ³¨å…¥åˆ°æŒ‡å®šçš„è¿›ç¨‹ä¹‹ä¸­ï¼Œè¯¥ exe æ˜¯ä¸€ä¸ªé€šç”¨çš„ DLL æ³¨å…¥å™¨ã€‚åŒ…å«äº†å¯¹å‰é¢æ–‡ç« ä»‹ç»çš„â€œä½¿ç”¨è¿œç¨‹çº¿ç¨‹çš„æ–¹å¼æ³¨å…¥â€å’Œâ€œä½¿ç”¨é’©å­æ–¹å¼æ³¨å…¥â€è¿™ä¸¤ç§æ³¨å…¥æ–¹å¼çš„å®ç°ã€‚ 2.2 Test å·¥ç¨‹Test.exeæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„è¢«æŒ‚è½½ç¨‹åºï¼Œç¨‹åºéå¸¸ç®€å•ï¼ŒåªåŒ…å«ä¸€ä¸ªçª—ä½“å’Œå¤§æŒ‰é’®ï¼Œä¸åŒ…å«ä»»ä½•é€»è¾‘ã€‚æœ¬å®ä¾‹ä¸»è¦æ˜¯å°†æˆ‘ä»¬çš„çª—å£æŒ‚è½½åˆ°è¿™ä¸ªå¤§æŒ‰é’®ä¹‹ä¸Šã€‚æŒ‚è½½å‰å¦‚å›¾ï¼š æŒ‚è½½åæ•ˆæœå¦‚å›¾ï¼š 2.3 Troy å·¥ç¨‹Troy.dll å°±æ˜¯è¢«æ³¨å…¥åˆ° Test.exe ä¸­çš„ DLL æ–‡ä»¶ï¼ŒæŒ‚è½½çš„ä¸»è¦é€»è¾‘å¤§éƒ½åœ¨è¯¥å·¥ç¨‹ä¹‹ä¸­ã€‚ åœ¨WndProc_Trampolineå‡½æ•°çš„WUM_CREATE_USER_WINDOWæ¶ˆæ¯å¤„ç†åˆ†æ”¯ä¸­è°ƒç”¨CreateUserWindowByDuilibå‡½æ•°æ¥åˆ›å»ºæŒ‚è½½çª—å£ï¼ŒCreateUserWindowByDuilib ä½¿ç”¨duilibç•Œé¢åº“æ¥åˆ›å»ºæŒ‚è½½çª—å£ã€‚ 123456789LRESULT CALLBACK WndProc_Trampoline(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) &#123; switch (message) &#123; case WUM_CREATE_USER_WINDOW: CreateUserWindowByDuilib(); break; &#125; return CallWindowProc(g_oldProc, hwnd, message, wParam, lParam);&#125; 12345678910111213// çº¿ç¨‹å¤„ç†å‡½æ•°unsigned int __stdcall PluginProc(LPVOID pArg) &#123; MessageBox(NULL, TEXT(&quot;æˆ‘å·²ç»è¢«æ³¨å…¥å•¦&quot;), TEXT(&quot;ä¿¡æ¯&quot;), MB_OK | MB_ICONASTERISK); HWND hMainWindow = InjectHelper::FindProcessWindow(GetCurrentProcessId(), TEXT(&quot;#32770&quot;), TEXT(&quot;Test&quot;), TRUE); g_oldProc = (WNDPROC)SetWindowLong(hMainWindow, DWL_DLGPROC, (LONG)WndProc_Trampoline); ::PostMessage(hMainWindow, WUM_CREATE_USER_WINDOW, 0, 0); return 0;&#125; 12345678910111213141516171819202122232425262728293031BOOL APIENTRY DllMain(HMODULE hModule, DWORD fdwReason, LPVOID lpReserved) &#123; HANDLE hThread = NULL; switch(fdwReason) &#123; case DLL_PROCESS_ATTACH: &#123; g_hDllModule = hModule; // ä½¿ç”¨æ³¨å†Œè¡¨æ–¹å¼å’ŒCreateRemoteThreadæ–¹å¼æ³¨å…¥æ—¶ï¼Œä¸€èˆ¬åœ¨æ­¤å¤„åˆ›å»ºçº¿ç¨‹ // hThread = (HANDLE)_beginthreadex(NULL, 0, PluginProc, NULL, 0, NULL); if (hThread) &#123; CloseHandle(hThread); // å…³é—­å¥æŸ„ï¼Œé˜²æ­¢å¥æŸ„æ³„æ¼ &#125; break; &#125; case DLL_THREAD_ATTACH: &#123; break; &#125; case DLL_THREAD_DETACH: &#123; break; &#125; case DLL_PROCESS_DETACH: &#123; break; &#125; &#125; return TRUE;&#125; å®Œæ•´çš„ç¤ºä¾‹ä»£ç è§ï¼š https://github.com/winsoft666/InjectSample","categories":["HOOK"]},{"title":"ç†è§£C/C++è¿è¡Œæ—¶åº“","path":"/post/782629701.html","content":"è¿è¡Œæ—¶åº“ï¼ˆRuntime libraryï¼‰é€šä¿—çš„è¯´å°±æ˜¯æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œçš„æ—¶å€™æ‰€ä¾èµ–çš„åº“æ–‡ä»¶ã€‚åœ¨ Windows å¹³å°ï¼Œè¿™äº›åº“ç”±å¾®è½¯æä¾›ï¼Œå¹¶ä»¥ 2 ç§å½¢å¼æä¾›ï¼šé™æ€åº“(lib)ã€åŠ¨æ€åº“(lib+dll)ï¼Œæ¯ä¸ªåº“è¿˜åˆ†åˆ«æä¾›äº† Debug å’Œ Release ä¸¤ä¸ªç‰ˆæœ¬ã€‚ ä¸€ã€ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶åº“C&#x2F;C++è¿è¡Œæ—¶åº“ä»å½¢å¼ä¸Šæ¥è®²å’Œæˆ‘ä»¬è‡ªå·±å¼€å‘çš„é™æ€åº“ã€åŠ¨æ€åº“æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œåªæ˜¯å®ƒä»¬ç”±å¾®è½¯å¼€å‘å’Œç»´æŠ¤ï¼Œå¹¶æä¾›äº†ä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½æ”¯æŒï¼ˆå¦‚malloc, free, printfç­‰ç­‰ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºéœ€è¦ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼ˆäº‹å®ä¸Šï¼Œåªè¦æ˜¯ C&#x2F;C++ç¨‹åºå°±ä¸€å®šä¼šç”¨åˆ°è¿è¡Œæ—¶åº“æä¾›çš„åŠŸèƒ½ï¼‰ï¼Œå°±è¦é“¾æ¥ C&#x2F;C++è¿è¡Œæ—¶åº“ã€‚æˆ‘ä»¬å¯ä»¥è‡ªä¸»é€‰æ‹©æ˜¯é“¾æ¥â€œé™æ€åº“â€è¿˜æ˜¯â€œåŠ¨æ€åº“â€ï¼Œæ˜¯é“¾æ¥â€œdebug ç‰ˆæœ¬â€çš„è¿˜æ˜¯â€œrelease ç‰ˆæœ¬â€çš„ã€‚ äºŒã€å¦‚ä½•é“¾æ¥è¿è¡Œæ—¶åº“å¤§å®¶å¯èƒ½æ³¨æ„åˆ°æˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘ä¸­ä»æ¥æ²¡æœ‰æ˜¾å¼çš„æ¥é“¾æ¥è¿™äº›åº“ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆäº†ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬æä¾›äº†ä¾¿åˆ©ï¼Œæˆ‘ä»¬åªéœ€è¦å‘ç¼–è¯‘å™¨æŒ‡å®šç‰¹å®šçš„ç¼–è¯‘é€‰é¡¹ï¼ˆå¦‚MTã€MDã€MTdã€MDdï¼‰ï¼Œç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨é“¾æ¥å¯¹åº”çš„åº“ã€‚ åŒæ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®MTå’ŒMDæ¥å®šä¹‰ç›¸åº”çš„é¢„å¤„ç†å®ï¼šMT å¯¹åº” _MTå®ï¼ŒMDå¯¹åº”_MDå®ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬é€šè¿‡Visual Studioå¼€å‘ C&#x2F;C++ç¨‹åºæ—¶ï¼Œåœ¨å·¥ç¨‹å±æ€§ä¸­é…ç½®â€œè¿è¡Œåº“â€ä¸ºMTã€MDã€MTdã€MDdä¸­çš„ä¸€ä¸ªï¼šå°±ç›¸å½“äºé—´æ¥çš„å‘ç¼–è¯‘å™¨æŒ‡å®šç¼–è¯‘é€‰é¡¹å’Œå®šä¹‰ç›¸åº”çš„å®ã€‚ ä¸‰ã€ä¸åŒç‰ˆæœ¬å’Œå½¢æ€çš„è¿è¡Œæ—¶åº“3.1 è¿è¡Œæ—¶åº“å¯¹åº”çš„æ–‡ä»¶ä¸‹è¡¨åˆ—å‡ºå„ç§ç¼–è¯‘é€‰é¡¹çš„å«ä¹‰ä»¥åŠå¯¹åº”çš„åº“æ–‡ä»¶ï¼š ç±»å‹ å…¨ç§° å«ä¹‰ å¯¹åº”çš„åº“æ–‡ä»¶ å¤‡æ³¨ ML Single-Threaded Release ç‰ˆçš„å•çº¿ç¨‹é™æ€åº“ libc.lib ä» VS2005 èµ·è¢«åºŸå¼ƒ MLd Single-Threaded Debug Debug ç‰ˆçš„å•çº¿ç¨‹é™æ€åº“ libcd.lib ä» VS2005 èµ·è¢«åºŸå¼ƒ MT Multi-threaded Release ç‰ˆçš„å¤šçº¿ç¨‹é™æ€åº“ libcmt.lib MTd Multi-threaded Debug Debug ç‰ˆçš„å¤šçº¿ç¨‹é™æ€åº“ libcmtd.lib MD Multi-threaded DLL Release ç‰ˆçš„å¤šçº¿ç¨‹åŠ¨æ€åº“ msvcrt.lib + msvcrxxx.dll msvcprt.lib+msvcpxxx.dll MDd Multi-threaded DLL Debug Debug ç‰ˆçš„å¤šçº¿ç¨‹åŠ¨æ€åº“ msvcrtd.lib + msvcrxxxd.dll msvcprtd.lib + msvcpxxxd.dll å¦‚æœè®¡ç®—æœºä¸Šå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„ VC++è¿è¡Œç¯å¢ƒï¼ˆæˆ–è€…å¤šä¸ªç‰ˆæœ¬çš„ Visual Studioï¼‰ï¼Œåˆ™ç›¸åŒåç§°çš„ lib æˆ– dll å°±ä¼šå­˜åœ¨å¤šä»½ã€‚å¦‚msvcrt.libæ–‡ä»¶ï¼š 3.2 è¿è¡Œæ—¶åº“æ–‡ä»¶å‘½åè§„åˆ™msvcr100d.dllä¸ºä¾‹ï¼š 123456ms = Microsoftv = Visualc = C Programr = Run-time100 = Versiond = Debug (ä¸å¸¦då³ä¸ºreleaseç‰ˆæœ¬) msvcp100d.dllä¸ºä¾‹ï¼š 12345ms = Microsoftv = Visualcp = C Plus Plus å³C++100 = Versiond = Debug (ä¸å¸¦då³ä¸ºreleaseç‰ˆæœ¬) å››ã€è¿è¡Œæ—¶åº“ä½¿ç”¨æ³¨æ„äº‹é¡¹ ä¸è¦æ··åˆä½¿ç”¨è¿è¡Œæ—¶åº“çš„é™æ€åº“ç‰ˆå’ŒåŠ¨æ€åº“ç‰ˆã€‚ ä¸è¦æ··åˆä½¿ç”¨è¿è¡Œæ—¶åº“çš„debugç‰ˆå’Œreleaseç‰ˆã€‚ ä¸è¦æ··åˆä½¿ç”¨ Visual Studio 2013 åŠæ›´æ—©ç‰ˆæœ¬çš„è¿è¡Œæ—¶åº“ï¼Œä½†åœ¨ Visual Studio 2015 åŠæ›´é«˜ç‰ˆæœ¬ä¸­æä¾›çš„è¿è¡Œæ—¶åº“å¯ä»¥ä¿è¯äºŒè¿›åˆ¶å…¼å®¹ã€‚ äº”ã€Visual Studio ç‰ˆæœ¬ä¹‹é—´çš„ C++ äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼ˆæ‘˜è‡ª MSDNï¼‰ åŸæ–‡é“¾æ¥ï¼šbinary-compat-2015-2017 Visual Studio 2013 åŠæ›´æ—©ç‰ˆæœ¬ä¸­çš„ Microsoft C++ (MSVC) ç¼–è¯‘å™¨å·¥å…·é›†ä¸ä¿è¯ä¸»ç‰ˆæœ¬é—´çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ æ— æ³•é“¾æ¥ç”±è¿™äº›å·¥å…·é›†çš„ä¸åŒç‰ˆæœ¬ç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶ã€é™æ€åº“ã€åŠ¨æ€åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ABIã€å¯¹è±¡æ ¼å¼å’Œè¿è¡Œæ—¶åº“ä¸å…¼å®¹ã€‚ æˆ‘ä»¬åœ¨ Visual Studio 2015 åŠæ›´é«˜ç‰ˆæœ¬ä¸­æ”¹å˜äº†æ­¤è¡Œä¸ºã€‚ ç”±å…¶ä¸­ä»»ä¸€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ç¼–è¯‘çš„è¿è¡Œæ—¶åº“å’Œåº”ç”¨å…·æœ‰äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ è¿™åæ˜ åœ¨ C++ å·¥å…·é›†ä¸»ç‰ˆæœ¬å·ä¸­ï¼Œå¯¹äºè‡ª Visual Studio 2015 ä»¥æ¥çš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å·éƒ½ä»¥ 14 å¼€å¤´ã€‚ ï¼ˆå¯¹äº Visual Studio 2015ã€2017ã€2019 å’Œ 2022ï¼Œå·¥å…·é›†ç‰ˆæœ¬åˆ†åˆ«ä¸º v140ã€v141ã€v142 å’Œ v143ï¼‰ã€‚** å‡è®¾ä½ å…·æœ‰ Visual Studio 2015 ç”Ÿæˆçš„ç¬¬ä¸‰æ–¹åº“ã€‚ ä½ ä»å¯åœ¨ Visual Studio 2017ã€2019 æˆ– 2022 ç”Ÿæˆçš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚ æ— éœ€ä½¿ç”¨åŒ¹é…å·¥å…·é›†é‡æ–°ç¼–è¯‘**ã€‚ æœ€æ–°ç‰ˆæœ¬çš„ Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…ï¼ˆå¯å†å‘è¡Œç¨‹åºåŒ…ï¼‰é€‚ç”¨äºæ‰€æœ‰ç‰ˆæœ¬ã€‚ å¯¹äºŒè¿›åˆ¶å…¼å®¹æ€§çš„é™åˆ¶v140ã€v141ã€v142 å’Œ v143 å·¥å…·é›†ä¸æ¬¡è¦ç‰ˆæœ¬å·æ›´æ–°ä¹‹é—´çš„äºŒè¿›åˆ¶å…¼å®¹æ€§æ–¹é¢å­˜åœ¨ä¸‰ä¸ªé‡è¦é™åˆ¶ï¼š ä½ å¯ä»¥æ··åˆä½¿ç”¨ç”± v140ã€v141ã€v142 å’Œ v143 å·¥å…·é›†çš„ä¸åŒç‰ˆæœ¬ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œå¿…é¡»ä½¿ç”¨è‡³å°‘ä¸åº”ç”¨ä¸­æœ€æ–°äºŒè¿›åˆ¶æ–‡ä»¶åŒæ ·æ–°çš„å·¥å…·é›†è¿›è¡Œé“¾æ¥ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼šå¯ä»¥å°†ä½¿ç”¨ä»»ä½• 2017 å·¥å…·é›†ï¼ˆv141ï¼Œç‰ˆæœ¬ 15.0 åˆ° 15.9ï¼‰ç¼–è¯‘çš„åº”ç”¨é“¾æ¥åˆ°ä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.2 (v142) ç¼–è¯‘çš„é™æ€åº“ã€‚ åªæ˜¯å¿…é¡»ä½¿ç”¨ç‰ˆæœ¬ 16.2 æˆ–æ›´é«˜ç‰ˆæœ¬å·¥å…·é›†é“¾æ¥å®ƒä»¬ã€‚ åªè¦ä½¿ç”¨ 16.4 æˆ–æ›´é«˜ç‰ˆæœ¬å·¥å…·é›†ï¼Œä¾¿å¯ä»¥å°†ç‰ˆæœ¬ 16.2 åº“é“¾æ¥åˆ°ç‰ˆæœ¬ 16.4 åº”ç”¨ã€‚ åº”ç”¨ä½¿ç”¨çš„å¯å†å‘è¡Œç¨‹åºåŒ…å…·æœ‰ç±»ä¼¼çš„äºŒè¿›åˆ¶å…¼å®¹æ€§é™åˆ¶ã€‚ æ··åˆä½¿ç”¨ç”±å·¥å…·é›†çš„ä¸åŒå—æ”¯æŒç‰ˆæœ¬ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯å†å‘è¡Œç¨‹åºåŒ…ç‰ˆæœ¬å¿…é¡»è‡³å°‘ä¸ä»»ä½•åº”ç”¨ç»„ä»¶ä½¿ç”¨çš„æœ€æ–°å·¥å…·é›†ä¸€æ ·æ–°ã€‚ ä½¿ç”¨&#x2F;GLï¼ˆå…¨ç¨‹åºä¼˜åŒ–ï¼‰ç¼–è¯‘å™¨å¼€å…³ç¼–è¯‘æˆ–æ˜¯ä½¿ç”¨ &#x2F;LTCGï¼ˆé“¾æ¥æ—¶é—´ä»£ç ç”Ÿæˆï¼‰é“¾æ¥çš„é™æ€åº“æˆ–å¯¹è±¡æ–‡ä»¶ä¸åœ¨å„ä¸ªç‰ˆæœ¬é—´äºŒè¿›åˆ¶å…¼å®¹ï¼ˆåŒ…æ‹¬æ¬¡è¦ç‰ˆæœ¬æ›´æ–°ï¼‰ã€‚ä½¿ç”¨ /GL å’Œ /LTCG ç¼–è¯‘çš„æ‰€æœ‰å¯¹è±¡æ–‡ä»¶å’Œåº“å¿…é¡»å°†å®Œå…¨ç›¸åŒçš„å·¥å…·é›†ç”¨äºç¼–è¯‘å’Œæœ€ç»ˆé“¾æ¥ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.7 å·¥å…·é›†ä¸­çš„ /GLç”Ÿæˆçš„ä»£ç æ— æ³•é“¾æ¥åˆ°ä½¿ç”¨ Visual Studio 2019 ç‰ˆæœ¬ 16.8 å·¥å…·é›†ä¸­çš„ /GLç”Ÿæˆçš„ä»£ç ã€‚ ç¼–è¯‘å™¨ä¼šå‘å‡ºé”™è¯¯ C1047ã€‚ ä» Visual Studio 2015 åŠæ›´é«˜ç‰ˆæœ¬å‡çº§ Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…å¯¹äº Visual Studio 2015ã€2017ã€2019 å’Œ 2022ï¼Œæˆ‘ä»¬ä½¿ Microsoft Visual C++ å¯å†å‘è¡Œç¨‹åºåŒ…ä¸»ç‰ˆæœ¬å·ä¿æŒç›¸åŒã€‚ è¿™æ„å‘³ç€ä¸€æ¬¡åªèƒ½å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…çš„ä¸€ä¸ªå®ä¾‹ã€‚ è¾ƒæ–°ç‰ˆæœ¬ä¼šè¦†ç›–å·²å®‰è£…çš„ä»»ä½•è¾ƒæ—§ç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªåº”ç”¨å¯èƒ½ä¼šä» Visual Studio 2015 å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ éšåå¦ä¸€ä¸ªåº”ç”¨ä» Visual Studio 2022 å®‰è£…å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ 2022 ç‰ˆæœ¬ä¼šè¦†ç›–è¾ƒæ—§ç‰ˆæœ¬ï¼Œä½†ç”±äºå®ƒä»¬å…·æœ‰äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼Œæ—©æœŸåº”ç”¨ä»å¯æ­£å¸¸å·¥ä½œã€‚ æˆ‘ä»¬ç¡®ä¿æœ€æ–°ç‰ˆæœ¬çš„å¯å†å‘è¡Œç¨‹åºåŒ…å…·æœ‰æ‰€æœ‰æœ€æ–°çš„åŠŸèƒ½ã€å®‰å…¨æ›´æ–°å’Œ bug ä¿®è¡¥ç¨‹åºã€‚ è¿™ä¾¿æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å§‹ç»ˆå»ºè®®å‡çº§åˆ°æœ€æ–°å¯ç”¨ç‰ˆæœ¬ã€‚ åŒæ ·ï¼Œå·²å®‰è£…äº†è¾ƒæ–°ç‰ˆæœ¬æ—¶ï¼Œæ— æ³•å®‰è£…è¾ƒæ—§çš„å¯å†å‘è¡Œç¨‹åºåŒ…ã€‚ å¦‚æœå°è¯•ï¼Œåˆ™å®‰è£…ç¨‹åºä¼šæŠ¥å‘Šé”™è¯¯ã€‚ å¦‚æœåœ¨å·²å…·æœ‰ 2022 ç‰ˆæœ¬çš„è®¡ç®—æœºä¸Šå®‰è£… 2017 æˆ– 2019 å¯å†å‘è¡Œç¨‹åºï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é”™è¯¯ï¼š 10x80070666 - Another version of this product is already installed. Installation of this version cannot continue. To configure or remove the existing version of this product, use Add/Remove Programs on the Control Panel. æ­¤é”™è¯¯æ˜¯è®¾è®¡ä½¿ç„¶ã€‚ å»ºè®®ä¿æŒå®‰è£…æœ€æ–°ç‰ˆæœ¬ã€‚ è¯·ç¡®ä¿å®‰è£…ç¨‹åºå¯ä»¥åœ¨æ— æç¤ºçš„æƒ…å†µä¸‹ä»æ­¤é”™è¯¯ä¸­æ¢å¤ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["è¿è¡Œæ—¶åº“","MSVC"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowsæ³¨å…¥ä¸æ‹¦æˆª(2)-æ³¨å…¥æ–¹å¼","path":"/post/721636578.html","content":"ä¸€ã€æ³¨å†Œè¡¨æ–¹å¼1.1 æ³¨å…¥æ–¹æ³•å¦‚é¢˜ï¼Œé€šè¿‡æ³¨å†Œè¡¨çš„æ–¹å¼æ¥å®ç° DLL æ³¨å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦é’ˆå¯¹ç‰¹å®šçš„æ³¨å†Œè¡¨é¡¹è¿›è¡Œä¿®æ”¹å³å¯ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœè¢«æ³¨å…¥çš„è¿›ç¨‹æ˜¯ 64 ä½è¿›ç¨‹ï¼Œåˆ™æ³¨å…¥çš„ DLL ä¹Ÿéœ€è¦æ˜¯ 64 ä½çš„ã€‚åŒç†ï¼Œæ³¨å…¥åˆ° 32 ä½çš„è¿›ç¨‹ä¹Ÿéœ€è¦æ˜¯ 32 ä½çš„ DLLã€‚ å¦å¤–ï¼Œæ ¹æ®è¢«æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„ä½æ•°ï¼ˆ32 æˆ– 64ï¼‰ä¸åŒï¼Œæ³¨å†Œè¡¨çš„ä½ç½®ä¹Ÿä¸åŒã€‚ 1.1.1 æ³¨å…¥ 64 ä½ç³»ç»Ÿä¸Šçš„ 32 ä½è¿›ç¨‹åœ¨64ä½Windowsç³»ç»Ÿä¸Šï¼Œå°†DLLæ³¨å…¥åˆ°32ä½è¿›ç¨‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å°†è¢«æ³¨å…¥çš„ DLL åç§°å¡«å…¥åˆ°AppInit_DLLsæ³¨å†Œè¡¨é¡¹ï¼š 1HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs AppInit_DLLsä¸­çš„æ–‡ä»¶åé€šè¿‡é€—å·æˆ–ç©ºæ ¼æ¥åˆ†å‰²ï¼Œåœ¨æ–‡ä»¶åä¸­è¦é¿å…ä½¿ç”¨ç©ºæ ¼ã€‚ å¦å¤–AppInit_DLLsä¸­çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¯ä»¥åŒ…å«è·¯å¾„ï¼Œè€Œåé¢çš„æ–‡ä»¶çš„è·¯å¾„åˆ™å°†è¢«å¿½ç•¥ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬æœ€å¥½å°† DLL æ–‡ä»¶æ”¾åˆ° Windows çš„ç³»ç»Ÿç›®å½•ä¸­ã€‚ å¹¶å°†LoadAppInit_DLLsæ³¨å†Œè¡¨é¡¹çš„å€¼ä¿®æ”¹ä¸º1ï¼š 1HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs 1.1.2 æ³¨å…¥ 64 ä½è¿›ç¨‹åœ¨64ä½Windowsç³»ç»Ÿä¸Šï¼Œå°†DLLæ³¨å…¥åˆ°64ä½è¿›ç¨‹ï¼Œæ­¥éª¤ä¸â€œæ³¨å…¥ 64 ä½ç³»ç»Ÿä¸Šçš„ 32 ä½è¿›ç¨‹â€ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š æ³¨å†Œè¡¨ä½ç½®ä¸ä¸€æ ·ï¼Œæ³¨å…¥ 64 ä½è¿›ç¨‹çš„æ³¨å†Œè¡¨åˆ†åˆ«ä½äºï¼š 123HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLsHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs è¢«æ³¨å…¥ DLL éœ€è¦æ˜¯ 64 ä½ç‰ˆæœ¬ã€‚ 1.2 åŸç†ä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹å¼å®ç°DLLæ³¨å…¥å‘¢ï¼Ÿ å½“ç³»ç»Ÿçš„User32.dllè¢«åŠ è½½åˆ°æ–°è¿›ç¨‹æ—¶ï¼Œä¼šåœ¨DLL_PROCESS_ATTACHé€šçŸ¥å¤„ç†è¿‡ç¨‹ä¸­è¯»å–AppInit_DLLsæ³¨å†Œè¡¨å€¼ï¼Œå¹¶ä¾æ¬¡åŠ è½½è¯¥é¡¹ä¸­çš„æ¯ä¸ª DLLã€‚ 1.3 å¼Šç«¯è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿ ä¾æ®ä¸Šé¢ä¸€èŠ‚çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¢«æ³¨å…¥çš„ DLL æ˜¯é€šè¿‡ User32.dll åŠ è½½åˆ°ç›®æ ‡è¿›ç¨‹ä¸­å»çš„ï¼Œè¿™ä¹Ÿå°±è¦æ±‚è¢«æ³¨å…¥çš„ç›®æ ‡è¿›ç¨‹å¿…é¡»ä½¿ç”¨äº† User32.dllï¼Œè™½ç„¶åŸºäº GUI çš„ç¨‹åºéƒ½ä¼šä½¿ç”¨è¿™ä¸ª DLL æ–‡ä»¶ï¼Œä½†å‘½ä»¤è¡Œç¨‹åºä¸€èˆ¬ä¸ä¼šåŠ è½½ User32.dllï¼Œæ‰€ä»¥å¯èƒ½æ— æ³•é€šè¿‡è¿™ç§æ–¹å¼è¢«æ³¨å…¥ã€‚ è€Œä¸”è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç³»ç»Ÿä¸Šæ‰€æœ‰ä½¿ç”¨äº† User32.dll çš„ç¨‹åºéƒ½ä¼šè¢«æ³¨å…¥DLLï¼Œå¾ˆå¤šæ—¶å€™è¿™ä¹Ÿå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚ äºŒã€æ¶ˆæ¯é’©å­æ–¹å¼2.1 é’©å­æŠ€æœ¯Windows æä¾›äº†ä¸‰ä¸ª API è®©æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿ä½¿ç”¨é’©å­æŠ€æœ¯å°† DLL æ–‡ä»¶æ³¨å…¥åˆ°è¿›ç¨‹ä¹‹ä¸­ï¼š 1234567891011121314151617// å®‰è£…æŒ‡å®šæ¶ˆæ¯ç±»å‹çš„é’©å­åˆ°é’©å­é“¾ä¸­HHOOK SetWindowsHookEx(int idHook, HOOKPROC lpfn, HINSTANCE hMod, DWORD dwThreadId);// ä»é’©å­é“¾ä¸­åˆ é™¤é’©å­BOOL UnhookWindowsHookEx(HHOOK hhk);// å°†æ¶ˆæ¯è½¬å‘åˆ°é’©å­é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªé’©å­LRESULT CallNextHookEx(HHOOK hhk, int nCode, WPARAM wParam, LPARAM lParam); Hookä¸­æ–‡åâ€œé’©å­â€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªâ€œé±¼é’©â€ï¼Œç”¨æ¥é’©ä½æŒ‡å®šç±»å‹çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šâ€œé’©å­â€éœ€è¦é’©ä½å“ªä¸ªçº¿ç¨‹çš„æ¶ˆæ¯ï¼Œå¯ä»¥æ˜¯å½“å‰çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰€æœ‰çº¿ç¨‹ã€‚ å½“â€œæŒ‡å®šçº¿ç¨‹â€çš„â€œæŒ‡å®šæ¶ˆæ¯â€è¢«é’©ä½æ—¶ï¼Œç³»ç»Ÿå°±ä¼šå°†æˆ‘ä»¬çš„ DLLï¼ˆå¦‚æœé’©å­çš„å¤„ç†è¿‡ç¨‹ä½äº DLL ä¸­ï¼‰åŠ è½½åˆ°è¯¥çº¿ç¨‹æ‰€å±è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œå¹¶ä¸”åœ¨è¯¥åœ°å€ç©ºé—´ä¸­è°ƒç”¨æˆ‘ä»¬çš„ DLL ä¸­çš„é’©å­å¤„ç†è¿‡ç¨‹å‡½æ•°ï¼Œä»è€Œå®ç°æ³¨å…¥åŠŸèƒ½ã€‚ æˆ‘ä»¬é€šè¿‡SetWindowsHookExå‡½æ•°æ¥å®‰è£…ä¸€ä¸ªé’©å­ï¼Œæ“ä½œç³»ç»ŸåŒæ—¶ä¹Ÿå…è®¸å¼€å‘äººå‘˜ä¸ºâ€œåŒä¸€ä¸ªçº¿ç¨‹â€çš„â€œåŒä¸€ä¸ªæ¶ˆæ¯ç±»å‹â€æŒ‡å®šå¤šä¸ªé’©å­ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªâ€œé’©å­é“¾â€ï¼ˆHook Chainï¼‰ã€‚ 2.1.1 SetWindowsHookEx123456HHOOK SetWindowsHookExA( [in] int idHook, [in] HOOKPROC lpfn, [in] HINSTANCE hmod, [in] DWORD dwThreadId); idHookå‚æ•°ï¼šæŒ‡å®šæˆ‘ä»¬éœ€è¦å‹¾ä½çš„æ¶ˆæ¯ç±»å‹ï¼› lpfnå‚æ•°ï¼šå‡½æ•°æŒ‡é’ˆã€‚å½“ idHook æŒ‡å®šçš„æ¶ˆæ¯è§¦å‘æ—¶ï¼Œç³»ç»Ÿå°†ä¼šè°ƒç”¨ lpfn å‡½æ•°æŒ‡é’ˆã€‚ hModå‚æ•°ï¼šlpfn å‡½æ•°æŒ‡é’ˆæ‰€åœ¨ DLL çš„å¥æŸ„ã€‚æœ‰ 2 ç§æƒ…å†µä¸‹è¿™ä¸ªå‚æ•°éœ€è¦ä¼  NULLï¼š lpfn å‡½æ•°çš„ä»£ç ä½äºæœ¬è¿›ç¨‹å†…æ—¶ã€‚ åªéœ€è¦å‹¾ä½æœ¬è¿›ç¨‹çš„æ¶ˆæ¯æ—¶ï¼Œå³ dwThreadId å‚æ•°æŒ‡å®šçš„çº¿ç¨‹ä½äºå½“å‰è¿›ç¨‹ã€‚ dwThreadIdå‚æ•°ï¼šçº¿ç¨‹ IDï¼Œç”¨äºæŒ‡å®šå‹¾ä½å“ªä¸ªçº¿ç¨‹çš„æ¶ˆæ¯ã€‚å¦‚æœä¼  0ï¼Œåˆ™è¡¨ç¤ºå‹¾ä½æ‰€æœ‰çº¿ç¨‹çš„æŒ‡å®šæ¶ˆæ¯ã€‚ SetWindowsHookEx è¯¦ç»†çš„å‚æ•°è§£é‡Šå¯ä»¥å‚è€ƒ MSDNã€‚ 2.1.2 CallNextHookExå½“æˆ‘ä»¬çš„é’©å­å¤„ç†å‡½æ•°ï¼ˆç”±lpfnå‚æ•°æŒ‡å®šï¼‰å°†æ¶ˆæ¯å¤„ç†å®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œä¸è®©é’©å­é“¾åé¢çš„é’©å­è¿›è¡Œå¤„ç†ï¼›ä¹Ÿå¯ä»¥åœ¨é’©å­å¤„ç†å‡½æ•°çš„æœ€åè°ƒç”¨CallNextHookExå‡½æ•°ï¼Œè®©æ¶ˆæ¯ç»§ç»­ä¼ é€’ä¸‹å»ï¼Œä»è€Œè®©å…¶ä»–é’©å­æœ‰å¤„ç†çš„æœºä¼šã€‚ 2.1.3 UnhookWindowsHookExUnhookWindowsHookExå‡½æ•°ç”¨äºå°†æŒ‡å®šé’©å­ä»é’©å­é“¾ä¸­ç§»é™¤ã€‚ å³ä½¿ä¸è°ƒç”¨UnhookWindowsHookExï¼Œåœ¨è°ƒç”¨SetWindowsHookExçš„è¿›ç¨‹é€€å‡ºåï¼Œé’©å­ä¹Ÿå°†è¢«è‡ªåŠ¨ç§»é™¤ã€‚ 2.2 é’©å­å®ä¾‹SetWindowsHookExå‡½æ•°è¿”å›ä¸€ä¸ªHHOOKç±»å‹çš„é’©å­å¥æŸ„ï¼ŒCallNextHookExå’ŒUnhookWindowsHookExå‡½æ•°éƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªå¥æŸ„ä½œä¸ºå‚æ•°ã€‚ å¦‚æœæˆ‘ä»¬å°†â€œæ³¨å…¥é€»è¾‘â€æ”¾åœ¨ç‹¬ç«‹çš„ exe ä¸­ï¼Œå°†â€œé’©å­å¤„ç†è¿‡ç¨‹â€æ”¾åˆ°ç‹¬ç«‹çš„ dll ä¸­ï¼Œé‚£ä¹ˆä¸ºäº†åœ¨â€œé’©å­å¤„ç†è¿‡ç¨‹â€ä¸­è°ƒç”¨CallNextHookExæ—¶èƒ½å¤Ÿæ‹¿åˆ°é’©å­çš„å¥æŸ„ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å…¶ä»–é€”å¾„å°†è¯¥å¥æŸ„ä» exe ä¼ é€’åˆ° dll ä¸­ã€‚ æ‰€ä»¥ä¸ºäº†é¿å…ä¼ é€’â€œé’©å­å¥æŸ„â€çš„éº»çƒ¦ï¼Œæˆ‘ä»¬å°†â€œæ³¨å…¥é€»è¾‘â€å’Œâ€œé’©å­å¤„ç†è¿‡ç¨‹â€éƒ½å†™å…¥åˆ°ä¸€ä¸ª DLL ä¹‹ä¸­ã€‚æˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¿™ä¸ª DLL çš„å¯¼å‡ºå‡½æ•°å°±å¯ä»¥å°†è¿™ä¸ª DLL æ³¨å…¥åˆ°æŒ‡å®šçº¿ç¨‹æ‰€å±çš„è¿›ç¨‹ä¸­ã€‚ ç¤ºä¾‹ DLL åç§°ä¸ºInjectDLLï¼Œç”¨äºå‹¾ä½æŒ‡å®šçª—å£çš„WH_GETMESSAGEæ¶ˆæ¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„æ¶ˆæ¯ç±»å‹ï¼Œå¦‚é”®ç›˜æ¶ˆæ¯ç­‰ã€‚å®Œæ•´çš„æ¶ˆæ¯ç±»å‹å¯ä»¥å‚è€ƒ MSDN ä¸Šå…³äºSetWindowsHookExå‡½æ•°çš„è§£é‡Šã€‚ InjectDLLç¤ºä¾‹å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495#include &lt;stdio.h&gt;#include &lt;windows.h&gt;#include &lt;tchar.h&gt;HHOOK g_hook = NULL;BOOL APIENTRY DllMain(HMODULE hModule, DWORD fdwReason, LPVOID lpReserved) &#123; switch(fdwReason) &#123; case DLL_PROCESS_ATTACH: &#123; break; &#125; case DLL_THREAD_ATTACH: &#123; break; &#125; case DLL_THREAD_DETACH: &#123; break; &#125; case DLL_PROCESS_DETACH: &#123; break; &#125; &#125; return TRUE;&#125;// ææƒå‡½æ•°// å‚è€ƒï¼šhttps://blog.csdn.net/china_jeffery/article/details/79173417//BOOL EnablePrivilege(LPCTSTR szPrivilege, BOOL fEnable) &#123; BOOL fOk = FALSE; HANDLE hToken = NULL; if (OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES, &amp;hToken)) &#123; TOKEN_PRIVILEGES tp; tp.PrivilegeCount = 1; LookupPrivilegeValue(NULL, szPrivilege, &amp;tp.Privileges[0].Luid); tp.Privileges-&gt;Attributes = fEnable ? SE_PRIVILEGE_ENABLED : 0; AdjustTokenPrivileges(hToken, FALSE, &amp;tp, sizeof(TOKEN_PRIVILEGES), NULL, NULL); fOk = (GetLastError() == ERROR_SUCCESS); CloseHandle(hToken); &#125; return fOk;&#125;// é’©å­å¤„ç†è¿‡ç¨‹LRESULT CALLBACK HookProc_GetMsg(int code, WPARAM wParam, LPARAM lParam) &#123; char szMsg[512] = &#123; 0 &#125;; sprintf_s(szMsg, 512, &quot;code: %d, wParam: %d, lParam: %d&quot;, code, wParam, lParam); OutputDebugStringA(szMsg); return CallNextHookEx(g_hook, code, wParam, lParam);;&#125;// å¯¼å‡ºå‡½æ•°ï¼Œå®‰è£…é’©å­HHOOK InjectDllByHook(HWND hwnd) &#123; DWORD dwThreadId = 0; HHOOK hHook = NULL; __try &#123; if (!EnablePrivilege(SE_DEBUG_NAME, TRUE)) &#123; __leave; &#125; // é€šè¿‡çª—å£å¥æŸ„è·å–åˆ°çª—å£æ‰€å±çº¿ç¨‹ dwThreadId = GetWindowThreadProcessId(hwnd, NULL); if (dwThreadId == 0) &#123; __leave; &#125; // è·å–DLLè‡ªèº«çš„å¥æŸ„ HMODULE hModule = NULL; GetModuleHandleExW( GET_MODULE_HANDLE_EX_FLAG_FROM_ADDRESS | GET_MODULE_HANDLE_EX_FLAG_UNCHANGED_REFCOUNT, (LPCWSTR)InjectDllByHook, &amp;hModule); hHook = SetWindowsHookEx(WH_GETMESSAGE, (HOOKPROC)HookProc_GetMsg, hModule, dwThreadId); &#125; __finally &#123; &#125; return (hHook);&#125;// å¯¼å‡ºå‡½æ•°ï¼Œå¸è½½é’©å­BOOL EjectDllByHook(HHOOK hook) &#123; return UnhookWindowsHookEx(hook);&#125; ç›´æ¥è°ƒç”¨è¯¥ DLL çš„å¯¼å‡ºå‡½æ•°InjectDllByHookï¼Œå®ç°å®‰è£…é’©å­å¹¶HookæŒ‡å®šçª—å£çš„æŒ‡å®šæ¶ˆæ¯ã€‚å½“æŒ‡å®šçª—å£æ¶ˆæ¯è¢«å‹¾ä½æ—¶ï¼Œæˆ‘ä»¬çš„ DLL ä¹Ÿå°±ä¼šè¢«åŠ è½½åˆ°äº†çª—å£æ‰€å±çš„è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œä»è€Œå®ç°æ³¨å…¥ã€‚ ä¸‰ã€è¿œç¨‹çº¿ç¨‹æ–¹å¼3.1 è¿œç¨‹çº¿ç¨‹åŸç†â€œæ³¨å†Œè¡¨æ³¨å…¥æ–¹å¼â€ç”±äºä¸èƒ½ç²¾ç¡®æŒ‡å®šéœ€è¦æ³¨å…¥çš„ç›®æ ‡è¿›ç¨‹ï¼Œè€Œä¸”åªèƒ½æ³¨å…¥åˆ° GUI ç¨‹åºä¸­ï¼Œçµæ´»æ€§è¾ƒå·®ï¼› â€œé’©å­æ³¨å…¥æ–¹å¼â€è™½ç„¶èƒ½å¤Ÿç²¾ç¡®æŒ‡å®šè¢«æ³¨å…¥çš„ç›®æ ‡çº¿ç¨‹ï¼Œä½†åªèƒ½é’ˆå¯¹ç‰¹å®šç±»å‹çš„çª—å£æ¶ˆæ¯è¿›è¡Œ Hookï¼Œå¯¹äºç±»ä¼¼ Windows æœåŠ¡è¿™æ ·çš„éGUIç¨‹åºå°±æŸæ‰‹æ— ç­–äº†ã€‚ æœ¬èŠ‚ä»‹ç»çš„â€œè¿œç¨‹çº¿ç¨‹çš„æ³¨å…¥æ–¹å¼â€æ˜¯åœ¨å®é™…ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„ä¸€ç§æ³¨å…¥æ–¹å¼ï¼Œå®ƒæ—¢å¯ä»¥ç²¾ç¡®æŒ‡å®šéœ€è¦æ³¨å…¥çš„è¿›ç¨‹ï¼Œåˆå¯ä»¥æ³¨å…¥åˆ°é GUI ç¨‹åºä¸­ã€‚ è¿œç¨‹çº¿ç¨‹æ³¨å…¥æ–¹å¼ä½¿ç”¨çš„å…³é”®ç³»ç»Ÿ API ä¸ºCreateRemoteThreadï¼ŒåŸå‹å¦‚ä¸‹ï¼š 123456789HANDLE WINAPI CreateRemoteThread( _In_ HANDLE hProcess, _In_ LPSECURITY_ATTRIBUTES lpThreadAttributes, _In_ SIZE_T dwStackSize, _In_ LPTHREAD_START_ROUTINE lpStartAddress, _In_ LPVOID lpParameter, _In_ DWORD dwCreationFlags, _Out_ LPDWORD lpThreadId); CreateRemoteThreadçš„å‚æ•°å’Œæˆ‘ä»¬å¹³æ—¶åˆ›å»ºæœ¬åœ°çº¿ç¨‹ä½¿ç”¨çš„CreateThreadçš„å‚æ•°ç±»ä¼¼ï¼Œæ–°å¢äº†hProcesså¥æŸ„å‚æ•°ç”¨äºæŒ‡å®šåœ¨å“ªä¸ªè¿›ç¨‹åˆ›å»ºè¿œç¨‹çº¿ç¨‹ï¼Œé€šè¿‡OpenProcesså¯ä»¥è·å–åˆ°è¿›ç¨‹å¥æŸ„ï¼Œä½†éœ€è¦æ³¨æ„æƒé™é—®é¢˜ï¼Œå¯èƒ½ç”±äºæƒé™ä¸è¶³ï¼Œè·å–è¿›ç¨‹å¥æŸ„å¤±è´¥ã€‚ é€šè¿‡è¿œç¨‹çº¿ç¨‹æ–¹å¼å®ç° DLL æ³¨å…¥ä¸»è¦æ˜¯åœ¨lpStartAddresså’ŒlpParameterè¿™ 2 ä¸ªå‚æ•°ä¸Šé¢åšæ–‡ç« ã€‚ lpStartAddresså‚æ•°æ˜¯å‡½æ•°æŒ‡é’ˆç±»å‹ï¼Œä¸ºè¿œç¨‹çº¿ç¨‹çš„å¤„ç†è¿‡ç¨‹å‡½æ•°ï¼Œå‡½æ•°åŸå‹åˆ†åˆ«å¦‚ä¸‹ï¼š 1DWORD WINAPI ThreadProc(LPVOID lpParameter); æˆ‘ä»¬çŸ¥é“åŠ è½½ DLL ä½¿ç”¨çš„ API æ˜¯LoadLibraryAæˆ–LoadLibraryWï¼ŒåŸå‹å¦‚ä¸‹ï¼š 1HMODULE WINAPI LoadLibrary(LPCTSTR lpFileName); å¯¹æ¯”LoadLibraryå’Œçº¿ç¨‹å¤„ç†å‡½æ•°(LPTHREAD_START_ROUTINE)çš„åŸå‹ï¼Œä¸éš¾å‘ç°ä¸¤è€…çš„å‡½æ•°çš„åŸå‹åŸºæœ¬ç›¸åŒã€‚è™½ç„¶ä¸æ˜¯å®Œå…¨ç›¸åŒï¼Œä½†éƒ½æ˜¯æ¥æ”¶ä¸€ä¸ªæŒ‡é’ˆå‚æ•°ï¼Œè€Œä¸”éƒ½æ˜¯è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”è°ƒç”¨çº¦å®šä¹Ÿéƒ½æ˜¯WINAPIã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼ŒæŠŠçº¿ç¨‹å¤„ç†å‡½æ•°çš„åœ°å€è®¾ä¸ºLoadLibraryAæˆ–LoadLibraryWï¼Œå¦‚ï¼š 12345678HANDLE hThread = CreateRemoteThread(hProcessRemote, NULL, 0, LoadLibraryA, &quot;C:\\\\InjectDll.dll&quot;, 0, NULL); å½“CreateRemoteThreadæ‰€åˆ›å»ºçš„çº¿ç¨‹åœ¨è¿œç¨‹è¿›ç¨‹åœ°å€ç©ºé—´ä¸­è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ä¼šç«‹å³è°ƒç”¨LoadLibraryAå‡½æ•°ï¼Œå¹¶ä¼ å…¥ DLL è·¯å¾„çš„åœ°å€ä½œä¸ºå…¶å‚æ•°ï¼Œä»è€Œå®ç°DLLåŠ è½½ã€‚ä½†è¿™è¿˜æ²¡å®Œï¼Œè¯·ç»§ç»­çœ‹ä¸‹é¢ç« èŠ‚ã€‚ 3.2 æ³¨æ„äº‹é¡¹æŒ‰ç…§ä¸Šé¢çš„ä»‹ç»çš„æ–¹æ³•å¾ˆå®¹æ˜“å°±èƒ½å®ç°è¿œç¨‹çº¿ç¨‹æ³¨å…¥ï¼Œå®é™…ä¸Šä¹Ÿçš„ç¡®æ˜¯å¾ˆå®¹æ˜“å®ç°ï¼Œåªæ˜¯è¿˜æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼š LoadLibrary å‡½æ•°åœ°å€ DLL è·¯å¾„å­—ç¬¦ä¸²åœ°å€ å–æ¶ˆæ³¨å…¥ LoadLibrary å‡½æ•°åœ°å€æˆ‘ä»¬ä¸èƒ½å‘ä¸Šé¢çš„ä»£ç é‚£æ ·ç›´æ¥æŠŠLoadLibraryAæˆ–LoadLibraryWä½œä¸ºç¬¬ 4 ä¸ªå‚æ•°ä¼ ç»™CreateRemoteThreadå‡½æ•°ã€‚è¿™æ¶‰åŠæ¨¡å—çš„å¯¼å…¥æ®µç­‰é—®é¢˜ï¼Œå¦‚æœåœ¨è°ƒç”¨CreateRemoteThreadæ—¶ç›´æ¥å¼•ç”¨LoadLibraryAå‡½æ•°åœ°å€ï¼Œè¯¥å¼•ç”¨ä¼šè¢«è§£æä¸ºæˆ‘ä»¬è¢«æ³¨å…¥ DLL çš„å¯¼å…¥æ®µä¸­çš„LoadLibraryAå‡½æ•°åœ°å€ï¼Œå¦‚æœæŠŠè¿™ä¸ªå‡½æ•°åœ°å€ä½œä¸ºè¿œç¨‹çº¿ç¨‹çš„èµ·å§‹åœ°å€ä¼ å…¥ï¼Œå…¶ç»“æœå¾ˆå¯èƒ½æ˜¯è®¿é—®è¿è§„ã€‚ æˆ‘ä»¬å¿…é¡»é€šè¿‡ GetProcAddress æ¥å¾—åˆ°LoadLibraryAçš„ç¡®åˆ‡åœ°å€ï¼Œå¦‚ï¼š 12HMODULE hKernel32 = GetModuleHandle(TEXT(&quot;kernel32.dll&quot;));LPVOID pLoadLibraryAAddr = (LPVOID)GetProcAddress(hKernel32, &quot;LoadLibraryA&quot;); DLL è·¯å¾„å­—ç¬¦ä¸²åœ°å€DLL è·¯å¾„å­—ç¬¦ä¸²&quot;C:\\\\InjectDll.dll&quot;çš„å†…å­˜åœ°å€ä½äºè°ƒç”¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œå¹¶ä¸ä½äºè¢«æ³¨å…¥çš„è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚æ‰€ä»¥ï¼Œå½“LoadLibraryAç”¨è¯¥åœ°å€è®¿é—®è¢«æ³¨å…¥è¿›ç¨‹åœ°å€ç©ºé—´æ—¶ï¼Œä¼šå¯¼è‡´è®¿é—®è¿è§„ã€‚ å¦‚æœå¯¹è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸äº†è§£ï¼Œå¯ä»¥å‚è€ƒï¼šç³»åˆ—æ–‡ç« ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ DLL çš„è·¯å¾„å­—ç¬¦ä¸²å­˜å‚¨åˆ°è¢«æ³¨å…¥è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ã€‚Windows æä¾›çš„VirtualAllocExå‡½æ•°å¯ä»¥å®ç°åœ¨å…¶ä»–è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­åˆ†é…å†…å­˜å—ï¼Œå®ç°è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324// dwProcessIDä¸ºè¢«æ³¨å…¥ç›®æ ‡è¿›ç¨‹çš„è¿›ç¨‹IDhTargeProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID);if (!hTargeProcess) &#123; return;&#125;SIZE_T dllPathSize = strlen(pszDllPath); // pszDllPathå­˜å‚¨äº†DLLçš„è·¯å¾„pVM4DllPath = VirtualAllocEx(hTargeProcess, NULL, dllPathSize, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE);if (!pVM4DllPath) &#123; return;&#125;if (!WriteProcessMemory(hTargeProcess, pVM4DllPath, pszDllPath, dllPathSize, NULL)) &#123; return;&#125; å–æ¶ˆæ³¨å…¥å–æ¶ˆæ³¨å…¥å°±æ˜¯å°† DLL ä»ç›®æ ‡è¿›ç¨‹å¸è½½ï¼Œå¸è½½ DLL æ‰€ç”¨çš„ API æ˜¯FreeLibraryï¼Œä½†æˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸ºç›´æ¥è°ƒç”¨çš„è¯æ˜¯åœ¨æˆ‘ä»¬çš„è¿›ç¨‹ä¸­å¸è½½ DLLï¼Œè€Œä¸æ˜¯ç›®æ ‡è¿›ç¨‹ä¸­å¸è½½ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·è¾¾ä¸åˆ°å¸è½½çš„ç›®çš„ã€‚æˆ‘ä»¬éœ€è¦å’ŒåŠ è½½ DLL æ—¶ä¸€æ ·ï¼Œå°†FreeLibraryçš„åœ°å€ä½œä¸ºç¬¬ 4 ä¸ªå‚æ•°ä¼ ç»™CreateRemoteThreadå‡½æ•°ï¼Œä½†åŒæ ·éœ€è¦é€šè¿‡GetProcAddressæ¥å¾—åˆ°FreeLibraryçš„ç¡®åˆ‡åœ°å€ï¼š 1234PTHREAD_START_ROUTINE pfnThreadRtn = (PTHREAD_START_ROUTINE)GetProcAddress(GetModuleHandle(TEXT(&quot;Kernel32&quot;)), &quot;FreeLibrary&quot;);if(pfnThreadRtn) &#123; hThread = CreateRemoteThread(hProcess, NULL, 0, pfnThreadRtn, me.modBaseAddr, 0, NULL);&#125; 3.3 å®ä¾‹æœ¬å®ä¾‹ä¸­çš„InjectDllByRemoteThreadå’ŒEjectDllByRemoteThreadä¸¤ä¸ªå‡½æ•°ä½¿ç”¨è¿œç¨‹çº¿ç¨‹çš„æ–¹å¼åˆ†åˆ«å®ç°äº†æ³¨å…¥å’Œå–æ¶ˆæ³¨å…¥çš„åŠŸèƒ½ã€‚ 3.3.1 InjectDllByRemoteThread å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859BOOL InjectDllByRemoteThread(DWORD dwProcessID, const char* pszDllPath) &#123; BOOL bRet = FALSE; const DWORD dwThreadSize = 50 * 1024; HANDLE hTargeProcess = NULL; HANDLE hRemoteThread = NULL; PVOID pVM4LoadLibrary = NULL; PVOID pVM4DllPath = NULL; __try &#123; if (!EnablePrivilege(SE_DEBUG_NAME, TRUE)) &#123; __leave; &#125; hTargeProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwProcessID); if (!hTargeProcess) &#123; __leave; &#125; SIZE_T dllPathSize = strlen(pszDllPath); pVM4DllPath = VirtualAllocEx(hTargeProcess, NULL, dllPathSize, MEM_RESERVE | MEM_COMMIT, PAGE_EXECUTE_READWRITE); if (!pVM4DllPath) &#123; __leave; &#125; if (!WriteProcessMemory(hTargeProcess, pVM4DllPath, pszDllPath, dllPathSize, NULL)) &#123; __leave; &#125; HMODULE hKernel32 = GetModuleHandle(TEXT(&quot;kernel32.dll&quot;)); LPVOID pLoadLibraryAAddr = (LPVOID)GetProcAddress(hKernel32, &quot;LoadLibraryA&quot;); hRemoteThread = CreateRemoteThread(hTargeProcess, NULL, 0, (DWORD(WINAPI *)(LPVOID))pLoadLibraryAAddr, pVM4DllPath, 0, NULL); if (!hRemoteThread) &#123; __leave; &#125; WaitForSingleObject(hRemoteThread, INFINITE); DWORD dwExitCode = 0; BOOL B = GetExitCodeThread(hRemoteThread, &amp;dwExitCode); bRet = TRUE; &#125; __finally &#123; if (hTargeProcess &amp;&amp; pVM4DllPath) &#123; VirtualFreeEx(hTargeProcess, pVM4DllPath, dwThreadSize, MEM_RELEASE); &#125; if (hRemoteThread) &#123; CloseHandle(hRemoteThread); &#125; if (hTargeProcess) &#123; CloseHandle(hTargeProcess); &#125; &#125; return bRet;&#125; 3.3.2 EjectDllByRemoteThread å‡½æ•°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162BOOL EjectDllByRemoteThread(DWORD dwProcessID, LPCWSTR pszDllPath) &#123; BOOL bOk = FALSE; HANDLE hTHSnapshot = NULL; HANDLE hProcess = NULL, hThread = NULL; __try &#123; hTHSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPMODULE, dwProcessID); if(hTHSnapshot == INVALID_HANDLE_VALUE) &#123; __leave; &#125; MODULEENTRY32W me = &#123;sizeof(me)&#125;; BOOL bFound = FALSE; BOOL bMoreMods = Module32FirstW(hTHSnapshot, &amp;me); for(; bMoreMods; bMoreMods = Module32NextW(hTHSnapshot, &amp;me)) &#123; bFound = (_wcsicmp(me.szModule, pszDllPath) == 0) || (_wcsicmp(me.szExePath, pszDllPath) == 0); if(bFound) break; &#125; if(!bFound) &#123; __leave; &#125; hProcess = OpenProcess( PROCESS_QUERY_INFORMATION | PROCESS_CREATE_THREAD | PROCESS_VM_OPERATION, // For CreateRemoteThread FALSE, dwProcessID); if(hProcess == NULL) &#123; __leave; &#125; PTHREAD_START_ROUTINE pfnThreadRtn = (PTHREAD_START_ROUTINE) GetProcAddress(GetModuleHandle(TEXT(&quot;Kernel32&quot;)), &quot;FreeLibrary&quot;); if(pfnThreadRtn == NULL) &#123; __leave; &#125; hThread = CreateRemoteThread(hProcess, NULL, 0, pfnThreadRtn, me.modBaseAddr, 0, NULL); if(hThread == NULL) &#123; __leave; &#125; WaitForSingleObject(hThread, INFINITE); bOk = TRUE; &#125; __finally &#123; if(hTHSnapshot != NULL) &#123; CloseHandle(hTHSnapshot); &#125; if(hThread != NULL) &#123; CloseHandle(hThread); &#125; if(hProcess != NULL) &#123; CloseHandle(hProcess); &#125; &#125; return(bOk);&#125; 3.3.3 DllMain å‡½æ•°ä½¿ç”¨è¿œç¨‹çº¿ç¨‹çš„æ–¹å¼è¿›è¡Œ DLL æ³¨å…¥æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ DllMain çš„DLL_PROCESS_ATTACHæ¡ä»¶åˆ†æ”¯å¼€å§‹ä¸šåŠ¡é€»è¾‘ï¼ˆé€šå¸¸ä¼šå¦å¤–åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œå°†ä¸šåŠ¡é€»è¾‘æ”¾åˆ°å­çº¿ç¨‹ä¸­å¤„ç†ï¼‰ï¼Œåœ¨DLL_PROCESS_DETACHæ¡ä»¶åˆ†æ”¯å¤„ç»“æŸä¸šåŠ¡é€»è¾‘ã€‚ 123456789101112131415161718192021222324252627282930313233BOOL APIENTRY DllMain(HMODULE hModule, DWORD fdwReason, LPVOID lpReserved) &#123; HANDLE hThread = NULL; switch(fdwReason) &#123; case DLL_PROCESS_ATTACH: &#123; g_hDllModule = hModule; // ä½¿ç”¨æ³¨å†Œè¡¨æ–¹å¼å’ŒCreateRemoteThreadæ–¹å¼æ³¨å…¥æ—¶ï¼Œä¸€èˆ¬åœ¨æ­¤å¤„åˆ›å»ºçº¿ç¨‹ // hThread = (HANDLE)_beginthreadex(NULL, 0, PluginProc, NULL, 0, NULL); if (hThread) &#123; CloseHandle(hThread); // å…³é—­å¥æŸ„ï¼Œé˜²æ­¢å¥æŸ„æ³„æ¼ &#125; break; &#125; case DLL_THREAD_ATTACH: &#123; break; &#125; case DLL_THREAD_DETACH: &#123; break; &#125; case DLL_PROCESS_DETACH: &#123; // ç»“æŸä¸šåŠ¡é€»è¾‘ // ...... break; &#125; &#125; return TRUE;&#125; å››ã€APCæ–¹å¼TODO","tags":["DLL","æ¶ˆæ¯é’©å­","è¿œç¨‹çº¿ç¨‹","APC"],"categories":["HOOK"]},{"title":"Windowsæ³¨å…¥ä¸æ‹¦æˆª(1)-æ³¨å…¥åŸºç¡€","path":"/post/1504192511.html","content":"ä¸€ã€æ³¨å…¥æŠ€æœ¯çš„ç”¨é€”ä»Windowså†…å­˜ä½“ç³»(1)--è™šæ‹Ÿåœ°å€ç©ºé—´æ–‡ç« ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç§æœ‰çš„åœ°å€ç©ºé—´ã€‚å½“æˆ‘ä»¬ç”¨æŒ‡é’ˆæ¥å¼•ç”¨å†…å­˜æ—¶ï¼ŒæŒ‡é’ˆçš„å€¼è¡¨ç¤ºçš„æ˜¯è¿›ç¨‹è‡ªå·±çš„åœ°å€ç©ºé—´çš„ä¸€ä¸ªè™šæ‹Ÿçš„å†…å­˜åœ°å€ã€‚è¿›ç¨‹ä¸èƒ½é€šè¿‡æŒ‡é’ˆæ¥å¼•ç”¨å…¶ä»–è¿›ç¨‹åœ°å€ç©ºé—´çš„å†…å­˜ã€‚ è¿™ç§è®¾è®¡æå‡äº†æ“ä½œç³»ç»Ÿçš„å¥å£®æ€§å’Œå®‰å…¨æ€§ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ç¼ºé™·ï¼Œå¯èƒ½ä¼šå¼•ç”¨å’Œè¦†ç›–éšæœºåœ°å€å¤„çš„å†…å­˜æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªç¼ºé™·ä¼šå½±å“åˆ°æ“ä½œç³»ç»ŸåŠå…¶ä»–è¿›ç¨‹ã€‚ ç‹¬ç«‹çš„åœ°å€ç©ºé—´æœ‰åˆ©äºç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä½†ä¹Ÿå¸¦æ¥äº†è¯¸å¤šä¸ä¾¿ï¼Œä¸‹é¢åˆ—ä¸¾äº†éœ€è¦è·¨è¶Šè¿›ç¨‹çš„è¾¹ç•Œæ¥è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´çš„æƒ…å†µï¼š æˆ‘ä»¬è¦ä»å¦ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºçš„çª—å£æ¥æ´¾ç”Ÿå­ç±»çª—å£ï¼Œæ¯”å¦‚é™„ç€åœ¨ Windows èµ„æºç®¡ç†å™¨ä¸Šçš„ä¸€äº›å°æ’ä»¶ç­‰ã€‚ æˆ‘ä»¬éœ€è¦å‡å€Ÿå…¶ä»–è¿›ç¨‹ä¹‹ååšæŸäº›äº‹æƒ…ã€‚ æˆ‘ä»¬éœ€è¦è·å–å…¶ä»–è¿›ç¨‹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¦‚åŠ è½½äº†å“ªäº› dll ç­‰ã€‚ æˆ‘ä»¬éœ€è¦å¯¹å…¶ä»–è¿›ç¨‹çš„æŸäº›å‡½æ•°è¿›è¡ŒHOOKã€‚ ä»¥åŠå¹²ä¸€äº›ç¾ç¾çš„äº‹æƒ…â€¦ ä¸ºäº†æ»¡è¶³ä¸Šè¿°éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DLL æ³¨å…¥çš„æŠ€æœ¯ï¼Œå°†æˆ‘ä»¬è‡ªå·±å¼€å‘çš„ DLL æ³¨å…¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œè¿™æ · DLL ä¸­çš„ä»£ç å°±å¯ä»¥åœ¨è¯¥è¿›ç¨‹åœ°å€ç©ºé—´ä¸­æ‰§è¡Œã€‚ äºŒã€ä»€ä¹ˆæ ·çš„ DLL å¯ä»¥è¢«æ³¨å…¥ç†è®ºä¸Šä»»ä½• DLL éƒ½å¯ä»¥è¢«æ³¨å…¥åˆ°å…¶ä»–è¿›ç¨‹ä¹‹ä¸­ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ³¨å…¥åˆ°å…¶ä»–è¿›ç¨‹ä¹‹ä¸­æ˜¯ä¸ºäº†å®ç°æŸäº›åŠŸèƒ½ã€åšæŸäº›äº‹æƒ…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ DLL è¢«æ³¨å…¥ä¹‹åï¼ŒDLL ä¸­çš„åŠŸèƒ½ä»£ç èƒ½å¤Ÿè¢«è‡ªåŠ¨æ‰§è¡Œã€‚ DLL è¢«é¦–æ¬¡è½½å…¥åˆ°è¿›ç¨‹ä¸­æ—¶ï¼Œä¼šæ”¶åˆ°DLL_PROCESS_ATTACHé€šçŸ¥ï¼Œå³è°ƒç”¨DllMainå‡½æ•°ï¼Œå¹¶ä¸”å‚æ•°fdwReasonçš„å€¼è¢«è®¾ä¸ºDLL_PROCESS_ATTACHã€‚ æˆ‘ä»¬å¯ä»¥åœ¨æ”¶åˆ°DLL_PROCESS_ATTACHé€šçŸ¥æ—¶å¼€å§‹æˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ dll çš„æºç ï¼Œåœ¨è¢«æ³¨å…¥æˆåŠŸåï¼ˆå³æ”¶åˆ°DLL_PROCESS_ATTACHé€šçŸ¥æ—¶ï¼‰å¼¹å‡ºæ¶ˆæ¯æç¤ºæ¡†ï¼š 12345678910111213141516171819202122BOOL APIENTRY DllMain(HMODULE hModule, DWORD fdwReason, LPVOID lpReserved ) &#123; switch(fdwReason) &#123; case DLL_PROCESS_ATTACH: &#123; MessageBox(NULL, TEXT(&quot;æˆ‘å·²ç»è¢«æ³¨å…¥å•¦&quot;), TEXT(&quot;ä¿¡æ¯&quot;), MB_ICONINFORMATION); break; &#125; case DLL_THREAD_ATTACH: &#123; break; &#125; case DLL_THREAD_DETACH: &#123; break; &#125; case DLL_PROCESS_DETACH: &#123; break; &#125; &#125; return TRUE;&#125; å¦å¤–ï¼Œå½“ DLL è¢«ä»ç›®æ ‡è¿›ç¨‹å¸è½½æ—¶ï¼ŒDLL ä¼šæ”¶åˆ°DLL_PROCESS_DETACHé€šçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥é€šçŸ¥çš„å¤„ç†è¿‡ç¨‹ä¸­åšæœ€åçš„å–„åå·¥ä½œï¼Œé˜²æ­¢å‡ºç°èµ„æºæ³„æ¼ã€ç¨‹åºå´©æºƒç­‰é—®é¢˜ã€‚","tags":["DLL"],"categories":["HOOK"]},{"title":"äº†è§£DPIç¼©æ”¾","path":"/post/50218900.html","content":"dpi æ˜¯â€œDots Per Inchâ€çš„ç¼©å†™ï¼Œè¡¨ç¤ºæ¯è‹±å¯¸çš„åƒç´ ç‚¹ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯åƒç´ ç‚¹çš„å¯†é›†åº¦ã€‚ dpiä¸æ˜¯ç”¨æ¥è¡¨ç¤ºå±å¹•åˆ†è¾¨ç‡çš„ï¼Œä¹Ÿä¸æ˜¯ç”¨æ¥è¡¨ç¤ºå±å¹•ç‰©ç†å°ºå¯¸çš„ã€‚ dpi = æ€»åƒç´ ç‚¹ / ç‰©ç†é¢ç§¯ æ¯”å¦‚ä¸€ä¸ª 32 å¯¸çš„æ˜¾ç¤ºï¼Œä½†åˆ†è¾¨ç‡åªæœ‰1920*1440ï¼Œè€Œä¸€ä¸ª 24 å¯¸çš„æ˜¾ç¤ºå™¨ï¼Œåˆ†è¾¨ç‡å´è¾¾åˆ°3840*2160ï¼Œå¾ˆæ˜æ˜¾åé¢è¿™ä¸ªæ˜¾ç¤ºå™¨çš„æ¯è‹±å¯¸çš„åƒç´ ç‚¹çš„ä¸ªæ•°å¤šï¼Œæ˜¾ç¤ºçš„ç”»é¢æ›´åŠ ç»†è…»ã€‚æ‰€ä»¥ï¼šé«˜åˆ†è¾¨ç‡ä¸ç­‰äºé«˜ dpiã€‚ è‹¹æœçš„è§†ç½‘è†œå±å¹•çš„æ ¸å¿ƒå°±æ˜¯é«˜ dpiï¼šå±å¹•ç‰©ç†é¢ç§¯å°ï¼Œè€Œåˆ†è¾¨ç‡é«˜è¾¾ 5kï¼Œæ¯è‹±å¯¸çš„åƒç´ ç‚¹ï¼ˆdpiï¼‰å›ºç„¶å¤šï¼Œç”»é¢è‡ªç„¶ç»†è…»ã€‚ è½¯ä»¶æ˜¾ç¤ºå¼‚å¸¸ä¸ºä»€ä¹ˆé«˜ DPI æ˜¾ç¤ºå™¨ä¼šå¯¼è‡´æŸäº›è½¯ä»¶æ˜¾ç¤ºå¼‚å¸¸äº†ï¼Ÿ éšç€ 2Kã€4K æ˜¾ç¤ºå™¨çš„æ™®åŠï¼Œåœ¨ä½¿ç”¨è¿™äº›é«˜ DPI æ˜¾ç¤ºå™¨æ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†ä½¿è½¯ä»¶ç•Œé¢çœ‹èµ·æ¥ä¸è‡³äºå¤ªå°ï¼Œå¯¼è‡´è§†è§‰ç–²åŠ³ï¼Œä¸€èˆ¬ä¼šåœ¨ç³»ç»Ÿä¸­è®¾ç½®ç¼©æ”¾æ¯”ä¾‹ã€‚ Windows æ“ä½œç³»ç»Ÿå¯¹é«˜ dpi æ˜¾ç¤ºå™¨ç¼©æ”¾æ”¯æŒæœ€å¥½çš„æ˜¯ windows 10+ï¼Œå»ºè®®åœ¨ä½¿ç”¨é«˜ DPI æ˜¾ç¤ºå™¨æ—¶æ­é… Windows 10+æ“ä½œç³»ç»Ÿã€‚ å‡è®¾ç°æœ‰ä¸€ä¸ªè½¯ä»¶ï¼Œå…¶ç•Œé¢å®½ 950 åƒç´ ï¼Œé«˜ 700 åƒç´ ï¼Œè¯¥è½¯ä»¶åœ¨ 24 å¯¸ã€åˆ†è¾¨ç‡ä¸º1900*1400çš„æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ”¾åˆ°é«˜ dpi æ˜¾ç¤ºå™¨ï¼ˆåŒæ ·æ˜¯ 24 å¯¸ï¼Œä½†åˆ†è¾¨ç‡ä¸º3800*2800ï¼‰ä¸Šæ˜¾ç¤ºæ•ˆæœä¼šå¦‚ä½•ï¼Ÿ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒåŒæ ·å°ºå¯¸çš„è½¯ä»¶ç•Œé¢ï¼Œåœ¨é«˜ dpi æ˜¾ç¤ºå™¨ä¸Šä¼šæ˜¾å¾—éå¸¸å°ï¼Œä¼šå¯¹ä½¿ç”¨è€…ä¼šé€ æˆä¸¥é‡çš„è§†è§‰ç–²åŠ³ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è½¯ä»¶éœ€è¦é’ˆå¯¹é«˜ dpi è¿›è¡Œé€‚é…å’Œç¼©æ”¾ï¼Œä»è€Œå‘æŒ¥å‡ºé«˜dpiæ˜¾ç¤ºå™¨çš„ä¼˜åŠ¿ï¼Œè®©ç•Œé¢æ˜¾ç¤ºæ›´åŠ æ¸…æ™°å’Œç»†è…»ã€‚ ç›®å‰å¤§å¤šæ•°å®¢æˆ·ç«¯æ¡†æ¶ï¼ˆå¦‚Qtã€Electronã€WPFã€WinFormï¼‰éƒ½å·²ç»èƒ½å¾ˆå¥½çš„æ”¯æŒdpiç¼©æ”¾äº†ï¼Œä¸éœ€è¦å¼€å‘äººå‘˜èŠ±è´¹ç»å†å»å¤„ç†è¿™äº›äº‹æƒ…ã€‚ Windows 10+ç³»ç»Ÿçš„DPIç¼©æ”¾è§„åˆ™Windows 10+æ“ä½œç³»ç»Ÿé’ˆå¯¹ dpi ç¼©æ”¾åˆ¶å®šäº† 3 ç§è§„åˆ™ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å¿…é¡»åŒ¹é…ä¸‹é¢çš„ä¸€ç§è§„åˆ™ï¼Œé»˜è®¤ä¸ºPROCESS_DPI_UNAWAREï¼š PROCESS_DPI_UNAWAREåœ¨è½¯ä»¶å¯åŠ¨æ—¶ï¼Œ æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è½¯ä»¶è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼›åœ¨ç³»ç»Ÿ dpi ç¼©æ”¾æ”¹å˜æ—¶ï¼Œç³»ç»Ÿä¹Ÿä¼šå°†è½¯ä»¶è‡ªåŠ¨è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼Œä½†è½¯ä»¶ä¸ä¼šæ”¶åˆ° WM_DPICHANGED æ¶ˆæ¯ã€‚ PROCESS_SYSTEM_DPI_AWAREåœ¨è½¯ä»¶å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¸ä¼šå°†è½¯ä»¶è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼›ä½†åœ¨ç³»ç»Ÿ dpi ç¼©æ”¾æ”¹å˜æ—¶ï¼Œç³»ç»Ÿä¼šå°†è½¯ä»¶è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼Œä½†è½¯ä»¶ä»ç„¶ä¸ä¼šæ”¶åˆ° WM_DPICHANGED æ¶ˆæ¯ã€‚ PROCESS_PER_MONITOR_DPI_AWAREåœ¨è½¯ä»¶å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¸ä¼šå°†è½¯ä»¶è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼›åŒæ ·ï¼Œåœ¨ç³»ç»Ÿ dpi ç¼©æ”¾æ”¹å˜æ—¶ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šå°†è½¯ä»¶è¿›è¡Œç¼©æ”¾æ‹‰ä¼¸ï¼Œä½†è½¯ä»¶ä¼šæ”¶åˆ° WM_DPICHANGED æ¶ˆæ¯ã€‚ è¯¦è§ï¼šdpi_awareness","tags":["DPI"],"categories":["Windowsç¼–ç¨‹"]},{"title":"å›¾å½¢ç¼–ç¨‹æ‰«ç›²","path":"/post/1919525700.html","content":"ä¸€ã€å¸¸è§å›¾å½¢ç¼–ç¨‹æ¥å£æˆ‘ä»¬å¸¸è§çš„å›¾å½¢ç¼–ç¨‹æ¥å£ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹æ´¾ç³»ï¼š OpenGL DirectX Vulkan Metal ä¸‹å›¾å±•ç¤ºäº†å„ä¸ªæ´¾ç³»çš„åˆ†æ”¯åŠç‰¹ç‚¹ï¼š äºŒã€ANGLEANGLE ï¼ˆå…¨ç§° Almost Native Graphics Layer Engineï¼‰æ˜¯Googleå‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦ç”¨åœ¨ Chromium é¡¹ç›®é‡Œé¢ï¼ŒGoogleåˆ›å»ºè¿™ä¸ªé¡¹ç›®æ˜¯ä¸ºäº†è®©WebGLèƒ½å¤Ÿé—´æ¥è°ƒç”¨ç¡¬ä»¶å¹³å°æ”¯æŒçš„å›¾å½¢APIï¼Œå¦‚Windowså¹³å°ä¸Šè°ƒç”¨DirectXå›¾å½¢æ¥å£ã€‚ ç›®å‰ANGLEæ”¯æŒWindows, Mac, Linux, iOSå’ŒAndroidå¹³å°ã€‚ WebGLåŸºäºOpenGL ESå¼€å‘ï¼Œè€Œåœ¨Windowsç³»ç»Ÿä¸Šé»˜è®¤åªå®‰è£…äº†OpenGL 1.1é©±åŠ¨ç¨‹åºï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å‡çº§æ›´æ–°çš„OpenGLé©±åŠ¨ï¼Œåˆ™ç½‘é¡µä¸­çš„WebGLå°†åªèƒ½ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ï¼ˆå³CPUç»˜åˆ¶å›¾å½¢ï¼‰ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ— æ³•åˆ©ç”¨æ˜¾å¡GPUçš„ä¼˜åŠ¿ï¼Œå›¾å½¢æ¸²æŸ“æ€§èƒ½å’Œæ•ˆæœéƒ½ä¸å¥½ã€‚ä¸ºäº†æ”¹ç‰ˆè¿™ä¸ªç°çŠ¶ï¼ŒGoogleå…¬å¸å¼€å‘äº†ANGLEé¡¹ç›®ã€‚ ä¾‹å¦‚åœ¨Windowså¹³å°ï¼ŒANGLEé¡¹ç›®é€šè¿‡å°†DirectXæ¥å£è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œå°è£…åçš„æ¥å£ä¸OpenGL ESæ¥å£éå¸¸ç±»ä¼¼ï¼Œè¿™æ ·å½“ç¨‹åºä»£ç è°ƒç”¨ANGLEæä¾›çš„ç±»OpenGL ESæ¥å£æ—¶ï¼ŒANGLEå°±å¯ä»¥åœ¨å†…éƒ¨åˆ¤æ–­æ˜¯è°ƒç”¨OpenGLæ¥å£è¿˜æ˜¯è°ƒç”¨DirectXæ¥å£ï¼Œä»è€Œå®ç°äº†å½“ç”¨æˆ·ç³»ç»Ÿä¸Šæ²¡ç”¨å®‰è£…OpenGLé©±åŠ¨æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨åˆé€‚çš„DirectXç»˜åˆ¶æ¥å£ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/google/angle ä¸‰ã€EGLEGL æ˜¯ OpenGL ES å’Œæœ¬åœ°çª—å£ç³»ç»Ÿï¼ˆNative Window Systemï¼‰ä¹‹é—´çš„é€šä¿¡æ¥å£ï¼ŒOpenGL ES çš„å¹³å°æ— å…³æ€§æ­£æ˜¯å€ŸåŠ© EGL å®ç°çš„ï¼ŒEGL å±è”½äº†ä¸åŒå¹³å°çš„å·®å¼‚ï¼ˆApple æä¾›äº†è‡ªå·±çš„ EGL API çš„ iOS å®ç°ï¼Œè‡ªç§° EAGLï¼‰ã€‚ æˆ‘ä»¬é€šå¸¸åœ¨å®‰è£…ç›®å½•çœ‹åˆ°çš„libEGL.dllå’ŒlibGLESv2.dllæ–‡ä»¶å°±æ˜¯EGLåœ¨Windowså¹³å°çš„å®ç°ã€‚WebGLåŸºäºOpenGL ESå®ç°ï¼Œæ‰€ä»¥ä½¿ç”¨äº†WebGLå’ŒOpenGL ESçš„ç¨‹åºéƒ½ä¼šå¸¦ä¸Šè¿™2ä¸ªæ–‡ä»¶ã€‚","tags":["OpenGL","DirectX","ANGLE"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"åŸºäºJoplinå’ŒWebDAVæ­å»ºç§æœ‰äº‘ç¬”è®°","path":"/post/2173106656.html","content":"ä¸€ã€ç§æœ‰Dockeræ­å»ºWebDAVæœåŠ¡ä»æˆ‘çš„Githubä¸Šä¸‹è½½WebDAVçš„Dockeré…ç½®æ–‡ä»¶ï¼š 1git clone https://github.com/winsoft666/docker-webdev æ ¹æ®docker-compose.yml.sampleæ–‡ä»¶æ¥æ–°å»ºdocker-compose.ymlæ–‡ä»¶ï¼š 1cp docker-compose.yml.sample docker-compose.yml ä¿®æ”¹docker-compose.ymlæ–‡ä»¶ä¸­çš„ç›¸åº”å­—æ®µï¼š 123456789101112131415version: &#x27;3&#x27;services: webdav: build: . restart: always ports: - &quot;9443:443&quot; - &quot;9080:80&quot; environment: SERVER_NAME: www.xxx.com,xxx.com AUTH_TYPE: Basic SSL_CERT: selfsigned volumes: - /webdav-server:/var/lib/dav - /root/webdav/user.passwd:/user.passwd å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š portsä¸ºå®¹å™¨å’Œå®¿ä¸»æœºå™¨çš„ç«¯å£æ˜ å°„ï¼Œå†’å·å‰é¢çš„ç«¯å£å¯ä»¥è‡ªå®šä¹‰ï¼› SERVER_NAMEä¸ºæœåŠ¡å™¨ç»‘å®šçš„åŸŸåï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šåŸŸåï¼Œå¯ä»¥ç›´æ¥å†™æœåŠ¡å™¨çš„å¤–ç½‘IPã€‚ Joplinåªæ”¯æŒBasicéªŒè¯æ¨¡å¼ï¼› /root/webdav/user.passwdä¸ºWebDAVçš„ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨æ–‡ä»¶ï¼Œå­˜åœ¨åœ¨å®¿ä¸»æœºå™¨ä¸Šï¼Œé€šè¿‡æ˜ å°„çš„æ–¹å¼æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œç”Ÿæˆæ­¥éª¤å¦‚ä¸‹ï¼š 123456# åœ¨CentOS7ç³»ç»Ÿä¸Šå®‰è£…httpdyum -y install httpdcd /root/webdav/touch user.passwdhtpasswd -B user.passwd zhanghua åœ¨docker-compose.ymlæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š 1docker-compose up -d ä¸Šé¢å‘½ä»¤ä¼šéƒ¨ç½²å¹¶å¯åŠ¨WebDAVæœåŠ¡ã€‚ äºŒã€æµ‹è¯•WebDAVæœåŠ¡åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€http://xxx.com:9080ï¼Œä¼šå¼¹å‡ºç”¨æˆ·åå’Œå¯†ç è¾“å…¥æ¡†ï¼Œè¾“å…¥ä½¿ç”¨htpasswd å‘½ä»¤åˆ›å»ºçš„ç”¨æˆ·å’Œå¯†ç ï¼Œç‚¹å‡»ç™»å½•ï¼Œå¦‚æœå¯ä»¥ç™»å½•è¿›å»ï¼Œè¯´æ˜æœåŠ¡æ­å»ºæˆåŠŸã€‚ ä¸‰ã€æ–°å»ºJoplinæ•°æ®ç›®å½•åœ¨å®¿ä¸»æœºå™¨çš„/webdav-server/dataç›®å½•ä¸‹ï¼Œæ–°å»ºå­ç›®å½•joplinã€‚å› ä¸º/webdav-server/ç›®å½•å·²ç»æ˜ å°„åˆ°å®¹å™¨ä¸­ï¼Œæ‰€ä»¥å®¹å™¨å¯ä»¥ç›´æ¥è®¿é—®ã€‚ é‡å¯Dockerï¼š 123docker ps -a # æŸ¥çœ‹å®¹å™¨IDdocker stop XXXdocker start XXX ä»Joplinå®˜ç½‘ï¼ˆhttps://joplinapp.org/ï¼‰ä¸‹è½½Joplinå®¢æˆ·ç«¯ï¼Œåœ¨â€œåŒæ­¥â€é€‰é¡¹ä¸­è®¾ç½®WebDAVï¼Œå¦‚å›¾æ‰€ç¤ºï¼š è®¾ç½®å®Œæˆä¹‹åï¼Œç‚¹å‡»â€œæ£€æŸ¥åŒæ­¥é…ç½®â€ï¼Œæç¤ºâ€œæˆåŠŸâ€åˆ™è¯´æ˜é…ç½®æ­£ç¡®ã€‚","tags":["Joplin","WebDAV"],"categories":["çˆ±æŠ˜è…¾"]},{"title":"NSISæ•™ç¨‹(11)-ä¸­æ–‡æ‰‹å†Œ","path":"/post/2948643539.html","content":"è¿™è¿™é‡Œåˆ†äº«å‡ ä¸ªæˆ‘ä¸€ç›´ä½¿ç”¨çš„NSISä¸­æ–‡æ‰‹å†Œï¼š ã€ŠNSISç”¨æˆ·æ‰‹å†Œ ä¸­æ–‡ç‰ˆã€‹ NSISå®˜æ–¹è‹±æ–‡çš„æ‰‹å†Œä¸Šçš„æœºå™¨ç¿»è¯‘ç‰ˆæœ¬ï¼Œæœ‰äº›åœ°æ–¹ç¿»è¯‘å¯èƒ½ä¸å¤ªçº¯æ­£ã€‚ ã€ŠNSISå›¾æ–‡æ•™ç¨‹é›†é”¦ - è½»ç‹‚å¿—ã€‹ é‡Œé¢æœ‰å¾ˆå¤šåŸºäºNSISçš„å®‰è£…åŒ…ç¤ºä¾‹ï¼Œå¤§å¤šæ•°ä¸NSISæœ‰å…³çš„åŠŸèƒ½ï¼Œéƒ½å¯ä»¥åœ¨è¿™ä¸ªæ–‡æ¡£æ‰¾åˆ°çº¿ç´¢ã€‚ ä¸Šè¿°æ–‡æ¡£ä¸‹è½½åœ°å€ï¼šhttps://github.com/winsoft666/NSIS-Chinese-Doc","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(10)-MUIè·³è¿‡æŒ‡å®šå®‰è£…æ­¥éª¤","path":"/post/1597634702.html","content":"åœ¨æ­£å¸¸æƒ…å†µä¸‹å®‰è£…åŒ…ä¼šæœ‰â€œæ¬¢è¿ç•Œé¢â€ã€â€œå®‰è£…ç›®å½•é€‰æ‹©ç•Œé¢â€ç­‰ç­‰ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦å®‰è£…åŒ…è‡ªåŠ¨è·³è¿‡è¿™ 2 ä¸ªç•Œé¢ï¼Œå¦‚å®‰è£…åŒ…é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥â€œå®‰è£…ç›®å½•â€ï¼ˆå¦‚setup.exe /installdir F:\\testï¼‰ï¼Œæœ¬æ–‡è®²è¿°å¦‚ä½•ä½¿å®‰è£…åŒ…è·³è¿‡æŒ‡å®šçš„ç•Œé¢ã€‚ HOW TO DO?åœ¨é¡µé¢æ’å…¥å®ä¹‹å‰é€šè¿‡MUI_PAGE_CUSTOMFUNCTION_PREæ¥æŒ‡å®š pre å¤„ç†å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è¿‡ï¼š 12345678# å®‰è£…ç¨‹åºæ¬¢è¿é¡µé¢!define MUI_PAGE_CUSTOMFUNCTION_PRE SkipPage!insertmacro MUI_PAGE_WELCOME# å®‰è£…ç¨‹åºæ˜¾ç¤ºå®‰è£…ç›®å½•é€‰æ‹©é¡µé¢!define MUI_PAGE_CUSTOMFUNCTION_PRE SkipPage!insertmacro MUI_PAGE_DIRECTORY SkipPageå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š 123456Function SkipPage StrLen $R1 $paramInstllDir $&#123;If&#125; $R1 &gt; 0 Abort $&#123;EndIf&#125;FunctionEnd è·å–å‘½ä»¤è¡Œå‚æ•°å­˜å…¥$paramInstllDirå˜é‡ï¼Œå¹¶è§£æå‘½ä»¤è¡Œå‚æ•°ï¼š 12345678910!macro ParseParameters $&#123;GetParameters&#125; $R0 $&#123;GetOptions&#125; $R0 &#x27;/installdir&#x27; $R1 StrCpy $paramInstllDir $R1 StrLen $R1 $paramInstllDir $&#123;If&#125; $R1 &gt; 0 StrCpy $INSTDIR $paramInstllDir $&#123;EndIf&#125;!macroend","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(9)-ä½¿ç”¨ç•Œé¢åº“åˆ¶ä½œå®‰è£…ç•Œé¢","path":"/post/100006247.html","content":"å‰é¢çš„å‡ ç¯‡æ–‡ç« ä»‹ç»äº† NSIS çš„ä¼ ç»Ÿç•Œé¢çš„å®‰è£…åŒ…å’Œç°ä»£ç•Œé¢çš„å®‰è£…åŒ…çš„åˆ¶ä½œæ–¹æ³•ï¼Œä¹Ÿæåˆ°äº† NSIS æ”¯æŒè‡ªå®šä¹‰é¡µé¢ï¼ˆå³ä½¿ç”¨page customï¼‰çš„ç‰¹æ€§ï¼Œè‡ªå®šä¹‰é¡µé¢éœ€è¦ç”¨æˆ·è‡ªå·±åˆ›å»ºå¯¹è¯æ¡†ã€æ§ä»¶ã€æ·»åŠ æ§ä»¶å“åº”ç­‰ç­‰ï¼Œè™½ç„¶ NSIS æä¾›äº†nsDialogs.nshæ¥æ”¯æŒè¿™äº›åŠŸèƒ½ï¼Œä½†ä½¿ç”¨èµ·æ¥è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼ˆéœ€è¦ä¸“é—¨äº†è§£è¿™ä¸ªæ’ä»¶è¯¸å¤šç”¨æ³•ï¼‰ï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ï¼Œæ‰€ä»¥æœ¬æ–‡ä»‹ç»ä¸€ç§ç»ˆæçš„è‡ªå®šä¹‰ç•Œé¢çš„å®‰è£…åŒ…è§£å†³æ–¹æ¡ˆï¼Œå³å®Œå…¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ç•Œé¢åº“æ¥ç»˜åˆ¶å®‰è£…åŒ…ç•Œé¢ã€‚ è¯¥æ–¹æ¡ˆæ˜¯å¯¹ç•Œé¢åº“æ²¡æœ‰é™åˆ¶çš„ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ä»»ä½•ç•Œé¢åº“ï¼Œå¦‚ MFC, Qtï¼ŒWTL ç­‰ã€‚é€šè¿‡è¿™ç§æ–¹æ¡ˆå¯ä»¥å¾ˆè½»æ¾çš„å®ç°ç±»ä¼¼é‡‘å±±æ¯’éœ¸ã€QQã€360 å®‰å…¨å«å£«ç­‰è½¯ä»¶çš„å®‰è£…åŒ…ç•Œé¢ã€‚ ä¸€ã€åŸç†NSIS è‡ªå®šä¹‰é¡µé¢çš„è¯­æ³•ï¼š 1page custom [åˆ›å»ºå‡½æ•°] [ç¦»å¼€å‡½æ•°] [æ ‡é¢˜] ä½¿ç”¨ç¬¬ä¸‰æ–¹ç•Œé¢åº“å®Œå…¨å®šåˆ¶å®‰è£…åŒ…ç•Œé¢çš„åŸºæœ¬åŸç†å°±æ˜¯ï¼šæ–°å»ºä¸€ä¸ª dll æ’ä»¶ï¼Œåœ¨page customçš„[åˆ›å»ºå‡½æ•°]ä¸­è°ƒç”¨è¯¥æ’ä»¶ä¸­çš„å‡½æ•°æ¥æ˜¾ç¤ºç•Œé¢ï¼Œè¿™æ—¶ç•Œé¢ä¸Šçš„æŒ‰é’®çš„å“åº”å°±ä¸å†ç”± NSIS æ§åˆ¶äº†ï¼Œå®Œå…¨ç”±æˆ‘ä»¬çš„ä»£ç æ§åˆ¶ã€‚ äºŒã€éš¾ç‚¹é—®é¢˜ä½¿ç”¨æˆ‘ä»¬çš„æ’ä»¶ dll å®Œå…¨æ›¿ä»£ NSIS ç•Œé¢ä¹‹åï¼Œæœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š å¦‚ä½•è·å–å®‰è£…å’Œå¸è½½çš„è¿›åº¦ å¦‚ä½•ä» C++å›è°ƒ NSIS å‡½æ•° 2.1 å®‰è£…å’Œå¸è½½è¿›åº¦NSIS ä¸­çš„å®‰è£…å’Œå¸è½½è¿›åº¦ç”±!insertmacro MUI_PAGE_INSTFILESæˆ–Page instfilesæä¾›ã€‚ åœ¨å®Œå…¨ä½¿ç”¨è‡ªå·±çš„ç•Œé¢ä¹‹åï¼Œè¿™ 2 ä¸ª NSIS ç•Œé¢éƒ½ä¸èƒ½ä½¿ç”¨äº†ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦è‡ªå·±è·å–å®‰è£…ï¼ˆé‡Šæ”¾ï¼‰å’Œå¸è½½ï¼ˆåˆ é™¤ï¼‰çš„è¿›åº¦ã€‚ ä»¥å®‰è£…è¿›åº¦ä¸ºä¾‹ï¼ŒNSIS ä¸­æ–‡ä»¶çš„å®‰è£…æ—¶æ–‡ä»¶é‡Šæ”¾åŠŸèƒ½éƒ½æ˜¯ç”±Fileå‘½ä»¤æä¾›ï¼Œä½†è¯¥å‘½ä»¤æ²¡æœ‰æä¾›é‡Šæ”¾è¿›åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•è·å–åˆ°å®æ—¶çš„é‡Šæ”¾è¿›åº¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ›²æŠ˜çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª 7z å‹ç¼©åŒ…æ”¾å…¥å®‰è£…åŒ…ä¸­ï¼š 12SetOutPath $INSTDIRFile &quot;app\\app.7z&quot; ç­‰å®‰è£…åŒ…é‡Šæ”¾å®Œè¿™ä¸ªå‹ç¼©åŒ…ä¹‹åï¼ˆè¿™æ®µæ—¶é—´çš„è¿›åº¦æ— æ³•æ˜¾ç¤ºï¼‰ï¼Œå†ä½¿ç”¨ NSIS å®˜æ–¹æä¾›çš„nsis7zæ’ä»¶æ¥è§£å‹ç¼©è¿™ä¸ª 7z å‹ç¼©åŒ…ï¼Œç”±äº nsis7z æ’ä»¶å¯ä»¥æä¾›è§£å‹ç¼©è¿›åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¿›åº¦æ˜¾ç¤ºåœ¨å®‰è£…è¿›åº¦é¡µé¢ä¸Šï¼Œè§£å‹å®Œä¹‹åå†åˆ é™¤ 7z å‹ç¼©åŒ…ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¸€ä¸ªå¼Šç«¯å°±æ˜¯ï¼Œ7z å‹ç¼©åŒ…ä»å®‰è£…åŒ…ä¸­é‡Šæ”¾åˆ°æœ¬åœ°ç£ç›˜çš„è¿‡ç¨‹éœ€è¦æ—¶é—´ï¼Œä¸”è¿™ä¸ªæ—¶é—´æ— æ³•å‡†ç¡®çš„æ˜¾ç¤ºåœ¨è¿›åº¦é¡µé¢ã€‚ 1234567Function ExtractFunc SetOutPath $INSTDIR File &quot;app\\app.7z&quot; GetFunctionAddress $R9 ExtractCallback Nsis7z::ExtractWithCallback &quot;$INSTDIR\\app.7z&quot; $R9 Delete &quot;$INSTDIR\\app.7z&quot;FunctionEnd 123456789101112131415Function ExtractCallback Pop $1 Pop $2 System::Int64Op $1 * 100 Pop $3 System::Int64Op $3 / $2 Pop $0 nsDui::SetSliderValue &quot;slrProgress&quot; $0 $&#123;If&#125; $1 == $2 nsDui::SetSliderValue &quot;slrProgress&quot; 100 nsDui::NextPage &quot;wizardTab&quot; $&#123;EndIf&#125;FunctionEnd å†™è¿™ç¯‡æ–‡å­—çš„æ—¶å€™ï¼Œå‘ç°ç°åœ¨çš„nsis7zå·²ç»å¤ªè€äº†ï¼Œæ–°ç‰ˆçš„å‹ç¼©è½¯ä»¶ç”Ÿæˆçš„ 7z å‹ç¼©åŒ…ï¼Œè¯¥æ’ä»¶å·²ç»æ— æ³•è§£å‹ã€‚å¯ä»¥ä½¿ç”¨ 7za.exe å‘½ä»¤è¡Œå·¥å…·æ¥ç”Ÿæˆ 7z å‹ç¼©æ–‡ä»¶ï¼Œ7za.exe ä»æ­¤å¤„ä¸‹è½½ï¼šhttp://download.csdn.net/download/china_jeffery&#x2F;10214464ã€‚7za ç”Ÿæˆ 7z å‹ç¼©åŒ…è¯­æ³•ä¸ºï¼š7za.exe a app.7z app\\* 2.2 ä» C++å›è°ƒ NSIS å‡½æ•°æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº†æˆ‘ä»¬è‡ªå®šä¹‰ç•Œé¢ä¸Šçš„â€œå–æ¶ˆâ€æŒ‰é’®ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦è°ƒç”¨ NSIS çš„Abortå‡½æ•°æ¥å–æ¶ˆå®‰è£…ã€‚æ­¤æ—¶å°±éœ€è¦è§£å†³å¦‚ä½•ä» C++ç¯å¢ƒå›è°ƒåˆ° NSIS ç¯å¢ƒã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨NSISæ•™ç¨‹(8)-æ’ä»¶å¼€å‘ä¸­ä»‹ç»çš„PluginCommon.hæ¥å®ç°è¯¥åŠŸèƒ½ã€‚ å¤§è‡´åŸç†æ˜¯ï¼Œåœ¨ NSIS è„šæœ¬ä¸­åˆå§‹åŒ–è‡ªå®šä¹‰ç•Œé¢çš„æ§ä»¶ä¸ NSIS å‡½æ•°æŒ‡é’ˆï¼ˆæ•´å‹ï¼‰çš„ç»‘å®šå…³ç³»ï¼ˆå¦‚æ§ä»¶åâ€“å‡½æ•°åï¼‰ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ§ä»¶ä¹‹åï¼ŒæŸ¥æ‰¾åˆ°è¯¥æ§ä»¶ç»‘å®šçš„ NSIS å‡½æ•°ï¼Œç„¶åè°ƒç”¨extra_parameters::ExecuteCodeSegmentå‡½æ•°ï¼ˆå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ NSIS å‡½æ•°æŒ‡é’ˆï¼‰ã€‚ ä»¥ duilib ç•Œé¢åº“ä¸ºä¾‹ï¼Œå¯¹ NSIS æš´éœ² OnControlBindNSISScript æ¥å£ï¼Œæä¾›ç»‘å®šæ§ä»¶ä¸ NSIS å‡½æ•°æŒ‡é’ˆï¼ˆæ•´å‹ï¼‰çš„åŠŸèƒ½ï¼š 123456789NSISAPI OnControlBindNSISScript(HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra)&#123; char controlName[MAX_PATH]; ZeroMemory(controlName, MAX_PATH); popstring(controlName); int callbackID = popint(); g_pMainDlg-&gt;SaveToControlCallbackMap( controlName, callbackID );&#125; åœ¨ NSIS ä¸­è°ƒç”¨OnControlBindNSISScriptç»‘å®šæ§ä»¶ä¸ NSIS å‡½æ•°ï¼š 12GetFunctionAddress $0 OnExitDUISetupnsDui::OnControlBindNSISScript &quot;btnFinishedClose&quot; $0 åœ¨ duilib çš„NotifyæŒ‰é’®äº‹ä»¶å“åº”å‡½æ•°ä¸­è°ƒç”¨ExecuteCodeSegmentæ‰§è¡Œ NSIS å‡½æ•°ï¼š 1234567891011121314void CDlgMain::Notify( TNotifyUI&amp; msg )&#123; std::map&lt;CDuiString, int &gt;::iterator iter = m_controlCallbackMap.find( msg.pSender-&gt;GetName() ); if( _tcsicmp( msg.sType, _T(&quot;click&quot;) ) == 0 )&#123; if( iter != m_controlCallbackMap.end() ) g_pluginParms-&gt;ExecuteCodeSegment( iter-&gt;second - 1, 0 ); &#125; else if( _tcsicmp( msg.sType, _T(&quot;textchanged&quot;) ) == 0 )&#123; if( iter != m_controlCallbackMap.end() ) g_pluginParms-&gt;ExecuteCodeSegment( iter-&gt;second - 1, 0 ); &#125; else &#123; WindowImplBase::Notify(msg); &#125;&#125; å¯ä»¥å‚è€ƒæˆ‘çš„NSIS-UI-Plugin é¡¹ç›®ï¼ŒåŸºäºè¯¥é¡¹ç›®å¯ä»¥ä½¿ç”¨ä»»æ„ç¬¬ä¸‰æ–¹ç•Œé¢åº“æ¥å®šåˆ¶å®‰è£…ç•Œé¢ã€‚","tags":["NSIS","duilib"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(8)-æ’ä»¶å¼€å‘","path":"/post/1273492093.html","content":"è™½ç„¶ NSIS å®˜æ–¹æä¾›äº†å¾ˆå¤šæ’ä»¶ï¼Œä¹Ÿæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„æ’ä»¶å¯ä»¥ä¸‹è½½ä½¿ç”¨ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­éš¾å…ä¼šé‡åˆ°å·²æœ‰æ’ä»¶æ²¡æœ‰æä¾›çš„åŠŸèƒ½æˆ–è€…æ’ä»¶ä¸å¥½ç”¨çš„æƒ…å†µï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©è‡ªå·±å¼€å‘ NSIS æ’ä»¶ã€‚ ä¸€ã€æ’ä»¶å¼€å‘è§„èŒƒNSIS æ’ä»¶å¯¹å¼€å‘è¯­è¨€æ²¡æœ‰é™åˆ¶ï¼ˆæœ¬æ–‡ä»‹ç»åŸºäº C++å¼€å‘ï¼‰ï¼Œåªè¦æŒ‰ç…§ NSIS æ ‡å‡†æ‰€è¦æ±‚çš„ç”Ÿæˆä¸€ä¸ª dll æ–‡ä»¶ï¼Œè¯¥ dll æ–‡ä»¶æä¾›çº¯Cè§„èŒƒçš„ã€å›ºå®šæ ¼å¼çš„å¯¼å‡ºå‡½æ•°å³å¯ã€‚ æ€»ç»“èµ·æ¥ï¼Œå¼€å‘ NSIS æ’ä»¶çš„æ­¥éª¤ä¸ºï¼š ä½¿ç”¨ Visual Studio æ–°å»º dll å·¥ç¨‹ï¼ˆè¿è¡Œåº“é€‰æ‹©MTæˆ–MTDï¼‰ï¼Œå»ºè®®ä½¿ç”¨çš„ MT è¿è¡Œåº“ï¼Œä¸éœ€è¦é¢å¤–æºå¸¦è¿è¡Œæ—¶æ–‡ä»¶ã€‚ å®šä¹‰æ’ä»¶åŠŸèƒ½å‡½æ•°ï¼Œå‡è®¾å‡½æ•°åä¸º addï¼Œåˆ™å‡½æ•°å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š 123456extern &quot;C&quot; __declspec(dllexport) void __cdecl add ( HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra); ç¼–è¯‘ç”Ÿæˆ dll æ–‡ä»¶ã€‚ äºŒã€å‚æ•°å’Œè¿”å›å€¼å¼€å‘ NSIS æ’ä»¶çš„éš¾ç‚¹åœ¨äºï¼šè·å–è°ƒç”¨è€…ä¼ å…¥çš„å‚æ•°ï¼Œä»¥åŠå°†æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒç”¨è€…ã€‚å‰é¢çš„ NSISæ•™ç¨‹(7)-æ’ä»¶ä½¿ç”¨ è¯´åˆ°äº†ï¼Œæ’ä»¶å‡½æ•°çš„è°ƒç”¨è€…ä¼ é€’å‚æ•°æ–¹å¼æœ‰ 2 ç§ï¼š ä¸€ç§æ˜¯é€šè¿‡$0~$9 $R0~$R9çš„å½¢å¼ï¼Œè¿™ç§å½¢å¼çš„å‚æ•°é€šè¿‡char *variableså‚æ•°æ¥è·å–ã€‚ ä¸€ç§æ˜¯é€šè¿‡å †æ ˆçš„å½¢å¼ï¼Œè¿™ç§å½¢å¼çš„å‚æ•°é€šè¿‡stack_t **stacktopå‚æ•°æ¥è·å–ã€‚ ä¸‰ã€PluginCommonä¸ºäº†æ–¹ä¾¿æ’ä»¶å¼€å‘ä¸­è·å–ç”¨æˆ·ä¼ å…¥å‚æ•°ã€ä»¥åŠæ‰§è¡Œç»“æœçš„è¿”å›ï¼Œæˆ‘å¯¹æ’ä»¶å¼€å‘çš„å¸¸ç”¨æ“ä½œè¿›è¡Œäº†å°è£…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147// PluginCommon.h#ifndef _PLUGIN_COMMON_H_#define _PLUGIN_COMMON_H_#include &lt;stdio.h&gt;#define PLUGIN_BUF_LEN 1024#define NSISAPI extern &quot;C&quot; __declspec(dllexport) void __cdecl#define EXDLL_INIT() &#123; \\ g_stringsize=string_size; \\ g_stacktop=stacktop; \\ g_variables=variables; &#125;typedef struct _stack_t &#123; struct _stack_t *next; char text[1];&#125; stack_t;static unsigned int g_stringsize;static stack_t **g_stacktop;static char *g_variables;enum&#123; INST_0, // $0 INST_1, // $1 INST_2, // $2 INST_3, // $3 INST_4, // $4 INST_5, // $5 INST_6, // $6 INST_7, // $7 INST_8, // $8 INST_9, // $9 INST_R0, // $R0 INST_R1, // $R1 INST_R2, // $R2 INST_R3, // $R3 INST_R4, // $R4 INST_R5, // $R5 INST_R6, // $R6 INST_R7, // $R7 INST_R8, // $R8 INST_R9, // $R9 INST_CMDLINE, // $CMDLINE INST_INSTDIR, // $INSTDIR INST_OUTDIR, // $OUTDIR INST_EXEDIR, // $EXEDIR INST_LANG, // $LANGUAGE __INST_LAST&#125;;static int __stdcall popstring(char *str)&#123; stack_t *th; if (!g_stacktop || !*g_stacktop) return 1; th=(*g_stacktop); lstrcpyA(str,th-&gt;text); *g_stacktop = th-&gt;next; GlobalFree((HGLOBAL)th); return 0;&#125;static void __stdcall pushstring(char *str)&#123; stack_t *th; if (!g_stacktop) return; th=(stack_t*)GlobalAlloc(GPTR,sizeof(stack_t)+g_stringsize); lstrcpynA(th-&gt;text,str,g_stringsize); th-&gt;next=*g_stacktop; *g_stacktop=th;&#125;static int __stdcall popint()&#123; char buf[512] = &#123;0&#125;; popstring(buf); return atoi(buf);&#125;static void __stdcall pushint(long value)&#123; char buf[512] = &#123;0&#125;; sprintf_s(buf, &quot;%ld&quot;, value); pushstring(buf);&#125;static char * __stdcall getuservariable(int varnum)&#123; if (varnum &lt; 0 || varnum &gt;= __INST_LAST) return NULL; return g_variables+varnum*g_stringsize;&#125;static void __stdcall setuservariable(int varnum, char *var)&#123; if (var != NULL &amp;&amp; varnum &gt;= 0 &amp;&amp; varnum &lt; __INST_LAST) lstrcpyA(g_variables + varnum*g_stringsize, var);&#125;enum NSPIM&#123; NSPIM_UNLOAD, // This is the last message a plugin gets, do final cleanup NSPIM_GUIUNLOAD, // Called after .onGUIEnd&#125;;typedef UINT_PTR (*NSISPLUGINCALLBACK)(enum NSPIM);// extra_parameters data structures containing other interesting stuff// but the stack, variables and HWND passed on to plug-ins.typedef struct&#123; int autoclose; int all_user_var; int exec_error; int abort; int exec_reboot; // NSIS_SUPPORT_REBOOT int reboot_called; // NSIS_SUPPORT_REBOOT int XXX_cur_insttype; // depreacted int plugin_api_version; // see NSISPIAPIVER_CURR // used to be XXX_insttype_changed int silent; // NSIS_CONFIG_SILENT_SUPPORT int instdir_error; int rtl; int errlvl; int alter_reg_view; int status_update;&#125; exec_flags_t;#ifndef NSISCALL#define NSISCALL __stdcall#endiftypedef struct &#123; exec_flags_t *exec_flags; int (NSISCALL *ExecuteCodeSegment)(int, HWND); void (NSISCALL *validate_filename)(char *); // returns 0 on success, 1 if already registered and &lt; 0 on errors int (NSISCALL *RegisterPluginCallback)(HMODULE, NSISPLUGINCALLBACK);&#125; extra_parameters;#endif //_PLUGIN_COMMON_H_ åœ¨å¼€å‘æ’ä»¶ä¸­ç»å¸¸ç”¨åˆ°çš„æœ‰ï¼š4 ä¸ªå †æ ˆæ“ä½œå‡½æ•°ï¼špushint,pushstring,popint,popstringã€‚2 ä¸ªå¯„å­˜å™¨å˜é‡($R0~$R9,$0~$9)æ“ä½œå‡½æ•°ï¼šgetuservariableï¼Œsetuservariableã€‚ å››ã€ç¤ºä¾‹åŸºäºä¸Šé¢çš„ PluginCommon.hï¼Œæˆ‘ä»¬å¯ä»¥å°†å¼€å‘æ’ä»¶çš„æ­¥éª¤æµç¨‹å¤§å¤§ç®€åŒ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#include &lt;windows.h&gt;#include &lt;commctrl.h&gt;#include &lt;stdarg.h&gt;#include &lt;tchar.h&gt;#include &quot;PluginCommon.h&quot;HINSTANCE g_hInstance;HWND g_hwndParent;extra_parameters *g_pluginParms = NULL;#define NSMETHOD_INIT(parent) &#123;\\ g_pluginParms = extra; \\ g_hwndParent = parent; \\ EXDLL_INIT(); &#125;BOOL WINAPI DllMain(HANDLE hInst, ULONG ul_reason_for_call, LPVOID lpReserved)&#123; g_hInstance = (HINSTANCE)hInst; if (ul_reason_for_call == DLL_PROCESS_ATTACH) &#123; //do what you want at init time. &#125; if (ul_reason_for_call == DLL_THREAD_DETACH || ul_reason_for_call == DLL_PROCESS_DETACH) &#123; //clean up code. &#125; return TRUE;&#125;//// ä»¥ä¸Šå†…å®¹é€šç”¨ï¼Œæ¯ä¸ªæ’ä»¶éƒ½å¯ä»¥å°†ä¸Šé¢çš„å†…å®¹ç›´æ¥å¤åˆ¶è¿‡å»ã€‚//// NSISæ’ä»¶å¯¼å‡ºå‡½æ•°,ä»¥addå‡½æ•°ä¸ºä¾‹ï¼Œè‹¥è¦æ·»åŠ å…¶ä»–å‡½æ•°ï¼Œåˆ™åªæ˜¯å‡½æ•°åéœ€è¦ä¿®æ”¹ï¼Œå‡½æ•°é€»è¾‘å†™åœ¨NSMETHOD_INIT(hwndParent);ä¹‹åçš„èŠ±æ‹¬å·å†…ã€‚//extern &quot;C&quot; __declspec(dllexport) void __cdecladd ( HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra)&#123; NSMETHOD_INIT(hwndParent); &#123; // == æ·»åŠ è‡ªå·±ä»£ç  // å‡è®¾è°ƒç”¨è€…é€šè¿‡å †æ ˆçš„å½¢å¼ä¼ é€’çš„å‚æ•° int i = popint(); // æ³¨æ„ï¼šæ ˆæ˜¯å…ˆè¿›åå‡º int j = popint(); int k = i + j; pushint(k); // é€šè¿‡plugin-common.hä¸­æä¾›çš„pushintè¿”å›æ•´æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨pushstringè¿”å›å­—ç¬¦ä¸² // == &#125;&#125; äº”ã€Unicode æ”¯æŒå¤§å®¶å¯èƒ½æ³¨æ„åˆ°äº†ä¸Šé¢çš„ç¤ºä¾‹å’ŒPluginCommon.hä¸­ä½¿ç”¨çš„éƒ½æ˜¯charï¼Œè€Œä¸æ˜¯wchar_tã€‚é‚£å¦‚æœè¦æ”¹æˆwchar_téœ€è¦å“ªäº›å·¥ä½œäº†ï¼Ÿ å°†æ’ä»¶ä»£ç ä¸­çš„charæ”¹æˆwchar_tã€‚ åœ¨ nsi è„šæœ¬ä¸­åŠ å…¥Unicode Trueã€‚ éœ€è¦å°†ç”Ÿæˆçš„æ’ä»¶ dll æ”¾åˆ° nsis ç›®å½•ä¸‹çš„Plugins\\x86-unicodeå­ç›®å½•ä¸­ã€‚","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(7)-æ’ä»¶ä½¿ç”¨","path":"/post/3031217406.html","content":"NSIS å†…ç½®äº†å¾ˆå¤šæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å¯ä»¥æ»¡è¶³æˆ‘ä»¬åŸºæœ¬éœ€æ±‚ï¼Œä½†éš¾å…ä¼šé‡åˆ° NSIS æ²¡æœ‰å†…ç½®çš„åŠŸèƒ½ï¼Œå¦‚è¿›ç¨‹æ“ä½œï¼Œåå°è¿è¡Œï¼ˆå³å¤šçº¿ç¨‹ï¼‰ï¼Œ7z å‹ç¼©ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹æ’ä»¶æ¥æ»¡è¶³æˆ‘ä»¬æ‰€éœ€è¦çš„åŠŸèƒ½äº†ã€‚ ä¸€ã€æ’ä»¶è·å–NSIS å®˜æ–¹æ”¶å½•æ’ä»¶çš„ç½‘å€æ˜¯ï¼š http://nsis.sourceforge.net/Category:Plugins æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªç½‘ç«™ä¸ŠæŸ¥æ‰¾å’Œä¸‹è½½æˆ‘ä»¬éœ€è¦çš„æ’ä»¶ï¼Œè¯¥ç½‘ç«™ä¸Šé’ˆå¯¹æ¯ä¸ªæ’ä»¶éƒ½æä¾›äº†æ¯”è¾ƒå®Œå–„çš„ç¤ºä¾‹ã€‚ äºŒã€æ’ä»¶ä½¿ç”¨NSIS æ’ä»¶ä»¥ dll çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬ä»¥KillProcæ’ä»¶ä¸ºä¾‹ï¼ˆä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºè¯¥æ’ä»¶æä¾›æ€è¿›ç¨‹çš„åŠŸèƒ½ï¼‰ï¼Œæˆ‘ä»¬ä¸‹è½½ä¸‹æ¥çš„ä¸€èˆ¬æ˜¯å‹ç¼©åŒ…ï¼Œè§£å‹ä¹‹åæ‰¾åˆ°å¯¹åº”æ’ä»¶ dll æ–‡ä»¶ï¼Œå¦‚KillProc.dllæ–‡ä»¶ã€‚ ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š å°† dll æ–‡ä»¶æ‹·è´åˆ° NSIS å®‰è£…ç›®å½•ä¸‹çš„Plugins\\x86-ansiç›®å½•ï¼ˆUnicode æ’ä»¶éœ€è¦æ‹·è´åˆ°Plugins\\x86-unicodeç›®å½•ï¼‰ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šæ‰¾åˆ°è¯¥æ’ä»¶æ‰€æä¾›çš„å‡½æ•°ï¼Œä»¥åŠå‡½æ•°çš„å‚æ•°ä¼ é€’å½¢å¼ã€è¿”å›å€¼å½¢å¼ã€‚NSIS ä¸­æ’ä»¶å‡½æ•°çš„å‚æ•°ä¼ é€’å½¢å¼æœ‰ 2 ç§å½¢å¼ï¼š ä½¿ç”¨$0 ~ $9ï¼Œ$R0 ~ $R9æ¥ä¼ é€’ã€‚ ä½¿ç”¨å †æ ˆæ¥ä¼ é€’ã€‚ åœ¨ NSIS è„šæœ¬ä¸­æŒ‰ç…§å‡½æ•°å£°æ˜çš„å½¢å¼æ¥è°ƒç”¨ï¼Œéœ€è¦åœ¨å‡½æ•°åå‰åŠ ä¸Š dll åç§°ï¼ˆä¸éœ€è¦.dll åç¼€ï¼‰ï¼Œå¦‚KillProc::KillProcessesã€‚ 1234567891011Section StrCpy $0 &quot;foo.exe&quot; # å˜é‡èµ‹å€¼ KillProc::KillProcesses StrCmp $1 &quot;-1&quot; wooops wooops: Abort completed:SectionEnd","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(6)-é™é»˜å®‰è£…","path":"/post/4172083706.html","content":"é™é»˜å®‰è£…&#x2F;å¸è½½æ˜¯ä¸€ç§å®‰è£…&#x2F;å¸è½½å½¢å¼ï¼Œç”¨æˆ·æ‰“å¼€å®‰è£…åŒ…åä¸æ˜¾ç¤ºä»»ä½•å®‰è£…ç•Œé¢ï¼Œç›´æ¥å¼€å§‹å®‰è£…ï¼Œæ”¯æŒä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå®‰è£…è·¯å¾„ç­‰ã€‚ 1. é™é»˜æ–¹å¼å¸¸ç”¨çš„é™é»˜å®‰è£…æœ‰ 2 ç§ï¼š åœ¨è„šæœ¬ä¸­åŠ å…¥ SilentInstall å’Œ SilentUninstall å‘½ä»¤ åœ¨ç¨‹åºå¯åŠ¨å‚æ•°é‡ŒåŠ  &#x2F;S å‚æ•°(åŒºåˆ†å¤§å°å†™) 2. å½“å‰æ˜¯å¦é™é»˜è¿è¡Œåœ¨è„šæœ¬ä¸­åˆ¤æ–­å®‰è£…ã€å¸è½½ç¨‹åºæ˜¯å¦ä¸ºé™é»˜è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ IfSilentï¼š 12345# å®‰è£…æ“ä½œå¼€å§‹å‰.Function .onInit IfSilent +2 +1 MessageBox MB_ICONQUESTION|MB_OK &quot;æ¬¢è¿ä½¿ç”¨&quot;FunctionEnd 3. é»˜è®¤åº”ç­”å¯¹äºæœ‰äº›å‘½ä»¤éœ€è¦ä¸ºé™é»˜å®‰è£…æŒ‡å®šé»˜è®¤çš„å›ç­”ï¼Œå¦‚MessageBoxéœ€è¦åŠ å…¥&#x2F;SD å¼€å…³æ¥æŒ‡å®šé»˜è®¤å›ç­”ã€‚ 12345# å¸è½½æ“ä½œå¼€å§‹å‰.Function un.onInit MessageBox MB_ICONQUESTION|MB_YESNO &quot;ç¡®å®šè¦å¸è½½å—?&quot; /SD IDYES IDYES +2 IDNO +1 AbortFunctionEnd 4. å¯åŠ¨å‚æ•°è§£æå¦‚æœéœ€è¦ä¸ºé™é»˜å®‰è£…æŒ‡å®šå…¶ä»–çš„å‚æ•°ï¼Œå¦‚ç”¨æˆ·åç­‰ï¼Œå¯ä»¥ä½¿ç”¨ç¨‹åºå¯åŠ¨å‚æ•°æŒ‡å®šï¼Œå¹¶åœ¨.onInit å‡½æ•°é‡Œè¿›è¡Œè§£æï¼š 1234#ä½¿ç”¨æ’ä»¶FileFuncä¸­çš„2ä¸ªå®!include &quot;FileFunc.nsh&quot;!insertmacro GetParameters!insertmacro GetOptions 12# å®šä¹‰å…¨å±€å˜é‡Var paramInstllDir # å¯åŠ¨å‚æ•°-å®‰è£…ç›®å½• 12345678# è‡ªå®šä¹‰å®ParseParametersï¼Œåœ¨.onInitå‡½æ•°ä¸­è°ƒç”¨å³å¯!macro ParseParameters $&#123;GetParameters&#125; $R0 $&#123;GetOptions&#125; $R0 &#x27;/installdir&#x27; $R1 StrCpy $paramInstllDir $R1 IfSilent +1 +2 StrCpy $INSTDIR $paramInstllDir!macroend","tags":["NSIS","é™é»˜å®‰è£…"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(5)-ç°ä»£ç•Œé¢ç¤ºä¾‹","path":"/post/3798382521.html","content":"NSIS çš„ç°ä»£ç”¨æˆ·ç•Œé¢(Modern UI)åªæ˜¯ç›¸å¯¹äºä¼ ç»Ÿï¼ˆä¸‘é™‹ï¼‰çš„ç•Œé¢è€Œè¨€çš„â€œç°ä»£â€è€Œå·²ã€‚å®ƒå®šä¹‰åœ¨MUI2.nshä¸­ï¼Œnsh æ–‡ä»¶ç±»ä¼¼ C++ä¸­çš„å¤´æ–‡ä»¶ï¼Œå¯ä»¥è¢«å…¶ä»–æ¨¡å—åŒ…å«å¼•ç”¨ã€‚ ğŸ“Œ æ¨èï¼šNSIS-UI-Plugin å¼€æº NSIS UI æ’ä»¶æ¡†æ¶ï¼Œæ”¯æŒä»»æ„ç¬¬ä¸‰æ–¹ç•Œé¢åº“ã€‚é»˜è®¤ä½¿ç”¨ Qt ä½œä¸ºç•Œé¢åº“çš„å®‰è£…åŒ…ç¤ºä¾‹ã€‚ ä½¿ç”¨ MUI2 ç•Œé¢éœ€è¦åŒ…å«MUI2.nshï¼š 1!include &quot;MUI2.nsh&quot; MUI2 ç•Œé¢å’Œä¼ ç»Ÿç•Œé¢ä¸åŒä¹‹å¤„åœ¨äºï¼Œä¼ ç»Ÿç•Œé¢ä½¿ç”¨çš„Page(æˆ–PageEx)è¯­æ³•æ¥æ ‡è¯†æ˜¾ç¤ºå“ªäº›é¡µé¢ï¼Œå¦‚ï¼š 123PageEx license LicenseData &quot;license.rtf&quot; #å¯ä»¥æ˜¯txtæˆ–rtfæ–‡ä»¶æ ¼å¼PageExEnd è€Œ MUI2 ä½¿ç”¨çš„æ˜¯MUI2.nshä¸­å®šä¹‰çš„ä¸€ç³»åˆ—å®æ¥æ ‡è¯†æ˜¾ç¤ºå“ªäº›é¡µé¢ï¼Œå¦‚ï¼š 1!insertmacro MUI_PAGE_LICENSE &quot;license.rtf&quot; å’ŒNSISæ•™ç¨‹(4)-ä¼ ç»Ÿç•Œé¢ç¤ºä¾‹ç±»ä¼¼ï¼Œè¿™é‡Œæä¾›åˆ¶ä½œç½‘æ˜“äº‘éŸ³ä¹çš„ç°ä»£ç”¨æˆ·ç•Œé¢çš„å®‰è£…åŒ…ç¤ºä¾‹ï¼Œè„šæœ¬ä»£ç ä¸­åŒ…å«äº†è¯¦ç»†çš„æ³¨é‡Šã€‚ é«˜ä»¿ç½‘æ˜“äº‘éŸ³ä¹å®‰è£…è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188# ====================== è‡ªå®šä¹‰å® ==============================!define PRODUCT_NAME &quot;ç½‘æ˜“äº‘éŸ³ä¹&quot;!define EXE_NAME &quot;cloudmusic.exe&quot;!define PRODUCT_VERSION &quot;1.0.0.1&quot;!define PRODUCT_PUBLISHER &quot;NetEase&quot;!define PRODUCT_LEGAL &quot;NetEase 1999-2014&quot;!define TEMP_DIR &quot;&quot;# ===================== å¤–éƒ¨æ’ä»¶ä»¥åŠå® =============================!include &quot;MUI2.nsh&quot;# ===================== å®‰è£…åŒ…ç‰ˆæœ¬ =============================VIProductVersion &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;ProductVersion&quot; &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;ProductName&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot;VIAddVersionKey &quot;CompanyName&quot; &quot;$&#123;PRODUCT_PUBLISHER&#125;&quot;VIAddVersionKey &quot;FileVersion&quot; &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;InternalName&quot; &quot;$&#123;EXE_NAME&#125;&quot;VIAddVersionKey &quot;FileDescription&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot;VIAddVersionKey &quot;LegalCopyright&quot; &quot;$&#123;PRODUCT_LEGAL&#125;&quot;# ==================== NSISå±æ€§ ================================# ZLIB(é»˜è®¤) BZIP2 LZMASetCompressor lzma; å®‰è£…åŒ…åå­—.Name &quot;$&#123;PRODUCT_NAME&#125;&quot;# å®‰è£…ç¨‹åºæ–‡ä»¶å.OutFile &quot;ç½‘æ˜“äº‘éŸ³ä¹å®‰è£…0.exe&quot;# é»˜è®¤å®‰è£…ä½ç½®.InstallDir &quot;$PROGRAMFILES\\Netease\\CloudMusic&quot;# è®¾ç½®æ˜¯å¦æ˜¾ç¤ºå®‰è£…è¯¦ç»†ä¿¡æ¯ã€‚ShowInstDetails hide# è®¾ç½®æ˜¯å¦æ˜¾ç¤ºå¸è½½è¯¦ç»†ä¿¡æ¯ShowUnInstDetails hide# é’ˆå¯¹Vistaå’Œwin7 çš„UACè¿›è¡Œæƒé™è¯·æ±‚.# RequestExecutionLevel none|user|highest|adminRequestExecutionLevel admin# ==================== MUIå±æ€§ ==================================# å®‰è£…å’Œå¸è½½ç¨‹åºå›¾æ ‡!define MUI_ICON &quot;image\\logo.ico&quot;!define MUI_UNICON &quot;image\\un_logo.ico&quot;# å¦‚æœæœªä½¿ç”¨MUIï¼Œåˆ™å¯ç›´æ¥ä½¿ç”¨.onGUIInit!define MUI_CUSTOMFUNCTION_GUIINIT onGUIInit# å®‰è£…ç¨‹åºæ¬¢è¿é¡µé¢!insertmacro MUI_PAGE_WELCOME# å®‰è£…ç¨‹åºè½¯ä»¶æˆæƒç”³æ˜é¡µé¢!insertmacro MUI_PAGE_LICENSE &quot;license.rtf&quot;# å®‰è£…ç¨‹åºæ˜¾ç¤ºå®‰è£…ç›®å½•é€‰æ‹©é¡µé¢!insertmacro MUI_PAGE_DIRECTORY# å®‰è£…ç¨‹åºæ˜¾ç¤ºå®‰è£…ç»„ä»¶é€‰æ‹©é¡µé¢!insertmacro MUI_PAGE_COMPONENTS# å®‰è£…ç¨‹åºæ˜¾ç¤ºè¿›åº¦é¡µé¢!insertmacro MUI_PAGE_INSTFILES# å®‰è£…ç¨‹åºæ˜¾ç¤ºå®‰è£…ç»“æŸé¡µé¢!insertmacro MUI_PAGE_FINISH# å¸è½½ç¨‹åºæ˜¾ç¤ºè¿›åº¦!insertmacro MUI_UNPAGE_INSTFILES# å¸è½½ç¨‹åºæ˜¾ç¤ºå®‰è£…ç»“æŸ!insertmacro MUI_UNPAGE_FINISH# æŒ‡å®šè¯­è¨€ï¼Œå¿…é¡»åœ¨æœ€åæŒ‡å®š!insertmacro MUI_LANGUAGE &quot;SimpChinese&quot;# ========================= å®‰è£…æ­¥éª¤ ===============================# åŒºæ®µ1# åŒºæ®µåä»¥ä¸€ä¸ª ! å¼€å¤´ï¼Œé‚£ä¹ˆè¯¥åŒºæ®µçš„æ˜¾ç¤ºåç§°å°†ä»¥ç²—ä½“å­—æ˜¾ç¤º.Section &quot;!Files&quot; &quot;des_files&quot; ; è®¾ç½®æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„ SetOutPath $INSTDIR ; æ”¾ç½®æ–‡ä»¶ File /r &quot;app\\*.*&quot;SectionEnd# åŒºæ®µ2Section &quot;Shortcut&quot; &quot;des_shortcut&quot; SetShellVarContext all CreateDirectory &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;&quot; CreateShortCut &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\$&#123;PRODUCT_NAME&#125;.lnk&quot; &quot;$INSTDIR\\$&#123;EXE_NAME&#125;&quot; CreateShortCut &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\å¸è½½$&#123;PRODUCT_NAME&#125;.lnk&quot; &quot;$INSTDIR\\uninst.exe&quot; SetShellVarContext currentSectionEnd# åŒºæ®µ3# åŒºæ®µåä¸ºç©ºã€é—æ¼æˆ–è€…ä»¥ä¸€ä¸ª &quot;-&quot; å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯ä¸€ä¸ªéšè—çš„åŒºæ®µï¼Œç”¨æˆ·ä¹Ÿä¸èƒ½é€‰æ‹©ç¦æ­¢å®ƒ.Section &quot;-Necessary&quot; # ç”Ÿæˆå¸è½½ç¨‹åº WriteUninstaller &quot;$INSTDIR\\uninst.exe&quot; # æ·»åŠ å¸è½½ä¿¡æ¯åˆ°æ§åˆ¶é¢æ¿ WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;DisplayName&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot; WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;UninstallString&quot; &quot;$INSTDIR\\uninst.exe&quot; WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\\$&#123;EXE_NAME&#125;&quot; WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;Publisher&quot; &quot;$INSTDIR\\$&#123;PRODUCT_PUBLISHER&#125;&quot;SectionEnd# å¸è½½åŒºæ®µSection &quot;Uninstall&quot; ; åˆ é™¤å¿«æ·æ–¹å¼ SetShellVarContext all Delete &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\$&#123;PRODUCT_NAME&#125;.lnk&quot; Delete &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\å¸è½½$&#123;PRODUCT_NAME&#125;.lnk&quot; RMDir &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\&quot; Delete &quot;$DESKTOP\\$&#123;PRODUCT_NAME&#125;.lnk&quot; SetShellVarContext current SetOutPath &quot;$INSTDIR&quot; ; åˆ é™¤å®‰è£…çš„æ–‡ä»¶ Delete &quot;$INSTDIR\\*.*&quot; SetOutPath &quot;$DESKTOP&quot; RMDir /r &quot;$INSTDIR&quot; RMDir &quot;$INSTDIR&quot; SetAutoClose trueSectionEnd# åŒºæ®µæè¿°!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN !insertmacro MUI_DESCRIPTION_TEXT $&#123;des_files&#125; &quot;ä¸»ç¨‹åºæ–‡ä»¶&quot; !insertmacro MUI_DESCRIPTION_TEXT $&#123;des_shortcut&#125; &quot;åˆ›å»ºå¼€å§‹èœå•å’Œæ¡Œé¢å¿«æ·æ–¹å¼&quot;!insertmacro MUI_FUNCTION_DESCRIPTION_END# ============================== å›è°ƒå‡½æ•° ====================================# å‡½æ•°åä»¥â€œ.â€å¼€å¤´çš„ä¸€èˆ¬ä½œä¸ºå›è°ƒå‡½æ•°ä¿ç•™.# å‡½æ•°åä»¥â€œun.â€å¼€å¤´çš„å‡½æ•°å°†ä¼šè¢«åˆ›å»ºåœ¨å¸è½½ç¨‹åºé‡Œï¼Œå› æ­¤ï¼Œæ™®é€šå®‰è£…åŒºæ®µå’Œå‡½æ•°ä¸èƒ½è°ƒç”¨å¸è½½å‡½æ•°ï¼Œè€Œå¸è½½åŒºæ®µå’Œå¸è½½å‡½æ•°ä¹Ÿä¸èƒ½è°ƒç”¨æ™®é€šå‡½æ•°ã€‚Function .onInitFunctionEndFunction onGUIInitFunctionEnd# å®‰è£…æˆåŠŸä»¥å.Function .onInstSuccessFunctionEnd# å¸è½½æ“ä½œå¼€å§‹å‰.Function un.onInit MessageBox MB_ICONQUESTION|MB_YESNO &quot;ä½ ç¡®å®è¦å®Œå…¨åˆ é™¤ç½‘æ˜“äº‘éŸ³ä¹ï¼ŒåŠå…¶æ‰€æœ‰ç»„ä»¶å—?&quot; /SD IDYES IDYES +2 IDNO +1 AbortFunctionEnd# å¸è½½æˆåŠŸä»¥å.Function un.onUninstSuccess MessageBox MB_ICONINFORMATION|MB_OK &quot;$&#123;PRODUCT_NAME&#125; å·²æˆåŠŸåœ°ä»ä½ çš„è®¡ç®—æœºç§»é™¤&quot; /SD IDOKFunctionEnd è¿è¡Œæ•ˆæœ","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(4)-ä¼ ç»Ÿç•Œé¢ç¤ºä¾‹","path":"/post/275632694.html","content":"æœ¬æ–‡ä»¥ä¸€ä¸ªå®Œæ•´çš„ã€ä¼ ç»Ÿç•Œé¢çš„ç½‘æ˜“äº‘éŸ³ä¹å®‰è£…åŒ…çš„è„šæœ¬ä¸ºç¤ºä¾‹ï¼Œæ¥ä»‹ç» NSIS ä¼ ç»Ÿç”¨æˆ·ç•Œé¢çš„å¼€å‘æµç¨‹ã€‚ ç½‘æ˜“äº‘éŸ³ä¹å®‰è£…è„šæœ¬å®Œæ•´çš„ç¤ºä¾‹è„šæœ¬å¦‚ä¸‹ï¼Œè„šæœ¬ä¸­åŒ…å«äº†è¯¦ç»†çš„æ³¨é‡ŠåŠ ä»¥è§£é‡Šè¯´æ˜ã€‚è¯·å°†ä¸‹é¢è„šæœ¬ä¿å­˜ä¸º.nsi æ–‡ä»¶ï¼ˆéœ€ä½¿ç”¨ ANSI ç¼–ç ä¿å­˜ï¼‰ï¼Œç¼–è¯‘å³å¯ç”Ÿæˆå®‰è£…åŒ…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199# å•è¡Œæ³¨é‡Šç”¨äº•å·&quot;#&quot;æˆ–åˆ†å·&quot;;&quot;ï¼Œè·¨è¡Œæ³¨é‡Šç”¨å¯ä»¥ç”¨C/C++ä¸­æ³¨é‡Šè¯­æ³•ã€‚# ä½¿ç”¨!defineå®šä¹‰ä¸€äº›å¸¸é‡ï¼ˆå¦‚å®‰è£…åŒ…çš„ç‰ˆæœ¬å·ç­‰ï¼‰# å¯¹å¸¸é‡æˆ–å˜é‡çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨å¦‚$&#123;PRODUCT_NAME&#125;æ ¼å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚$PRODUCT_NAMEæ ¼å¼!define PRODUCT_NAME &quot;ç½‘æ˜“äº‘éŸ³ä¹&quot;!define EXE_NAME &quot;cloudmusic.exe&quot;!define PRODUCT_VERSION &quot;1.0.0.1&quot;!define PRODUCT_PUBLISHER &quot;NetEase&quot;!define PRODUCT_LEGAL &quot;NetEase 1999-2014&quot;!define TEMP_DIR &quot;&quot;/*NSISå†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„å˜é‡ï¼Œå¦‚$INSTDIR è¡¨ç¤ºç”¨æˆ·å®šä¹‰çš„è§£å‹è·¯å¾„ï¼›$DESKTOP è¡¨ç¤ºWindowsæ¡Œé¢ç›®å½•ï¼›ç­‰ç­‰ã€‚ä¹Ÿå¯ä»¥ç”¨ Var å‘½ä»¤æ¥å£°æ˜è‡ªå·±çš„å˜é‡($VARNAME)ã€‚ NSISçš„å˜é‡éƒ½æ˜¯å…¨å±€çš„å¹¶ä¸”å¯ä»¥åœ¨ä»»ä½•åŒºæ®µæˆ–å‡½æ•°ä¸­ä½¿ç”¨ã€‚å¦å¤–å †æ ˆå¯ä»¥ç”¨æ¥ä½œä¸ºä¸´æ—¶å­˜å‚¨ã€‚ ä½¿ç”¨ Push å’Œ Pop å‘½ä»¤æ¥è®¿é—®å †æ ˆã€‚PushæŠŠä¸€ä¸ªå€¼æ·»åŠ åˆ°å †æ ˆï¼ŒPopç§»é™¤ä¸€ä¸ªå€¼å¹¶ä¸”è®¾ç½®è¯¥å˜é‡ã€‚ä¸”NSISå†…ç½®äº†20ä¸ªå·²æ³¨å†Œçš„å˜é‡ (å¦‚ $0~$9 å’Œ $R0~$R9)ã€‚ è¿™äº›å˜é‡ä¸éœ€è¦å£°æ˜å°±å¯ä»¥ä½¿ç”¨ã€‚*/# å®šä¹‰å®‰è£…åŒ…å¯æ‰§è¡Œæ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯VIProductVersion &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;ProductVersion&quot; &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;ProductName&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot;VIAddVersionKey &quot;CompanyName&quot; &quot;$&#123;PRODUCT_PUBLISHER&#125;&quot;VIAddVersionKey &quot;FileVersion&quot; &quot;$&#123;PRODUCT_VERSION&#125;&quot;VIAddVersionKey &quot;InternalName&quot; &quot;$&#123;EXE_NAME&#125;&quot;VIAddVersionKey &quot;FileDescription&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot;VIAddVersionKey &quot;LegalCopyright&quot; &quot;$&#123;PRODUCT_LEGAL&#125;&quot;# ==================== NSISå±æ€§ ================================# è®¾ç½®å®‰è£…åŒ…çš„å‹ç¼©æ–¹æ¡ˆï¼Œæœ‰ZLIBï¼ˆé»˜è®¤ï¼‰ã€BZIP2ã€LZMASetCompressor lzma; è®¾ç½®å®‰è£…åŒ…åå­—ï¼Œæ˜¾ç¤ºåœ¨å®‰è£…åŒ…æ ‡é¢˜æ ç­‰ä½ç½®Name &quot;$PRODUCT_NAME&quot;# å®‰è£…åŒ…å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶åOutFile &quot;ç½‘æ˜“äº‘éŸ³ä¹å®‰è£…-Basic UI.exe&quot;# å®‰è£…åŒ…é»˜è®¤å®‰è£…ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å®‰è£…è·¯å¾„çš„é»˜è®¤å€¼InstallDir &quot;$PROGRAMFILES\\Netease\\CloudMusic&quot;# è®¾ç½®æ˜¯å¦æ˜¾ç¤ºå®‰è£…è¯¦ç»†ä¿¡æ¯ShowInstDetails hide# è®¾ç½®æ˜¯å¦æ˜¾ç¤ºå¸è½½è¯¦ç»†ä¿¡æ¯ShowUnInstDetails hide# é’ˆå¯¹Vistaå’Œwin7+ çš„UACè¿›è¡Œæƒé™è¯·æ±‚.# RequestExecutionLevel none|user|highest|adminRequestExecutionLevel admin# å®‰è£…å’Œå¸è½½ç¨‹åºçš„å›¾æ ‡Icon &quot;image\\logo.ico&quot;UninstallIcon &quot;image\\un_logo.ico&quot;/*å‘å¯¼é¡µé¢æ˜¯NSISå®‰è£…ç¨‹åºä¸­æœ€é‡è¦çš„ç•Œé¢å…ƒç´ ï¼Œåœ¨nsisè„šæœ¬ä¸­å¯ä»¥ä½¿ç”¨NSISå†…ç½®é¡µé¢æˆ–è€…å®šåˆ¶ç•Œé¢ï¼Œé€šè¿‡è„šæœ¬å¯ä»¥æŒ‡å®šé¡µé¢çš„é¡ºåºã€æ˜¾ç¤ºæ ·å­å’Œè¡Œä¸ºã€‚ PageExæŒ‡ä»¤ç”¨æ¥å®šä¹‰å®‰è£…ç¨‹åºä¸­çš„é¡µé¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨PageæŒ‡ä»¤ï¼Œä½†PageExæä¾›æ›´å¤šé€‰é¡¹ï¼›UninstPageç”¨æ¥å®šä¹‰å¸è½½é¡µé¢ã€‚é¡µé¢æ˜¾ç¤ºçš„é¡ºåºå’Œå®ƒåœ¨nsisè„šæœ¬ä¸­å®šä¹‰çš„æ¬¡åºä¸€è‡´ã€‚å®‰è£…é¡µé¢æœ‰ï¼šlicense|components|directory|instfiles|å¸è½½é¡µé¢æœ‰ï¼šuninstConfirmæ¯ä¸ªé¡µé¢æœ‰ä¸åŒå…ƒç´ å’Œå±æ€§ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨Page customæ¥è‡ªå®šä¹‰é¡µé¢ï¼Œè¿™ä¸ªåé¢çš„æ–‡ç« æœ‰è®²åˆ°ã€‚*/PageEx license LicenseData &quot;license.rtf&quot; #å¯ä»¥æ˜¯txtæˆ–rtfæ–‡ä»¶æ ¼å¼PageExEnd/*åœ¨ä¸€ä¸ªæ™®é€šçš„å®‰è£…åŒ…é‡Œç”¨æˆ·éœ€è¦å®‰è£…è®¸å¤šä¸œè¥¿ã€‚ä¾‹å¦‚åœ¨NSISå®‰è£…åŒ…é‡Œä½ å¯ä»¥é€‰æ‹©å®‰è£…æºç ã€é™„åŠ æ’ä»¶ã€è„šæœ¬æ ·ä¾‹æˆ–å…¶ä»–ã€‚é‡Œé¢çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰å®ƒè‡ªå·±çš„ä»£ç å—ï¼Œå½“ç”¨æˆ·é€‰æ‹©äº†å®‰è£…è¯¥ç»„ä»¶ï¼Œé‚£ä¹ˆå®‰è£…ç¨‹åºå°±ä¼šæ‰§è¡Œå¯¹åº”çš„ä»£ç ã€‚åœ¨è„šæœ¬é‡Œï¼Œè¿™äº›ä»£ç ç§°ä¸ºåŒºæ®µï¼Œè§ä¸‹é¢çš„Sectionã€‚æ¯ä¸ªå¯è§çš„åŒºæ®µéƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªç»„ä»¶ç»™ç”¨æˆ·é€‰æ‹©æ˜¯å¦å®‰è£…ã€‚ä½ å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªåŒºæ®µæ¥æ„å»ºå®‰è£…åŒ…ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦ä½¿ç”¨ç»„ä»¶é¡µæ¥è®©ç”¨æˆ·é€‰æ‹©å¯é€‰çš„ç»„ä»¶ï¼Œé‚£ä½ å°±éœ€è¦ä½¿ç”¨å¤šä¸ªåŒºæ®µã€‚*/PageEx components Caption &quot;ç»„ä»¶é€‰æ‹©&quot; ComponentText &quot;é€‰æ‹©å®‰è£…ç»„ä»¶ï¼š&quot; &quot;ä¸»ç¨‹åº&quot; &quot;å¿«æ·æ–¹å¼&quot;PageExEndPageEx directory Caption &quot;å®‰è£…ç›®å½•&quot; DirText &quot;è¯·é€‰æ‹©å®‰è£…ç›®å½•ï¼š&quot;PageExEndPageEx instfilesPageExEnd# åŒºæ®µ1# åŒºæ®µåä»¥ä¸€ä¸ª!å¼€å¤´ï¼Œé‚£ä¹ˆè¯¥åŒºæ®µçš„æ˜¾ç¤ºåç§°å°†ä»¥ç²—ä½“å­—æ˜¾ç¤º.Section &quot;!Files&quot; &quot;des_files&quot; ; è®¾ç½®ä¸‹é¢æŒ‡å®šçš„æ–‡ä»¶åœ¨å®‰è£…æ—¶é»˜è®¤çš„è§£å‹è·¯å¾„ SetOutPath $INSTDIR ; æŒ‡æ˜å“ªäº›æ–‡ä»¶éœ€è¦è¢«å‹ç¼©è¿›å…¥å®‰è£…åŒ…ï¼Œ&quot;app\\*.*&quot;æ˜¯ç›¸å¯¹äºnsisè„šæœ¬æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ File /r &quot;app\\*.*&quot;SectionEnd# åŒºæ®µ2# è¯¥åŒºæ®µä¸“é—¨ç”¨æ¥åˆ›å»ºä¸€äº›å¿«æ·æ–¹å¼#Section &quot;Shortcut&quot; &quot;des_shortcut&quot; SetShellVarContext all CreateDirectory &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;&quot; CreateShortCut &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\$&#123;PRODUCT_NAME&#125;.lnk&quot; &quot;$INSTDIR\\$&#123;EXE_NAME&#125;&quot; CreateShortCut &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\å¸è½½$&#123;PRODUCT_NAME&#125;.lnk&quot; &quot;$INSTDIR\\uninst.exe&quot; SetShellVarContext currentSectionEnd# åŒºæ®µ3# åŒºæ®µåä¸ºç©ºã€é—æ¼æˆ–è€…ä»¥ä¸€ä¸ª &quot;-&quot; å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯ä¸€ä¸ªéšè—çš„åŒºæ®µï¼Œç”¨æˆ·ä¹Ÿä¸èƒ½é€‰æ‹©ç¦æ­¢å®ƒ.#Section &quot;-Necessary&quot; # ç”Ÿæˆå¸è½½ç¨‹åº WriteUninstaller &quot;$INSTDIR\\uninst.exe&quot; # æ·»åŠ å¸è½½ä¿¡æ¯åˆ°æ§åˆ¶é¢æ¿ WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;DisplayName&quot; &quot;$&#123;PRODUCT_NAME&#125;&quot; WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;UninstallString&quot; &quot;$INSTDIR\\uninst.exe&quot; /* åœ¨NSISè„šæœ¬é‡Œæ¯ä¸€è¡Œéƒ½ä½œä¸ºä¸€ä¸ªå‘½ä»¤å¤„ç†ï¼Œå¦‚æœè¿™ä¸€è¡Œå¤ªé•¿çš„è¯ä½ å¯ä»¥ä½¿ç”¨â€œ\\â€æ¥åˆ†éš”ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°æŠŠä¸‹ä¸€è¡Œæ¥åˆ°ä¸Šä¸€è¡Œæ¥ä½œä¸ºå®Œæ•´çš„ä¸€è¡Œï¼Œè€Œä¸æ˜¯çœ‹ä½œæ–°çš„è¡Œã€‚ */ WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\\$&#123;EXE_NAME&#125;&quot; WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$&#123;PRODUCT_NAME&#125;&quot; &quot;Publisher&quot; &quot;$INSTDIR\\$&#123;PRODUCT_PUBLISHER&#125;&quot;SectionEnd# å¸è½½åŒºæ®µï¼Œå¦‚æœä¸€ä¸ªåŒºæ®µåä¸ºâ€œUninstallâ€æˆ–ä»¥â€œun.â€ä¸ºå‰ç¼€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¸è½½ç¨‹åºåŒºæ®µã€‚#Section &quot;Uninstall&quot; ; åˆ é™¤å¿«æ·æ–¹å¼ï¼ŒSetShellVarContext è®¾ç½®æ“ä½œæ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·è¿˜æ˜¯æ‰€æœ‰ç”¨æˆ· SetShellVarContext all Delete &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\$&#123;PRODUCT_NAME&#125;.lnk&quot; Delete &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\å¸è½½$&#123;PRODUCT_NAME&#125;.lnk&quot; RMDir &quot;$SMPROGRAMS\\$&#123;PRODUCT_NAME&#125;\\&quot; Delete &quot;$DESKTOP\\$&#123;PRODUCT_NAME&#125;.lnk&quot; SetShellVarContext current SetOutPath &quot;$INSTDIR&quot; ; åˆ é™¤å®‰è£…çš„æ–‡ä»¶ Delete &quot;$INSTDIR\\*.*&quot; SetOutPath &quot;$DESKTOP&quot; RMDir /r &quot;$INSTDIR&quot; RMDir &quot;$INSTDIR&quot; SetAutoClose trueSectionEnd# ============================== å›è°ƒå‡½æ•° ====================================# å‡½æ•°åä»¥â€œ.â€å¼€å¤´çš„ä¸€èˆ¬ä½œä¸ºå›è°ƒå‡½æ•°ä¿ç•™.# å‡½æ•°åä»¥â€œun.â€å¼€å¤´çš„å‡½æ•°å°†ä¼šè¢«åˆ›å»ºåœ¨å¸è½½ç¨‹åºé‡Œï¼Œå› æ­¤ï¼Œæ™®é€šå®‰è£…åŒºæ®µå’Œå‡½æ•°ä¸èƒ½è°ƒç”¨å¸è½½å‡½æ•°ï¼Œè€Œå¸è½½åŒºæ®µå’Œå¸è½½å‡½æ•°ä¹Ÿä¸èƒ½è°ƒç”¨æ™®é€šå‡½æ•°ã€‚Function .onInitFunctionEndFunction .onGUIInitFunctionEnd# å®‰è£…æˆåŠŸä»¥å.Function .onInstSuccessFunctionEnd# å¸è½½æ“ä½œå¼€å§‹å‰.Function un.onInit MessageBox MB_ICONQUESTION|MB_YESNO &quot;ä½ ç¡®å®è¦å®Œå…¨åˆ é™¤ç½‘æ˜“äº‘éŸ³ä¹ï¼ŒåŠå…¶æ‰€æœ‰ç»„ä»¶å—?&quot; /SD IDYES IDYES +2 IDNO +1 AbortFunctionEnd# å¸è½½æˆåŠŸä»¥å.Function un.onUninstSuccess MessageBox MB_ICONINFORMATION|MB_OK &quot;$&#123;PRODUCT_NAME&#125; å·²æˆåŠŸåœ°ä»ä½ çš„è®¡ç®—æœºç§»é™¤&quot; /SD IDOKFunctionEnd ä¸Šè¿°è„šæœ¬ä¼šå°†ä¸è„šæœ¬ç›¸åŒçº§åˆ«çš„ app ç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶ï¼ˆå«å­ç›®å½•ï¼‰æ‰“åŒ…è¿›å®‰è£…åŒ…ã€‚image\\logo.icoå’Œimage\\un_logo.icoåˆ†åˆ«æ˜¯å®‰è£…åŒ…å’Œå¸è½½ç¨‹åºçš„å›¾æ ‡ã€‚ è¿è¡Œæˆªå›¾","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(3)-å®Œæ•´æŒ‡ä»¤","path":"/post/2673115526.html","content":"æœ¬æ–‡åˆ—å‡ºäº† NSIS æ”¯æŒçš„å®Œæ•´æŒ‡ä»¤ï¼Œä»¥ä¾›æŸ¥é˜…ã€‚ åŸºæœ¬æŒ‡ä»¤NSIS ç”¨äºè„šæœ¬çš„è¿™äº›æŒ‡ä»¤ç¨å¾®çš„è¿‘ä¼¼äº PHP å’Œæ±‡ç¼–ã€‚ä»–ä»¬æ²¡æœ‰çœŸæ­£çš„é«˜çº§è¯­è¨€ç»“æ„ï¼Œä½†æ˜¯ä»–ä»¬çš„æŒ‡ä»¤(å¯¹äºç»å¤§éƒ¨åˆ†)å´æ˜¯é«˜çº§çš„ï¼Œå¹¶ä¸”ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„æŒæ¡(æ¯”å¦‚ä½ ä¸ç”¨æ‹…å¿ƒå­—ä¸²çš„è¿æ¥ç­‰ç­‰)ã€‚NSIS ä¸ºä½ æä¾›äº† 25 ä¸ªå¯„å­˜å™¨(20 ä¸ªå¸¸è§„ç”¨é€”ï¼Œ5 ä¸ªç‰¹æ®Šç”¨é€”)ï¼Œå’Œä¸€ä¸ªå †æ ˆã€‚ Delete1[/REBOOTOK] æ–‡ä»¶ ä»ç›®æ ‡ç³»ç»Ÿåˆ é™¤æ–‡ä»¶(å¯ä»¥æ˜¯æ–‡ä»¶æˆ–é€šé…ç¬¦ï¼Œä½†å¿…é¡»æŒ‡å®šä¸€ä¸ªå®Œæ•´çš„è·¯å¾„)ã€‚å¦‚æœæŒ‡å®šäº†â€œ&#x2F;REBOOTOKâ€å¹¶ä¸”è¯¥æ–‡ä»¶å½“å‰ä¸å¯åˆ é™¤ï¼Œåˆ™ä¼šåœ¨ç³»ç»Ÿé‡å¯æ—¶åˆ é™¤è¯¥æ–‡ä»¶ â€“ å¦‚æœè¯¥æ–‡ä»¶è¦åœ¨ç³»ç»Ÿé‡å¯æ—¶åˆ é™¤ï¼Œä½ è¿˜è¦è®¾ç½®ä¸€ä¸ªé‡å¯çš„ä½æ ‡è®¡ã€‚å¦‚æœæ‰¾åˆ°çš„æ–‡ä»¶ä¸èƒ½è¢«åˆ é™¤åˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ä½†è¯¥é”™è¯¯ä½æ ‡è®¡ä¸æ˜¯ä»å°è¯•åˆ é™¤ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶è®¾ç½®çš„ã€‚ Execå‘½ä»¤æ‰§è¡Œä¸€ä¸ªæŒ‡å®šçš„ç¨‹åºå¹¶ä¸”ç«‹å³ç»§ç»­å®‰è£…ã€‚æ³¨æ„æŒ‡å®šçš„æ–‡ä»¶å¿…é¡»å­˜åœ¨äºç›®æ ‡ç³»ç»Ÿè€Œä¸æ˜¯ç¼–è¯‘çš„ç³»ç»Ÿã€‚$OUTDIR ç”¨äºæŒ‡å®šå·¥ä½œè·¯å¾„ã€‚å¦‚æœè¯¥å‘½ä»¤ä¸èƒ½è¢«è¿è¡Œåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚æ³¨æ„ï¼Œå¦‚æœè¯¥å‘½ä»¤åŒ…å«æœ‰ç©ºæ ¼ï¼Œä½ è¦ç”¨å¼•å·æ¥æŠŠä»–ä»¬åŒ…æ‹¬èµ·æ¥ã€‚ä¾‹å¦‚ï¼šExec â€˜â€œ$INSTDIR\\command.exeâ€ å‚æ•°â€™ã€‚å¦‚æœä½ ä¸ç”¨å¼•å·æ‹¬èµ·æ¥åˆ™åœ¨ Windwos 9X ä¸‹ä¸æ­£å¸¸æˆ–ä¸¢å¤±å‚æ•°ã€‚ ExecShell1åŠ¨ä½œ å‘½ä»¤ [å‚æ•°] [SW_SHOWNORMAL | SW_SHOWMAXIMIZED | SW_SHOWMINIMIZED] ä½¿ç”¨ Windows çš„å¤–å£³å…³è”æ¥æ‰§è¡Œä¸€ä¸ªæŒ‡å®šçš„ç¨‹åºã€‚æ³¨æ„â€œåŠ¨ä½œâ€é€šå¸¸ä¸ºâ€œopenâ€ã€â€œprintâ€ç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç©ºå­—ä¸²æ¥ä½¿ç”¨é»˜è®¤åŠ¨ä½œã€‚å‚æ•°å’Œæ˜¾ç¤ºç±»å‹æ˜¯å¯é€‰é¡¹ã€‚$OUTDIR ç”¨äºæŒ‡å®šå·¥ä½œè·¯å¾„ã€‚å¦‚æœè¯¥å¤„ç†ä¸èƒ½è¢«è¿è¡Œåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ ExecWait1å‘½ä»¤ [ç”¨æˆ·å˜é‡(é€€å‡ºä»£ç )] æ‰§è¡Œä¸€ä¸ªæŒ‡å®šçš„ç¨‹åºå¹¶ä¸”ç­‰å¾…è¿è¡Œå¤„ç†ç»“æŸã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ Execã€‚å¦‚æœæ²¡æœ‰ç”¨æˆ·è¾“å‡ºå˜é‡ ExecWait ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡å½“ç¨‹åºæ‰§è¡Œè¿”å›ä¸€ä¸ªéé›¶é”™è¯¯ä»£ç ï¼Œæˆ–è€…å½“äº§ç”Ÿé”™è¯¯æ—¶ã€‚å¦‚æœæŒ‡å®šäº†è¾“å‡ºå˜é‡ï¼ŒExecWait ä¼šæŠŠå˜é‡ç½®ä¸ºé€€å‡ºä»£ç (å¹¶ä¸”ä»…å½“äº§ç”Ÿä¸€ä¸ªé”™è¯¯æ—¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ï¼›å¦‚æœäº§ç”Ÿä¸€ä¸ªé”™è¯¯åˆ™è¯¥ç”¨æˆ·å˜é‡çš„å†…å®¹ä¸ºæœªæŒ‡å®š)ã€‚æ³¨æ„ï¼Œå¦‚æœè¯¥å‘½ä»¤åŒ…å«æœ‰ç©ºæ ¼ï¼Œä½ è¦ç”¨å¼•å·æ¥æŠŠä»–ä»¬åŒ…æ‹¬èµ·æ¥ã€‚ä¾‹å¦‚ï¼šExec â€˜â€œ$INSTDIR\\command.exeâ€ å‚æ•°â€™ã€‚å¦‚æœä½ ä¸ç”¨å¼•å·æ‹¬èµ·æ¥åˆ™åœ¨ Windwos 9X ä¸‹ä¸æ­£å¸¸æˆ–ä¸¢å¤±å‚æ•°ã€‚ File1[/nonfatal] [/a] ([/r] (æ–‡ä»¶|é€šé…ç¬¦) [...] | /oname=è¾“å‡ºè·¯å¾„\\æ–‡ä»¶å è¾“å…¥è·¯å¾„\\æ–‡ä»¶å) é‡Šæ”¾æ–‡ä»¶åˆ°å½“å‰è¾“å‡ºè·¯å¾„($OUTDIR). æ³¨æ„è¾“å‡ºæ–‡ä»¶åæ˜¯ $OUTDIR\\æ–‡ä»¶åã€‚ å¦‚æœä½¿ç”¨äº† &#x2F;oname&#x3D;X å¼€å…³ï¼Œåˆ™è¾“å‡ºåå˜ä¸º $OUTDIR\\Xã€‚å½“ä½¿ç”¨äº† &#x2F;oname&#x3D; å¼€å…³æ—¶åªèƒ½æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œä¸”æ–‡ä»¶åå¯ä»¥ä½¿ç”¨å˜é‡(æˆ–å®Œæ•´è·¯å¾„å¦‚ $SYSDIR\\whatever.dll)ã€‚æ”¯æŒé€šé…ç¬¦ã€‚ å¦‚æœä½¿ç”¨äº† &#x2F;r å¼€å…³ï¼Œæ–‡ä»¶å’Œç›®å½•å°†ä¼šè¢«é€’å½’æ·»åŠ ã€‚å¦‚æœæ²¡æœ‰å°¾éšé€šé…ç¬¦(å¦‚ File &#x2F;r C:\\whatever\\mydir)ï¼Œåˆ™æ•´ä¸ª mydir ç›®å½•æ ‘å°†ä¼šè¢«æ·»åŠ åˆ° $OUTDIRã€‚å¦‚æœè¦ä½¿å®ƒæ”¾åˆ° $OUTDIR è¯·ä½¿ç”¨ File &#x2F;r C:\\whatever\\mydir*.*ã€‚ å¦‚æœä½¿ç”¨äº† &#x2F;a å¼€å…³ï¼Œè¢«æ·»åŠ çš„æ–‡ä»¶çš„å±æ€§å°†ä¼šè¢«ä¿æŠ¤ã€‚ å¦‚æœè¦†ç›–æ¨¡å¼è¢«è®¾å®šä¸º â€œtryâ€ å¹¶ä¸”æ–‡ä»¶æœªè¢«è¦†ç›–ï¼Œé‚£ä¹ˆ File å‘½ä»¤å°†ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ï¼Œæˆ–è€…å¦‚æœè¦†ç›–æ¨¡å¼è¢«è®¾å®šä¸º â€œonâ€ å¹¶ä¸”æ–‡ä»¶æœªè¢«è¦†ç›–å¹¶ä¸”ç”¨æˆ·é€‰æ‹©äº†å¿½ç•¥ï¼Œé‚£ä¹ˆä¹Ÿä¼šè¢«ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ å¦‚æœä½¿ç”¨äº† &#x2F;nonfatal å¼€å…³ï¼Œå½“æ–‡ä»¶æœªæ‰¾åˆ°æ—¶ä½¿ç”¨è­¦å‘Šæ¥ä»£æ›¿é”™è¯¯ã€‚ Rename1[/REBOOTOK] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ æŠŠæºæ–‡ä»¶é‡å‘½åä¸ºç›®æ ‡æ–‡ä»¶ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥æŠŠç”¨æˆ·ç³»ç»Ÿé‡Œçš„ä»»ä½•åœ°æ–¹çš„ä¸€ä¸ªæ–‡ä»¶ç§»åŠ¨åˆ°ç”¨æˆ·ç³»ç»Ÿé‡Œçš„ä»»ä½•åœ°æ–¹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä¸€äº›é©±åŠ¨å™¨ä¸ŠæŠŠä¸€ä¸ªç›®å½•ç§»åŠ¨åˆ°æŸäº›åœ°æ–¹ã€‚ç›®æ ‡æ–‡ä»¶å¿…é¡»ä¸ºä¸å­˜åœ¨å¦åˆ™ç§»åŠ¨å¤±è´¥(é™¤éä½ ä½¿ç”¨äº† &#x2F;REBOOTOK)ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;REBOOTOKï¼Œå¹¶ä¸”æ–‡ä»¶å½“æ—¶ä¸èƒ½ç§»åŠ¨(æ¯”å¦‚ï¼Œç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨)ï¼Œåˆ™è¯¥æ–‡ä»¶åœ¨ç³»ç»Ÿé‡å¯åæ‰è¢«ç§»åŠ¨åˆ°ç›®æ ‡ã€‚å¦‚æœæ–‡ä»¶åœ¨é‡å¯åæ‰è¢«ç§»åŠ¨ï¼Œä¼šç½®ä¸€ä¸ªé‡å¯çš„ä½æ ‡è®¡ã€‚å½“æ–‡ä»¶ä¸èƒ½è¢«é‡å‘½åæ—¶(å¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ &#x2F;REBOOTOK)æˆ–è€…åŸæ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„åˆ™ä½¿ç”¨å½“å‰è·¯å¾„ä»£æ›¿ã€‚å½“å‰è·¯å¾„å¯ä»¥ä½¿ç”¨ SetOutPath æŒ‡ä»¤æ¥è®¾ç½®ã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ SetOutPath é‚£ä¹ˆå½“å‰è·¯å¾„ä¸º $EXEDIRã€‚ ReserveFile1[/nonfatal] [/r] æ–‡ä»¶ [æ–‡ä»¶...] ä¿å­˜ä¸€ä¸ªæ–‡ä»¶åœ¨æœ€åä½¿ç”¨çš„æ•°æ®åŒºå—ã€‚ä¹‹æ‰€ä»¥è¦æŠŠåœ¨è„šæœ¬ä¸­ä½¿ç”¨åˆ°çš„æ–‡ä»¶ï¼Œè¿™æ ·æ·»åŠ æ˜¯å› ä¸ºè¦åœ¨ .onInit å‡½æ•°é‡Œä½¿ç”¨ï¼Œä¾‹å¦‚ä½¿å¾—å®‰è£…ç¨‹åºè½½å…¥å˜æ…¢ã€‚è¿™æ—¶å€™è¿™ä¸ªå‘½ä»¤å°±éå¸¸æœ‰ç”¨äº†ï¼Œå®ƒå¯ä»¥æŠŠæ–‡ä»¶åŒ…å«åœ¨æ•°æ®åŒºå—çš„é¡¶ç«¯è€Œä¸æ˜¯è®© NSIS ä»å·²å‹ç¼©çš„æ•°æ®åŒºå—ä»å¤´æœåˆ°è„šæ¥æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«å®‰è£…ç¨‹åºè½½å…¥é€Ÿåº¦ã€‚ ç›¸å…³å‚æ•°è¯´æ˜è¯·æŸ¥çœ‹ Fileã€‚ RMDir1[/r|/REBOOTOK] ç›®å½•å åˆ é™¤æŒ‡å®šçš„ç›®å½•(å®Œæ•´çš„è·¯å¾„)ã€‚æ²¡æœ‰ &#x2F;r å‚æ•°æ—¶åªæœ‰åœ¨ç›®å½•ä¸ºç©ºæ—¶æ‰ä¼šè¢«åˆ é™¤ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;rï¼Œåˆ™ç›®å½•ä¼šè¢«é€’å½’åˆ é™¤ï¼Œæ‰€ä»¥åœ¨æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•å‡è¢«åˆ é™¤ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;REBOOTOKï¼Œå¹¶ä¸”ç›®å½•ä¸èƒ½è¢«è¦†ç›–ï¼Œåˆ™å½“ç³»ç»Ÿé‡å¯çš„æ—¶å€™ä¼šè¢«åˆ é™¤ â€”â€” å¦‚æœç›®å½•éœ€è¦åœ¨é‡å¯æ—¶è¢«åˆ é™¤ï¼Œä¼šè®¾ä¸€ä¸ªé‡å¯çš„ä½æ ‡è®¡ã€‚å½“ç›®å½•ä¸èƒ½è¢«åˆ é™¤æ—¶ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SetOutPathè¾“å‡ºè·¯å¾„è®¾ç½®è¾“å‡ºè·¯å¾„($OUTDIR)ä¸”å½“è·¯å¾„ä¸å­˜åœ¨æ—¶åˆ›å»º(éœ€è¦æ—¶é€’å½’)ã€‚å¿…é¡»ä¸ºå…¨è·¯å¾„åï¼Œé€šå¸¸ä½¿ç”¨ $INSTDIRã€‚ æ³¨å†Œè¡¨ã€INI æ–‡ä»¶æŒ‡ä»¤åœ¨ä¸‹é¢æ‰€æœ‰çš„æ³¨å†Œè¡¨æŒ‡ä»¤é‡Œä½¿ç”¨ä¸€ä¸ªç©ºå­—ä¸²(â€œâ€)æ¥ä½œä¸ºæŸä¸ªå­å¥é»˜è®¤é¡¹ï¼Œè¯¥é»˜è®¤é¡¹åœ¨æ³¨å†Œè¡¨ç¼–è¾‘å™¨é‡Œæ˜¾ç¤ºä¸ºâ€œ(é»˜è®¤)â€ã€‚ DeleteINISec1INI_æ–‡ä»¶å åŒºæ®µå ä»â€œINI_æ–‡ä»¶åâ€é‡Œåˆ é™¤æ•´ä¸ªåŒºæ®µ [åŒºæ®µå]ã€‚å¦‚æœè¯¥åŒºæ®µä¸èƒ½è¢«åˆ é™¤ï¼Œä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ä½†æ˜¯å¦‚æœè¯¥åŒºæ®µæ‰¾ä¸åˆ°æ—¶åˆ™ä¸ä¼šç½®é”™è¯¯ä½æ ‡è®¡ã€‚ DeleteINIStr1INI_æ–‡ä»¶å åŒºæ®µå å­—ä¸²å ä»â€œINI_æ–‡ä»¶åâ€é‡Œçš„ [åŒºæ®µå] åŒºæ®µåˆ é™¤â€œå­—ä¸²åâ€å­—ä¸²ã€‚å¦‚æœè¯¥å­—ä¸²ä¸èƒ½è¢«åˆ é™¤ï¼Œä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ä½†æ˜¯å¦‚æœè¯¥å­—ä¸²æ‰¾ä¸åˆ°æ—¶åˆ™ä¸ä¼šç½®é”™è¯¯ä½æ ‡è®¡ã€‚ DeleteRegKey1[/ifempty] æ ¹é”® å­é”® åˆ é™¤ä¸€ä¸ªæ³¨å†Œè¡¨é”®ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;ifemptyï¼Œåˆ™è¯¥æ³¨å†Œè¡¨é”®ä»…å½“å®ƒæ— å­é”®æ—¶æ‰ä¼šè¢«åˆ é™¤(å¦åˆ™ï¼Œæ•´ä¸ªæ³¨å†Œè¡¨é”®å°†è¢«åˆ é™¤)ã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å¦‚æœè¯¥é”®ä¸èƒ½è¢«åˆ é™¤(æˆ–å¦‚æœå®ƒä¸å­˜åœ¨)åˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ DeleteRegValue1æ ¹é”® å­é”® é”®å åˆ é™¤ä¸€ä¸ªæ³¨å†Œè¡¨é”®å€¼ã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å¦‚æœè¯¥é”®å€¼ä¸èƒ½è¢«åˆ é™¤(æˆ–å¦‚æœå®ƒä¸å­˜åœ¨)åˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ EnumRegKey1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ¹é”® å­é”® ç´¢å¼• æŠŠç”¨æˆ·å˜é‡ $x è®¾ä¸ºâ€œæ ¹é”®\\å­é”®â€ç¬¬â€œç´¢å¼•â€å·æ³¨å†Œè¡¨é”®åã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å½“æŒ‡å®šçš„â€œæ ¹é”®\\å­é”®â€æ²¡æœ‰ä»»ä½•é”®æ—¶ä¼šè¿”å›ä¸€ä¸ªç©ºå­—ä¸²ï¼Œå½“äº§ç”Ÿä¸€ä¸ªé”™è¯¯æ—¶ä¼šè¿”å›ç©ºå­—ä¸²å¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ EnumRegValue1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ¹é”® å­é”® ç´¢å¼• æŠŠç”¨æˆ·å˜é‡ $x è®¾ä¸ºâ€œæ ¹é”®\\å­é”®â€ç¬¬â€œç´¢å¼•â€å·æ³¨å†Œè¡¨é”®å€¼ã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å½“æŒ‡å®šçš„â€œæ ¹é”®\\å­é”®â€æ²¡æœ‰ä»»ä½•é”®å€¼æ—¶ä¼šè¿”å›ä¸€ä¸ªç©ºå­—ä¸²ï¼Œå½“äº§ç”Ÿä¸€ä¸ªé”™è¯¯æ—¶ä¼šè¿”å›ç©ºå­—ä¸²å¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ ExpandEnvStrings1ç”¨æˆ·å˜é‡(è¾“å‡º) å­—ä¸² æŠŠâ€œå­—ä¸²â€é‡Œçš„ç¯å¢ƒå˜é‡æ‰©å±•åˆ°ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœé”™è¯¯ï¼Œè¯¥å˜é‡ä¼šè¢«è®¾ä¸ºç©ºå€¼å¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ FlushINI1INI_æ–‡ä»¶å åˆ·æ–° INI æ–‡ä»¶ç¼“å†²ã€‚Windows 9x ä¼šä¿æŒ INI æ–‡ä»¶åœ¨å†…å­˜é‡Œã€‚è¯¥å‘½ä»¤å¼ºåˆ¶æ›´æ”¹ç«‹å³å†™å…¥ç£ç›˜ã€‚å½“ä½ è‡ªå·±ç¼–è¾‘ä¸€ä¸ª INI æ–‡ä»¶çš„æ—¶å€™å¯ä»¥ä½¿ç”¨å®ƒï¼Œåˆ é™¤ã€ç§»åŠ¨ã€å¤åˆ¶ï¼Œç›´åˆ°ä½ ä½¿ç”¨ WriteINIStrã€DeleteINISec æˆ– DeleteINStr æ¥æ›´æ”¹å®ƒã€‚ ReadEnvStr1ç”¨æˆ·å˜é‡(è¾“å‡º) åç§° ä»ç¯å¢ƒå­—ä¸²â€œåç§°â€è¯»å–å€¼å¹¶æŠŠå€¼èµ‹ç»™ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœè¯»å–å­—ä¸²æ—¶æœ‰é”™è¯¯å‘ç”Ÿï¼Œè¯¥ç”¨æˆ·å˜é‡è¢«è®¾ä¸ºç©ºï¼Œå¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ ReadINIStr1ç”¨æˆ·å˜é‡(è¾“å‡º) INI_æ–‡ä»¶å åŒºæ®µå é¡¹å ä»â€œINI_æ–‡ä»¶åâ€çš„ [åŒºæ®µå] åŒºæ®µè¯»å–â€œé¡¹åâ€çš„å€¼å¹¶æŠŠè¯¥å€¼èµ‹ç»™ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœè¯¥é¡¹æœªæ‰¾åˆ°æ—¶ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ä¸”è¯¥ç”¨æˆ·å˜é‡è¢«èµ‹ä¸ºç©ºå€¼ã€‚ ReadRegDWORD1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ¹é”® å­é”® é¡¹ ä»æ³¨å†Œè¡¨è¯»å–ä¸€ä¸ª 32 ä½ DWORD åˆ°ç”¨æˆ·å˜é‡ $xã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å¦‚æœ DWORD ä¸å­˜åœ¨æ—¶ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡å¹¶æŠŠ $x è®¾ä¸ºç©ºå­—ä¸²ã€‚å¦‚æœè¯¥å€¼å­˜åœ¨ä½†ä¸æ˜¯ DWORDï¼Œåˆ™ä¼šä½œä¸ºå­—ä¸²ç±»å‹è¯»å–å¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ ReadRegStr1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ¹é”® å­é”® é¡¹ ä»æ³¨å†Œè¡¨è¯»å–ä¸€ä¸ªå­—ä¸²å€¼åˆ°ç”¨æˆ·å˜é‡ $xã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å¦‚æœå­—ä¸²ä¸å­˜åœ¨æ—¶ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡å¹¶æŠŠ $x è®¾ä¸ºç©ºå­—ä¸²ã€‚å¦‚æœè¯¥å€¼å­˜åœ¨ä½†æ˜¯ DWORDï¼Œåˆ™ä¼šè½¬æ¢ä¸ºå­—ä¸²ç±»å‹å¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ WriteINIStr1INI_æ–‡ä»¶å åŒºæ®µå é¡¹å å€¼ æŠŠâ€œé¡¹åâ€&#x3D;â€œå€¼â€å†™å…¥â€œINI_æ–‡ä»¶åâ€çš„ [åŒºæ®µå] åŒºæ®µã€‚å¦‚æœ INI æ–‡ä»¶ä¸èƒ½å†™å…¥åˆ™ç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ WriteRegBin1æ ¹é”® å­é”® é¡¹ å€¼æ•°æ® è¯¥å‘½ä»¤å°†ä¼šå†™ä¸€ä¸ªåŒºå—çš„äºŒè¿›åˆ¶æ•°æ®åˆ°æ³¨å†Œè¡¨ã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å€¼æ•°æ®ä¸ºåå…­è¿›åˆ¶æ ¼å¼(å¦‚ DEADBEEF01223211151)ã€‚å¦‚æœè¯¥äºŒè¿›åˆ¶æ•°æ®ä¸èƒ½å†™å…¥æ³¨å†Œè¡¨åˆ™ç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚å¦‚æœæ³¨å†Œè¡¨é”®ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚â€œå€¼æ•°æ®â€ä¸èƒ½ä½¿ç”¨å˜é‡ã€‚ WriteRegDWORD1æ ¹é”® å­é”® é¡¹ å€¼ è¯¥å‘½ä»¤å†™ä¸€ä¸ª DWORD(32 ä½æ•´æ•°)åˆ°æ³¨å†Œè¡¨(å¯ä»¥ä½¿ç”¨å˜é‡)ã€‚æœ‰æ•ˆçš„æ ¹é”®å€¼åœ¨åé¢çš„ WriteRegStr åˆ—å‡ºã€‚å¦‚æœè¯¥ DWORD ä¸èƒ½å†™å…¥æ³¨å†Œè¡¨åˆ™ç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚å¦‚æœæ³¨å†Œè¡¨é”®ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ 4.9.2.16 WriteRegStr 1æ ¹é”® å­é”® é¡¹ å€¼ æŠŠå­—ä¸²å†™å…¥æ³¨å†Œè¡¨ã€‚è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ WriteRegExpandStrã€‚ 4.9.2.17 WriteRegExpandStr 1æ ¹é”® å­é”® é¡¹ å€¼ æŠŠå­—ä¸²å†™å…¥æ³¨å†Œè¡¨ã€‚æ ¹é”®å¿…é¡»ä¸ºä¸‹é¢åˆ—è¡¨ä¹‹ä¸€: HKCR æˆ– HKEY_CLASSES_ROOT HKLM æˆ– HKEY_LOCAL_MACHINE HKCU æˆ– HKEY_CURRENT_USER HKU æˆ– HKEY_USERS HKCC æˆ– HKEY_CURRENT_CONFIG HKDD æˆ– HKEY_DYN_DATA HKPD æˆ– HKEY_PERFORMANCE_DATA å¦‚æœå­—ä¸²ä¸èƒ½å†™å…¥æ³¨å†Œè¡¨åˆ™ç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚å­—ä¸²çš„ç±»å‹ä¸º REG_SZ å¯¹åº” WriteRegStrï¼Œæˆ– REG_EXPAND_STR å¯¹åº” WriteRegExpandStrã€‚å¦‚æœæ³¨å†Œè¡¨é”®ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ å¸¸è§„ç”¨é€”æŒ‡ä»¤CallInstDLL1DLL_æ–‡ä»¶ [/NOUNLOAD] å‡½æ•°å ä»ä¸€ä¸ª NSIS æ‰©å±•åŠ¨æ€é“¾æ¥åº“é‡Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°åã€‚çœ‹ Contrib\\ExDLL çš„æ ·æœ¬å¯ä»¥çŸ¥é“å¦‚ä½•æ¥åˆ›å»ºã€‚æ‰©å±•åŠ¨æ€é“¾æ¥åº“å¯ä»¥è®¿é—®å †æ ˆå’Œå˜é‡ã€‚ä½¿ç”¨ &#x2F;NOUNLOAD æ¥å¼ºåˆ¶å®‰è£…ç¨‹åºä¿æŒåŠ¨æ€é“¾æ¥åº“è½½å…¥ã€‚æ³¨æ„: è¦è‡ªåŠ¨é‡Šæ”¾å¹¶è°ƒç”¨ DLL æ’ä»¶è¯·ä½¿ç”¨æ’ä»¶å‘½ä»¤æ¥æ›¿æ¢ CallInstDLLã€‚ CopyFiles1[/SILENT] [/FILESONLY] ç›®æ ‡ç³»ç»Ÿæ–‡ä»¶è§„èŒƒ ç›®æ ‡è·¯å¾„ [æ–‡ä»¶å¤§å°_å•ä½ä¸º_kb] åœ¨æ­£åœ¨å®‰è£…çš„ç³»ç»Ÿä¸­æŠŠâ€œç›®æ ‡ç³»ç»Ÿæ–‡ä»¶è§„èŒƒâ€å¤åˆ¶åˆ°â€œç›®æ ‡è·¯å¾„â€ã€‚ å¦‚æœä½ æƒ³ä»å®‰è£…åª’ä½“é‡Œå¤åˆ¶ï¼Œæˆ–ä»ç³»ç»Ÿçš„ä¸€ä¸ªåœ°æ–¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ $EXEDIR å˜é‡æ¥ä»£æ›¿å®‰è£…ç¨‹åºç›®å½•ã€‚å¦‚æœå¤åˆ¶æ“ä½œéœ€è¦å¾ˆé•¿æ—¶é—´çš„è¯ä½ å¯ä»¥çœ‹åˆ° Windows çš„å¤åˆ¶æ–‡ä»¶çª—å£(è¦ç¦æ­¢å‡ºç°å¤åˆ¶æ–‡ä»¶çª—å£ä½¿ç”¨&#x2F;SILENT)ã€‚æœ€åçš„å‚æ•°ç”¨æ¥æŒ‡å®šè¦å¤åˆ¶çš„æ–‡ä»¶çš„å¤§å°(å•ä½ä¸º kb)ï¼Œä½¿å®‰è£…ç¨‹åºå¯ä»¥ä¼°è®¡æ‰€éœ€ç£ç›˜ç©ºé—´ã€‚åœ¨å‡ºé”™ï¼Œæˆ–ç”¨æˆ·é€€å‡º(ä»…å½“å¿½ç•¥äº† &#x2F;SILENT æ—¶)æ—¶ï¼Œä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;FILESONLY åˆ™ä»…å¤åˆ¶æ–‡ä»¶ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„åˆ™ä½¿ç”¨å½“å‰è·¯å¾„ä»£æ›¿ã€‚å½“å‰è·¯å¾„ä¸ºæœ€åä¸€ä¸ª SetOutPath æŒ‡å®šçš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ä»»ä½• SetOutPath æŒ‡ä»¤åˆ™å½“å‰è·¯å¾„ä¸º $EXEDIRã€‚ CreateDirectoryè¦åˆ›å»ºçš„è·¯å¾„åˆ›å»º(å¿…è¦æ—¶é€’å½’)æŒ‡å®šçš„ç›®å½•ã€‚å½“ç›®å½•ä¸èƒ½åˆ›å»ºæ—¶æ˜¯ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚ CreateShortCut1å¿«æ·æ–‡ä»¶.lnk ç›®æ ‡æ–‡ä»¶ [å‚æ•° [å›¾æ ‡æ–‡ä»¶ [å›¾æ ‡ç´¢å¼•å· [å¯åŠ¨é€‰é¡¹ [é”®ç›˜å¿«æ·é”® [æè¿°]]]]]] åˆ›å»ºä¸€ä¸ªæŒ‡å‘â€œç›®æ ‡æ–‡ä»¶â€çš„å¿«æ·æ–¹å¼â€œå¿«æ·æ–‡ä»¶.lnkâ€ï¼Œå¯ä»¥å¸¦â€œå‚æ•°â€å‚æ•°ã€‚ ç”¨äºå¿«æ·æ–¹å¼çš„å›¾æ ‡ä¸ºâ€œå›¾æ ‡æ–‡ä»¶,å›¾æ ‡ç´¢å¼•å·â€ï¼›è¦ä½¿ç”¨é»˜è®¤å›¾æ ‡çš„è¯æŠŠâ€œå›¾æ ‡æ–‡ä»¶â€å’Œâ€œå›¾æ ‡ç´¢å¼•å·â€è®¾ä¸ºç©ºå­—ä¸²ã€‚ â€œå¯åŠ¨é€‰é¡¹â€å¯ä»¥æ˜¯å®ƒä»¬ä¹‹ä¸€: SW_SHOWNORMAL, SW_SHOWMAXIMIZED, SW_SHOWMINIMIZED, æˆ–ä¸€ä¸ªç©ºå­—ä¸²ã€‚ â€œé”®ç›˜å¿«æ·é”®â€åº”è¯¥ä¸ºâ€œflag|câ€æ ¼å¼ä¸” flag å¯ä»¥è”åˆä½¿ç”¨(ä½¿ç”¨ |): ALT, CONTROL, EXT, æˆ– SHIFTã€‚c ä¸ºè¦ä½¿ç”¨çš„å­—ç¬¦(a-z, A-Z, 0-9, F1-F24 ç­‰ç­‰)ã€‚æ³¨æ„åœ¨è¿™äº›å­—ä¸²é‡Œä¸èƒ½å«æœ‰ç©ºæ ¼ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ä¸º â€œALT|CONTROL|F8â€ã€‚$OUTDIR è¢«ç”¨æ¥ä½œä¸ºå·¥ä½œç›®å½•ã€‚ä½ å¯ä»¥åœ¨åˆ›å»ºå¿«æ·æ–¹å¼ä¹‹å‰ä½¿ç”¨ SetOutPath æ¥æŒ‡å®šæˆ–æ›´æ”¹ã€‚â€œæè¿°â€ä¸ºå¿«æ·æ–¹å¼çš„æè¿°ï¼Œæˆ–åœ¨ XP ä¸‹ä½œä¸ºæ³¨é‡Šè°ƒç”¨ã€‚ å½“å¿«æ·æ–¹å¼ä¸èƒ½åˆ›å»ºçš„æ—¶å€™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡(ä¾‹å¦‚è·¯å¾„ä¸å­˜åœ¨æˆ–ä¸€äº›å…¶å®ƒé”™è¯¯)ã€‚ GetDLLVersion1æ–‡ä»¶å ç”¨æˆ·å˜é‡(é«˜ä½_DWORD_è¾“å‡º) ç”¨æˆ·å˜é‡(ä½ä½_DWORD_è¾“å‡º) ä»â€œæ–‡ä»¶åâ€ DLL(æˆ–å…¶ä»–åŒ…å«ç‰ˆæœ¬ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶)å–å¾—ç‰ˆæœ¬ä¿¡æ¯ã€‚æˆåŠŸæ—¶æŠŠç‰ˆæœ¬ä¿¡æ¯é«˜ä½ DWORD å’Œä½ä½ DWORD è®¾ä¸ºç”¨æˆ·è¾“å‡ºå˜é‡ï¼›å¤±è´¥æ—¶è¾“å‡ºä¸ºç©ºä¸”ç½®é”™è¯¯ä½æ ‡è®¡ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†è¯»å–ä¸€ä¸ª DLL ç‰ˆæœ¬å¹¶å¯è¯»çš„ç‰ˆæœ¬åˆ° $0: 123456GetDllVersion &quot;$INSTDIR\\MyDLL.dll&quot; $R0 $R1IntOp $R2 $R0 / 0x00010000IntOp $R3 $R0 &amp; 0x0000FFFFIntOp $R4 $R1 / 0x00010000IntOp $R5 $R1 &amp; 0x0000FFFFStrCpy $0 &quot;$R2.$R3.$R4.$R5&quot; GetDLLVersionLocal1å†…éƒ¨æ–‡ä»¶ ç”¨æˆ·å˜é‡(é«˜ä½_DWORD_è¾“å‡º) ç”¨æˆ·å˜é‡(ä½ä½_DWORD_è¾“å‡º) ç±»ä¼¼äº GetDLLVersionï¼Œä½†å®ƒä»…ç”¨äºè·å–å®‰è£…ç¨‹åºå†…éƒ¨æ–‡ä»¶çš„ä¿¡æ¯(å®ƒå®é™…ä¸Šç¼–è¯‘ä¸ºä¸¤ä¸ª StrCpy å‘½ä»¤)ã€‚æˆåŠŸæ—¶æŠŠå†…éƒ¨æ–‡ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯é«˜ä½ DWORD å’Œä½ä½ DWORD è®¾ä¸ºç”¨æˆ·è¾“å‡ºå˜é‡ã€‚ GetFileTime1æ–‡ä»¶å ç”¨æˆ·å˜é‡(é«˜ä½_DWORD_è¾“å‡º) ç”¨æˆ·å˜é‡(ä½ä½_DWORD_è¾“å‡º) è·å–â€œæ–‡ä»¶åâ€çš„æœ€åå†™å…¥æ—¶é—´ã€‚æˆåŠŸæ—¶æŠŠæ—¶é—´æˆ³ä¿¡æ¯é«˜ä½ DWORD å’Œä½ä½ DWORD è¾“å‡ºåˆ°ç”¨æˆ·è¾“å‡ºå˜é‡;å¤±è´¥æ—¶è¾“å‡ºä¸ºç©ºä¸”ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ GetFileTimeLocal1å†…éƒ¨æ–‡ä»¶ ç”¨æˆ·å˜é‡(é«˜ä½_DWORD_è¾“å‡º) ç”¨æˆ·å˜é‡(ä½ä½_DWORD_è¾“å‡º) ç±»ä¼¼äº GetFileTimeï¼Œä½†å®ƒä»…ç”¨äºè·å–å®‰è£…ç¨‹åºå†…éƒ¨æ–‡ä»¶çš„ä¿¡æ¯(å®ƒå®é™…ä¸Šç¼–è¯‘ä¸ºä¸¤ä¸ª StrCpy å‘½ä»¤)ã€‚ GetFullPathName1[/SHORT] ç”¨æˆ·å˜é‡(è¾“å‡º) è·¯ç»æˆ–æ–‡ä»¶ æŠŠæŒ‡å®šçš„æ–‡ä»¶å®Œæ•´è·¯å¾„ä¿¡æ¯è¾“å‡ºåˆ°ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœå‚æ•°çš„éƒ¨åˆ†è·¯å¾„æœªæ‰¾åˆ°ï¼Œåˆ™ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®°å¹¶æ¸…ç©º $xã€‚å¦‚æœæŒ‡å®šäº† &#x2F;SHORTï¼Œè·¯ç»å°†ä¼šè¢«è½¬æ¢ä¸ºçŸ­æ–‡ä»¶åæ ¼å¼ã€‚ GetTempFileName1ç”¨æˆ·å˜é‡(è¾“å‡º) [åŸºæœ¬è·¯å¾„] æŠŠä¸€ä¸ªä¸´æ—¶æ–‡ä»¶çš„åç§°è¾“å‡ºåˆ°ç”¨æˆ·å˜é‡ $xã€‚è¯¥æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ‰€ä»¥ä½ å¯ä»¥éšæ—¶çš„è¦†ç›–å®ƒã€‚è¯¥ä¸´æ—¶æ–‡ä»¶çš„åç§°å”¯ä¸€ã€‚å¦‚æœä½ å¸Œæœ›è¿™ä¸ªä¸´æ—¶æ–‡ä»¶åˆ›å»ºåœ¨å¦ä¸€ä¸ªç›®å½•è€Œä¸æ˜¯ Windows ä¸´æ—¶ç›®å½•çš„è¯æŒ‡å®šä¸€ä¸ªâ€œåŸºæœ¬è·¯å¾„â€ç»™å®ƒã€‚ä½ éœ€è¦åœ¨å®Œæˆä¹‹åæ‰‹åŠ¨åˆ é™¤å®ƒã€‚ SearchPath1ç”¨æˆ·å˜é‡(è¾“å‡º) æ–‡ä»¶å ç”±ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„æ–‡ä»¶åçš„å…¨è·¯å¾„è¾“å‡ºåˆ°ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®°å¹¶æ¸…ç©º $xã€‚ä½¿ç”¨ SearchPath() æ¥åœ¨ç³»ç»Ÿç›®å½•é‡Œæœç´¢æ–‡ä»¶ã€‚ SetFileAttributes1æ–‡ä»¶å å±æ€§ 1|å±æ€§ 2|... è®¾ç½®â€œæ–‡ä»¶åâ€çš„å±æ€§ã€‚å¤šä»å±æ€§å¯ç”¨ | éš”å¼€ï¼Œæœ‰æ•ˆçš„å±æ€§ä¸º: NORMAL æˆ– FILE_ATTRIBUTE_NORMAL (ä½ å¯ä»¥æŠŠè¯¥é¡¹ç¼©å†™ä¸º 0) ARCHIVE æˆ– FILE_ATTRIBUTE_ARCHIVE HIDDEN æˆ– FILE_ATTRIBUTE_HIDDEN OFFLINE æˆ– FILE_ATTRIBUTE_OFFLINE READONLY æˆ– FILE_ATTRIBUTE_READONLY SYSTEM æˆ– FILE_ATTRIBUTE_SYSTEM TEMPORARY æˆ– FILE_ATTRIBUTE_TEMPORARY å¦‚æœæ–‡ä»¶çš„å±æ€§ä¸èƒ½è¢«è®¾ç½®åˆ™ç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡(ä¾‹å¦‚æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…ä½ æ²¡æœ‰è¶³å¤Ÿçš„æƒé™)ã€‚ä½ åªèƒ½è¿›è¡Œå±æ€§è®¾ç½®ï¼Œè€Œä¸èƒ½ç§»é™¤å±æ€§ï¼Œå¦‚æœä½ æƒ³ç§»é™¤çš„è¯è¯·ä½¿ç”¨ NORMALã€‚è¿™æ ·æ‰€æœ‰çš„å±æ€§éƒ½ä¼šè¢«æ“¦é™¤ï¼Œè¯¥å‘½ä»¤ä¸æ”¯æŒé€šé…ç¬¦ã€‚ RegDLL1DLL_æ–‡ä»¶ [å…¥å£ç‚¹åç§°] è½½å…¥æŒ‡å®šçš„ DLL å¹¶ä¸”è°ƒç”¨ DllRegisterServer (æˆ–å…¥å£ç‚¹åç§°ï¼Œå½“æŒ‡å®šä¹‹å)ã€‚å½“äº§ç”Ÿä¸€ä¸ªé”™è¯¯çš„æ—¶å€™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡(ä¾‹å¦‚ä¸èƒ½è½½å…¥ DLLï¼Œä¸èƒ½åˆå§‹åŒ– OLEï¼Œä¸èƒ½æ‰¾åˆ°å…¥å£ç‚¹ï¼Œæˆ–è€…å‡½æ•°è¿”å›ä»»ä½•å…¶å®ƒé”™è¯¯ ERROR_SUCCESS (&#x3D;0))ã€‚ å½“æŸäº›è¦æ³¨å†Œçš„ DLL è¦ä¾é å…¶å®ƒçš„ä½äºåŒç›®å½•æˆ– Windows ç›®å½•ä¸‹çš„ DLL æ—¶è¯·ç”¨ SetOutPath æ¥è®¾å®šå½“å‰ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ foo.dll ä¾é ä½äº $INSTDIR çš„ bar.dll æ—¶: 12SetOutPath $INSTDIRRegDLL $INSTDIR\\foo.dll UnRegDLL1DLL_æ–‡ä»¶ è½½å…¥æŒ‡å®šçš„ DLL å¹¶ä¸”è°ƒç”¨ DllUnregisterServerã€‚å½“äº§ç”Ÿä¸€ä¸ªé”™è¯¯çš„æ—¶å€™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡(ä¾‹å¦‚ä¸èƒ½è½½å…¥ DLLï¼Œä¸èƒ½åˆå§‹åŒ– OLEï¼Œä¸èƒ½æ‰¾åˆ°å…¥å£ç‚¹ï¼Œæˆ–è€…å‡½æ•°è¿”å›ä»»ä½•å…¶å®ƒé”™è¯¯ ERROR_SUCCESS (&#x3D;0))ã€‚ æµç¨‹æ§åˆ¶æŒ‡ä»¤Abort1[ç”¨æˆ·ä¿¡æ¯] å–æ¶ˆå®‰è£…ï¼Œåœæ­¢æ‰§è¡Œè„šæœ¬ï¼Œå¹¶ä¸”åœ¨çŠ¶æ€æ˜¾ç¤ºé‡Œæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ã€‚æ³¨æ„: ä½ å¯ä»¥ç”¨äºå›è°ƒå‡½æ•°æ¥å®ç°ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ã€‚é¡µé¢å›è°ƒä¹Ÿå¯ä»¥ç”¨ Abort æ¥å®ç°ç‰¹æ®Šç›®çš„ã€‚ Call1å‡½æ•°å | :æ ‡è®°å è°ƒç”¨â€œå‡½æ•°åâ€å‡½æ•°ã€‚å¦‚æœåœ¨ Uninstall åŒºæ®µï¼ŒCall ä»…èƒ½è°ƒç”¨ä»¥â€œun.â€å¼€å¤´çš„å‡½æ•°åã€‚å¦‚æœå‚æ•°ä»¥ä¸€ä¸ªâ€œ:â€å¼€å§‹åˆ™å®ƒç«Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ ‡è®°(æ‰€ä»¥ä½ å¯ä»¥åœ¨ä½ çš„å‡½æ•°é‡Œè°ƒç”¨ä¸€ä¸ªæ ‡è®° - è¿™æ ·å¤§æ¦‚ä¸ä¼šä½¿ç”¨å¤ªå¤šçš„æ—¶é—´)ã€‚ ClearErrorsæ¸…é™¤é”™è¯¯ä½æ ‡è®°ã€‚ GetCurrentAddress1ç”¨æˆ·å˜é‡(è¾“å‡º) è·å–å½“å‰æŒ‡ä»¤çš„åœ°å€(GetCurrentAddress)å¹¶ä¸”æŠŠå®ƒä¿å­˜åˆ°ç”¨æˆ·è¾“å‡ºå˜é‡ã€‚è¯¥ç”¨æˆ·å˜é‡å¯ä»¥ä¼ é€’åˆ° Call æˆ– Gotoã€‚ GetFunctionAddress1ç”¨æˆ·å˜é‡(è¾“å‡º) å‡½æ•°å è·å–å‡½æ•°åœ°å€å¹¶ä¸”æŠŠå®ƒä¿å­˜åˆ°ç”¨æˆ·è¾“å‡ºå˜é‡ã€‚è¯¥ç”¨æˆ·å˜é‡å¯ä»¥ä¼ é€’åˆ° Call æˆ– Gotoã€‚æ³¨æ„å¦‚æœä½  Goto ä¸€ä¸ªç”± GetFunctionAddress è¾“å‡ºçš„åœ°å€ï¼Œä½ çš„å‡½æ•°å°†ä¸èƒ½è¿”å›(å½“ä½  Goto çš„å‡½æ•°è¦è¿”å›æ—¶ï¼Œä½ åº”è¯¥ç«‹å³è¿”å›)ã€‚ GetLabelAddress1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ‡è®° è·å–æ ‡è®°åœ°å€å¹¶ä¸”æŠŠå®ƒä¿å­˜åˆ°ç”¨æˆ·è¾“å‡ºå˜é‡ã€‚è¯¥ç”¨æˆ·å˜é‡å¯ä»¥ä¼ é€’åˆ° Call æˆ– Gotoã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä½ å¯èƒ½ä»…èƒ½ä»ä½ çš„å‡½æ•°é‡Œéšæ ‡è®°è°ƒç”¨è¯¥æŒ‡ä»¤ï¼Œä½†æ˜¯ä½ å¯ä»¥ä»ä»»ä½•åœ°æ–¹è°ƒç”¨å®ƒ(å¯èƒ½å­˜åœ¨ä¸ç¨³å®šå› ç´ )ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½ è°ƒç”¨(Call)äº† GetLabelAddress çš„è¾“å‡ºï¼Œé‚£ä¹ˆç›´åˆ°å®ƒè¿”å›æ—¶æ‰ä¼šè¢«æ‰§è¡Œ(æ˜ç¡®æˆ–éšå«åœ¨ä¸€ä¸ªå‡½æ•°çš„ç»“å°¾)ï¼Œç„¶åä½ å°†å›åˆ° Call æŒ‡ä»¤çš„çŠ¶æ€ã€‚. Goto1è¦è·³è½¬çš„æ ‡è®° | +åç§»| -åç§»| ç”¨æˆ·å˜é‡(ç›®æ ‡) å¦‚æœæŒ‡å®šäº†æ ‡è®°ï¼Œåˆ™è·³è½¬åˆ°â€œè¦è·³è½¬çš„æ ‡è®°:â€ã€‚ å¦‚æœæŒ‡å®šäº† +åç§» æˆ– -åç§» ï¼Œè·³è½¬ä¼šæ ¹æ®åç§»æŒ‡ä»¤ç›¸å¯¹çš„è·³è½¬ã€‚Goto +1 è·³è½¬åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ŒGoto -1 è·³è½¬åˆ°ä¸Šä¸€æ¡æŒ‡ä»¤ï¼Œç­‰ç­‰ã€‚ å¦‚æœæŒ‡å®šäº†ç”¨æˆ·å˜é‡ï¼Œåˆ™è·³è½¬åˆ°ç»å¯¹åœ°å€(é€šå¸¸ä½ å¯ä»¥ä»ä¸€ä¸ªå‡½æ•°æ¯”å¦‚ GetLabelAddress æ¥å–å¾—è¯¥å€¼)ã€‚ç¼–è¯‘å™¨ä½æ ‡è®¡å‘½ä»¤å’Œ SectionIn ä¸æ˜¯æŒ‡ä»¤æ‰€ä»¥è·³è½¬å¯¹å®ƒä»¬æ— æ•ˆã€‚ IfAbort1é€€å‡ºæ—¶è¦è·³è½¬çš„æ ‡è®° [ä¸æ˜¯é€€å‡ºæ—¶è¦è·³è½¬çš„æ ‡è®°] å¦‚æœè°ƒç”¨é€€å‡ºæ—¶å®ƒå°†â€œè¿”å›â€ trueã€‚è¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨å½“ä¸€ä¸ªæ–‡ä»¶ä¸èƒ½åˆ›å»º(æˆ–è¦†ç›–)å¤±è´¥è€Œç”¨æˆ·é€‰æ‹©é€€å‡ºæ—¶æˆ–è€…å½“ç”¨æˆ·æ‰‹åŠ¨é€€å‡ºæ—¶ã€‚è¯¥å‡½æ•°ä»…èƒ½åœ¨ instfiles é¡µé¢çš„ç¦»å¼€å‡½æ•°é‡Œè°ƒç”¨ã€‚ IfErrors1é”™è¯¯æ—¶è·³è½¬ [æ²¡æœ‰é”™è¯¯æ—¶è·³è½¬] æ£€æµ‹å¹¶æ¸…é™¤é”™è¯¯ä½æ ‡è®¡ï¼Œå¦‚æœè®¾äº†é”™è¯¯ä½æ ‡è®¡ï¼Œåˆ™è·³è½¬åˆ°â€œé”™è¯¯æ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œæ²¡æœ‰é”™è¯¯æ—¶è·³è½¬â€ã€‚é”™è¯¯ä½æ ‡è®¡ç”±å…¶å®ƒæŒ‡ä»¤åœ¨äº§ç”Ÿä¸€ä¸ªé”™è¯¯æ˜¯è®¾ç½®çš„(æ¯”å¦‚è¯•å›¾å»åˆ é™¤ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶)ã€‚ IfFileExists1è¦æ£€æµ‹çš„æ–‡ä»¶ æ–‡ä»¶å­˜åœ¨æ—¶è·³è½¬ [æ–‡ä»¶ä¸å­˜åœ¨æ—¶è·³è½¬] æ£€æµ‹â€œè¦æ£€æµ‹çš„æ–‡ä»¶â€æ˜¯å¦å­˜åœ¨(å¯ä»¥ç”¨é€šé…ç¬¦ï¼Œæˆ–ç›®å½•)ï¼Œå¹¶å½“æ–‡ä»¶å­˜åœ¨æ—¶è·³è½¬åˆ°â€œæ–‡ä»¶å­˜åœ¨æ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œæ–‡ä»¶ä¸å­˜åœ¨æ—¶è·³è½¬â€ã€‚å¦‚æœä½ è¦æ£€æµ‹ç›®æ ‡æ˜¯æ–‡ä»¶è¿˜æ˜¯ç›®å½•è¯·ä½¿ç”¨ IfFileExists ç›®å½•*.* IfRebootFlag1[å·²è®¾æ—¶è·³è½¬] [æœªè®¾æ—¶è·³è½¬] è‡³å°‘éœ€è¦ä¸€ä¸ªå‚æ•°ã€‚æ£€æµ‹é‡å¯ä½æ ‡è®¡ï¼Œå¦‚æœè®¾ç½®äº†é‡å¯ä½æ ‡è®¡åˆ™è·³è½¬åˆ°â€œå·²è®¾æ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œæœªè®¾æ—¶è·³è½¬â€ã€‚é‡å¯ä½æ ‡è®¡å¯ä»¥åœ¨ Delete æ²³ Renameï¼Œæˆ–æ‰‹åŠ¨è®¾å®šçš„ SetRebootFlag æŒ‡ä»¤é‡Œè®¾ç½®ã€‚ IfSilent1[é™é»˜å®‰è£…æ—¶è·³è½¬] [éé™é»˜å®‰è£…æ—¶è·³è½¬] è‡³å°‘éœ€è¦ä¸€ä¸ªå‚æ•°ã€‚æ£€æµ‹é™é»˜å®‰è£…ä½æ ‡è®¡ï¼Œå¦‚æœå®‰è£…ç¨‹åºæ˜¯é™é»˜å®‰è£…æ—¶è·³è½¬åˆ°â€œé™é»˜å®‰è£…æ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œéé™é»˜å®‰è£…æ—¶è·³è½¬â€ã€‚é™é»˜å®‰è£…ä½æ ‡è®¡å¯ä»¥ç”± SilentInstallã€SilentUninstallã€SetSilent å’Œç”¨æˆ·ä½¿ç”¨ &#x2F;S å‘½ä»¤è¡Œå¯åŠ¨æ¥è®¾ç½®ã€‚ IntCmpå€¼ 1 å€¼ 2 ç›¸ç­‰æ—¶è·³è½¬ [å€¼ 1 å°æ—¶è·³è½¬] [å€¼ 1 å¤§æ—¶è·³è½¬]æ¯”è¾ƒä¸¤ä¸ªæ•´æ•° å€¼ 1 å’Œ å€¼ 2ã€‚å¦‚æœ å€¼ 1 å’Œ å€¼ 2 ç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°â€œç›¸ç­‰æ—¶è·³è½¬â€ï¼Œå¦åˆ™å¦‚æœ å€¼ 1 &lt; å€¼ 2ï¼Œè·³è½¬åˆ°â€œå€¼ 1 å°æ—¶è·³è½¬â€ï¼Œå¦åˆ™å¦‚æœ å€¼ 1 &gt; å€¼ 2 ï¼Œè·³è½¬åˆ°â€œå€¼ 1 å¤§æ—¶è·³è½¬â€ã€‚ IntCmpU1å€¼1 å€¼2 ç›¸ç­‰æ—¶è·³è½¬ [å€¼1å°æ—¶è·³è½¬] [å€¼1å¤§æ—¶è·³è½¬] æ¯”è¾ƒä¸¤ä¸ªæ— ç¬¦å·æ•´æ•° å€¼ 1 å’Œ å€¼ 2ã€‚å¦‚æœ å€¼ 1 å’Œ å€¼ 2 ç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°â€œç›¸ç­‰æ—¶è·³è½¬â€ï¼Œå¦åˆ™å¦‚æœ å€¼ 1 &lt; å€¼ 2ï¼Œè·³è½¬åˆ°â€œå€¼ 1 å°æ—¶è·³è½¬â€ï¼Œå¦åˆ™å¦‚æœ å€¼ 1 &gt; å€¼ 2 ï¼Œè·³è½¬åˆ°â€œå€¼ 1 å¤§æ—¶è·³è½¬â€ã€‚æ¯”è¾ƒæ—¶ä½œä¸ºæ— ç¬¦å·æ•´æ•°æ¥æ¯”è¾ƒã€‚ MessageBox1æ¶ˆæ¯æ¡†é€‰é¡¹åˆ—è¡¨ æ¶ˆæ¯æ¡†æ–‡æœ¬ [/SD è¿”å›] [æ£€æµ‹è¿”å›å€¼ è·³è½¬åˆ°] [æ£€æµ‹è¿”å›å€¼ 2 è·³è½¬åˆ° 2] æ˜¾ç¤ºä¸€ä¸ªåŒ…å«â€œæ¶ˆæ¯æ¡†æ–‡æœ¬â€çš„æ¶ˆæ¯æ¡†ã€‚â€œæ¶ˆæ¯æ¡†é€‰é¡¹åˆ—è¡¨â€å¿…é¡»ä¸ºä¸‹é¢çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¤šä¸ªä½¿ç”¨ | æ¥éš”å¼€(ä¾‹å¦‚ MB_YESNO|MB_ICONSTOP)ã€‚ MB_OK - æ˜¾ç¤º OK æŒ‰é’® MB_OKCANCEL - æ˜¾ç¤º OK å’Œå–æ¶ˆæŒ‰é’® MB_ABORTRETRYIGNORE - æ˜¾ç¤ºé€€å‡ºã€é‡è¯•ã€å¿½ç•¥æŒ‰é’® MB_RETRYCANCEL - æ˜¾ç¤ºé‡è¯•å’Œå–æ¶ˆæŒ‰é’® MB_YESNO - æ˜¾ç¤ºæ˜¯å’Œå¦æŒ‰é’® MB_YESNOCANCEL - æ˜¾ç¤ºæ˜¯ã€å¦ã€å–æ¶ˆæŒ‰é’® MB_ICONEXCLAMATION - æ˜¾ç¤ºæƒŠå¹å·å›¾æ ‡ MB_ICONINFORMATION - æ˜¾ç¤ºä¿¡æ¯å›¾æ ‡ MB_ICONQUESTION - æ˜¾ç¤ºé—®å·å›¾æ ‡ MB_ICONSTOP - æ˜¾ç¤ºç»ˆæ­¢å›¾æ ‡ MB_TOPMOST - ä½¿æ¶ˆæ¯æ¡†åœ¨æœ€å‰ç«¯æ˜¾ç¤º MB_SETFOREGROUND - è®¾ç½®å‰æ™¯ MB_RIGHT - å³å¯¹é½æ–‡æœ¬ MB_DEFBUTTON1 - é»˜è®¤ä¸ºæŒ‰é’® 1 MB_DEFBUTTON2 - é»˜è®¤ä¸ºæŒ‰é’® 2 MB_DEFBUTTON3 - é»˜è®¤ä¸ºæŒ‰é’® 3 MB_DEFBUTTON4 - é»˜è®¤ä¸ºæŒ‰é’® 4 â€œæ£€æµ‹è¿”å›å€¼â€å¯ä»¥ä¸º 0(æˆ–ç©ºï¼Œæˆ–ä¿ç•™å…³é—­)ï¼Œæˆ–ä¸‹åˆ—ä¹‹ä¸€: IDABORT - é€€å‡ºæŒ‰é’® IDCANCEL - å–æ¶ˆæŒ‰é’® IDIGNORE - å¿½ç•¥æŒ‰é’® IDNO - å¦æŒ‰é’® IDOK - OK æŒ‰é’® IDRETRY - é‡è¯•æŒ‰é’® IDYES - æ˜¯æŒ‰é’® å¦‚æœæ¶ˆæ¯æ¡†çš„è¿”å›å€¼ä¸ºâ€œæ£€æµ‹è¿”å›å€¼â€ï¼Œåˆ™å®‰è£…ç¨‹åºæ‰§è¡Œè·³è½¬ã€‚ ç”¨ &#x2F;SD æ¥æŒ‡å®šä¸€ä¸ªä¸Šé¢åˆ—å‡ºçš„è¿”å›å€¼å½“åœ¨å®‰è£…ç¨‹åºé™é»˜å®‰è£…æ—¶ä½œä¸ºè¿”å›å€¼ã€‚ Returnä»ä¸€ä¸ªå‡½æ•°æˆ–åŒºæ®µè¿”å›ã€‚ Quitä½¿å¾—å®‰è£…ç¨‹åºç«‹å³é€€å‡ºã€‚åœ¨è°ƒç”¨ Quit åï¼Œå®‰è£…ç¨‹åºå°†é€€å‡º(å°†æ²¡æœ‰å›è°ƒå‡½æ•°å¯ä»¥è¿è¡Œ)ã€‚ SetErrorsè®¾ç½®é”™è¯¯ä½æ ‡è®¡ã€‚ StrCmp1å­—ä¸²1 å­—ä¸²2ç›¸åŒæ—¶è·³è½¬ [ä¸ç›¸åŒæ—¶è·³è½¬] æ¯”è¾ƒ(ä¸åŒºåˆ†å¤§å°å†™)â€œå­—ä¸² 1â€å’Œâ€œå­—ä¸² 2â€ã€‚å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè·³è½¬åˆ°â€œç›¸åŒæ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œä¸ç›¸åŒæ—¶è·³è½¬â€ã€‚ æ–‡ä»¶æŒ‡ä»¤FileCloseå¥æŸ„å…³é—­ä¸€ä¸ªç”± FileOpen æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€‚ FileOpen1ç”¨æˆ·å˜é‡(å¥æŸ„è¾“å‡º) æ–‡ä»¶å æ‰“å¼€æ¨¡å¼ æ‰“å¼€ä¸€ä¸ªâ€œæ–‡ä»¶åâ€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠå¥æŸ„è®¾ç½®ä¸ºå¥æŸ„è¾“å‡ºå˜é‡ã€‚â€œæ‰“å¼€æ¨¡å¼â€ä¸ºâ€œrâ€(åªè¯»)â€œwâ€(å†™å…¥ï¼Œæ–‡ä»¶çš„æ‰€æœ‰å†…å®¹å°†è¢«æ¸…ç©º)æˆ–â€œaâ€(é™„åŠ ï¼Œä¿æŒæ–‡ä»¶å†…å®¹å¹¶å†™å…¥)å…¶ä¸­ä¹‹ä¸€ã€‚åœ¨æ‰€æœ‰çš„æ‰“å¼€æ¨¡å¼é‡Œï¼Œæ–‡ä»¶æŒ‡é’ˆéƒ½ç½®äºæ–‡ä»¶èµ·å§‹ä½ç½®ã€‚å¦‚æœæ–‡ä»¶ä¸èƒ½è¢«æ‰“å¼€ï¼Œåˆ™å¥æŸ„è¾“å‡ºå˜é‡ä¸ºç©ºï¼Œå¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šç»å¯¹è·¯å¾„åˆ™ä½¿ç”¨å½“å‰è·¯å¾„ã€‚å½“å‰è·¯å¾„ç”± SetOutPath è®¾ç½®ã€‚å¦‚æœä¹‹å‰æ²¡æœ‰ä½¿ç”¨ SetOutPath åˆ™å½“å‰è·¯å¾„ä¸º $EXEDIRã€‚ FileRead1å¥æŸ„ ç”¨æˆ·å˜é‡(è¾“å‡º) [æœ€å¤§é•¿åº¦] è¯»å–ä¸€ä¸ªç”± FileOpen æ‰“å¼€çš„æ–‡ä»¶çš„å­—ä¸²ã€‚è¯¥å­—ä¸²ä¸€ç›´è¯»å–åˆ°æ–°çš„ä¸€è¡Œä¸ºæ­¢(æˆ–å›è½¦æ–°è¡Œ)ã€‚æˆ–ç›´åˆ°è¯»å–åˆ°ç©ºçš„å­—èŠ‚ä¸ºæ­¢ï¼Œæˆ–è€…ç›´åˆ°è¯»å–çš„å­—ä¸²æ»¡è¶³äº†â€œæœ€å¤§é•¿åº¦â€(å¦‚æœæŒ‡å®šäº†çš„è¯)ã€‚å­—ä¸²çš„æœ€å¤§é•¿åº¦è¢«é™å®šåœ¨ 1024 å­—èŠ‚ä¹‹å†…ã€‚å¦‚æœè¯»å–åˆ°äº†æ–‡ä»¶çš„ç»“å°¾å´æ²¡æœ‰æœ‰æ•ˆçš„æ•°æ®åˆ™è¾“å‡ºå­—ä¸²è¢«æ¸…ç©ºï¼Œå¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ FileReadByte1å¥æŸ„ ç”¨æˆ·å˜é‡(è¾“å‡º) è¯»å–ä¸€ä¸ªç”± FileOpen æ‰“å¼€çš„æ–‡ä»¶çš„å­—èŠ‚ã€‚è¯»å–çš„å­—èŠ‚ä½œä¸ºä¸€ä¸ªæ•´æ•°(0-255)ä¿å­˜åœ¨è¾“å‡ºå˜é‡é‡Œã€‚å¦‚æœè¯»å–åˆ°äº†æ–‡ä»¶çš„ç»“å°¾å´æ²¡æœ‰æœ‰æ•ˆçš„æ•°æ®åˆ™è¾“å‡ºå­—ä¸²è¢«æ¸…ç©ºï¼Œå¹¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ FileSeek1å¥æŸ„ åç§» [æ¨¡å¼] [ç”¨æˆ·å˜é‡(æ–°ä½ç½®)] å®šä½ä¸€ä¸ªç”± FileOpen æ‰“å¼€çš„æ–‡ä»¶ã€‚ å¦‚æœâ€œæ¨¡å¼â€å¿½ç•¥æˆ–æŒ‡å®šä¸ºâ€œSETâ€ï¼Œåˆ™æ–‡ä»¶æŒ‡é’ˆå®šä½åˆ°â€œåç§»â€ã€‚ å¦‚æœâ€œæ¨¡å¼â€æŒ‡å®šä¸ºâ€œCURâ€ï¼Œåˆ™æ–‡ä»¶æŒ‡é’ˆå‘åç§»åŠ¨â€œåç§»â€ã€‚ å¦‚æœæ–‡ä»¶æŒ‡å®šä¸ºâ€œENDâ€ï¼Œåˆ™æŒ‡é’ˆå®šä½åˆ°ç›¸å¯¹äºæ–‡ä»¶ç»“å°¾ EOF(End of file)å¤„ã€‚ å¦‚æœæŒ‡å®šäº†æœ€åä¸€ä¸ªå‚æ•°â€œç”¨æˆ·å˜é‡(æ–°ä½ç½®)â€ï¼Œåˆ™æ–°æ–‡ä»¶ä½ç½®å°†ä¿å­˜åœ¨è¯¥å˜é‡ä¸­ã€‚ FileWrite1å¥æŸ„ å­—ä¸² å†™å…¥ä¸€ä¸ªå­—ä¸²åˆ° FileOpen æ‰“å¼€çš„æ–‡ä»¶ã€‚å¦‚æœå†™å…¥æ—¶äº§ç”Ÿäº†é”™è¯¯ï¼Œåˆ™ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ FileWriteByte1å¥æŸ„ å­—ä¸² å†™å…¥â€œå­—ä¸²â€è§£é‡Šä¸ºæ•´æ•°çš„å€¼åˆ° FileOpen æ‰“å¼€çš„æ–‡ä»¶ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥æ•´æ•°å€¼ã€‚ä¸‹é¢çš„ä»£ç å†™å…¥ä¸€ä¸ªâ€œå›è½¦&#x2F;æ¢è¡Œâ€ - è¾“å…¥åˆ°æ–‡ä»¶ã€‚ 12FileWriteByte æ–‡ä»¶å¥æŸ„ &quot;13&quot;FileWriteByte æ–‡ä»¶å¥æŸ„ &quot;10&quot; å¦‚æœå†™å…¥æ—¶äº§ç”Ÿäº†é”™è¯¯ï¼Œåˆ™ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ•´æ•°ä»…ä½å­—èŠ‚è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚: å†™å…¥ 256 å’Œå†™å…¥ 0 ä¸€æ ·ï¼Œç­‰ç­‰ã€‚ FindClose1å¥æŸ„ å…³é—­ä¸€ä¸ªç”± FindFirst æ‰“å¼€çš„æœç´¢ã€‚ FindFirst1ç”¨æˆ·å˜é‡(å¥æŸ„è¾“å‡º) ç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º) æ–‡ä»¶åŒ¹é…æ ¼å¼ æŒ‰â€œæ–‡ä»¶åŒ¹é…æ ¼å¼â€æ‰§è¡Œä¸€ä¸ªæœç´¢ï¼ŒæŠŠç¬¬ä¸€ä¸ªæŸ¥æ‰¾åˆ°çš„æ–‡ä»¶æ”¾ç½®åˆ°â€œç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º)â€ã€‚ä¹Ÿå¯ä»¥æŠŠæœç´¢çš„å¥æŸ„æ”¾åˆ°â€œç”¨æˆ·å˜é‡(å¥æŸ„è¾“å‡º)â€ã€‚å¦‚æœæœªæ‰¾åˆ°ä»»ä½•æ–‡ä»¶ï¼Œåˆ™è¾“å‡ºéƒ½è¢«è®¾ä¸ºç©ºï¼Œå¹¶ä¸”ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚æ¯”è¾ƒå¥½çš„ç”¨æ³•æ˜¯ä½¿ç”¨ FindNext å’Œ FindCloseã€‚éœ€è¦æ³¨æ„çš„æ˜¯â€œç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º)â€ä¸å¸¦æœ‰è·¯å¾„ã€‚ FindNext1å¥æŸ„ ç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º) ç»§ç»­ä¸€ä¸ªç”± FindFirst å¼€å§‹çš„æœç´¢ã€‚å¥æŸ„åº”è¯¥ä¸º FindFirst è¿”å›çš„å€¼ã€‚å¦‚æœæœç´¢å·²å®Œæˆ(æ²¡æœ‰æ›´å¤šæ–‡ä»¶)ï¼Œâ€œç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º)â€å°†è¢«è®¾ä¸ºç©ºï¼Œå¹¶ä¸”ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯â€œç”¨æˆ·å˜é‡(æ–‡ä»¶è¾“å‡º)â€ä¸å¸¦æœ‰è·¯å¾„ã€‚ å¸è½½ç¨‹åºæŒ‡ä»¤WriteUninstaller1[è·¯å¾„\\]å¯æ‰§è¡Œæ–‡ä»¶å.exe ç”±æŒ‡å®šçš„æ–‡ä»¶å(è·¯å¾„ä¸ºå¯é€‰é¡¹)å†™å…¥å¸è½½ç¨‹åºã€‚ä»…åœ¨ä¸€ä¸ªå®‰è£…åŒºæ®µæˆ–å‡½æ•°é‡Œæœ‰æ•ˆï¼Œå¹¶ä¸”ä½ çš„è„šæœ¬é‡Œå¿…é¡»æœ‰ä¸€ä¸ªå¸è½½åŒºæ®µã€‚ä¹Ÿå¯ä»¥å‚è€ƒå¸è½½é…ç½®ã€‚ä½ å¯ä»¥è°ƒç”¨ä¸€æ¬¡æˆ–å¤šæ¬¡æ¥å†™å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå¸è½½ç¨‹åº(å‰¯æœ¬)ã€‚ æ··åˆæŒ‡ä»¤GetInstDirError1ç”¨æˆ·å˜é‡(é”™è¯¯è¾“å‡º) ç”¨äºç›®å½•é€‰æ‹©é¡µé¢çš„ç¦»å¼€å‡½æ•°ã€‚è¯»å–ä½æ ‡è®¡è®¾ç½®çœ‹â€œDirVerify leaveâ€æ˜¯å¦å·²ä½¿ç”¨ã€‚å¯èƒ½çš„å€¼: 0: æ— é”™è¯¯ 1: æ— æ•ˆçš„å®‰è£…ç›®å½• 2: ç›®æ ‡é©±åŠ¨å™¨æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ InitPluginsDiråˆå§‹åŒ–æ’ä»¶ç›®å½•($PLUGINSDIR)ï¼Œå½“ä¹‹å‰æ²¡æœ‰åˆå§‹åŒ–æ—¶ã€‚ SetShellVarContextcurrent|all è®¾ç½® $SMPROGRAMS çš„å†…å®¹æˆ–å…¶ä»–å‘½ä»¤è§£é‡Šç¨‹åºç›®å½•ã€‚å¦‚æœè®¾ä¸ºâ€œcurrentâ€(é»˜è®¤å€¼)ï¼Œåˆ™ä½¿ç”¨å½“å‰ç”¨æˆ·çš„å‘½ä»¤è§£é‡Šç¨‹åºç›®å½•ã€‚å¦‚æœè®¾ä¸ºâ€œallâ€ï¼Œåˆ™ä½¿ç”¨æ‰€æœ‰ç”¨æˆ·çš„å‘½ä»¤è§£é‡Šç¨‹åºç›®å½•ã€‚æ‰€æœ‰ç”¨æˆ·ç›®å½•å¯èƒ½ä¸èƒ½è¢«æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿæ”¯æŒã€‚å¦‚æœæ‰€æœ‰ç”¨æˆ·çš„ç›®å½•æ‰¾ä¸åˆ°åˆ™ä½¿ç”¨å½“å‰ç”¨æˆ·ä»£æ›¿ã€‚è¯·è€ƒè™‘ä¸€ä¸ªæ™®é€šç”¨æˆ·æˆ–æ¸¸å®¢æ˜¯å¦æœ‰æ­£ç¡®çš„æƒé™åœ¨æ‰€æœ‰ç”¨æˆ·ç›®å½•é‡Œæ“ä½œã€‚ä»…ä»…ç®¡ç†å‘˜æ‰æœ‰å®Œå…¨çš„æƒé™è®¿é—®æ‰€æœ‰ç”¨æˆ·ç›®å½•ã€‚ä½ å¯ä»¥ç”¨ UserInfo æ¥æŸ¥çœ‹ç”¨æˆ·èº«ä»½ã€‚è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ Contrib\\UserInfo\\UserInfo.nsi æ ·ä¾‹ã€‚ Sleepä¼‘çœ æ—¶é—´å•ä½ä¸ºæ¯«ç§’åœ¨å®‰è£…ç¨‹åºé‡Œæš‚åœæ‰§è¡Œâ€œä¼‘çœ æ—¶é—´å•ä½ä¸ºæ¯«ç§’â€æ—¶é—´ã€‚â€œä¼‘çœ æ—¶é—´å•ä½ä¸ºæ¯«ç§’â€å¯ä»¥æ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¾‹å¦‚ â€œ$0â€æˆ–ä¸€ä¸ªæ•°å­—ï¼Œæ¯”å¦‚ â€œ666â€ã€‚ å­—ä¸²æ“ä½œæŒ‡ä»¤StrCpy1ç”¨æˆ·å˜é‡(ç›®æ ‡) å­—ä¸² [æœ€å¤§é•¿åº¦] [èµ·å§‹åç§»] æŠŠç”¨æˆ·å˜é‡ $x è®¾ä¸ºâ€œå­—ä¸²â€ã€‚æ³¨æ„â€œå­—ä¸²â€å¯ä»¥åŒ…å«å¦ä¸€ä¸ªå˜é‡ï¼Œæˆ–è¯¥ç”¨æˆ·å˜é‡ä¼šè¢«è®¾ç½®(å¯ä»¥ç”¨æ¥è¿æ¥å­—ä¸²ç­‰ç­‰)ã€‚å¦‚æœæŒ‡å®šäº†â€œæœ€å¤§é•¿åº¦â€åˆ™ç›®æ ‡å­—ä¸²çš„é•¿åº¦ä¸ºâ€œæœ€å¤§é•¿åº¦â€(å¦‚æœâ€œæœ€å¤§é•¿åº¦â€æ˜¯è´Ÿæ•°ï¼Œåˆ™ä¼šä»å­—ä¸²å°¾éƒ¨æˆªå»â€œæœ€å¤§é•¿åº¦â€çš„ç»å¯¹å€¼ä¸ªå­—ç¬¦)ã€‚å¦‚æœæŒ‡å®šäº†èµ·å§‹åç§»ï¼Œåˆ™å­—ä¸²åç§»åˆ°è¯¥å¤„ä½œä¸ºèµ·å§‹(å¦‚æœâ€œèµ·å§‹åç§»â€æ˜¯è´Ÿæ•°ï¼Œåˆ™ä¼šä»å°¾éƒ¨å¼€å§‹åç§»)ã€‚ StrLen1ç”¨æˆ·å˜é‡(é•¿åº¦è¾“å‡º) å­—ä¸² æŠŠç”¨æˆ·å˜é‡ $x è®¾ä¸ºâ€œå­—ä¸²â€çš„é•¿åº¦å€¼ã€‚ å †æ ˆæ”¯æŒExch1[ç”¨æˆ·å˜é‡ | å †æ ˆç´¢å¼•] å½“ä¸æŒ‡å®šå‚æ•°æ—¶ï¼Œäº¤æ¢å †æ ˆé¡¶éƒ¨çš„ä¸¤ä¸ªå•å…ƒã€‚å½“æŒ‡å®šäº†ä¸€ä¸ªå‚æ•°å¹¶ä¸”æ˜¯ä¸€ä¸ªç”¨æˆ·å˜é‡æ—¶ï¼Œäº¤æ¢å †æ ˆé¡¶éƒ¨çš„å•å…ƒå’Œè¯¥å‚æ•°ã€‚å½“æŒ‡å®šäº†ä¸€ä¸ªå‚æ•°å¹¶ä¸”æ˜¯æ­£æ•´æ•°æ—¶ï¼ŒExch å°†ä¼šäº¤æ¢å †æ ˆé¡¶éƒ¨é‚£é¡¹å’Œæ ¹æ®å‚æ•°ä»å †æ ˆé¡¶éƒ¨åç§»åˆ°æŒ‡å®šçš„é‚£é¡¹ã€‚å¦‚æœå †æ ˆé‡Œæ²¡æœ‰è¶³å¤Ÿçš„é¡¹æ¥å®Œæˆäº¤æ¢æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½çš„é”™è¯¯(æ¥å¸®åŠ©ä½ è°ƒè¯•ä½ çš„ä»£ç )ã€‚ Pop1ç”¨æˆ·å˜é‡(è¾“å‡º) ä»å †æ ˆé‡Œå¼¹å‡ºä¸€ä¸ªå­—ä¸²åˆ°ç”¨æˆ·å˜é‡ $xã€‚å¦‚æœå †æ ˆæ˜¯ç©ºçš„ï¼Œåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ Push1å­—ä¸² æŠŠä¸€ä¸ªå­—ä¸²å‹å…¥å †æ ˆã€‚è¯¥å­—ä¸²å¯éšåä»å †æ ˆé‡Œå¼¹å‡ºã€‚ æ•´æ•°æ”¯æŒIntFmt1ç”¨æˆ·å˜é‡(è¾“å‡º) æ ¼å¼ æ•°å­—å­—ä¸² ç”¨â€œæ ¼å¼â€æ ¼å¼æ ¼å¼åŒ–â€œæ•°å­—å­—ä¸²â€ä¸­çš„æ•°å­—ï¼Œå¹¶æŠŠè¾“å‡ºè®¾ä¸ºç”¨æˆ·å˜é‡ $xã€‚ä¾‹å¦‚æ ¼å¼åŒ–å­—ä¸²åŒ…å« â€œ%08Xâ€ â€œ%uâ€ IntOp1ç”¨æˆ·å˜é‡(è¾“å‡º) å€¼1 æ“ä½œ [å€¼2] è”åˆå€¼ 1 å’Œ(å–å†³äºæ“ä½œ)å€¼ 2 åˆ°ç”¨æˆ·å˜é‡ $xã€‚æ“ä½œå®šä¹‰ä¸ºä¸‹åˆ—ä¹‹ä¸€: + å€¼ 1 åŠ  å€¼ 2 - å€¼ 1 å‡ å€¼ 2 *å€¼ 1 ä¹˜ å€¼ 2 / å€¼ 1 é™¤ å€¼ 2 % ç”± å€¼ 2 å– å€¼ 1 çš„æ¨¡ | å€¼ 1 å’Œ å€¼ 2 äºŒè¿›åˆ¶â€œæˆ–â€ &amp; å€¼ 1 å’Œ å€¼ 2 äºŒè¿›åˆ¶â€œä¸â€ ^ å€¼ 1 å’Œ å€¼ 2 äºŒè¿›åˆ¶â€œå¼‚æˆ–â€ ~ æŒ‰ä½å–å å€¼ 1(ä¾‹å¦‚ 7 å˜ä¸º 4294917288) ! é€»è¾‘å–å å€¼ 1(ä¾‹å¦‚ 7 å˜ä¸º 0) || å€¼ 1 å’Œ å€¼ 2 é€»è¾‘â€œæˆ–â€ &amp;&amp; å€¼ 1 å’Œ å€¼ 2 é€»è¾‘â€œä¸â€ é‡å¯æŒ‡ä»¤Rebooté‡å¯ç”µè„‘ã€‚è¯·å°å¿ƒä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚å¦‚æœé‡å¯æ—¶äº§ç”Ÿäº†é”™è¯¯ï¼Œè¯¥å‡½æ•°ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡å¹¶ç»§ç»­ã€‚å¦‚æœé‡å¯æˆåŠŸï¼Œè¯¥æŒ‡ä»¤ä¸è¿”å›ä»»ä½•å€¼ã€‚ SetRebootFlagtrue|falseè®¾ç½®é‡å¯ä½æ ‡è®¡ä¸ºâ€œtrueâ€æˆ–â€œfalseâ€ã€‚ å®‰è£…è®°å½•æŒ‡ä»¤LogSeton|offè®¾ç½®å®‰è£…è®°å½•åˆ° $INSTDIR\\install.log å°†ä¼šå‘ç”Ÿã€‚ åœ¨ä½ è°ƒç”¨è¯¥å‡½æ•°ä¹‹å‰ï¼Œ $INSTDIR å¿…é¡»æœ‰ä¸€ä¸ªå€¼ï¼Œå¦åˆ™è¯¥æŒ‡ä»¤å°†æ— æ•ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ç¼–è¯‘é…ç½®æ–‡ä»¶(config.h)å¿…é¡»è®¾ç½® NSIS_CONFIG_LOG (é»˜è®¤æœªè®¾ç½®)æ¥æ”¯æŒè¯¥æŒ‡ä»¤ã€‚å…³äºé‡æ–°ç¼–è¯‘ NSIS çš„è¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ ç¼–è¯‘ NSIS æºä»£ç ã€‚ LogTextæ–‡æœ¬å¦‚æœå¯ç”¨äº†å®‰è£…ç¨‹åºè®°å½•ï¼Œæ’å…¥â€œæ–‡æœ¬â€æ–‡æœ¬åˆ°è®°å½•æ–‡ä»¶ã€‚ åŒºæ®µç®¡ç†SectionSetFlags1åŒºæ®µç´¢å¼• åŒºæ®µä½æ ‡è®¡ è®¾ç½®åŒºæ®µä½æ ‡è®¡ã€‚ä½æ ‡è®¡ä¸º 32 ä½æ•´æ•°ã€‚ç¬¬ä¸€ä½(ä½ä½)ä»£è¡¨è¯¥åŒºæ®µå½“å‰æ˜¯å¦é€‰ä¸­ï¼Œç¬¬äºŒä½ä»£è¡¨è¯¥åŒºæ®µæ˜¯å¦æ˜¯ä¸€ä¸ªå­åŒºæ®µ(è¯·ä¸è¦ä¿®æ”¹è¿™é‡Œé™¤éä½ çœŸçš„å¾ˆäº†è§£)ï¼Œç¬¬ä¸‰ä½ä»£è¡¨è¯¥åŒºæ®µæ˜¯å¦æ˜¯ä¸€ä¸ªå­åŒºæ®µçš„ç»“å°¾(åŒæ ·ï¼Œè¯·ä¸è¦ä¿®æ”¹)ï¼Œç¬¬å››ä½ä»£è¡¨è¯¥åŒºæ®µæ–‡å­—æ˜¯å¦æé»‘æ˜¾ç¤ºï¼Œç¬¬äº”ä½ä»£è¡¨è¯¥åŒºæ®µæ˜¯å¦æ˜¯åªè¯»ï¼Œç¬¬å…­ä½ä»£è¡¨å­åŒºæ®µæ˜¯å¦è‡ªåŠ¨å±•å¼€ã€‚å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionGetFlags1åŒºæ®µç´¢å¼• ç”¨æˆ·å˜é‡(è¾“å‡º) æ‰¾å›è¯¥åŒºæ®µçš„ä½æ ‡è®¡ã€‚ä½æ ‡è®¡çš„æè¿°è¯·çœ‹ä¸Šé¢ã€‚å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionSetText1åŒºæ®µç´¢å¼• åŒºæ®µæ–‡æœ¬ è®¾ç½®â€œåŒºæ®µç´¢å¼•â€åŒºæ®µçš„æè¿°ã€‚è¦è®¾ç½®ä¸€ä¸ªå­åŒºæ®µçš„æ–‡æœ¬ï¼Œä½ å¿…é¡»åœ¨æ–‡æœ¬å‰åŠ  -ã€‚å¦‚æœæ–‡æœ¬è®¾ä¸º â€œâ€åˆ™è¯¥åŒºæ®µå°†ä¼šéšè—ã€‚å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionGetText1åŒºæ®µç´¢å¼• åŒºæ®µæ–‡æœ¬ æŠŠâ€œåŒºæ®µç´¢å¼•â€åŒºæ®µçš„æè¿°ä¿å­˜åœ¨è¾“å‡ºå˜é‡ã€‚å¦‚æœåŒºæ®µä¸ºéšè—ï¼Œåˆ™ä¿å­˜çš„å˜é‡ä¸ºç©ºã€‚å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionSetInstTypes1åŒºæ®µç´¢å¼• å®‰è£…ç±»å‹ è®¾ç½®â€œåŒºæ®µç´¢å¼•â€åŒºæ®µåœ¨å®‰è£…ç±»å‹ä¸­çš„é»˜è®¤å¯ç”¨çŠ¶æ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åŒºæ®µç´¢å¼•ä»é›¶å¼€å§‹ã€‚â€œå®‰è£…ç±»å‹â€çš„æ¯ä¸€ä½éƒ½æ˜¯ä¸€ä¸ªå‘Šè¯‰è¯¥åŒºæ®µæ˜¯å¦å±äºè¿™ä¸ªå®‰è£…ç±»å‹çš„ä½æ ‡è®¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ 3 ä¸ªå®‰è£…ç±»å‹å¹¶ä¸”ä½ å¸Œæœ›ç¬¬ä¸€ä¸ªåŒºæ®µåŒ…å«åœ¨ç±»å‹ 1 å’Œ 3ï¼Œåˆ™å‘½ä»¤å¦‚ä¸‹: 1SectionSetInstTypes 0 5 å› ä¸º 5 çš„äºŒè¿›åˆ¶å€¼ä¸º â€œ00000101â€ã€‚ å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionGetInstTypes1åŒºæ®µç´¢å¼• ç”¨æˆ·å˜é‡(è¾“å‡º) æ‰¾å›ä¸€ä¸ªåŒºæ®µçš„å®‰è£…ç±»å‹ä½æ ‡è®¡ã€‚å¦‚æœå¤„ç†è¾“å‡ºçš„æè¿°è¯·çœ‹ä¸Šé¢çš„å…³äº SectionSetInstTypes çš„è§£é‡Šã€‚å¦‚æœæŒ‡å®šäº†è¶…å‡ºèŒƒå›´çš„åŒºæ®µåˆ™ä¼šç½®ä¸€ä¸ªé”™è¯¯çš„ä½æ ‡è®¡ã€‚ SectionSetSizeåŒºæ®µç´¢å¼• æ–°å®¹é‡è®¾ç½®â€œåŒºæ®µç´¢å¼•â€åŒºæ®µçš„å®¹é‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ç´¢å¼•ä»é›¶å¼€å§‹ã€‚å®¹é‡çš„å•ä½ä¸º KB ä¸”ä»…æ”¯æŒæ•´æ•°ã€‚ SectionGetSizeåŒºæ®µç´¢å¼• ç”¨æˆ·å˜é‡è·å¾—â€œåŒºæ®µç´¢å¼•â€åŒºæ®µçš„å®¹é‡å¹¶æŠŠå€¼ä¿å­˜åœ¨æŒ‡å®šçš„ç”¨æˆ·å˜é‡é‡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ç´¢å¼•ä»é›¶å¼€å§‹ã€‚ SetCurInstTypeå®‰è£…ç±»å‹ç´¢å¼•è®¾ç½®å½“å‰å®‰è£…ç±»å‹ã€‚å¦‚æœä½¿ç”¨äº†ä¸€ä¸ªè¶…å‡ºèŒƒå›´çš„å®‰è£…ç±»å‹åˆ™ä¸ä¼šç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ã€‚ SetCurInstType ä»…åœ¨å½“å‰å­˜åœ¨ç»„ä»¶é€‰æ‹©é¡µé¢æ—¶æ‰æœ‰æ•ˆã€‚ GetCurInstTypeç”¨æˆ·å˜é‡è·å–å½“å‰çš„å®‰è£…ç±»å‹å¹¶ä¿å­˜åœ¨æŒ‡å®šçš„ç”¨æˆ·å˜é‡é‡Œã€‚${NSIS_MAX_INST_TYPES} (é»˜è®¤ä¸º 32)çš„å€¼æ„å‘³ç€é€‰æ‹©äº†è‡ªå®šä¹‰å®‰è£…ç±»å‹ã€‚ InstTypeSetText1å®‰è£…ç±»å‹ç´¢å¼• æ–‡æœ¬ è®¾ç½®æŒ‡å®šçš„å®‰è£…ç±»å‹çš„æ–‡æœ¬ã€‚å¦‚æœè®¾ç½®çš„æ–‡æœ¬ä¸ºç©ºåˆ™ç§»é™¤è¯¥å®‰è£…ç±»å‹ã€‚é€šè¿‡ä½¿ç”¨ä¸€ä¸ªä»¥å‰æœªä½¿ç”¨çš„â€œå®‰è£…ç±»å‹ç´¢å¼•â€åºå·ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®‰è£…ç±»å‹ã€‚è¦åœ¨æ–°çš„å®‰è£…ç±»å‹é‡Œæ·»åŠ ã€åˆ é™¤åŒºæ®µè¯·çœ‹ SectionSetInstTypesã€‚ä¸ SectionIn ä¸åŒçš„æ˜¯è¯¥ç´¢å¼•ä»é›¶å¼€å§‹ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªå®‰è£…ç±»å‹ç´¢å¼•ä¸º 0ã€‚ InstTypeGetText1å®‰è£…ç±»å‹ç´¢å¼• ç”¨æˆ·å˜é‡ è·å–æŒ‡å®šçš„å®‰è£…ç±»å‹çš„æ–‡æœ¬ã€‚ ç”¨æˆ·ç•Œé¢æŒ‡ä»¤BringToFrontä½¿å®‰è£…ç¨‹åºçª—å£å¯è§å¹¶æŠŠå®ƒå¸¦åˆ°å…¶ä»–çª—å£çš„æœ€å‰ç«¯ã€‚å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºå·²ç»æ‰§è¡Œä¸”æ˜¾ç¤ºåœ¨å®‰è£…ç¨‹åºçš„å‰é¢ï¼ŒBringToFront å°†æŠŠå®‰è£…ç¨‹åºå¸¦å›åˆ°ç„¦ç‚¹ã€‚ CreateFont1ç”¨æˆ·å˜é‡(å¥æŸ„è¾“å‡º) å­—ä½“å [é«˜] [å®½] [/ITALIC] [/UNDERLINE] [/STRIKE] åˆ›å»ºä¸€ä¸ªå­—ä½“å¹¶æŠŠå¥æŸ„ä¿å­˜åœ¨ç”¨æˆ·å˜é‡é‡Œã€‚å…³äºä¸åŒå‚æ•°çš„æ›´å¤šä¿¡æ¯è¯·çœ‹ MSDN é¡µé¢å…³äº Win32 API å‡½æ•° CreateFont()ã€‚ DetailPrintç”¨æˆ·ä¿¡æ¯æ·»åŠ â€œç”¨æˆ·ä¿¡æ¯â€å­—ä¸²åˆ°å®‰è£…ç¨‹åºçš„å®‰è£…ä¿¡æ¯æŸ¥çœ‹çª—å£ã€‚ EnableWindow1çª—å£å¥æŸ„(HWND) (1|0) å¯¹æŒ‡å®šçš„çª—å£æˆ–æ§ä»¶å…è®¸æˆ–ç¦æ­¢é¼ æ ‡å’Œé”®ç›˜è¾“å…¥ã€‚å¯ç”¨çš„çŠ¶æ€ä¸º 0(ç¦æ­¢) æˆ– 1(å…è®¸)ã€‚ FindWindow1ç”¨æˆ·å˜é‡(çª—å£å¥æŸ„è¾“å‡º) çª—å£ç±» [çª—å£æ ‡é¢˜] [windowparent] [childafter] æŸ¥æ‰¾ä¸€ä¸ªçª—å£ã€‚ç±»ä¼¼äº Win32 FindWindowEx()ã€‚ç”±çª—å£ç±»æ¥æŸ¥æ‰¾(å’Œ&#x2F;æˆ–çª—å£æ ‡é¢˜ï¼Œå¦‚æœæŒ‡å®šçš„è¯)ã€‚å¦‚æœæŒ‡å®šäº† windowparent æˆ– childafterï¼Œåˆ™æŸ¥æ‰¾ä¼šå—åˆ°é™åˆ¶ã€‚å¦‚æœçª—å£ç±»æˆ–çª—å£æ ‡é¢˜æŒ‡å®šä¸º â€œâ€ï¼Œåˆ™å®ƒä»¬å°†ä¸èƒ½ç”¨äºæŸ¥æ‰¾ã€‚å¦‚æœçª—å£æœªæ‰¾åˆ°ï¼Œç”¨æˆ·å˜é‡å°†è¿”å› 0 å€¼ã€‚è¦å®ç°æ—§å¼ FindWindow è¡Œä¸ºï¼Œè¯·å’Œ SendMessage ä¸€èµ·ä½¿ç”¨ã€‚ GetDlgItem1ç”¨æˆ·å˜é‡(è¾“å‡º) çª—å£å¥æŸ„ æ§ä»¶ID åœ¨æŒ‡å®šçš„å¯¹è¯æ¡†ä¸Šæ ¹æ®æ§ä»¶ ID è·å¾—æ§ä»¶å¥æŸ„ã€‚å¦‚æœä½ æƒ³è·å¾—å®‰è£…ç¨‹åºå†…éƒ¨çš„æ§ä»¶å¥æŸ„ï¼Œè¯·å…ˆä½¿ç”¨ FindWindow ç”¨æˆ·å˜é‡(çª—å£å¥æŸ„è¾“å‡º) &quot;#32770&quot; &quot;&quot; $HWNDPARENT æ¥è·å–çª—å£å¥æŸ„ã€‚ HideWindowéšè—å®‰è£…ç¨‹åºã€‚ IsWindow1çª—å£å¥æŸ„ æ˜¯çª—å£æ—¶è·³è½¬ [ä¸æ˜¯çª—å£æ—¶è·³è½¬] å¦‚æœâ€œçª—å£å¥æŸ„â€æ˜¯ä¸€ä¸ªçª—å£ï¼Œåˆ™è·³è½¬åˆ°â€œæ˜¯çª—å£æ—¶è·³è½¬â€ï¼Œå¦åˆ™è·³è½¬åˆ°â€œä¸æ˜¯çª—å£æ—¶è·³è½¬â€(å¦‚æœæŒ‡å®šäº†çš„è¯)ã€‚ SendMessage1çª—å£å¥æŸ„ æ¶ˆæ¯ ç¬¬ä¸€ä¸ªæ¶ˆæ¯å‚æ•° ç¬¬äºŒä¸ªæ¶ˆæ¯å‚æ•° [ç”¨æˆ·å˜é‡(è¿”å›å€¼)] [/TIMEOUT=æ¯«ç§’] å‘é€æ¶ˆæ¯åˆ°â€œçª—å£å¥æŸ„â€ã€‚å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªç”¨æˆ·å˜é‡ $x ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°(æˆ–åœ¨ &#x2F;TIMEOUT ä¹‹å‰çš„æœ€åä¸€ä¸ªå‚æ•°)ï¼ŒSendMessage çš„è¿”å›å€¼å°†ä¿å­˜åœ¨è¯¥å˜é‡é‡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“æŒ‡å®šâ€œæ¶ˆæ¯â€æ—¶ä½ åªèƒ½ç”¨æ¶ˆæ¯çš„æ•´æ•°å€¼ã€‚å¦‚æœä½ éœ€è¦å‘é€å­—ä¸²è¯·ä½¿ç”¨â€œSTR:å­—ä¸²â€ä½œä¸ºâ€œç¬¬ä¸€ä¸ªæ¶ˆæ¯å‚æ•°â€æˆ–â€œç¬¬äºŒä¸ªæ¶ˆæ¯å‚æ•°â€ã€‚ WM_CLOSE 16 WM_COMMAND 273 WM_USER 1024 Include WinMessages.nsh æ¥è·å¾—æ‰€æœ‰ Windows æ¶ˆæ¯å®šä¹‰ã€‚ è¦å‘é€ä¸€ä¸ªå­—ä¸²å‚æ•°çš„è¯ï¼Œåœ¨å‚æ•°å‰é¢åŠ å…¥ STR: ï¼Œä¾‹å¦‚: â€œSTR:ä¸€äº›å­—ä¸²â€ ã€‚ ä½¿ç”¨ &#x2F;TIMEOUT&#x3D;æ¯«ç§’ æ¥æŒ‡å®šæŒç»­æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚ SetAutoClose1true|false å–ä»£é»˜è®¤çš„çª—å£è‡ªåŠ¨å…³é—­ä½æ ‡è®¡(ç”± AutoCloseWindow æŒ‡å®šï¼Œä¸”å¯¹äºå†™åœ¨ç¨‹åºä¸º false)ã€‚æŒ‡å®šâ€œtrueâ€å°†ä½¿å¾—å®‰è£…ç¨‹åºåœ¨å®‰è£…å®Œæˆæ—¶ç«‹å³å…³é—­çª—å£ï¼Œæˆ–è€…â€œfalseâ€æ¥ä½¿å®ƒéœ€è¦æ‰‹åŠ¨å…³é—­ã€‚ SetBrandingImage1[/IMGID=å¯¹è¯é‡Œçš„ ID é¡¹] [/RESIZETOFIT] ä½å›¾.bmp æŠŠå½“å‰ä½å›¾ä½œä¸ºæ ‡å¿—å›¾åƒæ˜¾ç¤ºã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š IMGID åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å›¾åƒæ§ä»¶ï¼Œæˆ–ç”± AddBrandingImage å»ºç«‹çš„å›¾åƒæ§ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä½å›¾å¿…é¡»é¢„å…ˆå­˜åœ¨äºå½“å‰ç”¨æˆ·çš„æœºå™¨ä¸Šã€‚å¯ä»¥å…ˆä½¿ç”¨ File æŒ‡ä»¤æŠŠå®ƒé‡Šæ”¾ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;RESIZETOFIT åˆ™å›¾åƒä¼šè‡ªåŠ¨æ”¹å˜å°ºå¯¸åˆ°å›¾åƒæ§ä»¶çš„å¤§å°ã€‚å¦‚æœä½ ä½¿ç”¨äº† AddBrandingImage ä½ å¯ä»¥å¾—åˆ°å®ƒçš„å¤§å°ï¼Œé€šè¿‡ç¼–è¯‘ä½ çš„è„šæœ¬å¹¶å¯Ÿçœ‹ AddBrandingImage çš„è¾“å‡ºï¼Œå®ƒä¼šå‘Šè¯‰ä½ æ§ä»¶çš„å¤§å°ã€‚SetBrandingImage åœ¨ .onInit æˆ– .onInit è°ƒç”¨çš„å‡½æ•°é‡Œæ— æ•ˆã€‚ SetDetailsView1show|hide æ˜¾ç¤ºæˆ–éšè—è¯¦ç»†ä¿¡æ¯ï¼Œå–å†³äºä½ ä½¿ç”¨ä»€ä¹ˆæ ·çš„å‚æ•°ã€‚å®ƒå¯ä»¥è¦†ç›–é»˜è®¤çš„ç”± ShowInstDetails è®¾å®šçš„è¯¦ç»†ä¿¡æ¯å¯Ÿçœ‹å±æ€§ã€‚ SetDetailsPrint1none|listonly|textonly|both|lastused ä¸ºå‘½ä»¤è¾“å‡ºçš„çŠ¶æ€ä¿¡æ¯è®¾ç½®ä¸€ä¸ªæ˜¾ç¤ºæ¨¡å¼ã€‚None ä¸ºä¸è¾“å‡ºï¼Œlistonly ä»…åœ¨åˆ—è¡¨æ¡†æ˜¾ç¤ºï¼Œtextonly ä»…åœ¨çŠ¶æ€æ¡æ˜¾ç¤ºï¼Œboth åˆ™ä¸¤è€…éƒ½æ˜¾ç¤º(é»˜è®¤)ã€‚å¯¹äºé‡Šæ”¾å¾ˆå¤šå°çš„æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨ textonly(ç‰¹åˆ«åœ¨ Win9X ä¸‹å¯ç”¨äº†å¹³æ»‘å·åŠ¨)ã€‚ SetCtlColors1å¥æŸ„ [/BRANDING] [æ–‡æœ¬é¢œè‰²] [transparent|èƒŒæ™¯é¢œè‰²] å¯¹ä¸€ä¸ªé™æ€æ§ä»¶ã€ç¼–è¾‘æ§ä»¶ã€æŒ‰é’®æˆ–ä¸€ä¸ªå¯¹è¯æ¡†è®¾ç½®ä¸€ä¸ªèƒŒæ™¯é¢œè‰²å’Œæ–‡æœ¬é¢œè‰²ã€‚ä½¿ç”¨ GetDlgItem æ¥è·å–æ§ä»¶çš„å¥æŸ„ã€‚å¦‚æœè¦ä½¿å¾—æ§ä»¶é€æ˜ä½ å¯ä»¥æŒ‡å®šâ€œtransparentâ€ä½œä¸ºèƒŒæ™¯é¢œè‰²å€¼ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®š &#x2F;BRANDING å¹¶å¸¦æˆ–ä¸å¸¦æ–‡æœ¬é¢œè‰²å’ŒèƒŒæ™¯é¢œè‰²æ¥ä½¿å¾—æ§ä»¶å®Œå…¨ç°ç™½(æˆ–å…¶ä»–ä½ é€‰æ‹©çš„é¢œè‰²)ã€‚åœ¨ MUI é‡Œç”¨æ¥æ˜¾ç¤ºæ ‡å¿—ç‰Œã€‚ SetSilent1silent | normal è®¾ç½®å®‰è£…ç¨‹åºä¸ºé™é»˜æ¨¡å¼æˆ–æ™®é€šæ¨¡å¼ã€‚å…³äºé™é»˜å®‰è£…çš„è¯¦ç»†ä¿¡æ¯è¯·çœ‹ SilentInstallã€‚ä»…èƒ½åœ¨ .onInit é‡Œä½¿ç”¨ã€‚ ShowWindow1çª—å£å¥æŸ„ æ˜¾ç¤ºçŠ¶æ€ è®¾ç½®ä¸€ä¸ªçª—å£çš„æ˜¾ç¤ºç¨‹åº¦ã€‚å¯èƒ½çš„â€œæ˜¾ç¤ºçŠ¶æ€â€å’Œ Windows ShowWindow å‡½æ•°ç›¸åŒã€‚SW_* å¸¸é‡å®šä¹‰äº Include\\WinMessages.nshã€‚ å¤šè¯­è¨€æŒ‡ä»¤LoadLanguageFile1è¯­è¨€æ–‡ä»¶.nlf ç»™ä¸€ä¸ªè¯­è¨€è¡¨çš„ç»“æ„è½½å…¥ä¸€ä¸ªè¯­è¨€æ–‡ä»¶ã€‚æ‰€æœ‰çš„è¯­è¨€æ–‡ä»¶åœ¨ Contrib\\Language Files åœ¨ä½ æ’å…¥ä¸€ä¸ªè¯­è¨€æ–‡ä»¶å ${LANG_langfile} å°†ä¼šè¢«å®šä¹‰ä¸ºè¯­è¨€ ID(ä¾‹å¦‚: ${LANG_ENGLISH} å°†ä¼šè¢«å®šä¹‰ä¸º 1033)ã€‚ä½ å¯ä»¥æŠŠå®ƒç”¨äº LangStringã€LicenseLangStringã€LangDLL å’Œ VIAddVersionKeyã€‚ LangString1åç§° è¯­è¨€ID å­—ä¸² å®šä¹‰ä¸€ä¸ªä½¿ç”¨å¤šç§è¯­è¨€çš„å­—ä¸²ã€‚è¿™æ„å‘³ç€å®ƒçš„å€¼å°†å¯¹äºæ¯ä¸ªè¯­è¨€éƒ½ä¸åŒã€‚è¿™å…è®¸ä½ æ–¹ä¾¿çš„ä½¿å®‰è£…ç¨‹åºå¤šè¯­è¨€åŒ–ï¼Œä¸éœ€è¦å†è„šæœ¬é‡Œä½¿ç”¨å¤§é‡çš„å¼€å…³è¯­å¥ã€‚ æ¯ä¸€ä¸ªè¯­è¨€å­—ä¸²éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„åå­—å’Œä¸€ä¸ªç”¨äºå®‰è£…ç¨‹åºçš„åˆ†é…ç»™æ¯ä¸€ä¸ªè¯­è¨€çš„å€¼ã€‚ä»–ä»¬å¯ä»¥åœ¨è„šæœ¬é‡Œç”¨äºä»»ä½•è¿è¡Œæ—¶å­—ä¸²ã€‚è¦ä½¿ç”¨ä¸€ä¸ªè¯­è¨€å­—ä¸²ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠ $(LangString_åç§°) æ’å…¥åˆ°ä½ æƒ³æ’å…¥å­—ä¸²çš„åœ°æ–¹ã€‚ æ³¨æ„: ä¸åƒå®šä¹‰ä½¿ç”¨èŠ±æ‹¬å· - {} ä¸€æ ·ï¼Œè¯­è¨€å­—ä¸²ä½¿ç”¨åœ†æ‹¬å· - ()ã€‚ å¦‚æœä½ æƒ³åœ¨ .onInit å‡½æ•°é‡Œæ›´æ”¹è¯­è¨€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨ .onInit é‡Œçš„è¯­è¨€å­—ä¸²å°†ä»æ—§ä½¿ç”¨åŸºäºç”¨æˆ·çš„é»˜è®¤ Windows è¯­è¨€æ£€æµ‹åˆ°çš„è¯­è¨€ï¼Œå› ä¸ºè¯­è¨€çš„åˆå§‹åŒ–åœ¨ .onInit ä¹‹åã€‚ æ€»æ˜¯åœ¨ä½ çš„è„šæœ¬é‡Œä¸ºæ‰€æœ‰è¯­è¨€è®¾ç½®è¯­è¨€å­—ä¸²ã€‚ å¦‚æœä½ æŠŠè¯­è¨€ ID è®¾ä¸º 0ï¼Œåˆ™ä½¿ç”¨ LangString æˆ– LoadLanguageFile æœ€åä½¿ç”¨çš„è¯­è¨€ã€‚ ä½¿ç”¨ä¾‹å­: 12345LangString message $&#123;LANG_ENGLISH&#125; &quot;è‹±è¯­ä¿¡æ¯&quot;LangString message $&#123;LANG_FRENCH&#125; &quot;æ³•è¯­ä¿¡æ¯&quot;LangString message $&#123;LANG_KOREAN&#125; &quot;éŸ©æ–‡ä¿¡æ¯&quot;MessageBox MB_OK &quot;A translated message: $(message)&quot; LicenseLangString1åç§° è¯­è¨€ID è®¸å¯æ–‡ä»¶è·¯å¾„ ç”¨æ³•å’Œ LangString ä¸€æ ·ï¼Œä½†å®ƒä»…ä»ä¸€ä¸ªæ–‡æœ¬ã€RTF æ–‡ä»¶è½½å…¥å­—ä¸²å¹¶ä¸”å®šä¹‰ä¸€ä¸ªç‰¹åˆ«çš„ä»…èƒ½ç”¨äº LicenseData çš„ LangStringã€‚","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(2)-å®Œæ•´å±æ€§","path":"/post/1923360270.html","content":"æœ¬æ–‡åˆ—ä¸¾äº† NSIS æ”¯æŒçš„æ‰€æœ‰å±æ€§ï¼Œä»¥ä¾›æŸ¥é˜…ã€‚ æé»‘åŠ ç²—éƒ¨åˆ†çš„ä¸ºé»˜è®¤å€¼ã€‚ ä¸€ã€å¸¸è§„å±æ€§AddBrandingImage1(left|right|top|bottom) (width|height) [å¡«å……] åœ¨å®‰è£…ç¨‹åºé¡¶éƒ¨ã€åº•éƒ¨ã€å·¦è¾¹ã€å³è¾¹æ·»åŠ ä¸€ä¸ªæ ‡å¿—å›¾åƒã€‚å®ƒçš„å¤§å°å°†ç”±æŒ‡å®šçš„å®½&#x2F;é«˜ã€å®‰è£…ç¨‹åºçš„å®½&#x2F;é«˜å’Œå®‰è£…ç¨‹åºå­—ä½“ç¡®å®šã€‚æœ€ç»ˆçš„å¤§å°ä¸ä¸€å®šå°±æ˜¯ä½ éœ€è¦çš„ï¼Œè¯·çœ‹è¾“å‡ºå‘½ä»¤æ¥å¾—åˆ°å®é™…å¤§å°ã€‚å› ä¸ºè¿™å–å†³äºå®‰è£…ç¨‹åºå­—ä½“ï¼Œæ‰€ä»¥ä½ åº”è¯¥åœ¨ AddBrandingImage å‰ä½¿ç”¨ SetFontã€‚é»˜è®¤çš„å¡«å……å€¼ä¸º 2ã€‚ AllowRootDirInstalltrue|falseæ§åˆ¶æ˜¯å¦å…è®¸å®‰è£…åœ¨é©±åŠ¨å™¨æ ¹ç›®å½•ï¼Œæˆ–è€…å…±äº«ç½‘ç»œã€‚æŠŠå®ƒè®¾ä¸ºâ€œtrueâ€å¯ä»¥æ”¹å˜è¿™ä¸ªå®‰å…¨è¡Œä¸ºï¼Œæ­¤å®‰å…¨è¡Œä¸ºå¯ä»¥é˜²æ­¢ç”¨æˆ·é€‰æ‹© C:\\ æˆ– \\\\Server\\Share æ¥ä½œä¸ºå®‰è£…(æˆ–å¸è½½)ç›®å½•ã€‚å¯¹äºå¦å¤–çš„å¯å®šåˆ¶çš„ç›®å½•é€‰æ‹©é¡µé¢ã€‚ AutoCloseWindowtrue|falseè®¾ç½®å½“å®‰è£…å®Œæˆçš„æ—¶å€™çª—å£æ˜¯å¦è‡ªåŠ¨å…³é—­ã€‚è¯¥å±æ€§å¯ä»¥ä¸ç†ä¼šä¸€ä¸ªä½¿ç”¨äº† SetAutoClose çš„åŒºæ®µã€‚ BGGradient[off|(é¡¶éƒ¨é¢œè‰² åº•éƒ¨é¢œè‰² [æ–‡æœ¬é¢œè‰²|notext])] æŒ‡å®šæ˜¯å¦ä½¿ç”¨ä¸€ä¸ªæ¸å˜çš„èƒŒæ™¯çª—å£ã€‚å¦‚æœä¸ºâ€œoffâ€ï¼Œå®‰è£…ç¨‹åºå°†ä¸æ˜¾ç¤ºèƒŒæ™¯çª—å£ï¼Œå¦‚æœæ— æŒ‡å®šå‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„é»‘è“æ¸å˜ï¼Œæˆ–è€…æŒ‡å®šé¡¶éƒ¨é¢œè‰²æˆ–åº•éƒ¨é¢œè‰²æ¥å¾—åˆ°ä¸€ä¸ªæ¸å˜çš„èƒŒæ™¯ã€‚é¡¶éƒ¨é¢œè‰²å’Œåº•éƒ¨é¢œè‰²ä½¿ç”¨ RRGGBB æ ¼å¼(åå…­è¿›åˆ¶ï¼Œå°±åƒ HTML é‚£æ ·ï¼Œä½†ç•¥å»äº† #ï¼Œå› ä¸º # ç”¨äºæ³¨é‡Š)ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®šâ€œæ–‡æœ¬é¢œè‰²â€ï¼Œè¯¥é¢œè‰²ä¼šæ˜¾ç¤ºâ€œNameâ€æŒ‡å®šçš„åç§°åœ¨å·¦ä¸Šè§’ï¼Œæˆ–è€…ä½ ä¸éœ€è¦æ–‡æœ¬æ—¶ä½¿ç”¨â€œnotextâ€æ¥å…³é—­æ–‡æœ¬æ˜¾ç¤ºã€‚ BrandingText&#x2F;TRIM(LEFT|RIGHT|CENTER) æ–‡æœ¬è®¾ç½®æ˜¾ç¤ºåœ¨å®‰è£…çª—å£åº•éƒ¨çš„æ–‡æœ¬(é»˜è®¤ä¸ºâ€œNullsoft Install System vX.XXâ€)ã€‚å¦‚æœè®¾ä¸ºç©ºå­—ä¸²(â€œâ€)åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼›è®¾ä¸ºâ€ â€œ(ä¸€ä¸ªç©ºæ ¼)åˆ™æ˜¾ç¤ºç©ºç™½ã€‚å¦‚æœä½ ä¸çŸ¥é“å“ªä¸ªé€‚åˆä½ ï¼Œé‚£å°±ä¿ç•™é»˜è®¤å€¼å§ï¼Œè¿™æ ·å¯ä»¥ä½¿æ¯ä¸ªäººçŸ¥é“ä½ ä½¿ç”¨çš„ NSIS ç‰ˆæœ¬ã€‚ä½¿ç”¨ &#x2F;TRIMLEFTã€&#x2F;TRIMRIGHT æˆ– &#x2F;TRIMCENTER æ¥è£å‰ªæ§åˆ¶å¤§å°åˆ°å­—ä¸²å¤§å°ã€‚ Captionæ ‡é¢˜å½“ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ PageEx åŒºå—:è®¾ç½®å®‰è£…ç¨‹åºæ ‡é¢˜æ¡æ–‡æœ¬ã€‚é»˜è®¤ä¸ºâ€œName å®‰è£…â€ï¼Œå½“ä½¿ç”¨äº† Name æŒ‡ä»¤æŒ‡å®šäº†åç§°æ—¶ã€‚ä½ å¯ä»¥æŠŠå®ƒæ›¿æ¢ä¸ºâ€œæˆ‘çš„å®‰è£…ç¨‹åºâ€æˆ–å…¶ä»–ã€‚å¦‚æœä½ æŒ‡å®šä¸ºç©ºå­—ä¸²(â€œâ€)ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼(ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºâ€ â€œæ¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½å­—ä¸²)ã€‚ å½“ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨çš„ PageEx åŒºå—:è®¾ç½®å½“å‰é¡µé¢çš„å­æ ‡é¢˜ã€‚ ChangeUI1å¯¹è¯æ¡† ui_file.exe ä½¿ç”¨ ui_file.exe é‡Œç›¸åŒèµ„æº ID çš„ä¸€ä¸ªå¯¹è¯æ¡†æ›¿æ¢å¯¹è¯æ¡†(IDD_LICENSEã€IDD_DIRã€IDD_SELCOMã€IDD_INSTã€IDD_INSTFILESã€IDD_UNINST æˆ– IDD_VERIFY)ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®šâ€œallâ€ä½œä¸ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå½“ä½ æƒ³ä»åŒä¸€ä¸ª UI æ–‡ä»¶é‡Œä¸€æ¬¡è½½å…¥æ›¿æ¢å…¨éƒ¨ 7 ä¸ªå¯¹è¯æ¡†æ—¶ã€‚ä¸€äº› UI çš„ä¾‹å­è¯·çœ‹ä½äº NSIS ç›®å½•ä¸‹çš„ Contrib\\UIsã€‚ IDD_LICENSE å¿…é¡»åŒ…å« IDC_EDIT1 (RICHEDIT æ§ä»¶)ã€‚ IDD_DIR å¿…é¡»åŒ…å« IDC_DIR (ç¼–è¾‘æ¡†)ï¼ŒIDC_BROWSE (æŒ‰é’®) å’Œ IDC_CHECK1 (é€‰æ‹©æ¡†)ã€‚ IDD_SELCOM å¿…é¡»åŒ…å« IDC_TREE1 (SysTreeView32 control)ï¼Œå’Œ IDC_COMBO1 (ç»„åˆæ¡†)ã€‚ IDD_INST å¿…é¡»åŒ…å« IDC_BACK (æŒ‰é’®)ï¼ŒIDC_CHILDRECT (é™æ€æ§åˆ¶å…¶ä»–æ‰€æœ‰å¯¹è¯å¤§å°)ï¼ŒIDC_VERSTR (é™æ€æ–‡æœ¬æ¡†)ï¼ŒIDOK (æŒ‰é’®)ï¼Œå’Œ IDCANCEL (æŒ‰é’®)ã€‚å¦‚æœè¯¥å¯¹è¯æ¡†æœ‰ä¸€ä¸ªå›¾è±¡æ§ä»¶(é™æ€ SS_BITMAP æ ·å¼)ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç”¨äº SetBrandingImage ä½œä¸ºé»˜è®¤å€¼ã€‚ IDD_INSTFILES å¿…é¡»åŒ…å« IDC_LIST1 (SysListView32 æ§ä»¶), IDC_PROGRESS (msctls_progress32 æ§ä»¶)ï¼Œå’Œ IDC_SHOWDETAILS (æŒ‰é’®)ã€‚ IDD_UNINST å¿…é¡»åŒ…å« IDC_EDIT1 (ç¼–è¾‘æ¡†)ã€‚ IDD_VERIFY å¿…é¡»åŒ…å« IDC_STR (é™æ€æ–‡æœ¬æ¡†)ã€‚ CheckBitmap1bitmap.bmp æŒ‡å®šä¸€ä¸ªä½å›¾ä¸ºç”¨äºç»„ä»¶é€‰æ‹©é¡µé¢æ ‘å½¢åˆ—è¡¨é€‰æ‹©æ¡†çš„å›¾åƒã€‚ è¯¥ä½å›¾åº”è¯¥ä¸º 96x16 åƒç´ å¤§å°ï¼Œä¸èƒ½å¤šäº 8 ä½ä½æ·±(256 è‰²)ä¸”åŒ…æ‹¬å…­ä¸ªç”¨äºä¸åŒçŠ¶æ€(æ¬¡åºä¸º: é¼ æ ‡ç‚¹å‡»åç™½è¾¹ç¼˜ã€æœªé€‰æ—¶ã€å·²é€‰æ—¶ã€å­åŒºæ®µæœªé€‰æ—¶ã€æœªé€‰ä¸”åªè¯»ã€å·²é€‰ä¸”åªè¯»)çš„ 16x16 å›¾åƒã€‚ä½¿ç”¨ç²‰çº¢è‰²ä¸ºè¦†ç›–é¢œè‰²(è¯¥åŒºåŸŸå®é™…æ—¶ä¸ºé€æ˜)ã€‚ CompletedTextæ–‡æœ¬å½“æŒ‡å®šäº†å‚æ•°æ—¶æ›¿æ¢åœ¨å®‰è£…ç»“æŸæ—¶çš„é»˜è®¤æ–‡æœ¬(â€œå®Œæˆâ€)ã€‚å¦åˆ™ï¼Œä½¿ç”¨é»˜è®¤å€¼ã€‚ ComponentText1[æ–‡æœ¬ [å­æ–‡æœ¬] [å­æ–‡æœ¬ 2]] ç”¨æ¥æ›´æ”¹ç»„ä»¶é€‰æ‹©é¡µé¢çš„é»˜è®¤æ–‡æœ¬ã€‚ æ–‡æœ¬: æ§ä»¶ä¸Šçš„æ–‡æœ¬ï¼Œåˆ°å®‰è£…å›¾æ ‡çš„å³è¾¹ã€‚ å­æ–‡æœ¬: å®‰è£…ç±»å‹é€‰æ‹©æ§ä»¶çš„æ–‡æœ¬ã€‚ å­æ–‡æœ¬ 2: å®‰è£…ç±»å‹é€‰æ‹©æ§ä»¶ä¸‹é¢ã€ç»„ä»¶åˆ—è¡¨å·¦è¾¹çš„æ–‡æœ¬ã€‚ å¦‚æœå­—ä¸²ä¸ºç©º(â€œâ€)åˆ™ä½¿ç”¨é»˜è®¤æ–‡æœ¬ã€‚ CRCCheckon|off|forceæŒ‡å®šå®‰è£…å‰å®‰è£…ç¨‹åºæ˜¯å¦å¯¹è‡ªèº«æ‰§è¡Œä¸€ä¸ª CRCã€‚æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨äº† &#x2F;NCRC å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸”ä½ æ²¡æœ‰æŒ‡å®šâ€œforceâ€å‚æ•°æ—¶ï¼Œä¸ä¼šæ‰§è¡Œ CRCï¼Œè¿™æ ·æœ‰å¯èƒ½å¯¼è‡´ç”¨æˆ·å®‰è£…ä¸€ä¸ªæŸåçš„å®‰è£…ç¨‹åºã€‚ DetailsButtonText1show details text æŒ‡å®šå‚æ•°æ—¶æ›¿æ¢é»˜è®¤è¯¦ç»†ä¿¡æ¯æŒ‰é’®æ–‡æœ¬â€œæ˜¾ç¤ºç»†èŠ‚â€ï¼ŒæœªæŒ‡å®šå‚æ•°æ—¶ä½¿ç”¨é»˜è®¤å€¼ã€‚ DirText1[æ–‡æœ¬] [å­æ–‡æœ¬] [æµè§ˆæŒ‰é’®æ–‡æœ¬] [æµè§ˆå¯¹è¯æ¡†æ–‡æœ¬] ç”¨æ¥æ›´æ”¹ç›®å½•é€‰æ‹©é¡µé¢çš„é»˜è®¤æ–‡æœ¬ã€‚ æ–‡æœ¬: æ§ä»¶ä¸Šé¢çš„æ–‡æœ¬ï¼Œå³å»¶è‡³å®‰è£…å›¾æ ‡ã€‚ å­æ–‡æœ¬: åœ¨ç›®å½•é€‰æ‹©æ¡†æ¶ä¸Šçš„æ–‡æœ¬ã€‚ æµè§ˆæŒ‰é’®æ–‡æœ¬: æµè§ˆæŒ‰é’®ä¸Šçš„æ–‡æœ¬ã€‚ æµè§ˆå¯¹è¯æ¡†æ–‡æœ¬: åœ¨ç‚¹å‡»â€œæµè§ˆâ€æŒ‰é’®åâ€œæµè§ˆç›®å½•â€å¯¹è¯æ¡†ä¸Šçš„æ–‡æœ¬ã€‚ å¦‚æœå­—ä¸²ä¸ºç©º(â€œâ€)åˆ™ä½¿ç”¨é»˜è®¤æ–‡æœ¬ã€‚ DirVar1ç”¨æˆ·å˜é‡(ç›®å½•è¾“å…¥è¾“å‡º) æŒ‡å®šç”¨å“ªä¸ªå˜é‡æ¥ä¿å­˜æ‰€é€‰çš„ç›®å½•ã€‚è¯¥å˜é‡ä¹Ÿä¼šä¿å­˜é»˜è®¤å€¼ã€‚è¿™æ ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„å»ºç«‹ä¸¤ä¸ªä¸åŒçš„ç›®å½•é€‰æ‹©é¡µé¢è€Œä¸éœ€è¦é¢‘ç¹çš„è¯»å–ã€å†™å…¥ $INSTDIRã€‚é»˜è®¤çš„å˜é‡ä¸º $INSTDIRã€‚å®ƒåªèƒ½ç”¨äº PageEx æ¥ç¡®å®šç›®å½•å˜é‡å’Œ uninstConfirm é¡µé¢ã€‚ DirVerifyauto|leaveå¦‚æœä½¿ç”¨äº†â€œDirVerify leaveâ€ï¼Œåˆ™å½“å®‰è£…ç›®å½•æ— æ•ˆæˆ–ç£ç›˜ç©ºé—´ä¸å¤Ÿç”¨æ—¶ä¸‹ä¸€æ­¥æŒ‰é’®å°†ä¼šè¢«ç¦æ­¢å¹¶ä¸”ä½ å¯ä»¥åœ¨ç¦»å¼€å‡½æ•°é‡Œä½¿ç”¨ GetInstDirError æ¥è¯»å–è¢«è®¾ç½®çš„ä½æ ‡è®¡ã€‚ FileErrorTextæ–‡ä»¶é”™è¯¯æ–‡æœ¬æ›¿æ¢å½“æ–‡ä»¶ä¸èƒ½å†™å…¥æ—¶æ˜¾ç¤ºçš„é»˜è®¤æ–‡æœ¬ã€‚è¯¥æ–‡æœ¬å¯ä»¥åŒ…å«ä¸€ä¸ªä»£è¡¨æ–‡ä»¶åçš„ $0($0 ä¼šè¢«ä¸´æ—¶æ›´æ”¹ä¸ºè¯¥å€¼)ã€‚ä¾‹å¦‚: â€œæ–‡ä»¶ $0$\\r$ ä¸èƒ½å†™å…¥$\\r$ ç¥ä½ ä¸‹æ¬¡å¥½è¿ã€‚â€ã€‚ Icon1[è·¯å¾„\\]å›¾æ ‡æ–‡ä»¶.ico è®¾ç½®å®‰è£…ç¨‹åºçš„å›¾æ ‡ã€‚åœ¨å›¾æ ‡æ–‡ä»¶é‡Œçš„æ¯ä¸€ä¸ªå›¾æ ‡å°†ä¼šè¢«åŒ…å«åœ¨å›¾æ ‡æ–‡ä»¶é‡Œã€‚æ³¨æ„å¦‚æœä½ åœ¨å®‰è£…ç¨‹åºå’Œå¸è½½ç¨‹åºé‡Œä½¿ç”¨äº†ä¸åŒçš„å›¾æ ‡ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ–‡ä»¶å¤§å°å’Œç»“æ„å¿…é¡»åŒ¹é…å¦åˆ™å®‰è£…ç¨‹åºçš„æ„å»ºå°†ä¼šå¤±è´¥ã€‚ InstallButtonTextå®‰è£…æŒ‰é’®æ–‡æœ¬å¦‚æœæŒ‡å®šäº†å‚æ•°ï¼Œåˆ™ä¼šæŠŠé»˜è®¤çš„â€œå®‰è£…â€æŒ‰é’®æ–‡æœ¬æ›¿æ¢ä¸ºä½ æŒ‡å®šçš„æ–‡æœ¬ã€‚ InstallColors1/windows | (å‰æ™¯è‰² èƒŒæ™¯è‰²) è®¾ç½®å®‰è£…ä¿¡æ¯å±å¹•é¢œè‰²(é»˜è®¤ä¸º 00FF00 000000)ã€‚ä½¿ç”¨ RRGGBB æ ¼å¼(åå…­è¿›åˆ¶ï¼Œå°±åƒ HTML é‚£æ ·ï¼Œä½†ç•¥å»äº† #ï¼Œå› ä¸º # ç”¨äºæ³¨é‡Š)ã€‚æ³¨æ„æŒ‡å®šäº† â€œ&#x2F;windowsâ€ ä½œä¸ºå”¯ä¸€çš„å‚æ•°ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„ Windows é¢œè‰²ã€‚ InstallDiré»˜è®¤å®‰è£…ç›®å½•è®¾å®šé»˜è®¤çš„å®‰è£…ç›®å½•ã€‚æŸ¥çœ‹å˜é‡ä¸€æ®µå¾—åˆ°å¯ç”¨äºè¯¥å­—ä¸²çš„å˜é‡(å°¤å…¶æ˜¯ $PROGRAMFILES)ã€‚æ³¨æ„è¯¥å­—ä¸²ä¸­æœ€åä¸€ä¸ª \\ åé¢çš„éƒ¨åˆ†ä¼šè¢«ä¿ç•™ï¼Œå½“ç”¨æˆ·åœ¨å®‰è£…æ—¶é€‰æ‹©â€œæµè§ˆâ€å¹¶å–å¾—æ–°çš„ç›®å½•å­—ä¸²æ—¶ï¼Œè¯¥éƒ¨åˆ†ä¼šè‡ªåŠ¨é™„åŠ åœ¨åé¢(è¦ç¦æ­¢è¯¥è¡Œä¸ºä½ éœ€è¦åœ¨ç›®å½•å­—ä¸²åé¢æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ \\ ï¼Œä½†æ˜¯ä½ è¦ä½¿ç”¨å¼•å·æŠŠç›®å½•å­—ä¸²æ‹¬èµ·æ¥ä»¥é¿å…è¢«è®¤ä¸ºæ˜¯æ–­è¡Œå¤„ç†)ã€‚å¦‚æœæ²¡æœ‰èµ·ä½œç”¨çš„è¯ï¼Œè¿˜æ˜¯ä½¿ç”¨æµè§ˆæŒ‰é’®å§ã€‚ InstallDirRegKeyæ ¹é”® å­é”® é”®åè¯¥å±æ€§è®©å®‰è£…ç¨‹åºå»æ£€æµ‹ä¸€æ³¨å†Œè¡¨é‡Œçš„ä¸€ä¸ªå­—ä¸²ï¼Œå¦‚æœè¯¥å­—ä¸²å¯ç”¨é‚£ä¹ˆæŠŠå®ƒç”¨æ¥ä½œä¸ºå®‰è£…ç›®å½•ã€‚å¦‚æœé¢„ç½®äº†è¯¥å±æ€§ï¼Œå½“æŒ‡å®šçš„æ³¨å†Œè¡¨é”®å¯ç”¨æ—¶å®ƒä¼šè¶Šè¿‡ InstallDir æŒ‡å®šçš„å­—ä¸²ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤çš„ InstallDir æŒ‡å®šå€¼ã€‚æŸ¥è¯¢æ³¨å†Œè¡¨æ—¶ï¼Œè¯¥å‘½ä»¤å°†è‡ªåŠ¨æˆªå»å¼•å·(å¦‚â€œâ€C:\\program files\\poopâ€ â€œ%1â€â€ï¼Œå¯å¾—â€œC:\\program files\\poopâ€)ã€‚å¦‚æœè¯¥å­—ä¸²ä»¥â€œ.exeâ€ç»“å°¾ï¼Œå®ƒè¿˜ä¼šè‡ªåŠ¨ç§»å»å­—ä¸²é‡Œçš„æ–‡ä»¶åéƒ¨åˆ†(å¦‚â€œC:\\program files\\poop\\poop.exeâ€ï¼Œå°†å¾—åˆ°â€œC:\\program files\\poopâ€)ã€‚å¯¹äºæ›´å¤šé«˜çº§çš„å®‰è£…ç›®å½•é…ç½®ï¼Œå¯åœ¨ .onInit å‡½æ•°é‡Œè®¾å®š $INSTDIRã€‚[è¯‘è€…æ³¨: äº‹å®ä¸Šå®ƒè¿˜å¯ä»¥è‡ªåŠ¨æˆªå–å¦‚â€œâ€C:\\program files\\poop\\poop.exeâ€ â€œ%1â€â€è€Œå¾—åˆ°â€œC:\\program files\\poopâ€ï¼Œè¿™æ ·ä½ åªè¦çŸ¥é“äº†æŸä¸ªç¨‹åºå…³è”çš„æ–‡ä»¶ç±»å‹ï¼Œå°±å¯ä»¥ç›´æ¥ç”¨å®ƒè·å¾—è¯¥ç¨‹åºçš„å®‰è£…ç›®å½•ã€‚æ¯”å¦‚ InstallDirRegKey HKCR â€œFlashGet.Document\\shell\\open\\commandâ€ â€œâ€ å³å¯è·å¾—ç½‘é™…å¿«è½¦çš„å®‰è£…ç›®å½•] InstProgressFlags1[ä½æ ‡è®¡ [...]] æœ‰æ•ˆçš„ä½æ ‡è®¡å€¼ä¸ºâ€œsmoothâ€(å¹³æ»‘è¿›åº¦æ¡)æˆ–â€œcoloredâ€(æŠŠè¿›åº¦æ¡ç€è‰²ä¸º InstallColors è®¾å®šçš„é¢œè‰²)ã€‚ä¾‹å¦‚: â€œInstProgressFlagsâ€ (é»˜è®¤è€å¼ Windows å¤–è§‚)ï¼Œâ€InstProgressFlags smoothâ€ (æ–°å¼å¹³æ»‘å¤–è§‚)ï¼Œâ€InstProgressFlags smooth coloredâ€ (æ–°å¼å¹³æ»‘å¤–è§‚å¹¶ç€è‰²)ã€‚æ³¨æ„: å½“å®‰è£…ç¨‹åºè¿è¡Œåœ¨ Windows XP ä¸”ä½¿ç”¨äº†æ–°å¼ä¸»é¢˜æ—¶â€œsmoothâ€æˆ–â€œcoloredâ€éƒ½ä¸èƒ½ä¸ XPStyle on å…±ç”¨ã€‚ InstType1å®‰è£…ç±»å‹åç§° | /NOCUSTOM | /CUSTOMSTRING=å­—ä¸² | /COMPONENTSONLYONCUSTOM æŠŠä¸€ä¸ªå®‰è£…ç±»å‹æ·»åŠ åˆ°å®‰è£…ç±»å‹åˆ—è¡¨é‡Œï¼Œæˆ–ç¦æ­¢è‡ªå®šä¹‰å®‰è£…ç±»å‹ã€‚æœ€å¤šå¯ä»¥å¢åŠ åˆ° 32 ç±»ï¼Œæ¯ä¸€ä¸ªç±»å‹éƒ½éœ€è¦æŒ‡å®šå®‰è£…ç±»å‹åç§°ã€‚å¦‚æœä»¥â€œun.â€ä½œå‰ç¼€é‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¸è½½ç¨‹åºå®‰è£…ç±»å‹ã€‚ä½ å¯ä»¥ä½¿ç”¨åœ¨è¿è¡Œæ—¶å¯ä»¥å¤„ç†çš„ç”¨æˆ·å˜é‡è€Œä¸æ˜¯éš¾ä»¥æ”¹å˜çš„ä»£ç æ¥ä½œä¸ºå®‰è£…ç±»å‹åç§°ï¼Œè¿™æ ·ä½ å¯ä»¥åŠ¨æ€çš„æ”¹å˜å®‰è£…ç±»å‹çš„åç§°ã€‚å¦ä¸€ä¸ªåœ¨è¿è¡Œæ—¶æ›´æ”¹ InstType åç§°çš„æ–¹æ³•æ˜¯ InstTypeSetText å‘½ä»¤ã€‚æ‰€ä¸åŒçš„æ˜¯ä½¿ç”¨ InstTypeSetText ä½ å¯ä»¥ä¿ç•™ä½ è‡ªå·±å®è´µçš„ç”¨æˆ·å˜é‡ã€‚ç¬¬ä¸€ä¸ªç±»å‹ä¸ºé»˜è®¤ç±»å‹(é€šå¸¸ä¸ºâ€œå¸¸è§„â€)ã€‚æ¯ä¸€ä¸ªç±»å‹éƒ½æ˜¯ä»¥ç¼–å·çš„ï¼Œä» 1 å¼€å§‹ã€‚æŸ¥çœ‹ SectionIn å¯ä»¥çŸ¥é“è¿™äº›ç¼–å·æ€ä¹ˆä½¿ç”¨ã€‚å¦‚æœæŒ‡å®šäº† &#x2F;NOCUSTOM å¼€å…³ï¼Œé‚£ä¹ˆâ€œè‡ªå®šä¹‰â€ç±»å‹å°±ä¼šè¢«ç¦æ­¢ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¿…é¡»é€‰æ‹©ä¸€ä¸ªå·²ç»å®šä¹‰çš„å®‰è£…ç±»å‹ã€‚ä½œä¸ºé€‰æ‹©ï¼Œå¦‚æœæŒ‡å®šäº† &#x2F;CUSTOMSTRING å¼€å…³ï¼Œé‚£ä¹ˆè¯¥å¼€å…³çš„å‚æ•°å°†ä¼šæ›¿ä»£â€œè‡ªå®šä¹‰â€å®‰è£…ç±»å‹æ–‡æœ¬ã€‚ä½œä¸ºé€‰æ‹©ï¼Œå¦‚æœæŒ‡å®šäº† &#x2F;COMPONENTSONLYONCUSTOM ä½æ ‡è®¡ï¼Œé‚£ä¹ˆç»„ä»¶åˆ—è¡¨ä»…åœ¨é€‰æ‹©äº†â€œè‡ªå®šä¹‰â€å®‰è£…ç±»å‹çš„æ—¶å€™æ‰æ˜¾ç¤ºã€‚ LicenseBkColoré¢œè‰² | &#x2F;gray | &#x2F;windowsè®¾ç½®è®¸å¯åè®®æ•°æ®çš„èƒŒæ™¯é¢œè‰²ã€‚é¢œè‰²ä½¿ç”¨ RRGGBB æ ¼å¼(åå…­è¿›åˆ¶ï¼Œå°±åƒ HTML é‚£æ ·ï¼Œä½†ç•¥å»äº† #ï¼Œå› ä¸º # ç”¨äºæ³¨é‡Š)ã€‚é»˜è®¤ä¸ºâ€œ&#x2F;grayâ€ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨â€œ&#x2F;windowsâ€æ¥ä½¿ç”¨ Windows æ“ä½œç³»ç»Ÿå®šä¹‰çš„é¢œè‰²ã€‚ LicenseData1è®¸å¯æ–‡ä»¶.(txt|rtf) æŒ‡å®šä¸€ä¸ªç”¨æˆ·è¯»å–è®¸å¯åè®®çš„æ–‡æœ¬æ–‡ä»¶æˆ– RTF æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰è®¸å¯åè®®éœ€è¦æ˜¾ç¤ºé‚£ä¹ˆå¯ä»¥å¿½ç•¥å®ƒã€‚æ³¨æ„è¯¥æ–‡ä»¶å¿…é¡»æ˜¯ DOS æ–‡æœ¬æ ¼å¼(\\r )ã€‚è¦å®šä¹‰å¤šè¯­è¨€è®¸å¯åè®®è¯·ä½¿ç”¨ LicenseLangStringã€‚ å¦‚æœä½ ä½¿ç”¨ RTF æ–‡ä»¶æ¥æ˜¾ç¤ºè®¸å¯åè®®æ¨èä½¿ç”¨å†™å­—æ¿æ¥ç¼–è¾‘ RTF æ–‡ä»¶è€Œä¸æ˜¯ä½¿ç”¨å¾®è½¯çš„ Wordã€‚ä½¿ç”¨å†™å­—æ¿å¯ä»¥å¾—åˆ°æ›´å°çš„æ–‡ä»¶ã€‚ LicenseForceSelection(checkbox [æ¥å—æ–‡æœ¬] | radiobuttons [æ¥å—æ–‡æœ¬] [æ‹’ç»æ–‡æœ¬] | off) æŒ‡å®šæ˜¾ç¤ºçš„è®¸å¯åè®®æ˜¯å¦å¿…é¡»è¢«æ¥å—ã€‚å¯ä»¥ä½¿ç”¨å•é€‰æ¡†æˆ–äº’æ–¥æŒ‰é’®çš„å½¢å¼ã€‚é»˜è®¤æƒ…å†µä¸‹â€œä¸‹ä¸€æ­¥â€æŒ‰é’®æ˜¯ç¦æ­¢çš„å¹¶ä¸”åªèƒ½åœ¨é’©é€‰äº†å•é€‰æ¡†é€‰æ‹©äº†æ­£ç¡®çš„äº’æ–¥æŒ‰é’®åæ‰å¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥ã€‚å¦‚æœæŒ‡å®šäº† off åˆ™é»˜è®¤æƒ…å†µä¸‹â€œä¸‹ä¸€æ­¥ï¼šæŒ‰é’®æ˜¯å¯ç”¨çš„ã€‚ LicenseText1[æ–‡æœ¬ [æŒ‰é’®æ–‡æœ¬]] ç”¨æ¥æ›´æ”¹è®¸å¯åè®®é¡µé¢çš„é»˜è®¤æ–‡æœ¬ã€‚ æ–‡æœ¬: æ§ä»¶ä¸Šæ–¹çš„æ–‡æœ¬ï¼Œå³å»¶è‡³å®‰è£…å›¾æ ‡ã€‚ æŒ‰é’®æ–‡æœ¬: â€œæˆ‘åŒæ„â€æŒ‰é’®ä¸Šçš„æ–‡æœ¬ã€‚ å¦‚æœå­—ä¸²ä¸ºç©º(â€œâ€)åˆ™ä½¿ç”¨é»˜è®¤æ–‡æœ¬ã€‚ MiscButtonText1[ä¸Šä¸€æ­¥æ–‡æœ¬ [ä¸‹ä¸€æ­¥æ–‡æœ¬] [é€€å‡ºæŒ‰é’®æ–‡æœ¬] [å…³é—­æŒ‰é’®æ–‡æœ¬]] æ›¿æ¢è¿™å››ä¸ª(ä¸Šä¸€æ­¥ã€ä¸‹ä¸€æ­¥ã€é€€å‡ºã€å…³é—­)æŒ‰é’®çš„é»˜è®¤æ–‡æœ¬ã€‚å¦‚æœç•™ç©ºå‚æ•°ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ä»£æ›¿ã€‚ Name1åç§° [åŒä¸åç§°] è®¾ç½®å®‰è£…ç¨‹åºçš„åç§°ã€‚åç§°é€šå¸¸ç”¨æ¥æ˜¾ç¤ºäº§å“çš„åç§°æ¯”å¦‚â€œæˆ‘çš„ç¨‹åºâ€æˆ–â€œè“è‰²ç½‘é™…çš„ç¨‹åºâ€ã€‚å¦‚æœåœ¨åç§°é‡Œæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸ç¬¦å·(&amp;)ï¼ŒæŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ä¸ºä¸ç¬¬ä¸€ä¸ªç›¸åŒï¼Œæœ‰ &amp; çš„åœ°æ–¹ä½¿ç”¨ä¸¤ä¸ª &amp; æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ä½ çš„äº§å“åç§°ä¸ºâ€œfoo &amp; bar2000â€ï¼Œé‚£ä¹ˆä½¿ç”¨: Name â€œfoo &amp; bar2000â€ â€œfoo &amp;&amp; bar2000â€å¦‚æœä½ çš„å®‰è£…ç¨‹åºåç§°é‡Œæœ‰ &amp; ç¬¦å·å¹¶ä¸”å¯¹åç§°ä½¿ç”¨äº†ä¸€ä¸ª LangStringï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªå«æœ‰åŒ &amp; å­—ç¬¦çš„åç§°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ OutFile1[è·¯å¾„\\]å®‰è£…ç¨‹åº.exe æŒ‡å®š MakeNSIS è¦å†™å…¥å®‰è£…ç¨‹åºçš„è¾“å‡ºæ–‡ä»¶ã€‚ä»…ä»…æ˜¯ MakeNSIS è¦å†™å…¥çš„æ–‡ä»¶ï¼Œå®ƒä¸ä¼šå¯¹å®‰è£…ç¨‹åºçš„å†…å®¹æœ‰ä»»ä½•å½±å“ã€‚ SetFontå­—ä½“å å­—ä½“å¤§å°è®¾ç½®å®‰è£…ç¨‹åºå­—ä½“å¤§å°ã€‚è¯·è®°ä½ä½ é€‰æ‹©çš„å­—ä½“åœ¨ç”¨æˆ·çš„æœºå™¨ä¸Šä¹Ÿè¦æœ‰ï¼Œä¸è¦ä½¿ç”¨åªæœ‰ä½ è‡ªå·±æœ‰çš„å­—ä½“ã€‚ ShowInstDetailshide|show|nevershow è®¾ç½®æ˜¯å¦æ˜¾ç¤ºå®‰è£…è¯¦ç»†ä¿¡æ¯ã€‚ä½ å¯ä»¥è®¾ä¸ºâ€œhideâ€æ¥é»˜è®¤éšè—è¯¦ç»†ä¿¡æ¯ä½†ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ï¼Œæˆ–â€œshowâ€æ¥é»˜è®¤æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œæˆ–â€œnevershowâ€æ¥é˜»æ­¢ç”¨æˆ·æŸ¥çœ‹ä»»ä½•ä¿¡æ¯ã€‚æ³¨æ„åŒºæ®µé‡Œå¯ä»¥ä½¿ç”¨ SetDetailsView æ¥è¶Šè¿‡å®ƒçš„è®¾ç½®ã€‚ ShowUninstDetailshide|show|nevershowè®¾ç½®æ˜¯å¦æ˜¾ç¤ºå¸è½½è¯¦ç»†ä¿¡æ¯ã€‚ä½ å¯ä»¥è®¾ä¸ºâ€œhideâ€æ¥é»˜è®¤éšè—è¯¦ç»†ä¿¡æ¯ä½†ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ï¼Œæˆ–â€œshowâ€æ¥é»˜è®¤æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œæˆ–â€œnevershowâ€æ¥é˜»æ­¢ç”¨æˆ·æŸ¥çœ‹ä»»ä½•ä¿¡æ¯ã€‚æ³¨æ„åŒºæ®µé‡Œå¯ä»¥ä½¿ç”¨ SetDetailsView æ¥è¶Šè¿‡å®ƒçš„è®¾ç½®ã€‚ SilentInstallnormal|silent|silentlog æŒ‡å®šå®‰è£…ç¨‹åºæ˜¯å¦é™é»˜å®‰è£…ã€‚å¦‚æœå®ƒä¸ºâ€œsilentâ€æˆ–â€œsilentlogâ€ï¼Œæ‰€æœ‰ä½æ ‡è®¡ä¸º SF_SELECTED çš„åŒºæ®µéƒ½ä¼šè¢«å®‰è£…è€Œä¸åšæç¤º(ä½ å¯ä»¥ä½¿ç”¨ SectionSetFlags æ¥è®¾å®šåŒºæ®µçš„ä½æ ‡è®¡)ï¼Œå®‰è£…ç¨‹åºæœ¬èº«æ²¡æœ‰ä»»ä½•å±å¹•è¾“å‡º(è€Œè„šæœ¬ä»å¯ä»¥æ˜¾ç¤ºæŸäº›ç‰¹å®šçš„è¾“å‡ºï¼Œä½¿ç”¨ MessageBox çš„ &#x2F;SD å‚æ•°æ¥æŒ‡å®šé™é»˜å®‰è£…æ—¶é»˜è®¤çš„è¿”å›å€¼)ã€‚æ³¨æ„å¦‚æœè®¾ç½®ä¸ºâ€œnormalâ€ä¸”ç”¨æˆ·è¿è¡Œæ—¶ä½¿ç”¨äº† &#x2F;S (åŒºåˆ†å¤§å°å†™)å‘½ä»¤è¡Œå‚æ•°æ—¶å°±ç›¸å½“äº SilentInstall è®¾ç½®ä¸ºâ€œsilentâ€ä¸€æ ·ã€‚æ³¨æ„: ä¹Ÿå¯ä»¥çœ‹ LogSetã€‚ SilentUnInstallnormal|silentæŒ‡å®šå¸è½½ç¨‹åºæ˜¯å¦é™é»˜å®‰è£…ã€‚å¦‚æœå®ƒä¸ºâ€œsilentâ€ï¼Œå¸è½½åŒºæ®µä¼šè¢«è¿è¡Œè€Œä¸åšæç¤ºï¼Œå¸è½½ç¨‹åºæœ¬èº«æ²¡æœ‰ä»»ä½•å±å¹•è¾“å‡º(è€Œè„šæœ¬ä»å¯ä»¥æ˜¾ç¤ºæŸäº›ç‰¹å®šçš„è¾“å‡ºï¼Œä½¿ç”¨ MessageBox çš„ &#x2F;SD å‚æ•°æ¥æŒ‡å®šé™é»˜å®‰è£…æ—¶é»˜è®¤çš„è¿”å›å€¼)ã€‚æ³¨æ„å¦‚æœè®¾ç½®ä¸ºâ€œnormalâ€ä¸”ç”¨æˆ·è¿è¡Œæ—¶ä½¿ç”¨äº† &#x2F;S (åŒºåˆ†å¤§å°å†™)å‘½ä»¤è¡Œå‚æ•°æ—¶å°±ç›¸å½“äº SilentUnInstall è®¾ç½®ä¸ºâ€œsilentâ€ä¸€æ ·ã€‚æ³¨æ„: ä¹Ÿå¯ä»¥çœ‹ LogSetã€‚ SpaceTexts1[éœ€è¦ç©ºé—´æ–‡æœ¬ [å¯ç”¨ç©ºé—´æ–‡æœ¬]] å¦‚æœæŒ‡å®šäº†å‚æ•°ï¼Œå°†ä¼šå–ä»£æ‰€éœ€ç©ºé—´å’Œå¯ç”¨ç©ºé—´æ–‡æœ¬(é»˜è®¤ä¸ºâ€œæ‰€éœ€ç©ºé—´: â€å’Œâ€œå¯ç”¨ç©ºé—´: â€)ã€‚å¦‚æœæŒ‡å®šäº†â€œnoneâ€åˆ™ä¸ä¼šæ˜¾ç¤ºç©ºé—´æç¤ºæ–‡æœ¬ã€‚ SubCaption1[é¡µé¢ä»£å· å­æ ‡é¢˜] å–ä»£æ¯ä¸€ä¸ªå®‰è£…ç¨‹åºé¡µé¢(0&#x3D;â€: è®¸å¯åè®®â€,1&#x3D;â€: å®‰è£…é€‰é¡¹â€,2&#x3D;â€: å®‰è£…ç›®å½•â€, 3&#x3D;â€: æ­£åœ¨å®‰è£…â€, 4&#x3D;â€: å®‰è£…å®Œæˆâ€)çš„å­æ ‡é¢˜ã€‚å¦‚æœæŒ‡å®šäº†ç©ºå­—ä¸²(â€œâ€)ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼(ä½ ä¹Ÿå¯ä»¥æŒ‡å®š â€œ â€œ æ¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½å­—ä¸²)ã€‚ ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª PageEx åŒºå—å†…éƒ¨ä½¿ç”¨ Caption æ¥è®¾ç½®ä¸€ä¸ªå­æ ‡é¢˜(æˆ–å–ä»£é»˜è®¤å€¼)ã€‚ UninstallButtonTextæ–‡æœ¬æ›¿æ¢å¸è½½ç¨‹åºä¸Šé»˜è®¤ä¸ºâ€œå¸è½½â€çš„æŒ‰é’®æ–‡æœ¬ã€‚å¦‚æœæ— æŒ‡å®šå‚æ•°ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„æ–‡æœ¬ã€‚ä¹Ÿå¯ä»¥çœ‹ WriteUninstaller (æ›¿æ¢ UninstallEXEName)ã€‚ UninstallCaptionæ ‡é¢˜è®¾ç½®å¸è½½ç¨‹åºæ ‡é¢˜æ¡ä¸Šæ˜¾ç¤ºçš„æ–‡æœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ºç”± Name å‘½ä»¤æŒ‡å®šçš„â€œå¸è½½åç§°â€ã€‚ä½ å¯ä»¥å–ä»£å®ƒä¸ºâ€œæˆ‘çš„åº”ç”¨ç¨‹åºå¸è½½â€æˆ–å…¶ä»–ã€‚å¦‚æœæŒ‡å®šäº†ç©ºå­—ä¸²(â€œâ€)ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼(ä½ ä¹Ÿå¯ä»¥æŒ‡å®š â€œ â€œ æ¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½å­—ä¸²)ã€‚ UninstallIcon1[è·¯å¾„\\]å›¾æ ‡.ico è®¾ç½®å¸è½½ç¨‹åºçš„å›¾æ ‡ã€‚è¿™ä¸ªå›¾æ ‡æ–‡ä»¶å¿…é¡»å’Œå®‰è£…ç¨‹åºçš„å›¾æ ‡ç»“æ„ä¸€è‡´ã€‚ UninstallSubCaptioné¡µé¢ä»£å· å­æ ‡é¢˜å–ä»£æ¯ä¸€ä¸ªå¸è½½ç¨‹åºé¡µé¢(0&#x3D;â€: å¸è½½ç¡®è®¤â€,1&#x3D;â€: æ­£åœ¨å¸è½½â€,2&#x3D;â€: å¸è½½å®Œæˆâ€)çš„å­æ ‡é¢˜ã€‚å¦‚æœæŒ‡å®šäº†ç©ºå­—ä¸²(â€œâ€)ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼(ä½ ä¹Ÿå¯ä»¥æŒ‡å®š â€œ â€œ æ¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½å­—ä¸²)ã€‚ ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ª PageEx åŒºå—å†…éƒ¨ä½¿ç”¨ Caption æ¥è®¾ç½®ä¸€ä¸ªå­æ ‡é¢˜(æˆ–å–ä»£é»˜è®¤å€¼)ã€‚ UninstallText1æ–‡æœ¬ [å­æ–‡æœ¬] æŒ‡å®šå¸è½½ç¨‹åºç¡®è®¤é¡µé¢ä¸Šçš„æ–‡æœ¬ã€‚ æ–‡æœ¬: æ§ä»¶ä¸Šæ–¹çš„æ–‡æœ¬ å­æ–‡æœ¬: ä¸‹é¢å¸è½½å®šä½çš„æ–‡æœ¬ WindowIconon|offè®¾ç½®æ˜¯å¦æ˜¾ç¤ºå®‰è£…ç¨‹åºçš„å›¾æ ‡ã€‚ XPStyleon|offè®¾ç½®æ˜¯å¦æŠŠ XP å¤–è§‚æ·»åŠ åˆ°å®‰è£…ç¨‹åºé‡Œã€‚å½“è¿è¡Œåœ¨ Windows XP æ—¶ä¸€ä¸ª XP å¤–è§‚ä½¿å¾—å®‰è£…ç¨‹åºæ§ä»¶ä½¿ç”¨æ–°çš„ XP æ ·å¼ã€‚è¿™ä¸ªè®¾å®šä¹Ÿä¼šå½±å“å¸è½½ç¨‹åºã€‚ äºŒã€ç¼–è¯‘å™¨ä½æ ‡è®¡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ”¹å˜ç¼–è¯‘å™¨å¦‚ä½•å»åˆ›å»ºä»£ç å’Œå‹ç¼©æ•°æ®ã€‚è¿™äº›å‘½ä»¤åœ¨è„šæœ¬çš„ä»»ä½•åœ°æ–¹éƒ½æœ‰æ•ˆï¼Œå¹¶ä¸”å½±å“ç€è¯¥å‘½ä»¤ä¸‹çš„æ¯ä¸€è¡Œ(ç›´é“è¢«å¦ä¸€ä¸ªå‘½ä»¤å–ä»£)ã€‚ AllowSkipFileson|offè¯¥å‘½ä»¤æŒ‡å®šç”¨æˆ·æ˜¯å¦å¯ä»¥ç•¥è¿‡æ–‡ä»¶ã€‚å¦‚æœ SetOverwrite è®¾ä¸º on(é»˜è®¤)ä¸”å½“å®‰è£…ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¾€é‡Œè¾¹å†™å…¥ä¸œè¥¿å¤±è´¥æ—¶ä¸€ä¸ªç”¨æˆ·å¯ä»¥é€‰æ‹©ç•¥è¿‡æ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨äº† off åˆ™ä¸ä¼šæ˜¾ç¤ºå…è®¸ç”¨æˆ·ç•¥è¿‡æ–‡ä»¶çš„å¿½ç•¥æŒ‰é’®ï¼Œè¿™æ ·ç”¨æˆ·åªèƒ½é€‰æ‹©é€€å‡ºå®‰è£…ç¨‹åº(é€€å‡ºæŒ‰é’®)æˆ–é‡è¯•æ‰“å¼€è¯¥æ–‡ä»¶å†™å…¥(é‡è¯•æŒ‰é’®)ã€‚å¦‚æœä½¿ç”¨äº† on åˆ™ç”¨æˆ·å¯ä»¥é€‰æ‹©è·³è¿‡æ–‡ä»¶(åŒæ—¶ç½®ä¸€ä¸ªé”™è¯¯ä½æ ‡è®¡ - çœ‹ SetOverwrite)ã€‚ FileBufSizeç¼“å†²å¤§å°ä»¥ MB ä¸ºå•ä½è¯¥å‘½ä»¤è®¾ç½®ç¼–è¯‘å™¨å†…éƒ¨æ–‡ä»¶ç¼“å†²å¤§å°ã€‚è¯¥å‘½ä»¤å…è®¸ä½ é€šè¿‡é™åˆ¶ä¸€ä¸ªæ‰€ç»™çš„æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜çš„å¤šå°‘æ¥æ§åˆ¶ç¼–è¯‘å™¨çš„å†…å­˜çš„ä½¿ç”¨ã€‚å› ä¸ºç¼–è¯‘å™¨éœ€è¦è¾“å…¥å’Œè¾“å‡ºï¼Œæ‰€ä»¥æ–‡ä»¶ç¼“å†²æ—¶éœ€è¦ä½¿ç”¨ä¸¤å€æŒ‡å®šçš„å†…å­˜å¤§å°ã€‚è¯¥å‘½ä»¤ä¸ä¼šé™åˆ¶éœ€è¦å¦ä¸€ç»„å†…å­˜å¤§å°çš„å‹ç¼©å™¨ç¼“å†²ï¼Œä¹Ÿä¸ä¼šé™åˆ¶ç¼–è¯‘å™¨å¦å¤–çš„å†…éƒ¨ç¼“å†²ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªç¼“å†²æ­£å¸¸æƒ…å†µä¸‹æ— è®ºå¦‚ä½•ä¹Ÿä¸èƒ½è¾¾åˆ° 1MBã€‚æŒ‡å®šä¸€ä¸ªå¾ˆå°çš„æ•°å­—å¯èƒ½ä¼šé™ä½æ‰§è¡Œæ•ˆç‡ã€‚æŒ‡å®šè¿‡å¤§çš„æ•°å­—å¯èƒ½ä¼šè€—å°½ç³»ç»Ÿçš„èµ„æºå¹¶è¿«ä½¿ç¼–è¯‘å™¨é€€å‡ºç¼–è¯‘å¤„ç†ã€‚è¯¥é»˜è®¤å€¼ä¸º 32MBã€‚ SetCompressauto|force|off è¯¥å‘½ä»¤è®¾ç½®ç”±å®‰è£…ç¨‹åºä½¿ç”¨æ¥å†³å®šæ•°æ®æ˜¯å¦åº”è¯¥è¢«å‹ç¼©çš„å‹ç¼©ä½æ ‡è®¡ã€‚å…¸å‹çš„ SetCompress ä½æ ‡è®¡å°†å½±å“å®ƒåé¢çš„å‘½ä»¤ï¼Œå¹¶ä¸”è„šæœ¬æ–‡ä»¶ä¸­çš„æœ€åä¸€ä¸ª SetCompress å‘½ä»¤ä¹Ÿå†³å®šäº†æ˜¯å¦å‹ç¼©å®‰è£…ä¿¡æ¯åŒºæ®µå’Œå¸è½½æ•°æ®ã€‚å¦‚æœå‹ç¼©ä½æ ‡è®¡ä¸ºâ€œautoâ€ï¼Œé‚£ä¹ˆä»…å½“å‹ç¼©åå¤§å°å°äºæœªå‹ç¼©æ—¶æ–‡ä»¶æ‰ä¼šè¢«å‹ç¼©ã€‚å¦‚æœå‹ç¼©ä½æ ‡è®¡ä¸ºâ€œforceâ€ï¼Œåˆ™å§‹ç»ˆä½¿ç”¨å‹ç¼©ã€‚å¦‚æœå‹ç¼©ä½æ ‡è®¡ä¸ºâ€œoffâ€ï¼Œåˆ™ä¸ä½¿ç”¨å‹ç¼©(è¿™æ ·å¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦)ã€‚ æ³¨æ„è¯¥é€‰é¡¹å½“ä½¿ç”¨äº†å›ºå®å‹ç¼©æ–¹å¼åæ— æ•ˆï¼Œå›ºå®å‹ç¼©æ–¹å¼åœ¨ä½¿ç”¨ BZIP2 å’Œ LZMA æ—¶é»˜è®¤å¯ç”¨ã€‚ SetCompressorzlib|bzip2|lzmaè¯¥å‘½ä»¤è®¾ç½®äº†å®‰è£…ç¨‹åºå‹ç¼©æ–‡ä»¶ã€æ•°æ®ä½¿ç”¨çš„å‹ç¼©ç®—æ³•ã€‚ æ”¯æŒä¸‰ç§å‹ç¼©æ–¹å¼: ZLIBï¼ŒBZIP2 å’Œ LZMAã€‚ ZLIB (é»˜è®¤å€¼) ä½¿ç”¨æ”¶ç¼©ç®—æ³•ï¼Œæ˜¯ä¸€ä¸ªå¿«é€Ÿç®€å•çš„æ–¹æ³•ã€‚é»˜è®¤çš„å‹ç¼©çº§åˆ«å®ƒæ¶ˆè€—å¤§çº¦ 300 KB å†…å­˜ã€‚ BZIP2 é€šå¸¸æ¯” ZLIB çš„å‹ç¼©ç‡å¥½ï¼Œä½†æ˜¯ç¨å¾®æ…¢äº†ä¸€ç‚¹å¹¶ä¸”å†…å­˜çš„ä½¿ç”¨ä¹Ÿå¤šä¸€ç‚¹ã€‚é»˜è®¤çš„å‹ç¼©çº§åˆ«å®ƒæ¶ˆè€—å¤§çº¦ 4 MB å†…å­˜ã€‚ LZMA æ˜¯ä¸€ä¸ªå‹ç¼©ç‡æ¯”è¾ƒç†æƒ³çš„æ–°å¼å‹ç¼©æ–¹å¼ã€‚å®ƒçš„è§£å‹é€Ÿåº¦éå¸¸å¿«(åœ¨ 2 GHz çš„ CPU ä¸Šèƒ½è¾¾åˆ° 10-20 MB&#x2F;s çš„é€Ÿåº¦)ï¼Œä½†æ˜¯å‹ç¼©é€Ÿåº¦å¾ˆæ…¢ã€‚è§£å‹æ—¶å†…å­˜çš„ä½¿ç”¨é‡æ˜¯å­—å…¸çš„å¤§å°åŠ ä¸Šä¸€äº› KBï¼Œé»˜è®¤å€¼ä¸º 8 MBã€‚ SetCompressorDictSizeå­—å…¸å¤§å°ä»¥ MB ä¸ºå•ä½è®¾ç½®ä½¿ç”¨ LZMA å‹ç¼©å™¨æ—¶çš„å­—å…¸å¤§å°(é»˜è®¤ä¸º 8 MB)ã€‚ SetDatablockOptimizeon|offè¯¥å‘½ä»¤å†³å®šç¼–è¯‘å™¨æ˜¯å¦ä¼˜åŒ–æ•°æ®åŒºå—ã€‚æ•°æ®åŒºå—çš„ä¼˜åŒ–é¦–å…ˆç”±ç¼–è¯‘å™¨æ£€æŸ¥è¦æ·»åŠ åˆ°æ•°æ®åŒºå—çš„æ•°æ®æ˜¯å¦å·²ç»å­˜åœ¨äº†ï¼Œå¦‚æœå·²å­˜åœ¨ï¼Œåªéœ€è¦ç®€å•çš„ä½œä¸ºå¼•ç”¨æ¥æ·»åŠ (ä¼šä¿ç•™ä¸€å°éƒ¨åˆ†å¤§å°)ã€‚éå¸¸å¼ºçƒˆçš„æ¨èä¿ç•™è¯¥é€‰é¡¹ä¸º onã€‚ SetDateSaveon|offè¯¥å‘½ä»¤è®¾ç½®äº†ç”± File å‘½ä»¤ä½¿ç”¨çš„ä¿å­˜æ–‡ä»¶æ—¥æœŸã€æ—¶é—´ä½æ ‡è®¡æ¥å†³å®šæ˜¯å¦ä¿ç•™æœ€åä¸Šæ¬¡å†™å…¥æ–‡ä»¶çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œå®ƒå¯ä»¥åœ¨å®‰è£…æ—¶å‚¨å­˜ä¸‹æ¥ã€‚æœ‰æ•ˆçš„ä½æ ‡è®¡ä¸ºâ€œonâ€å’Œâ€œoffâ€ã€‚â€œonâ€ä¸ºé»˜è®¤ã€‚ SetOverwriteon|off|try|ifnewer|ifdiff|lastused è¯¥å‘½ä»¤è®¾ç½®äº†ç”± File å‘½ä»¤ä½¿ç”¨çš„è¦†ç›–ä½æ ‡è®¡æ¥å†³å®šç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨æ—¶æ˜¯å¦è¦†ç›–ã€‚å¦‚æœè¦†ç›–ä½æ ‡è®¡ä¸ºâ€œonâ€ï¼Œåˆ™ç›®æ ‡æ–‡ä»¶è¢«è¦†ç›–(è¿™ä¸ªæ˜¯é»˜è®¤å€¼)ã€‚å¦‚æœè¦†ç›–ä½æ ‡è®¡ä¸ºâ€œoffâ€,åˆ™å·²å­˜åœ¨çš„æ–‡ä»¶ä¸ä¼šè¢«è¦†ç›–ã€‚å¦‚æœè¦†ç›–ä½æ ‡è®¡ä¸ºâ€œtryâ€ï¼Œæ–‡ä»¶ä»…å½“å¯ä»¥è¢«è¦†ç›–æ—¶(å°±æ˜¯è¯´å‡å¦‚æ–‡ä»¶ä¸èƒ½å†™å…¥ï¼Œå®ƒä¼šè‡ªåŠ¨ç•¥è¿‡è€Œä¸éœ€è¦ç”¨æˆ·å†³å®š)æ‰ä¼šè¦†ç›–ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœè¦†ç›–ä½æ ‡è®¡ä¸ºâ€œifnewerâ€ï¼Œåˆ™ä»…å½“å·²å­˜åœ¨çš„æ–‡ä»¶æ¯”æ–°æ–‡ä»¶æ—§æ—¶æ‰ä¼šè¦†ç›–ç›®æ ‡æ–‡ä»¶ã€‚å¦‚æœè¦†ç›–ä½æ ‡è®¡ä¸ºâ€œifdiffâ€ï¼Œåˆ™ä»…å½“å·²å­˜åœ¨çš„æ–‡ä»¶æ¯”æ–°æ–‡ä»¶æ—§æˆ–æ–°æ—¶æ‰ä¼šè¦†ç›–ç›®æ ‡æ–‡ä»¶ã€‚æ³¨æ„åœ¨â€œifnewerâ€æˆ–â€œifdiffâ€æ¨¡å¼ä¸‹ï¼Œç›®æ ‡æ–‡ä»¶çš„æ—¥æœŸéƒ½ä¼šè¢«è®¾ä¸ºæ–°æ–‡ä»¶çš„æ—¥æœŸï¼Œè€Œä¸ç®¡ SetDateSave æ˜¯æ€ä¹ˆè®¾ç½®çš„ã€‚ SetPluginUnloadmanual|alwaysoff è¯¥å‘½ä»¤è®¾ç½®äº† CallInstDLL å’Œæ’ä»¶è°ƒç”¨(æ’ä»¶å::å‡½æ•°)çš„ä¸å¸è½½æ’ä»¶ä½æ ‡è®¡ã€‚ è¯¥å‘½ä»¤è®¾ä¸ºâ€œalwaysoffâ€ç›¸å½“äºæ¯ä¸ª CallInstDLL å’Œæ’ä»¶è°ƒç”¨éƒ½ä½¿ç”¨äº† &#x2F;NOUNLOAD å‚æ•°ã€‚è¯¥å‘½ä»¤è®¾ä¸ºâ€œmanualâ€åˆ™ä»…å½“ä½ æŒ‡å®šäº† &#x2F;NOUNLOAD å‚æ•°æ—¶æ‰ä¸å¸è½½ã€‚ ç‰ˆæœ¬ä¿¡æ¯VIAddVersionKey1[/LANG=è¯­è¨€ ID] é”®å å€¼ åœ¨æ–‡ä»¶å±æ€§çš„ç‰ˆæœ¬è¡¨æ ¼é‡Œæ·»åŠ ä¸€ä¸ªå­—æ®µã€‚æ—¢å¯ä»¥æ˜¯ç”±ç³»ç»Ÿæä¾›çš„çš„ä¸€ä¸ªå­—æ®µä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å­—æ®µã€‚éšåçš„è¿™äº›å­—æ®µç”±ç³»ç»Ÿæä¾›: ProductName Comments CompanyName LegalCopyright FileDescription FileVersion ProductVersion InternalName LegalTrademarks OriginalFilename PrivateBuild SpecialBuild è¿™äº›å­—æ®µåç§°ç”±ç›®æ ‡ç³»ç»Ÿç¿»è¯‘ï¼Œè€Œç”¨æˆ·è‡ªå®šä¹‰çš„å­—æ®µåˆ™æ— ç¿»è¯‘ã€‚ VIProductVersion1[ç‰ˆæœ¬å­—ä¸²_X.X.X.X] åœ¨æ–‡ä»¶å±æ€§ç‰ˆæœ¬è¡¨æ ¼çš„é¡¶éƒ¨æ·»åŠ äº§å“ç‰ˆæœ¬å·ã€‚","tags":["NSIS"],"categories":["NSIS"]},{"title":"NSISæ•™ç¨‹(1)-åŸºç¡€è¯­æ³•","path":"/post/409779091.html","content":"NSISï¼ˆNullsoft Scriptable Install Systemï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ Windows å¹³å°å®‰è£…åŒ…åˆ¶ä½œç¨‹åºã€‚NSIS é€šè¿‡å®ƒå®šä¹‰çš„è„šæœ¬è¯­è¨€æ¥æè¿°å®‰è£…åŒ…çš„è¡Œä¸ºå’Œé€»è¾‘çš„ã€‚ ä¸€. ç¯å¢ƒæ­å»ºä»http://nsis.sourceforge.net/Downloadä¸‹è½½ NSIS å®‰è£…è¿›è¡Œå®‰è£…ã€‚ ä½¿ç”¨ NSIS ç”Ÿæˆå®‰è£…åŒ…çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š ä½¿ç”¨ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ Notepad++ã€Visual Studio Codeï¼‰å¼€å‘ NSIS è„šæœ¬ ä½¿ç”¨å®‰è£…ç›®å½•å†…çš„ makensisw.exe ç¨‹åºç¼–è¯‘ NSIS è„šæœ¬ç”Ÿæˆå®‰è£…åŒ…ã€‚ makensisw.exe åªæä¾›ç¼–è¯‘è„šæœ¬çš„åŠŸèƒ½ï¼Œä¸èƒ½å¯¹è„šæœ¬è¿›è¡Œè°ƒè¯•ã€‚ äºŒ. NSIS è„šæœ¬ç»“æ„ä¸€ä¸ª NSIS è„šæœ¬å¯ä»¥åŒ…æ‹¬ï¼šå®‰è£…ç¨‹åºå±æ€§ã€é¡µé¢ã€åŒºæ®µç­‰ã€‚ å¯¹äºä¸€ä¸ªæœ€ç®€å•çš„ NSIS è„šæœ¬ï¼Œåªæœ‰ OutFileå±æ€§å’ŒåŒºæ®µï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰æ˜¯å¿…é¡»çš„ï¼ŒOutFile å±æ€§ç”¨äºæŒ‡å®š NSIS ç¼–è¯‘ç”Ÿæˆå®‰è£…åŒ…çš„è·¯å¾„ã€‚ 1234OutFile &quot;Simple.exe&quot;Section &quot;Installer Section&quot;SectionEnd ä¿å­˜ä¸Šé¢è„šæœ¬åˆ°ä»»æ„ .nsi æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ makensisw.exe æ‰“å¼€æ”¹è„šæœ¬è¿›è¡Œç¼–è¯‘ï¼Œå‡ºç°ä¸‹å›¾è¡¨ç¤ºç¼–è¯‘æˆåŠŸï¼ŒæˆåŠŸä¹‹åä¼šåœ¨è„šæœ¬å½“å‰ç›®å½•çœ‹åˆ°è¾“å‡ºçš„ Simple.exe æ–‡ä»¶ã€‚ å¦‚æœç¼–è¯‘å¤±è´¥ï¼Œmakensisw.exe ä¼šåœ¨è¾“å‡ºçª—å£æç¤ºå¤±è´¥åŸå› ã€‚ éœ€è¦æ³¨æ„ï¼šå¦‚æœ NSIS è„šæœ¬å†…åŒ…å«ä¸­æ–‡ç­‰é ASCII å­—ç¬¦ï¼Œéœ€è¦å°†è„šæœ¬ä¿å­˜ä¸º ANSI ç¼–ç æ ¼å¼ï¼Œè€Œä¸èƒ½ä¿å­˜ä¸º UTF8 æ ¼å¼ã€‚ 2.1 å®‰è£…ç¨‹åºå±æ€§å®‰è£…ç¨‹åºçš„å±æ€§ç”¨äºæ§åˆ¶å®‰è£…ç¨‹åºçš„å¤–è§‚ï¼Œæ¯”å¦‚æŒ‡å®šå“ªäº›é¡µé¢å‡ºç°åœ¨å®‰è£…ç¨‹åºé‡Œï¼Œåœ¨æ¯ä¸ªé¡µé¢çš„æ¯ä¸ªéƒ¨åˆ†æ˜¾ç¤ºä»€ä¹ˆæ–‡æœ¬ï¼Œå®‰è£…ç¨‹åºçš„åç§°ï¼ˆå¦‚ä¸Šé¢è„šæœ¬ä¸­çš„ OutFileï¼‰ï¼Œä½¿ç”¨ä»€ä¹ˆæ ·çš„å›¾æ ‡ï¼Œé»˜è®¤å®‰è£…ç›®å½•ç­‰ç­‰ã€‚ å®‰è£…ç¨‹åºå±æ€§å¯ä»¥åœ¨é™¤äº†åŒºæ®µå’Œå‡½æ•°ä»¥å¤–çš„ä»»ä½•åœ°æ–¹è®¾ç½®ã€‚ å¯ä»¥ç†è§£ä¸ºå®‰è£…ç¨‹åºå±æ€§æ˜¯è®¾ç½®ç»™ NSIS ç¼–è¯‘å™¨çœ‹çš„ï¼Œè¿™äº›å±æ€§çš„å€¼åœ¨ç¼–è¯‘æ—¶éƒ½å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥é™¤äº† InstallDir ä»¥å¤–ï¼Œå…¶ä»–å®‰è£…ç¨‹åºå±æ€§éƒ½ä¸å…è®¸ä½¿ç”¨å˜é‡ï¼ˆé™¤äº†$\\rå’Œ$ ï¼‰ã€‚ 2.2 å®Œæ•´çš„å®‰è£…ç¨‹åºå±æ€§è§ NSISæ•™ç¨‹(2)-å®Œæ•´å±æ€§ 2.2 é¡µé¢é¡µé¢åˆ†ä¸ºNSISå†…ç½®çš„å‘å¯¼é¡µé¢å’Œç”¨æˆ·è‡ªå®šä¹‰é¡µé¢ã€‚ ä¸€ä¸ªéé™é»˜å®‰è£…ç¨‹åºéœ€è¦é¡µé¢æ¥æŒ‡å¯¼ç”¨æˆ·è¿è¡Œå®‰è£…ç¨‹åºï¼Œå¯ä»¥é€šè¿‡Pageå‘½ä»¤æˆ–PageExï¼ˆPageEx æä¾›äº†æ›´å¤šé«˜çº§çš„è®¾ç½®ï¼‰å‘½ä»¤æ¥è®¾å®šå“ªä¸ªé¡µé¢æ˜¾ç¤ºã€‚ é¡µé¢å®é™…çš„æ˜¾ç¤ºé¡ºåºå’Œå®ƒåœ¨ NSIS è„šæœ¬ä¸­å®šä¹‰çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚ 2.2.1 å†…ç½®å‘å¯¼é¡µé¢ï¼šNSIS å†…ç½®çš„å‘å¯¼é¡µé¢æœ‰ï¼š licenseï¼šè®¸å¯è¯é¡µé¢ã€‚ componentsï¼š ç»„ä»¶é€‰æ‹©é¡µé¢ï¼Œæ¯ä¸ªå¯è§çš„åŒºæ®µéƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªç»„ä»¶ç»™ç”¨æˆ·é€‰æ‹©æ˜¯å¦å®‰è£…ã€‚ä½ å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªåŒºæ®µæ¥æ„å»ºå®‰è£…åŒ…ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦ä½¿ç”¨ç»„ä»¶é¡µæ¥è®©ç”¨æˆ·é€‰æ‹©å¯é€‰çš„ç»„ä»¶ï¼Œé‚£ä½ å°±éœ€è¦ä½¿ç”¨å¤šä¸ªåŒºæ®µã€‚ directoryï¼š å®‰è£…ç›®å½•é€‰æ‹©é¡µé¢ã€‚ instfilesï¼š å®‰è£…è¿‡ç¨‹é¡µé¢ã€‚ uninstConfirmï¼š å¸è½½ç¡®è®¤é¡µé¢ã€‚ ä¸åŒçš„é¡µé¢ï¼Œæœ‰ä¸åŒçš„å±æ€§ã€‚ å†…ç½®é¡µé¢è¯­æ³•å¦‚ä¸‹ï¼š 1Page (license|components|directory|instfiles|uninstConfirm) [é¢„ç½®å‡½æ•°] [æ˜¾ç¤ºå‡½æ•°] [ç¦»å¼€å‡½æ•°] æ¯ä¸ªå†…å»ºçš„é¡µé¢éƒ½æœ‰ä¸‰ä¸ªå›è°ƒå‡½æ•°ï¼ˆé¢„ç½®å‡½æ•°ã€æ˜¾ç¤ºåˆ›å»ºå‡½æ•°å’Œç¦»å¼€å‡½æ•°ï¼‰ï¼Œé¢„ç½®å‡½æ•°åœ¨é¡µé¢è¢«åˆ›å»ºä¹‹å‰è¢«ç›´æ¥çš„è°ƒç”¨ï¼Œæ˜¾ç¤ºå‡½æ•°åœ¨é¡µé¢è¢«åˆ›å»ºåä¸”åœ¨æ˜¾ç¤ºä¹‹å‰è¢«ç›´æ¥è°ƒç”¨ï¼Œç¦»å¼€å‡½æ•°åœ¨ç”¨æˆ·æŒ‰ä¸‹ä¸‹ä¸€é¡µæŒ‰é’®ä¹‹åå¹¶ä¸”åœ¨é¡µé¢ç¦»å¼€ä¹‹å‰è¢«ç›´æ¥è°ƒç”¨ã€‚ å¦‚ï¼š 123PageEx license LicenseData &quot;license.rtf&quot; #å¯ä»¥æ˜¯txtæˆ–rtfæ–‡ä»¶æ ¼å¼PageExEnd 2.2.2 è‡ªå®šä¹‰é¡µé¢åˆ›å»ºè‡ªå®šä¹‰é¡µé¢è¯­æ³•ï¼š 1page custom [åˆ›å»ºå‡½æ•°] [ç¦»å¼€å‡½æ•°] [æ ‡é¢˜] è‡ªå®šä¹‰é¡µé¢åªæœ‰ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼ˆåˆ›å»ºå‡½æ•°å’Œç¦»å¼€å‡½æ•°ï¼‰ï¼Œåˆ›å»ºå‡½æ•°åœ¨éœ€è¦åˆ›å»ºé¡µé¢æ—¶è¢«è°ƒç”¨ï¼Œç¦»å¼€å‡½æ•°åœ¨ç”¨æˆ·æŒ‰ä¸‹â€ä¸‹ä¸€é¡µâ€æŒ‰é’®ä¹‹åå¹¶ä¸”åœ¨é¡µé¢ç¦»å¼€ä¹‹å‰è¢«ç›´æ¥è°ƒç”¨ã€‚ 2.2.3 é¡µé¢å›è°ƒå‡½æ•°æ¯ä¸ªå†…å»ºçš„é¡µé¢éƒ½æœ‰ä¸‰ä¸ªå›è°ƒå‡½æ•°ï¼šä¸€ä¸ªé¢„ç½®å‡½æ•°ã€ä¸€ä¸ªæ˜¾ç¤ºåˆ›å»ºå‡½æ•°å’Œä¸€ä¸ªç¦»å¼€å‡½æ•°ã€‚ é¢„ç½®å‡½æ•°åœ¨é¡µé¢è¢«åˆ›å»ºä¹‹å‰è¢«ç›´æ¥çš„è°ƒç”¨ï¼Œæ˜¾ç¤ºå‡½æ•°åœ¨é¡µé¢è¢«åˆ›å»ºåä¸”åœ¨æ˜¾ç¤ºä¹‹å‰è¢«ç›´æ¥è°ƒç”¨ï¼Œç¦»å¼€å‡½æ•°åœ¨ç”¨æˆ·æŒ‰ä¸‹ä¸‹ä¸€é¡µæŒ‰é’®ä¹‹åå¹¶ä¸”åœ¨é¡µé¢ç¦»å¼€ä¹‹å‰è¢«ç›´æ¥è°ƒç”¨ã€‚ é¢„ç½®å‡½æ•°å…è®¸ä½¿ç”¨ Abort æ¥ç•¥è¿‡è¯¥é¡µé¢ã€‚ æ˜¾ç¤ºå‡½æ•°å…è®¸ä½¿ç”¨ CreateFontã€SetCtlColorsã€SendMessage å’Œå…¶ä»–æ¥è°ƒæ•´é¡µé¢çš„ç”¨æˆ·ç•Œé¢ã€‚ ç¦»å¼€å‡½æ•°å…è®¸ä½¿ç”¨ Abort æ¥å¼ºåˆ¶ç”¨æˆ·åœç•™åœ¨å½“å‰é¡µé¢ã€‚ ä¸€ä¸ªè‡ªå®šä¹‰çš„é¡µé¢ä»…æœ‰ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯å¿…é¡»çš„åˆ›å»ºé¡µé¢ï¼Œå¦ä¸€ä¸ªç¦»å¼€å‡½æ•°çš„ä½œç”¨å°±å’Œå†…å»ºé¡µé¢çš„ç¦»å¼€å‡½æ•°ä¸€æ ·ã€‚ ä¾‹å¦‚ï¼š 123456789101112131415161718192021222324252627Page license skipLicense &quot;&quot; stayInLicensePage custom customPage &quot;&quot; &quot;: è‡ªå®šä¹‰é¡µé¢&quot;Page instfilesFunction skipLicense MessageBox MB_YESNO &quot;ä½ æƒ³ç•¥è¿‡è®¸å¯é¡µé¢å—ï¼Ÿ&quot; IDNO no Abort no:FunctionEndFunction stayInLicense MessageBox MB_YESNO &quot;ä½ æƒ³åœç•™åœ¨è®¸å¯é¡µé¢å—ï¼Ÿ&quot; IDNO no Abort no:FunctionEndFunction customPage GetTempFileName $R0 File /oname=$R0 customPage.ini InstallOptions::dialog $R0 Pop $R1 StrCmp $R1 &quot;cancel&quot; done StrCmp $R1 &quot;back&quot; done StrCmp $R1 &quot;success&quot; done error: MessageBox MB_OK|MB_ICONSTOP &quot;InstallOptions error:$\\r$ $R1&quot; done:FunctionEnd 2.3 åŒºæ®µï¼ˆSectionï¼‰åœ¨å®‰è£…ç¨‹åºä¸­ç”¨æˆ·éœ€è¦å®‰è£…è®¸å¤šä¸œè¥¿ï¼Œå¦‚å®‰è£…æºç ã€é™„åŠ æ’ä»¶ã€è„šæœ¬æ ·ä¾‹æˆ–å…¶ä»–ã€‚é‡Œé¢çš„æ¯ä¸ªå®‰è£…ç»„ä»¶éƒ½æœ‰å®ƒè‡ªå·±çš„ä»£ç å—ï¼Œå½“ç”¨æˆ·é€‰æ‹©äº†å®‰è£…è¯¥ç»„ä»¶ï¼Œé‚£ä¹ˆå®‰è£…ç¨‹åºå°±ä¼šæ‰§è¡Œå¯¹åº”çš„ä»£ç ã€‚ åœ¨ NSIS è„šæœ¬é‡Œï¼Œè¿™äº›ä»£ç ç§°ä¸ºåŒºæ®µã€‚æ¯ä¸ªå¯è§çš„åŒºæ®µéƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªç»„ä»¶ç»™ç”¨æˆ·é€‰æ‹©æ˜¯å¦å®‰è£…ï¼ˆåŒºæ®µä¹Ÿå¯ä»¥è®¾ç½®å±æ€§å¯¹ç”¨æˆ·éšè—ï¼Œé»˜è®¤å®‰è£…ï¼Œè®©ç”¨æˆ·æ— æ³•é€‰æ‹©æ˜¯å¦å®‰è£…ï¼‰ã€‚ NSIS è„šæœ¬å¯¹åŒºæ®µçš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä½ å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªåŒºæ®µæ¥æ„å»ºå®‰è£…åŒ…ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦ä½¿ç”¨ç»„ä»¶é¡µæ¥è®©ç”¨æˆ·é€‰æ‹©å¯é€‰çš„ç»„ä»¶ï¼Œé‚£ä½ å°±éœ€è¦ä½¿ç”¨å¤šä¸ªåŒºæ®µäº†ã€‚ å¸è½½ç¨‹åºä¹Ÿå¯ä»¥æœ‰å¤šä¸ªåŒºæ®µï¼Œä½†å¸è½½ç¨‹åºåŒºæ®µåå‰è¦åŠ ä¸Šå‰ç¼€un.ï¼Œå› ä¸ºå¸è½½ç¨‹åºæ˜¯è¦è¢«ç¼–è¯‘æˆæ˜¯ä¸€ä¸ªå•ç‹¬çš„ exe çš„ï¼Œæ‰€ä»¥è¦å¯¹ç¼–è¯‘å™¨æŒ‡æ˜å“ªäº›å†…å®¹ï¼ˆå¦‚åŒºæ®µï¼‰éœ€è¦è¢«ç¼–è¯‘è¿›å¸è½½ç¨‹åºï¼Œå› æ­¤éœ€è¦ç‰¹æ®Šå‰ç¼€ã€‚ åŒºæ®µåä¸ºç©ºã€é—æ¼æˆ–è€…ä»¥ä¸€ä¸ª â€œ-â€œ å¼€å¤´ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯ä¸€ä¸ªéšè—çš„åŒºæ®µï¼Œç”¨æˆ·ä¹Ÿä¸èƒ½åœ¨ç»„ä»¶é€‰æ‹©é¡µé¢é€‰æ‹©æ˜¯å¦ç¦æ­¢ã€‚ ä¸‰. NSIS è¯­æ³•3.1 è¯­æ³•æ¦‚è¿° å•è¡Œæ³¨é‡Šç”¨äº•å·#æˆ–åˆ†å·;ï¼Œè·¨è¡Œæ³¨é‡Šç”¨å¯ä»¥ç”¨ C&#x2F;C++ä¸­æ³¨é‡Šè¯­æ³•ï¼› æ•°å­—å¸¸é‡å¯ä»¥ç”¨åè¿›åˆ¶ã€åå…­è¿›åˆ¶(0x ä¸ºå‰ç¼€)ã€å…«è¿›åˆ¶(0 ä¸ºå‰ç¼€)è¡¨ç¤ºï¼Œé¢œè‰²ç”¨ç±»ä¼¼ html çš„ä¸­ RGB è¡¨ç¤ºæ³•ï¼Œä½†å»äº•å·â€#â€ã€‚ å­—ç¬¦ä¸²å¸¸é‡å¯ä»¥ç”¨å¼•å·å¼•ç”¨ï¼Œç‰¹æ®Šçš„å­—ç¬¦å¯ä»¥ä½¿ç”¨ç¾å…ƒç¬¦å·â€$â€ä½œå‰ç¼€æ¥è½¬ä¹‰ã€‚ç¾å…ƒç¬¦å·ã€æ¢è¡Œã€å›è½¦ã€åˆ¶è¡¨ç¬¦éƒ½æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦è½¬ä¹‰ï¼Œä»–ä»¬åœ¨NSISä¸­å¯ä»¥å†™æˆï¼š $$, $ , $r, $\\t NSIS è„šæœ¬ç”¨è¡Œå°¾çš„åæ–œæ â€&quot;è¡¨ç¤ºä¸‹ä¸€è¡Œå’Œå½“å‰è¡Œé€»è¾‘ä¸Šæ˜¯åŒä¸€è¡Œã€‚ 3.2 å¸¸é‡å’Œå˜é‡NSIS çš„å˜é‡å’Œå¸¸é‡éƒ½æ˜¯å…¨å±€çš„ï¼Œä¸”å¤§å°å†™æ•æ„Ÿçš„ï¼ŒNSIS ä¸­å˜é‡å’Œå¸¸é‡éƒ½æ˜¯å¼±ç±»å‹çš„ã€‚ å¸¸ç”¨å’Œå˜é‡çš„å¼•ç”¨æ–¹å¼éƒ½æ˜¯$&#123;VAR_NAME&#125;æˆ–$VAR_NAMEã€‚ ä½¿ç”¨!defineæ–¹å¼å®šä¹‰å¸¸é‡ï¼Œå¦‚ï¼š!define PRODUCT_NAME &quot;ç½‘æ˜“äº‘éŸ³ä¹&quot; ä½¿ç”¨Varæ–¹å¼å®šä¹‰å˜é‡ï¼Œå¦‚ï¼šVar a NSIS å†…ç½®äº† 20 ä¸ªå·²æ³¨å†Œçš„å˜é‡ï¼š$0 ~ $9 å’Œ $R0 ~ $R9ï¼Œè¿™äº›å˜é‡ä¸éœ€è¦å£°æ˜å°±å¯ä»¥ä½¿ç”¨ï¼Œä¸€èˆ¬ç”¨äºå‚æ•°ä¼ é€’ç­‰ã€‚ å¦å¤–ï¼ŒNSIS å†…ç½®ä¸€ä¸ªå †æ ˆï¼Œä½¿ç”¨pushå’Œpopå‘½ä»¤æ¥å…¥æ ˆå’Œå‡ºæ ˆï¼Œå¯ä»¥ä½¿ç”¨å †æ ˆæ¥æš‚å­˜æ•°æ®ã€‚ å…³äºå˜é‡çš„èµ‹å€¼ï¼ŒNSIS ä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨=æ¥èµ‹å€¼ï¼Œéœ€è¦å€ŸåŠ©StrCpyæ¥å®ç°ï¼Œå¦‚ï¼š 12StrCpy $0 &quot;hello&quot;StrCpy $0 123 3.3 å‡½æ•°3.3.1 å‡½æ•°å®šä¹‰123Function å‡½æ•°åFunctionEnd å‡½æ•°åä»¥â€œ.â€å¼€å¤´çš„(ä¾‹å¦‚ â€œ.Whateverâ€)ä¸€èˆ¬ä½œä¸ºå›è°ƒå‡½æ•°ä¿ç•™ã€‚å‡½æ•°åä»¥â€œun.â€å¼€å¤´çš„å‡½æ•°å°†ä¼šè¢«åˆ›å»ºåœ¨å¸è½½ç¨‹åºé‡Œã€‚å› æ­¤ï¼Œæ™®é€šå®‰è£…åŒºæ®µå’Œå‡½æ•°ä¸èƒ½è°ƒç”¨å¸è½½å‡½æ•°ï¼Œè€Œå¸è½½åŒºæ®µå’Œå¸è½½å‡½æ•°ä¹Ÿä¸èƒ½è°ƒç”¨æ™®é€šå‡½æ•°ã€‚NSIS å‡½æ•°å£°æ˜ä¸­ä¸æ”¯æŒå‚æ•°å®šä¹‰ï¼Œå¦‚æœéœ€è¦ä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ 20 ä¸ªå˜é‡æˆ–è€…å †æ ˆçš„æ–¹å¼ã€‚ 3.3.2 å‡½æ•°è°ƒç”¨1Call å‡½æ•°å 3.4 å®é™¤äº†å‡½æ•°ä¹‹å¤–ï¼ŒNSIS è¿˜æ”¯æŒå®šä¹‰å®ï¼ŒNSIS ä¸­çš„å®æ”¯æŒå®šä¹‰å‚æ•°ã€‚ 3.4.1 å®å®šä¹‰123!macro å®å [å‚æ•°1] [å‚æ•°n]!macroend 3.4.2 å®è°ƒç”¨1!insertmacro å®å [å‚æ•°1] [å‚æ•°n] 3.5 æŒ‡ä»¤NSIS å†…ç½®äº†å¾ˆå¤šæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤æä¾›äº†å®‰è£…åŒ…å¸¸ç”¨äº†åŠŸèƒ½ï¼Œå¦‚æœè¿™äº›æŒ‡ä»¤æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±å¼€å‘æ’ä»¶ã€‚ NSIS æ”¯æŒçš„æŒ‡ä»¤åˆ—è¡¨è§ï¼šNSISæ•™ç¨‹(3)-å®Œæ•´æŒ‡ä»¤ NSIS æŒ‡ä»¤ä½¿ç”¨ä¸­æ¯”è¾ƒç‰¹åˆ«çš„åœ¨äºè·³è½¬ï¼Œæ¯”å¦‚æ‰§è¡Œå¤±è´¥è·³è½¬åˆ°å“ªé‡Œï¼ŒæˆåŠŸè·³è½¬åˆ°å“ªé‡Œã€‚ä»¥MessageBoxæŒ‡ä»¤ä¸ºä¾‹ï¼ˆ[]ä¸ºå¯é€‰é¡¹ï¼‰ï¼š 1MessageBox æ¶ˆæ¯æ¡†é€‰é¡¹åˆ—è¡¨ æ¶ˆæ¯æ¡†æ–‡æœ¬ [/SD è¿”å›] [æ£€æµ‹è¿”å›å€¼ è·³è½¬åˆ°] [æ£€æµ‹è¿”å›å€¼2 è·³è½¬åˆ°2] ä¸‹é¢çš„ç”¨æ³•è¡¨ç¤ºå¦‚æœ MessageBox è¿”å› IDYESï¼Œåˆ™+2ï¼Œå³è·³è½¬åˆ°è¯¥æŒ‡ä»¤çš„ä¸‹ 2 æ¡æ‰§è¡Œï¼ˆ+1 è¯¥æŒ‡ä»¤çš„ä¸‹ 1 æ¡ï¼Œ+2 å°±ä¸ºè¯¥æŒ‡ä»¤çš„ä¸‹ 2 æ¡ï¼‰ï¼Œ/SD IDYESè¡¨ç¤ºå®‰è£…åŒ…é‡‡ç”¨é™é»˜å®‰è£…æ–¹å¼æ—¶é»˜è®¤ç”¨æˆ·é€‰æ‹©äº†IDYES: 1MessageBox MB_ICONQUESTION|MB_YESNO &quot;ä½ ç¡®å®è¦å®Œå…¨åˆ é™¤ç½‘æ˜“äº‘éŸ³ä¹ï¼ŒåŠå…¶æ‰€æœ‰ç»„ä»¶å—?&quot; /SD IDYES IDYES +2 IDNO +1 å››. NSIS ç•Œé¢NSIS æä¾›çš„ç•Œé¢åˆ†ä¸ºä¼ ç»Ÿç•Œé¢ï¼ˆClassic UIï¼‰ã€ç°ä»£ç•Œé¢ï¼ˆModern UIï¼‰ã€‚ 4.1 ä¼ ç»Ÿç•Œé¢ 4.2 ç°ä»£ç•Œé¢ 4.3 è‡ªå®šä¹‰ç•Œé¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹ç•Œé¢åº“ï¼ˆå¦‚ duilib, Qtï¼‰è‡ªå·±ç»˜åˆ¶å®‰è£…åŒ…çš„ç•Œé¢ï¼Œè¿™æ ·çµæ´»åº¦æ›´å¤§ï¼Œå¯ä»¥å¼€å‘å‡ºç±»ä¼¼ QQ é‚£æ ·çš„å®‰è£…ç•Œé¢ã€‚åœ¨æ­¤ä¹‹å‰éœ€è¦æŒæ¡ NSIS çš„æ’ä»¶å¼€å‘æŠ€å·§ã€‚","tags":["NSIS"],"categories":["NSIS"]},{"title":"WebRTCçº¿ç¨‹æ¨¡å‹","path":"/post/795351407.html","content":"åœ¨ä»‹ç»WebRTCçš„çº¿ç¨‹æ¨¡å‹ä¹‹å‰ï¼Œå…ˆä»‹ç»Webrtcçº¿ç¨‹æ¨¡å‹ä¸­ç”¨åˆ°çš„å‡ ä¸ªç®€å•ã€å¸¸ç”¨çš„æ¨¡å—æˆ–å‡½æ•°ã€‚ ä¸€ã€ è®¾ç½®çº¿ç¨‹å12345678910111213141516171819202122//platform_thread.ccvoid SetCurrentThreadName(const char* name) &#123;#if defined(WEBRTC_WIN) struct &#123; DWORD dwType; LPCSTR szName; DWORD dwThreadID; DWORD dwFlags; &#125; threadname_info = &#123;0x1000, name, static_cast&lt;DWORD&gt;(-1), 0&#125;; __try &#123; ::RaiseException(0x406D1388, 0, sizeof(threadname_info) / sizeof(DWORD), reinterpret_cast&lt;ULONG_PTR*&gt;(&amp;threadname_info)); &#125; __except (EXCEPTION_EXECUTE_HANDLER) &#123; &#125;#elif defined(WEBRTC_LINUX) || defined(WEBRTC_ANDROID) prctl(PR_SET_NAME, reinterpret_cast&lt;unsigned long&gt;(name));#elif defined(WEBRTC_MAC) || defined(WEBRTC_IOS) pthread_setname_np(name);#endif&#125; äºŒã€ åŸå­æ“ä½œ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859//atomicops.hclass AtomicOps &#123; public:#if defined(WEBRTC_WIN) // Assumes sizeof(int) == sizeof(LONG), which it is on Win32 and Win64. static int Increment(volatile int* i) &#123; return ::InterlockedIncrement(reinterpret_cast&lt;volatile LONG*&gt;(i)); &#125; static int Decrement(volatile int* i) &#123; return ::InterlockedDecrement(reinterpret_cast&lt;volatile LONG*&gt;(i)); &#125; static int AcquireLoad(volatile const int* i) &#123; return *i; &#125; static void ReleaseStore(volatile int* i, int value) &#123; *i = value; &#125; static int CompareAndSwap(volatile int* i, int old_value, int new_value) &#123; return ::InterlockedCompareExchange(reinterpret_cast&lt;volatile LONG*&gt;(i), new_value, old_value); &#125; // Pointer variants. template &lt;typename T&gt; static T* AcquireLoadPtr(T* volatile* ptr) &#123; return *ptr; &#125; template &lt;typename T&gt; static T* CompareAndSwapPtr(T* volatile* ptr, T* old_value, T* new_value) &#123; return static_cast&lt;T*&gt;(::InterlockedCompareExchangePointer( reinterpret_cast&lt;PVOID volatile*&gt;(ptr), new_value, old_value)); &#125;#else static int Increment(volatile int* i) &#123; return __sync_add_and_fetch(i, 1); &#125; static int Decrement(volatile int* i) &#123; return __sync_sub_and_fetch(i, 1); &#125; static int AcquireLoad(volatile const int* i) &#123; return __atomic_load_n(i, __ATOMIC_ACQUIRE); &#125; static void ReleaseStore(volatile int* i, int value) &#123; __atomic_store_n(i, value, __ATOMIC_RELEASE); &#125; static int CompareAndSwap(volatile int* i, int old_value, int new_value) &#123; return __sync_val_compare_and_swap(i, old_value, new_value); &#125; // Pointer variants. template &lt;typename T&gt; static T* AcquireLoadPtr(T* volatile* ptr) &#123; return __atomic_load_n(ptr, __ATOMIC_ACQUIRE); &#125; template &lt;typename T&gt; static T* CompareAndSwapPtr(T* volatile* ptr, T* old_value, T* new_value) &#123; return __sync_val_compare_and_swap(ptr, old_value, new_value); &#125;#endif&#125;; ä½¿ç”¨ç¤ºä¾‹ 123bool MessageQueue::IsQuitting() &#123; return AtomicOps::AcquireLoad(&amp;stop_) != 0;&#125; ä¸‰ã€çº¿ç¨‹æ¨¡å‹åŸç†WebRTCçš„çº¿ç¨‹åŠŸèƒ½ç”±Threadç±»æä¾›ã€‚Threadç»§æ‰¿äºæ¶ˆæ¯é˜Ÿåˆ—MessageQueueï¼Œè¿™æ ·WebRTCä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰äº†è‡ªå·±çš„æ¶ˆæ¯å¾ªç¯ï¼Œå¤–éƒ¨å¯ä»¥å‘è¯¥çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯Postæ¶ˆæ¯Messageï¼Œç„¶åè¯¥çº¿ç¨‹è½®è¯¢ä»æ¶ˆæ¯å¾ªç¯Getåˆ°æ¶ˆæ¯åå¤„ç†æ¶ˆæ¯ã€‚ UMLå¦‚ä¸‹ï¼š å››ã€Messageå’ŒMessageQueueMessageç”¨äºå®šä¹‰å•ä¸ªæ¶ˆæ¯ï¼š posted_fromæ ‡è®°æ”¹æ¡æ¶ˆæ¯å‘é€è‡ªå“ªä¸ªå‡½æ•°ï¼Œä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ç”¨RTC_FROM_HEREå®æ¥èµ‹å€¼ï¼› message_id32ä½æ•´æ•°ï¼Œæ¶ˆæ¯IDï¼› pdataæ¶ˆæ¯æºå¸¦çš„æ•°æ®æŒ‡é’ˆï¼Œè™½ç„¶å®šä¹‰MessageData*ç±»å‹ï¼Œä½†ä¹Ÿå¯ä»¥ç­‰åŒäºvoid*ã€‚ ts_sensitiveæ¶ˆæ¯çš„æ•æ„Ÿæ—¶é—´ç‚¹ã€‚åœ¨ä½¿ç”¨MessageQueue::Postç­‰æ–¹æ³•å‘é€æ¶ˆæ¯æ—¶ï¼Œè‹¥time_sensitive == trueåˆ™è®¾ç½®ts_sensitive = TimeMillis() + kMaxMsgLatency å³å½“å‰æ—¶é—´ + æœ€å¤§æ¶ˆæ¯å»¶è¿Ÿæ—¶é—´ã€‚å½“æ¶ˆæ¯è¢«ä»é˜Ÿåˆ—ä¸­å–å‡ºçš„æ—¶é—´å¤§äºè¯¥æ—¶é—´ï¼Œåˆ™ä¼šæ‰“å°è­¦å‘Šæ—¥å¿—ã€‚ phandleræ¶ˆæ¯å¤„ç†å™¨ï¼ŒMessageHandleræ¥å£çš„æŒ‡é’ˆã€‚ç”¨æˆ·éœ€è¦ç»§æ‰¿è¯¥ç±»ï¼Œå¹¶é‡å†™å…¶OnMessageè™šå‡½æ•°ã€‚ MessageQueueå®ç°äº†WebRTCä¸­æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œå¦‚Postæ–¹æ³•ç”¨äºæ·»åŠ æ¶ˆæ¯ï¼›Getæ–¹æ³•ç”¨äºä»é˜Ÿåˆ—å–å‡ºæ¶ˆæ¯ï¼Œè‹¥é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯åˆ™ä¸€ç›´ç­‰å¾…ï¼Œå…·ä½“çš„ç­‰å¾…å’Œå”¤é†’çš„æ–¹å¼é€šè¿‡SocketServerçš„Waitå’ŒWakeUpæ¥å®ç°ã€‚ SocketServeræ˜¯ä¸€ä¸ªçº¯æŠ½è±¡ç±»ï¼ŒNullSocketServerå’ŒPhysicalSocketServeréƒ½æ´¾ç”Ÿè‡ªè¯¥ç±»ã€‚NullSocketServeræ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰åˆ›å»ºSOCKETï¼Œåªå¤„ç†æœ¬åœ°äº‹ä»¶ï¼ˆCreateEventç³»åˆ—å‡½æ•°ï¼‰ï¼›PhysicalSocketServerä¼šåˆ›å»ºSOCKETï¼Œå¹¶å¯ä»¥å¤„ç†ç½‘ç»œäº‹ä»¶ï¼ˆWSACreateEventç³»åˆ—å‡½æ•°ï¼‰ã€‚åœ¨å•çº¯çš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼ŒSocketServeråªç”¨äºå¤„ç†ç­‰å¾…å’Œå”¤é†’æ“ä½œã€‚ äº”ã€ ThreadThreadç±»æä¾›äº†2ä¸ªé™æ€å‡½æ•°ï¼ˆCreate, CreateWithSocketServerï¼‰æ¥æ„é€ Threadå®ä¾‹ã€‚ ä¸å»ºè®®ä½¿ç”¨new Thread()è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°çš„æ–¹å¼ï¼Œä»£ç æ³¨é‡Šä¸­å·²ç»ç»™å‡ºäº†è§£é‡Šï¼š 123456// DEPRECATED.// The default constructor should not be used because it hides whether or// not a socket server will be associated with the thread. Most instances// of Thread do actually not need one, so please use either of the Create*// methods to construct an instance of Thread.Thread(); ä¸‹é¢æ˜¯Threadç±»æ„é€ çš„å¤§è‡´è¿‡ç¨‹ï¼š 12345678910111213+-----------------------------+| || new Thread(SocketServer*) || |+---+-------------------------+ | | | +-----------------------------------+ | | | +---------&gt; new MessageQueue(SocketServer*) | | | +-----------------------------------+ æ„é€ å®ŒThreadå®ä¾‹ä¹‹åï¼Œè°ƒç”¨Startæ¥å¯åŠ¨çº¿ç¨‹ï¼Œæ¡†æ¶ä¼šæ ¹æ®Startå‡½æ•°çš„Runnableå‚æ•°æ˜¯å¦ä¸ºNULLæ¥åˆ¤æ–­æ˜¯éœ€è¦è¿è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„Runnable-&gt;Run(), è¿˜æ˜¯è¿è¡Œé»˜è®¤ProcessMessageå»å¾ªç¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯æ¥å¤„ç†ã€‚ è‹¥è¿è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„Runnable-&gt;Run()ï¼Œåˆ™ç”¨æˆ·éœ€è¦ç»§æ‰¿rtc::Runnableå»é‡è½½Run()ï¼› è‹¥è¿è¡Œé»˜è®¤çš„ProcessMessageï¼Œåˆ™ç”¨æˆ·åˆ™éœ€è¦å®šä¹‰Messageï¼Œå‘çº¿ç¨‹ä¸­Postè¯¥Messageï¼Œè®©çº¿ç¨‹æ¥æ‰§è¡Œã€‚ æµç¨‹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738+---------------------------+| || Thread-&gt;Start(Runnable*) || |+-+-------------------------+ | | +-------------------------+ | | | +-------&gt; CreateThrad(PreRun) | | | +-------------------------+ |Runnable* is NULL? | | +------------------+ | | | +-----------&gt; Runnable-&gt;Run() | | | | | +------------------+ | | | +------------------+ | | | +-----------&gt; Thread-&gt;Run() | | | +-+----------------+ | | | +--------------------------+ | | | +----&gt; Thread-&gt;ProcessMessage() | | | +--+-----------------------+ | | +--------------------------------+ | | | +-----&gt; Loop call MessageQueue-&gt;Get() | | | +--------------------------------+ å…­ã€ ç¤ºä¾‹6.1 å®ç°Runnbale1234567891011121314151617181920212223#include &quot;rtc_base/thread.h&quot;class MyTask : public rtc::Runnable &#123;public: MyTask(const std::string &amp;name) : name_(name) &#123; &#125;protected: void Run(Thread* thread) &#123; std::cout &lt;&lt; &quot;task name: &quot; &lt;&lt; name_ &lt;&lt; std::endl; std::cout &lt;&lt; &quot;my thread id: &quot; &lt;&lt; thread-&gt;GetId() &lt;&lt; std::endl; &#125;private: std::string name_;&#125;;int main()&#123; std::unique_ptr&lt;rtc::Thread&gt; thread = rtc::Thread::Create(); thread-&gt;Start(new MyTask(&quot;task1&quot;)); getchar(); return 0;&#125; 6.2 å‘é€Message123456789101112131415161718192021222324class MyTaskHandler : public rtc::MessageHandler &#123;public: MyTaskHandler(const std::string &amp;name) : name_(name) &#123; &#125;protected: void OnMessage(Message* msg) &#123; std::cout &lt;&lt; &quot;task name: &quot; &lt;&lt; name_ &lt;&lt; std::endl; std::cout &lt;&lt; &quot;my thread id: &quot; &lt;&lt; Thread::Current()-&gt;GetId() &lt;&lt; std::endl; &#125;private: std::string name_;&#125;;int main()&#123; std::unique_ptr&lt;rtc::Thread&gt; thread = rtc::Thread::Create(); thread-&gt;Start(nullptr); thread-&gt;Post(RTC_FROM_HERE, new MyTaskHandler(&quot;task2&quot;), 0, nullptr, false); getchar(); return 0;&#125;","tags":["WebRTC","çº¿ç¨‹"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"Janusçš„ç¼–è¯‘éƒ¨ç½²åŠé…ç½®","path":"/post/3773107387.html","content":"Janusæ˜¯ä¸€ä¸ªå¼€æºçš„ WebRTC SFU æœåŠ¡å™¨ï¼Œå¯ä»¥ä½œä¸º WebRTC çš„ä¸€ä¸ªç«¯å°†å…¶æ”¶åˆ°çš„æ•°æ®è¿›è¡Œè½¬å‘ï¼ŒåŒæ—¶æä¾›äº†ä¸€äº›çš„æ§åˆ¶èƒ½åŠ›ã€‚Janus æ˜¯åŸºäºæ’ä»¶æ¶æ„çš„ï¼Œå…¶åŠŸèƒ½éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªä¸ªæ’ä»¶æ¥æä¾›ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º Janus å¼€å‘æ’ä»¶ï¼Œæ¥æ‰©å±•å…¶åŠŸèƒ½ã€‚ ä¸€ã€ç¼–è¯‘éƒ¨ç½²Janus å¯ä»¥æ–¹ä¾¿çš„åœ¨ Linux å’Œ MacOS ä¸Šé¢ç¼–è¯‘éƒ¨ç½²ï¼Œæš‚æ—¶ä¸æ”¯æŒ Windows ç³»ç»Ÿï¼Œä½†å¯ä»¥åœ¨ Win10 çš„Windows Subsystem for Linuxä¸Šç¼–è¯‘éƒ¨ç½²ã€‚ 1.1 å®‰è£…ä¾èµ–é¡¹åœ¨ç¼–è¯‘ Janus ä¹‹å‰ï¼Œéœ€è¦å®‰è£…å¦‚ä¸‹ä¾èµ–é¡¹ï¼š Jansson libconfig libnice (at least v0.1.15 suggested, master recommended) OpenSSL (at least v1.0.1e) libsrtp (at least v1.5 suggested) usrsctp (only needed if you are interested in Data Channels) libmicrohttpd (only needed if you are interested in REST support for the Janus API) libwebsockets (only needed if you are interested in WebSockets support for the Janus API) cmake (only needed if you are interested in WebSockets and&#x2F;or BoringSSL support, as they make use of it) rabbitmq-c (only needed if you are interested in RabbitMQ support for the Janus API or events) paho.mqtt.c (only needed if you are interested in MQTT support for the Janus API or events) nanomsg (only needed if you are interested in Nanomsg support for the Janus API) libcurl (only needed if you are interested in the TURN REST API support) Janus çš„æŸäº›æ’ä»¶å¯èƒ½è¿˜ä¾èµ–ä¸‹é¢çš„åº“ï¼š Sofia-SIP (only needed for the SIP plugin) libopus (only needed for the bridge plugin) libogg (needed for the voicemail plugin and&#x2F;or post-processor) libcurl (only needed if you are interested in RTSP support in the Streaming plugin or in the sample Event Handler plugin) Lua (only needed for the Lua plugin) å¦å¤–ï¼Œè¿˜éœ€è¦å®‰è£…å¦‚ä¸‹å·¥å…·ï¼š GLib pkg-config gengetopt ä¸Šé¢çš„æ‰€æœ‰åº“é€šå¸¸åœ¨å¤šæ•° Linux å‘è¡Œç‰ˆä¸­éƒ½æœ‰æä¾›ï¼Œå¯ä»¥ç›´æ¥å®‰è£…ã€‚ä»¥åœ¨Fedoraä¸­å®‰è£…ä¸ºä¾‹ï¼š 1234yum install libmicrohttpd-devel jansson-devel \\ openssl-devel libsrtp-devel sofia-sip-devel glib2-devel \\ opus-devel libogg-devel libcurl-devel pkgconfig gengetopt \\ libconfig-devel libtool autoconf automake éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ å°è¯•åœ¨CentOSä¸Šé¢å®‰è£…è¿™äº›ä¾èµ–é¡¹ï¼Œéœ€è¦å…ˆæ‰§è¡Œyum install epel-release . åœ¨Ubuntuå’ŒDebianç³»ç»Ÿä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1234aptitude install libmicrohttpd-dev libjansson-dev \\ libssl-dev libsrtp-dev libsofia-sip-ua-dev libglib2.0-dev \\ libopus-dev libogg-dev libcurl4-openssl-dev liblua5.3-dev \\ libconfig-dev pkg-config gengetopt libtool automake åœ¨ä½ç‰ˆæœ¬çš„ç³»ç»Ÿä¸Š(å¦‚ä½äºUbuntu 14.04 LTSç‰ˆæœ¬)ï¼Œå¯èƒ½æ²¡æœ‰æä¾›çš„libopusçš„é¢„ç¼–è¯‘åŒ…ï¼Œå¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼Œéœ€è¦æ‰‹åŠ¨ç¼–è¯‘opus. 1.1.1 libnicelibniceè™½ç„¶åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šéƒ½æä¾›äº†é¢„ç¼–è¯‘åŒ…ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥å»ºè®®å…ˆå¸è½½è€ç‰ˆæœ¬ï¼Œç„¶åä¸‹è½½ libnice çš„masterçš„ç‰ˆæœ¬ï¼Œæ‰‹åŠ¨ç¼–è¯‘ï¼š 12345git clone https://gitlab.freedesktop.org/libnice/libnicecd libnice./autogen.sh./configure --prefix=/usrmake &amp;&amp; sudo make install ç¡®ä¿å·²ç»ç§»é™¤è€ç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†²çªã€‚å¦‚æœéœ€è¦ä¿ç•™å¤šä¸ªç‰ˆæœ¬çš„ libniceï¼Œå¯ä»¥æ‰§è¡Œpkg-config --cflags --libs niceç¡®ä¿ Janus å¯ä»¥æ‰¾åˆ°æ­£ç¡®çš„ç‰ˆæœ¬ï¼Œå¦‚æœæ— æ³•æ‰¾åˆ°ï¼Œå¯ä»¥åœ¨ç¼–è¯‘ Janus ä¹‹å‰è®¾ç½®PKG_CONFIG_PATHç¯å¢ƒå˜é‡ï¼Œå¦‚export PKG_CONFIG_PATH=/path/to/libnice/lib/pkgconfig 1.1.2 libcurlå¦‚æœåæœŸéœ€è¦ç¼–è¯‘å®‰è£… Janus çš„Event Handleræ’ä»¶ï¼Œè¿˜éœ€è¦å®‰è£… libcurl åº“çš„å¼€å‘ç‰ˆæœ¬ï¼Œåœ¨ Fedora&#x2F;CentOS ä¸Šé€šå¸¸ä¸ºlibcurl-develï¼Œåœ¨ Ubuntu&#x2F;Debian ä¸Šé€šå¸¸ä¸ºlibcurl4-openssl-devã€‚ 1.1.3 libsrtpå‡å¦‚å·²ç»å®‰è£…äº†libsrtp 1.5 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œéœ€è¦å…ˆå¸è½½ï¼Œç„¶åæ‰‹åŠ¨å®‰è£…1.5x æˆ– 1.6xç‰ˆæœ¬ã€‚å› ä¸º 1.4x ç‰ˆæœ¬ä¼šå¯¼è‡´ WebRTC å‡ºç°ä¸€äº›é—®é¢˜ã€‚ä»¥å®‰è£…2.2.0ç‰ˆæœ¬ä¸ºä¾‹ï¼š 12345wget https://github.com/cisco/libsrtp/archive/v2.2.0.tar.gztar xfv v2.2.0.tar.gzcd libsrtp-2.2.0./configure --prefix=/usr --enable-opensslmake shared_library &amp;&amp; sudo make install Janus çš„ configure è„šæœ¬å¯ä»¥è‡ªåŠ¨æ£€æµ‹åˆ°ä½¿ç”¨çš„ libsrtp çš„ç‰ˆæœ¬ï¼Œå¦‚æœåŒæ—¶å®‰è£…äº† 1.5x å’Œ 2.x ç‰ˆæœ¬ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ 2.x ç‰ˆæœ¬ï¼Œå¦‚æœæƒ³å¼ºåˆ¶ä½¿ç”¨ 1.5 æˆ–è€… 1.6 ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ configure å‘½ä»¤ä¼ å…¥--disable-libsrtp2 å‚æ•°ã€‚ å‡å¦‚å®‰è£…çš„æ˜¯ x86&#x2F;x64 ç‰ˆæœ¬çš„ libsrtpï¼Œéœ€è¦åœ¨ configure å‘½ä»¤ä¼ å…¥--libdir=/usr/lib64å‚æ•°ã€‚ 1.1.4 BoringSSLå¦‚æœéœ€è¦ä½¿ç”¨BoringSSLä»£æ›¿OpenSSL ï¼ˆå› ä¸ºä½¿ç”¨BoringSSLå¯ä»¥ä½¿ç”¨--enable-dtls-settimeoutåŠŸèƒ½ï¼‰ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ‰‹åŠ¨å®‰è£…ï¼Œå¹¶ä¸”åœ¨ configure å‘½ä»¤ä¼ å…¥--enable-boringsslå‚æ•°ï¼š 12345678910111213141516git clone https://boringssl.googlesource.com/boringsslcd boringssl# Don&#x27;t barf on errorssed -i s/&quot; -Werror&quot;//g CMakeLists.txt# Buildmkdir -p buildcd buildcmake -DCMAKE_CXX_FLAGS=&quot;-lrt&quot; ..makecd ..# Installsudo mkdir -p /opt/boringsslsudo cp -R include /opt/boringssl/sudo mkdir -p /opt/boringssl/libsudo cp build/ssl/libssl.a /opt/boringssl/lib/sudo cp build/crypto/libcrypto.a /opt/boringssl/lib/ Janus é»˜è®¤ BoringSSL å®‰è£…åœ¨/opt/boringsslï¼Œå¦‚æœä¸æ˜¯ï¼Œå¯ä»¥é€šè¿‡--enable-boringssl=/path/to/boringsslæŒ‡å®šã€‚ 1.1.5 usrcstp1234git clone https://github.com/sctplab/ccd usrsctp./bootstrap./configure --prefix=/usr &amp;&amp; make &amp;&amp; sudo make install Note: å‡å¦‚å®‰è£…çš„æ˜¯ x8&#x2F;x64 ç‰ˆæœ¬çš„ usrcstpï¼Œéœ€è¦åœ¨ configure å‘½ä»¤ä¼ å…¥ --libdir=/usr/lib64 å‚æ•°ã€‚ 1.1.6å¦‚æœéœ€è¦æä¾› websockets ä¿¡ä»¤æ”¯æŒï¼Œè¿˜éœ€è¦å®‰è£… libwebsockets åº“ï¼š 123456789git clone https://libwebsockets.org/repo/libwebsocketscd libwebsockets# If you want the stable version of libwebsockets, uncomment the next line# git checkout v2.4-stablemkdir buildcd build# See https://github.com/meetecho/janus-gateway/issues/732 re: LWS_MAX_SMPcmake -DLWS_MAX_SMP=1 -DCMAKE_INSTALL_PREFIX:PATH=/usr -DCMAKE_C_FLAGS=&quot;-fpic&quot; ..make &amp;&amp; sudo make install å‡å¦‚ libwebsockets.org æ— æ³•è®¿é—®, å¯ä»¥å°†ç¬¬ä¸€è¡Œæ›¿æ¢ä¸º:git clone https://github.com/warmcat/libwebsockets.git 1.1.7 æ–‡æ¡£å¦‚æœéœ€è¦ç¼–è¯‘ Janus æ–‡æ¡£ï¼Œéœ€è¦å®‰è£…å¦‚ä¸‹å·¥å…·ï¼š Doxygen Graphviz Fedora: 1yum install doxygen graphviz Ubuntu&#x2F;Debian: 1aptitude install doxygen graphviz äºŒã€ç¼–è¯‘åœ¨å®‰è£…å®Œä¾èµ–é¡¹ä¹‹åï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤è·å– Janus ä»£ç ï¼š 1234- [ ] git clone https://github.com/meetecho/janus-gateway.git cd janus-gateway ç„¶åä½¿ç”¨sh autogen.shå‘½ä»¤ç”Ÿæˆ configure æ–‡ä»¶ã€‚æœ€åï¼Œæ‰§è¡Œ configure å’Œç¼–è¯‘å‘½ä»¤å¼€å§‹ç¼–è¯‘ï¼š 123./configure --prefix=/opt/janus --enable-boringsslmakemake install ç¼–è¯‘å®Œæˆä¹‹åï¼Œä½¿ç”¨make configså‘½ä»¤ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä½äº/opt/janus/etc/janus/janus.jcfgã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡æ‰§è¡Œmake configså‘½ä»¤éƒ½ä¼šå°†/opt/janus/etc/janus/janus.jcfgæ–‡ä»¶è¿˜åŸä¸ºé»˜è®¤é…ç½®ã€‚ ä¸‰ã€è¿è¡Œã€æµ‹è¯•æˆ‘ä»¬å¯ä»¥å…ˆä¸ä¿®æ”¹ä»»ä½•é…ç½®ï¼Œå°† Janus è¿è¡Œèµ·æ¥ï¼Œç„¶åä½¿ç”¨æµ‹è¯• htmlï¼Œæµ‹è¯•ä¸€ä¸‹æ•ˆæœã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿è¡Œ Janusï¼š 1/opt/janus/bin/janus Janus å¯åŠ¨å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¦å¯»ä¸€å°å®¢æˆ·æœºï¼Œå°† Janus æºç ä¸‹è½½ä¸‹æ¥ï¼Œä¿®æ”¹janus-gateway\\html\\echotest.jsæ–‡ä»¶ä¸­serverå˜é‡ä¸ºï¼š&quot;ws://47.93.47.150:8188&quot;ï¼Œå¦‚ï¼š 1234567var server = null;if(window.location.protocol === &#x27;http:&#x27;) server = &quot;http://&quot; + window.location.hostname + &quot;:8088/janus&quot;;else server = &quot;https://&quot; + window.location.hostname + &quot;:8089/janus&quot;;server = &quot;ws://47.93.47.150:8188&quot;; åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€echotest.htmlï¼Œç‚¹å‡»â€œStartâ€å³å¯çœ‹åˆ°æ•ˆæœã€‚ å¦‚æœæ— æ³•è¿æ¥æˆåŠŸï¼Œå¯èƒ½æ˜¯å› ä¸ºiceServersé»˜è®¤ä½¿ç”¨çš„æ˜¯ google çš„ turn æœåŠ¡å™¨ï¼Œå›½å†…æ— æ³•è®¿é—®å¯¼è‡´ï¼Œå¯ä»¥å‚è€ƒ å¦‚ä½•æ­å»ºWebRTCçš„TURNæœåŠ¡å™¨ æ­å»ºè‡ªå·±çš„ TURN æœåŠ¡å™¨ã€‚","tags":["WebRTC","Janus"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"WebRTCæ·»åŠ é€‰æ‹©éŸ³é¢‘è¾“å…¥è¾“å‡ºè®¾å¤‡åŠŸèƒ½","path":"/post/2143630083.html","content":"æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ WebRTC ä¸­æä¾›éŸ³é¢‘è®¾å¤‡è¾“å…¥è¾“å‡ºåŠŸèƒ½çš„ç±»ç»“æ„ï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼š AudioDeviceModuleæ¥å£ç±»æ˜¯éŸ³é¢‘è®¾å¤‡æ¨¡å‹çš„åŸºç±»ï¼Œè¯¥æ¥å£ç±»åŠå…¶å­ç±»å¹¶ä¸æä¾›ä»»ä½•é’ˆå¯¹éŸ³é¢‘çš„å®é™…æ“ä½œï¼Œå®é™…æ“ä½œéƒ½æ˜¯ç”±AudioDeviceGenericæ¥å£ç±»çš„å­ç±»æ¥æä¾›ã€‚ AudioDeviceGenericæ¥å£ç±»æ˜¯éŸ³é¢‘è®¾å¤‡å®é™…æ“ä½œï¼ˆå¦‚å½•éŸ³ã€æ’­æ”¾ã€å£°éŸ³æ§åˆ¶ç­‰ï¼‰çš„åŸºç±»ï¼Œç„¶åæ ¹æ®å¹³å°ä¸åŒç”±ä¸åŒçš„ç±»æ¥å®ç°å…·ä½“æ“ä½œï¼Œå¦‚ windows å¹³å°ç”±AudioDeviceWindowsCoreæ¥è´Ÿè´£å®ç°ã€‚ é€šè¿‡ä»£ç è¿½è¸ªï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° WebRTC é»˜è®¤ä½¿ç”¨çš„æ˜¯è®¡ç®—æœºä¸Šçš„ç³»ç»Ÿé»˜è®¤éŸ³é¢‘è¾“å…¥è¾“å‡ºè®¾å¤‡ï¼Œä»¥åŠé»˜è®¤çš„è§†é¢‘é‡‡é›†è®¾å¤‡ï¼Œè¿™äº›æˆ‘ä»¬é€šè¿‡adm_helpers.cc::Initå‡½æ•°æ¥éªŒè¯ï¼ˆç¬”è€…è¿™é‡Œä½¿ç”¨çš„æ˜¯m77åˆ†æ”¯ï¼‰ï¼š 123456789if (adm-&gt;SetPlayoutDevice(AUDIO_DEVICE_ID) != 0) &#123; RTC_LOG(LS_ERROR) &lt;&lt; &quot;Unable to set playout device.&quot;; return;&#125;if (adm-&gt;SetRecordingDevice(AUDIO_DEVICE_ID) != 0) &#123; RTC_LOG(LS_ERROR) &lt;&lt; &quot;Unable to set recording device.&quot;; return;&#125; æ‰€ä»¥å³ä¾¿æˆ‘ä»¬è°ƒç”¨äº†SetPlayoutDeviceå’ŒSetRecordingDeviceä¹Ÿæ— æµäºäº‹ï¼Œå› ä¸ºåœ¨æ­¤å¤„ä»ç„¶ä¼šè¢«è¦†ç›–ä¸ºä½¿ç”¨é»˜è®¤è®¾å¤‡ã€‚å› æ­¤æˆ‘ä»¬åªéœ€è¦é’ˆå¯¹æ­¤å¤„è¿›è¡Œä¿®æ”¹å³å¯ï¼Œå¦‚ï¼š 12345678910111213141516171819202122uint16_t playout_index = 0;// å…ˆè·å–è®¾å¤‡indexï¼Œå¦‚æœèƒ½å¤Ÿè·å–åˆ°ï¼Œè¡¨ç¤ºå¤–éƒ¨å·²ç»è®¾å¤‡è®¾å¤‡indexï¼Œæ”¾å¼ƒä½¿ç”¨é»˜è®¤è®¾å¤‡// AudioDeviceModuleæ²¡æœ‰æä¾›Getæ¥å£ï¼Œéœ€è¦è‡ªå·±æ·»åŠ //if (adm-&gt;GetPlayoutDevice(&amp;playout_index) == 0) &#123; RTC_LOG(LS_INFO) &lt;&lt; &quot;Playout device index: &quot; &lt;&lt; playout_index;&#125; else &#123; if (adm-&gt;SetPlayoutDevice(AUDIO_DEVICE_ID) != 0) &#123; RTC_LOG(LS_ERROR) &lt;&lt; &quot;Unable to set playout device.&quot;; return; &#125;&#125;uint16_t recording_index = 0;if (adm-&gt;GetRecordingDevice(&amp;recording_index) == 0) &#123; RTC_LOG(LS_INFO) &lt;&lt; &quot;Recording device index: &quot; &lt;&lt; recording_index;&#125; else &#123; if (adm-&gt;SetRecordingDevice(AUDIO_DEVICE_ID) != 0) &#123; RTC_LOG(LS_ERROR) &lt;&lt; &quot;Unable to set recording device.&quot;; return; &#125;&#125; ç»†å¿ƒçš„è¯»è€…å¯èƒ½å‘ç°ï¼ŒAudioDeviceModuleæ¥å£ç±»åªå®šä¹‰äº† Playout&#x2F;Recoding è®¾å¤‡çš„Setæ¥å£ï¼Œä½†æ²¡æœ‰æä¾›Getæ¥å£ï¼Œå› ä¸º WebRTC é»˜è®¤ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿè®¾å¤‡ï¼Œæ‰€ä»¥å¤–ç•Œä¸éœ€è¦çŸ¥é“å…·ä½“è®¾å¤‡ indexï¼Œæ•…æ²¡æœ‰æä¾›ï¼ˆç¬”è€…ä½¿ç”¨çš„æ˜¯ webrtc m77åˆ†æ”¯ï¼Œä¹Ÿè®¸ webrtc çš„åç»­ç‰ˆæœ¬ä¼šåŠ å…¥è¯¥æ¥å£ï¼‰ã€‚æˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨ AudioDeviceModule ä¸­åŠ å…¥Getæ¥å£ã€‚ ä¸Šé¢çš„ä¸€åˆ‡ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ª admï¼Œä½œä¸ºå‚æ•°ä¼ å…¥åˆ°webrtc::CreatePeerConnectionFactoryå‡½æ•°å³å¯ï¼š 12345678910111213141516171819m_adm = webrtc::AudioDeviceModule::Create( webrtc::AudioDeviceModule::kPlatformDefaultAudio, webrtc::CreateDefaultTaskQueueFactory().get());int32_t ret = m_adm-&gt;Init();Q_ASSERT(ret == 0);if (m_connParameter.audioInputDeviceIndex == -1) &#123; m_adm-&gt;SetEnableRecording(false);&#125; else &#123; ret = m_adm-&gt;SetRecordingDevice(m_connParameter.audioInputDeviceIndex); Q_ASSERT(ret == 0);&#125;if (m_connParameter.audioOutputDeviceIndex == -1) &#123; m_adm-&gt;SetEnablePlayout(false);&#125; else &#123; ret = m_adm-&gt;SetPlayoutDevice(m_connParameter.audioOutputDeviceIndex); Q_ASSERT(ret == 0);&#125;","tags":["WebRTC"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"WebRTCåœ¨ç›´æ’­é¢†åŸŸåº”ç”¨çš„å¯è¡Œæ€§åˆ†æ","path":"/post/2016855525.html","content":"ä¸€ã€ç›®å‰æµè¡Œçš„ç›´æ’­æŠ€æœ¯æ¶æ„ç›®å‰ä¸»æµçš„ç›´æ’­æ–¹æ¡ˆä¸€èˆ¬é‡‡ç”¨RTMPæ¶æ„ï¼Œé¦–å…ˆå®¢æˆ·ç«¯é‡‡é›†éŸ³è§†é¢‘æµï¼ˆå¦‚obs studioå®¢æˆ·ç«¯ï¼‰ï¼Œç„¶åé€šè¿‡ RTMP åè®®å°†æµæ¨åˆ°æµåª’ä½“æœåŠ¡å™¨ï¼Œæœ€åæµåª’ä½“æœåŠ¡å™¨å°†æµå¤„ç†ååˆ†å‘ç»™å„ä¸ªç›´æ’­å®¢æˆ·ç«¯ã€‚ ä¼˜ç‚¹ï¼šè‰¯å¥½çš„ CDN æ”¯æŒï¼Œç›®å‰ä¸»æµçš„ CDN å‚å•†éƒ½æœ‰æ¯”è¾ƒæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå¦å¤–ä¹Ÿæœ‰å¯ç”¨çš„å•†ç”¨ SDK æ–¹ä¾¿é›†æˆï¼Œä¾‹å¦‚å£°ç½‘ç­‰ï¼Œåªè¦é›†æˆå¯¹åº”å¹³å°çš„ SDK å³å¯ã€‚ç”±äºæœ‰ CDN çš„æ”¯æŒï¼Œç›¸è¾ƒäºç«¯å¯¹ç«¯çš„ webrtc æ–¹å¼ï¼Œå…¶å¹¶å‘åº¦é«˜ï¼Œé€‚åˆå¤šäººç›´æ’­åœºæ™¯ã€‚ ç¼ºç‚¹ï¼š ç”±äº RTMP åè®®åŸºäºæ˜¯ TCP çš„ï¼Œç›¸å¯¹äºåŸºäº UDP åè®®çš„ WebRTC æ–¹å¼å»¶æ—¶è¾ƒå¤§ï¼Œæ‰€ä»¥å¯¹äºæŸäº›ä½å»¶æ—¶åœºæ™¯ä½“éªŒè¾ƒå·®ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç°åœ¨ç›´æ’­åº”ç”¨ä¸­åªèƒ½é€šè¿‡å¼¹å¹•çš„æ–¹å¼ä¸ä¸»æ’­äº’åŠ¨ï¼Œä¸èƒ½å®æ—¶è¿éº¦äº’åŠ¨äº†ï¼Œå› ä¸ºå»¶è¿Ÿå¤ªå¤§ï¼Œä½“éªŒå¤ªå·®ã€‚ æµè§ˆå™¨æ²¡æœ‰é›†æˆå¯¹ RTMP åè®®çš„æ”¯æŒï¼Œæ‰€ä»¥ä¸æ”¯æŒæµè§ˆå™¨æ¨æµç­‰ï¼Œéœ€è¦ä¸»æ’­ç«¯å®‰è£…ç‰¹å®šçš„å®¢æˆ·ç«¯è½¯ä»¶ã€‚ äºŒã€åŸºäºç«¯å¯¹ç«¯çš„ WebRTC ç›´æ’­æ–¹æ¡ˆä¸¥æ ¼çš„è®²ï¼ŒåŸºäºç«¯å¯¹ç«¯çš„ WebRTC ç›´æ’­æ–¹å¼ä¸å±äº WebRTC å¸¸è§„åº”ç”¨åœºæ™¯ï¼ŒWebRTC è®¾è®¡ä¹‹åˆæ˜¯ç”¨æ¥è¿›è¡Œå¤šäººå®æ—¶é€šä¿¡çš„ï¼Œæ‰€ä»¥ WebRTC ä»£ç ä¸­é›†æˆäº†å¾ˆå¤šè¯­éŸ³æ–¹é¢çš„ç®—æ³•ï¼Œå¦‚äººå£°æ£€æµ‹ç­‰ã€‚è‹¥å°† WebRTC åº”ç”¨åœ¨ç›´æ’­æ–¹æ¡ˆä¸­ï¼Œåˆ™ä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¼˜ç‚¹ï¼š å•çº¯ä½¿ç”¨ Javascript åœ¨ Web ç«¯å³å¯å®ç°æ¨æµï¼Œè¿™å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œç®€åŒ–äº†éŸ³è§†é¢‘é€šä¿¡çš„å¼€å‘å·¥ä½œï¼Œé™ä½äº†é—¨æ§›ä½ï¼Œä¸å¿…ç†Ÿæ‚‰æµåª’ä½“ç­‰æŠ€æœ¯ç»†èŠ‚ï¼›å¯¹äºä¸»æ’­æ¥è¯´ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘é¡µå³å¯è¿›è¡Œç›´æ’­ï¼Œæ–¹ä¾¿å¿«æ·ã€‚ å¦‚æœç‚¹å¯¹ç‚¹è¿æ¥æˆåŠŸå°±å¯ä»¥ä¸é€šè¿‡æœåŠ¡å™¨ä¸­è½¬ï¼Œå¯ä»¥èŠ‚çœæœåŠ¡å™¨å¸¦å®½è´¹ç”¨ã€‚ ç›¸å¯¹äºåŸºäº TCP çš„ RTMP æ¨æ‹‰æµæ–¹å¼ï¼ŒåŸºäº UDP çš„ webrtc æ–¹å¼å»¶æ—¶æ›´ä½ã€‚ ç¼ºç‚¹ï¼š PC ç«¯æµè§ˆå™¨çš„æ€§èƒ½æœ‰å±€é™ï¼Œå¦‚æœæ˜¯ 1v1 æ–¹å¼çš„ç›´æ’­è¿éº¦ï¼Œæµè§ˆå™¨å°šèƒ½æ”¯æ’‘ï¼›å¦‚æœåŒæ—¶è¿›è¡Œå¤šäººç›´æ’­è¿éº¦ï¼Œåˆ™æµè§ˆå™¨éœ€è¦åŒæ—¶ç»™å¤šäººæ¨æµï¼Œè¿™å¯¹äºæµè§ˆå™¨æ¥è¯´æéš¾æ”¯æ’‘ã€‚ è™½ç„¶ç›®å‰æµè§ˆå™¨æä¾›çš„ WebRTC Javascript API è¶Šæ¥è¶Šå¤šï¼Œä½†ä¸€æ—¦ç°æœ‰ API æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œåˆ™å•çº¯çš„ä¾é  JavaScript æéš¾ä¸ºåŠ›ï¼ˆå¯ä»¥ä¿®æ”¹ WebRTC C++æºç ï¼Œå¦å¤–å¼€å‘æµè§ˆå™¨å®¢æˆ·ç«¯æä¾› Javascript æ¥å£ï¼Œä½†è¿™å°±å¤±å»äº†ä¸»æµæµè§ˆå™¨æ”¯æŒ WebRTC çš„å¤©ç„¶ä¼˜åŠ¿ï¼‰ã€‚ éŸ³è§†é¢‘çš„ä¼ è¾“è´¨é‡éš¾ä»¥ä¿éšœï¼Œå°¤å…¶åœ¨è·¨åœ°åŒºã€è·¨è¿è¥å•†çš„æƒ…å†µä¸‹ï¼Œå³ä¾¿å¯ä»¥ç«¯å¯¹ç«¯è¿æ¥æˆåŠŸï¼Œä½†è´¨é‡ä¹Ÿéš¾ä¿éšœã€‚ ç”±äºç«¯å¯¹ç«¯è¿æ¥æ²¡æœ‰ç»è¿‡æœåŠ¡å™¨ï¼Œæ‰€ä»¥æ— æ³•åœ¨æœåŠ¡å™¨ç«¯å¯¹ç›´æ’­æµè¿›è¡Œå®¡å½•åˆ¶å›æ”¾ç­‰ã€‚ ä¸‰ã€åŸºäºæœåŠ¡å™¨è½¬å‘çš„ WebRTC ç›´æ’­æ–¹æ¡ˆåŸºäºç«¯å¯¹ç«¯çš„ WebRTC ç›´æ’­æ–¹å¼å—é™äºæµè§ˆå™¨æ€§èƒ½ã€è¿æ¥äººæ•°ç­‰é™åˆ¶ï¼Œå¾ˆéš¾é€‚ç”¨äºç›´æ’­åœºæ™¯ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œä»è€Œå¼•å…¥åª’ä½“æœåŠ¡å™¨ï¼Œä¸»æ’­å®¢æˆ·ç«¯ä»…ä¼ è¾“ä¸€è·¯éŸ³è§†é¢‘æµåˆ°åª’ä½“æœåŠ¡å™¨ï¼Œå…¶ä½™å®¢æˆ·ç«¯é€šè¿‡ä¸åª’ä½“æœåŠ¡å™¨å»ºç«‹è¿æ¥è·å–éŸ³è§†é¢‘æµã€‚ ç›®å‰é€‚ç”¨äº WebRTC çš„åª’ä½“æœåŠ¡å™¨æœ‰ SFU å’Œ MUC ä¸¤ç§ç±»å‹ï¼Œä¸¤ç§çš„å·®åˆ«å¯ä»¥å‚è€ƒï¼š WebRTCçš„ä¸‰ç§æ¶æ„ è™½ç„¶ä¸¤ç§ç±»å‹çš„ WebRTC æœåŠ¡å™¨æ¶æ„éƒ½æœ‰å¼€æºçš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿå­˜åœ¨ä¸€äº›å•†ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†ç»ˆç©¶æ²¡æœ‰åŸºäºRTMP+CDNæ–¹å¼çš„ç›´æ’­æ–¹æ¡ˆæˆç†Ÿï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸€æ—¦é‡‡ç”¨æ­¤æ–¹æ¡ˆéœ€è¦æŠ•å…¥æ›´å¤§çš„ç ”å‘åŠ›åº¦ã€‚ åŸºäºæœåŠ¡å™¨è½¬å‘çš„ WebRTC ç›´æ’­æ–¹æ¡ˆè™½ç„¶çœ‹èµ·æ¥å’Œå½“å‰æµè¡Œçš„RTMP+CDNæ–¹å¼ç±»ä¼¼ï¼Œéƒ½ç»è¿‡äº†æœåŠ¡å™¨çš„è½¬å‘ï¼Œä½† WebRTC åŸºäº UDP æ–¹å¼å»¶è¿Ÿå¯ä»¥åšåˆ°æ›´ä½ï¼Œä¸” WebRTC å†…ç½®äº†å¾ˆå¤šéŸ³è§†é¢‘æ–¹é¢çš„ç®—æ³•ï¼Œå¦‚ AEC, VAD, VP9 ç­‰ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œä¼ è¾“æ–¹é¢åšäº†å¾ˆå¤šä¼˜åŒ–å·¥ä½œã€‚","tags":["WebRTC"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"å¦‚ä½•æ­å»ºWebRTCçš„TURNæœåŠ¡å™¨","path":"/post/2256138363.html","content":"æœ¬æ–‡è®²è§£å¦‚ä½•åœ¨ Ubuntu ç³»ç»Ÿä¸Šé‡‡ç”¨coturnæ­å»º p2p æ‰“æ´æœåŠ¡å™¨ï¼Œcoturn æ˜¯ä¸€ä¸ªå¼€æºçš„ stun å’Œ turn æœåŠ¡å™¨å®ç°ã€‚ 1. å®‰è£…ä¾èµ–é¡¹123sudo apt-get install opensslsudo apt-get install libsslsudo apt-get install libevent-dev 2. ä¸‹è½½ coturn æºç ç¼–è¯‘å®‰è£…12git clone https://github.com/coturn/coturn.git./configure &amp;&amp; make &amp;&amp; make install 3. ç¼–è¾‘é…ç½®å®‰è£…å®Œä¹‹åï¼Œç¼–è¾‘\\usr\\local\\etc\\turnserver.confé…ç½®æ–‡ä»¶ï¼š 12345listening-device=eth0listening-port=3478external-ip=47.93.42.10 #å…¬ç½‘IPuser=jeff:123456 #ç”¨æˆ·åå¯†ç realm=rtctest 4. å¯åŠ¨ coturn1turnserver -a -f -v -r rtctest 5. å®¢æˆ·ç«¯è¿æ¥ coturn æœåŠ¡å™¨webrtc::PeerConnectionFactoryInterface::CreatePeerConnectionå‡½æ•°ä¼ å…¥çš„RTCConfiguration å‚æ•°å¦‚ä¸‹ï¼š 123456789webrtc::PeerConnectionInterface::RTCConfiguration config;config.sdp_semantics = webrtc::SdpSemantics::kUnifiedPlan;config.enable_dtls_srtp = true;webrtc::PeerConnectionInterface::IceServer server;server.urls.push_back(&quot;stun://47.93.42.10:3478&quot;);server.urls.push_back(&quot;turn://47.93.42.10:3478&quot;);server.username = &quot;jeff&quot;;server.password = &quot;123456&quot;;config.servers.push_back(server);","tags":["WebRTC","TURN","Coturn"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"WebRTCçš„ä¸‰ç§æ¶æ„","path":"/post/2114040426.html","content":"WebRTC æ˜¯åŸºäº P2P çš„å®æ—¶é€šä¿¡æŠ€æœ¯ï¼Œï¼ˆå¦‚æœ P2P æ‰“æ´å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨ TURN æœåŠ¡å™¨è¿›è¡Œæ•°æ®è½¬å‘ï¼‰ï¼Œåœ¨æœ‰ 2 å°å®¢æˆ·ç«¯å‚ä¸çš„æƒ…å†µä¸‹ï¼Œç½‘ç»œæ‹“æ‰‘ç»“æ„å¦‚å›¾ï¼š ä¸€ã€Mesh æ¶æ„åœ¨åªæœ‰ 2 ä¸ªå®¢æˆ·ç«¯å‚ä¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šå›¾çš„è¿™ç§æ‹“æ‰‘ç»“æ„ã€‚ä½†å‡å¦‚åŒæ—¶æœ‰ 3 ä¸ªå®¢æˆ·ç«¯å‚ä¸ï¼ˆå¦‚å¤šäººè§†é¢‘ä¼šè®®ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼ï¼Œæ‹“æ‰‘ç»“æ„å°±ä¼šå˜æˆï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ 3 äººå‚ä¸çš„å®æ—¶é€šä¿¡ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¦ç»´æŒ 4 ä¸ªè¿æ¥ï¼ˆ2 ä¸ªä¸Šè¡Œï¼Œ2 ä¸ªä¸‹è¡Œï¼‰ï¼›åŒç†ï¼Œå¦‚æœæœ‰ N ä¸ªå®¢æˆ·ç«¯å‚ä¸ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å°±è¦ç»´æŒN-1ä¸Šè¡Œï¼ŒN-1ä¸ªä¸‹è¡Œï¼Œè¿™æ ·ä¼šæå¤§çš„å ç”¨å®¢æˆ·ç«¯çš„ä¸Šè¡Œå¸¦å®½å’Œä¸‹è¡Œå¸¦å®½ï¼› è¿™ç§æ¯ä¸ªç«¯ä¹‹å‰å®Œå…¨ä½¿ç”¨ P2P æ–¹å¼æ¶æ„ç§°ä¹‹ä¸º Mesh æ¶æ„ã€‚ äºŒã€SFU (Selective Forwarding Unit)æ¶æ„SFU æ¶æ„æœ€æ ¸å¿ƒçš„ç‰¹ç‚¹æ˜¯æŠŠè‡ªå·± â€œä¼ªè£…â€ æˆäº†ä¸€ä¸ª WebRTC çš„å®¢æˆ·ç«¯ï¼ŒWebRTC çš„å…¶ä»–å®¢æˆ·ç«¯å…¶å®å¹¶ä¸çŸ¥é“è‡ªå·±é€šè¿‡ P2P è¿æ¥è¿‡å»çš„æ˜¯ä¸€å°çœŸå®çš„å®¢æˆ·ç«¯è¿˜æ˜¯ä¸€å°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠè¿™ç§è¿æ¥ç§°ä¹‹ä¸º P2Sï¼Œå³ï¼šPeer to Serverã€‚é™¤äº† â€œä¼ªè£…â€ æˆä¸€ä¸ª WebRTC çš„å®¢æˆ·ç«¯å¤–ï¼ŒSFU æœåŠ¡å™¨è¿˜æœ‰ä¸€ä¸ªæœ€é‡è¦çš„èƒ½åŠ›å°±æ˜¯å…·å¤‡one-to-manyçš„èƒ½åŠ›ï¼Œå³å¯ä»¥å°†ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ•°æ®è½¬å‘åˆ°å…¶ä»–å¤šä¸ªå®¢æˆ·ç«¯ã€‚ è¿™ç§ç½‘ç»œæ‹“æ‰‘ç»“æ„ä¸­ï¼Œæ— è®ºå¤šå°‘äººåŒæ—¶è¿›è¡Œè§†é¢‘é€šè¯ï¼Œæ¯ä¸ª WebRTC çš„å®¢æˆ·ç«¯åªéœ€è¦è¿æ¥ä¸€ä¸ª SFU æœåŠ¡å™¨ï¼Œä¸Šè¡Œä¸€è·¯æ•°æ®å³å¯ï¼Œå¯ä»¥æå¤§çš„å‡å°‘å¤šäººè§†é¢‘é€šè¯åœºæ™¯ä¸‹ Mesh æ¨¡å‹ç»™å®¢æˆ·ç«¯å¸¦æ¥çš„ä¸Šè¡Œå¸¦å®½å‹åŠ›ã€‚ SFU æœåŠ¡å™¨è·Ÿ TURN æœåŠ¡å™¨æœ€å¤§çš„ä¸åŒæ˜¯ï¼ŒTURN æœåŠ¡å™¨ä»…ä»…æ˜¯ä¸º WebRTC å®¢æˆ·ç«¯æä¾›çš„ä¸€ç§è¾…åŠ©çš„æ•°æ®è½¬å‘é€šé“ï¼Œåœ¨ P2P ä¸é€šçš„æ—¶å€™è¿›è¡Œé€æ˜çš„æ•°æ®è½¬å‘ã€‚è€Œ SFU æ˜¯ â€œæ‡‚ä¸šåŠ¡â€ çš„ï¼Œ å®ƒè·Ÿ WebRTC å®¢æˆ·ç«¯æ˜¯å¹³ç­‰çš„å…³ç³»ï¼Œç”šè‡³ â€œæ¥ç®¡äº†â€ WebRTC å®¢æˆ·ç«¯çš„æ•°æ®è½¬å‘çš„ç”³è¯·å’Œæ§åˆ¶ã€‚ ä¸‰ã€MCU (MultiPoint Control Unit)æ¶æ„ä»ä¸Šè¿° SFU çš„å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼ŒSFU è¿™ç§ç½‘ç»œæ‹“æ‰‘æ¨¡å‹ï¼Œé€šè¿‡ç”± SFU Server æ¥å®ç° one-to-many ï¼Œå‡è½»äº†å¤šäººè§†é¢‘é€šè¯åœºæ™¯ä¸‹æ¯ä¸ªå®¢æˆ·ç«¯çš„ä¸Šè¡Œå¸¦å®½å‹åŠ›ï¼Œä½†æ˜¯ä¸‹è¡Œä¾ç„¶æ˜¯å¤šè·¯æµï¼Œéšç€é€šè¯äººæ•°çš„å¢å¤§ï¼Œä¸‹è¡Œå¸¦å®½çš„å‹åŠ›ä¾ç„¶ä¼šæˆæ¯”ä¾‹çš„å¢å¤§ï¼Œé‚£èƒ½å¦è®©ä¸‹è¡Œä¹Ÿåªå‰©ä¸€è·¯æµå‘¢ï¼Ÿâ€”â€” å¯ä»¥ï¼Œé€šè¿‡åœ¨æœåŠ¡å™¨ç«¯åˆæµåå†ä¸‹å‘å³å¯è§£å†³ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç›®å‰ï¼Œéšç€ 5G æŠ€æœ¯çš„æ¨å¹¿ï¼Œå¯ä»¥é¢„è§å¸¦å®½è¶Šæ¥è¶Šä¸æ˜¯é—®é¢˜ï¼Œæ‰€ä»¥ SFU åœ¨æœªæ¥ï¼Œå¯èƒ½ä¼šæ›´æœ‰ä¼˜åŠ¿ã€‚å¸¸è§çš„å¼€æº SFU æœåŠ¡å™¨æœ‰ï¼šLicodeï¼ŒJanusï¼ŒJitsiï¼Œmediasoupï¼ŒMedooze ç­‰ç­‰ã€‚ æ–‡ç« å‚è€ƒï¼šWebRTC å¼€å‘å®è·µï¼šä¸ºä»€ä¹ˆä½ éœ€è¦ SFU æœåŠ¡å™¨ &gt; webrtc ç¬”è®°(3): å¤šäººè§†é¢‘é€šè®¯å¸¸ç”¨æ¶æ„ Mesh&#x2F;MCU&#x2F;SFU","tags":["WebRTC","Mesh","SFU","MCU"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"å®¢æˆ·ç«¯è½¯ä»¶æ—¥å¿—è¾“å‡ºè§„èŒƒ","path":"/post/449620601.html","content":"ä¼—æ‰€å‘¨çŸ¥ï¼Œè½¯ä»¶æ—¥å¿—å¯¹é—®é¢˜çš„æ’æŸ¥å¯ä»¥èµ·åˆ°è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œä½†åœ¨å¤šäººååŒå¼€å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„äººä½¿ç”¨ä¸åŒçš„æ—¥å¿—æ‰“å°é£æ ¼ï¼Œå¯¼è‡´æ—¥å¿—å¯é˜…è¯»æ€§ä¸é«˜ã€‚çºµè§‚å„å¤§çŸ¥åè½¯ä»¶çš„è¾“å‡ºæ—¥å¿—ï¼Œæ— ä¸æœ‰ç€è§„èŒƒçš„æ ¼å¼ï¼Œéå¸¸åˆ©äºé˜…è¯»ã€‚ æœ¬æ—¥å¿—è¾“å‡ºè§„èŒƒä»…é€‚ç”¨äºå®¢æˆ·ç«¯è½¯ä»¶ï¼Œä¸é€‚ç”¨äºæœåŠ¡å™¨ç«¯è½¯ä»¶ã€‚ æ—¥å¿—ä¸­ä½¿ç”¨è‹±æ–‡ï¼Œä¸ä½¿ç”¨ä¸­æ–‡ã€‚ æ—¥å¿—æ–‡ä»¶é‡‡ç”¨UTF-8ç¼–ç ã€‚ æ¯æ¡æ—¥å¿—çš„ç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯å¤§å†™ï¼Œè€Œä¸”æ¯æ¡æ—¥å¿—ä»¥å›è½¦æ¢è¡Œç¬¦(\\r )ç»“æŸï¼Œä¸éœ€è¦å†™å¥å·.ï¼Œå¦‚ï¼š 12// RTC_LOGä¼šè‡ªåŠ¨åœ¨æ—¥å¿—ç»“å°¾æ·»åŠ \\r RTC_LOG(LS_INFO) &lt;&lt; &quot;Forced software decoder fallback enabled&quot;; ä¸åŒè¯­ä¹‰é—´ä½¿ç”¨é€—å·,åˆ†éš”ï¼Œkey-valueé—´ä½¿ç”¨å†’å·:åˆ†éš”ï¼Œå¦‚ï¼š 123RTC_LOG(LS_INFO) &lt;&lt; &quot;DataChannel received DATA message, sid: &quot; &lt;&lt; sid;RTC_LOG(LS_INFO) &lt;&lt; &quot;Session: &quot; &lt;&lt; session_id() &lt;&lt; &quot; is destroyed&quot;;RTC_LOG(LS_ERROR) &lt;&lt; &quot;Invalid configuration: &quot; &lt;&lt; config_error.message(); æ¯æ¡æ—¥å¿—éœ€è¦åŒ…å«æ—¥å¿—æ‰“å°çš„æ—¶é—´ï¼ˆæ—¥æœŸ+æ—¶é—´+æ—¶åŒºï¼Œç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ã€æ—¥å¿—çº§åˆ«ã€‚","tags":["æ—¥å¿—"],"categories":["é¡¹ç›®ç®¡ç†"]},{"title":"æµåª’ä½“åŸºç¡€æ¦‚å¿µ","path":"/post/737279469.html","content":"ä¸€ã€æµåª’ä½“åè®®1.1 RTP (Real-time Transport Protocol)1.1.1 RTP ç‰¹å¾å®æ—¶ä¼ è¾“åè®®ï¼ˆReal-time Transport Protocolï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œä¼ è¾“å±‚åè®®ï¼Œå®ƒæ˜¯ç”± IETF çš„å¤šåª’ä½“ä¼ è¾“å·¥ä½œå°ç»„ 1996 å¹´åœ¨ RFC 1889 ä¸­å…¬å¸ƒçš„ï¼Œå®ƒä½œä¸ºå› ç‰¹ç½‘æ ‡å‡†åœ¨ RFC 3550ï¼ˆè¯¥æ–‡æ¡£çš„æ—§ç‰ˆæœ¬æ˜¯ RFC 1889ï¼‰æœ‰è¯¦ç»†è¯´æ˜ï¼ŒRTP æ ‡å‡†å®šä¹‰äº†ä¸¤ä¸ªå­åè®®ï¼šRTP å’Œ RTCPã€‚ RTP åè®®æ˜¯å»ºç«‹åœ¨ UDP åè®®ä¸Šçš„ã€‚ RTP åè®®è¯¦ç»†è¯´æ˜äº†åœ¨äº’è”ç½‘ä¸Šä¼ é€’éŸ³é¢‘å’Œè§†é¢‘çš„æ ‡å‡†æ•°æ®åŒ…æ ¼å¼ã€‚RTP åè®®å¸¸ç”¨äºæµåª’ä½“ç³»ç»Ÿï¼ˆé…åˆ RTCP åè®®ï¼‰ã€è§†é¢‘ä¼šè®®å’Œè§†é¢‘ç”µè¯ç³»ç»Ÿï¼ˆé…åˆ H.263 æˆ– SIPï¼‰ã€‚ RTP æ ‡å‡†ç”±ä¸¤ä¸ªç´§å¯†é“¾æ¥éƒ¨åˆ†ç»„æˆï¼š RTP â€”- ä¼ é€å…·æœ‰å®æ—¶å±æ€§çš„æ•°æ®ï¼› RTP æ§åˆ¶åè®®ï¼ˆRTCPï¼‰â€”-ç›‘æ§æœåŠ¡è´¨é‡å¹¶ä¼ é€æ­£åœ¨è¿›è¡Œçš„ä¼šè¯å‚ä¸è€…çš„ç›¸å…³ä¿¡æ¯ã€‚ RTP æœ¬èº«å¹¶æ²¡æœ‰æä¾›æŒ‰æ—¶å‘é€æœºåˆ¶æˆ–å…¶ä»–æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ä¿è¯ï¼Œå®ƒä¾èµ–äºåº•å±‚æœåŠ¡å»å®ç°è¿™ä¸€è¿‡ç¨‹ã€‚RTP å¹¶ä¸ä¿è¯ä¼ é€æˆ–é˜²æ­¢æ— åºä¼ é€ï¼Œä¹Ÿä¸ç¡®å®šåº•å±‚ç½‘ç»œçš„å¯é æ€§ã€‚RTP å®è¡Œæœ‰åºä¼ é€ï¼ŒRTP ä¸­çš„åºåˆ—å·å…è®¸æ¥æ”¶æ–¹é‡ç»„å‘é€æ–¹çš„åŒ…åºåˆ—ï¼ŒåŒæ—¶åºåˆ—å·ä¹Ÿèƒ½ç”¨äºå†³å®šé€‚å½“çš„åŒ…ä½ç½®ï¼Œä¾‹å¦‚ï¼šåœ¨è§†é¢‘è§£ç ä¸­ï¼Œå°±ä¸éœ€è¦é¡ºåºè§£ç ã€‚ 1.1.2 RTP æŠ¥å¤´RTP æŠ¥å¤´æ ¼å¼å¦‚ä¸‹ï¼š Vï¼šRTP åè®®çš„ç‰ˆæœ¬å·ï¼Œå  2 ä½ï¼Œå½“å‰åè®®ç‰ˆæœ¬å·ä¸º 2ã€‚ Pï¼šå¡«å……æ ‡å¿—ï¼Œå  1 ä½ï¼Œå¦‚æœ P&#x3D;1ï¼Œåˆ™åœ¨è¯¥æŠ¥æ–‡çš„å°¾éƒ¨å¡«å……ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤–çš„å…«ä½ç»„ï¼Œå®ƒä»¬ä¸æ˜¯æœ‰æ•ˆè½½è·çš„ä¸€éƒ¨åˆ†ã€‚ Xï¼šæ‰©å±•æ ‡å¿—ï¼Œå  1 ä½ï¼Œå¦‚æœ X&#x3D;1ï¼Œåˆ™åœ¨ RTP æŠ¥å¤´åè·Ÿæœ‰ä¸€ä¸ªæ‰©å±•æŠ¥å¤´ã€‚ CCï¼šCSRC è®¡æ•°å™¨ï¼Œå  4 ä½ï¼ŒæŒ‡ç¤º CSRC æ ‡è¯†ç¬¦çš„ä¸ªæ•°ã€‚ M: æ ‡è®°ï¼Œå  1 ä½ï¼Œä¸åŒçš„æœ‰æ•ˆè½½è·æœ‰ä¸åŒçš„å«ä¹‰ï¼Œå¯¹äºè§†é¢‘ï¼Œæ ‡è®°ä¸€å¸§çš„ç»“æŸï¼›å¯¹äºéŸ³é¢‘ï¼Œæ ‡è®°ä¼šè¯çš„å¼€å§‹ã€‚ PT: æœ‰æ•ˆè½½è·ç±»å‹ï¼Œå  7 ä½ï¼Œç”¨äºè¯´æ˜ RTP æŠ¥æ–‡ä¸­æœ‰æ•ˆè½½è·çš„ç±»å‹ï¼Œå¦‚ GSM éŸ³é¢‘ã€JPEM å›¾åƒç­‰ã€‚ åºåˆ—å·ï¼šå  16 ä½ï¼Œç”¨äºæ ‡è¯†å‘é€è€…æ‰€å‘é€çš„ RTP æŠ¥æ–‡çš„åºåˆ—å·ï¼Œæ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡ï¼Œåºåˆ—å·å¢ 1ã€‚æ¥æ”¶è€…é€šè¿‡åºåˆ—å·æ¥æ£€æµ‹æŠ¥æ–‡ä¸¢å¤±æƒ…å†µï¼Œé‡æ–°æ’åºæŠ¥æ–‡ï¼Œæ¢å¤æ•°æ®ã€‚ æ—¶æˆ³(Timestamp)ï¼šå  32 ä½ï¼Œæ—¶æˆ³åæ˜ äº†è¯¥ RTP æŠ¥æ–‡çš„ç¬¬ä¸€ä¸ªå…«ä½ç»„çš„é‡‡æ ·æ—¶åˆ»ã€‚æ¥æ”¶è€…ä½¿ç”¨æ—¶æˆ³æ¥è®¡ç®—å»¶è¿Ÿå’Œå»¶è¿ŸæŠ–åŠ¨ï¼Œå¹¶è¿›è¡ŒåŒæ­¥æ§åˆ¶ã€‚ åŒæ­¥ä¿¡æº(SSRC)æ ‡è¯†ç¬¦ï¼šå  32 ä½ï¼Œç”¨äºæ ‡è¯†åŒæ­¥ä¿¡æºã€‚è¯¥æ ‡è¯†ç¬¦æ˜¯éšæœºé€‰æ‹©çš„ï¼Œå‚åŠ åŒä¸€è§†é¢‘ä¼šè®®çš„ä¸¤ä¸ªåŒæ­¥ä¿¡æºä¸èƒ½æœ‰ç›¸åŒçš„ SSRCã€‚ ç‰¹çº¦ä¿¡æº(CSRC)æ ‡è¯†ç¬¦ï¼šæ¯ä¸ª CSRC æ ‡è¯†ç¬¦å  32 ä½ï¼Œå¯ä»¥æœ‰ 0 ï½ 15 ä¸ªã€‚æ¯ä¸ª CSRC æ ‡è¯†äº†åŒ…å«åœ¨è¯¥ RTP æŠ¥æ–‡æœ‰æ•ˆè½½è·ä¸­çš„æ‰€æœ‰ç‰¹çº¦ä¿¡æºã€‚ è¿™é‡Œçš„åŒæ­¥ä¿¡æºæ˜¯æŒ‡äº§ç”Ÿåª’ä½“æµçš„ä¿¡æºï¼Œå®ƒé€šè¿‡ RTP æŠ¥å¤´ä¸­çš„ä¸€ä¸ª 32 ä½æ•°å­— SSRC æ ‡è¯†ç¬¦æ¥æ ‡è¯†ï¼Œè€Œä¸ä¾èµ–äºç½‘ç»œåœ°å€ï¼Œæ¥æ”¶è€…å°†æ ¹æ® SSRC æ ‡è¯†ç¬¦æ¥åŒºåˆ†ä¸åŒçš„ä¿¡æºï¼Œè¿›è¡Œ RTP æŠ¥æ–‡çš„åˆ†ç»„ã€‚ç‰¹çº¦ä¿¡æºæ˜¯æŒ‡å½“æ··åˆå™¨æ¥æ”¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåŒæ­¥ä¿¡æºçš„ RTP æŠ¥æ–‡åï¼Œç»è¿‡æ··åˆå¤„ç†äº§ç”Ÿä¸€ä¸ªæ–°çš„ç»„åˆ RTP æŠ¥æ–‡ï¼Œå¹¶æŠŠæ··åˆå™¨ä½œä¸ºç»„åˆ RTP æŠ¥æ–‡çš„ SSRCï¼Œè€Œå°†åŸæ¥æ‰€æœ‰çš„ SSRC éƒ½ä½œä¸º CSRC ä¼ é€ç»™æ¥æ”¶è€…ï¼Œä½¿æ¥æ”¶è€…çŸ¥é“ç»„æˆç»„åˆæŠ¥æ–‡çš„å„ä¸ª SSRCã€‚ 1.2 RTCP (Real-time Transport Control Protocol)å®æ—¶ä¼ è¾“æ§åˆ¶åè®®ï¼ˆReal-time Transport Control Protocol,RTCPï¼‰æ˜¯å®æ—¶ä¼ è¾“åè®®ï¼ˆRTPï¼‰çš„ä¸€ä¸ªå§å¦¹åè®®ã€‚ RTCP ä¸º RTP åª’ä½“æµæä¾›ä¿¡é“å¤–æ§åˆ¶ã€‚RTCP å®šæœŸåœ¨å¤šåª’ä½“æµä¼šè¯å‚åŠ è€…ä¹‹é—´ä¼ è¾“æ§åˆ¶æ•°æ®ã€‚RTCP çš„ä¸»è¦åŠŸèƒ½æ˜¯ä¸º RTP æ‰€æä¾›çš„æœåŠ¡è´¨é‡æä¾›åé¦ˆã€‚ RTCP æ”¶é›†ç›¸å…³åª’ä½“è¿æ¥çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šä¼ è¾“å­—èŠ‚æ•°ï¼Œä¼ è¾“åˆ†ç»„æ•°ï¼Œä¸¢å¤±åˆ†ç»„æ•°ï¼Œæ—¶å»¶æŠ–åŠ¨ï¼Œå•å‘å’ŒåŒå‘ç½‘ç»œå»¶è¿Ÿç­‰ç­‰ã€‚ç½‘ç»œåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨ RTCP æ‰€æä¾›çš„ä¿¡æ¯è¯•å›¾æé«˜æœåŠ¡è´¨é‡ï¼Œæ¯”å¦‚é™åˆ¶ä¿¡æ¯æµé‡æˆ–æ”¹ç”¨å‹ç¼©æ¯”è¾ƒå°çš„ç¼–è§£ç å™¨ã€‚RTCP æœ¬èº«ä¸æä¾›æ•°æ®åŠ å¯†æˆ–èº«ä»½è®¤è¯ï¼Œå…¶ä¼´ç”Ÿåè®®SRTCPï¼ˆå®‰å…¨å®æ—¶ä¼ è¾“æ§åˆ¶åè®®ï¼‰åˆ™å¯ç”¨äºæ­¤ç±»ç”¨é€”ã€‚ WebRTC å†…éƒ¨é‡‡ç”¨çš„æ˜¯ RTC+RTCP 1.3 SRTP &amp; SRTCPSRTP &#x3D; Secure Real-time Transport ProtocolSRTCP &#x3D; Secure Real-time Transport Control ProtocolSRTP æ˜¯åœ¨å®æ—¶ä¼ è¾“åè®® RTP åŸºç¡€ä¸Šæ‰€å®šä¹‰çš„ä¸€ä¸ªåè®®ï¼Œæ—¨åœ¨ä¸ºå•æ’­å’Œå¤šæ’­åº”ç”¨ç¨‹åºä¸­çš„å®æ—¶ä¼ è¾“åè®®çš„æ•°æ®æä¾›åŠ å¯†ã€æ¶ˆæ¯è®¤è¯ã€å®Œæ•´æ€§ä¿è¯å’Œé‡æ”¾ä¿æŠ¤ã€‚å®ƒæ˜¯ç”± David Oranï¼ˆæ€ç§‘ï¼‰å’Œ Rolf Blomï¼ˆçˆ±ç«‹ä¿¡ï¼‰å¼€å‘çš„ï¼Œå¹¶æœ€æ—©ç”± IETF äº 2004 å¹´ 3 æœˆä½œä¸º RFC 3711 å‘å¸ƒã€‚ 1.4 RTSP (Real-time Transport Streaming Protocol)RTSPï¼ˆReal Time Streaming Protocolï¼‰ï¼ŒRFC2326ï¼Œå®æ—¶æµä¼ è¾“åè®®ã€‚RTSP åœ¨ä½“ç³»ç»“æ„ä¸Šä½äº RTP å’Œ RTCP ä¹‹ä¸Šï¼Œå®ƒä½¿ç”¨ TCP æˆ– UDP å®Œæˆæ•°æ®ä¼ è¾“ã€‚ RTSP æ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„åº”ç”¨å±‚åè®®ï¼Œåœ¨è¯­æ³•åŠä¸€äº›æ¶ˆæ¯å‚æ•°ç­‰æ–¹é¢ä¸ HTTP åè®®ç±»ä¼¼ã€‚ RTSP è¢«ç”¨äºå»ºç«‹çš„æ§åˆ¶åª’ä½“æµçš„ä¼ è¾“ï¼Œå®ƒä¸ºå¤šåª’ä½“æœåŠ¡æ‰®æ¼”â€œç½‘ç»œè¿œç¨‹æ§åˆ¶â€çš„è§’è‰²ã€‚å°½ç®¡æœ‰æ—¶å¯ä»¥æŠŠ RTSP æ§åˆ¶ä¿¡æ¯å’Œåª’ä½“æ•°æ®æµäº¤ç»‡åœ¨ä¸€èµ·ä¼ é€ï¼Œä½†ä¸€èˆ¬æƒ…å†µ RTSP æœ¬èº«å¹¶ä¸ç”¨äºä¼ é€åª’ä½“æµæ•°æ®ï¼Œåª’ä½“æ•°æ®çš„ä¼ é€å¯é€šè¿‡ RTP&#x2F;RTCP ç­‰åè®®æ¥å®Œæˆã€‚ 1.5 SDP (Session Description Protocol)ä¼šè¯æè¿°åè®®ï¼ˆSession Description Protocol æˆ–ç®€å†™ SDPï¼‰æè¿°çš„æ˜¯æµåª’ä½“çš„åˆå§‹åŒ–å‚æ•°ã€‚æ­¤åè®®ç”± IETF å‘è¡¨ä¸º RFC 2327ã€‚ SDP å®Œå…¨æ˜¯ä¸€ç§ä¼šè¯æè¿°æ ¼å¼ï¼Œå®ƒä¸å±äºä¼ è¾“åè®®ã€‚ SDP ç”¨äºæè¿°å¤šåª’ä½“é€šä¿¡ä¼šè¯ï¼ŒåŒ…æ‹¬ä¼šè¯å»ºç«‹ã€ä¼šè¯è¯·æ±‚å’Œå‚æ•°åå•†ã€‚SDP ä¸ç”¨äºä¼ è¾“åª’ä½“æ•°æ®ï¼Œåªèƒ½ç”¨äºä¸¤ä¸ªé€šä¿¡ç»ˆç«¯çš„å‚æ•°åå•†ï¼ŒåŒ…æ‹¬åª’ä½“ç±»å‹ã€æ ¼å¼ä»¥åŠæ‰€æœ‰å…¶ä»–å’Œä¼šè¯ç›¸å…³çš„å±æ€§ã€‚SDP ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æè¿°ä¸Šè¿°åˆå§‹åŒ–å‚æ•°ã€‚ å¯ä»¥å‚è€ƒ SDPæ ¼å¼è§£æ 1.6 SIP (Session Initiation Protocol)SIP(Session Initiation Protocol)æ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„ä¿¡ä»¤æ§åˆ¶åè®®ã€‚ SIP ç”¨äºåˆå§‹åŒ–ä¸€ä¸ª Sessionï¼Œå¹¶è´Ÿè´£ä¼ è¾“ SDP åŒ…ï¼›è€Œ SDP åŒ…ä¸­æè¿°äº†ä¸€ä¸ª Session ä¸­åŒ…å«å“ªäº›åª’ä½“æ•°æ®ï¼Œé‚€è¯·çš„äººç­‰ç­‰ï¼›å½“éœ€è¦è¢«é‚€è¯·çš„äººéƒ½é€šè¿‡å„è‡ªçš„ç»ˆç«¯è®¾å¤‡è¢«é€šçŸ¥åˆ°åï¼Œå°±å¯ä»¥ä½¿ç”¨ RTSP æ¥æ§åˆ¶ç‰¹å®š Media çš„é€šä¿¡ï¼Œæ¯”å¦‚ RTSP æ§åˆ¶ä¿¡æ¯è¦æ±‚å¼€å§‹ Video çš„æ’­æ”¾ï¼Œé‚£ä¹ˆå°±å¼€å§‹ä½¿ç”¨ RTPï¼ˆæˆ–è€… TCPï¼‰å®æ—¶ä¼ è¾“æ•°æ®ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒRTCP è¦è´Ÿè´£ QoS ç­‰ã€‚ 1.7 RTMP (Real Time Messaging Protocol)RTMP(Real-Time Messaging Protocol å®æ—¶æ¶ˆæ¯ä¼ é€åè®®)çš„ç¼©å†™ï¼Œå®ƒæ˜¯ Adobe Systems å…¬å¸ä¸º Flash æ’­æ”¾å™¨å’ŒæœåŠ¡å™¨ä¹‹é—´éŸ³é¢‘ã€è§†é¢‘å’Œæ•°æ®ä¼ è¾“å¼€å‘çš„ä¸€ä¸ªåŸºäºTCPçš„åº”ç”¨å±‚ä¼ è¾“åè®®ã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ã€æœªåŠ å¯†çš„å®æ—¶æ¶ˆæ¯ä¼ é€’åè®®ï¼Œé»˜è®¤ç«¯å£æ˜¯ 1935ã€‚ RTMP æ˜¯ä¸€ç§æœ‰çŠ¶æ€åè®®ã€‚ RTMP åè®®æœ‰æ•ˆçš„ä¿è¯äº†åª’ä½“ä¼ è¾“è´¨é‡ï¼Œä½¿ç”¨æˆ·å¯ä»¥è§‚çœ‹åˆ°é«˜è´¨é‡çš„å¤šåª’ä½“ã€‚RTMP é‡‡ç”¨ TCP åè®®ä½œä¸ºå…¶åœ¨ä¼ è¾“å±‚çš„åè®®ï¼Œé¿å…äº†å¤šåª’ä½“æ•°æ®åœ¨å¹¿åŸŸç½‘ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä¸¢åŒ…å¯¹è´¨é‡é€ æˆçš„æŸå¤±ã€‚æ­¤å¤– RTMP åè®®ä¼ è¾“çš„ FLV å°è£…æ ¼å¼æ”¯æŒçš„ Hï¼264 è§†é¢‘ç¼–ç æ–¹å¼å¯ä»¥åœ¨å¾ˆä½çš„ç ç‡ä¸‹æ˜¾ç¤ºè´¨é‡è¿˜ä¸é”™çš„ç”»é¢ï¼Œéå¸¸é€‚åˆç½‘ç»œå¸¦å®½ä¸è¶³çš„æƒ…å†µä¸‹æ”¶çœ‹æµåª’ä½“ã€‚ å½“ç„¶ RTMP åè®®ä¹Ÿæœ‰ä¸€äº›å±€é™ï¼ŒRTMP åŸºäº TCP åè®®ï¼Œè€Œ TCP åè®®å®æ—¶æ€§ä¸å¦‚ UDPï¼Œä¹Ÿéå¸¸å ç”¨å¸¦å®½ã€‚ç›®å‰åŸºäº UDP çš„ RTMFP åè®®èƒ½å¾ˆå¥½çš„è§£å†³è¿™äº›é—®é¢˜ã€‚ RTMPT å°è£…åœ¨ HTTP è¯·æ±‚ä¹‹ä¸­ï¼Œå¯ç©¿è¶Šé˜²ç«å¢™;RTMPS ç±»ä¼¼ RTMPTï¼Œä½†ä½¿ç”¨çš„æ˜¯ HTTPS è¿æ¥; 1.8 RTMFP (Real Time Media Flow Protocol)RTMFP æ˜¯ Adobe å…¬å¸å¼€å‘çš„ä¸€å¥—æ–°çš„é€šä¿¡åè®®ã€‚ RTMFP æ˜¯åŸºäº UDP çš„ï¼ŒRTMP æ˜¯åŸºäº TCP çš„ã€‚UDP åœ¨ä¼ é€ç›´æ’­æ•°æ®æ–¹é¢æ¯” TCP è¿˜æ˜¯æœ‰è¾ƒå¤šä¼˜åŠ¿çš„ï¼Œæ¯”å¦‚å‡å°‘å»¶æ—¶ï¼Œå¯¹ä¸¢åŒ…çš„å®¹å¿ï¼Œè™½ç„¶åœ¨å¯é æ€§ä¸Šæœ‰æ‰€æŸå¤±ã€‚ä¸ RTMP ä¸åŒ, RTMFP æ”¯æŒ Flash Player ç›´æ¥å‘é€æ•°æ®ç»™å¦ä¸€ä¸ªï¼Œè€Œä¸ç»è¿‡ Serverã€‚ 1.9 RSVP (Resource ReSerVation Protocol)ä½¿ç”¨ RSVP é¢„ç•™ä¸€éƒ¨åˆ†ç½‘ç»œèµ„æºï¼ˆå³å¸¦å®½ï¼‰ï¼Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸ºæµåª’ä½“çš„ä¼ è¾“æä¾› QoSã€‚é€šå¸¸ RSVP è¯·æ±‚å°†ä¼šå¼•èµ·æ¯ä¸ªèŠ‚ç‚¹æ•°æ®è·¯å¾„ä¸Šçš„èµ„æºé¢„ç•™ã€‚ RSVP åªåœ¨å•æ–¹å‘ä¸Šè¿›è¡Œèµ„æºè¯·æ±‚ï¼Œå› æ­¤ï¼Œå°½ç®¡ç›¸åŒçš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¯èƒ½æ—¢æ‹…å½“å‘é€è€…ä¹Ÿæ‹…å½“æ¥å—è€…ï¼Œä½† RSVP å¯¹å‘é€è€…ä¸æ¥å—è€…åœ¨é€»è¾‘ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚ RSVP å±äºç½‘ç»œå±‚åè®®ã€‚ RSVP ä¸ä¼ è¾“åº”ç”¨æ•°æ®ï¼Œä½†æ”¯æŒå› ç‰¹ç½‘æ§åˆ¶åè®®ï¼Œå¦‚ ICMPã€IGMP æˆ–è€…è·¯ç”±é€‰æ‹©åè®®ã€‚ 1.10 MMS (Microsoft Media Server Protocol)MMS(Microsoft Media Server Protocol)ï¼Œå¾®è½¯åª’ä½“æœåŠ¡å™¨åè®®ï¼Œç”¨æ¥è®¿é—®æ¥æ”¶ Windows Media æœåŠ¡å™¨ä¸­ .asf æ–‡ä»¶çš„ä¸€ç§åè®®ã€‚MMS åè®®ç”¨äºè®¿é—® Windows Media å‘å¸ƒç‚¹ä¸Šçš„å•æ’­å†…å®¹ã€‚ MMS çš„é»˜è®¤ç«¯å£æ˜¯ 1755. 1.11 HLS (HTTP Live Streaming)HTTP Live Streamingï¼ˆç¼©å†™æ˜¯ HLSï¼‰æ˜¯ä¸€ä¸ªç”±è‹¹æœå…¬å¸æå‡ºçš„åŸºäºHTTPçš„æµåª’ä½“ç½‘ç»œä¼ è¾“åè®®ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯æŠŠæ•´ä¸ªæµåˆ†æˆä¸€ä¸ªä¸ªå°çš„åŸºäº HTTP çš„æ–‡ä»¶æ¥ä¸‹è½½ï¼Œæ¯æ¬¡åªä¸‹è½½ä¸€äº›ã€‚å½“åª’ä½“æµæ­£åœ¨æ’­æ”¾æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä»è®¸å¤šä¸åŒçš„å¤‡ç”¨æºä¸­ä»¥ä¸åŒçš„é€Ÿç‡ä¸‹è½½åŒæ ·çš„èµ„æºï¼Œå…è®¸æµåª’ä½“ä¼šè¯é€‚åº”ä¸åŒçš„æ•°æ®é€Ÿç‡ã€‚åœ¨å¼€å§‹ä¸€ä¸ªæµåª’ä½“ä¼šè¯æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä¸‹è½½ä¸€ä¸ªåŒ…å«å…ƒæ•°æ®çš„ extended M3U (m3u8)playlist æ–‡ä»¶ï¼Œç”¨äºå¯»æ‰¾å¯ç”¨çš„åª’ä½“æµã€‚ HLS åªè¯·æ±‚åŸºæœ¬çš„ HTTP æŠ¥æ–‡ï¼Œä¸å®æ—¶ä¼ è¾“åè®®ï¼ˆRTP)ä¸åŒï¼ŒHLS å¯ä»¥ç©¿è¿‡ä»»ä½•å…è®¸ HTTP æ•°æ®é€šè¿‡çš„é˜²ç«å¢™æˆ–è€…ä»£ç†æœåŠ¡å™¨ã€‚å®ƒä¹Ÿå¾ˆå®¹æ˜“ä½¿ç”¨å†…å®¹åˆ†å‘ç½‘ç»œæ¥ä¼ è¾“åª’ä½“æµã€‚ HLS åè®®è§„å®šï¼š è§†é¢‘çš„å°è£…æ ¼å¼æ˜¯ TSã€‚ è§†é¢‘çš„ç¼–ç æ ¼å¼ä¸º H264,éŸ³é¢‘ç¼–ç æ ¼å¼ä¸º MP3ã€AAC æˆ–è€… AC-3ã€‚ é™¤äº† TS è§†é¢‘æ–‡ä»¶æœ¬èº«ï¼Œè¿˜å®šä¹‰äº†ç”¨æ¥æ§åˆ¶æ’­æ”¾çš„ m3u8 æ–‡ä»¶ï¼ˆæ–‡æœ¬æ–‡ä»¶ï¼‰ã€‚ äºŒã€å°è£…æ ¼å¼ åç§° æ¨å‡ºæœºæ„ æµåª’ä½“æ”¯æŒ æ”¯æŒçš„è§†é¢‘ç¼–ç  æ”¯æŒçš„éŸ³é¢‘ç¼–ç  AVI Microsoft Inc. å¦ å‡ ä¹æ‰€æœ‰æ ¼å¼ å‡ ä¹æ‰€æœ‰æ ¼å¼ MP4 MPEG æ˜¯ MPEG-2, MPEG-4, H.264, H.263 ç­‰ AAC, MPEG-1 Layers I, II, III, AC-3 ç­‰ TS MPEG æ˜¯ MPEG-1, MPEG-2, MPEG-4, H.264 MPEG-1 Layers I, II, III, AAC FLV Adobe Inc. æ˜¯ Sorenson, VP6, H.264 MP3, ADPCM, Linear PCM, AAC ç­‰ MKV CoreCodec Inc. æ˜¯ å‡ ä¹æ‰€æœ‰æ ¼å¼ å‡ ä¹æ‰€æœ‰æ ¼å¼ RMVB Real Network Inc. æ˜¯ RealVideo 8, 9, 10 AAC, Cook Codec, RealAudio Lossless ä¸‰ã€è§†é¢‘ç¼–ç æ ¼å¼ åç§° æ¨å‡ºæœºæ„ æ¨å‡ºæ—¶é—´ HEVC(h.265) MPEG&#x2F;ITU-T 2013 H.264 MPEG&#x2F;ITU-T 2003 MPEG4 MPEG 2001 MPEG2 MPEG 1994 VP9 Google 2013 VP8 Google 2008 VC-1 Microsoft Inc. 2006 å››ã€éŸ³é¢‘ç¼–ç æ ¼å¼ åç§° æ¨å‡ºæœºæ„ æ¨å‡ºæ—¶é—´ AAC MPEG 1997 AC-3 Dolby Inc. 1992 MP3 MPEG 1993 WMA Microsoft Inc. 1999 ç›®å‰ï¼Œç›´æ’­æœåŠ¡æ™®é€šé‡‡ç”¨RTMPä½œä¸ºæµåª’ä½“åè®®ï¼ŒFLVä½œä¸ºå°è£…æ ¼å¼ï¼ŒH.264ä½œä¸ºè§†é¢‘ç¼–ç æ ¼å¼ï¼ŒAACä½œä¸ºéŸ³é¢‘ç¼–ç æ ¼å¼åŒ–ã€‚ç‚¹æ’­æœåŠ¡æ™®é€šé‡‡ç”¨HTTPä½œä¸ºæµåª’ä½“åè®®ï¼ŒH.264ä½œä¸ºè§†é¢‘ç¼–ç æ ¼å¼ï¼ŒAACä½œä¸ºéŸ³é¢‘ç¼–ç æ ¼å¼ï¼Œè€Œå°è£…æ ¼å¼æœ‰å¤šç§ï¼Œå¦‚MP4ï¼ŒFLVï¼ŒF4Vç­‰ã€‚","tags":["æµåª’ä½“","RTP"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"Windowsèµ„æºç®¡ç†å™¨å›¾æ ‡è¦†ç›–ä¼˜å…ˆçº§è®¾å®š","path":"/post/2567544627.html","content":"æˆ‘ä»¬åœ¨å®‰è£…äº†TortoiseSVNæˆ–TortoiseGitåï¼Œä¼šè‡ªåŠ¨åœ¨èµ„æºç®¡ç†å™¨çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶å›¾æ ‡ä¸Šæ˜¾ç¤ºè¦†ç›–å›¾æ ‡ï¼ˆIcon Overlayï¼‰ï¼Œè¿™æ ·å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ã€‚ ä½†æœ‰æ—¶å€™æˆ‘ä»¬å®‰è£…çš„å…¶ä»–è½¯ä»¶ï¼Œå¦‚Dropboxç­‰ï¼Œä¹Ÿä¼šåœ¨èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤ºè¦†ç›–å›¾æ ‡ã€‚å¤šä¸ªè½¯ä»¶éƒ½æ˜¾ç¤ºè¦†ç›–å›¾æ ‡æ—¶ï¼Œä¼šç”±äºä¼˜å…ˆçº§é—®é¢˜å¯¼è‡´è¦†ç›–å›¾æ ‡ä¸æ˜¾ç¤ºçš„é—®é¢˜ã€‚ æœ¬æ–‡è®²è¿°å¦‚ä½•é€šè¿‡è°ƒæ•´è½¯ä»¶è¦†ç›–å›¾æ ‡çš„ä¼˜å…ˆçº§æ¥è§£å†³è¯¸å¦‚æ­¤ç±»çš„é—®é¢˜ã€‚ æ‰“å¼€æ³¨å†Œè¡¨ï¼š 1HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\ShellIconOverlayIdentifiers é€šè¿‡ä¿®æ”¹ShellIconOverlayIdentifiersçš„å„ä¸ªå­é¡¹çš„åç§°æ¥æ”¹å˜è¦†ç›–å›¾æ ‡æ˜¾ç¤ºçš„ä¼˜å…ˆçº§ã€‚ å¦‚ï¼š1Tortoise1Normalå°±æ’åœ¨2Tortoise2Modifiedçš„å‰é¢ã€‚ å‚è€ƒï¼šmanaging-overlay-icons","tags":["Windows"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"Windowså¹³å°ç¼–è¯‘WebRTCæºç ","path":"/post/2910781705.html","content":"å†™ä½œæœ¬æ–‡æ—¶ä½¿ç”¨çš„ webrtc ç‰ˆæœ¬ä¸ºï¼šbranch heads/67 ä¸€ã€ å‡†å¤‡å·¥ä½œ1.0 è¯·ç¡®ä¿å¯ä»¥è®¿é—®å›½å¤–ç½‘ç«™1.1 ç³»ç»Ÿè¯­è¨€åˆ‡æ¢åˆ°è‹±æ–‡ç³»ç»Ÿ Windows 7&#x2F;10 éƒ½å¯ä»¥ï¼Œåœ¨â€œæ§åˆ¶é¢æ¿â€â€“&gt;â€åŒºåŸŸå’Œè¯­è¨€â€â€“&gt;â€ç®¡ç†â€â€“&gt;â€æ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®â€ä¸­åˆ‡æ¢åˆ°â€œè‹±è¯­ï¼ˆç¾å›½ï¼‰â€ï¼Œç„¶åé‡å¯ç³»ç»Ÿã€‚ 1.2 å¸è½½éƒ¨åˆ†è½¯ä»¶æ—  1.3 å®‰è£… VS2017Visual Studio 2017 ç°åœ¨åªæä¾›åœ¨çº¿å®‰è£…åŒ…ï¼Œä¸ºäº†åŠ å¿«åœ¨çº¿å®‰è£…çš„é€Ÿåº¦ï¼Œå¯ä»¥åªé€‰æ‹©å¦‚ä¸‹å‡ ä¸ªå®‰è£…é¡¹ï¼š Desktop development with C++ MFC and ATL support 1.4 å®‰è£… Windows 10 SDKè™½ç„¶å®˜æ–¹æŒ‡å—ä¸Šé¢å†™çš„æ˜¯æ”¯æŒ 10.0.15063 åŠä»¥åçš„ç‰ˆæœ¬ï¼Œä½†ç¼–è¯‘é€‰é¡¹ä¸­é»˜è®¤æŒ‡å®šçš„æ˜¯ 10.0.15063 ç‰ˆæœ¬ï¼Œæ‰€ä»¥å»ºè®®å®‰è£… 10.0.15063 ç‰ˆæœ¬ã€‚å¦‚æœè¦ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„ SDKï¼Œå¯ä»¥åœ¨ä¸‰ã€ ç”Ÿæˆvsè§£å†³æ–¹æ¡ˆ è¿™ä¸€æ­¥ä¸­æŒ‡å®š--winsdk=&lt;sdk_version&gt;å‚æ•°ã€‚ 10.0.15063 ä¸‹è½½åœ°å€ï¼š 1https://download.microsoft.com/download/0/1/1/01111605-8CDF-4A88-BB06-C20E97E8B3D5/iso_windowssdk/15063.468.170612-1856.rs2_release_svc_sec_WindowsSDK.iso 1.5 å®‰è£… DirectX SDkä¸‹è½½åœ°å€ï¼š 1http://download.microsoft.com/download/A/E/7/AE743F1F-632B-4809-87A9-AA1BB3458E31/DXSDK_Jun10.exe å®‰è£… DirectX SDK June 2010ï¼Œå®‰è£…å®Œæˆåå¯èƒ½ä¼šæç¤ºâ€œs1023â€è¿™æ ·çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºä¸ç³»ç»Ÿå·²æœ‰çš„ visual c++ redistributable packages ç‰ˆæœ¬å†²çªï¼Œå¯ä»¥å¿½ç•¥ä¸ç®¡ã€‚ äºŒã€ æºç è·å–2.1 é…ç½® depot_toolsdepot_tools æ˜¯ webrtc æˆ– chromium ä½¿ç”¨çš„æºç ç®¡ç†å·¥å…·ï¼Œä»æ­¤å¤„ä¸‹è½½ï¼š 1https://storage.googleapis.com/chrome-infra/depot_tools.zip è§£å‹åˆ° D:\\webrtc\\depot_tools ä¸­ï¼Œæ·»åŠ è¯¥ç›®å½•åˆ°åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ PATHã€‚ å› ä¸º webrtc æˆ– chromium ä½¿ç”¨çš„ç¼–è¯‘ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½ä¸ä¹‹åŒ¹é…çš„ Python å’Œ Gitï¼Œä¸ºäº†é˜²æ­¢ç¼–è¯‘ç³»ç»Ÿé”™è¯¯ä½¿ç”¨åŸæœ‰çš„ç‰ˆæœ¬ï¼Œéœ€è¦å°†D:\\webrtc\\depot_toolsè·¯å¾„æ”¾åˆ° PATH çš„æœ€å‰é¢ï¼Œè‡³å°‘ä¹Ÿè¦æ”¾åˆ° Python å’Œ Git çš„å‰é¢ã€‚ 2.2 ç¯å¢ƒåˆå§‹åŒ–å…ˆè®¾ç½®å¦‚ä¸‹ç¯å¢ƒå˜é‡ï¼š 12DEPOT_TOOLS_WIN_TOOLCHAIN = 0GYP_GENERATORS = ninja,msvs-ninja ç„¶åä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œç³»ç»Ÿ cmd å‘½ä»¤è¡Œï¼ˆä¸è¦ä½¿ç”¨å…¶ä»–å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ cmderï¼‰ï¼Œä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 123d:cd D:\\webrtc # ç”¨æ¥è¿›å…¥webrtcç›®å½•ï¼Œç›®å½•åä¸ä¸€æ ·ï¼Œå‘½ä»¤ä¹Ÿä¸ä¸€æ ·gclient # éœ€è¦ä½¿ç”¨ç½‘ç»œä»£ç†ï¼Œè€—æ—¶è¾ƒé•¿ 2.3 ä¸‹è½½æºç å’Œä¾èµ–é¡¹æ–°å»º webrtc-checkout ç›®å½•ï¼Œä¸‹è½½æºç åˆ°è¯¥ç›®å½•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 12345mkdir webrtc-checkout # ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ–°å»ºcd webrtc-checkoutfetch --nohooks webrtc # è·å–æºç gclient sync # æ›´æ–°æºç gclient runhooks # è·å–DEPSæ–‡ä»¶ä¸­æŒ‡å®šçš„ä¾èµ–é¡¹ ä¸‰ã€ ç”Ÿæˆ vs è§£å†³æ–¹æ¡ˆè¿›å…¥ webrtc-checkout\\src ç›®å½•ï¼ˆ2.3 æ­¥éª¤ä¸­ä¸‹è½½çš„æºç ä¼šè‡ªåŠ¨å­˜å‚¨åˆ°è¯¥ç›®å½•ï¼‰,æ‰§è¡Œï¼š 1gn gen --ide=vs out/Debug æˆ–è€…åŠ å…¥è¯¦ç»†çš„é…ç½®å‚æ•°ï¼š 1gn gen out/x64/Debug --ide=vs --args=&quot;is_debug=true target_cpu=\\&quot;x64\\&quot;&quot; æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œåœ¨ out&#x2F;Debug ç›®å½•ä¸­ä¼šç”Ÿæˆ all.sln è§£å†³æ–¹æ¡ˆæ–‡ä»¶ã€‚ å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨gn gen --helpæŸ¥çœ‹å¸®åŠ©ï¼ŒèŠ‚é€‰å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940IDE options GN optionally generates files for IDE. Possibilities for &lt;ide options&gt; --ide=&lt;ide_name&gt; Generate files for an IDE. Currently supported values: &quot;eclipse&quot; - Eclipse CDT settings file. &quot;vs&quot; - Visual Studio project/solution files. (default Visual Studio version: 2017) &quot;vs2013&quot; - Visual Studio 2013 project/solution files. &quot;vs2015&quot; - Visual Studio 2015 project/solution files. &quot;vs2017&quot; - Visual Studio 2017 project/solution files. &quot;xcode&quot; - Xcode workspace/solution files. &quot;qtcreator&quot; - QtCreator project files. &quot;json&quot; - JSON file containing target information --filters=&lt;path_prefixes&gt; Semicolon-separated list of label patterns used to limit the set of generated projects (see &quot;gn help label_pattern&quot;). Only matching targets and their dependencies will be included in the solution. Only used for Visual Studio, Xcode and JSON.Visual Studio Flags --sln=&lt;file_name&gt; Override default sln file name (&quot;all&quot;). Solution file is written to the root build directory. --no-deps Don&#x27;t include targets dependencies to the solution. Changes the way how --filters option works. Only directly matching targets are included. --winsdk=&lt;sdk_version&gt; Use the specified Windows 10 SDK version to generate project files. As an example, &quot;10.0.15063.0&quot; can be specified to use Creators Update SDK instead of the default one. --ninja-extra-args=&lt;string&gt; This string is passed without any quoting to the ninja invocation command-line. Can be used to configure ninja flags, like &quot;-j&quot;. åœ¨ç¼–è¯‘è§£å†³æ–¹æ¡ˆä¸­çš„æŸäº›å·¥ç¨‹ï¼ˆå¦‚freetype_source, harfbuzz_sourceï¼‰æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°è¯¸å¦‚ä¸‹é¢çš„é”™è¯¯æç¤ºï¼š 1error C2220: è­¦å‘Šè¢«è§†ä¸ºé”™è¯¯ - æ²¡æœ‰ç”Ÿæˆâ€œobjectâ€æ–‡ä»¶ è¿™æ—¶æˆ‘ä»¬éœ€è¦è°ƒä½è­¦å‘Šç­‰çº§ï¼Œç¼–è¯‘å¯¹åº”çš„ ninja æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„/WXæ”¹æˆ/W3å³å¯ã€‚ å‚è€ƒï¼šhttps://chromium.googlesource.com/chromium/src/+/master/docs/windows_build_instructions.md","tags":["WebRTC"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(5)--Qtå­—ç¬¦ç¼–ç ","path":"/post/1204594779.html","content":"æˆ‘ä»¬ä»¥â€œæµ‹è¯•å­—ç¬¦ä¸²-ë³´ê³ ì‹¶ë‹¤-Test String.â€è¿™ä¸ªå­—ç¬¦ä¸²æ¥è¿›è¡Œè®²è§£ï¼Œå®ƒåŒ…å«äº†è‹±æ–‡ã€ä¸­æ–‡å’ŒéŸ©æ–‡ã€‚å› ä¸ºæˆ‘ä½¿ç”¨ Qt çš„æ–¹å¼æ˜¯Visual Studio + Qtåº“çš„å½¢å¼ï¼Œæ‰€ä»¥æœ¬æ–‡ä»¥Visual Studioçš„MSVCç¼–è¯‘å™¨ä¸ºä¾‹æ¥è¿›è¡Œè®²è§£ï¼Œä½†è¿™ç§æ–¹å¼çš„åŸç†ä¹Ÿé€‚ç”¨äºå…¶ä»–ç¼–è¯‘å™¨ã€‚ QString ä¸­ä½¿ç”¨ QChar æ¥å­˜å‚¨æ¯ä¸€ä¸ªå­—ç¬¦ï¼ŒQChar æ˜¯ short ç±»å‹ï¼Œå  2 ä¸ªå­—èŠ‚ï¼Œé»˜è®¤æŒ‰ Unicode ç¼–ç å­˜å‚¨ã€‚ é¦–å…ˆï¼Œä¸ºäº†ä¿è¯å†™åˆ°ä»£ç æ–‡ä»¶ä¸­çš„æµ‹è¯•å­—ç¬¦ä¸²èƒ½è¢« MSVC ç¼–è¯‘å™¨ç†è§£ï¼Œæˆ‘ä»¬éœ€è¦å°†æºæ–‡ä»¶ä¿å­˜ä¸ºUtf8-å¸¦ç­¾åçš„æ ¼å¼ã€‚å…·ä½“å‚è€ƒï¼šæ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(2)--ç¼–è¯‘å™¨å¤„ç†æ–‡ä»¶ç¼–ç  è§£å†³Qtç¨‹åºä¹±ç é—®é¢˜çš„å…³é”®åœ¨äºç†è§£QStringä¸­å­˜å‚¨å­—ç¬¦çš„ç¼–ç æ ¼å¼ã€‚ QString ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²çš„ç¼–ç æ ¼å¼å°±æ˜¯â€œç¼–è¯‘å™¨æ‰§è¡Œå­—ç¬¦é›†ç¼–ç æ ¼å¼â€ã€‚ è¿™ä¸€å¥è¯å¾ˆå…³é”®ã€‚ åœ¨ MSVC ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨#pragma execution_character_set(&quot;utf-8&quot;)æ¥æŒ‡å®šè¯¥æºæ–‡ä»¶çš„æ‰§è¡Œå­—ç¬¦é›†ç¼–ç æ ¼å¼ä¸º UTF8 æ ¼å¼ï¼Œè¿™æ · QString ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²æ ¼å¼å°±æ˜¯ utf8 ç¼–ç äº†ã€‚ ä¸‹é¢æ˜¯å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960void Demo01::qStringUseCase() &#123; /* è¯¥æºæ–‡ä»¶ä½¿ç”¨Utf8-BOMæ ¼å¼ä¿å­˜. æºå­—ç¬¦é›†ä¸ºUTF8-BOM. å¯æ‰§è¡Œå­—ç¬¦é›†ä¸ºUTF8ï¼š#pragma execution_character_set(&quot;utf-8&quot;) å®šä¹‰åœ¨stdafx.h. */#define TEST_STR_A &quot;æµ‹è¯•å­—ç¬¦ä¸²-ë³´ê³ ì‹¶ë‹¤-Test String.&quot;#define TEST_STR_W L&quot;æµ‹è¯•å­—ç¬¦ä¸²-ë³´ê³ ì‹¶ë‹¤-Test String.&quot; &#123; // å› ä¸ºå¯æ‰§è¡Œå­—ç¬¦é›†æ˜¯utf8ï¼Œæ‰€ä»¥ä½¿ç”¨OutputDebugStringAéœ€è¦è½¬æ¢æˆANSI OutputDebugStringA(Utf8ToAnsi(TEST_STR_A).c_str()); &#125; &#123; ui.lblLanguage-&gt;setText(TEST_STR_A); &#125; // char* --&gt; QString &#123; QString qstr = TEST_STR_A; qInfo() &lt;&lt; qstr; &#125; // QString --&gt; char*æˆ–std::string &#123; QString qstr = TEST_STR_A; std::string str = qstr.toStdString(); // ä¸èƒ½ç›´æ¥ä½¿ç”¨qstr.toStdString().c_str()æ¥è·å–ï¼Œå¿…é¡»å…ˆå°†qstr.toStdString()å­˜å…¥std::stringä¸­ const char* pStr = str.c_str(); QString qstr2 = QString::fromUtf8(pStr); Q_ASSERT(qstr == qstr2); &#125; // QString --&gt; wchar_t*æˆ–std::wstring &#123; QString qstr = TEST_STR_A; std::wstring str = qstr.toStdWString(); const wchar_t * pStr = str.c_str(); QString qstr2 = QString::fromWCharArray(pStr); Q_ASSERT(qstr == qstr2); &#125; // std::string --&gt; QString &#123; std::string str = TEST_STR_A; // std::stringä¸­å­˜å‚¨çš„æ˜¯UTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå¯æ‰§è¡Œå­—ç¬¦é›†ä¸ºUTF8 QString qstr = QString::fromStdString(str); &#125; // std::wstring --&gt; QString &#123; std::wstring str = TEST_STR_W; // std::wstringä¸­å­˜å‚¨çš„æ˜¯UTF-8ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå¯æ‰§è¡Œå­—ç¬¦é›†ä¸ºUTF8 QString qstr = QString::fromStdWString(str); &#125;&#125; QString::toLocal8BitQString æœ‰ä¸€ä¸ªåä¸ºtoLocal8Bitçš„æ–¹æ³•ï¼Œç½‘ä¸Šå¾ˆå¤šä»‹ç»å¦‚ä½•è§£å†³ä¹±ç çš„æ–‡ç« éƒ½ä¼šæåˆ°è¿™ä¸ªå‡½æ•°ã€‚å…³äºè¿™ä¸ªå‡½æ•°å®˜æ–¹çš„ä»‹ç»å¦‚ä¸‹ï¼š 12345Returns the local 8-bit representation of the string as a QByteArray. The returned byte array is undefined if the string contains characters not supported by the local 8-bit encoding.QTextCodec::codecForLocale() is used to perform the conversion from Unicode. If the locale encoding could not be determined, this function does the same as toLatin1().If this string contains any characters that cannot be encoded in the locale, the returned byte array is undefined. Those characters may be suppressed or replaced by another. ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªå‡½æ•°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºçš„ ANSI ç¼–ç ï¼Œé€šè¿‡æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(1)--å­—ç¬¦ç¼–ç æ¦‚è¿°ä»‹ç»ï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“ANSIæ˜¯å’Œå…·ä½“çš„ä»£ç é¡µç›¸å…³è”çš„ï¼ˆåœ¨ Windows ä¸­æ–‡ç¯å¢ƒä¸‹é»˜è®¤ä»£ç é¡µä¸º 936ï¼‰ã€‚Qt ä¸æ˜¯æ ¹æ®ç³»ç»Ÿä»£ç é¡µæ¥åšåˆ¤æ–­çš„ï¼Œè€Œæ˜¯é€šè¿‡QTextCodecæ¥åšåˆ¤æ–­çš„ï¼Œæ‰€ä»¥æ–‡æ¡£ä¸­ä¼šæåˆ°è¿™ä¸ªå‡½æ•°éœ€è¦ç»“åˆQTextCodec::codecForLocale()æ¥ä½¿ç”¨ï¼ŒtoLocal8Bitæ ¹æ®å¯¹åº”çš„QTextCodecæ¥åšç›¸åº”çš„è½¬æ¢ã€‚ æ€»ç»“æ‰€ä»¥è¦æƒ³åœ¨ä½¿ç”¨ Qt æ—¶ï¼Œé¿å…é‡åˆ°ä¸­æ–‡ä¹±ç é—®é¢˜ï¼Œåªéœ€è¦åœ¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ä¸­åŠ å…¥ï¼ˆå¯¹äºä¸ä½¿ç”¨é¢„ç¼–è¯‘å¤´çš„é¡¹ç›®å¯ä»¥åœ¨.cppæ–‡ä»¶ä¸­æ·»åŠ ï¼‰ï¼š 1#pragma execution_character_set(&quot;utf-8&quot;) åŒæ—¶ç”±äºéƒ¨åˆ†éŸ©æ–‡ã€æ—¥æ–‡ç­‰å­—ç¬¦ä¸åœ¨ Visual Studio é»˜è®¤çš„ä¸­æ–‡ GB2312 ç¼–ç ä¸­ï¼Œæ‰€ä»¥å¦‚æœé‡åˆ° Visual Studio æç¤ºâ€œæ­¤æ–‡ä»¶çš„æŸäº› Unicode å­—ç¬¦æœªèƒ½ä¿å­˜åˆ°å½“å‰ä»£ç é¡µä¸­â€æ—¶ï¼Œè¿™æ—¶åº”è¯¥é€‰æ‹©â€Utf8-å¸¦ç­¾åâ€œæ ¼å¼æ¥ä¿å­˜ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæºæ–‡ä»¶ä¿å­˜ä¸ºUtf8-å¸¦ç­¾åï¼Œä¸”è®¾ç½®#pragma execution_character_set(&quot;utf-8&quot;) å°±å¯ä»¥è§£å†³æ‰€æœ‰ä¹±ç é—®é¢˜ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["Qt","å­—ç¬¦ç¼–ç "],"categories":["Qt"]},{"title":"Windowså†…å­˜ä½“ç³»(7)--ä½¿ç”¨std::stringè·¨MTæ¨¡å—ä¼ å‚","path":"/post/3937624737.html","content":"å‰é¢çš„Windowså†…å­˜ä½“ç³»(6)--è·¨æ¨¡å—å†…å­˜åˆ†é…é‡Šæ”¾æ–‡ç« è§£é‡Šäº†è·¨ MT æ¨¡å—åˆ†é…çš„å†…å­˜ç›¸äº’é‡Šæ”¾ä¸ºä»€ä¹ˆä¼šå´©æºƒçš„é—®é¢˜ï¼Œæœ¬æ–‡ä»‹ç»å¦‚ä½•è§£å†³è¯¥é—®é¢˜ã€‚ ä¸€ã€é—®é¢˜æè¿°è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼šé’ˆå¯¹ MT æ¨¡å—å®šä¹‰æ¥å£å‡½æ•°æ—¶ï¼Œæ¥å£å‚æ•°ä½¿ç”¨std::stringç±»å‹ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶é‡åˆ°&quot;Debug Assertioni Failed&quot;é”™è¯¯çš„é—®é¢˜ã€‚ ä¸Šé¢çš„é”™è¯¯æç¤ºæ˜¯debug_heap.cppæ–‡ä»¶ä¸­çš„ä¸€ä¸ªè°ƒè¯•æ–­è¨€ï¼ˆreleaseæ¨¡å¼ä¸‹è°ƒç”¨çš„æ˜¯heap.cppä¸­çš„åˆ†é…å‡½æ•°ï¼‰ï¼Œç”¨äºåˆ¤æ–­æŒ‡é’ˆæ˜¯å¦æŒ‡å‘å †åˆ†é…çš„å†…å­˜å—çš„ç¬¬ä¸€å—ã€‚åœ¨ release æ¨¡å¼ä¸‹ä¸ä¼šå¼¹å‡ºè¿™æ ·çš„æ–­è¨€é”™è¯¯ï¼Œç¨‹åºå¯èƒ½ä¼šç›´æ¥å´©æºƒï¼ˆå´©æºƒç›¸å¯¹æ¥è¯´è¿˜æ¯”è¾ƒå¥½æ’æŸ¥ï¼‰ï¼Œæˆ–è€…å‡ºç°å…¶ä»–ä¸å¯é¢„æ–™çš„ã€éš¾ä»¥æ’æŸ¥çš„é”™è¯¯ã€‚ äºŒã€å®ä¾‹ç°æœ‰DLLUser.exeè°ƒç”¨DLL.dllä¸­çš„TestFunå‡½æ•°ï¼Œä»£ç é‡éå¸¸å°ï¼š DLL.dllä¸­TestFunå‡½æ•°å®šä¹‰ï¼š1234DLL_API void TestFun( std::string str)&#123; return;&#125; DLLUser.exeä¸­è°ƒç”¨TestFunå‡½æ•°ï¼š123456789int _tmain(int argc, _TCHAR* argv[])&#123; std::string str = &quot;test&quot;; TestFun(str); return 0;&#125; ä¸Šé¢çš„ä»£ç è¿è¡Œä¹‹åç¨‹åºå°±ä¼šå¼¹å‡ºé”™è¯¯æ–­è¨€ã€‚åŸå› æ˜¯std::stringåœ¨è¿›è¡Œå€¼ä¼ å‚çš„è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œå³ï¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜å—ï¼Œæ‹·è´â€œtestâ€åˆ°å†…å­˜å—ä¸­ï¼Œç„¶åå°†ä¸´æ—¶å½¢å‚std::stringå¯¹è±¡ä¼ é€’åˆ° dll ä¸­ï¼Œdll ä¸­çš„TestFunå‡½æ•°åœ¨ä½œç”¨åŸŸç»“æŸåå¯¹ä¸´æ—¶å½¢å‚è¿›è¡Œé‡Šæ”¾æ—¶å°±å‡ºç°äº†é”™è¯¯ï¼Œå› ä¸ºå°è¯•åœ¨dllçš„crtå †ä¸­é‡Šæ”¾ç”±åœ¨exeçš„crtå †ä¸­åˆ†é…çš„å†…å­˜å—ã€‚ ä¸‰ã€è‡ªå®šä¹‰std::allocatoré€šè¿‡ä¸Šé¢é—®é¢˜çš„åˆ†æï¼ŒåŠ ä¸Šå‰é¢å‡ ç¯‡æ–‡ç« å¯¹ Windows å†…å­˜ä½“ç³»çš„ä»‹ç»ï¼Œæˆ‘ä»¬ä¸éš¾æƒ³å‡ºè§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ï¼šè®©std::stringç»Ÿä¸€åœ¨è¿›ç¨‹çš„é»˜è®¤å †ä¸Šåˆ†é…å†…å­˜å—ï¼Œè€Œä¸æ˜¯åœ¨å„ä¸ªæ¨¡å—çš„crtå †ä¸Šåˆ†é…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;windows.h&gt;#include &lt;string&gt;#include &lt;vector&gt;template &lt;typename T&gt;class vm_allocator : public std::allocator&lt;T&gt; &#123;public: typedef size_t size_type; typedef T* pointer; typedef const T* const_pointer; template&lt;typename _Tp1&gt; struct rebind &#123; typedef vm_allocator&lt;_Tp1&gt; other; &#125;; pointer allocate(size_type n, const void *hint = 0) &#123; UNREFERENCED_PARAMETER(hint); void* pBuffer = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, n * sizeof(T)); return (pointer)pBuffer; &#125; void deallocate(pointer p, size_type n) &#123; UNREFERENCED_PARAMETER(n); if (p) &#123; HeapFree(GetProcessHeap(), 0, p); &#125; &#125; vm_allocator() throw() : std::allocator&lt;T&gt;() &#123; &#125; vm_allocator(const vm_allocator &amp;a) throw() : std::allocator&lt;T&gt;(a) &#123; &#125; template &lt;class U&gt; vm_allocator(const vm_allocator&lt;U&gt; &amp;a) throw() : std::allocator&lt;T&gt;(a) &#123; &#125; ~vm_allocator() throw() &#123; &#125;&#125;;typedef std::basic_string&lt;char, std::char_traits&lt;char&gt;, vm_allocator&lt;char&gt; &gt; mystring; ä¸Šé¢çš„ä»£ç ä½¿ç”¨è‡ªå®šä¹‰çš„å†…å­˜åˆ†é…å™¨vm_allocator&lt;char&gt;å®šä¹‰äº†mystringç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å°†TestFunå‡½æ•°æ¥å£ä¸­çš„std::stringä¿®æ”¹ä¸ºmystringå³å¯è§£å†³å´©æºƒé—®é¢˜ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å †","è¿è¡Œæ—¶åº“"],"categories":["Windowsç¼–ç¨‹"]},{"title":"WavéŸ³é¢‘ç¼–ç ","path":"/post/3666885372.html","content":"ä¸€. WAVE ç®€ä»‹WAVæ ¼å¼æ˜¯å¾®è½¯å…¬å¸ï¼ˆMicrosoftï¼‰å¼€å‘çš„ä¸€ç§å£°éŸ³æ–‡ä»¶æ ¼å¼ï¼Œå®ƒç¬¦åˆ RIFF(Resource Interchange File Format)æ–‡ä»¶è§„èŒƒï¼Œç”¨äºä¿å­˜ Windows å¹³å°çš„éŸ³é¢‘ä¿¡æ¯èµ„æºï¼Œè¢« Windows å¹³å°åŠå…¶åº”ç”¨ç¨‹åºæ‰€å¹¿æ³›æ”¯æŒã€‚ WAVE æ˜¯å½•éŸ³æ—¶ç”¨çš„æ ‡å‡†çš„ WINDOWS æ–‡ä»¶æ ¼å¼ï¼Œæ–‡ä»¶çš„æ‰©å±•åä¸ºâ€œWAVâ€ï¼Œæ•°æ®æœ¬èº«çš„æ ¼å¼ä¸º PCM æˆ–å…¶ä»–å‹ç¼©æ•°æ®ï¼Œå±äºæ— æŸéŸ³ä¹æ ¼å¼çš„ä¸€ç§ã€‚ æ‰€æœ‰çš„ WAV éƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œè¿™ä¸ªæ–‡ä»¶å¤´è®°å½•äº†éŸ³é¢‘æµçš„ç¼–ç å‚æ•°ã€‚WAVæ–‡ä»¶ = WAVå¤´ + PCMæ•°æ®ã€‚ äºŒ. éŸ³é¢‘ç¼–ç å‚æ•°åœ¨ä»‹ç» WAVE æ–‡ä»¶å¤´ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸‹éŸ³é¢‘ç¼–ç çš„å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š å£°é“æ•°é‡(NumChannels)å£°é“æ•°æ˜¯æŒ‡æ”¯æŒèƒ½ä¸åŒå‘å£°çš„éŸ³å“çš„ä¸ªæ•°ï¼Œå®ƒæ˜¯è¡¡é‡éŸ³å“è®¾å¤‡çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚æˆ‘ä»¬æˆ´çš„è€³æœºå› ä¸ºåªæœ‰å·¦å³ 2 ä¸ªå–‡å­ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½æ”¯æŒ 2 ä¸ªå£°é“æ•°é‡ã€‚å•å£°é“ï¼ˆmonoï¼‰çš„å£°é“æ•°ä¸º 1ï¼›ç«‹ä½“å£°é“ï¼ˆstereoï¼‰çš„å£°é“æ•°é»˜è®¤ä¸º 2ï¼Œå³å·¦å³å£°é“ï¼›å››å£°é“å³å‰å·¦ã€å‰å³ï¼Œåå·¦ã€åå³ä¾› 4 ä¸ªå‘éŸ³ç‚¹ï¼›ç›®å‰è¿˜æœ‰ 5.1 å£°é“ã€7.1 å£°é“ã€‚ å¯¹äºéŸ³é¢‘ç¼–ç å­˜å‚¨æ¥è¯´ï¼Œæ¯å¤šä¸€ä¸ªå£°é“ï¼Œå°±è¦å¤šå­˜å‚¨ä¸€ä»½æ•°æ®ã€‚ é‡‡æ ·ç‡(SampleRate)è¡¨ç¤ºæ¯ç§’é‡‡æ ·çš„æ¬¡æ•°ï¼Œå¸¸è§çš„æœ‰ 8000, 16000, 32000, 44100, 48000ã€‚ é‡‡æ ·ç²¾åº¦(BitPerSample)è¡¨ç¤ºæ¯æ¬¡ä»æ¯ä¸ªå£°é“é‡‡æ ·çš„æ•°æ®çš„å¤§å°ï¼Œä»¥æ¯”ç‰¹ä½å•ä½ã€‚ä¸€èˆ¬ä¸º 16,32ã€‚16 å³ 16 æ¯”ç‰¹ï¼Œä¹Ÿå°±æ˜¯ 2 ä¸ªå­—èŠ‚ã€‚ æ¯”ç‰¹ç‡(ByteRate)è¡¨ç¤ºæ¯ç§’çš„éŸ³é¢‘æ•°æ®å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå¯ä»¥æ ¹æ®ä¸Šé¢å‡ ä¸ªå‚æ•°æ±‚å¾—ã€‚ByteRate = SampleRate * NumChannels * BitPerSample / 8 ä¸‰. WAVE æ–‡ä»¶å¤´ åç§» å­—æ®µå­—èŠ‚æ•° å­—æ®µå è§£é‡Š 0 4 ChunkID â€œRIFFâ€ä¸² åè¿›åˆ¶å¤§ç«¯è¡¨ç¤ºä¸º 0x52494646 4 4 ChunkSize æ•´ä¸ªæ–‡ä»¶çš„å¤§å°å‡å» 8 å­—èŠ‚(ChunkID+ChunkSize)ã€‚36 + SubChunk2Sizeæˆ–è€… 4 + (8 + SubChunk1Size) + (8 + SubChunk2Size) 8 4 Format â€œWAVEâ€ä¸²ï¼Œåå…­è¿›åˆ¶å¤§ç«¯è¡¨ç¤ºä¸º 0x57415645 12 4 Subchunk1ID â€œfmt â€œä¸²ï¼Œåå…­è¿›åˆ¶å¤§ç«¯è¡¨ç¤ºä¸º 0x666d7420 16 4 Subchunk1Size æ•´ä¸ª Subchunk1 çš„å¤§å°å‡å»è¯¥å­—æ®µæœ¬èº«æ‰€å çš„ 4 å­—èŠ‚ï¼Œå¯¹äº PCM æ¥è¯´å›ºå®šä¸º 16 20 2 AudioFormat PCM æ ¼å¼ä¸º 1ï¼Œå¤§äº 1 è¡¨ç¤ºå…¶ä»–å‹ç¼©æ ¼å¼ 22 2 NumChannels å£°é“æ•°é‡ï¼Œå¦‚ Mono &#x3D; 1, Stereo &#x3D; 2 24 4 SampleRate é‡‡æ ·ç‡ï¼Œå¦‚ 8000, 44100 ç­‰ 28 4 ByteRate æ¯”ç‰¹ç‡ï¼Œ ç­‰äºSampleRate * NumChannels * BitsPerSample/8 32 2 BlockAlign æ¯ä¸ª Sample çš„å¤§å°ï¼Œç­‰äºNumChannels * BitsPerSample/8 34 2 BitsPerSample é‡‡æ ·ç²¾åº¦ï¼Œå¦‚ 8,16,32 36 4 Subchunk2ID â€œdataâ€ä¸²ï¼Œåå…­è¿›åˆ¶å¤§ç«¯è¡¨ç¤ºä¸º 0x64617461 40 4 Subchunk2Size å®é™…éŸ³é¢‘æ•°æ®çš„å¤§å°ï¼Œä¸åŒ…å« Subchunk2ID å’Œ Subchunk2Size è¿™ 2 ä¸ªå­—æ®µçš„å¤§å° 44 * Data å®é™…çš„éŸ³é¢‘æ•°æ® ä¸‹å›¾æ˜¯ä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºçš„ä¸€ä¸ª WAV æ–‡ä»¶çš„å‰ 72 å­—èŠ‚ï¼š å››. ä»å…¶ä»–ç¼–ç è½¬ WAVEæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ffmpeg.exe å°†éŸ³é¢‘ä»å…¶ä»–ç¼–ç è½¬ä¸º wave ç¼–ç ï¼Œå‘½ä»¤å¦‚ä¸‹: 1ffmpeg.exe -i input.mp3 output.wav æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¦‚é‡‡ç”¨ç‡ï¼Œé‡‡æ ·ç²¾åº¦ï¼Œå£°é“æ•°ï¼Œå¦‚ï¼š 1ffmpeg.exe -f u16le -ar 44100 -ac 1 -i input.mp3 output.wav ffmpeg å‚æ•°è§£é‡Šè§ï¼šhttp://trac.ffmpeg.org/wiki/audio%20types ffmpeg ç”Ÿæˆçš„ wav æ–‡ä»¶çš„æ–‡ä»¶å¤´å¯èƒ½å’Œæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„ä¸å¤ªä¸€æ ·ï¼Œå®ƒå¯èƒ½ä¼šåŒ…å«LISTå’ŒINFOæ•°æ®å—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å°±éœ€è¦é€šè¿‡ 2 ä¸ªæ­¥éª¤æ¥ç”Ÿæˆä¸åŒ…å«LISTå’ŒINFOæ•°æ®å—çš„ WAV æ–‡ä»¶äº†ï¼šé¦–å…ˆé€šè¿‡ ffmpeg.exe å°†éŸ³é¢‘æ–‡ä»¶è½¬æˆ pcm è£¸æ•°æ®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å…¶ä»–å·¥å…·ï¼ˆå¦‚audacityï¼‰ä¸ºè¯¥ pcm è£¸æ•°æ®åŠ ä¸Š wav å¤´ã€‚ ffmpeg å°†éŸ³é¢‘è½¬æˆ pcm è£¸æ•°æ®å‘½ä»¤å¦‚ä¸‹ï¼š 1ffmpeg.exe -f s16le -c:a pcm_u16le -i input.mp3 output.raw äº”ã€WebRTC å¯¹ Wav æ ¼å¼æ”¯æŒWebRTC æºç src\\common_audioç›®å½•ä¸­çš„wav_header.hå’Œwav_file.hæä¾›äº†å¯¹ wav çš„è¯»å†™åŠŸèƒ½ã€‚","tags":["Wav"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(6)--è·¨æ¨¡å—å†…å­˜åˆ†é…é‡Šæ”¾","path":"/post/213040252.html","content":"åœ¨ã€ŠWindowsæ ¸å¿ƒç¼–ç¨‹ ç¬¬äº”ç‰ˆã€‹ç¬¬19ç«  DLLåŸºç¡€ï¼ˆ511é¡µï¼‰ä¸­ç»™å‡ºäº†ä¸€ä¸ªå»ºè®®ï¼š â€œå½“ä¸€ä¸ª MT ç‰ˆæœ¬çš„æ¨¡å—å¦‚æœæä¾›ä¸€ä¸ªå†…å­˜åˆ†é…å‡½æ•°çš„æ—¶å€™ï¼Œå®ƒå¿…é¡»åŒæ—¶æä¾›å¦ä¸€ä¸ªç”¨æ¥é‡Šæ”¾å†…å­˜çš„å‡½æ•°ã€‚â€ã€‚ è¯´å¾—æ›´åŠ ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼Œâ€œå¯¹äº MT çš„æ¨¡å—ï¼Œä¸è¦è·¨æ¨¡å—è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚â€ã€‚ä½†æ˜¯æ ¸å¿ƒç¼–ç¨‹è¿™æœ¬ä¹¦ä¸Šé¢æ²¡æœ‰å…·ä½“åˆ†æåŸå› ï¼Œæœ¬æ–‡å°±æ¥åˆ†æå…·ä½“çš„åŸå› ã€‚ ä¸€ã€ä¸åŒå †åˆ†é…çš„å†…å­˜å—ä¸èƒ½ç›¸äº’é‡Šæ”¾Windows çš„å †ç®¡ç†å™¨å¯¹æ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤äº†å¤šä¸ªâ€œå †â€ï¼Œæˆ‘ä»¬ä»æ¯ä¸ªâ€œå †â€ä¸­åˆ†é…å¤„ç†çš„å†…å­˜å—çš„åœ°å€éƒ½ä¸ä¸€æ ·ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å°†ä»â€œå † Aâ€ä¸­åˆ†é…å‡ºæ¥çš„å†…å­˜å—æ‹¿åˆ°â€œå † Bâ€ä¸­ï¼Œè®©â€œå † Bâ€æ¥é‡Šæ”¾ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚ å¦‚ä¸Šå›¾ï¼Œé€šè¿‡mallocå‡½æ•°ä»â€œå † Aâ€ä¸­åˆ†é… 100 å­—èŠ‚å†…å­˜å—ï¼Œå†…å­˜å—åœ°å€ä¸º0x123456ï¼›ä»â€œå † Bâ€ä¸­åˆ†é… 100 å­—èŠ‚å†…å­˜å—ï¼Œå†…å­˜å—åœ°å€ä¸º0x345678.å¦‚æœå°†0x123456è¿™ä¸ªåœ°å€æ‹¿åˆ°â€œå † Bâ€ä¸­å»é‡Šæ”¾ï¼ŒåŠ¿å¿…ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œå› ä¸ºâ€œå † Bâ€ä¸­æ²¡æœ‰è¿™åœ°å€ã€‚ é‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥ä½¿ç”¨HeapFreeå‡½æ•°æ¥é‡Šæ”¾hHeapå‚æ•°æŒ‡å®šçš„â€œå †â€ä¸­çš„ä»»ä½•å†…å­˜å—äº†ã€‚ç­”æ¡ˆæ˜¯ï¼šä¸èƒ½ã€‚å›å¿†å‰é¢ä»‹ç»çš„HeapFreeå‡½æ•°ï¼Œ 12345BOOL HeapFree( HANDLE hHeap, DWORD dwFlags, LPVOID lpMem); è¿™ä¸ªå‡½æ•°åªè¦æ±‚ä¼ å…¥äº†å†…å­˜å—çš„èµ·å§‹åœ°å€æŒ‡é’ˆï¼Œä½†æ²¡æœ‰è¦æ±‚ä¼ å…¥éœ€è¦é‡Šæ”¾çš„å†…å­˜å—çš„å¤§å°ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°æ˜¯å¦‚ä½•çŸ¥é“èµ·å§‹åœ°å€æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—çš„å¤§å°äº†ï¼Ÿ æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼ŒHeapAllocå‡½æ•°æ¯æ¬¡åˆ†é…å†…å­˜å—çš„æ—¶å€™éƒ½ä¼šé¢å¤–åˆ†é…ä¸€ç‚¹ç©ºé—´ç”¨äºå­˜å‚¨ä¸€ä¸ªç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ä¸­å­˜å‚¨äº†æœ¬æ¬¡åˆ†é…çš„å†…å­˜å—çš„å¤§å°ç­‰ä¿¡æ¯ã€‚å¤§è‡´å¦‚ä¸‹å›¾ï¼š æ‰€ä»¥ï¼ŒHeapFreeå‡½æ•°é¦–å…ˆä¼šé€šè¿‡lpMemæŒ‡é’ˆè®¡ç®—å‡ºâ€œç»“æ„ä½“â€çš„åœ°å€ï¼Œç„¶åä»ç»“æ„ä½“ä¸­è·å–åˆ°åˆ†é…çš„å†…å­˜å—çš„å…·ä½“å¤§å°ï¼Œæœ€åæ‰§è¡Œé‡Šæ”¾æ“ä½œã€‚ åŸºäºä¸Šé¢çš„åŸå› ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨HeapFreeå‡½æ•°çš„lpMemå‚æ•°ä¸­ä¼ å…¥éšæ„çš„åœ°å€ï¼Œå› ä¸ºè¯¥åœ°å€å¤„å¯èƒ½æ²¡æœ‰å­˜å‚¨ç”¨äºå­˜æ”¾å†…å­˜å—ä¿¡æ¯çš„ç»“æ„ä½“ï¼Œæ‰€ä»¥é‡Šæ”¾æ“ä½œå°±ä¼šå¤±è´¥ã€‚freeå‡½æ•°ä¹Ÿä¸€æ ·ï¼Œå› ä¸ºfreeå‡½æ•°å†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨çš„HeapFreeå‡½æ•°ã€‚ äºŒã€MD æ¨¡å—å†…å­˜å¯ä»¥ç›¸äº’é‡Šæ”¾ä¸ºä»€ä¹ˆ MDæ¨¡å—å†…å­˜å¯ä»¥ç›¸äº’é‡Šæ”¾ï¼Œè€ŒMTæ¨¡å—çš„å´ä¸å¯ä»¥äº†ï¼Ÿ 2.1 MT æ¨¡å—å†…å­˜ç›¸äº’é‡Šæ”¾ä¼šå´©æºƒæˆ‘ä»¬å…ˆåˆ†æä¸ºä»€ä¹ˆ MT æ¨¡å—çš„å†…å­˜é—´ç›¸äº’é‡Šæ”¾ä¼šå´©æºƒï¼Ÿ ç°åœ¨æœ‰ 2 ä¸ªæ¨¡å—ï¼ˆA.dllå’ŒB.dllï¼‰éƒ½æ˜¯ä½¿ç”¨MTè¿è¡Œæ—¶åº“ï¼Œå³åŠ è½½çš„é™æ€åº“libcmt.libï¼ˆå¯ä»¥å‚è€ƒç†è§£C&#x2F;C++è¿è¡Œæ—¶åº“ï¼‰ï¼Œåœ¨A.dllä¸­ä½¿ç”¨mallocåˆ†é… 100 å­—èŠ‚çš„å†…å­˜ï¼Œmallocè¿”å›çš„å†…å­˜åœ°å€ä¸º0x123456ã€‚ç„¶åå°†è¯¥åœ°å€ä¼ ç»™B.dllï¼Œåœ¨B.dllä¸­è°ƒç”¨freeå‡½æ•°æ¥é‡Šæ”¾è¿™ä¸ªå†…å­˜ã€‚å¦‚å›¾ï¼š ä»Windowså†…å­˜ä½“ç³»(5)--å †æˆ‘ä»¬çŸ¥é“ï¼ŒDLL åœ¨å¯åŠ¨ä»£ç _DllMainCRTStartupä¸­ä¼šå»ºç«‹ä¸€ä¸ªâ€œå †â€ï¼ˆå †å¥æŸ„å­˜æ”¾åœ¨_crtheap å˜é‡ä¸­ï¼‰ï¼Œæ‰€ä»¥ A.dll å’Œ B.dll ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ª crt å †ã€‚ ä¸ºäº†åŒºåˆ†ï¼Œæˆ‘ä»¬å°†A.dllä¸­çš„crtå †ç§°ä½œ_crtheap_Aï¼ŒB.dllä¸­çš„crtå †ç§°ä½œ_crtheap_Bã€‚ ä»ä¸Šé¢å›¾å¯ä»¥çœ‹åˆ°ï¼ŒA.dllä¸­mallocçš„å†…å­˜æ‹¿åˆ°B.dllå»ä¸­å»freeï¼Œå°±ç›¸å½“äºä»å †_crtheap_Aä¸­åˆ†é…çš„å†…å­˜æ‹¿åˆ°å¦ä¸€ä¸ªå †_crtheap_Bä¸­çš„é‡Šæ”¾ã€‚ç¬¬ä¸€èŠ‚å·²ç»è§£é‡Šäº†ä¸ºä»€ä¹ˆä¸èƒ½è¿™æ ·åšäº†ã€‚ 2.2 MD æ¨¡å—å†…å­˜ç›¸äº’é‡Šæ”¾ä¸ä¼šå´©æºƒç°åœ¨æˆ‘ä»¬åˆ†æä¸ºä»€ä¹ˆ MD æ¨¡å—çš„å†…å­˜é—´ç›¸äº’é‡Šæ”¾ä¸ä¼šå´©æºƒã€‚ è¿˜æ˜¯ 2 ä¸ªæ¨¡å—ï¼ˆA.dllå’ŒB.dllï¼‰ï¼Œä½†æ˜¯ç°åœ¨ä»–ä»¬éƒ½æ˜¯ä½¿ç”¨MDè¿è¡Œæ—¶åº“ï¼Œå³åŠ è½½çš„åŠ¨æ€åº“msvcr100.dllï¼Œç¨‹åºçš„ä»£ç çš„è¿‡ç¨‹å’Œä¸Šé¢ä¸€æ ·ï¼Œè¿˜æ˜¯åœ¨A.dllä¸­ä½¿ç”¨mallocåˆ†é… 100 å­—èŠ‚çš„å†…å­˜ï¼Œmallocè¿”å›çš„å†…å­˜åœ°å€ä¸º0x123456ã€‚ç„¶åå°†è¯¥åœ°å€ä¼ ç»™B.dllï¼Œåœ¨B.dllä¸­è°ƒç”¨freeå‡½æ•°æ¥é‡Šæ”¾è¿™ä¸ªå†…å­˜ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™ç¨‹åºå´ä¸ä¼šå´©æºƒï¼Œé€šè¿‡ä¸‹é¢çš„å›¾æˆ‘ä»¬åŸºæœ¬å¯ä»¥æ˜ç™½åŸå› äº†ï¼Œå¦‚å›¾ï¼š å› ä¸º Aã€B ä¸¤ä¸ª dll éƒ½æ˜¯é“¾æ¥çš„Â·msvcr100.dllÂ·ï¼ŒåŒä¸€ä¸ª dll åœ¨ä¸€ä¸ªè¿›ç¨‹åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œæ‰€ä»¥è¿›ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ª crt å †ï¼ˆ_crtheapï¼‰ï¼Œmallocå’Œfreeéƒ½æ˜¯è¿è¡Œæ—¶åº“æä¾›çš„å‡½æ•°ï¼Œæ‰€ä»¥éƒ½ä¼šè°ƒåˆ°è¿è¡Œæ—¶åº“é‡Œé¢å»ï¼Œç„¶åä»è¿è¡Œæ—¶åº“é‡Œé¢çš„_crtheapåˆ†é…å’Œé‡Šæ”¾å†…å­˜å—ã€‚å› ä¸ºåˆ†é…å’Œé‡Šæ”¾éƒ½æ˜¯åœ¨åŒä¸€ä¸ªå †ä¸Šï¼Œæ‰€ä»¥ä¸ä¼šå´©æºƒã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å †"],"categories":["Windowsç¼–ç¨‹"]},{"title":"WebRTCå®˜æ–¹ç¤ºä¾‹apprtcæ­å»º","path":"/post/201024982.html","content":"ç³»ç»Ÿç¯å¢ƒ Ubuntu 16.04ï¼Œåœ¨æ­å»ºä¹‹å‰å»ºè®®å…³é—­ç³»ç»Ÿé˜²ç«å¢™ã€‚ ä¸€. æˆ¿é—´æœåŠ¡å™¨æ­å»º1.1 å®‰è£…ä¾èµ–ç¨‹åº1apt-get install git unzip lrzsz nodejs npm automake autoconf libtool nodejs-legacy python-webtest golang â€“y 1.2 å®‰è£…jdk81.2.1 ä¸‹è½½jdk8ä»æ­¤å¤„ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬åˆ°/usr/lib/jvmç›®å½•ï¼Œç„¶åè§£å‹åˆ°å½“å‰ç›®å½•ï¼š 1tar zxf jdk-8u151-linux-x64.tar.gz 1.2.2 è®¾ç½®ç¯å¢ƒå˜é‡ç¼–è¾‘/etc/sourceæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆå› ä¸ºjdkç‰ˆæœ¬ä¸åŒï¼Œæ–‡ä»¶å¤¹åç§°å¯èƒ½ä¼šæœ‰å·®åˆ«ï¼‰ï¼š 123export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_151export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar æ‰§è¡Œsource /etc/profileå‘½ä»¤è®©è®¾ç½®ç”Ÿæ•ˆã€‚ 1.3 apprtcè·å–å’Œå®‰è£…1.3.1 è·å–apprtcæºç 12cd ~git clone https://github.com/webrtc/apprtc.git 1.3.2 å®‰è£…apprtc1234cd apprtcnpm -g install grunt-clinpm installgrunt build --force 1.3.3 ä¿®æ”¹æºç ä½¿ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹æœ¬æœºIPä¿¡æ¯ï¼š æˆ‘ä½¿ç”¨çš„é˜¿é‡Œäº‘çš„äº‘æœå™¨ï¼ŒæœåŠ¡å™¨åœ¨NATä¹‹åï¼Œæ‰€ä»¥172.18.163.203æ˜¯æœ¬åœ°IPï¼Œå³å†…ç½‘IPï¼›ä»äº‘æœåŠ¡å™¨çš„ç®¡ç†é¡µé¢å¯ä»¥çœ‹åˆ°è¯¥æœåŠ¡å™¨çš„å¤–ç½‘IPï¼Œå¦‚120.79.164.111ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘ç­‰æœåŠ¡å™¨è¿˜éœ€è¦åœ¨å®‰å…¨ç­–ç•¥ä¸­è®¾ç½®å°†æ‰€æœ‰è¿›&#x2F;å‡ºç«¯å£éƒ½æ˜ å°„åˆ°172.18.163.203ã€‚ ä¸‹é¢ä»¥å¤–ç½‘IP 120.79.164.111ä¸ºä¾‹ï¼Œæ ¹æ®å®é™…å¤–ç½‘IPè¿›è¡Œå¯¹åº”ä¿®æ”¹ã€‚ ä¿®æ”¹constants.pyconstants.pyè·¯å¾„ï¼šapprtc&#x2F;out&#x2F;app_engine&#x2F;constants.py è®¾ç½®ICEæœåŠ¡å™¨çš„IPç«¯å£ã€ä¿¡ä»¤æœåŠ¡å™¨(collider)çš„IPç«¯å£ï¼Œä¿®æ”¹ä¹‹åçš„constants.pyæ–‡ä»¶å®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# Copyright 2015 Google Inc. All Rights Reserved.&quot;&quot;&quot;AppRTC Constants.This module contains the constants used in AppRTC Python modules.&quot;&quot;&quot;import os# Deprecated domains which we should to redirect to REDIRECT_URL.REDIRECT_DOMAINS = [ &#x27;apprtc.appspot.com&#x27;, &#x27;apprtc.webrtc.org&#x27;, &#x27;www.appr.tc&#x27;]# URL which we should redirect to if matching in REDIRECT_DOMAINS.REDIRECT_URL = &#x27;https://appr.tc&#x27;ROOM_MEMCACHE_EXPIRATION_SEC = 60 * 60 * 24MEMCACHE_RETRY_LIMIT = 100LOOPBACK_CLIENT_ID = &#x27;LOOPBACK_CLIENT_ID&#x27;# Turn/Stun server override. This allows AppRTC to connect to turn servers# directly rather than retrieving them from an ICE server provider.ICE_SERVER_OVERRIDE = None# Enable by uncomment below and comment out above, then specify turn and stun# ICE_SERVER_OVERRIDE = [# &#123;# &quot;urls&quot;: [# &quot;turn:hostname/IpToTurnServer:19305?transport=udp&quot;,# &quot;turn:hostname/IpToTurnServer:19305?transport=tcp&quot;# ],# &quot;username&quot;: &quot;TurnServerUsername&quot;,# &quot;credential&quot;: &quot;TurnServerCredentials&quot;# &#125;,# &#123;# &quot;urls&quot;: [# &quot;stun:hostname/IpToStunServer:19302&quot;# ]# &#125;# ]ICE_SERVER_BASE_URL = &#x27;http://120.79.164.111:3033&#x27;ICE_SERVER_URL_TEMPLATE = &#x27;%s/v1alpha/iceconfig?key=%s&#x27;ICE_SERVER_API_KEY = os.environ.get(&#x27;ICE_SERVER_API_KEY&#x27;)# Dictionary keys in the collider instance info constant.WSS_INSTANCE_HOST_KEY = &#x27;host_port_pair&#x27;WSS_INSTANCE_NAME_KEY = &#x27;vm_name&#x27;WSS_INSTANCE_ZONE_KEY = &#x27;zone&#x27;WSS_INSTANCES = [&#123; WSS_INSTANCE_HOST_KEY: &#x27;120.79.164.111:8089&#x27;, WSS_INSTANCE_NAME_KEY: &#x27;wsserver-std&#x27;, WSS_INSTANCE_ZONE_KEY: &#x27;us-central1-a&#x27;&#125;, &#123; WSS_INSTANCE_HOST_KEY: &#x27;120.79.164.111:8089&#x27;, WSS_INSTANCE_NAME_KEY: &#x27;wsserver-std-2&#x27;, WSS_INSTANCE_ZONE_KEY: &#x27;us-central1-f&#x27;&#125;]WSS_HOST_PORT_PAIRS = [ins[WSS_INSTANCE_HOST_KEY] for ins in WSS_INSTANCES]# memcache key for the active collider host.WSS_HOST_ACTIVE_HOST_KEY = &#x27;wss_host_active_host&#x27;# Dictionary keys in the collider probing result.WSS_HOST_IS_UP_KEY = &#x27;is_up&#x27;WSS_HOST_STATUS_CODE_KEY = &#x27;status_code&#x27;WSS_HOST_ERROR_MESSAGE_KEY = &#x27;error_message&#x27;RESPONSE_ERROR = &#x27;ERROR&#x27;RESPONSE_ROOM_FULL = &#x27;FULL&#x27;RESPONSE_UNKNOWN_ROOM = &#x27;UNKNOWN_ROOM&#x27;RESPONSE_UNKNOWN_CLIENT = &#x27;UNKNOWN_CLIENT&#x27;RESPONSE_DUPLICATE_CLIENT = &#x27;DUPLICATE_CLIENT&#x27;RESPONSE_SUCCESS = &#x27;SUCCESS&#x27;RESPONSE_INVALID_REQUEST = &#x27;INVALID_REQUEST&#x27;IS_DEV_SERVER = os.environ.get(&#x27;APPLICATION_ID&#x27;, &#x27;&#x27;).startswith(&#x27;dev&#x27;)BIGQUERY_URL = &#x27;https://www.googleapis.com/auth/bigquery&#x27;# Dataset used in production.BIGQUERY_DATASET_PROD = &#x27;prod&#x27;# Dataset used when running locally.BIGQUERY_DATASET_LOCAL = &#x27;dev&#x27;# BigQuery table within the dataset.BIGQUERY_TABLE = &#x27;analytics&#x27; ä¿®æ”¹apprtc.pyapprtc.pyè·¯å¾„ï¼šapprtc&#x2F;out&#x2F;app_engine&#x2F;apprtc.py å°†ä¿®æ”¹ä¸ºï¼ˆå¤§çº¦ä½äº146è¡Œå·¦å³ï¼‰ ä¿®æ”¹index_template.htmlindex_template.htmlè·¯å¾„ï¼šapprtc&#x2F;out&#x2F;app_engine&#x2F;index_template.html è®¾ç½®TURNæœåŠ¡å™¨ä¿¡æ¯ï¼Œåœ¨javascriptè„šæœ¬ä¸­æ·»åŠ serverså˜é‡ï¼š 12345678var servers=[&#123; credential:&quot;helloword&quot;, username:&quot;helloword&quot;, urls:[ &quot;turn:120.79.164.111:3478?transport=udp&quot;, &quot;turn:120.79.164.111:3478?transport=tcp&quot; ] &#125;]; å¹¶å°†peerConnectionConfig: &#123;&#123; pc_config | safe &#125;&#125;ä¿®æ”¹ä¸ºä½¿ç”¨ä¸Šé¢å£°æ˜çš„serverså˜é‡ï¼› 12peerConnectionConfig: &#123; &quot;rtcpMuxPolicy&quot;:&quot;require&quot;,&quot;iceServers&quot;:servers,&quot;bundlePolicy&quot;:&quot;max-bundle&quot;&#125;,iceServerRequestUrl: &#x27;&#123;&#123; ice_server_url &#125;&#125;&#x27;,// peerConnectionConfig: &#123;&#123; pc_config | safe &#125;&#125;, ##1.4 è·å–google_appengineä»https://download.csdn.net/download/china_jeffery&#x2F;10375696ä¸‹è½½google_appengine.tarï¼Œå¹¶ä½¿ç”¨tarå‘½ä»¤è§£å‹ï¼š 12cd ~unzip google_appengine.tar 1.5 å¯åŠ¨æˆ¿é—´æœåŠ¡å™¨12cd ~./google_appengine/dev_appserver.py --host 172.18.163.203 ./apprtc/out/app_engine --skip_sdk_update_check 172.18.163.203ä¸ºå†…ç½‘IPã€‚ äºŒ. ä¿¡ä»¤æœåŠ¡å™¨æ­å»º2.1 collideræºç Webrtcä¿¡ä»¤æœåŠ¡å¯ä»¥ä½¿ç”¨çš„apprtcè‡ªå¸¦çš„colliderï¼Œè¿™ä¸ªæœåŠ¡æ˜¯ä½¿ç”¨goè¯­è¨€å¼€å‘ã€‚colliderå·²ç»ä½äºapprtc/srcç›®å½•ä¸­ï¼Œæˆ‘ä»¬å°†å…¶æ‹·è´åˆ°~/collider/srcç›®å½•ä¸­ï¼š 123cd ~mkdir collider/src -pcp apprtc/src/collider/ collider/src/ -r ç¼–è¾‘~/collider/src/collidermain/main.goæ–‡ä»¶ï¼Œå°†room-serverä¿®æ”¹ä¸ºæœåŠ¡å™¨çš„å¤–ç½‘IPå’Œç«¯å£8080: 1var roomSrv = flag.String(&quot;room-server&quot;, &quot;http://120.79.164.111:8080&quot;, &quot;The origin of the room server&quot;) 2.2 å®‰è£…goåœ¨å®‰è£…goä¹‹å‰æœ€å¥½å…ˆå¸è½½æ‰ç³»ç»Ÿä¸Šå·²ç»å®‰è£…çš„goç‰ˆæœ¬ï¼š 123apt-get remove golangapt-get remove golang*apt-get autoremove ç„¶åä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½goï¼š 1wget https://storage.googleapis.com/golang/go1.5.1.linux-amd64.tar.gz æˆ–è€…ä»https://download.csdn.net/download/china_jeffery&#x2F;10375936ä¸‹è½½ã€‚ç„¶åè§£å‹tar zxf go1.5.1.linux-amd64.tar.gzã€‚ æ·»åŠ å¦‚ä¸‹ç¯å¢ƒå˜é‡åˆ°/etc/sourceæ–‡ä»¶å°¾ï¼Œå¹¶ä½¿ç”¨source /etc/sourceæ˜¯ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š 123export GOROOT=/root/goexport PATH=$PATH:$GOROOT/binexport GOPATH=/root/collider/ 2.3 colliderå®‰è£…ä½¿ç”¨goå‘½ä»¤è¿›è¡Œcolliderå®‰è£…ï¼š 123cd ~/collidergo get collidermaingo install collidermain 2.4 å¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨12cd ~./collider/bin/collidermain -port=8089 -tls=false ä¸‰. TURNæœåŠ¡å™¨æ­å»ºwebrtcçš„turnæœåŠ¡æ˜¯ä¸ºæä¾›NATç©¿é€æˆ–è€…ä¸­è½¬ä½¿ç”¨çš„ï¼Œå› ä¸ºwebrtcå®¢æˆ·ç«¯å¯èƒ½ä¼šåœ¨ä¸åŒçš„è·¯ç”±å™¨åé¢æˆ–è€…å¤šå±‚è·¯ç”±å™¨åé¢ï¼Œé‚£ä¹ˆä»–ä»¬å¦‚ä½•é€šè®¯å‘¢ï¼Ÿéƒ½éœ€è¦ç©¿é€ï¼Œç©¿é€çš„æœåŠ¡å°±æ˜¯turnæœåŠ¡ï¼Œwebrtcæ¨èä½¿ç”¨çš„coturnï¼ˆä»¥å‰ä¹Ÿå«turnserverï¼‰,å®ƒæ”¯STUNå’ŒRelayã€‚ 3.1 å®‰è£…ä¾èµ–12sudo apt-get install libssl-devsudo apt-get install libevent-dev 3.2 ä¸‹è½½å¹¶ç¼–è¯‘æºç 1234cd ~git clone https://github.com/coturn/coturn.gitcd coturnconfigure &amp;&amp; make &amp;&amp; make install 3.3 å¯åŠ¨TURNæœåŠ¡1./coturn/bin/turnserver --syslog -a -X 120.79.164.111 -E 172.18.163.203 -f --min-port=32355 --max-port=65535 --user=helloword:helloword -r helloword --cert=turn_server_cert.pem --pkey=turn_server_pkey.pem --log-file=stdout -v 120.79.164.111ä¸ºå¤–ç½‘IPï¼Œ172.18.163.203ä¸ºæœ¬åœ°IPã€‚turnserverçš„å‚æ•°è§ï¼š https://github.com/coturn/coturn/wiki/turnserver æœ¬æ–‡æœ€åˆå‘å¸ƒåœ¨æˆ‘çš„CSDNåšå®¢ï¼šã€ŠWebRTC â€“ å®˜æ–¹apprtcç¤ºä¾‹æ­å»ºã€‹","tags":["WebRTC","apprtc"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(5)--å †","path":"/post/3599385732.html","content":"ä¸€ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å † (Heap)ï¼Ÿåº”ç”¨ç¨‹åºè™½ç„¶å¯ä»¥ä½¿ç”¨é¡µé¢ç²’åº¦çš„å‡½æ•°ï¼ˆå¦‚VirualAllocï¼‰æ¥åˆ†é…ä¸€ä¸ªæœ€å°ä¸º4KBæˆ–8Kçš„å†…å­˜å—ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦åˆ†é…è¿™ä¹ˆå¤§çš„å†…å­˜å—ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³åˆ†é… 1Kï¼Œ2K çš„å†…å­˜å—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æ— è®ºä»å†…å­˜çš„ä½¿ç”¨ç‡ï¼Œè¿˜æ˜¯ä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œå†åˆ†é…è¿™ä¹ˆå¤§çš„ä¸€ä¸ªå†…å­˜åŒºåŸŸæ˜¾ç„¶ä¸æ˜¯æœ€ä¼˜çš„äº†ã€‚ ä¸ºäº†æ»¡è¶³è¿™ç§éœ€æ±‚ï¼ŒWindows æä¾›äº†ä¸€ä¸ªè¢«ç§°ä¸ºâ€œå †ç®¡ç†å™¨â€çš„ç»„ä»¶ï¼Œå®ƒè´Ÿè´£ç®¡ç†å¤§å†…å­˜åŒºåŸŸä¸­çš„å†…å­˜åˆ†é…ï¼Œè¿™äº›å¤§å†…å­˜åŒºåŸŸå°±æ˜¯é€šè¿‡ä¸€äº›é¡µé¢ç²’åº¦çš„å†…å­˜åˆ†é…å‡½æ•°ï¼ˆå¦‚VirualAllocï¼‰æ¥é¢„å®šï¼ˆreserveï¼‰çš„ã€‚ å †ç®¡ç†å™¨ä¸­çš„åˆ†é…ç²’åº¦ç›¸å¯¹æ¯”è¾ƒå°ï¼šåœ¨32ä½ç³»ç»Ÿä¸Šæ˜¯8å­—èŠ‚ï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯16å­—èŠ‚ã€‚ å †ç®¡ç†å™¨å·²ç»è¢« Windows ç³»ç»Ÿç²¾å¿ƒè®¾è®¡ï¼Œåœ¨è¿™äº›å°å†…å­˜åˆ†é…çš„æƒ…å†µä¸‹ä¼šè¿›è¡Œå†…å­˜ä½¿ç”¨ç‡å’Œæ€§èƒ½ä¸¤ä¸ªæ–¹é¢çš„ä¼˜åŒ–ã€‚ äºŒã€è¿›ç¨‹çš„é»˜è®¤å †æ¯ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªå †ï¼Œé‚£å°±æ˜¯è¿›ç¨‹çš„é»˜è®¤å †ã€‚è¿›ç¨‹çš„é»˜è®¤å †æ˜¯åœ¨è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™åˆ›å»ºçš„ï¼Œè€Œä¸”åœ¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­æ°¸è¿œä¸ä¼šè¢«åˆ é™¤ã€‚ â€œé»˜è®¤å †â€çš„é»˜è®¤å¤§å°ä¸º1MBï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡/HEAPé“¾æ¥å™¨ç¼–è¯‘å™¨é€‰é¡¹æ¥æŒ‡å®šä¸€ä¸ªæ›´å¤§çš„èµ·å§‹å¤§å°ã€‚è¿™ä¸ªå¤§å°å€¼åªæ˜¯åˆå§‹çš„ä¿ç•™å†…å­˜å¤§å°ï¼ŒåæœŸæ ¹æ®éœ€è¦å®ƒå¯ä»¥è‡ªåŠ¨æ‰©å……ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨GetProcessHeapæ¥è·å–è¿›ç¨‹çš„é»˜è®¤å †ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨HeapCreateå‡½æ•°æ¥åˆ›å»ºé¢å¤–çš„ç§æœ‰å †ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä¸åœ¨éœ€è¦ä¸€ä¸ªç§æœ‰å †çš„æ—¶å€™ï¼Œå®ƒå¯ä»¥è°ƒç”¨HeapDestoryæ¥é‡Šæ”¾è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ ä¸‰ã€crt å †C è¯­è¨€çš„malloc,freeå‡½æ•°ä»¥åŠ C++çš„new,deleteéƒ½æ˜¯ä»å †ä¸Šåˆ†é…å’Œé‡Šæ”¾å†…å­˜çš„ã€‚ä½†æ˜¯ä»–ä»¬æ‰€ä½¿ç”¨çš„å †ä¸æ˜¯è¿›ç¨‹çš„é»˜è®¤å †ï¼Œä»–ä»¬ä½¿ç”¨çš„æ˜¯ç§æœ‰å †ã€‚å¯æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨mallocå‡½æ•°ä¹‹å‰å¹¶æœ‰è¿›è¡Œä»»ä½•ç§æœ‰å †çš„åˆ›å»ºæ“ä½œå‘€ï¼Ÿ å› ä¸ºmallocå‡½æ•°ä½¿ç”¨çš„è¿™ä¸ªç§æœ‰å †ä¸éœ€è¦ç¨‹åºå‘˜æ¥åˆ›å»ºï¼Œè€Œæ˜¯åœ¨ C æˆ– C++è¿è¡Œæ—¶åº“ DLL çš„å¯åŠ¨ä»£ç _DllMainCRTStartupä¸­è‡ªåŠ¨åˆ›å»ºçš„ã€‚ä¸‹é¢é€šè¿‡è§£æmallocå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚ mallocå‡½æ•°çš„å®šä¹‰åœ¨malloc.cæ–‡ä»¶ä¸­ï¼Œè°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼šï¼ˆä»¥Microsoft Visual Studio 10.0ä¸ºä¾‹ï¼Œmalloc.cæ–‡ä»¶è·¯å¾„ä¸ºC:\\Program Files (x86)\\Microsoft Visual Studio 10.0\\VC\\crt\\srcï¼‰ 123(1). void* __cdecl malloc(size_t const size)(2). void * __cdecl _malloc_base (size_t size)(3). void * __cdecl _heap_alloc (size_t size) _heap_alloc çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910__forceinline void * __cdecl _heap_alloc (size_t size)&#123; if (_crtheap == 0) &#123; _FF_MSGBANNER(); /* write run-time error banner */ _NMSG_WRITE(_RT_CRT_NOTINIT); /* write message */ __crtExitProcess(255); /* normally _exit(255) */ &#125; return HeapAlloc(_crtheap, 0, size ? size : 1);&#125; ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ†é…å†…å­˜å—çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯_crtheapå¥æŸ„æ ‡è®°çš„å †ã€‚é‚£ä¹ˆ_crtheapå †æ˜¯ä½•æ—¶åˆ›å»ºçš„äº†ï¼Ÿ æˆ‘ä»¬ä»heapinit.cæ–‡ä»¶ä¸­çš„_heap_initå‡½æ•°å¯ä»¥çœ‹åˆ°_crtheapå †çš„åˆ›å»ºè¿‡ç¨‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445HANDLE _crtheap=NULL;/****_heap_init() - Initialize the heap**Purpose:* Setup the initial C library heap.** NOTES:* (1) This routine should only be called once!* (2) This routine must be called before any other heap requests.**Entry:* &lt;void&gt;*Exit:* Returns 1 if successful, 0 otherwise.**Exceptions:* If heap cannot be initialized, the program will be terminated* with a fatal runtime error.********************************************************************************/int __cdecl _heap_init (void)&#123; ULONG HeapType = 2; // Initialize the &quot;big-block&quot; heap first. if ( (_crtheap = HeapCreate(0, BYTES_PER_PAGE, 0)) == NULL ) return 0;#ifdef _WIN64 // Enable the Low Fragmentation Heap by default on Windows XP and // Windows Server 2003. It&#x27;s the 8 byte overhead heap, and has // generally better performance charateristics than standard heap, // particularly for apps that perform lots of small allocations. if (LOBYTE(GetVersion()) &lt; 6) &#123; HeapSetInformation(_crtheap, HeapCompatibilityInformation, &amp;HeapType, sizeof(HeapType)); &#125;#endif /* _WIN64 */ return 1;&#125; ä»ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºçš„ç§æœ‰å †å¥æŸ„å­˜æ”¾åœ¨ä¸€ä¸ªå…¨å±€çš„_crtheapå˜é‡ä¸­ï¼Œåé¢æ¯æ¬¡è°ƒç”¨mallocå‡½æ•°éƒ½æ˜¯ä»è¯¥å †åˆ†é…å†…å­˜å—ã€‚ å››ã€Win32 å †å‡½æ•°æˆ‘ä»¬æœ€å¸¸ç”¨çš„ Windows å †å‡½æ•°å¦‚ä¸‹ï¼š HeapCreateæˆ–HeapDestory â€” åˆ›å»ºæˆ–åˆ é™¤ä¸€ä¸ªç§æœ‰å † HeapAlloc â€” åˆ†é…ä¸€ä¸ªå †å†…å­˜å— HeapFree â€” é‡Šæ”¾ä¸€ä¸ªåŸå…ˆç”±HeapAllocåˆ†é…çš„å†…å­˜å— HeapReAlloc â€” å¢é•¿æˆ–ç¼©å‡ä¸€ä¸ªå·²åˆ†é…çš„å†…å­˜å—çš„å¤§å° HeapLockæˆ–HeapUnLock â€” æ§åˆ¶å †æ“ä½œçš„å†…å­˜è®¿é—® HeapWalk â€” åˆ—ä¸¾ä¸€ä¸ªå †å†…éƒ¨çš„å†…å­˜é¡¹å’ŒåŒºåŸŸã€‚ äº”ã€Windows å†…å­˜ç®¡ç† API åˆ†å±‚ç»“æ„ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œè™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼ˆVirtual Memoryï¼‰æ˜¯ windows å†…å­˜ä½“ç³»çš„åŸºç¡€ï¼Œæ— è®ºä½ æ˜¯ä½¿ç”¨å †ï¼Œè¿˜æ˜¯ä½¿ç”¨å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œå®ƒä»¬çš„åº•å±‚éƒ½æ˜¯åŸºäºè™šæ‹Ÿå†…å­˜æ¥å®ç°çš„ã€‚ ä»ä¸Šå¾€ä¸‹ï¼Œæ¯ä¸€å±‚çš„ API åœ¨å†…éƒ¨ä¼šä¾æ¬¡è°ƒç”¨ä¸‹ä¸€å±‚çš„ APIã€‚ä¸‹å›¾ä¸­åˆ—ä¸¾äº†æ¯å±‚ API ä¸­ç»å¸¸ä½¿ç”¨çš„å‡½æ•°ï¼š CRT Memory Functionsï¼šmalloc, free, new, delete Local, Global Memory API: ** LocalAlloc, GlobalAlloc ï¼ˆè¿™ 2 ä¸ªå‡½æ•°ç°åœ¨ä¸å»ºè®®ä½¿ç”¨ï¼Œæ³¨æ„æ˜¯ä¸ºäº†å…¼å®¹ä»¥å‰çš„è€ä»£ç æ‰ä¿ç•™ä¸‹æ¥çš„**ï¼‰ Heap Memory APIï¼šHeapCreate, HeapAlloc, HeapDestory Virtual Memory APIï¼šVirtualAlloc, VirtualFree Memory Mapped File APIï¼šCreateFileMapping, MapViewOfFile, MapViewOfFileEx, UnMapViewOfFile æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å †"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(4)--å†…å­˜å¯¹é½","path":"/post/4245522728.html","content":"ä¸€ã€å†…å­˜ä¸ºä»€ä¹ˆè¦å¯¹é½è™½ç„¶æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯ä¿å­˜åœ¨ç‰¹å®šåœ°å€çš„å†…å­˜ä¸­ï¼Œä½†æœ€å¥½è¿˜æ˜¯æŒ‰ç…§å†…å­˜å¯¹é½çš„è¦æ±‚æ¥å­˜å‚¨ã€‚è¿™ä¸»è¦å‡ºäºä¸¤ä¸ªæ–¹é¢çš„åŸå› è€ƒè™‘ï¼š å¹³å°åŸå› ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°(ç‰¹åˆ«æ˜¯åµŒå…¥å¼ç³»ç»Ÿä¸­ä½¿ç”¨çš„ä½ç«¯å¤„ç†å™¨)éƒ½èƒ½è®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®ï¼ŒæŸäº›ç¡¬ä»¶å¹³å°åªèƒ½è®¿é—®å¯¹é½çš„åœ°å€ï¼Œå¦åˆ™ä¼šå‡ºç°ç¡¬ä»¶å¼‚å¸¸ã€‚ æ€§èƒ½åŸå› ï¼šå¦‚æœæ•°æ®å­˜æ”¾åœ¨æœªå¯¹é½çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåˆ™å¤„ç†å™¨è®¿é—®å˜é‡æ—¶éœ€è¦è¿›è¡Œä¸¤æ¬¡å†…å­˜è®¿é—®æ‰èƒ½å®Œæ•´è¯»å–è¯¥å˜é‡çš„å€¼ï¼Œè€Œå¯¹é½çš„å†…å­˜è®¿é—®ä»…éœ€ä¸€æ¬¡è®¿é—®ã€‚ äºŒã€å†…å­˜å¯¹é½çš„è§„åˆ™ å¯¹äºç»“æ„ï¼ˆæˆ–è”åˆï¼‰çš„å„ä¸ªæˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜ä½äºåç§»ä¸º 0ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜çš„åç§»é‡å¿…é¡»æ˜¯#pragma packæŒ‡å®šçš„æ•°å€¼å’Œç»“æ„ä½“(æˆ–è”åˆ)ä¸­æœ€å¤§æ•°æ®æˆå‘˜é•¿åº¦ è¿™2ä¸ªæ•°å€¼ä¸­è¾ƒå°çš„ä¸€ä¸ªçš„å€æ•°ã€‚ä½¿ç”¨ä¼ªä»£ç è¡¨ç¤ºï¼š min(#pragma pack, ç»“æ„æœ€å¤§æ•°æ®æˆå‘˜é•¿åº¦) * N åœ¨æ•°æ®æˆå‘˜å®Œæˆå„è‡ªå¯¹é½ä¹‹åï¼Œç»“æ„(æˆ–è”åˆ)æœ¬èº«ä¹Ÿè¦è¿›è¡Œå¯¹é½ï¼Œå¯¹é½ä¹ŸæŒ‰ç…§#pragma packæŒ‡å®šçš„æ•°å€¼å’Œç»“æ„(æˆ–è”åˆ)æœ€å¤§æ•°æ®æˆå‘˜é•¿åº¦è¿™2ä¸ªæ•°å€¼ä¸­è¾ƒå°çš„ä¸€ä¸ªè¿›è¡Œã€‚ å¦‚æœæ²¡æœ‰ä½¿ç”¨#pragma packæŒ‡ä»¤æ¥æ˜¾å¼çš„æŒ‡å®šå†…å­˜å¯¹é½çš„å­—èŠ‚æ•°ï¼Œåˆ™æŒ‰ç…§é»˜è®¤å­—èŠ‚æ•°æ¥å¯¹é½ï¼Œå„ä¸ªå¹³å°çš„é»˜è®¤å¯¹é½è§„åˆ™å¦‚ä¸‹ï¼š32ä½CPUé»˜è®¤æŒ‰ç…§4å­—èŠ‚å¯¹é½ï¼›64ä½CPUé»˜è®¤æŒ‰ç…§8å­—èŠ‚å¯¹é½ã€‚ ä¸‰ã€#pragma pack å‘½ä»¤123#pragma pack(n) // ä½¿ç”¨è‡ªå®šä¹‰nå­—èŠ‚å¯¹é½ nå¯ä»¥ä¸º1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œ16#pragma pack() // ä½¿ç”¨ç¼ºçœå­—èŠ‚å¯¹é½#pragma pack(show) // åœ¨ç¼–è¯‘è¾“å‡ºçª—å£ä»¥è­¦å‘Šçš„å½¢å¼æ˜¾ç¤ºå‡ºå½“å‰çš„å†…å­˜ä»¥å‡ ä¸ªå­—èŠ‚å¯¹é½ å››ã€ç»“æ„ä½“å†…å­˜å¯¹é½ç¤ºä¾‹åœ¨ 64 ä½ç³»ç»Ÿä¸Šç¼–è¯‘ä¸‹é¢çš„æµ‹è¯•ç¨‹åºï¼Œå·²çŸ¥åœ¨ 64 ä½ç³»ç»Ÿä¸Šå„ç±»å‹å ç”¨å­—èŠ‚æ•°å¦‚ä¸‹ï¼š 123456char 1å­—èŠ‚short 2å­—èŠ‚int 4å­—èŠ‚long 4å­—èŠ‚double 8å­—èŠ‚long long 8å­—èŠ‚ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415#pragma pack(8)struct A &#123; char s[5]; short c; int a;&#125;;int main()&#123; int i = sizeof(A); printf(&quot;%d&quot;, i); return 0;&#125; æŒ‰ç…§ç¬¬äºŒèŠ‚æ‰€è®²çš„å†…å­˜å¯¹é½è§„åˆ™ï¼Œåˆ†æå¦‚ä¸‹ï¼šå› ä¸ºç»“æ„ä½“ä¸­æœ€å¤§çš„æ•°æ®æˆå‘˜é•¿åº¦ä¸º intï¼ˆå³ 4 å­—èŠ‚ï¼‰ï¼Œè€Œä¸”#pragma pack(8)æŒ‡ä»¤æŒ‡å®šæŒ‰ç…§ 8 å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥min(4,8) = 4ï¼Œæ•…æˆ‘ä»¬å¯ä»¥çŸ¥é“ç»“æ„ä½“ A æŒ‰ç…§ 4 å­—èŠ‚å¯¹é½ã€‚ ä¸‹å›¾æ˜¯ç»“æ„ä½“ A æŒ‰ç…§ 4 å­—èŠ‚å¯¹é½çš„å†…å­˜å¸ƒå±€ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯â€œå†…å­˜ä¸æ˜¯å¡«å……åœ¨ s5 åé¢ï¼Œè€Œæ˜¯å¡«å……åœ¨ c åé¢â€ï¼‰ï¼š ä»å›¾æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“sizeof(A) = 12. æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å†…å­˜å¯¹é½"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(3)--å†…å­˜æ˜ å°„æ–‡ä»¶","path":"/post/3938269003.html","content":"ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å†…å­˜æ˜ å°„â€œå†…å­˜æ˜ å°„æ–‡ä»¶â€å¯ä»¥å°†ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™æ ·å°±ä¸éœ€è¦å°†æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾å…¥åˆ°é¡µäº¤æ¢æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ç³»ç»Ÿæœ‰è®¸å¤šç¨‹åºåŒæ—¶è¿è¡Œæ—¶ï¼Œå¦‚æœå°†è¿™äº›ç¨‹åºæ–‡ä»¶éƒ½åŠ è½½åˆ°é¡µäº¤æ¢æ–‡ä»¶ä¸­ï¼Œé¡µäº¤æ¢æ–‡ä»¶å°†ä¼šå˜å¾—éå¸¸å¤§ã€‚äº‹å®ä¸Šï¼ŒWindows ä¹Ÿå¹¶æ²¡æœ‰å°†ç¡¬ç›˜ä¸Šçš„ç¨‹åºæ–‡ä»¶å¤åˆ¶åˆ°é¡µäº¤æ¢æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¿™æ ·ä¸ä»…ä¼šè®©é¡µäº¤æ¢æ–‡ä»¶å°†ä¼šå˜å¾—éå¸¸å¤§ï¼Œä¹Ÿä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å¯æ‰§è¡Œç¨‹åºéå¸¸å¤§çš„æ—¶å€™ã€‚ å½“ç”¨æˆ·è¦æ±‚æ‰§è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œç³»ç»Ÿä¼šæ‰“å¼€è¯¥åº”ç”¨ç¨‹åºçš„.exeæ–‡ä»¶ï¼Œå¹¶è®¡ç®—å‡ºåº”ç”¨ç¨‹åºçš„ä»£ç å’Œæ•°æ®çš„å¤§å°ï¼Œç„¶åç³»ç»Ÿä¼šåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´é¢„å®šä¸€å—åœ°å€ç©ºé—´ï¼Œå¹¶æ³¨æ˜ä¸è¯¥åŒºåŸŸç›¸å…³è”çš„ç‰©ç†å­˜å‚¨å™¨å°±æ˜¯.exeæ–‡ä»¶æœ¬èº«ã€‚ å½“æŠŠä¸€ä¸ªä½äºç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯.exeï¼Œ.dllä¹Ÿå¯ä»¥æ˜¯æ™®é€šæ–‡ä»¶ï¼‰æ˜ åƒç”¨ä½œåœ°å€ç©ºé—´åŒºåŸŸå¯¹åº”çš„ç‰©ç†å­˜å‚¨å™¨æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªæ–‡ä»¶æ˜ åƒä¸ºâ€œå†…å­˜æ˜ å°„æ–‡ä»¶â€ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹Windowså†…å­˜ä½“ç³»(2)--è™šæ‹Ÿå†…å­˜ç¬¬ 2 èŠ‚çš„å›¾è¿›è¡Œå®Œå–„äº†ï¼ŒåŠ å…¥â€œå†…å­˜æ˜ å°„æ–‡ä»¶â€éƒ¨åˆ†ï¼š äºŒã€å†…å­˜æ˜ å°„æ–‡ä»¶æŠ€æœ¯ä»‹ç»å¸¸ç”¨çš„æœ‰ Win32 API çš„CreateFile()ã€WriteFile()ã€ReadFile()å’Œ MFC æä¾›çš„CFileç±»éƒ½å¯ä»¥å®ç°æ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»¥ä¸Šè¿™äº›å‡½æ•°å¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºåˆçš„è¦æ±‚ï¼Œä½†æ˜¯å¯¹äºæŸäº›ç‰¹æ®Šåº”ç”¨é¢†åŸŸæ‰€éœ€è¦çš„åŠ¨è¾„å‡ å GBã€å‡ ç™¾ GBã€ä¹ƒè‡³å‡  TB çš„æµ·é‡å­˜å‚¨ï¼Œæ­¤æ—¶åœ¨ä»¥å¹³å¸¸çš„æ–‡ä»¶å¤„ç†æ–¹æ³•è¿›è¡Œå¤„ç†æ˜¾ç„¶æ˜¯è¡Œä¸é€šçš„ï¼ˆæ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”å†…å­˜æ²¡é‚£ä¹ˆå¤§ï¼‰ã€‚ç›®å‰ï¼Œå¯¹äºè¿™ç§å¤§æ–‡ä»¶çš„æ“ä½œä¸€èˆ¬æ˜¯ä»¥å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹å¼æ¥åŠ ä»¥å¤„ç†çš„ã€‚ å†…å­˜æ˜ å°„æ–‡ä»¶ä¹Ÿæ˜¯ Windows çš„ä¸€ç§å†…å­˜ç®¡ç†æ–¹æ³•ï¼Œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„å†…å­˜ç®¡ç†ç‰¹å¾ï¼Œä½¿åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å†…å­˜æŒ‡é’ˆå¯¹ç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œè®¿é—®ã€‚é€šè¿‡æ–‡ä»¶æ˜ å°„å°†ç£ç›˜æ–‡ä»¶å†…å®¹ï¼ˆå…¨éƒ¨æˆ–è€…éƒ¨åˆ†ï¼‰ä¸è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„æŸä¸ªåŒºåŸŸå»ºç«‹æ˜ å°„å…³è”ï¼Œå¯ä»¥ç›´æ¥å¯¹è¢«æ˜ å°„çš„æ–‡ä»¶è¿›è¡Œè®¿é—®ï¼Œè€Œä¸å¿…æ‰§è¡Œæ–‡ä»¶ I&#x2F;O æ“ä½œä¹Ÿæ— éœ€å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼“å†²å¤„ç†ã€‚å†…å­˜æ–‡ä»¶æ˜ å°„çš„è¿™ç§ç‰¹æ€§æ˜¯éå¸¸é€‚åˆäºç”¨æ¥ç®¡ç†å¤§å°ºå¯¸æ–‡ä»¶çš„ã€‚ ä¸‰ã€å¤§æ–‡ä»¶è¯»å†™å®ä¾‹é€šè¿‡ C++è°ƒç”¨ç³»ç»Ÿ API å®ç°æ–‡ä»¶æ˜ å°„çš„æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š æœ¬ç¤ºä¾‹é¦–å…ˆåœ¨D:\\ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º 1GB çš„BigFile.dataæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯å°†è¯¥æ–‡ä»¶å†…å…¨éƒ¨å¡«å……å­—ç¬¦ Aï¼Œéšåè¯»å–å…¶ä¸­çš„ç¬¬20000~20100å­—èŠ‚ï¼Œå¹¶å°†è¿™äº›å­—èŠ‚ä¿®æ”¹ä¸ºå­—ç¬¦ Bï¼Œç„¶åå†æ¬¡è¯»å–å·²éªŒè¯æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#include &lt;windows.h&gt;void Test() &#123; HANDLE file_ = CreateFile(TEXT(&quot;D:\\\\BigFile.data&quot;), GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL); if (file_ == INVALID_HANDLE_VALUE) &#123; printf(&quot;CreateFile failed, GLE:%d &quot;, GetLastError()); return; &#125; LARGE_INTEGER filesize; filesize.QuadPart = 1024 * 1024 * 1024; // 1GB HANDLE mapping_ = CreateFileMapping(file_, NULL, PAGE_READWRITE, filesize.HighPart, filesize.LowPart, NULL); if (mapping_ == NULL) &#123; printf(&quot;CreateFileMapping failed, GLE:%d &quot;, GetLastError()); return; &#125; LARGE_INTEGER offset; offset.QuadPart = 0; LPVOID mapping_addr = MapViewOfFile(mapping_, FILE_MAP_WRITE | FILE_MAP_READ, offset.HighPart, offset.LowPart, 0); if (mapping_addr == NULL) &#123; printf(&quot;MapViewOfFile failed, GLE:%d &quot;, GetLastError()); return; &#125; // å‘æ–‡ä»¶ä¸­å¡«å……1GBçš„å­—ç¬¦&#x27;A&#x27; // char buf[1024]; for (int i = 0; i &lt; 1024; i++) &#123; buf[i] = &#x27;A&#x27;; &#125; // æ¯æ¬¡å¡«å……1024å­—èŠ‚ï¼Œå¡«å……1024*1024æ¬¡ for (long l = 0; l &lt; 1024 * 1024; l++) &#123; memcpy((LPVOID)((long)mapping_addr + l * 1024), buf, 1024); &#125; // å¡«å……å®Œæ¯• // è¯»å–ç¬¬20000~20100å­—èŠ‚ï¼Œå…±100å­—èŠ‚ // char read_content[101] = &#123; 0 &#125;; memcpy(read_content, (LPVOID)((long)mapping_addr + 20000), 100); printf(&quot;%s &quot;, read_content); // å°†ç¬¬20000~20100å­—èŠ‚ï¼Œå…±100å­—èŠ‚å…¨éƒ¨ä¿®æ”¹ä¸ºå­—ç¬¦&#x27;B&#x27; // char write_content[100]; for (int i = 0; i &lt; 100; i++) &#123; write_content[i] = &#x27;B&#x27;; &#125; memcpy((LPVOID)((long)mapping_addr + 20000), write_content, 100); // å†æ¬¡è¯»å–ç¬¬20000~20100å­—èŠ‚ï¼Œå…±100å­—èŠ‚ï¼ŒéªŒè¯ä¿®æ”¹æ˜¯æˆåŠŸ // memcpy(read_content, (LPVOID)((long)mapping_addr + 20000), 100); printf(&quot;%s &quot;, read_content); UnmapViewOfFile(mapping_addr); CloseHandle(mapping_); CloseHandle(file_); return;&#125;int main()&#123; Test(); return 0;&#125; æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å†…å­˜æ˜ å°„"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(2)--è™šæ‹Ÿå†…å­˜","path":"/post/595856315.html","content":"ä¸€ã€é¡µäº¤æ¢æ–‡ä»¶è™šæ‹Ÿåœ°å€ç©ºé—´åªæ˜¯æ“ä½œç³»ç»Ÿä¸ºè¿›ç¨‹â€œè™šæ‹Ÿâ€å‡ºæ¥çš„ä¸€å—åœ°å€åŒºåŸŸï¼Œå¹¶ä¸ä»£è¡¨ä»»ä½•å®é™…çš„ç©ºé—´ã€‚è€Œâ€œé¡µäº¤æ¢æ–‡ä»¶â€å´å¯¹åº”äº†å®é™…çš„ç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´ä¸€èˆ¬æ˜¯ç£ç›˜ä¸Šåä¸ºâ€œpagefile.sysâ€çš„æ–‡ä»¶ã€‚ â€œé¡µäº¤æ¢æ–‡ä»¶â€çš„å¤§å°å’Œä½ç½®å¯ä»¥åœ¨ç³»ç»Ÿè®¾ç½®ï¼ˆç³»ç»Ÿå±æ€§ -&gt; é«˜çº§ -&gt; æ€§èƒ½ -&gt; è®¾ç½® -&gt; é«˜çº§ ï¼‰ä¸­è¿›è¡Œè®¾ç½®ï¼š ä»å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£æ¥çœ‹ï¼Œâ€œè™šæ‹Ÿå†…å­˜â€ç­‰äºâ€œç‰©ç†å†…å­˜â€+â€œåˆ†é¡µæ–‡ä»¶â€æ€»å’Œã€‚å¯ä»¥æŠŠâ€œè™šæ‹Ÿå†…å­˜â€ç†è§£ä¸º Windows çš„ä¸€ç§å†…å­˜ç®¡ç†æœºåˆ¶ã€‚ äºŒã€è™šæ‹Ÿåœ°å€ç©ºé—´ã€é¡µäº¤æ¢æ–‡ä»¶ã€ç‰©ç†å†…å­˜è™šæ‹Ÿåœ°å€ç©ºé—´ã€é¡µäº¤æ¢æ–‡ä»¶ã€ç‰©ç†å†…å­˜ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š ã€ŠWindows æ ¸å¿ƒç¼–ç¨‹ã€‹ç¬¬ 13 ç« å…³äºâ€œç‰©ç†å­˜å‚¨å™¨å’Œé¡µäº¤æ¢æ–‡ä»¶â€ç« èŠ‚ä¸­è®²åˆ°äº†â€œé¡µäº¤æ¢æ–‡ä»¶ã€ç‰©ç†å­˜å‚¨å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢è¿‡ç¨‹â€ï¼Œæµç¨‹å¦‚ä¸‹ï¼š åº”ç”¨ç¨‹åºä»è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´é¢„å®šå¹¶è°ƒæ‹¨äº†ä¸€å—åœ°å€åŒºåŸŸæ—¶ï¼Œèµ·åˆè¿™å—åŒºåŸŸåªæ˜¯ä»â€œé¡µäº¤æ¢æ–‡ä»¶â€ä¸­è°ƒæ‹¨çš„ï¼Œè¿™æ ·ä½œæœ‰ä¸ªå¥½å¤„å°±æ˜¯ï¼šå› ä¸ºè¿˜ä¸ç¡®å®šä½•æ—¶æ‰ä¼šä½¿ç”¨è¿™å—åŒºåŸŸï¼Œå¦‚æœç«‹å³ä»ç‰©ç†å†…å­˜è°ƒæ‹¨ï¼Œä¼šå°†å ç”¨å¾ˆå¤šçš„ç‰©ç†å†…å­˜ã€‚å½“ç¨‹åºè¯»å†™è¯¥åœ°å€åŒºåŸŸæ—¶ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°ä¸Šé¢å›¾ä¸Šçš„é¡µäº¤æ¢æ–‡ä»¶å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„æ•°æ®äº¤æ¢è¿‡ç¨‹ã€‚ ä¸‰ã€å°†é¡µé¢é”å®šåœ¨ç‰©ç†å†…å­˜ä»ä¸Šé¢çš„å‡ èŠ‚æˆ‘ä»¬çŸ¥é“ï¼Œå½“ç‰©ç†å†…å­˜ä¸­æ²¡æœ‰é—²ç½®é¡µé¢æ—¶ï¼Œç³»ç»Ÿä¼šå°†å†…å­˜ä¸­çš„æŸäº›é¡µé¢çš„æ•°æ®å†™å…¥åˆ°äº¤æ¢æ–‡ä»¶ä¸­ï¼Œä»è€Œå°†è¯¥ç‰©ç†å†…å­˜åŒºåŸŸé‡Šæ”¾å‡ºæ¥ä¾›åé¢çš„ç¨‹åºä½¿ç”¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨VirtualLockæ–¹æ³•ï¼Œå°†é¡µé¢é”å®šåœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œä»è€Œé˜²æ­¢è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶å°†é¡µé¢äº¤æ¢è‡³é¡µé¢æ–‡ä»¶ï¼Œè€Œå¼•èµ·ä¸å¿…è¦çš„ç¡¬ç›˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„ä½æ•ˆé¡µé¢äº¤æ¢ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨VirtualUnlockæ–¹æ³•è§£é”é¡µé¢ï¼Œå…è®¸ç³»ç»Ÿå¯¹é¡µé¢è¿›è¡Œäº¤æ¢æ“ä½œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé”å®šé¡µé¢æ—¶ç³»ç»Ÿä¼šæ ¹æ®å½“å‰å¯ç”¨å®é™…ç‰©ç†å†…å­˜æƒ…å†µï¼Œä»¥åŠè¿›ç¨‹å·¥ä½œé›†é…é¢åˆ¤å®šå½“å‰æœ€å¤§å¯é”å®šçš„é¡µé¢çš„å®é™…æ•°é‡ï¼Œè¶…è¿‡æ­¤æ•°é‡ä¼šå¼•èµ·ä¸€ä¸ªé”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨SetProcessWorkingSetSizeå¯ä»¥æ”¹å˜ä¸€ä¸ªè¿›ç¨‹å·¥ä½œé›†å¤§å°çš„é…é¢ï¼Œä»è€Œå¯ä»¥é”å®šæ›´å¤šçš„ç‰©ç†é¡µé¢ã€‚ å››ã€è™šæ‹Ÿå†…å­˜ä½¿ç”¨å®ä¾‹è™šæ‹Ÿå†…å­˜æ–¹é¢çš„ API å±äºé¡µé¢ç²’åº¦ APIï¼Œé€šè¿‡è¿™äº› API åˆ†é…çš„å†…å­˜çš„æœ€å°ç²’åº¦æ˜¯64KBã€‚è¿™äº› API åˆ†é…ï¼ˆè°ƒæ‹¨ï¼‰çš„å†…å­˜åŒºåŸŸæœ€åˆéƒ½æ˜¯ä½äºâ€œé¡µäº¤æ¢æ–‡ä»¶â€ä¸Šé¢ï¼Œå½“ç¨‹åºå¯¹è¯¥åŒºåŸŸçš„æŸäº›â€œé¡µé¢â€ï¼ˆå¯¹è™šæ‹Ÿå†…å­˜çš„ç®¡ç†ä»¥é¡µé¢ä¸ºå•ä½è¿›è¡Œçš„ï¼‰è¿›è¡Œè¯»å†™æ—¶ï¼Œæ‰ä¼šå°†è¿™äº›é¡µé¢äº¤æ¢åˆ°ç‰©ç†å†…å­˜ä¸Šé¢ã€‚ ä»Windowså†…å­˜ä½“ç³»(1)--è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æˆ‘ä»¬çŸ¥é“è™šæ‹Ÿåœ°å€ç©ºé—´è¦ç»è¿‡é¢„å®šå’Œè°ƒæ‹¨2 ä¸ªæ­¥éª¤ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œè¿™ 2 ä¸ªæ­¥éª¤éƒ½å¯ä»¥é€šè¿‡VirtualAllocå‡½æ•°å®ç°ï¼š 123456LPVOID VirtualAlloc( LPVOID lpAddress, DWORD dwSize, DWORD flAllocationType, DWORD flProtect); å½“é¢„å®šæˆ–è€…è°ƒæ‹¨çš„ç©ºé—´æˆ‘ä»¬ä¸åœ¨éœ€è¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨VirtualFreeæ¥é‡Šæ”¾è¯¥åœ°å€ç©ºé—´ï¼š 12345BOOL VirtualFree( LPVOID lpAddress, DWORD dwSize, DWORD dwFreeType); ä¸‹é¢æ˜¯çš„ç¤ºä¾‹æ¼”ç¤ºäº†åœ¨é¢„å®šã€è°ƒæ‹¨ã€ä½¿ç”¨ç­‰æ“ä½œå‰åï¼Œè¿›ç¨‹çš„å„é¡¹å†…å­˜çš„å ç”¨æƒ…å†µï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;windows.h&gt;int main()&#123; SIZE_T size = 1 &lt;&lt; 30; // 1GB // é¢„å®š1GBçš„ç©ºé—´ char *pVirtualAddress = (char *)VirtualAlloc(NULL, size, MEM_RESERVE, PAGE_READWRITE); if (pVirtualAddress == NULL) &#123; printf(&quot;Reserve 1GB failed. &quot;); return 1; &#125; // éªŒè¯åˆ†é…ç²’åº¦æ˜¯ä¸æ˜¯64KB int n = (long)pVirtualAddress % (64*1024); if (n == 0) &#123; printf(&quot;åˆ†é…ç²’åº¦ä¸º64K &quot;); &#125; printf(&quot;å·²ç»é¢„å®š1GB &quot;); getchar(); // æš‚åœ if (VirtualAlloc(pVirtualAddress, size, MEM_COMMIT, PAGE_READWRITE) == NULL) &#123; printf(&quot;Commit 1GB failed. &quot;); return 1; &#125; printf(&quot;å·²ç»è°ƒæ‹¨1GB &quot;); getchar(); // æš‚åœ // é¡µé¢å¤§å°ä¸º4Kï¼Œè®¿é—®2560ä¸ªé¡µé¢ï¼Œå³2560*4K = 10MB // for (int i = 0; i &lt; 2560; i++) &#123; char * p = pVirtualAddress + i * (4 * 1024); *p = &#x27;A&#x27;; // åªè®¿é—®æ¯ä¸ªé¡µé¢çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ &#125; printf(&quot;å·²ç»ä½¿ç”¨å‰10MB &quot;); getchar(); // æš‚åœ return 0;&#125; åœ¨ç¨‹åºè¿è¡Œå„ä¸ªé˜¶æ®µè¿›ç¨‹çš„å†…å­˜æƒ…å†µå¦‚ä¸‹å›¾ï¼šï¼ˆâ€œå†…å­˜ä¸“ç”¨å·¥ä½œé›†â€è¡¨ç¤ºå ç”¨çš„ç‰©ç†å†…å­˜çš„å¤§å°ï¼Œâ€œæäº¤å¤§å°â€è¡¨ç¤ºè°ƒæ‹¨çš„é¡µäº¤æ¢æ–‡ä»¶çš„å¤§å°ï¼‰ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["è™šæ‹Ÿå†…å­˜"],"categories":["Windowsç¼–ç¨‹"]},{"title":"Windowså†…å­˜ä½“ç³»(1)--è™šæ‹Ÿåœ°å€ç©ºé—´","path":"/post/2494475058.html","content":"ä¸€ã€å®æ¨¡å¼ä¸‹å†…å­˜åˆ†é…æœºåˆ¶åœ¨ 8086 æˆ–è€… 80186 ä»¥å‰ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠç¨‹åºå…¨éƒ½è£…å…¥å†…å­˜ï¼Œç¨‹åºéƒ½æ˜¯ç›´æ¥è¿è¡Œåœ¨ç‰©ç†å†…å­˜ä¸Šçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ç¨‹åºä¸­è®¿é—®çš„å†…å­˜åœ°å€éƒ½æ˜¯å®é™…çš„ç‰©ç†å†…å­˜åœ°å€ã€‚å½“è®¡ç®—æœºåŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºæ—¶ï¼Œå¿…é¡»ä¿è¯è¿™äº›ç¨‹åºç”¨åˆ°çš„å†…å­˜æ€»é‡è¦å°äºè®¡ç®—æœºå®é™…ç‰©ç†å†…å­˜çš„å¤§å°ã€‚ ä¾‹å¦‚æŸå°è®¡ç®—æœºæ€»çš„å†…å­˜å¤§å°æ˜¯128M ï¼Œç°åœ¨åŒæ—¶è¿è¡Œä¸¤ä¸ªç¨‹åº A å’Œ B ï¼ŒA éœ€å ç”¨å†…å­˜10M ï¼Œ B éœ€å ç”¨å†…å­˜110M ã€‚è®¡ç®—æœºåœ¨ç»™ç¨‹åºåˆ†é…å†…å­˜æ—¶ä¼šé‡‡å–è¿™æ ·çš„æ–¹æ³•ï¼šå…ˆå°†å†…å­˜ä¸­çš„å‰10Måˆ†é…ç»™ç¨‹åº A ï¼Œæ¥ç€å†ä»å†…å­˜ä¸­å‰©ä½™çš„118Mä¸­åˆ’åˆ†å‡º 110Måˆ†é…ç»™ç¨‹åº B ã€‚è¿™ç§åˆ†é…æ–¹æ³•è™½ç„¶å¯ä»¥ä¿è¯ç¨‹åº A å’Œç¨‹åº B éƒ½èƒ½è¿è¡Œï¼Œä½†æ˜¯è¿™ç§ç®€å•çš„å†…å­˜åˆ†é…ç­–ç•¥ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ï¼š é—®é¢˜ 1 ï¼šè¿›ç¨‹åœ°å€ç©ºé—´ä¸éš”ç¦»ã€‚ç”±äºç¨‹åºéƒ½æ˜¯ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥æ¶æ„ç¨‹åºå¯ä»¥éšæ„ä¿®æ”¹åˆ«çš„è¿›ç¨‹çš„å†…å­˜æ•°æ®ï¼Œä»¥è¾¾åˆ°ç ´åçš„ç›®çš„ã€‚æœ‰äº›éæ¶æ„ä½†æœ‰ bug çš„ç¨‹åºä¹Ÿå¯èƒ½ä¸å°å¿ƒä¿®æ”¹äº†å…¶å®ƒç¨‹åºçš„å†…å­˜æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒç¨‹åºçš„è¿è¡Œå‡ºç°å¼‚å¸¸ã€‚è¿™ç§æƒ…å†µå¯¹ç”¨æˆ·æ¥è¯´æ˜¯æ— æ³•å®¹å¿çš„ï¼Œå› ä¸ºç”¨æˆ·å¸Œæœ›ä½¿ç”¨è®¡ç®—æœºçš„æ—¶å€™ï¼Œå…¶ä¸­ä¸€ä¸ªä»»åŠ¡å¤±è´¥äº†ï¼Œä¸èƒ½å½±å“å…¶å®ƒçš„ä»»åŠ¡ã€‚ é—®é¢˜ 2 ï¼šå†…å­˜ä½¿ç”¨æ•ˆç‡ä½ã€‚åœ¨ A å’Œ B éƒ½è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ·åˆè¿è¡Œäº†ç¨‹åº C ï¼Œè€Œç¨‹åº C éœ€è¦ 20M å¤§å°çš„å†…å­˜æ‰èƒ½è¿è¡Œï¼Œè€Œæ­¤æ—¶ç³»ç»Ÿåªå‰©ä¸‹ 8M çš„ç©ºé—´å¯ä¾›ä½¿ç”¨ï¼Œæ‰€ä»¥æ­¤æ—¶ç³»ç»Ÿå¿…é¡»åœ¨å·²è¿è¡Œçš„ç¨‹åºä¸­é€‰æ‹©ä¸€ä¸ªå°†è¯¥ç¨‹åºçš„æ•°æ®æš‚æ—¶æ‹·è´åˆ°ç¡¬ç›˜ä¸Šï¼Œé‡Šæ”¾å‡ºéƒ¨åˆ†ç©ºé—´æ¥ä¾›ç¨‹åº C ä½¿ç”¨ï¼Œç„¶åå†å°†ç¨‹åº C çš„æ•°æ®å…¨éƒ¨è£…å…¥å†…å­˜ä¸­è¿è¡Œã€‚å¯ä»¥æƒ³è±¡å¾—åˆ°ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰å¤§é‡çš„æ•°æ®åœ¨è£…å…¥è£…å‡ºï¼Œå¯¼è‡´æ•ˆç‡ååˆ†ä½ä¸‹ã€‚ é—®é¢˜ 3 ï¼šç¨‹åºè¿è¡Œçš„åœ°å€ä¸ç¡®å®šã€‚å½“å†…å­˜ä¸­çš„å‰©ä½™ç©ºé—´å¯ä»¥æ»¡è¶³ç¨‹åº C çš„è¦æ±‚åï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨å‰©ä½™ç©ºé—´ä¸­éšæœºåˆ†é…ä¸€æ®µè¿ç»­çš„ 20M å¤§å°çš„ç©ºé—´ç»™ç¨‹åº C ä½¿ç”¨ï¼Œå› ä¸ºæ˜¯éšæœºåˆ†é…çš„ï¼Œæ‰€ä»¥ç¨‹åºè¿è¡Œçš„åœ°å€æ˜¯ä¸ç¡®å®šçš„ã€‚ äºŒã€è™šæ‹Ÿåœ°å€ç©ºé—´ä»‹ç»æ“ä½œç³»ç»Ÿè®©æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆVirtual Address Spaceï¼Œç®€ç§°VASï¼‰ã€‚ä»¥ 32 ä½è¿›ç¨‹ä¸ºä¾‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰0x00000000 ~ 0xFFFFFFFF(4GB)çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªè¿›ç¨‹éƒ½å¯èƒ½åˆ†é…åˆ°0x123456åœ°å€çš„å†…å­˜ï¼Œä½†è¿™ä¸ªåœ°å€ä¸èƒ½åœ¨è¿›ç¨‹é—´ç›¸äº’è®¿é—®ã€‚ å› ä¸ºè¿™äº›éƒ½æ˜¯â€œè™šæ‹Ÿâ€çš„åœ°å€ç©ºé—´ï¼Œè¿™äº›â€œåœ°å€â€éƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ŒCPU åœ¨å¯»å€çš„æ—¶å€™è™½ç„¶æ˜¯æŒ‰ç…§è™šæ‹Ÿåœ°å€æ¥å¯»å€çš„ï¼Œä½†æ˜¯è¿˜è¦é€šè¿‡MMU(å†…å­˜ç®¡ç†å•å…ƒ)æ¥å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†å­˜å‚¨å™¨ï¼ˆå¦‚å†…å­˜ç­‰ï¼‰ä¸Šçš„ç‰©ç†åœ°å€ï¼š ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œè¿›ç¨‹ A å’Œ B è™½ç„¶éƒ½æœ‰åœ°å€0x123456ï¼Œä½†å®ƒä»¬åˆ†åˆ«å¯¹åº”çš„ç‰©ç†åœ°å€ä¸ä¸€æ ·ã€‚ ##ä¸‰ã€è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†åŒºè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´è™½ç„¶å¾ˆå¤§ï¼Œä½†æ˜¯å®ƒè¢«åˆ’åˆ†æˆäº†å¾ˆå¤šåˆ†åŒºï¼Œä¾› Ring3 å±‚åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç”¨æˆ·æ¨¡å¼åˆ†åŒºå¹¶ä¸å¤§ï¼ˆä¸€åŠä¸åˆ°ï¼‰ï¼Œå¦‚å›¾ï¼š 3.1 ç©ºæŒ‡é’ˆèµ‹å€¼åˆ†åŒºè¿™ä¸€åˆ†åŒºçš„è¿›ç¨‹åœ°å€ç©ºé—´çš„èŒƒå›´ä¸ºï¼š[0x00000000, 0x0000FFFF]ï¼Œæ€»å¤§å°ä¸º64Kï¼Œä¿ç•™è¯¥åˆ†åŒºçš„ç›®çš„æ˜¯ä¸ºäº†å¸®åŠ©åº”ç”¨ç¨‹åºå‘˜æ•è·å¯¹ç©ºæŒ‡é’ˆçš„èµ‹å€¼ã€‚å¦‚mallocåˆ†é…å†…å­˜å¤±è´¥ï¼Œå°±ä¼šè¿”å›NULLã€‚ å¦‚æœè¿›ç¨‹ä¸­çš„çº¿ç¨‹è¯•å›¾è®¿é—®è¯¥åˆ†åŒºå†…çš„å†…å­˜åœ°å€ï¼Œå°±ä¼šå¼•å‘è®¿é—®è¿è§„ã€‚ 3.2 ç”¨æˆ·æ¨¡å¼åˆ†åŒºåœ¨ Windows ä¸­ï¼Œæ‰€æœ‰çš„ exe å’ŒåŠ¨æ€é“¾æ¥åº“éƒ½è½½å…¥åˆ°è¿™ä¸€åŒºåŸŸã€‚ç³»ç»ŸåŒæ—¶ä¼šæŠŠè¯¥è¿›ç¨‹å¯ä»¥è®¿é—®çš„æ‰€æœ‰å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆåé¢ä¼šä»‹ç»ï¼‰æ˜ å°„åˆ°è¿™ä¸€åˆ†åŒºã€‚ è¿›ç¨‹æ— æ³•é€šè¿‡æŒ‡é’ˆæ¥è¯»å–ã€å†™å…¥ã€è®¿é—®å…¶ä»–è¿›ç¨‹çš„è¿™ä¸€åˆ†åŒºï¼Œå› æ­¤ä¸€ä¸ªåº”ç”¨ç¨‹åºç ´åå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å¯èƒ½æ€§å°±éå¸¸å°äº†ï¼Œä»è€Œä½¿æ•´ä¸ªç³»ç»Ÿæ›´åŠ åšå›ºã€‚ 3.3 å†…æ ¸æ¨¡å¼åˆ†åŒºå†…æ ¸æ¨¡å¼åˆ†åŒºæ˜¯æ“ä½œç³»ç»Ÿä»£ç çš„é©»åœ°ã€‚ä¸çº¿ç¨‹è°ƒåº¦ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿæ”¯æŒã€ç½‘ç»œæ”¯æŒä»¥åŠè®¾å¤‡é©±åŠ¨ç¨‹åºç›¸å…³çš„ä»£ç éƒ½ä¼šè½½å…¥åˆ°è¿™ä¸€åˆ†åŒºã€‚è¯¥åˆ†åŒºå†…çš„ä»£ç å’Œæ•°æ®è¢«å®Œå…¨çš„ä¿æŠ¤èµ·æ¥äº†ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºè¯•å›¾è¯»å–æˆ–å†™å…¥ä½äºè¿™ä¸€åˆ†åŒºçš„å†…å­˜åœ°å€ï¼Œä¼šå¼•å‘è®¿é—®è¿è§„ã€‚ é©»ç•™åœ¨è¿™ä¸€åˆ†åŒºå†…çš„ä»£ç ä¸ºæ‰€æœ‰è¿›ç¨‹å…±æœ‰ã€‚ å››ã€è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä½¿ç”¨è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä½¿ç”¨æ¶‰åŠåˆ° 3 ä¸ªæ¦‚å¿µï¼šé¡µé¢å¤§å°ã€åˆ†é…ç²’åº¦ã€é¢„å®šå’Œè°ƒæ‹¨ã€‚ 4.1 é¡µé¢å¤§å°è™šæ‹Ÿåœ°å€ç©ºé—´è¢«åˆ†æˆä»¥â€œé¡µé¢â€ä¸ºå•ä½ï¼Œå› ä¸ºç¡¬ä»¶å†…å­˜ç®¡ç†å•å…ƒæ˜¯ä»¥é¡µé¢ä¸ºç²’åº¦å°†è™šæ‹Ÿåœ°å€è½¬è¯‘æˆç‰©ç†åœ°å€çš„ã€‚é¡µé¢çš„å¤§å°æ ¹æ®ä¸åŒçš„ CPU ä¸è€Œæœ‰æ‰€ä¸åŒã€‚x86 å’Œ x64 ç³»ç»Ÿä½¿ç”¨çš„é¡µé¢å¤§å°éƒ½æ˜¯4KBï¼Œè€Œ IA-64 ç³»ç»Ÿä½¿ç”¨çš„é¡µé¢å¤§å°æ˜¯8KBã€‚ IA-64 æ“ä½œç³»ç»Ÿåªèƒ½åœ¨ INTEL å®‰è…¾ç³»åˆ—å¤„ç†å™¨åŠ AMD éƒ¨åˆ†æœåŠ¡å™¨å¤„ç†å™¨è¿è¡Œï¼Œæ‰€ä»¥ä¸»æµå¸‚åœºå¹¶ä¸å¸¸è§ å½“åº”ç”¨ç¨‹åºåœ¨è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†é…ç©ºé—´æ—¶ï¼Œç³»ç»Ÿéœ€è¦ç¡®ä¿åˆ†é…åŒºåŸŸçš„å¤§å°æ­£å¥½æ˜¯ç³»ç»Ÿé¡µé¢å¤§å°çš„æ•´æ•°å€ã€‚ 4.2 åˆ†é…ç²’åº¦å½“åº”ç”¨ç¨‹åºåœ¨ä»è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†é…ç©ºé—´æ—¶ï¼Œç³»ç»Ÿä¼šç¡®ä¿æ‰€æœ‰åˆ†é…åŒºåŸŸçš„èµ·å§‹åœ°å€éƒ½æ˜¯åˆ†é…ç²’åº¦çš„æ•´æ•°å€ã€‚åˆ†é…ç²’åº¦çš„ä¼šæ ¹æ®ä¸åŒçš„ CPU å¹³å°è€Œæœ‰æ‰€ä¸åŒï¼Œä½†ç›®å‰æ‰€æœ‰çš„ CPU å¹³å°çš„åˆ†é…ç²’åº¦éƒ½æ˜¯ä½¿ç”¨64KBã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†é…çš„èµ·å§‹åœ°å€ = 64 * Nã€‚ é€šè¿‡ Windows çš„GetSystemInfoå‡½æ•°ä¹Ÿå¯ä»¥è·å¾—æ­¤åˆ†é…ç²’åº¦å€¼ã€‚ ä¸Šé¢æ‰€è¯´çš„åˆ†é…ç²’åº¦å’Œé¡µé¢å¤§å°çš„é™åˆ¶ï¼Œåªæ˜¯é’ˆå¯¹äºâ€œåº”ç”¨ç¨‹åºâ€ï¼Œç³»ç»Ÿå†…æ ¸è‡ªå·±ä¸å­˜åœ¨è¿™æ ·çš„é™åˆ¶ã€‚ 4.3 é¢„å®šå’Œè°ƒæ‹¨è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä½¿ç”¨åˆ†ä¸º 2 ä¸ªæ­¥éª¤ï¼š é¢„å®šï¼ˆreserveï¼‰ï¼šå‘Šè¯‰ç³»ç»Ÿæˆ‘ä»¬è¦ä»è™šæ‹Ÿåœ°å€ç©ºé—´é¢„å®šå“ªä¸€å—åŒºåŸŸï¼Œç³»ç»Ÿä¸ºæˆ‘ä»¬ä¿ç•™è¿™ä¸€å—åŒºåŸŸã€‚é¢„å®šçš„å±€åŸŸçš„èµ·å§‹åœ°å€å’Œå¤§å°éµå¾ªä¸Šé¢ä»‹ç»çš„åˆ†é…ç²’åº¦å’Œé¡µé¢å¤§å°çš„è¦æ±‚ã€‚å› ä¸ºé¢„å®šçš„åªæ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä¸å ç”¨ä»»ä½•å…¶ä»–ç‰©ç†å­˜å‚¨å™¨ï¼Œæ‰€ä»¥æ²¡æœ‰å½¢æˆå®è´¨çš„å¼€é”€ã€‚ è°ƒæ‹¨ï¼ˆcommitï¼‰ï¼šé¢„å®šçš„åŒºåŸŸè¿˜ä¸èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºé¢„å®šçš„åŒºåŸŸä»é¡µäº¤æ¢æ–‡ä»¶ä¸­è°ƒæ‹¨å­˜å‚¨å™¨ï¼Œè°ƒæ‹¨ä¹‹åæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨è¯¥åŒºåŸŸã€‚è‡³äºä¸ºä»€ä¹ˆè¦ä»é¡µäº¤æ¢æ–‡ä»¶ä¸­è°ƒæ‹¨å­˜å‚¨å™¨ï¼Ÿ é¡µäº¤æ¢æ–‡ä»¶å¦‚ä½•ä¸ç‰©ç†å†…å­˜ä¹‹é—´äº¤äº’ï¼Ÿåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« Windowså†…å­˜ä½“ç³»(2)--è™šæ‹Ÿå†…å­˜ä¸­ä¼šè¯¦ç»†ä»‹ç»ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["è™šæ‹Ÿåœ°å€"],"categories":["Windowsç¼–ç¨‹"]},{"title":"åˆè¯†WebRTC","path":"/post/3298681169.html","content":"WebRTC ï¼ˆWeb Real-Time Communicationsï¼‰ æ˜¯ä¸€é¡¹å®æ—¶é€šè®¯æŠ€æœ¯ï¼Œå®ƒå…è®¸ç½‘ç»œåº”ç”¨æˆ–è€…ç«™ç‚¹åœ¨ä¸å€ŸåŠ©ä¸­é—´åª’ä»‹çš„æƒ…å†µä¸‹ï¼Œå»ºç«‹æµè§ˆå™¨ä¹‹é—´ç‚¹å¯¹ç‚¹ï¼ˆPeer-to-Peerï¼‰çš„è¿æ¥ï¼Œå®ç°è§†é¢‘æµå’Œï¼ˆæˆ–ï¼‰éŸ³é¢‘æµæˆ–è€…å…¶ä»–ä»»æ„æ•°æ®çš„ä¼ è¾“ã€‚WebRTCåŒ…å«çš„è¿™äº›æ ‡å‡†ä½¿ç”¨æˆ·åœ¨æ— éœ€å®‰è£…ä»»ä½•æ’ä»¶æˆ–è€…ç¬¬ä¸‰æ–¹çš„è½¯ä»¶çš„æƒ…å†µä¸‹ï¼Œåˆ›å»ºç‚¹å¯¹ç‚¹ï¼ˆPeer-to-Peerï¼‰çš„æ•°æ®åˆ†äº«å’Œç”µè¯ä¼šè®®æˆä¸ºå¯èƒ½ã€‚ å®ƒå¹¶ä¸æ˜¯å•ä¸€çš„åè®®ï¼ŒåŒ…å«äº†åª’ä½“ã€åŠ å¯†ã€ä¼ è¾“å±‚ç­‰åœ¨å†…çš„å¤šä¸ªåè®®æ ‡å‡†ä»¥åŠä¸€å¥—åŸºäº JavaScript çš„ APIã€‚é€šè¿‡ç®€å•æ˜“ç”¨çš„ JavaScript API ï¼Œåœ¨ä¸å®‰è£…ä»»ä½•æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œè®©æµè§ˆå™¨æ‹¥æœ‰äº† P2PéŸ³è§†é¢‘å’Œæ•°æ®åˆ†äº«çš„èƒ½åŠ›ã€‚åŒæ—¶WebRTC å¹¶ä¸æ˜¯ä¸€ä¸ªå­¤ç«‹çš„åè®®ï¼Œå®ƒæ‹¥æœ‰çµæ´»çš„ä¿¡ä»¤ï¼Œå¯ä»¥ä¾¿æ·çš„å¯¹æ¥ç°æœ‰çš„SIP å’Œç”µè¯ç½‘ç»œçš„ç³»ç»Ÿã€‚ ä¸åŒæŠ€æœ¯é¢†åŸŸçš„äººéƒ½å¯ä»¥ä»WebRTCä¸­è·å–åˆ°éœ€è¦çš„ä¸œè¥¿ã€‚ ä¸€. æ”¯æŒçš„æµè§ˆå™¨å’Œå¹³å°ç›®å‰åŸºæœ¬ä¸Šæ‰€æœ‰çš„æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒWebRTC äºŒ. WebRTC å†…éƒ¨ç»“æ„ æ¶æ„å›¾é¢œè‰²æ ‡è¯†è¯´æ˜ï¼š ç´«è‰²éƒ¨åˆ†æ˜¯Webå¼€å‘è€…APIå±‚ è“è‰²å®çº¿éƒ¨åˆ†æ˜¯é¢å‘æµè§ˆå™¨å‚å•†çš„APIå±‚ è“è‰²è™šçº¿éƒ¨åˆ†æµè§ˆå™¨å‚å•†å¯ä»¥è‡ªå®šä¹‰å®ç° WebRTCæœ‰ä¸‰ä¸ªæ¨¡å—ï¼š Voice Engineï¼ˆéŸ³é¢‘å¼•æ“ï¼‰ Voice EngineåŒ…å«iSAC&#x2F;iLBC Codecï¼ˆéŸ³é¢‘ç¼–è§£ç å™¨ï¼Œå‰è€…æ˜¯é’ˆå¯¹å®½å¸¦å’Œè¶…å®½å¸¦ï¼Œåè€…æ˜¯é’ˆå¯¹çª„å¸¦ï¼‰ NetEQ for voiceï¼ˆå¤„ç†ç½‘ç»œæŠ–åŠ¨å’Œè¯­éŸ³åŒ…ä¸¢å¤±ï¼‰ Echo Cancelerï¼ˆå›å£°æ¶ˆé™¤å™¨ï¼‰&#x2F; Noise Reductionï¼ˆå™ªå£°æŠ‘åˆ¶ï¼‰ Video Engineï¼ˆè§†é¢‘å¼•æ“ï¼‰ VP8 Codecï¼ˆè§†é¢‘å›¾åƒç¼–è§£ç å™¨ï¼‰ Video jitter bufferï¼ˆè§†é¢‘æŠ–åŠ¨ç¼“å†²å™¨ï¼Œå¤„ç†è§†é¢‘æŠ–åŠ¨å’Œè§†é¢‘ä¿¡æ¯åŒ…ä¸¢å¤±ï¼‰ Image enhancementsï¼ˆå›¾åƒè´¨é‡å¢å¼ºï¼‰ Transport SRTPï¼ˆå®‰å…¨çš„å®æ—¶ä¼ è¾“åè®®ï¼Œç”¨ä»¥éŸ³è§†é¢‘æµä¼ è¾“ï¼‰ Multiplexingï¼ˆå¤šè·¯å¤ç”¨ï¼‰ P2Pï¼ŒSTUN+TURN+ICEï¼ˆç”¨äºNATç½‘ç»œå’Œé˜²ç«å¢™ç©¿è¶Šçš„ï¼‰ é™¤æ­¤ä¹‹å¤–ï¼Œå®‰å…¨ä¼ è¾“å¯èƒ½è¿˜ä¼šç”¨åˆ°DTLSï¼ˆæ•°æ®æŠ¥å®‰å…¨ä¼ è¾“ï¼‰ï¼Œç”¨äºåŠ å¯†ä¼ è¾“å’Œå¯†é’¥åå•† æ•´ä¸ªWebRTCé€šä¿¡æ˜¯åŸºäºUDPçš„ ä¸‰. WebRTC çš„æ ¸å¿ƒç»„ä»¶ éŸ³è§†é¢‘å¼•æ“ï¼šOPUSã€VP8 &#x2F; VP9ã€H264 ä¼ è¾“å±‚åè®®ï¼šåº•å±‚ä¼ è¾“åè®®ä¸º UDP åª’ä½“åè®®ï¼šSRTP &#x2F; SRTCP æ•°æ®åè®®ï¼šDTLS &#x2F; SCTP P2P å†…ç½‘ç©¿é€ï¼šSTUN &#x2F; TURN &#x2F; ICE &#x2F; Trickle ICE ä¿¡ä»¤ä¸ SDP åå•†ï¼šHTTP &#x2F; WebSocket &#x2F; SIPã€ Offer &#x2F; Answer æ¨¡å‹ å››. WebRTC éŸ³é¢‘å’Œè§†é¢‘å¼•æ“ æœ€åº•å±‚æ˜¯ç¡¬ä»¶è®¾å¤‡ï¼Œä¸Šé¢æ˜¯éŸ³é¢‘æ•è·æ¨¡å—å’Œè§†é¢‘æ•è·æ¨¡å— ä¸­é—´éƒ¨åˆ†ä¸ºéŸ³è§†é¢‘å¼•æ“ã€‚éŸ³é¢‘å¼•æ“è´Ÿè´£éŸ³é¢‘é‡‡é›†å’Œä¼ è¾“ï¼Œå…·æœ‰é™å™ªã€å›å£°æ¶ˆé™¤ç­‰åŠŸèƒ½ã€‚è§†é¢‘å¼•æ“è´Ÿè´£ç½‘ç»œæŠ–åŠ¨ä¼˜åŒ–ï¼Œäº’è”ç½‘ä¼ è¾“ç¼–è§£ç ä¼˜åŒ– åœ¨éŸ³è§†é¢‘å¼•æ“ä¹‹ä¸Šæ˜¯ ä¸€å¥— C++ APIï¼Œåœ¨ C++ çš„ API ä¹‹ä¸Šæ˜¯æä¾›ç»™æµè§ˆå™¨çš„Javascript API. äº”. WebRTC åè®®æ ˆ WebRTC æ ¸å¿ƒçš„åè®®éƒ½æ˜¯åœ¨å³ä¾§åŸºäº UDP åŸºç¡€ä¸Šæ­å»ºèµ·æ¥çš„ã€‚ å…¶ä¸­ï¼ŒICEã€STUNã€TURN ç”¨äºå†…ç½‘ç©¿é€ã€‚ DTLS ç”¨äºå¯¹ä¼ è¾“å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥çœ‹åšæ˜¯ UDP ç‰ˆçš„ TLSã€‚ç”±äº WebRTC å¯¹å®‰å…¨æ¯”è¾ƒé‡è§†ï¼Œæ‰€ä»¥è¿™ä¸€å±‚æ˜¯å¿…é¡»çš„ã€‚æ‰€æœ‰WebRTCç»„ä»¶éƒ½å¿…é¡»åŠ å¯†ï¼Œå¹¶ä¸”å…¶JavaScript APIåªèƒ½ç”¨äºå®‰å…¨æºï¼ˆHTTPSæˆ–æœ¬åœ°ä¸»æœºï¼‰ã€‚ä¿¡ä»¤æœºåˆ¶å¹¶ä¸æ˜¯ç”±WebRTCæ ‡å‡†å®šä¹‰çš„ï¼Œæ‰€ä»¥æ‚¨å¿…é¡»ç¡®ä¿ä½¿ç”¨å®‰å…¨åè®®ã€‚ SRTP ä¸ SRTCP æ˜¯å¯¹åª’ä½“æ•°æ®çš„å°è£…ä¸ä¼ è¾“æ§åˆ¶åè®® SCTP æ˜¯æµæ§åˆ¶ä¼ è¾“åè®®ï¼Œæä¾›ç±»ä¼¼ TCP çš„ç‰¹æ€§ï¼ŒSCTP å¯ä»¥åŸºäº UDP ä¸Šæ„å»ºï¼Œåœ¨ WebRTC é‡Œæ˜¯åœ¨ DTLS åè®®ä¹‹ä¸Šã€‚ RTCPeerConnection ç”¨æ¥å»ºç«‹å’Œç»´æŠ¤ç«¯åˆ°ç«¯è¿æ¥ï¼Œå¹¶æä¾›é«˜æ•ˆçš„éŸ³è§†é¢‘æµä¼ è¾“ã€‚ RTCDataChannel ç”¨æ¥æ”¯æŒç«¯åˆ°ç«¯çš„ä»»æ„äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚ WebRTC åè®®æ ˆè§£é‡Š ICEï¼ŒSTUNï¼ŒTURNï¼šç”¨äºNATç©¿é€ï¼Œå‚è€ƒ WebRTCçš„ä¸‰ç§æ¶æ„ SDPï¼šä¼šè¯æè¿°åè®®ï¼ˆRFC 4566ï¼‰ DTLSï¼šæ•°æ®æŠ¥ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆRFC 6347ï¼‰ SCTPï¼šæµæ§åˆ¶ä¼ è¾“åè®®ï¼ˆRFC 4960ï¼‰ SRTPï¼šå®‰å…¨å®æ—¶ä¼ è¾“åè®®ï¼ˆRFC 3711ï¼‰","tags":["WebRTC"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"SDPæ ¼å¼è§£æ","path":"/post/2172509399.html","content":"ä¼šè¯æè¿°åè®®ï¼ˆSession Description Protocol æˆ–ç®€å†™ SDPï¼‰æè¿°çš„æ˜¯æµåª’ä½“çš„åˆå§‹åŒ–å‚æ•°ã€‚æ­¤åè®®ç”± IETF å‘è¡¨ä¸º RFC 2327ã€‚ SDP å®Œå…¨æ˜¯ä¸€ç§ä¼šè¯æè¿°æ ¼å¼ï¼Œå®ƒä¸å±äºä¼ è¾“åè®®ã€‚ SDP ç”¨äºæè¿°å¤šåª’ä½“é€šä¿¡ä¼šè¯ï¼ŒåŒ…æ‹¬ä¼šè¯å»ºç«‹ã€ä¼šè¯è¯·æ±‚å’Œå‚æ•°åå•†ã€‚SDP ä¸ç”¨äºä¼ è¾“åª’ä½“æ•°æ®ï¼Œåªèƒ½ç”¨äºä¸¤ä¸ªé€šä¿¡ç»ˆç«¯çš„å‚æ•°åå•†ï¼ŒåŒ…æ‹¬åª’ä½“ç±»å‹ã€æ ¼å¼ä»¥åŠæ‰€æœ‰å…¶ä»–å’Œä¼šè¯ç›¸å…³çš„å±æ€§ã€‚SDP ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æè¿°ä¸Šè¿°åˆå§‹åŒ–å‚æ•°ã€‚ ä¸€ã€SDP ç»„æˆSDP æ˜¯ç”±å¤šè¡Œæ–‡æœ¬ç»„æˆçš„ä¸€ä¸ªçº¯æ–‡æœ¬åè®®ï¼Œå¦‚æœå°†SDPä»è¯­ä¹‰ä¸Šåˆ†è§£æˆä¸åŒç»„ä»¶æ¥æè¿°ä¸€ä¸ªå¤šåª’ä½“ä¼šè¯ä¿¡æ¯ï¼Œé‚£ä¹ˆSDPç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š ä¼šè¯ä¿¡æ¯ ç½‘ç»œä¿¡æ¯ åª’ä½“ä¿¡æ¯ å®‰å…¨ä¿¡æ¯ æœåŠ¡è´¨é‡å’Œåˆ†ç»„ä¿¡æ¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566 +---------------------+ | v= | +---------------------+ +---------------------+ +---------------------+ ==== | Session Metadata | ===== | o= | | +---------------------+ +---------------------- | +---------------------+ | | t= | | +---------------------+ | | | +---------------------+ | | c= | | +---------------------+ | +---------------------+ ==== | Network Description | ===== | +---------------------+ | +---------------------+ | | a=candidate | | +---------------------+ | | | +---------------------+ | | m= | | +---------------------+ | +---------------------+ +---------------------+ ==== | Stream Description | ===== | a=rtpmap | | +---------------------+ +---------------------- | +---------------------+ | | a=fmtp | | +---------------------+ | +---------------------+ | | a=sendrecv.. | | +---------------------++---------------+| SEMANTIC || COMPONENTS OF || SDP |+---------------+ | +---------------------+ | | a=crypto | | +---------------------+ | +---------------------+ +---------------------+ ==== |Security Descriptions| =====| a=ice-frag | | +---------------------+ +---------------------- | +---------------------+ | | a=ice-pwd | | +---------------------+ | +---------------------+ | | a=fingerprint | | +---------------------+ | | | | +---------------------+ | | a=rtcp-fb | | +---------------------+ | +---------------------+ +---------------------+ ==== | Qos,Grouping | | | | Descriptions | =====| a=group | +---------------------+ +---------------------- +---------------------+ | a=rtcpmux | +---------------------+ äºŒã€SDP æ ¼å¼SDP ç”±å¤šè¡Œç»„æˆï¼Œæ¯è¡Œçš„çš„æ ¼å¼å¦‚ä¸‹ï¼š 1&lt;type&gt;=&lt;value&gt; &lt;type&gt;: åŒºåˆ†å¤§å°å†™ï¼Œä»£è¡¨ç‰¹å®šçš„å±æ€§ï¼Œä¾‹å¦‚vä»£è¡¨ SDP ç‰ˆæœ¬ã€‚ &lt;value&gt;ï¼šUTF8 ç¼–ç çš„æ–‡æœ¬ï¼Œå…·ä½“æ ¼å¼ä¸ç±»å‹æœ‰å…³ã€‚ =ä¸¤è¾¹ä¸å…è®¸å­˜åœ¨ç©ºæ ¼ã€‚ =*è¡¨ç¤ºè¯¥é¡¹æ˜¯å¯é€‰çš„ã€‚ ä¸‹é¢æ˜¯ WebRTCï¼ˆbranch_76ï¼‰çš„ä¸€ä¸ªçœŸå® SDP æ ·æœ¬: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144// -------------------------------- ã€Session Metadataéƒ¨åˆ†ã€‘ --------------------------------// sdpç‰ˆæœ¬å·v=0// o=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;unicast-address&gt;// usernameå¦‚ä½•æ²¡æœ‰ä½¿ç”¨-ä»£æ›¿ï¼Œ3967017503571418851æ˜¯æ•´ä¸ªä¼šè¯çš„ç¼–å·ï¼Œ2ä»£è¡¨ä¼šè¯ç‰ˆæœ¬ï¼Œå¦‚æœåœ¨ä¼šè¯è¿‡ç¨‹ä¸­æœ‰æ”¹å˜ç¼–ç ä¹‹ç±»çš„æ“ä½œï¼Œé‡æ–°ç”Ÿæˆsdpæ—¶,sess-idä¸å˜ï¼Œsess-versionåŠ 1o=- 3967017503571418851 2 IN IP4 127.0.0.1//ä¼šè¯ås=-// ä¼šè¯çš„èµ·å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œ0ä»£è¡¨æ²¡æœ‰é™åˆ¶t=0 0// è¡¨ç¤ºéœ€è¦å…±ç”¨ä¸€ä¸ªä¼ è¾“é€šé“ä¼ è¾“çš„åª’ä½“ï¼Œé€šè¿‡ssrcè¿›è¡ŒåŒºåˆ†ä¸åŒçš„æµã€‚å¦‚æœæ²¡æœ‰è¿™ä¸€è¡Œï¼ŒéŸ³è§†é¢‘æ•°æ®å°±ä¼šåˆ†åˆ«ç”¨å•ç‹¬udpç«¯å£æ¥å‘é€.a=group:BUNDLE audio video// WMSæ˜¯WebRTC Media Streamç®€ç§°;// è¿™ä¸€è¡Œå®šä¹‰äº†æœ¬å®¢æˆ·ç«¯æ”¯æŒåŒæ—¶ä¼ è¾“å¤šä¸ªæµï¼Œä¸€ä¸ªæµå¯ä»¥åŒ…æ‹¬å¤šä¸ªtrack.// ä¸€èˆ¬å®šä¹‰äº†è¿™ä¸ªï¼Œåé¢a=ssrcè¿™ä¸€è¡Œå°±ä¼šæœ‰msid,mslabelç­‰å±æ€§.a=msid-semantic: WMS stream_id// -------------------------------- ã€Stream Descriptionéƒ¨åˆ†ã€‘ --------------------------------// ------------ audioéƒ¨åˆ† -------------// mæ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªåª’ä½“è¡Œ.// m=audioè¯´æ˜æœ¬ä¼šè¯åŒ…å«éŸ³é¢‘ï¼Œ9ä»£è¡¨éŸ³é¢‘ä½¿ç”¨ç«¯å£9æ¥ä¼ è¾“ï¼Œä½†æ˜¯åœ¨webrtcä¸­ç°åœ¨ä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œä»£è¡¨ä¸ä¼ è¾“éŸ³é¢‘,// UDP/TLS/RTP/SAVPFæ˜¯è¡¨ç¤ºç”¨æˆ·æ”¯æŒæ¥ä¼ è¾“éŸ³é¢‘çš„åè®®ï¼Œudp,tls,rtpä»£è¡¨ä½¿ç”¨udpæ¥ä¼ è¾“rtpåŒ…ï¼Œå¹¶ä½¿ç”¨tlsåŠ å¯†// SAVPFä»£è¡¨ä½¿ç”¨srtcpçš„åé¦ˆæœºåˆ¶æ¥æ§åˆ¶é€šä¿¡è¿‡ç¨‹// åé¢çš„111 103 104 9 102 0 8 106 105 13 110 112 113 126è¡¨ç¤ºæœ¬ä¼šè¯éŸ³é¢‘æ”¯æŒçš„ç¼–ç ï¼Œåé¢å‡ è¡Œä¼šæœ‰è¯¦ç»†è¡¥å……è¯´æ˜.m=audio 9 UDP/TLS/RTP/SAVPF 111 103 104 9 102 0 8 106 105 13 110 112 113 126// è¡¨ç¤ºä½ è¦ç”¨æ¥æ¥æ”¶æˆ–è€…å‘é€éŸ³é¢‘ä½¿ç”¨çš„IPåœ°å€.// webrtcä½¿ç”¨iceä¼ è¾“ï¼Œä¸ä½¿ç”¨è¿™ä¸ªåœ°å€c=IN IP4 0.0.0.0// ç”¨æ¥ä¼ è¾“rtcpçš„åœ°å€å’Œç«¯å£ï¼Œwebrtcä¸­ä¸ä½¿ç”¨a=rtcp:9 IN IP4 0.0.0.0// ä¸‹é¢2è¡Œæ˜¯iceåå•†è¿‡ç¨‹ä¸­çš„å®‰å…¨éªŒè¯ä¿¡æ¯a=ice-ufrag:kSq0a=ice-pwd:pWLGrCTwFNq6rm249ZEasHPY// é€šçŸ¥å¯¹ç«¯æ”¯æŒtrickleï¼Œå³sdpé‡Œé¢æè¿°åª’ä½“ä¿¡æ¯å’Œiceå€™é€‰é¡¹çš„ä¿¡æ¯å¯ä»¥åˆ†å¼€ä¼ è¾“a=ice-options:trickle// dtlsåå•†è¿‡ç¨‹ä¸­éœ€è¦çš„è®¤è¯ä¿¡æ¯a=fingerprint:sha-256 A0:D6:B2:63:1B:69:0E:91:01:C3:88:A9:92:6F:E7:EF:5B:36:52:66:08:DF:94:A0:FE:0C:C9:06:BF:2C:38:A2// ä»£è¡¨æœ¬å®¢æˆ·ç«¯åœ¨dtlsåå•†è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åšå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥åšæœåŠ¡ç«¯, å‚è€ƒrfc4145 rfc4572a=setup:actpass// å‰é¢BUNDLEè¡Œä¸­ç”¨åˆ°çš„åª’ä½“æ ‡è¯†a=mid:audio// æŒ‡å‡ºè¦åœ¨rtpå¤´éƒ¨ä¸­åŠ å…¥éŸ³é‡ä¿¡æ¯ï¼Œå‚è€ƒ rfc6464a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level// æŒ‡å‡ºæ˜¯åŒå‘é€šä¿¡ï¼Œå¦å¤–å‡ ç§ç±»å‹æ˜¯recvonly,sendonly,inactivea=sendrecv// æŒ‡å‡ºrtp,rtcpåŒ…ä½¿ç”¨åŒä¸€ä¸ªç«¯å£æ¥ä¼ è¾“a=rtcp-mux// ä¸‹é¢åå‡ è¡Œéƒ½æ˜¯å¯¹m=audioè¿™ä¸€è¡Œçš„åª’ä½“ç¼–ç è¡¥å……è¯´æ˜ï¼ŒæŒ‡å‡ºäº†ç¼–ç é‡‡ç”¨çš„ç¼–å·ï¼Œé‡‡æ ·ç‡ï¼Œå£°é“ç­‰a=rtpmap:111 opus/48000/2a=rtcp-fb:111 transport-cc// ä¸‹é¢ä¸€è¡Œå¯¹opusç¼–ç å¯é€‰çš„è¡¥å……è¯´æ˜,minptimeä»£è¡¨æœ€å°æ‰“åŒ…æ—¶é•¿æ˜¯10msï¼Œuseinbandfec=1ä»£è¡¨ä½¿ç”¨opusç¼–ç å†…ç½®fecç‰¹æ€§a=fmtp:111 minptime=10;useinbandfec=1a=rtpmap:103 ISAC/16000a=rtpmap:104 ISAC/32000a=rtpmap:9 G722/8000a=rtpmap:102 ILBC/8000a=rtpmap:0 PCMU/8000a=rtpmap:8 PCMA/8000a=rtpmap:106 CN/32000a=rtpmap:105 CN/16000a=rtpmap:13 CN/8000a=rtpmap:110 telephone-event/48000a=rtpmap:112 telephone-event/32000a=rtpmap:113 telephone-event/16000a=rtpmap:126 telephone-event/8000// cnameç”¨æ¥æ ‡è¯†ä¸€ä¸ªæ•°æ®æºï¼Œssrcå½“å‘ç”Ÿå†²çªæ—¶å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯cnameä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¼šå‡ºç°åœ¨rtcpåŒ…ä¸­SDECä¸­ï¼Œç”¨äºéŸ³è§†é¢‘åŒæ­¥a=ssrc:2603526440 cname:AyMDWB+q6ApWdpfUa=ssrc:2603526440 msid:stream_id audio_labela=ssrc:2603526440 mslabel:stream_ida=ssrc:2603526440 label:audio_label// ------------ videoéƒ¨åˆ† -------------m=video 9 UDP/TLS/RTP/SAVPF 96 97 98 99 100 101 127c=IN IP4 0.0.0.0a=rtcp:9 IN IP4 0.0.0.0a=ice-ufrag:kSq0a=ice-pwd:pWLGrCTwFNq6rm249ZEasHPYa=ice-options:tricklea=fingerprint:sha-256 A0:D6:B2:63:1B:69:0E:91:01:C3:88:A9:92:6F:E7:EF:5B:36:52:66:08:DF:94:A0:FE:0C:C9:06:BF:2C:38:A2a=setup:actpassa=mid:videoa=extmap:2 urn:ietf:params:rtp-hdrext:toffseta=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-timea=extmap:4 urn:3gpp:video-orientationa=extmap:5 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01a=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/playout-delaya=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-content-typea=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/video-timinga=sendrecva=rtcp-muxa=rtcp-rsizea=rtpmap:96 VP8/90000a=rtcp-fb:96 goog-remba=rtcp-fb:96 transport-cca=rtcp-fb:96 ccm fira=rtcp-fb:96 nacka=rtcp-fb:96 nack plia=rtpmap:97 rtx/90000a=fmtp:97 apt=96a=rtpmap:98 VP9/90000a=rtcp-fb:98 goog-remba=rtcp-fb:98 transport-cca=rtcp-fb:98 ccm fira=rtcp-fb:98 nacka=rtcp-fb:98 nack plia=rtpmap:99 rtx/90000a=fmtp:99 apt=98a=rtpmap:100 red/90000a=rtpmap:101 rtx/90000a=fmtp:101 apt=100a=rtpmap:127 ulpfec/90000a=ssrc-group:FID 1563406656 4103641903a=ssrc:1563406656 cname:AyMDWB+q6ApWdpfUa=ssrc:1563406656 msid:stream_id video_labela=ssrc:1563406656 mslabel:stream_ida=ssrc:1563406656 label:video_labela=ssrc:4103641903 cname:AyMDWB+q6ApWdpfUa=ssrc:4103641903 msid:stream_id video_labela=ssrc:4103641903 mslabel:stream_ida=ssrc:4103641903 label:video_label 2.1 åè®®ç‰ˆæœ¬ç¬¬ä¸€è¡Œv=0å®šä¹‰äº† sdp åè®®çš„ç‰ˆæœ¬å·ã€‚ 2.2 ä¼šè¯å‘èµ·è€…ç¬¬äºŒè¡Œ 1o=- 3967017503571418851 2 IN IP4 127.0.0.1 å®šä¹‰äº†ä¼šè¯å‘èµ·è€…çš„ä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 1o=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;unicast-address&gt; usernameï¼šå‘èµ·è€…çš„ç”¨æˆ·åï¼Œä¸å…è®¸å­˜åœ¨ç©ºæ ¼ï¼Œå¦‚æœåº”ç”¨ä¸æ”¯æŒç”¨æˆ·åï¼Œåˆ™ä¸º-ã€‚ sess-idï¼šä¼šè¯ idï¼Œç”±åº”ç”¨è‡ªè¡Œå®šä¹‰ï¼ŒSDP è§„èŒƒå»ºè®®ä½¿ç”¨ NTP(Network Time Protocol)æ—¶é—´æˆ³ã€‚ sess-versionï¼šä¼šè¯ç‰ˆæœ¬ï¼Œç”¨é€”ç”±åº”ç”¨è‡ªè¡Œå®šä¹‰ï¼Œåªè¦ä¼šè¯æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ¯”å¦‚ç¼–ç ï¼‰sess-version éšç€é€’å¢å³å¯ã€‚SDP è§„èŒƒå»ºè®®ä½¿ç”¨ NTP æ—¶é—´æˆ³ã€‚ nettypeï¼šç½‘ç»œç±»å‹ï¼Œæ¯”å¦‚ IN è¡¨ç¤º Internetã€‚ addrtypeï¼šåœ°å€ç±»å‹ï¼Œæ¯”å¦‚ IP4ã€IV6 unicast-addressï¼šåŸŸåï¼Œæˆ–è€… IP åœ°å€ã€‚ 2.3 ä¼šè¯å1s=&lt;session name&gt; å¿…é€‰ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªs=å­—æ®µï¼Œä¸”ä¸èƒ½ä¸ºç©ºã€‚å¯ä»¥èµ‹ä¸€ä¸ªç©ºæ ¼ï¼ˆå³s= ï¼‰ï¼Œæˆ–è€…-ã€‚ 2.4 è¿æ¥ä¿¡æ¯1c=&lt;nettype&gt; &lt;addrtype&gt; &lt;connection-address&gt; æ¯ä¸ª SDP è‡³å°‘éœ€è¦åŒ…å«ä¸€ä¸ªä¼šè¯çº§åˆ«çš„c=å­—æ®µï¼Œæˆ–è€…åœ¨æ¯ä¸ªåª’ä½“æè¿°åé¢å„åŒ…å«ä¸€ä¸ªc=å­—æ®µï¼Œï¼ˆåª’ä½“æè¿°åçš„c=ä¼šè¦†ç›–ä¼šè¯çº§åˆ«çš„c=ï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ SDP æ ·æœ¬ä¸­ï¼Œå°±ä¸å­˜åœ¨ä¼šè¯çº§åˆ«çš„è¿æ¥ä¿¡æ¯ã€‚ nettypeï¼šç½‘ç»œç±»å‹ï¼Œæ¯”å¦‚ INï¼Œè¡¨ç¤º Internetã€‚ addrtypeï¼šåœ°å€ç±»å‹ï¼Œæ¯”å¦‚ IP4ã€IP6ã€‚ connection-addressï¼šå¦‚æœæ˜¯å¹¿æ’­ï¼Œåˆ™ä¸ºå¹¿æ’­åœ°å€ç»„ï¼›å¦‚æœæ˜¯å•æ’­ï¼Œåˆ™ä¸ºå•æ’­åœ°å€ï¼› 2.4.1 ä½•ä¸ºä¼šè¯çº§åˆ«å’Œåª’ä½“çº§åˆ«ä¼šè¯çº§éƒ¨åˆ†ä»¥v =è¡Œå¼€å§‹ï¼Œåˆ°ç¬¬ä¸€ä¸ªåª’ä½“çº§éƒ¨åˆ†ç»“æŸã€‚æ¯ä¸ªåª’ä½“çº§éƒ¨åˆ†ä»¥m =è¡Œå¼€å§‹ï¼ŒæŒç»­åˆ°ä¸‹ä¸€ä¸ªåª’ä½“çº§ï¼ˆå³ä¸‹ä¸€ä¸ªm=ï¼‰ã€‚ 2.5 åª’ä½“æè¿°ä¿¡æ¯SDP å¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ªåª’ä½“æè¿°ä¿¡æ¯ï¼ˆå¦‚éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 1m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt; ... ç¤ºä¾‹ï¼š 12m=audio 9 UDP/TLS/RTP/SAVPF 111 103 104 9 102 0 8 106 105 13 110 112 113 126c=IN IP4 0.0.0.0 mediaï¼šåª’ä½“ç±»å‹ï¼ŒåŒ…æ‹¬ videoã€audioã€textã€applicationã€message ç­‰ã€‚ portï¼šä¼ è¾“åª’ä½“æµä½¿ç”¨çš„ç«¯å£ï¼Œå…·ä½“å«ä¹‰å–å†³äºä½¿ç”¨çš„ç½‘ç»œç±»å‹ï¼ˆåœ¨c=ä¸­å£°æ˜ï¼‰å’Œä½¿ç”¨çš„ä¼ è¾“åè®®(proto)ã€‚ protoï¼šä¼ è¾“åè®®ï¼Œå…·ä½“å«ä¹‰å–å†³äºc=ä¸­å®šä¹‰çš„åœ°å€ç±»å‹ï¼Œæ¯”å¦‚c=IP4ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ä¼ è¾“åè®®è¿è¡Œåœ¨ IP4 ä¹‹ä¸Šã€‚ fmtï¼šåª’ä½“æ ¼å¼çš„æè¿°ï¼Œå¯èƒ½æœ‰å¤šä¸ªã€‚æ ¹æ®protoçš„ä¸åŒï¼Œfmtçš„å«ä¹‰ä¹Ÿä¸åŒã€‚æ¯”å¦‚protoä¸º RTP&#x2F;SAVP æ—¶ï¼Œfmt è¡¨ç¤º RTP payload çš„ç±»å‹ã€‚å¦‚æœæœ‰å¤šä¸ªï¼Œè¡¨ç¤ºåœ¨è¿™æ¬¡ä¼šè¯ä¸­ï¼Œå¤šç§ payload ç±»å‹å¯èƒ½ä¼šç”¨åˆ°ï¼Œä¸”ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤çš„ payload ç±»å‹ã€‚æ•°å­—0~95æ˜¯é™æ€è´Ÿè½½ç±»å‹ï¼›96~127æ˜¯åŠ¨æ€è´Ÿè½½ç±»å‹ï¼Œéœ€è¦åœ¨åé¢ä½¿ç”¨é™„è¿‘å±æ€§a = rtpmap:æŒ‡å®šå…·ä½“çš„æ ¼å¼å‚æ•°ã€‚å…·ä½“çš„æ¯ä¸ªæ•°å­—ä»£è¡¨çš„è´Ÿè½½ç±»å‹å’Œå«ä¹‰å¯ä»¥å‚è€ƒï¼šReal-Time Transport Protocol (RTP) Parameterså¦‚ä¸Šä¾‹ä¸­çš„ audio ç±»å‹çš„111è¡¨ç¤ºä½¿ç”¨ opus ç¼–ç ã€‚ 2.6 é™„åŠ å±æ€§é™„åŠ å±æ€§ç”¨äºæ‰©å±• SDPï¼Œæœ‰ 2 ç§ä½œç”¨èŒƒå›´ï¼šä¼šè¯çº§åˆ«ã€åª’ä½“çº§åˆ«ï¼š åª’ä½“çº§åˆ«ï¼šåª’ä½“æè¿°ï¼ˆm&#x3D;ï¼‰åé¢å¯ä»¥è·Ÿä»»æ„æ•°é‡çš„ a&#x3D; å­—æ®µï¼Œå¯¹åª’ä½“æè¿°è¿›è¡Œæ‰©å±•ã€‚ ä¼šè¯çº§åˆ«ï¼šåœ¨ç¬¬ä¸€ä¸ªåª’ä½“å­—æ®µ(media field)å‰ï¼Œæ·»åŠ çš„ a&#x3D; å­—æ®µæ˜¯ä¼šè¯çº§åˆ«çš„ã€‚ æœ‰ä¸‹é¢ 2 ç§æ ¼å¼ï¼š 12a=&lt;attribute&gt;a=&lt;attribute&gt;:&lt;value&gt; 2.7 æ—¶é—´ç”¨äºå£°æ˜ä¼šè¯çš„å¼€å§‹ã€ç»“æŸæ—¶é—´ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 1t=&lt;start-time&gt; &lt;stop-time&gt; å¦‚æœ&lt;stop-time&gt;æ˜¯ 0ï¼Œè¡¨ç¤ºä¼šè¯æ²¡æœ‰ç»“æŸçš„è¾¹ç•Œï¼Œä½†æ˜¯éœ€è¦åœ¨&lt;start-time&gt;ä¹‹åä¼šè¯æ‰æ˜¯æ´»è·ƒ(active)çš„ï¼›å¦‚æœ&lt;start-time&gt;æ˜¯ 0ï¼Œè¡¨ç¤ºä¼šè¯æ˜¯æ°¸ä¹…çš„ã€‚ SDP for the WebRTC &gt; WebRTCï¼šä¼šè¯æè¿°åè®® SDP &gt; WebRTC ä¸­çš„ SDP åè®®","tags":["WebRTC","SDP"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"ç½‘ç»œåè®®(7)--HTTPä¸HTTPSåè®®","path":"/post/3654006375.html","content":"HTTP æ˜¯Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™ã€‚HTTP åè®®ä½äº TCP&#x2F;IP åè®®æ ˆçš„åº”ç”¨å±‚ã€‚ ä¸€ã€HTTP åè®®ä»‹ç»1.1 ä»€ä¹ˆæ˜¯ HTTPHTTP æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼Œä¸»è¦ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆå³WWWï¼Œå…¨ç§° World Wide Webï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨ä¹‹é—´çš„è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®çš„åè®®ã€‚å®¢æˆ·ç«¯é€šè¿‡ä½¿ç”¨ç½‘é¡µæµè§ˆå™¨æˆ–è€…å…¶å®ƒçš„å·¥å…·å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º80ï¼‰ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œè¿”å›å“åº”å†…å®¹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ç­‰ï¼‰ã€‚ HTTP åè®®æ˜¯åŸºäº TCP åè®®æ¥è¿›è¡Œæ•°æ®ä¼ è¾“çš„ã€‚ 1.2 HTTP çš„ç‰ˆæœ¬HTTP åè®®å·²ç»æ¼”åŒ–å‡ºäº†å¾ˆå¤šç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸­çš„å¤§éƒ¨åˆ†éƒ½æ˜¯å‘ä¸‹å…¼å®¹çš„ã€‚å®¢æˆ·ç«¯åœ¨è¯·æ±‚çš„å¼€å§‹å‘Šè¯‰æœåŠ¡å™¨å®ƒé‡‡ç”¨çš„åè®®ç‰ˆæœ¬å·ï¼Œè€Œåè€…åˆ™åœ¨å“åº”ä¸­é‡‡ç”¨ç›¸åŒæˆ–è€…æ›´æ—©çš„åè®®ç‰ˆæœ¬ã€‚ç°åœ¨å¤§å¤šä½¿ç”¨çš„éƒ½æ˜¯1.1ç‰ˆæœ¬ã€‚ 1.0 ç‰ˆæœ¬ï¼š HTTP åè®®éå¸¸è€çš„æ ‡å‡†ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„æ•ˆç‡ï¼ŒHTTP 1.0 è§„å®šæµè§ˆå™¨ä¸æœåŠ¡å™¨åªä¿æŒçŸ­æš‚çš„è¿æ¥ï¼Œæµè§ˆå™¨çš„æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼ŒæœåŠ¡å™¨å®Œæˆè¯·æ±‚å¤„ç†åç«‹å³æ–­å¼€ TCP è¿æ¥ï¼ŒæœåŠ¡å™¨ä¸è·Ÿè¸ªæ¯ä¸ªå®¢æˆ·ä¹Ÿä¸è®°å½•è¿‡å»çš„è¯·æ±‚ã€‚æ­£å¼å› ä¸ºè¿™ç§ç‰¹æ€§é€ æˆäº†ä¸€äº›æ€§èƒ½ä¸Šçš„ç¼ºé™·ã€‚ 1.1 ç‰ˆæœ¬ï¼š å…‹æœäº† HTTP 1.0 çš„ç¼ºé™·ï¼ŒHTTP 1.1 æ”¯æŒæŒä¹…è¿æ¥ï¼ˆHTTP&#x2F;1.1 çš„é»˜è®¤æ¨¡å¼ä½¿ç”¨å¸¦æµæ°´çº¿çš„æŒä¹…è¿æ¥ï¼‰ï¼Œåœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå¯ä»¥ä¼ é€å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ï¼Œå‡å°‘äº†å»ºç«‹å’Œå…³é—­è¿æ¥çš„æ¶ˆè€—å’Œå»¶è¿Ÿã€‚åŒæ—¶è¿˜å¢åŠ æ›´å¤šçš„è¯·æ±‚å¤´å’Œå“åº”å¤´æ¥æ”¹è¿›å’Œæ‰©å…… HTTP 1.0 çš„åŠŸèƒ½ï¼ˆå¦‚ POST è¯·æ±‚å¤´å­—æ®µç­‰ï¼‰ã€‚ 2.0 ç‰ˆæœ¬ï¼š 2015 å¹´ 5 æœˆä½œä¸ºäº’è”ç½‘æ ‡å‡†æ­£å¼å‘å¸ƒã€‚ä¸»è¦æ–°å¢å¦‚ä¸‹ç‰¹æ€§ï¼šå¤šè·¯å¤ç”¨ï¼ŒäºŒè¿›åˆ¶åˆ†å¸§ï¼Œé¦–éƒ¨å‹ç¼©ï¼ŒæœåŠ¡ç«¯æ¨é€ã€‚ äºŒã€HTTP æ¶ˆæ¯è¯·æ±‚2.1 URIã€URLã€URNé€šè¿‡ HTTP æˆ–è€… HTTPS åè®®è¯·æ±‚çš„èµ„æºç”±ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiersï¼ŒURIï¼‰æ¥æ ‡è¯†ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ URLï¼Œé‚£ä¹ˆ URI, URL, URN ä¹‹å‰æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»äº†ï¼Ÿ 123URI = Uniform Resource Identifier ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦URL = Uniform Resource Locator ç»Ÿä¸€èµ„æºå®šä½ç¬¦URN = Universal Resource Name ç»Ÿä¸€èµ„æºåç§° ä¸‰è€…å…³ç³»å¦‚ä¸‹å›¾ï¼š URIç”¨æ¥å”¯ä¸€æ ‡è¯†ç¬¦æ¥æ ‡è¯†ä¸€ä¸ªèµ„æºï¼Œæ˜¯ä¸€ä¸ªé€šç”¨çš„æ¦‚å¿µï¼ŒURIç”±URLå’ŒURNä¸¤ä¸ªå­é›†ç»„æˆã€‚ URLé€šè¿‡æè¿°èµ„æºçš„ä½ç½®æ¥æ ‡è¯†èµ„æºã€‚ URNé€šè¿‡èµ„æºçš„åå­—æ¥æ ‡è¯†èµ„æºï¼Œä¸å…¶æ‰€å¤„çš„ä½ç½®æ— å…³ï¼Œè¿™æ ·å³ä½¿èµ„æºçš„ä½ç½®å‘ç”Ÿå˜åŠ¨ï¼Œå…¶URNä¹Ÿä¸ä¼šå˜åŒ–ã€‚ HTTP è§„èŒƒå°†æ›´é€šç”¨çš„æ¦‚å¿µ URI ä½œä¸ºå…¶èµ„æºæ ‡è¯†ç¬¦ï¼Œä½†æ˜¯å®é™…ä¸Šï¼ŒHTTP åº”ç”¨ç¨‹åºå¤„ç†çš„åªæ˜¯ URI çš„ URL å­é›†. 2.2 æ¶ˆæ¯è¯·æ±‚æ ¼å¼ 2.3 HTTP å¸¸è§çš„è¯·æ±‚æ–¹æ³•HTTP æ¶ˆæ¯è¯·æ±‚çš„ç¬¬ä¸€ä¸ªå­—æ®µå°±æ˜¯â€œè¯·æ±‚æ–¹æ³•â€ï¼ŒHTTP 1.1 ä¸­å®šä¹‰çš„å‡ ç§å¸¸è§çš„è¯·æ±‚æ–¹æ³•å¦‚ä¸‹ï¼ˆåªåˆ—å‡ºäº†å¸¸ç”¨çš„ï¼‰ï¼š GETå‘æœåŠ¡å™¨è·å–æ•°æ®ã€‚ä½¿ç”¨ GET è¯·æ±‚æ–¹æ³•æ—¶ï¼Œæ¶ˆæ¯ Body ä¸­æ²¡æœ‰â€œè¯·æ±‚æ•°æ®â€ï¼ˆè§ä¸Šé¢æ¶ˆæ¯æ ¼å¼çš„å›¾ï¼‰éƒ¨åˆ†ï¼Œæ‰€ä»¥å°†éœ€è¦æäº¤åˆ°æœåŠ¡å™¨çš„æ•°æ®æ”¾åœ¨ URL ä¸­ï¼Œå› æ­¤èƒ½å¤Ÿæäº¤åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼šå—åˆ° URL é•¿åº¦çš„é™åˆ¶ã€‚ 12345678910 å„ä¸ªæµè§ˆå™¨å¯¹URLé•¿åº¦çš„é™åˆ¶å¦‚ä¸‹ï¼ˆè¿™äº›é™åˆ¶å€¼å¯èƒ½éšç€æµè§ˆå™¨çš„ç‰ˆæœ¬çš„æ›´æ–°è€Œå‘ç”Ÿæ”¹å˜ï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š1. IEæµè§ˆå™¨ï¼ˆMicrosoft Internet Explorerï¼‰ å¯¹URLé•¿åº¦é™åˆ¶æ˜¯2083ï¼ˆ2K+53ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼Œåˆ™è‡ªåŠ¨æˆªæ–­ï¼ˆè‹¥æ˜¯formæäº¤åˆ™æäº¤æŒ‰é’®ä¸èµ·ä½œç”¨ï¼‰ã€‚2. FirefoxFirefoxï¼ˆç«ç‹æµè§ˆå™¨ï¼‰å¯¹URLé•¿åº¦é™åˆ¶æ˜¯65536å­—ç¬¦ï¼Œä½†å®é™…ä¸Šæœ‰æ•ˆçš„URLæœ€å¤§é•¿åº¦ä¸å°‘äº100,000ä¸ªå­—ç¬¦ã€‚3. Chromechromeå¯¹URLé•¿åº¦é™åˆ¶æ˜¯8182ä¸ªå­—ç¬¦ã€‚4. SafariSafariå¯¹URLé•¿åº¦é™åˆ¶æ˜¯80000å­—ç¬¦ã€‚5. OperaOperaæµè§ˆå™¨å¯¹URLé•¿åº¦é™åˆ¶æ˜¯190000 å­—ç¬¦ã€‚ POSTå‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æäº¤çš„æ•°æ®åŒ…å«åœ¨ Body ä¸­ã€‚ ä¸‰ã€HTTP æ¶ˆæ¯å“åº”3.1 æ¶ˆæ¯å“åº”æ ¼å¼ 3.2 HTTP çŠ¶æ€ç çŠ¶æ€ä»£ç ç”±ä¸‰ä½æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªæ•°å­—å®šä¹‰äº†å“åº”çš„ç±»åˆ«ï¼Œå…±åˆ†äº”ç§ç±»åˆ«: 123451xxæ¶ˆæ¯â€”â€” è¯·æ±‚å·²è¢«æœåŠ¡å™¨æ¥æ”¶ï¼Œç»§ç»­å¤„ç†2xxæˆåŠŸ â€”â€” è¯·æ±‚å·²æˆåŠŸè¢«æœåŠ¡å™¨æ¥æ”¶ã€ç†è§£ã€å¹¶æ¥å—3xxé‡å®šå‘ â€”â€” éœ€è¦åç»­æ“ä½œæ‰èƒ½å®Œæˆè¿™ä¸€è¯·æ±‚4xxè¯·æ±‚é”™è¯¯ â€”â€” è¯·æ±‚å«æœ‰è¯æ³•é”™è¯¯æˆ–è€…æ— æ³•è¢«æ‰§è¡Œ5xxæœåŠ¡å™¨é”™è¯¯ â€”â€” æœåŠ¡å™¨åœ¨å¤„ç†æŸä¸ªæ­£ç¡®è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ å¸¸è§çš„çŠ¶æ€ç æœ‰ï¼š 1234567200 OK //å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸ400 Bad Request //å®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£401 Unauthorized //è¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’ŒWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨403 Forbidden //æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡404 Not Found //è¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œæ¯”å¦‚ï¼šè¾“å…¥äº†é”™è¯¯çš„URL500 Internal Server Error //æœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯503 Server Unavailable //ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ å…³äº HTTP çŠ¶æ€ç çš„å®Œæ•´å®šä¹‰è§ï¼šhttps://tools.ietf.org/html/rfc2616#page-39 å››ã€HTTPS ä¹‹å¯†ç å­¦åŸºç¡€4.1 å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆè‹±æ–‡ï¼šSymmetric-key algorithmï¼‰æ˜¯æŒ‡å¯†ç å­¦ä¸­çš„ä¸€ç±»åŠ å¯†ç®—æ³•ï¼Œåˆç§°ä¸ºï¼šç§é’¥åŠ å¯†ã€å…±äº«å¯†é’¥åŠ å¯†ã€‚è¿™ç±»ç®—æ³•åœ¨åŠ å¯†å’Œè§£å¯†æ—¶ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼ˆæˆ–è€…è¿™ 2 ä¸ªå¯†é’¥å¯ä»¥é€šè¿‡ç®€å•çš„è§„åˆ™ç›¸äº’æ¨ç®—ï¼‰ã€‚â€œå¯¹ç§°åŠ å¯†ç®—æ³•â€æ¯”â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€é€Ÿåº¦æ›´å¿«ï¼Œä½†å¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¸»è¦ç¼ºç‚¹åœ¨äºè¦æ±‚åŠ å¯†å’Œè§£å¯†çš„åŒæ–¹è·å–ç›¸åŒçš„å¯†é’¥ï¼Œè¿™æ ·åªè¦å¯†é’¥è¢«æ³„æ¼ï¼Œåˆ™å¯†æ–‡å°†ä¸å†å®‰å…¨ã€‚ å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼š DES: Data Encryption Standard, æ•°æ®åŠ å¯†æ ‡å‡†ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºåŠ å¯†å¤§é‡æ•°æ®çš„åœºåˆã€‚ 3DES: Triple DES, æ˜¯åŸºäº DESï¼Œå¯¹ä¸€å—æ•°æ®ç”¨ä¸‰ä¸ªä¸åŒçš„å¯†é’¥è¿›è¡Œä¸‰æ¬¡åŠ å¯†ï¼Œå¼ºåº¦æ›´é«˜ã€‚ AES: Advanced Encryption Standard, é«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸‹ä¸€ä»£çš„åŠ å¯†ç®—æ³•æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨çº§åˆ«é«˜ã€‚ Blowfish: ä¸€ä¸ª 64 ä½åˆ†ç»„åŠå¯å˜å¯†é’¥é•¿åº¦çš„å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ç®—æ³•ï¼Œå¯ç”¨æ¥åŠ å¯† 64 æ¯”ç‰¹é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚ IDEA: åœ¨ DES ç®—æ³•çš„åŸºç¡€ä¸Šå‘å±•å‡ºæ¥çš„ï¼Œå¯†é’¥ä¸º 128 ä½ã€‚ RC5 RC6 4.2 éå¯¹ç§°åŠ å¯†ç®—æ³•â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€åˆç§°ä¸ºâ€œå…¬å¼€å¯†é’¥åŠ å¯†â€ï¼ˆè‹±è¯­ï¼špublic-key cryptographyï¼‰ã€‚ä¹Ÿä¸€ç§å¯†ç å­¦ç®—æ³•ç±»å‹ï¼Œåœ¨è¿™ç±»åŠ å¯†ç®—æ³•ä¸­ï¼Œéœ€è¦ä¸€ä¸ªâ€œå¯†é’¥å¯¹â€ï¼Œå³â€œç§é’¥â€å’Œâ€œå…¬é’¥â€ã€‚è¿™ä¸¤ä¸ªå¯†é’¥æ˜¯æ•°å­¦ç›¸å…³ï¼Œç”¨æŸä¸ªå¯†é’¥å¯¹çš„â€œç§é’¥â€åŠ å¯†çš„ä¿¡æ¯ï¼Œåªèƒ½ç”¨è¯¥å¯†é’¥å¯¹çš„â€œå…¬é’¥â€æ‰èƒ½è§£å¯†ã€‚åŒæ ·ï¼Œç”¨â€œå…¬é’¥â€åŠ å¯†çš„ä¿¡æ¯ï¼Œä¹Ÿåªèƒ½ç”¨è¯¥å¯†é’¥å¯¹çš„â€œç§é’¥â€æ‰èƒ½è§£å¯†ã€‚ â€œç§é’¥â€ä¸€èˆ¬éƒ½æ˜¯è‡ªå·±ä¿ç•™ï¼Œä¸é€éœ²ç»™ä»–äººï¼›è€Œâ€œå…¬é’¥â€å¯ä»¥å…¬å¼€ç»™ä»–äººã€‚ â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€æ¯”â€œå¯¹ç§°åŠ å¯†ç®—æ³•â€å®‰å…¨æ€§æ›´é«˜ï¼Œä¸ç”¨æ‹…å¿ƒåŠ å¯†å¯†é’¥çš„æ³„æ¼ï¼Œå› ä¸ºâ€œå…¬é’¥â€æ˜¯å…¬å¼€çš„ï¼Œä¸å­˜åœ¨æ³„æ¼ã€‚ä½†â€œç§é’¥â€è¿˜æ˜¯è¦ä¿å­˜å¦¥å½“ï¼Œä¸èƒ½æ³„éœ²ç»™ä»–äººï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦åœ¨ç½‘ç»œä¸Šä¼ è¾“â€œç§é’¥â€ï¼Œæ‰€ä»¥â€œç§é’¥â€æ³„éœ²çš„å¯èƒ½æ€§ä¼šå°å¾ˆå¤šã€‚ ä½†æ˜¯â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€æ¯”â€œå¯¹ç§°åŠ å¯†ç®—æ³•â€çš„è¿ç®—é€Ÿåº¦æ…¢å¾ˆå¤šï¼Œä¸€èˆ¬åœ¨æ•°æ®é‡æ¯”è¾ƒå°‘çš„æ—¶å€™é‡‡ç”¨â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€ã€‚ å¦‚ä¸Šå›¾ï¼Œå› ä¸ºæå››çš„â€œå…¬é’¥â€æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥å¼ ä¸‰è¦ç»™æå››å‘é€ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨æå››çš„â€œå…¬é’¥â€æ¥åŠ å¯†ä¿¡æ¯ã€‚æå››æ”¶åˆ°å¯†æ–‡ä¿¡æ¯ä¹‹åå°±å¯ä»¥ä½¿ç”¨è‡ªå·±çš„â€œç§é’¥â€æ¥è§£å¯†ä¿¡æ¯ã€‚å› ä¸ºå…¶ä»–äººæ²¡æœ‰æå››çš„â€œç§é’¥â€ï¼Œæ‰€ä»¥å°±ç®—å¯†æ–‡ä¿¡æ¯è¢«ä»–äººæˆªè·ä¹Ÿæ— æ³•è§£å¯†ã€‚ å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ï¼š RSA: ç”± RSA å…¬å¸å‘æ˜ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒå˜é•¿å¯†é’¥çš„å…¬å…±å¯†é’¥ç®—æ³•ï¼Œéœ€è¦åŠ å¯†çš„æ–‡ä»¶å—çš„é•¿åº¦ä¹Ÿæ˜¯å¯å˜çš„ã€‚ DSA: Digital Signature Algorithm, æ•°å­—ç­¾åç®—æ³•ï¼Œæ˜¯ä¸€ç§æ ‡å‡†çš„ DSSï¼ˆæ•°å­—ç­¾åæ ‡å‡†ï¼‰ã€‚ ECC: Elliptic Curves Cryptography, æ¤­åœ†æ›²çº¿å¯†ç ç¼–ç å­¦ã€‚ éå¯¹ç§°ç®—æ³•è™½ç„¶å®‰å…¨ï¼Œä½†è¿ç®—é€Ÿåº¦å¾ˆæ…¢ï¼Œè€Œå¯¹ç§°ç®—æ³•çš„é€Ÿåº¦è™½å¿«ï¼Œä½†åœ¨ç®¡ç†å’Œä¼ è¾“å¯†é’¥æ–¹é¢ä¼šå­˜åœ¨å®‰å…¨éšæ‚£ã€‚åœ¨å®é™…çš„æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨çš„æ–¹å¼æ˜¯ï¼šé‡‡ç”¨â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€ç®¡ç†â€œå¯¹ç§°åŠ å¯†ç®—æ³•â€çš„å¯†é’¥ï¼Œç„¶åç”¨â€œå¯¹ç§°åŠ å¯†ç®—æ³•â€åŠ å¯†æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±é›†æˆäº†ä¸¤ç±»åŠ å¯†ç®—æ³•çš„ä¼˜ç‚¹ï¼Œæ—¢å®ç°äº†åŠ å¯†é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ï¼Œåˆå®ç°äº†å®‰å…¨æ–¹ä¾¿ç®¡ç†å¯†é’¥çš„ä¼˜ç‚¹ã€‚ ä½¿ç”¨ OpenSSL ç”Ÿæˆ RSA å…¬ç§é’¥å¯¹ 12345// ç”Ÿæˆ1024ä½çš„ç§é’¥openssl genrsa -out d:\\rsa_private.pem 1024// ç”Ÿæˆç§é’¥å¯¹åº”çš„å…¬é’¥openssl rsa -in d:\\rsa_private.pem -pubout -out d:\\ca_public.pem git å®¢æˆ·ç«¯å®‰è£…æ–‡ä»¶ä¸­çš„æä¾›çš„ssh-keygen.exeå·¥å…·ä¹Ÿå¯ä»¥ç”¨æ¥ç”Ÿäº§éå¯¹ç§°åŠ å¯†çš„å…¬ç§é’¥å¯¹ã€‚ 4.3 æ•£åˆ—å‡½æ•°æ•£åˆ—å‡½æ•°ï¼ˆè‹±æ–‡ï¼šHash Functionï¼‰æ˜¯å°†ä»»æ„é•¿åº¦çš„çš„è¾“å…¥è½¬åŒ–ä¸ºå®šé•¿è¾“å‡ºçš„ç®—æ³•ã€‚ç¼–ç¨‹ä¸­å¯¹æ•£åˆ—å‡½æ•°ä½¿ç”¨éå¸¸æ™®éï¼Œå¦‚MD5,ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•£åˆ—å‡½æ•°éƒ½é€‚ç”¨äºå¯†ç å­¦ã€‚å¯†ç å­¦çš„æ•£åˆ—å‡½æ•°å¿…é¡»åŒæ—¶å…·æœ‰å¦‚ä¸‹å‡ ä¸ªé¢å¤–çš„ç‰¹æ€§ï¼š å•å‘æ€§ï¼šç»™å®šä¸€ä¸ªæ•£åˆ—å€¼ï¼Œæ— æ³•åå‘æ‰¾åˆ°æˆ–è€…æ„é€ å‡ºç”Ÿæˆå®ƒçš„æ¶ˆæ¯ã€‚ æŠ—ç¢°æ’æ€§ï¼šç»™å®šä¸€ä¸ªæ¶ˆæ¯å’Œå®ƒçš„æ•£åˆ—å€¼ï¼Œæ— æ³•æ‰¾åˆ°å…·æœ‰ç›¸åŒæ•£åˆ—å€¼çš„ä¸åŒçš„æ¶ˆæ¯ã€‚ æ•£åˆ—å‡½æ•°æœ€å¸¸ç”¨çš„åœºåˆæ˜¯ä»¥ç´§å‡‘çš„æ–¹å¼æ¥å”¯ä¸€è¡¨ç¤ºå¤§é‡æ•°æ®ï¼Œå¦‚â€œæ•°å­—ç­¾åâ€ä¸­ç”¨åˆ°æ•£åˆ—å‡½æ•°ç”Ÿæˆæ‘˜è¦ä¿¡æ¯ç­‰ã€‚ å¸¸è§çš„æ•£åˆ—å‡½æ•°ï¼š MD5ï¼š1991 å¹´å¯¹ MD4 çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œè¯¥ç®—æ³•ä¸å¯é€†ã€‚2004 å¹´ç‹å°äº‘ç­‰äººè¯æ˜äº†å®Œå…¨ç¢°æ’ï¼Œåœ¨ç†è®ºä¸Šè¯´æ˜ MD5 å¯ä»¥è¢«å®Œå…¨æ”»ç ´ï¼Œ2005 å¹´ï¼ŒLenstra ç­‰äººè¯æ˜äº†ç°å®ä¸­çš„ç¢°æ’ï¼Œå±•ç¤ºäº†ä¸¤å¼ å®Œå…¨ä¸åŒçš„è¯ä¹¦å´æ‹¥æœ‰åŒæ ·çš„ MD5 æ•£åˆ—å€¼ã€‚æ‰€ä»¥ï¼Œç›®å‰MD5å·²ç»ä¸å®‰å…¨äº†ã€‚ SHA-1ï¼šSHA-1 åœ¨è®¸å¤šå®‰å…¨åè®®ä¸­å¹¿ä¸ºä½¿ç”¨ï¼ŒåŒ…æ‹¬ TLS å’Œ SSLã€PGPã€SSHã€S&#x2F;MIME å’Œ IPsecï¼Œæ›¾è¢«è§†ä¸ºæ˜¯ MD5 çš„åç»§è€…ï¼Œä½†å› ä¸ºåœ¨ç†è®ºåœ¨å·²ç»è¯æ˜ SHA1 å¯ä»¥è¢«ç ´è§£ï¼Œä½†é™åˆ¶äºè®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æ‰€ä»¥ SHA-1 è¢«ç ´è§£è¿˜æ˜¯å¾ˆå›°éš¾ï¼Œæ‰€ä»¥ SHA-1 çš„å®‰å…¨æ€§å¦‚ä»Šè¢«å¯†ç å­¦å®¶ä¸¥é‡è´¨ç–‘ã€‚ SHA-256ï¼šSHA-224ã€SHA-256ã€SHA-384ã€SHA-512 ä¸€èµ·å¹¶ç§°ä¸º SHA-2ï¼Œè‡³ä»Šå°šæ‰¾å‡ºå¯¹ SHA-2 æœ‰æ•ˆçš„ç ´è§£æ–¹æ³•ã€‚ äº”ã€æ•°å­—ç­¾åä¸æ•°å­—è¯ä¹¦5.1 æ•°å­—ç­¾åæ•°å­—ç­¾åï¼ˆè‹±æ–‡ï¼šDigital Signatureï¼‰ç±»ä¼¼äºæˆ‘ä»¬å†™åœ¨çº¸ä¸Šçš„æ‰‹å†™ç­¾åï¼Œå®ƒçš„è¯ç”Ÿä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š è¯æ˜è¯¥æ–‡ä»¶ï¼ˆæˆ–ä¿¡æ¯ï¼‰æ˜¯ç”±ä½ å‘é€çš„ã€‚ è¯æ˜è¯¥æ–‡ä»¶ï¼ˆæˆ–ä¿¡æ¯ï¼‰æ²¡æœ‰è¢«ä»–äººç¯¡æ”¹è¿‡ã€‚ å…¶å®ï¼Œæˆ‘ä»¬ç”Ÿæ´»ä¸­æ‰‹å†™ç­¾åçš„çº¸è´¨åˆåŒä¹Ÿæ˜¯é€šè¿‡å„ç§å½¢å¼è¾¾åˆ°ä¸Šé¢ 2 ä¸ªæ•ˆæœï¼ˆå¦‚ï¼šåˆåŒä¸€å¼å¤šä»½ï¼Œæ¯ä»½åˆåŒéƒ½æœ‰åŒæ–¹ç­¾åç­‰ï¼‰ã€‚ æ•°å­—ç­¾ååˆ©ç”¨äº†â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€ï¼Œç­¾åå’ŒéªŒè¯ç­¾åçš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆå›¾ä¸­çš„â€œè®¤è¯â€éƒ¨åˆ†ä¸æ˜¯æ•°å­—ç­¾åå¿…é¡»çš„ï¼Œåœ¨â€œæ•°å­—è¯ä¹¦â€éƒ¨åˆ†ä¼šä»‹ç»ï¼‰ï¼š å‡è®¾â€œæå››â€è¦å‘é€ä¸€ä»½æ•°æ®ç»™â€œå¼ ä¸‰â€ï¼šå‘é€è€…â€œæå››â€å¯¹æ•°æ®ç”Ÿæˆæ‘˜è¦ä¿¡æ¯ï¼ˆæ‘˜è¦æ˜æ–‡Aï¼‰ï¼Œç„¶åä½¿ç”¨â€œæå››â€çš„â€œç§é’¥â€åŠ å¯†æ‘˜è¦ä¿¡æ¯ï¼›æ¥æ”¶è€…â€œå¼ ä¸‰â€æ”¶åˆ°åŠ å¯†çš„æ‘˜è¦ä¿¡æ¯ä¹‹åï¼š ä½¿ç”¨â€œæå››â€çš„â€œå…¬é’¥â€å¯¹åŠ å¯†çš„æ‘˜è¦ä¿¡æ¯è¿›è¡Œè§£å¯†ã€‚è‹¥èƒ½è§£å¯†åˆ™è¯æ˜ç­¾åæ˜¯ç”±â€œæå››â€æ‰€ç­¾ï¼Œè¿™æ˜¯å› ä¸ºåªæœ‰â€œæå››â€çš„â€œç§é’¥â€åŠ å¯†çš„æ•°æ®æ‰èƒ½ç”±â€œæå››â€çš„â€œå…¬é’¥â€è§£å¯†ï¼Œè€Œåˆåªæœ‰â€œæå››â€æ‰æœ‰â€œæå››â€çš„â€œç§é’¥â€ã€‚ å¹¶å°†æ•°æ®ä½¿ç”¨ç›¸åŒçš„æ‘˜è¦ç®—æ³•è‡ªå·±ä¹Ÿç”Ÿæˆä¸€ä»½æ‘˜è¦ä¿¡æ¯ï¼ˆæ‘˜è¦æ˜æ–‡Bï¼‰ï¼Œç„¶åæ¯”è¾ƒ A å’Œ Bã€‚è‹¥ä¸¤è€…ç›¸ç­‰ï¼Œåˆ™è¯æ˜äº†è¯¥æ•°æ®å†…å®¹æ²¡æœ‰è¢«ä»–äººç¯¡æ”¹è¿‡ã€‚ é€šè¿‡ä¸Šé¢çš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š æ•°å­—ç­¾åå…·æœ‰åˆæ³•æ€§çš„å‰ææ¡ä»¶æ˜¯ç”¨äºåŠ å¯†æ•£åˆ—å€¼çš„â€œç§é’¥â€æ²¡æœ‰è¢«æ³„éœ²ã€‚ æ•°å­—ç­¾åä¸è´Ÿè´£æ•°æ®çš„åŠ å¯†ï¼Œè‹¥è¦é˜²æ­¢æ•°æ®è¢«ä»–äººçª¥è§†ï¼Œåˆ™è¿˜è¦ç»“åˆå…¶ä»–æ‰‹æ®µï¼Œå¦‚ä½¿ç”¨æ¥æ”¶è€…çš„â€œå…¬é’¥â€å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ç­‰ã€‚ å¦‚ä½•è·å–ç­¾åè€…çš„å…¬é’¥ï¼Ÿå¦‚ä½•ä¿è¯è·å¾—çš„å…¬é’¥å°±æ˜¯ç­¾åè€…çš„ï¼Œè€Œä¸æ˜¯ä»–äººçš„ï¼ŸåŸºäºè¿™äº›é—®é¢˜ï¼Œæ•°å­—ç­¾åéœ€è¦ç»“åˆåé¢ä»‹ç»çš„æ•°å­—è¯ä¹¦æ¥ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„â€œè®¤è¯â€æ–‡ä»¶ï¼‰ã€‚ 5.2 æ•°å­—è¯ä¹¦æœ‰äº†ä¸Šé¢çš„å…¬å¼€å¯†é’¥ç®—æ³•ï¼ˆä¹Ÿå°±æ˜¯â€œéå¯¹ç§°åŠ å¯†ç®—æ³•â€ï¼‰ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»–äººçš„å…¬å¼€å¯†é’¥ï¼ˆå…¬é’¥ï¼‰ä¸å…¶å®‰å…¨é€šä¿¡äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›æ‚¬è€Œæœªå†³çš„é—®é¢˜ï¼š å¦‚ä½•è·å–é‚£äº›ä»æœªè°‹é¢çš„äººçš„å…¬é’¥ï¼Ÿ å¦‚ä½•å­˜å‚¨å’ŒåŠé”€è¿™äº›å…¬é’¥ï¼Ÿ å¦‚ä½•ç¡®ä¿è·å–çš„å…¬é’¥å°±æ˜¯é‚£ä¸ªäººçš„ï¼Ÿ å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆpublic key infrastructure, ç®€ç§°KPIï¼‰å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå»ºç«‹çš„ã€‚PKIçš„ç›®æ ‡å°±æ˜¯ä¸ºäº†å®ç°ä¸åŒæˆå‘˜åœ¨ä¸è§é¢çš„æƒ…å†µä¸‹è¿›è¡Œå®‰å…¨é€šä¿¡çš„ï¼Œæˆ‘ä»¬å½“å‰é‡‡ç”¨çš„ PKI æ¨¡å‹æ˜¯åŸºäºå¯ä¿¡çš„ç¬¬ä¸‰æ–¹æœºæ„ï¼Œä¹Ÿå°±æ˜¯â€œè¯ä¹¦é¢å‘æœºæ„â€ï¼ˆcertification authorityï¼Œç®€ç§°CAï¼‰ç­¾å‘çš„è¯ä¹¦ã€‚è¯ä¹¦ä¸­å­˜å‚¨äº†ä½¿ç”¨â€œè¯ä¹¦é¢å‘æœºæ„â€çš„ç§é’¥åŠ å¯†ä¹‹åçš„ç”³è¯·è€…çš„å…¬é’¥ä¿¡æ¯ã€‚ 5.2.1 æ•°å­—è¯ä¹¦çš„ç”³è¯·æ•°å­—è¯ä¹¦éœ€è¦å‘â€œè¯ä¹¦é¢å‘æœºæ„â€æäº¤ç”³è¯·ï¼Œå¹¶é€šè¿‡å®¡æ ¸ä¹‹åæ‰èƒ½é¢å‘ã€‚å› ä¸ºæ•°å­—è¯ä¹¦ä¸­å­˜å‚¨çš„æ˜¯ç”³è¯·è€…çš„å…¬é’¥ï¼Œæ‰€ä»¥å¦‚æœç”³è¯·è€…çš„ç§é’¥ä¸¢å¤±æˆ–æ³„æ¼ï¼Œå°±éœ€è¦å‘â€œè¯ä¹¦é¢å‘æœºæ„â€ç”³è¯·æ³¨é”€è¯¥è¯ä¹¦ã€‚ WebæœåŠ¡å™¨å‘CAç”³è¯·è¯ä¹¦çš„æµç¨‹å¤§è‡´å¦‚å›¾ï¼š â€œè¯ä¹¦â€ä¸­ä¸»è¦åŒ…å«äº†ç»è¿‡â€œè¯ä¹¦é¢å‘æœºæ„â€çš„ç§é’¥åŠ å¯†è¿‡åçš„ç”³è¯·è€…çš„â€œå…¬é’¥â€ã€â€œè¯ä¹¦æœ‰æ•ˆæœŸâ€ã€â€œç”³è¯·è€…ä¿¡æ¯ï¼ˆå¦‚åŸŸåç­‰ï¼‰â€ã€‚æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒã€ŠHTTPS æƒå¨æŒ‡å—ã€‹ç¬¬ 3.3.1 ç« èŠ‚ã€‚ 5.2.2 æ•°å­—è¯ä¹¦çš„éªŒè¯ä»¥â€œChrome æµè§ˆå™¨â€ä¸ºä¾‹ï¼šæµè§ˆå™¨ä¼šå†…ç½®å„å¤§è‘—åçš„â€œè¯ä¹¦é¢å‘æœºæ„â€çš„â€œå…¬é’¥â€ï¼Œå½“æ”¶åˆ° Web æœåŠ¡å™¨è¿”å›çš„â€œæœåŠ¡å™¨è¯ä¹¦â€åï¼ŒChrome ä¼šå°è¯•ä½¿ç”¨å†…ç½®çš„è¯¥â€œè¯ä¹¦é¢å‘æœºæ„â€çš„â€œå…¬é’¥â€æ¥è§£å¯†è¯¥è¯ä¹¦ï¼Œå¦‚æœèƒ½è§£å¯†åˆ™è¯´æ˜è¯¥è¯ä¹¦æ˜¯â€œè¯ä¹¦é¢å‘æœºæ„â€é¢å‘çš„ï¼Œä¸”æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡çš„ã€‚ç„¶åé€šè¿‡è§£å¯†æ‰€å¾—çš„â€œåŸŸåâ€ã€â€œè¯ä¹¦æœ‰æ•ˆæœŸâ€æ¥æ ¡éªŒè¯¥è¯ä¹¦æ˜¯å¦ä¸ºè¯¥ç½‘ç«™æ‰€æœ‰ï¼Œæ˜¯å¦è¿‡æœŸç­‰ã€‚ æœ¬æ–‡ä»‹ç»çš„åªæ˜¯â€œæ•°å­—è¯ä¹¦â€ç”³è¯·å’ŒéªŒè¯çš„åŸºæœ¬çš„æµç¨‹ï¼Œå®é™…æµç¨‹æ¯”è¿™ä¸ªå¤æ‚å¾ˆå¤šï¼Œå…³äºâ€œæ•°å­—è¯ä¹¦â€çš„ä¿¡æ¯ä»‹ç»å¯ä»¥å‚è€ƒã€ŠHTTPS æƒå¨æŒ‡å—ã€‹ å…­ã€HTTPSåœ¨ HTTP è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹å‰æ²¡æœ‰è¿›è¡Œèº«ä»½ç¡®è®¤ï¼Œè€Œä¸”ä¼ è¾“çš„æ•°æ®éƒ½æ²¡æœ‰åŠ å¯†å¤„ç†ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«åŠ«æŒå’Œç¯¡æ”¹ã€‚ åŸºäº HTTP åè®®çš„è¿™äº›å¼Šç«¯ï¼Œåé¢å°±å‡ºç°äº†HTTPSï¼ˆä¸¥æ ¼çš„è¯´ï¼ŒHTTPS å¹¶ä¸æ˜¯ä¸€ä¸ªåè®®ï¼Œæ‰€ä»¥å‰é¢æ–‡ç« éƒ½æ²¡æœ‰ä½¿ç”¨â€œHTTPS åè®®â€ï¼‰ï¼ŒHTTPS æ˜¯åŸºäºSSL/TSLåè®®çš„ï¼Œè¯´ç™½äº†å°±æ˜¯HTTP+SSL/TSLï¼Œå¯ä»¥æŠŠ HTTPS å¤§è‡´ç†è§£ä¸ºâ€œHTTP Over SSLâ€æˆ–è€…â€œHTTP Over TSLâ€ã€‚ HTTP, SSL&#x2F;TSL, HTTPS çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š 6.1 SSL&#x2F;TSL åè®®6.1.1 SSLSSLï¼ˆè‹±æ–‡ï¼šSecure Sockets Layerçš„ç¼©å†™ï¼‰ä¸­æ–‡å«â€œå®‰å…¨å¥—æ¥å±‚â€ã€‚æœ€å¼€å§‹ç”± NetScape å…¬å¸ç ”å‘ï¼Œç”¨ä»¥ä¿éšœäº’è”ç½‘ä¸Šæ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼Œåˆ©ç”¨æ•°æ®åŠ å¯†æŠ€æœ¯ç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¸Šä¹‹ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šè¢«æˆªå–åŠçªƒå¬ã€‚SSL åè®®åœ¨ TCP&#x2F;IP åè®®æ ˆä¸­ä½äºä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¹‹é—´ã€‚ä»¥HTTPSä¸ºä¾‹ï¼ŒSSL åè®®å°±ä½äº TCP å’Œ HTTP ä¹‹é—´ï¼š 6.1.2 TLSTLSï¼ˆè‹±æ–‡ï¼šTransport Layer Securityçš„ç¼©å†™ï¼‰ä¸­æ–‡å«â€œä¼ è¾“å±‚å®‰å…¨åè®®â€ï¼ŒTLS 1.0æ˜¯ IETFï¼ˆInternet Engineering Task Forceï¼ŒInternet å·¥ç¨‹ä»»åŠ¡ç»„ï¼‰åˆ¶å®šçš„ä¸€ç§æ–°çš„åè®®ï¼Œå®ƒå»ºç«‹åœ¨SSL 3.0åè®®è§„èŒƒä¹‹ä¸Šï¼Œæ˜¯SSL 3.0çš„åç»­ç‰ˆæœ¬ï¼Œå¯ä»¥ç†è§£ä¸º SSL 3.1ï¼Œå®ƒå®šä¹‰åœ¨RFC5246ä¸­ã€‚ å› ä¸º TLS æ˜¯åŸºäº SSL 3.0 çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸º TLS æ˜¯ SSL çš„åŠ å¼ºç‰ˆã€‚ æˆ‘ä»¬ä¸€èˆ¬å°†äºŒè€…å¹¶ç§°ä¸ºSSL/TSLåè®®ï¼Œå› ä¸ºè¿™äºŒè€…å¯ä»¥è§†ä¸ºåŒä¸€ä¸ªäº§å“çš„ä¸åŒé˜¶æ®µã€‚ 6.2 SSL&#x2F;TSL åè®®çš„æ¡æ‰‹è¿‡ç¨‹ åœ¨äº†è§£ SSL&#x2F;TSL åè®®çš„æ¡æ‰‹è¿‡ç¨‹ä¹‹å‰ï¼Œéœ€è¦å…ˆé˜…è¯»å…³äº HTTPS çš„å‰å‡ ç¯‡æ–‡ç« ï¼Œå¯¹ç›¸å…³é¢„å¤‡çŸ¥è¯†æœ‰æ‰€äº†è§£ã€‚ å‚è€ƒä¸Šé¢çš„æµç¨‹å›¾ï¼Œæ¡æ‰‹è¿‡ç¨‹å¯ä»¥åˆ†ä¸º 4 ä¸ªæ­¥éª¤ï¼š 1). å®¢æˆ·ç«¯å‘é€ Client Hello è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š SSL æˆ– TSL åè®®çš„ç‰ˆæœ¬ å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºä¸²Client randomï¼› å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†ç®—æ³•åˆ—è¡¨ï¼Œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŠ å¯†ç®—æ³•çš„åå•†ï¼› å®¢æˆ·ç«¯æ”¯æŒçš„ HASH ç®—æ³•ï¼› 2). æœåŠ¡ç«¯å‘é€ Sever Hello å“åº”åˆ°å®¢æˆ·ç«¯ï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š æœåŠ¡ç«¯ç”Ÿæˆçš„éšæœºä¸²Server randomï¼ˆç¬¬ 3 æ­¥ä¼šç”¨åˆ°ï¼‰ï¼› ç”±â€œCA è¯ä¹¦æœºæ„â€é¢å‘çš„è¯ä¹¦çš„Public keyéƒ¨åˆ†ï¼ˆPublic keyå’ŒPrivate Keyä¸ºä¸€å¯¹ï¼Œç”¨äºéå¯¹ç§°åŠ å¯†å’Œè§£å¯†ï¼‰ï¼› ä¼šè¯ ID åå•†çš„åŠ å¯†ç®—æ³•ï¼ˆå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼‰å’Œ HASH ç®—æ³•ã€‚ 3). å®¢æˆ·ç«¯å‘é€ Client Key åˆ°æœåŠ¡ç«¯ï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹æˆ–æ­¥éª¤ï¼š æ£€æŸ¥æœåŠ¡ç«¯è¿”å›çš„â€œè¯ä¹¦â€çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœæ— æ•ˆåˆ™åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºè­¦å‘Šã€‚ å®¢æˆ·ç«¯ä½¿ç”¨å‰ 2 æ­¥ç”Ÿæˆçš„Client randomå’ŒServer randomä½œä¸ºéšæœºå› å­ï¼Œç”Ÿæˆå¦å¤–ä¸€ä¸ªéšæœºä¸²Premasterã€‚ ä½¿ç”¨Public keyï¼ˆç¬¬ 2 æ­¥æœåŠ¡ç«¯è¿”å›ï¼‰éå¯¹ç§°åŠ å¯†çš„éšæœºä¸²Premasterã€‚ 4). æœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯æ¡æ‰‹ç»“æŸï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š é€šè¿‡è§£å¯†å‡ºæ¥çš„Premasterç”Ÿæˆçš„æœ¬æ¬¡ä¼šè¯çš„Session keyã€‚ å‰é¢æ‰€æœ‰æ¡æ‰‹å†…å®¹çš„ HASH å€¼ï¼Œä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚ å‚è€ƒï¼šhttp://www.ruanyifeng.com/blog/2014/02/ssl_tls.html &gt; http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["æ•°å­—è¯ä¹¦","HTTP","HTTPS","TSL"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ç½‘ç»œåè®®(6)--TCPåè®®","path":"/post/1504706832.html","content":"ä¸€ã€TCP ç‰¹æ€§å°½ç®¡ TCP å’Œ UDP éƒ½æ˜¯ç”¨ IP åè®®ä½œä¸ºç½‘ç»œå±‚ï¼Œä½† TCP å´æä¾›å’Œ UDP å®Œå…¨ä¸åŒçš„ç½‘ç»œæœåŠ¡ã€‚TCP æ˜¯é¢å‘è¿æ¥çš„ã€ç¨³å®šå¯é çš„å­—èŠ‚æµæœåŠ¡ã€‚TCP é¦–éƒ¨çš„å¾ˆå¤šå­—æ®µéƒ½æ˜¯ä¸ºäº†å®ç°è¿™ 2 å¤§ç‰¹æ€§è€Œè®¾è®¡çš„ã€‚ åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­ï¼Œä»…æœ‰ä¸¤æ–¹èƒ½è¿›è¡Œå½¼æ­¤é€šä¿¡ã€‚æ‰€ä»¥è¯´å¹¿æ’­å’Œå¤šæ’­ä¸é€‚ç”¨äº TCP åè®®ã€‚ ä¸ºäº†é€šè¿‡ IP æ•°æ®æŠ¥å®ç°å¯é æ€§ä¼ è¾“ï¼Œéœ€è¦è€ƒè™‘å¾ˆå¤šäº‹æƒ…ï¼Œå¦‚æ•°æ®çš„ç ´åã€ä¸¢åŒ…ã€é‡å¤ä»¥åŠåˆ†ç‰‡é¡ºåºæ··ä¹±ç­‰é—®é¢˜ã€‚TCP é€šè¿‡æ£€éªŒå’Œã€åºåˆ—å·ã€ç¡®è®¤åºåˆ—å·ã€é‡å‘æ§åˆ¶ã€è¿æ¥ç®¡ç†ä»¥åŠçª—å£æ§åˆ¶ç­‰æœºåˆ¶æ¥å®ç°å¯é æ€§ä¼ è¾“ã€‚ äºŒã€TCP åè®®é¦–éƒ¨æ‘˜è‡ªã€ŠTCP&#x2F;IP è¯¦è§£å· 1ã€‹ä¸­çš„å…³äº TCP é¦–éƒ¨å®šä¹‰çš„å›¾ï¼š TCP åè®®çš„å®ç°è¾ƒ UDP åè®®å¤æ‚å¤ªå¤šï¼Œå®ƒçš„é¦–éƒ¨çš„å„ä¸ªå­—æ®µçš„ç”¨æ³•ä¹Ÿæ¯” UDP é¦–éƒ¨å­—æ®µå¤æ‚å¤šï¼Œè¿™é‡Œå…ˆå¯¹ TCP é¦–éƒ¨å­—æ®µçš„åŠŸèƒ½åšä¸ªå¤§æ¦‚çš„ä»‹ç»ã€‚ 16 ä½æºç«¯å£å·ï¼šè¡¨ç¤ºå‘é€ç«¯ç«¯å£å·ã€‚ä¼ è¾“å±‚ä½¿ç”¨ç«¯å£å·æ¥æ ‡è¯†å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„åº”ç”¨ç¨‹åºï¼Œè€Œç½‘ç»œå±‚æ˜¯é€šè¿‡ IP åœ°å€æ¥æ ‡è¯†ä¸»æœºï¼Œè¿™æ ·ä½¿ç”¨â€œIP åœ°å€+ç«¯å£â€å°±å¯ä»¥ç²¾ç¡®å®šä½åˆ°æŸä¸€å°ä¸»æœºä¸Šçš„æŸä¸€åº”ç”¨ç¨‹åºã€‚ 16 ä½ç›®çš„ç«¯å£å·ï¼šè¡¨ç¤ºæ¥æ”¶ç«¯ç«¯å£å·ã€‚ 32 ä½åºåˆ—å·ï¼šåºåˆ—å·ç”¨æ¥æ ‡è¯†ä» TCP å‘é€ç«¯å·²ç»å‘é€çš„å­—èŠ‚æ•°ã€‚è¾¾åˆ°æœ€å¤§å€¼$2^{32}-1$ä¹‹åï¼Œå†ä» 0 å¼€å§‹ã€‚ 32 ä½ç¡®è®¤åºåˆ—å·ï¼šç¡®è®¤åºåˆ—å·ç”¨æ¥æ ‡è¯† TCP æ¥æ”¶ç«¯æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ï¼ˆåè¿‡æ¥æƒ³ä¹Ÿå°±æ˜¯ï¼ŒTCP æ¥æ”¶ç«¯å·²ç»æ¥å—åˆ°çš„å­—èŠ‚æ•°ä¸ºç¡®è®¤åºåˆ—å·å‡å»1ï¼‰ã€‚åªæœ‰ACKæ ‡å¿—ä½ä¸º 1 æ—¶ï¼Œè¯¥å­—æ®µæ‰æœ‰æ•ˆã€‚åªè¦ TCP è¿æ¥å»ºç«‹ï¼Œè¿™ä¸ªå­—æ®µä¼šä¸€ç›´èµ·ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ TCP è¿æ¥å»ºç«‹ï¼ŒACKæ ‡å¿—ä½ä¼šä¸€ç›´ä¸º 1ã€‚ 4 ä½é¦–éƒ¨é•¿åº¦ï¼šå’Œ IP é¦–éƒ¨ä¸€æ ·ï¼Œæ˜¯ä»¥4ä¸ªå­—èŠ‚(32 bit)ä¸ºå•ä½çš„ï¼Œæ‰€ä»¥ TCP é¦–éƒ¨æœ€å¤§é•¿åº¦ä¹Ÿæ˜¯15*4=60å­—èŠ‚ã€‚è‹¥æ²¡æœ‰â€œé€‰é¡¹â€å­—æ®µï¼Œé•¿åº¦å›ºå®šä¸º 20 å­—èŠ‚ã€‚ 6 ä½æ ‡å¿—ä½ï¼šä»–ä»¬ä¸­çš„å¤šä¸ªå¯ä»¥åŒæ—¶è¢«è®¾ç½®ä¸º 1ã€‚ 123456URG æ ‡è®°åé¢çš„&quot;16ä½ç´§æ€¥æŒ‡é’ˆ&quot;æ˜¯å¦æœ‰æ•ˆã€‚ACK æ ‡è®°å‰é¢çš„&quot;32ä½ç¡®è®¤åºå·&quot;æ˜¯å¦æœ‰æ•ˆã€‚PSH æ¥æ”¶æ–¹åº”è¯¥å°½å¿«çš„å°†è¿™ä¸ªæŠ¥æ–‡äº¤ç»™ä¸Šå±‚çš„ç½‘ç»œå±‚ã€‚RST é‡å»ºè¿æ¥ã€‚SYN æ ‡è®°è¿™ä¸ªTCPæ®µæ˜¯ç”¨æ¥åŒæ­¥åˆå§‹åºå·ï¼ˆISNï¼‰çš„ã€‚FIN æ ‡è®°å‘é€ç«¯å·²ç»å®Œæˆäº†å‘é€ä»»åŠ¡ã€‚ 16 ä½çª—å£å¤§å°ï¼šçª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œç”¨äº TCP çš„æµé‡æ§åˆ¶ï¼Œè¿™ä¸ªå€¼æ˜¯æ¥æ”¶ç«¯æœŸæœ›æ¥å—çš„å­—èŠ‚æ•°ã€‚ 16 ä½æ ¡éªŒå’Œï¼šå’Œ UDP ç±»ä¼¼ï¼Œæ ¡éªŒå’Œè¦†ç›–é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ã€‚ 16 ä½ç´§æ€¥æŒ‡é’ˆï¼šåªæœ‰å‰é¢æåˆ°çš„URGæ ‡è®°ä½ä¸º 1 æ—¶ï¼Œè¿™ä¸ªå­—æ®µæ‰æœ‰æ•ˆã€‚ é€‰é¡¹ï¼šæ·»åŠ ä¸€äº›é™„åŠ æ•°æ®ã€‚å’Œ UDP ä¸åŒï¼ŒTCP çš„â€œé€‰é¡¹â€å­—æ®µä½¿ç”¨çš„æ¯”è¾ƒå¤šã€‚ ä¸‰ã€ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹3.1 å®Œæ•´çš„ TCP ä¼šè¯æµç¨‹å›¾æœ¬æ–‡é€šè¿‡çœŸå®çš„ç½‘ç»œç¤ºä¾‹æ¥è®²è§£ TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‚è¯»è€…å¯ä»¥å…ˆä¸‹è½½ä½œè€…å†™æœ¬æ–‡æ—¶ä½¿ç”¨çš„ç½‘ç»œåŒ…ç¤ºä¾‹ï¼Œç„¶åä½¿ç”¨ wireshark æ‰“å¼€ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ wireshark éšä¾¿æŠ“å–ä¸€ä¸ªç½‘ç»œåŒ…ï¼‰ï¼Œé€‰ä¸­ç¼–å·ä¸ºNo.9çš„åŒ…ï¼Œå³é”®é€‰æ‹©â€œè¿½è¸ªæµâ€ â€“&gt; â€œTCP æµâ€ï¼š ä¸Šå›¾æ˜¯ä½¿ç”¨ wireshark æŠ“å–çš„ä¸€ä¸ª Http æ¥å£è¯·æ±‚çš„è¿‡ç¨‹ï¼ˆä¸å« DNS è§£æç­‰æ­¥éª¤ï¼‰ï¼ŒåŒ…å«äº† TCP è¿æ¥å»ºç«‹ã€Http è¯·æ±‚ã€Http å“åº”ã€TCP è¿æ¥æ–­å¼€ã€‚ç°åœ¨ä»¥è¿™ä¸ªç¤ºä¾‹ä¸ºåŸºç¡€ï¼Œæ¥ç”»å‡ºè¯¥ Http æ¥å£è¯·æ±‚ä¸­æ¶‰åŠçš„æ•´ä¸ª TCP ä¼šè¯çš„æµç¨‹ï¼ˆä¹Ÿæ˜¯æœ¬æ–‡æœ€é‡è¦çš„å›¾ï¼‰ï¼š ç®­å¤´ä¸Šæ–¹æ ‡å‡ºäº†è¯¥ TCP åŒ…SYNã€ACKã€FINã€PSHç­‰æ ‡å¿—ä½çš„è®¾ç½®æƒ…å†µï¼ˆå¤§å®¶å¯èƒ½æ³¨æ„åˆ°ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªç®­å¤´ä¸Šæ²¡æœ‰ACKä¹‹å¤–ï¼Œå…¶ä»–çš„ç®­å¤´ä¸Šéƒ½æœ‰ACKï¼Œè¿™æ˜¯å› ä¸ºACKæ ‡è®°ä½åªæ˜¯ç”¨äºæ ‡è®° TCP é¦–éƒ¨çš„32ä½ç¡®è®¤åºåˆ—å·æ˜¯å¦æœ‰æ•ˆã€‚åœ¨æ­¤ä¹‹åçš„32ä½ç¡®è®¤åºåˆ—å·ä¸€ç›´æœ‰æ•ˆï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸€ç›´æœ‰ACKæ ‡è®°ä½ã€‚ï¼‰ï¼›ç®­å¤´ä¸‹å‘æ ‡å‡ºäº†è¯¥ TCP åŒ…çš„åºå·å’Œç¡®è®¤åºå·ã€‚ seq_numï¼šè¡¨ç¤º 32 ä½çš„åºå·ï¼Œç´§è·Ÿå…¶åæ‹¬å·[]ä¸­çš„æ˜¯ç›¸å¯¹åºå·ã€‚ ack_numï¼šè¡¨ç¤º 32 ä½çš„ç¡®è®¤åºå·ï¼Œç´§è·Ÿå…¶åæ‹¬å·[]ä¸­çš„æ˜¯ç›¸å¯¹ç¡®è®¤åºå·ã€‚ payload_lenï¼šè¡¨ç¤ºæœ¬æ¬¡ TCP æºå¸¦çš„æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚ åœ¨ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„éƒ¨åˆ†ï¼Œæ—è¾¹çš„çº¢è‰²ç²—ä½“å­—è¡¨ç¤ºå½“å‰ç«¯çš„ TCP çŠ¶æ€ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æ˜¯æœåŠ¡ç«¯æ‰§è¡Œä¸»åŠ¨å…³é—­ã€‚ 3.2 Wireshark çš„ç›¸å¯¹åºå·ç›¸å¯¹åºå·æ˜¯ Wireshark å¼•å‡ºçš„æ¦‚å¿µï¼ŒTCP åè®®ä¸­æ²¡æœ‰è¿™ä¸ªæ¦‚å¿µã€‚Wireshark ä½¿ç”¨ç›¸å¯¹æ•°å€¼æ¥æ˜¾ç¤ºåºå·å’Œç¡®è®¤åºå·ï¼Œè¿™ä¸ªç›¸å¯¹å€¼æ˜¯ç›¸å¯¹äºåˆå§‹åºå·ï¼ˆISNï¼‰è€Œè¨€çš„ã€‚å› ä¸ºäººç±»æ›´åŠ ä¹ æƒ¯è·Ÿè¸ªæ›´å°æ•°å€¼ï¼Œæ‰€ä»¥ Wireshark é»˜è®¤ç”¨ç›¸å¯¹æ•°å€¼æ¥å±•ç¤ºã€‚å¦‚æœéœ€è¦æŸ¥çœ‹çœŸå®çš„åºå·ï¼Œå¯ä»¥åœ¨ wireshark ä¸­é€‰ä¸­è¯¥ç½‘ç»œåŒ…ï¼Œåœ¨æœ€ä¸‹æ–¹çš„æ•°æ®çª—å£æŸ¥çœ‹ï¼Œå¦‚ï¼š 3.3 Wireshark çš„ TCP æµé‡å›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Wireshark è‡ªå¸¦çš„ç»Ÿè®¡åŠŸèƒ½æ¥æŸ¥çœ‹æ•´ä¸ª TCP ä¼šè¯çš„è¿‡ç¨‹ã€‚é€šè¿‡èœå•â€œç»Ÿè®¡â€ â€“&gt; â€œæµé‡å›¾â€æ‰“å¼€æµé‡å›¾çª—å£ï¼Œåœ¨â€œæ˜¾ç¤ºâ€é€‰é¡¹é€‰æ‹©â€œæ˜¾ç¤ºçš„åˆ†ç»„â€ï¼Œâ€œæµç±»å‹â€é€‰é¡¹é€‰æ‹©â€œTCP æµâ€ï¼Œå¦‚å›¾ï¼š å››ã€TIME_WAIT åŠ MSL4.1 TIME_WAIT çŠ¶æ€ä¸ºä½•å­˜åœ¨ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨â€œå®¢æˆ·ç«¯â€ã€â€œæœåŠ¡ç«¯â€æ¥è¡¨ç¤º TCP è¿æ¥çš„ 2 ç«¯ï¼Œè½¬è€Œä½¿ç”¨â€œä¸»åŠ¨æ–­å¼€è¿æ¥ç«¯â€ã€â€œè¢«åŠ¨æ–­å¼€è¿æ¥ç«¯â€æ¥è¡¨ç¤º TCP é€šè®¯çš„ 2 ç«¯ã€‚å› ä¸ºæ‰§è¡Œä¸»åŠ¨æ–­å¼€è¿æ¥çš„ç«¯å¯èƒ½æ˜¯æœåŠ¡ç«¯ä¹Ÿå¯èƒ½æ˜¯å®¢æˆ·ç«¯ï¼ˆè™½ç„¶æˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹é‡åˆ°çš„æ˜¯å®¢æˆ·ç«¯æ‰§è¡Œä¸»åŠ¨æ–­å¼€ï¼‰ã€‚ åœ¨â€œä¸»åŠ¨æ–­å¼€è¿æ¥ç«¯â€æ”¶åˆ°äº†â€œè¢«åŠ¨æ–­å¼€è¿æ¥ç«¯â€å‘æ¥çš„LAST_ACKä¹‹åï¼Œä¼šç»™â€œè¢«åŠ¨æ–­å¼€è¿æ¥ç«¯â€å›å¤ä¸€ä¸ªACKç¡®è®¤æ¶ˆæ¯ã€‚ä½†è¿™ä¸ªæ—¶å€™ä¸ºäº†ç¡®ä¿â€œè¢«åŠ¨æ–­å¼€è¿æ¥ç«¯â€æœ‰è¶³å¤Ÿçš„æ—¶é—´èƒ½å¤Ÿæ”¶åˆ°è¯¥æ¶ˆæ¯ï¼Œâ€œä¸»åŠ¨æ–­å¼€è¿æ¥ç«¯â€ä¸èƒ½é©¬ä¸Šå…³é—­ socketï¼Œéœ€è¦ç­‰å¾…ä¸€å®šçš„æ—¶é—´æ¥ç¡®ä¿â€œè¢«åŠ¨æ–­å¼€è¿æ¥ç«¯â€å¯ä»¥æ”¶åˆ°ACKç¡®è®¤æ¶ˆæ¯ã€‚â€œä¸»åŠ¨æ–­å¼€è¿æ¥ç«¯â€åœ¨ç­‰å¾…çš„è¿™ä¸ªæ—¶é—´æ®µå†…çš„çŠ¶æ€æˆ‘ä»¬ç§°ä¹‹ä¸ºTIME_WAITçŠ¶æ€ã€‚ å½’çº³ä¸ºä¸€å¥è¯å°±æ˜¯ï¼šTIME_WAIT çŠ¶æ€å°±æ˜¯â€œä¸»åŠ¨æ–­å¼€çš„ä¸€æ–¹â€åœ¨å‘é€å®Œæœ€åä¸€æ¬¡ ACK åè¿›å…¥çš„ç­‰å¾…çŠ¶æ€ã€‚ 4.2 ç­‰å¾…æ—¶é—´é‚£ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦æŒç»­å¤šä¹…äº†ï¼Œä¹Ÿå°±æ˜¯â€œä¸»åŠ¨æ–­å¼€è¿æ¥ç«¯â€åœ¨å‘é€å®Œæœ€åä¸€ä¸ª ACK ä¹‹åéœ€è¦ç­‰å¾…å¤šä¹…äº†ï¼Ÿã€ŠTCP&#x2F;IP è¯¦è§£ å· 1ï¼šåè®®ã€‹ä¸­æåˆ°ï¼šé»˜è®¤ TIME_WAIT çš„è¶…æ—¶æ—¶é—´æ˜¯ 2 å€çš„ MSLã€‚MSL æ˜¯Maximum Segment Lifetimeçš„ç¼©å†™ï¼Œè¡¨ç¤ºæŠ¥æ–‡çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å’Œç³»ç»Ÿçš„ TCP å®ç°æœ‰å…³ï¼Œæ¯ä¸ªç³»ç»Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ 4.2.1 windows ç³»ç»Ÿ MSLæ³¨å†Œè¡¨HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parametersä¸‹çš„TcpTimedWaitDelayé”®ï¼ˆå¦‚æœæ²¡æœ‰å¯ä»¥æ–°å»ºä¸€ä¸ªï¼‰å°±å¯¹åº”äº†2*MSLï¼ˆ2 å€çš„ MSLï¼‰çš„å€¼ã€‚ 4.2.2 Linux ç³»ç»Ÿ MSLä»¥ CentOS ä¸ºä¾‹ï¼ˆæ‘˜è‡ªç½‘ç»œï¼Œä»…ä¾›å‚è€ƒï¼‰ï¼š æŸ¥çœ‹é»˜è®¤çš„ MSL å€¼ï¼ˆ60sï¼‰ï¼š 1cat /proc/sys/net/ipv4/tcp_fin_timeout ä¿®æ”¹é»˜è®¤ä¸º 120ï¼š 1echo 120 &gt; /proc/sys/net/ipv4/tcp_fin_timeout ä¿®æ”¹å®Œæˆåï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š 1sysctl -p /etc/sysctl.conf æŸ¥çœ‹æ˜¯å¦å·²ç»ç”Ÿæ•ˆï¼š 1sysctl -a | grep fin 4.3 SO_REUSEADDR å¦‚æœè¿›ç¨‹ä¸­çš„æŸä¸ª TCP è¿æ¥å¤„äºTIME_WAITç­‰å¾…çŠ¶æ€ï¼Œå› ä¸ºè¿™ä¸ªç­‰å¾…æ—¶é—´æ¯”è¾ƒé•¿ï¼Œåœ¨è¿™æœŸé—´è¯¥è¿æ¥ä½¿ç”¨çš„ç«¯å£å°†ä¸€ç›´è¢«å ç”¨ã€‚ å¦‚æœä¸€ä¸ªæœåŠ¡ç«¯è¿›ç¨‹ï¼ˆç»‘å®šäº†æŸä¸ªç«¯å£ï¼‰é€€å‡ºï¼ˆæ­£å¸¸é€€å‡ºæˆ–å¼‚å¸¸é€€å‡ºï¼‰åï¼Œç«‹å³å¯åŠ¨ä¸€ä¸ªæ–°çš„è¯¥è¿›ç¨‹ï¼Œå¯èƒ½ç”±äº Windows ç³»ç»Ÿå¯¹ç«¯å£çš„é‡Šæ”¾ä¸åŠæ—¶ï¼Œå¯¼è‡´è¿™ä¸ªç«¯å£è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œä¸èƒ½è¢«å†æ¬¡ç»‘å®šï¼Œä»è€Œå¯¼è‡´æ–°è¿›ç¨‹ç»‘å®šç«¯å£å¤±è´¥ã€‚ é‚£ä¹ˆé‡åˆ°ä¸Šé¢çš„é—®é¢˜å¦‚ä½•è§£å†³äº†ï¼Ÿæˆ‘ä»¬åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ç»å¸¸è®¾ç½®çš„SO_REUSEADDRé€‰é¡¹å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ 12int flag = 1;setsockopt(socket, SOL_SOCKET, SO_REUSEADDR, reinterpret_cast&lt;const char*&gt;(&amp;flag), sizeof(flag)); SO_REUSEADDRæä¾›å¦‚ä¸‹å››ä¸ªåŠŸèƒ½ï¼š SO_REUSEADDR å…è®¸å¯åŠ¨ä¸€ä¸ªç›‘å¬æœåŠ¡å™¨å¹¶æ†ç»‘å…¶ä¼—æ‰€å‘¨çŸ¥ç«¯å£ï¼Œå³ä½¿ä»¥å‰å»ºç«‹çš„å°†æ­¤ç«¯å£ç”¨åšä»–ä»¬çš„æœ¬åœ°ç«¯å£çš„è¿æ¥ä»å­˜åœ¨ã€‚è¿™é€šå¸¸æ˜¯é‡å¯ç›‘å¬æœåŠ¡å™¨æ—¶å‡ºç°ï¼Œè‹¥ä¸è®¾ç½®æ­¤é€‰é¡¹ï¼Œåˆ™bindæ—¶å°†å‡ºé”™ã€‚ SO_REUSEADDR å…è®¸åœ¨åŒä¸€ç«¯å£ä¸Šå¯åŠ¨åŒä¸€æœåŠ¡å™¨çš„å¤šä¸ªå®ä¾‹ï¼Œåªè¦æ¯ä¸ªå®ä¾‹æ†ç»‘ä¸€ä¸ªä¸åŒçš„æœ¬åœ° IP åœ°å€å³å¯ã€‚ç”±äºè®¾ç½®è¯¥Socketé€‰é¡¹ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šæƒé™ï¼Œæ¶æ„ç¨‹åºå¯ä»¥è½»æ˜“ä½¿ç”¨SO_REUSEADDRå¼ºåˆ¶ç»‘å®šå·²ç”¨äºæ ‡å‡†ç½‘ç»œåè®®æœåŠ¡çš„å¥—æ¥å­—ï¼Œä»è€Œä½¿è¿™äº›æœåŠ¡æ‹’ç»è®¿é—®ã€‚ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨SO_EXCLUSIVEADDRUSEé€‰é¡¹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ SO_REUSEADDR å…è®¸å•ä¸ªè¿›ç¨‹æ†ç»‘åŒä¸€ç«¯å£åˆ°å¤šä¸ªå¥—æ¥å£ä¸Šï¼Œåªè¦æ¯ä¸ªæ†ç»‘æŒ‡å®šä¸åŒçš„æœ¬åœ° IP åœ°å€å³å¯ã€‚è¿™ä¸€èˆ¬ä¸ç”¨äº TCP æœåŠ¡å™¨ã€‚ SO_REUSEADDR å…è®¸å®Œå…¨é‡å¤çš„æ†ç»‘ï¼šå½“ä¸€ä¸ª IP åœ°å€å’Œç«¯å£ç»‘å®šåˆ°æŸä¸ªå¥—æ¥å£ä¸Šæ—¶ï¼Œè¿˜å…è®¸æ­¤ IP åœ°å€å’Œç«¯å£æ†ç»‘åˆ°å¦ä¸€ä¸ªå¥—æ¥å£ä¸Šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªç‰¹æ€§ä»…åœ¨æ”¯æŒå¤šæ’­çš„ç³»ç»Ÿä¸Šæ‰æœ‰ï¼Œè€Œä¸”åªå¯¹ UDP å¥—æ¥å£è€Œè¨€ï¼ˆTCP ä¸æ”¯æŒå¤šæ’­ï¼‰ã€‚ å…¶ä¸­ç¬¬ä¸€ä¸ªåŠŸèƒ½å°±å¯ä»¥ç”¨æ¥è§£å†³è¯¥é—®é¢˜ã€‚ å…³äºSO_REUSEADDRæ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥è®¿é—®å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£ï¼šusing-so-reuseaddr-and-so-exclusiveaddruse äº”ã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œ 3 æ¬¡æ¡æ‰‹ï¼Ÿå‰é¢çš„æ–‡ç« ä»‹ç»äº† TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆ TCP çš„æ¡æ‰‹ä¸ºä»€ä¹ˆæ˜¯ 3 æ¬¡äº†ï¼Ÿ æœ¬æ–‡ä» 3 ä¸ªè§’åº¦æ¥è§£é‡Šä¸ºä»€ä¹ˆè¦è¿›è¡Œ 3 æ¬¡æ¡æ‰‹ï¼Ÿ 1TCP çš„æ¡æ‰‹çš„ç›®çš„æ˜¯è®©é€šä¿¡åŒæ–¹éƒ½ç¡®å®šåŒæ–¹èƒ½å¤Ÿæ­£å¸¸å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚ ç¬¬ä¸€æ­¥ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ SYNï¼ŒæœåŠ¡ç«¯èƒ½å¤Ÿç¡®å®šå¦‚ä¸‹ä¿¡æ¯ï¼šâ€œå®¢æˆ·ç«¯çš„å‘é€åŠŸèƒ½æ­£å¸¸ï¼ŒæœåŠ¡ç«¯è‡ªå·±çš„æ¥å—åŠŸèƒ½æ­£å¸¸â€ã€‚ä½†å®¢æˆ·ç«¯è¿˜ä»€ä¹ˆéƒ½ä¸èƒ½ç¡®å®šã€‚ç¬¬äºŒæ­¥ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å›å¤çš„ SYN+ACKï¼Œæˆªè‡³ç›®å‰ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿç¡®å®šå¦‚ä¸‹ä¿¡æ¯ï¼šâ€œå®¢æˆ·ç«¯è‡ªå·±çš„å‘é€&#x2F;æ¥æ”¶åŠŸèƒ½éƒ½æ­£å¸¸ï¼ŒæœåŠ¡ç«¯çš„æ¥æ”¶å’Œå‘é€åŠŸèƒ½éƒ½æ­£å¸¸â€ï¼›æœåŠ¡ç«¯è¿˜æ˜¯åªèƒ½ç¡®å®šè‡ªå·±çš„æ¥å—åŠŸèƒ½æ­£å¸¸ï¼Œè¿˜ä¸çŸ¥é“è‡ªå·±çš„å‘é€åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œå®¢æˆ·ç«¯çš„æ¥å—åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚ å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œåˆ°ç¬¬äºŒæ­¥å®Œæˆï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èƒ½å¤Ÿç¡®è®¤çš„ä¿¡æ¯åˆ†åˆ«å¦‚ä¸‹ï¼š 1234567891011å®¢æˆ·ç«¯èƒ½å¤Ÿç¡®å®šï¼š å®¢æˆ·ç«¯-å‘é€ æ­£å¸¸ å®¢æˆ·ç«¯-æ¥æ”¶ æ­£å¸¸ æœåŠ¡ç«¯-å‘é€ æ­£å¸¸ æœåŠ¡ç«¯-æ¥æ”¶ æ­£å¸¸æœåŠ¡ç«¯èƒ½å¤Ÿç¡®å®šï¼š å®¢æˆ·ç«¯-å‘é€ æ­£å¸¸ å®¢æˆ·ç«¯-æ¥æ”¶ ï¼Ÿ æœåŠ¡ç«¯-å‘é€ ï¼Ÿ æœåŠ¡ç«¯-æ¥æ”¶ æ­£å¸¸ ä»ä¸Šé¢è¡¨å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ­¥å®Œæˆä¹‹åï¼ŒæœåŠ¡ç«¯è¿˜èƒ½ä¸èƒ½ç¡®å®šâ€œæœåŠ¡ç«¯çš„å‘é€åŠŸèƒ½â€å’Œâ€œå®¢æˆ·ç«¯çš„æ¥æ”¶åŠŸèƒ½â€æ˜¯å¦æ­£å¸¸ã€‚æ‰€ä»¥éœ€è¦ç¬¬ä¸‰æ­¥ã€‚ ç¬¬ä¸‰æ­¥ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å›å¤çš„ ACKï¼ŒæœåŠ¡ç«¯èƒ½å¤Ÿç¡®å®šå¦‚ä¸‹ä¿¡æ¯ï¼šå®¢æˆ·ç«¯çš„å‘é€åŠŸèƒ½æ­£å¸¸ï¼ŒæœåŠ¡ç«¯çš„æ¥æ”¶åŠŸèƒ½æ­£å¸¸ã€‚ 2æˆ‘ä»¬å¯ä»¥å‡è®¾â€œå®¢æˆ·ç«¯â€å’Œâ€œæœåŠ¡ç«¯â€æ˜¯ 2 ä¸ªäººï¼Œæ¨¡æ‹Ÿè¿™ 2 ä¸ªäººæ‰“æ‹›å‘¼çš„å½¢å¼æ¥ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ 3 æ¬¡æ¡æ‰‹ã€‚ 123å®¢æˆ·ç«¯ï¼šhiï¼ŒæœåŠ¡ç«¯ï¼Œä½ èƒ½å¬åˆ°æˆ‘è¯´è¯å—ï¼ŸæœåŠ¡ç«¯ï¼šhiï¼Œå®¢æˆ·ç«¯ï¼Œæˆ‘èƒ½å¬åˆ°ä½ è¯´çš„è¯ï¼Œä½ èƒ½å¬åˆ°æˆ‘è¯´çš„è¯å—ï¼Ÿå®¢æˆ·ç«¯ï¼šå—¯ï¼ŒæœåŠ¡ç«¯ï¼Œæˆ‘ä¹Ÿèƒ½å¬åˆ°ä½ è¯´çš„è¯ã€‚ 3å¯¹ç…§æ–‡ç« å¼€å§‹å¤„ TCP æ¡æ‰‹å›¾çš„å‰ 2 æ­¥ï¼Œç°åœ¨æˆ‘ä»¬å‡è®¾ TCP åªæœ‰ 2 æ¬¡æ¡æ‰‹ï¼š æœåŠ¡ç«¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNå¹¶ä¸”å›å¤SYN+AKCä¹‹åï¼Œå°±è®¤ä¸ºè¿æ¥å·²ç»å»ºç«‹å®Œæˆäº†ï¼Œå¹¶ä¸ºä¹‹åˆ†é…ç›¸åº”çš„èµ„æºã€‚ä½†å®¢æˆ·æœºå´å› ä¸ºç½‘ç»œå»¶è¿Ÿç­‰é—®é¢˜ä¸€ç›´æ²¡æ”¶åˆ°æœåŠ¡ç«¯å›å¤çš„SYN+ACKï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±è®¤ä¸ºè¿æ¥æ²¡æœ‰å»ºç«‹æˆåŠŸï¼Œç³Ÿç³•çš„æ˜¯ï¼Œå®¢æˆ·ç«¯ä¼šå› ä¸ºè¿æ¥æ²¡æœ‰æˆåŠŸè€Œä¸åœçš„é‡è¯•ï¼Œè¿™æ ·æ¯æ¬¡æœåŠ¡ç«¯éƒ½ä¼šè®¤ä¸ºè¿æ¥å»ºç«‹æˆåŠŸå¹¶åˆ†é…èµ„æºã€‚ å¦‚æœæŒ‰ç…§ä¸Šé¢æè¿°çš„é‚£æ ·ï¼Œå®¢æˆ·ç«¯ä¸€ç›´æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯å›å¤çš„SYN+ACKï¼Œä¸”ä¸€ç›´è¿™æ ·å°è¯•å»ºç«‹è¿æ¥ï¼Œå°±ä¼šé€ æˆæœåŠ¡ç«¯èµ„æºæå¤§çš„æµªè´¹ï¼ŒåŠ é‡æœåŠ¡ç«¯çš„è´Ÿæ‹…ã€‚ å…­ã€ä¸ºä»€ä¹ˆè¦è¿›è¡Œ 4 æ¬¡æŒ¥æ‰‹ï¼Ÿ å¯¹æ¯”ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼š4 æ¬¡æŒ¥æ‰‹ç›¸æ¯” 3 æ¬¡æ¡æ‰‹å¤šäº†ä¸€æ¬¡ï¼Œä¸»è¦æ˜¯å› ä¸ºæ¡æ‰‹çš„ACKå’ŒSYNæ˜¯åˆå¹¶åœ¨ä¸€æ¡å‘é€çš„ï¼Œè€ŒæŒ¥æ‰‹çš„ACKå’ŒFINæ˜¯åˆ†å¼€å‘é€çš„ï¼Œæ‰€ä»¥æŒ¥æ‰‹æ¯”æ¡æ‰‹å¤šäº†ä¸€æ¬¡ã€‚ ç°åœ¨æˆ‘ä»¬åˆ†æä¸ºä»€ä¹ˆ TCP æŒ¥æ‰‹çš„ACKå’ŒFINï¼ˆåˆ†åˆ«å¯¹åº”å›¾ä¸­çš„ç¬¬ 2,3 æ¡çº¿ï¼‰è¦åˆ†å¼€å‘é€ï¼Ÿ â€œè¢«åŠ¨æ–­å¼€æ–¹â€ä¹‹æ‰€ä»¥å«ç§°ä¹‹ä¸ºâ€œè¢«åŠ¨â€æ˜¯å› ä¸º TCP è¿æ¥çš„æ–­å¼€å¹¶ä¸æ˜¯å®ƒæƒ³çš„ï¼Œä¹Ÿä¸æ˜¯å®ƒä¸»åŠ¨è§¦å‘çš„ï¼Œæ˜¯å¯¹é¢çš„â€œä¸»åŠ¨æ–­å¼€æ–¹â€æƒ³è¦æ–­å¼€çš„ï¼Œä¹Ÿè®¸è¿™ä¸ªæ—¶å€™â€œè¢«åŠ¨æ–­å¼€æ–¹â€è¿˜æ­£æƒ³å‘é€ç‚¹æ•°æ®ç»™â€œä¸»åŠ¨æ–­å¼€æ–¹â€äº†ã€‚ ä¸ºäº†è®©â€œè¢«åŠ¨æ–­å¼€æ–¹â€æœ‰æœºä¼šå°†æƒ³è¦å‘é€çš„æ•°æ®å‘é€å®Œï¼Œä¸»åŠ¨æ–­å¼€æ–¹åœ¨å‘é€å®ŒFINå¹¶æ”¶åˆ°äº†ACKç¡®è®¤ä¿¡æ¯è¿›å…¥FIN_WAIT_2çŠ¶æ€åï¼Œåªå…³é—­äº†å‘é€åŠŸèƒ½äº†ï¼Œä½†ä»ç„¶ä¿ç•™æ¥æ”¶åŠŸèƒ½ã€‚è¿™æ ·â€œè¢«åŠ¨æ–­å¼€æ–¹â€å°±æœ‰æœºä¼šå°†æ²¡æœ‰å‘é€å®Œçš„æ•°æ®å‘é€å®Œæˆï¼Œå‘é€å®Œæˆä¹‹åï¼Œâ€œè¢«åŠ¨æ–­å¼€æ–¹â€ä¹Ÿå‘é€ä¸€ä¸ªFINï¼Œç›¸å½“äºå‘Šè¯‰â€œä¸»åŠ¨æ–­å¼€æ–¹â€ï¼šâ€œæˆ‘çš„æ•°æ®å·²ç»å‘å®Œäº†å‘€ï¼Œä»¥åä¸ä¼šå†å‘æ•°æ®äº†ï¼Œä½ å¯ä»¥å®‰å¿ƒçš„æŠŠæ¥æ”¶åŠŸèƒ½å…³é—­äº†ï¼Œå¦å¤–æˆ‘è‡ªå·±ä¹Ÿè¦å…³é—­äº†å‘€â€ã€‚ ã€ŠTCP&#x2F;IP è¯¦è§£ å· 1ï¼šåè®®ã€‹åœ¨çº¿é˜…è¯»åœ°å€ï¼šhttp://www.52im.net/topic-tcpipvol1.html æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["TCP"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"Windowsçš„æ¶ˆæ¯æœºåˆ¶","path":"/post/4206756384.html","content":"ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸ªè§‚ç‚¹ï¼šçª—å£æ˜¯å’Œçº¿ç¨‹ç›¸å…³è”çš„ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæ˜¯å’Œçº¿ç¨‹ç›¸å…³è”çš„ï¼Œè¿™ä¸ªçº¿ç¨‹æ— è®ºæ˜¯ä¸»çº¿ç¨‹è¿˜æ˜¯å­çº¿ç¨‹ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œç³»ç»Ÿå‡å®šè¯¥çº¿ç¨‹ä¸ä¼šè¢«ç”¨äºä»»ä½•ä¸ç”¨æˆ·ç•Œé¢ç›¸å…³çš„ä»»åŠ¡ï¼Œæ‰€ä»¥ä¸ä¼šä¸ºå®ƒåˆ†é…ç›¸åº”çš„èµ„æºï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘çº¿ç¨‹å¯¹ç³»ç»Ÿèµ„æºçš„å ç”¨ã€‚ ä½†æ˜¯ï¼Œä¸€æ—¦è¿™ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªä¸å›¾å½¢ç”¨æˆ·ç•Œé¢æœ‰å…³çš„å‡½æ•°ï¼ˆä¾‹å¦‚æ£€æŸ¥å®ƒçš„æ¶ˆæ¯é˜Ÿåˆ—æˆ–å»ºç«‹ä¸€ä¸ªçª—å£ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šä¸ºè¯¥çº¿ç¨‹åˆ†é…ä¸€äº›é¢å¤–çš„èµ„æºï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿæ‰§è¡Œä¸ç”¨æˆ·ç•Œé¢æœ‰å…³çš„ä»»åŠ¡ã€‚ç‰¹åˆ«æ˜¯ï¼Œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªTHREADINFOç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªæ•°æ®ç»“æ„ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚ THREADINFOç»“æ„æ˜¯å¾®è½¯å†…éƒ¨çš„ã€æ²¡æœ‰è¢«å…¬å¼€çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æ— æ³•æ‰¾åˆ°è¿™ä¸ªç»“æ„ä½“çš„å‡†ç¡®çš„å®šä¹‰ã€‚ä½†ä»å…¶ä»–æ–‡æ¡£ä¸­å¯ä»¥å¾—çŸ¥ï¼ŒTHREADINFOç»“æ„åŒ…å«ï¼š ä¸€ç»„æˆå‘˜å˜é‡ï¼Œåˆ©ç”¨è¿™ç»„æˆå‘˜ï¼Œçº¿ç¨‹å¯ä»¥è®¤ä¸ºå®ƒæ˜¯åœ¨è‡ªå·±ç‹¬å çš„ç¯å¢ƒä¸­è¿è¡Œã€‚ ç™»è®°æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆposted-message queueï¼‰ å‘é€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ send-message queueï¼‰ åº”ç­”æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ reply -message queueï¼‰ è™šæ‹Ÿè¾“å…¥é˜Ÿåˆ—ï¼ˆvirtualized-input queueï¼‰ å”¤é†’æ ‡å¿—ï¼ˆwake flagï¼‰ ç”¨æ¥æè¿°çº¿ç¨‹å±€éƒ¨è¾“å…¥çŠ¶æ€çš„è‹¥å¹²å˜é‡ã€‚ ä¸Šå›¾æè¿°äº†THREADINFOç»“æ„ä¸­çš„å„ä¸ªæˆå‘˜ã€‚çº¿ç¨‹æ‹¥æœ‰äº†THREADINFOç»“æ„ä¹Ÿå°±æœ‰äº†å„ç§æ¶ˆæ¯é˜Ÿåˆ—ã€‚ äºŒã€çª—å£æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç®€å•çš„åˆ›å»ºWindowsçª—ä½“çš„C++ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#include &lt;windows.h&gt;LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam) &#123; switch (message) &#123; case WM_DESTROY: PostQuitMessage(0); return 0; &#125; return DefWindowProc(hwnd, message, wParam, lParam);&#125;int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, int iCmdShow)&#123; WNDCLASS wndclass; wndclass.style = CS_HREDRAW | CS_VREDRAW; wndclass.cbClsExtra = 0; wndclass.cbWndExtra = 0; wndclass.hInstance = hInstance; wndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION); wndclass.hCursor = LoadCursor(NULL, IDC_ARROW); wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH); wndclass.lpszMenuName = NULL; wndclass.lpfnWndProc = WndProc; //è®¾ç½®çª—ä½“æ¶ˆæ¯å¤„ç†å‡½æ•° wndclass.lpszClassName = TEXT(&quot;SimpleWindow&quot;); if (!RegisterClass(&amp;wndclass)) &#123; //æ³¨å†Œçª—ä½“ç±» return 0; &#125;; HWND hwnd = CreateWindow(TEXT(&quot;SimpleWindow&quot;), // window class name TEXT(&quot;SimpleWindow&quot;), // window caption WS_OVERLAPPEDWINDOW, // window style CW_USEDEFAULT,// initial x position CW_USEDEFAULT,// initial y position CW_USEDEFAULT,// initial x size CW_USEDEFAULT,// initial y size NULL, // parent window handle NULL, // window menu handle hInstance, // program instance handle NULL); ShowWindow(hwnd, SW_SHOW); MSG msg; while (GetMessage(&amp;msg, NULL, 0, 0)) &#123; TranslateMessage(&amp;msg); DispatchMessage(&amp;msg); &#125; return msg.wParam;&#125; ä¸Šé¢ä»£ç ä¸­çš„WndProcå‡½æ•°å°±æ˜¯çª—å£æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚æ¶ˆæ¯å¾ªç¯ä¸­çš„DispatchMessageå‡½æ•°æ´¾å‘æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚ ä¸‰ã€æ¶ˆæ¯å¾ªç¯æ¶ˆæ¯å¾ªç¯æ˜¯ç¨‹åºå‘˜è‡ªå·±ç¼–å†™çš„ä»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¾ªç¯è·å–ï¼ˆGetæˆ–Peekï¼‰æ¶ˆæ¯çš„å¾ªç¯ä½“ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š 12345while(GetMessage(&amp;Msg, NULL, 0, 0)) &#123; TranslateMessage(&amp;Msg); DispatchMessage(&amp;Msg);&#125; 3.1 å¾ªç¯ä½•æ—¶ç»“æŸï¼ŸGetMessageå‡½æ•°çš„è¿”å›å€¼å¦‚ä¸‹ï¼š 123æ”¶åˆ°WM_QUITæ¶ˆæ¯ï¼Œè¿”å›0æ”¶åˆ°éWM_QUITæ¶ˆæ¯ï¼Œè¿”å›é0é”™è¯¯ï¼Œè¿”å›-1 åˆ©ç”¨GetMessageå‡½æ•°è¿”å›å€¼çš„ç‰¹æ€§ï¼Œåœ¨æ”¶åˆ°WM_QUITæ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å¾ªç¯å°±ä¼šç»“æŸã€‚ 3.2 TranslateMessageTranslateMessageå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†è™šæ‹Ÿé”®å€¼ä¿¡æ¯è½¬æ¢ä¸ºå­—ç¬¦ä¿¡æ¯ã€‚è¿™ä¸€æ­¥å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚ 3.3 DispatchMessageå°†æ¶ˆæ¯æ´¾å‘åˆ°çª—å£çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆå¦‚ç¬¬2èŠ‚ä¸­çš„WndProcå‡½æ•°ï¼‰ã€‚ å››ã€PostMessage4.1 PostMessageåŸç†12345BOOL PostMessage( HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam); å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œç³»ç»Ÿè¦ç¡®å®šæ˜¯å“ªä¸€ä¸ªçº¿ç¨‹å»ºç«‹äº†ç”¨hwndå‚æ•°æ ‡è¯†çš„çª—å£ã€‚ç„¶åç³»ç»Ÿåˆ†é…ä¸€å—å†…å­˜ï¼Œå°†è¿™ä¸ªæ¶ˆæ¯å‚æ•°å­˜å‚¨åœ¨è¿™å—å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™å—å†…å­˜å¢åŠ åˆ°ç›¸åº”çº¿ç¨‹çš„ç™»è®°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªå‡½æ•°è¿˜è®¾ç½®QS_POSTMESSAGEå”¤é†’ä½ã€‚PostMessageå‡½æ•°åœ¨ç™»è®°äº†æ¶ˆæ¯ä¹‹åç«‹å³è¿”å›ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹ä¸çŸ¥é“ç™»è®°çš„æ¶ˆæ¯æ˜¯å¦è¢«æŒ‡å®šçª—å£çš„çª—å£è¿‡ç¨‹æ‰€å¤„ç†ã€‚å®é™…ä¸Šï¼Œæœ‰å¯èƒ½è¿™ä¸ªæŒ‡å®šçš„çª—å£æ°¸è¿œä¸ä¼šæ”¶åˆ°ç™»è®°çš„æ¶ˆæ¯ã€‚ 4.2 PostThreadMessageè¿˜å¯ä»¥é€šè¿‡è°ƒç”¨PostThreadMessageå°†æ¶ˆæ¯æ”¾ç½®åœ¨çº¿ç¨‹çš„ç™»è®°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ 12345BOOL PostThreadMessage( DWORD dwThreadId, UINT uMsg, WPARAM wParam, LPARAM lParam); 4.3 PostQuitMessageä¸ºäº†ç»ˆæ­¢çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯ï¼Œå¯ä»¥è°ƒç”¨PostQuitMessageå‡½æ•°ã€‚PostQuitMessageå‡½æ•°ç±»ä¼¼äºï¼šPostThreadMessage(GetCurrentThreadId(), WM_QUIT, nExitCode, 0);ä½†æ˜¯ï¼ŒPostQuitMessageå¹¶ä¸å®é™…ç™»è®°ä¸€ä¸ªæ¶ˆæ¯åˆ°ä»»ä½•ä¸€ä¸ªTHREADINFOç»“æ„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚åªæ˜¯åœ¨å†…éƒ¨ï¼ŒPostQuitMessageä¼šè®¾å®šQS_QUITå”¤é†’æ ‡å¿—ï¼Œå¹¶å¯¹THREADINFOç»“æ„çš„nExitCodeæˆå‘˜è¿›è¡Œè®¾ç½®ã€‚å› ä¸ºè¿™äº›æ“ä½œæ°¸è¿œä¸ä¼šå¤±è´¥ï¼Œæ‰€ä»¥PostQuitMessageçš„åŸå‹è¢«å®šä¹‰æˆVOIDè¿”å›ç±»å‹ã€‚ äº”ã€SendMessageSendMessageçš„å®ç°åˆ†ä¸º2ç§æƒ…å†µï¼šå‘æœ¬çº¿ç¨‹çš„çª—å£å‘é€æ¶ˆæ¯ã€å‘å…¶ä»–çº¿ç¨‹çš„çª—å£å‘é€æ¶ˆæ¯ã€‚ 5.1 å‘æœ¬çº¿ç¨‹çš„çª—å£å‘é€æ¶ˆæ¯å¦‚æœè°ƒç”¨SendMessageçš„çº¿ç¨‹å‘æœ¬çº¿ç¨‹æ‰€å»ºç«‹çš„ä¸€ä¸ªçª—å£å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼ŒSendMessageçš„åšæ³•å¾ˆç®€å•ï¼šç›´æ¥è°ƒç”¨æŒ‡å®šçª—å£çš„â€œçª—å£æ¶ˆæ¯å¤„ç†å‡½æ•°â€ï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªå­ä¾‹ç¨‹ã€‚å½“â€œçª—å£æ¶ˆæ¯å¤„ç†å‡½æ•°â€å®Œæˆå¯¹æ¶ˆæ¯çš„å¤„ç†åï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå€¼ç»™SendMessageï¼ŒSendMessageå†å°†è¿™ä¸ªå€¼è¿”å›ç»™è°ƒç”¨çº¿ç¨‹ã€‚ 5.2 å‘å…¶ä»–çº¿ç¨‹çš„çª—å£å‘é€æ¶ˆæ¯ä½†æ˜¯ï¼Œå½“è°ƒç”¨SendMessageçš„çº¿ç¨‹å‘å…¶ä»–çº¿ç¨‹æ‰€å»ºç«‹çš„çª—å£å‘é€æ¶ˆæ¯æ—¶ï¼ŒSendMessageçš„å†…éƒ¨å·¥ä½œå°±å¤æ‚å¾—å¤šï¼ˆå³ä½¿ä¸¤ä¸ªçº¿ç¨‹åœ¨åŒä¸€è¿›ç¨‹ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚ Windowsè¦æ±‚å»ºç«‹çª—å£çš„çº¿ç¨‹æ¥å¤„ç†è¯¥çª—å£çš„æ¶ˆæ¯ã€‚æ‰€ä»¥å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨SendMessageå‘ä¸€ä¸ªç”±å…¶ä»–è¿›ç¨‹æ‰€å»ºç«‹çš„çª—å£å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯å‘å…¶ä»–çš„çº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œå‘é€çº¿ç¨‹ä¸å¯èƒ½å¤„ç†çª—å£æ¶ˆæ¯ï¼Œå› ä¸ºå‘é€çº¿ç¨‹ä¸æ˜¯è¿è¡Œåœ¨æ¥æ”¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼Œå› æ­¤ä¸èƒ½è®¿é—®ç›¸åº”çª—å£è¿‡ç¨‹çš„ä»£ç å’Œæ•°æ®ã€‚å®é™…ä¸Šï¼Œå‘é€çº¿ç¨‹è¦æŒ‚èµ·ï¼Œè€Œç”±å¦å¤–çš„çº¿ç¨‹å¤„ç†æ¶ˆæ¯ã€‚æ‰€ä»¥ä¸ºäº†å‘å…¶ä»–çº¿ç¨‹å»ºç«‹çš„çª—å£å‘é€ä¸€ä¸ªçª—å£æ¶ˆæ¯ï¼Œç³»ç»Ÿå¿…é¡»æ‰§è¡Œä¸‹é¢çš„åŠ¨ä½œï¼š é¦–å…ˆï¼Œå‘é€çš„æ¶ˆæ¯è¦è¿½åŠ åˆ°æ¥æ”¶çº¿ç¨‹çš„å‘é€æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŒæ—¶è¿˜ä¸ºè¿™ä¸ªçº¿ç¨‹è®¾å®šQS_SENDMESSAGEæ ‡å¿—ï¼ˆåé¢å°†è®¨è®ºï¼‰ã€‚å…¶æ¬¡ï¼Œå¦‚æœæ¥æ”¶çº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œä»£ç å¹¶ä¸”æ²¡æœ‰ç­‰å¾…æ¶ˆæ¯ï¼ˆç­‰å¾…æ¶ˆæ¯æ˜¯æŒ‡ï¼šå¦‚è°ƒç”¨GetMessageã€PeekMessageæˆ–WaitMessageç­‰ï¼‰ï¼Œå‘é€çš„æ¶ˆæ¯ä¸ä¼šè¢«å¤„ç†ï¼Œç³»ç»Ÿä¸èƒ½ä¸­æ–­çº¿ç¨‹æ¥ç«‹å³å¤„ç†æ¶ˆæ¯ã€‚å½“æ¥æ”¶è¿›ç¨‹åœ¨ç­‰å¾…æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆæ£€æŸ¥çº¿ç¨‹çš„QS_SENDMESSAGEå”¤é†’æ ‡å¿—æ˜¯å¦è¢«è®¾å®šï¼Œå¦‚æœæ˜¯ï¼Œç³»ç»Ÿæ‰«æå‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„åˆ—è¡¨ï¼Œå¹¶æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘é€çš„æ¶ˆæ¯ã€‚æœ‰å¯èƒ½åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­æœ‰å‡ ä¸ªå‘é€çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå‡ ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å‘ä¸€ä¸ªçª—å£åˆ†åˆ«å‘é€æ¶ˆæ¯ã€‚å½“å‘ç”Ÿè¿™æ ·çš„äº‹æ—¶ï¼Œç³»ç»Ÿåªæ˜¯å°†è¿™äº›æ¶ˆæ¯è¿½åŠ åˆ°æ¥æ”¶çº¿ç¨‹çš„å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ å½“æ¥æ”¶çº¿ç¨‹ç­‰å¾…æ¶ˆæ¯æ—¶ï¼Œç³»ç»Ÿä»å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªæ¶ˆæ¯å¹¶è°ƒç”¨é€‚å½“çš„çª—å£è¿‡ç¨‹æ¥å¤„ç†æ¶ˆæ¯ã€‚å¦‚æœåœ¨å‘é€æ¶ˆæ¯é˜Ÿåˆ—ä¸­å†æ²¡æœ‰æ¶ˆæ¯äº†ï¼Œåˆ™QS_SENDMESSAGEå”¤é†’æ ‡å¿—è¢«å…³é—­ã€‚å½“æ¥æ”¶çº¿ç¨‹å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œè°ƒç”¨SendMessageçš„çº¿ç¨‹è¢«è®¾ç½®æˆç©ºé—²çŠ¶æ€ï¼ˆidleï¼‰ï¼Œç­‰å¾…ä¸€ä¸ªæ¶ˆæ¯å‡ºç°åœ¨å®ƒçš„åº”ç­”æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚åœ¨å‘é€çš„æ¶ˆæ¯å¤„ç†ä¹‹åï¼Œçª—å£è¿‡ç¨‹çš„è¿”å›å€¼è¢«ç™»è®°åˆ°å‘é€çº¿ç¨‹çš„åº”ç­”æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚å‘é€çº¿ç¨‹ç°åœ¨è¢«å”¤é†’ï¼Œå–å‡ºåŒ…å«åœ¨åº”ç­”æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è¿”å›å€¼ã€‚è¿™ä¸ªè¿”å›å€¼å°±æ˜¯SendMessageçš„è¿”å›å€¼ã€‚è¿™æ—¶ï¼Œå‘é€çº¿ç¨‹ç»§ç»­æ­£å¸¸æ‰§è¡Œã€‚ å½“ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…SendMessageè¿”å›æ—¶ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯å¤„äºç©ºé—²çŠ¶æ€ã€‚ä½†å®ƒå¯ä»¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼šå¦‚æœç³»ç»Ÿä¸­å¦å¤–ä¸€ä¸ªçº¿ç¨‹å‘ä¸€ä¸ªçª—å£å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªçª—å£æ˜¯ç”±è¿™ä¸ªç­‰å¾…SendMessageè¿”å›çš„çº¿ç¨‹æ‰€å»ºç«‹çš„ï¼Œåˆ™ç³»ç»Ÿè¦ç«‹å³å¤„ç†å‘é€çš„æ¶ˆæ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¸å¿…ç­‰å¾…çº¿ç¨‹å»è°ƒç”¨GetMessageã€PeekMessageæˆ–WaitMessageã€‚ ç”±äºWindowsä½¿ç”¨ä¸Šè¿°æ–¹æ³•å¤„ç†çº¿ç¨‹ä¹‹é—´å‘é€çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥æœ‰å¯èƒ½é€ æˆçº¿ç¨‹æŒ‚èµ·ã€‚ä¾‹å¦‚ï¼Œå½“å¤„ç†å‘é€æ¶ˆæ¯çš„çº¿ç¨‹å«æœ‰é”™è¯¯æ—¶ï¼Œä¼šå¯¼è‡´è¿›å…¥æ­»å¾ªç¯ã€‚é‚£ä¹ˆå¯¹äºè°ƒç”¨SendMessageçš„çº¿ç¨‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿå®ƒä¼šæ¢å¤æ‰§è¡Œå—ï¼Ÿè¿™æ˜¯å¦æ„å‘³ç€ä¸€ä¸ªç¨‹åºä¸­çš„bugä¼šå¯¼è‡´å¦ä¸€ä¸ªç¨‹åºæŒ‚èµ·ï¼Ÿç­”æ¡ˆæ˜¯ç¡®å®æœ‰è¿™ç§å¯èƒ½ã€‚ åˆ©ç”¨4ä¸ªå‡½æ•°â€”â€” SendMessageTimeOutã€SendMessageCallbackã€SendNotifyMessageå’ŒReplayMessageï¼Œå¯ä»¥ç¼–å†™ä¿æŠ¤æ€§ä»£ç é˜²æ­¢å‡ºç°è¿™ç§æƒ…å†µã€‚","tags":["Windowsæ¶ˆæ¯"],"categories":["Windowsç¼–ç¨‹"]},{"title":"ç½‘ç»œåè®®(5)--UDPåè®®","path":"/post/4190400644.html","content":"ä¸€ã€ä»€ä¹ˆæ˜¯ UDP åè®®ï¼ŸUDP æ˜¯ User Datagram Protocol çš„ç®€ç§°ï¼Œä¸­æ–‡åæ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯ OSI å‚è€ƒæ¨¡å‹ä¸­çš„ä¼ è¾“å±‚åè®®ï¼Œå®ƒæ˜¯ä¸€ç§æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œæä¾›é¢å‘äº‹åŠ¡çš„ç®€å•ä¸å¯é ä¿¡æ¯ä¼ é€æœåŠ¡ã€‚ UDP çš„æ­£å¼è§„èŒƒæ˜¯IETF RFC768ã€‚UDP åœ¨ IP æŠ¥æ–‡çš„åè®®å·æ˜¯ 17ã€‚ ISO ä¸ƒå±‚æ¨¡å‹ï¼š äºŒã€UDP æŠ¥å¤´UDP æŠ¥å¤´çš„ç»“æ„å¦‚å›¾ï¼š UDP æŠ¥å¤´ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ä¸¤ä¸ªæ˜¯å¯é€‰çš„ï¼ˆç²‰çº¢èƒŒæ™¯æ ‡å‡ºéƒ¨åˆ†ï¼‰ï¼š å„ 16bit çš„æ¥æºç«¯å£å’Œç›®çš„ç«¯å£ç”¨æ¥æ ‡è®°å‘é€å’Œæ¥å—çš„åº”ç”¨è¿›ç¨‹ã€‚å› ä¸º UDP ä¸éœ€è¦åº”ç­”ï¼Œæ‰€ä»¥æ¥æºç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ¥æºç«¯å£ä¸ç”¨ï¼Œé‚£ä¹ˆç½®ä¸ºé›¶ã€‚ åœ¨ç›®çš„ç«¯å£åé¢æ˜¯é•¿åº¦å›ºå®šçš„ä»¥å­—èŠ‚ä¸ºå•ä½çš„æŠ¥æ–‡é•¿åº¦åŸŸï¼Œç”¨æ¥æŒ‡å®š UDP æ•°æ®æŠ¥åŒ…æ‹¬æ•°æ®éƒ¨åˆ†çš„é•¿åº¦ï¼Œé•¿åº¦æœ€å°å€¼ä¸º 8byteã€‚ é¦–éƒ¨å‰©ä¸‹åœ° 16bit æ˜¯ç”¨æ¥å¯¹é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ä¸€èµ·åšæ ¡éªŒå’Œï¼ˆChecksumï¼‰çš„ï¼Œè¿™éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ä¸€èˆ¬éƒ½ä½¿ç”¨è¿™ä¸€åŠŸèƒ½ã€‚ UDP å’Œ TCP çš„æ ¡éªŒå’Œéƒ½è¦†ç›–åˆ°äº†ä»–ä»¬çš„é¦–éƒ¨å’Œæ•°æ®ï¼Œè€Œä¹‹å‰ä»‹ç»çš„ IP é¦–éƒ¨çš„æ ¡éªŒå’Œåªè¦†ç›–äº† IP é¦–éƒ¨ã€‚ ä¸‰ã€TCP å’Œ UDP åŒºåˆ« ç‰¹å¾ç‚¹ TCP UDP æ˜¯å¦è¿æ¥ é¢å‘è¿æ¥ é¢å‘éè¿æ¥ ä¼ è¾“å¯é æ€§ å¯é  ä¼šä¸¢åŒ…ï¼Œä¸å¯é  åº”ç”¨åœºæ™¯ ä¼ è¾“æ•°æ®é‡å¤§ ä¼ è¾“é‡å° é€Ÿåº¦ æ…¢ å¿« TCP(ä¼ è¾“æ§åˆ¶åè®®)æä¾›çš„æ˜¯é¢å‘è¿æ¥ã€å¯é çš„å­—èŠ‚æµæœåŠ¡ã€‚å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å½¼æ­¤äº¤æ¢æ•°æ®å‰ï¼Œå¿…é¡»å…ˆåœ¨åŒæ–¹ä¹‹é—´å»ºç«‹ä¸€ä¸ª TCP è¿æ¥ï¼Œä¹‹åæ‰èƒ½ä¼ è¾“æ•°æ®ã€‚TCP æä¾›è¶…æ—¶é‡å‘ï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼Œæ£€éªŒæ•°æ®ï¼Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œä¿è¯æ•°æ®èƒ½ä»ä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯ã€‚UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)æ˜¯ä¸€ä¸ªç®€å•çš„é¢å‘æ•°æ®æŠ¥çš„è¿è¾“å±‚åè®®ã€‚UDP ä¸æä¾›å¯é æ€§ï¼Œå®ƒåªæ˜¯æŠŠåº”ç”¨ç¨‹åºä¼ ç»™ IP å±‚çš„æ•°æ®æŠ¥å‘é€å‡ºå»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å®ƒä»¬èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚ç”±äº UDP åœ¨ä¼ è¾“æ•°æ®æŠ¥å‰ä¸ç”¨åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¸”æ²¡æœ‰è¶…æ—¶é‡å‘ç­‰æœºåˆ¶ï¼Œæ•…è€Œä¼ è¾“é€Ÿåº¦å¾ˆå¿«ã€‚ ç”±äº UDP ç¼ºä¹æ‹¥å¡æ§åˆ¶ï¼ˆcongestion controlï¼‰ï¼Œéœ€è¦åŸºäºç½‘ç»œçš„æœºåˆ¶æ¥å‡å°‘å› å¤±æ§å’Œé«˜é€Ÿ UDP æµé‡è´Ÿè·è€Œå¯¼è‡´çš„æ‹¥å¡å´©æºƒæ•ˆåº”ã€‚æ¢å¥è¯è¯´ï¼Œå› ä¸º UDP å‘é€è€…ä¸èƒ½å¤Ÿæ£€æµ‹æ‹¥å¡ï¼Œæ‰€ä»¥åƒä½¿ç”¨åŒ…é˜Ÿåˆ—å’Œä¸¢å¼ƒæŠ€æœ¯çš„è·¯ç”±å™¨è¿™æ ·çš„ç½‘ç»œåŸºæœ¬è®¾å¤‡å¾€å¾€å°±æˆä¸ºé™ä½ UDP è¿‡å¤§é€šä¿¡é‡çš„æœ‰æ•ˆå·¥å…·ã€‚æ•°æ®æŠ¥æ‹¥å¡æ§åˆ¶åè®®ï¼ˆDCCPï¼‰è®¾è®¡æˆé€šè¿‡åœ¨è¯¸å¦‚æµåª’ä½“ç±»å‹çš„é«˜é€Ÿç‡ UDP æµä¸­ï¼Œå¢åŠ ä¸»æœºæ‹¥å¡æ§åˆ¶ï¼Œæ¥å‡å°è¿™ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚ å››ã€åº”ç”¨åœºæ™¯ç”±äºç¼ºä¹å¯é æ€§ä¸”å±äºéè¿æ¥å¯¼å‘åè®®ï¼ŒUDP çš„åº”ç”¨ä¸€èˆ¬å¿…é¡»å…è®¸ä¸€å®šé‡çš„ä¸¢åŒ…ã€å‡ºé”™å’Œå¤åˆ¶ç²˜è´´ã€‚ä½†æœ‰äº›åº”ç”¨ï¼Œæ¯”å¦‚ TFTPï¼Œéœ€è¦å¯é æ€§ä¿è¯ï¼Œåˆ™å¿…é¡»åœ¨åº”ç”¨å±‚å¢åŠ æ ¹æœ¬çš„å¯é æœºåˆ¶ã€‚ä½†æ˜¯ç»å¤§å¤šæ•° UDP åº”ç”¨éƒ½ä¸éœ€è¦å¯é æœºåˆ¶ï¼Œç”šè‡³å¯èƒ½å› ä¸ºå¼•å…¥å¯é æœºåˆ¶è€Œé™ä½æ€§èƒ½ã€‚æµåª’ä½“ã€å³æ—¶å¤šåª’ä½“æ¸¸æˆå’Œ IP ç”µè¯ï¼ˆVoIPï¼‰å°±æ˜¯å…¸å‹çš„ UDP åº”ç”¨ã€‚å¦‚æœæŸä¸ªåº”ç”¨éœ€è¦å¾ˆé«˜çš„å¯é æ€§ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¼ è¾“æ§åˆ¶åè®®ï¼ˆå³ TCP åè®®ï¼‰æ¥ä»£æ›¿ UDPã€‚ ä½¿ç”¨ UDP åè®®çš„åº”ç”¨æœ‰ï¼šåŸŸåç³»ç»Ÿï¼ˆDNSï¼‰ã€ç®€å•ç½‘ç»œç®¡ç†åè®®ï¼ˆSNMPï¼‰ã€åŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼ˆDHCPï¼‰ã€è·¯ç”±ä¿¡æ¯åè®®ï¼ˆRIPï¼‰ç­‰ç­‰ã€‚ å› ä¸º UDP ä¸å±äºè¿æ¥å‹åè®®ï¼Œå› è€Œå…·æœ‰èµ„æºæ¶ˆè€—å°ï¼Œå¤„ç†é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ï¼Œæ‰€ä»¥é€šå¸¸éŸ³é¢‘ã€è§†é¢‘å’Œæ™®é€šæ•°æ®åœ¨ä¼ é€æ—¶ä½¿ç”¨ UDP è¾ƒå¤šï¼Œå› ä¸ºå®ƒä»¬å³ä½¿å¶å°”ä¸¢å¤±å‡ ä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿä¸ä¼šå¯¹æ¥æ”¶ç»“æœäº§ç”Ÿå¤ªå¤§å½±å“ã€‚ äº”ã€å•æ’­ã€å¤šæ’­ã€å¹¿æ’­ã€ç»„æ’­å‡è®¾ A(all ç®€å†™)ä»£è¡¨æ‰€æœ‰çš„æœºå™¨ï¼ŒM(multiple ç®€å†™)ä»£è¡¨ A ä¸­çš„å¤šä¸ªæœºå™¨ï¼ŒG(group ç®€å†™)ä»£è¡¨ä¸€ç»„æœºå™¨ï¼Œ1 ä»£è¡¨ä¸€å°æœºå™¨ï¼Œé‚£ä¹ˆï¼š 12345671 -&gt; 1 å°±æ˜¯å•æ’­ï¼›1 -&gt; M å°±æ˜¯å¤šæ’­ï¼›1 -&gt; A å°±æ˜¯å¹¿æ’­ï¼›1 -&gt; G å°±æ˜¯ç»„æ’­ï¼›å½“M=Aæ—¶ï¼Œå¤šæ’­å°±æ˜¯å¹¿æ’­ï¼›å½“M=Gæ—¶ï¼Œå¤šæ’­å°±æ˜¯ç»„æ’­ï¼› å¤šæ’­åŒ…æ‹¬ç»„æ’­å’Œå¹¿æ’­ï¼Œç»„æ’­ã€å¹¿æ’­éƒ½æ˜¯å¤šæ’­çš„ä¸€ç§è¡¨ç°å½¢å¼ã€‚ 5.1 å•æ’­å•æ’­æ˜¯ä¸»æœºä¹‹é—´â€œä¸€å¯¹ä¸€â€çš„é€šè®¯æ¨¡å¼ã€‚å‘é€æ–¹éœ€è¦æŒ‡å®šä¸€ä¸ªæ¥æ”¶æ–¹çš„ IP å’Œç«¯å£ï¼Œåªæœ‰è¿™ä¸ªæ¥æ”¶æ–¹ä¼šæ”¶åˆ°æ•°æ®æŠ¥ã€‚ä¸ä¼šå¯¹å­ç½‘å†…çš„å…¶ä»–æœºå™¨äº§ç”Ÿå½±å“ã€‚åœ¨å•æ’­æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨é’ˆå¯¹æ¯ä¸ªå®¢æˆ·æœºéƒ½è¦å‘é€æ•°æ®æµï¼ŒæœåŠ¡å™¨æµé‡=å®¢æˆ·æœºæ•°é‡Ã—å®¢æˆ·æœºæµé‡ï¼Œåœ¨å®¢æˆ·æœºæ•°é‡å¤§ã€æ¯ä¸ªå®¢æˆ·æœºæµé‡å¤§çš„åº”ç”¨ï¼ˆå¦‚æµåª’ä½“ï¼‰ä¸­ï¼ŒæœåŠ¡å™¨å°†ä¸å ªé‡è´Ÿã€‚ 5.1.1 å•æ’­å‘é€ç«¯å› ä¸º UDP ä¸æ˜¯é¢å‘è¿æ¥çš„ï¼Œä¸”ä¸å¯é çš„ï¼Œæ‰€ä»¥å‘é€ç«¯åœ¨è°ƒç”¨sendtoä¹‹åï¼Œå°±ç®—sendtoè¿”å›æˆåŠŸï¼Œä¹Ÿä¸ä»£è¡¨æ¥æ”¶ç«¯ä¸€å®šæ”¶åˆ°äº†æ•°æ®ï¼Œå¯èƒ½æ¥æ”¶ç«¯å‹æ ¹éƒ½æ²¡å¯åŠ¨ï¼Œä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ã€‚ä¸èƒ½æ ¹æ®sendtoçš„è¿”å›å€¼æ¥ç¡®ä¿æ¥æ”¶ç«¯ä¸€å®šæ”¶åˆ°äº†æ•°æ®ã€‚å¦‚æœéœ€è¦æ•°æ®ä¼ è¾“çš„å¯é æ€§å¾—åˆ°ä¿è¯ï¼Œå¯ä»¥ä½¿ç”¨ TCP æˆ–è€…é€šè¿‡ä¸šåŠ¡é€»è¾‘æ¥ä¿è¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void SendLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); // æ¥æ”¶ç«¯ç«¯å£ addr.sin_addr.s_addr = inet_addr(&quot;127.0.0.1&quot;); // æ¥æ”¶ç«¯IP char buf[100] = &#123; &quot;hello&quot; &#125;; int err = sendto(socket, buf, strlen(buf), 0, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;sendto failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[SEND] %s OK &quot;, buf); WSACleanup();&#125;int main()&#123; SendLogic(); getchar(); return 0;&#125; 5.1.2 å•æ’­æ¥æ”¶ç«¯å› ä¸º UDP ä¸æ˜¯é¢å‘è¿æ¥çš„ï¼Œæ‰€ä»¥æ¥æ”¶ç«¯ä¸ç”¨ listenï¼Œä¹Ÿä¸ç”¨ acceptï¼Œåªéœ€è¦ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£å’Œåœ°å€å³å¯ã€‚recvfromæ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡ä½ç­‰å¾…æ•°æ®çš„åˆ°æ¥ã€‚å¦‚æœè¦ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨WSARecvFromç»“åˆ ICOP çš„æ–¹å¼æ¥å®ç°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void RecvLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); // ç«¯å£ addr.sin_addr.s_addr = INADDR_ANY; // ä»»æ„IPåœ°å€ int err = bind(socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;bind failed, error=%d &quot;, WSAGetLastError()); return; &#125; while (true) &#123; // TODOï¼šæœªè€ƒè™‘é€€å‡ºçš„æƒ…å†µ char buf[100] = &#123; 0 &#125;; int fromlen = sizeof(addr); err = recvfrom(socket, buf, 100, 0, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr), &amp;fromlen); if (err == SOCKET_ERROR) &#123; printf(&quot;recvfrom failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[RECV] %s &quot;, buf); &#125; WSACleanup();&#125;int main()&#123; RecvLogic(); getchar(); return 0;&#125; 5.2 å¹¿æ’­å¹¿æ’­æ˜¯ä¸»æœºä¹‹é—´â€œä¸€å¯¹æ‰€æœ‰â€çš„é€šè®¯æ¨¡å¼ã€‚å­ç½‘çš„ä¸€å°ä¸»æœºä½œä¸ºå‘é€å‘å¹¿æ’­ä¸€æ¡ä¿¡æ¯ï¼Œè¯¥å­ç½‘ä¸­çš„æ‰€æœ‰ä¸»æœºéƒ½å¯ä»¥æ¥æ”¶åˆ°è¯¥ä¿¡æ¯ï¼ˆä¸ç®¡ä½ æ˜¯å¦éœ€è¦è¯¥ä¿¡æ¯ï¼‰ã€‚åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œç”±äºæœåŠ¡å™¨ä¸ç”¨å‘æ¯ä¸ªå®¢æˆ·æœºå•ç‹¬å‘é€æ•°æ®ï¼Œæ‰€ä»¥æœåŠ¡å™¨æµé‡è´Ÿè½½æä½ã€‚æ— æ³•åœ¨å¹¿åŸŸç½‘ä¸Šè¿›è¡Œå¹¿æ’­ï¼Œè€Œä¸”å¹¿æ’­æ¶ˆæ¯ä¸ä¼šè¢«è·¯ç”±è½¬å‘ï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸€ä¸ªå­ç½‘ä¸­è¿›è¡Œå¹¿æ’­ã€‚å› ä¸ºå¦‚æœè·¯ç”±å™¨è½¬å‘äº†å¹¿æ’­ä¿¡æ¯ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šå¼•èµ·ç½‘ç»œç˜«ç—ªã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ IP åè®®çš„è®¾è®¡è€…æ•…æ„æ²¡æœ‰å®šä¹‰äº’è”ç½‘èŒƒå›´çš„å¹¿æ’­æœºåˆ¶ã€‚ ä¸»æœºå‘é€å¹¿æ’­æ¶ˆæ¯æ—¶ï¼Œéœ€è¦æŒ‡å®šç›®çš„ IP åœ°å€ä¸º255.255.255.255å’Œæ¥å—è€…çš„ç«¯å£å·ã€‚ UDP çš„å¹¿æ’­å’Œå•æ’­çš„ä¸åŒåœ¨äºå‘é€ç«¯ï¼ˆæ¥æ”¶ç«¯çš„å®ç°å’Œå•æ’­æ–¹å¼æ²¡æœ‰åŒºåˆ«ï¼‰çš„å®ç°ä¸Šï¼š å‘é€ç«¯å°†å¥—æ¥å­—é…ç½®ä¸ºå‘é€å¹¿æ’­æ¶ˆæ¯ï¼Œä½¿ç”¨setsockoptå‡½æ•°ã€‚ å‘é€åœ°å€æ›´æ”¹ä¸ºå—é™çš„å¹¿æ’­åœ°å€255.255.255.255ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯å¹¿æ’­åœ°å€ä¸ä»…ä»…åªæœ‰255.255.255.255ä¸€ä¸ªã€‚å¹¿æ’­åœ°å€åˆ†ä¸ºå—é™çš„å¹¿æ’­ã€æŒ‡å‘ç½‘ç»œçš„å¹¿æ’­ã€æŒ‡å‘å­ç½‘çš„å¹¿æ’­ã€æŒ‡å‘æ‰€æœ‰å­ç½‘çš„ç½‘å¹¿æ’­ã€‚255.255.255.255åªæ˜¯å—é™çš„å¹¿æ’­åœ°å€ã€‚ 5.2.1 å¹¿æ’­å‘é€ç«¯1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void SendLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; // å°†å¥—æ¥å­—é…ç½®ä¸ºå‘é€å¹¿æ’­æ¶ˆæ¯ int broadcast = 1; int err = setsockopt(socket, SOL_SOCKET, SO_BROADCAST, reinterpret_cast&lt;const char*&gt;(&amp;broadcast), sizeof(int)); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); addr.sin_addr.s_addr = INADDR_BROADCAST; // ä¹Ÿå¯ä»¥æ¢æˆinet_addr(&quot;255.255.255.255&quot;) char buf[100] = &#123; &quot;hello&quot; &#125;; err = sendto(socket, buf, strlen(buf), 0, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;sendto failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[BROADCAST] %s OK &quot;, buf); WSACleanup();&#125;int main()&#123; SendLogic(); getchar(); return 0;&#125; 5.2.2 å¹¿æ’­æ¥æ”¶ç«¯(å’Œå•æ’­ä¸€æ ·)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void RecvLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); addr.sin_addr.s_addr = INADDR_ANY; int err = bind(socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;bind failed, error=%d &quot;, WSAGetLastError()); return; &#125; while (true) &#123; char buf[100] = &#123; 0 &#125;; int fromlen = sizeof(addr); err = recvfrom(socket, buf, 100, 0, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr), &amp;fromlen); if (err == SOCKET_ERROR) &#123; printf(&quot;recvfrom failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[RECV] %s &quot;, buf); &#125; WSACleanup();&#125;int main()&#123; RecvLogic(); getchar(); return 0;&#125; 5.3 ç»„æ’­ç»„æ’­æ˜¯ä¸»æœºä¹‹é—´â€œä¸€å¯¹å¤šâ€çš„é€šè®¯æ¨¡å¼ã€‚ä¸€å°ä¸»æœºåŠ å…¥ä¸€ä¸ªç»„æ’­ IP åï¼Œä¹‹åå‘è¯¥ç»„æ’­ IP å‘é€çš„æ•°æ®æŠ¥éƒ½ä¼šå‘é€åˆ°è¯¥ä¸»æœºã€‚ä¸“é—¨ä¸ºç»„æ’­åˆ’å‡ºäº†ä¸€ä¸ªåœ°å€èŒƒå›´ï¼Œåœ¨ IPv4 ä¸­ä¸º D ç±»åœ°å€ï¼ŒèŒƒå›´æ˜¯224.0.0.0 ~ 239.255.255.255ï¼Œå¹¶å°† D ç±»åœ°å€åˆ’åˆ†ä¸ºå±€éƒ¨é“¾æ¥ç»„æ’­åœ°å€ã€é¢„ç•™ç»„æ’­åœ°å€ã€ç®¡ç†æƒé™ç»„æ’­åœ°å€å¦‚ä¸‹ï¼šå±€éƒ¨é“¾æ¥åœ°å€ï¼š224.0.0.0ï½224.0.0.255ï¼Œç”¨äºå±€åŸŸç½‘ï¼Œè·¯ç”±å™¨ä¸è½¬å‘å±äºæ­¤èŒƒå›´çš„ IP åŒ…ã€‚ é¢„ç•™ç»„æ’­åœ°å€ï¼š224.0.1.0ï½238.255.255.255ï¼Œç”¨äºå…¨çƒèŒƒå›´æˆ–ç½‘ç»œåè®®ã€‚ ç®¡ç†æƒé™åœ°å€ï¼š239.0.0.0ï½239.255.255.255ï¼Œç»„ç»‡å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºé™åˆ¶ç»„æ’­èŒƒå›´ã€‚ ç»„æ’­å°±æ˜¯å°†æ•°æ®å‘é€åˆ°ä¸€ç»„ä¸»æœºã€‚æ¥æ”¶ç«¯å¦‚æœè¦æ¥æ”¶æ¶ˆæ¯ï¼Œåˆ™éœ€è¦åŠ å…¥åˆ°è¯¥åˆ†ç»„ï¼Œåˆ†ç»„æ˜¯ç”¨ IP æ¥æ ‡è¯†çš„ã€‚ä»ç½‘ç»œåè®®(3)--IPåè®®å¯ä»¥çŸ¥é“ï¼Œé€‚ç”¨äºåˆ†ç»„çš„ IP æœ‰224.0.0.0 ~ 239.255.255.255ã€‚åŒæ ·ï¼Œå‘é€ç«¯å°±éœ€è¦å°†æ•°æ®å‘é€åˆ°è¯¥åˆ†ç»„ IPã€‚ 5.3.1 ç»„æ’­å‘é€ç«¯1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;WinSock2.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void SendLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; // å°†å¥—æ¥å­—é…ç½®ä¸ºå‘é€å¹¿æ’­æ¶ˆæ¯ int broadcast = 1; int err = setsockopt(socket, SOL_SOCKET, SO_BROADCAST, reinterpret_cast&lt;const char*&gt;(&amp;broadcast), sizeof(int)); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); addr.sin_addr.s_addr = inet_addr(&quot;225.0.0.37&quot;); // å‘æŒ‡å®šå¹¿æ’­ç»„å‘é€æ¶ˆæ¯ char buf[100] = &#123; &quot;hello&quot; &#125;; err = sendto(socket, buf, strlen(buf), 0, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;sendto failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[BROADCAST] %s OK &quot;, buf); WSACleanup();&#125;int main()&#123; SendLogic(); getchar(); return 0;&#125; 5.3.2 ç»„æ’­æ¥æ”¶ç«¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include &lt;WinSock2.h&gt;#include &lt;Ws2ipdef.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)void RecvLogic() &#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(1, 0); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket = ::WSASocket(AF_INET, SOCK_DGRAM, IPPROTO_UDP, nullptr, 0, 0); if (socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed, error=%d &quot;, WSAGetLastError()); return; &#125; sockaddr_in addr; addr.sin_family = AF_INET; addr.sin_port = htons(6000); addr.sin_addr.s_addr = htonl(INADDR_ANY); int err = bind(socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)); if (err == SOCKET_ERROR) &#123; printf(&quot;bind failed, error=%d &quot;, WSAGetLastError()); return; &#125; // å°†SOCKETåŠ å…¥å¹¿æ’­ç»„ // struct ip_mreq mreq; // å¼•å…¥å¤´æ–‡ä»¶&lt;Ws2ipdef.h&gt; mreq.imr_multiaddr.s_addr = inet_addr(&quot;225.0.0.37&quot;); // å¹¿æ’­ç»„åœ°å€ mreq.imr_interface.s_addr = htonl(INADDR_ANY); // æ³¨ï¼šä½¿ç”¨IP_DROP_MEMBERSHIPå¯ä»¥ç¦»å¼€å¹¿æ’­ç»„ err = setsockopt(socket, IPPROTO_IP, IP_ADD_MEMBERSHIP, reinterpret_cast&lt;const char*&gt;(&amp;mreq), sizeof(ip_mreq)); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt failed, error=%d &quot;, WSAGetLastError()); return; &#125; while (true) &#123; char buf[100] = &#123; 0 &#125;; int fromlen = sizeof(addr); err = recvfrom(socket, buf, 100, 0, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr), &amp;fromlen); if (err == SOCKET_ERROR) &#123; printf(&quot;recvfrom failed, error=%d &quot;, WSAGetLastError()); return; &#125; printf(&quot;[RECV] %s &quot;, buf); &#125; WSACleanup();&#125;int main()&#123; RecvLogic(); getchar(); return 0;&#125; ã€ŠTCP&#x2F;IP è¯¦è§£ å· 1ï¼šåè®®ã€‹åœ¨çº¿é˜…è¯»åœ°å€ï¼šhttp://www.52im.net/topic-tcpipvol1.html æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["UDP"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ç½‘ç»œåè®®(4)--ICMPåè®®","path":"/post/349088656.html","content":"äº’è”ç½‘æ§åˆ¶æ¶ˆæ¯åè®®ï¼ˆè‹±æ–‡ï¼šInternet Control Message Protocolï¼ŒICMPï¼‰æ˜¯äº’è”ç½‘åè®®æ—çš„æ ¸å¿ƒåè®®ä¹‹ä¸€ã€‚å®šä¹‰åœ¨ RFC 792 æ–‡æ¡£ä¸­ã€‚ICMP çš„æ¶ˆæ¯å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯å·®é”™æŠ¥æ–‡ï¼Œå³é€šçŸ¥å‡ºé”™åŸå› çš„é”™è¯¯æ¶ˆæ¯ï¼ˆå¦‚ tracerouteï¼‰ï¼Œå¦ä¸€ç±»æ˜¯æŸ¥è¯¢æŠ¥æ–‡ï¼Œå³ç”¨äºè¯Šæ–­çš„æŸ¥è¯¢æ¶ˆæ¯ï¼ˆå¦‚ pingï¼‰ã€‚ä½¿ç”¨ ICMP åè®®çš„å…¸å‹åº”ç”¨æœ‰ ping å’Œ tracerouteï¼ˆwindows ä¸Šå« tracertï¼‰ã€‚ ICMP æ˜¯åœ¨ IP æ•°æ®æŠ¥çš„å†…éƒ¨è¢«ä¼ è¾“çš„ï¼Œç´§è·Ÿç€ IP æŠ¥æ–‡çš„é¦–éƒ¨ï¼ˆå¦‚æœ IP é¦–éƒ¨æœ‰å¯é€‰éƒ¨åˆ†ï¼Œåˆ™ç´§è·Ÿç€å¯é€‰éƒ¨åˆ†ï¼‰ï¼š å›¾ä¸Šçš„ IP é¦–éƒ¨ 20 å­—èŠ‚æ˜¯åœ¨ IP æŠ¥æ–‡é¦–éƒ¨ä¸å«å¯é€‰éƒ¨åˆ†çš„æƒ…å†µä¸‹ï¼Œè‹¥ IP é¦–éƒ¨å«å¯é€‰éƒ¨åˆ†ï¼Œåˆ™å¤§äº 20 å­—èŠ‚ã€‚ ä¸€ã€ ICMP æŠ¥æ–‡æ ¼å¼ æ‰€æœ‰ ICMP æŠ¥æ–‡çš„å‰ 4 ä¸ªå­—èŠ‚éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å‰©ä¸‹çš„å…¶ä»–å­—èŠ‚åˆ™æ ¹æ®æŠ¥æ–‡ç±»å‹çš„ä¸åŒè€Œä¸åŒã€‚ 8ä½ç±»å‹å­—æ®µå’Œ8ä½ä»£ç å­—æ®µå…±åŒå†³å®šä¸€ç§ ICMP æŠ¥æ–‡çš„ç±»å‹ã€‚ æ ¡éªŒå’Œçš„è®¡ç®—æ–¹æ³•å’Œ IP é¦–éƒ¨æ ¡éªŒå’Œçš„è®¡ç®—æ–¹å¼ç›¸åŒï¼Œä½† ICMP æ ¡éªŒå’Œè¦†ç›–æ•´ä¸ª ICMP æŠ¥æ–‡ã€‚ IP é¦–éƒ¨æ ¡éªŒå’Œçš„è®¡ç®—æ–¹å¼å’ŒåŸç†å‚è€ƒï¼šç½‘ç»œåè®®(3)--IPåè®®UDP å’Œ TCP çš„æ ¡éªŒå’ŒåŒæ ·ä¹Ÿéƒ½è¦†ç›–åˆ°äº†ä»–ä»¬çš„é¦–éƒ¨å’Œæ•°æ®ã€‚ ã€ŠTCP&#x2F;IP è¯¦è§£ å· 1ï¼šåè®®ã€‹åœ¨çº¿é˜…è¯»åœ°å€ï¼šhttp://www.52im.net/topic-tcpipvol1.html äºŒã€å®é™…åº”ç”¨2.1 Ping2.1.1 Ping ç¨‹åºåŸç†å¤§å¤šæ•°ç³»ç»Ÿéƒ½å·²ç»åœ¨å†…æ ¸ä¸­å†…ç½®äº† ping æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸éœ€è¦å•ç‹¬çš„å…¶ä»–è¿›ç¨‹æ¥æ¥æ”¶ä¸»æœºçš„ ping è¯·æ±‚ã€‚ windows ç³»ç»Ÿä¸‹ï¼Œè¾“å…¥ping /?å‘½ä»¤æŸ¥çœ‹ ping çš„ç”¨æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324ç”¨æ³•: ping [-t] [-a] [-n count] [-l size] [-f] [-i TTL] [-v TOS] [-r count] [-s count] [[-j host-list] | [-k host-list]] [-w timeout] [-R] [-S srcaddr] [-4] [-6] target_nameé€‰é¡¹: -t Ping æŒ‡å®šçš„ä¸»æœºï¼Œç›´åˆ°åœæ­¢ã€‚ è‹¥è¦æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯å¹¶ç»§ç»­æ“ä½œ - è¯·é”®å…¥ Control-Breakï¼› è‹¥è¦åœæ­¢ - è¯·é”®å…¥ Control-Cã€‚ -a å°†åœ°å€è§£ææˆä¸»æœºåã€‚ -n count è¦å‘é€çš„å›æ˜¾è¯·æ±‚æ•°ã€‚ -l size å‘é€ç¼“å†²åŒºå¤§å°ã€‚ -f åœ¨æ•°æ®åŒ…ä¸­è®¾ç½®â€œä¸åˆ†æ®µâ€æ ‡å¿—(ä»…é€‚ç”¨äº IPv4)ã€‚ -i TTL ç”Ÿå­˜æ—¶é—´ã€‚ -v TOS æœåŠ¡ç±»å‹(ä»…é€‚ç”¨äº IPv4ã€‚è¯¥è®¾ç½®å·²ä¸èµæˆä½¿ç”¨ï¼Œä¸” å¯¹ IP æ ‡å¤´ä¸­çš„æœåŠ¡å­—æ®µç±»å‹æ²¡æœ‰ä»»ä½•å½±å“)ã€‚ -r count è®°å½•è®¡æ•°è·ƒç‚¹çš„è·¯ç”±(ä»…é€‚ç”¨äº IPv4)ã€‚ -s count è®¡æ•°è·ƒç‚¹çš„æ—¶é—´æˆ³(ä»…é€‚ç”¨äº IPv4)ã€‚ -j host-list ä¸ä¸»æœºåˆ—è¡¨ä¸€èµ·çš„æ¾æ•£æºè·¯ç”±(ä»…é€‚ç”¨äº IPv4)ã€‚ -k host-list ä¸ä¸»æœºåˆ—è¡¨ä¸€èµ·çš„ä¸¥æ ¼æºè·¯ç”±(ä»…é€‚ç”¨äº IPv4)ã€‚ -w timeout ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)ã€‚ -R åŒæ ·ä½¿ç”¨è·¯ç”±æ ‡å¤´æµ‹è¯•åå‘è·¯ç”±(ä»…é€‚ç”¨äº IPv6)ã€‚ -S srcaddr è¦ä½¿ç”¨çš„æºåœ°å€ã€‚ -4 å¼ºåˆ¶ä½¿ç”¨ IPv4ã€‚ -6 å¼ºåˆ¶ä½¿ç”¨ IPv6ã€‚ å…¶ä¸­-rå‚æ•°ç”¨äºè®°å½•è·ƒç‚¹è·¯ç”±ï¼Œç±»ä¼¼ tracert çš„åŠŸèƒ½ï¼Œä½†ä»–ä»¬çš„å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼Œping æ˜¯é€šè¿‡åœ¨ IP å¤´éƒ¨â€œé€‰é¡¹â€å­—æ®µè®°å½•ç»è¿‡çš„æ¯ä¸ªè·¯ç”±çš„ IP æ¥å®ç°è®°å½•è·¯ç”±åŠŸèƒ½çš„ï¼Œè¿™ç§å®ç°æœ‰ä¸ªé™åˆ¶ï¼Œå°±æ˜¯ IP é¦–éƒ¨â€œé€‰é¡¹â€å­—æ®µçš„æœ€å¤§å­—èŠ‚æ•°ä¸º 40 å­—èŠ‚ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½è®°å½• 10 ä¸ª IPã€‚ ping åŠŸèƒ½é€šè¿‡ ICMP çš„å›æ˜¾è¯·æ±‚å’Œå›æ˜¾åº”ç­”æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ ping æ˜¯åŸºäº ICMP åè®®å®ç°çš„ã€‚ ICMP å›æ˜¾è¯·æ±‚å’Œå›æ˜¾åº”ç­”çš„æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼š æ ‡è¯†ç¬¦ï¼šåœ¨å®ç°ä¸­ï¼Œä¸€èˆ¬å°†è¯¥å­—æ®µè®¾ç½®ä¸ºå½“å‰è¿›ç¨‹ IDã€‚è¿™æ ·å³ä½¿åœ¨åŒä¸€å°ä¸»æœºä¸ŠåŒæ—¶è¿è¡Œäº†å¤šä¸ª ping ç¨‹åºå®ä¾‹ï¼Œ ping ç¨‹åºä¹Ÿå¯ä»¥è¯†åˆ«å‡ºè¿”å›çš„ä¿¡æ¯å±äºå“ªä¸ªè¿›ç¨‹ã€‚ åºå·ï¼šåºå·ä¸€èˆ¬ä» 0 å¼€å§‹ï¼ˆæ²¡æœ‰å¼ºåˆ¶æ€§ï¼Œä»ä»»ä½•æ•°å­—å¼€å§‹éƒ½å¯ä»¥ï¼‰ï¼Œæ¯å‘é€ä¸€æ¬¡æ–°çš„å›æ˜¾è¯·æ±‚å°±åŠ  1ã€‚å› ä¸º ICMP æ˜¯åœ¨ IP æ•°æ®æŠ¥å†…éƒ¨è¢«ä¼ è¾“çš„ï¼Œè€Œ IP åè®®åˆæ˜¯ä¸å¯é ã€æ— è¿æ¥çš„ï¼Œæ‰€ä»¥ ping ç¨‹åºæ‰“å°å‡ºè¿”å›çš„æ¯ä¸ªåˆ†ç»„çš„åºåˆ—å·ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ˜¯å¦æœ‰åˆ†ç»„ä¸¢å¤±ã€å¤±åºæˆ–é‡å¤ã€‚ é€‰é¡¹ï¼šåœ¨â€œé€‰é¡¹â€å­—æ®µä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ”¾å…¥å‘é€æ—¶é—´æˆ³ï¼Œè¿™æ ·åœ¨æ”¶åˆ°å›åº”çš„æ—¶å€™å¯ä»¥ç”¨æ¥è®¡ç®—æœ¬æ¬¡ ping çš„è€—æ—¶ã€‚æˆ‘ä»¬ç»å¸¸ä¼šæŒ‡å®š ping åŒ…çš„å¤§å°ï¼Œæ‰€ä»¥ä¹Ÿä¼šåœ¨â€œé€‰é¡¹â€å­—æ®µä¸­å¡«å……ä¸€äº›åºŸæ•°æ®æ¥è®©åŒ…è¾¾åˆ°ä¸€å®šå¤§å°ï¼Œåœ¨ä¸‹é¢çš„FillPingPacketå‡½æ•°å°±æœ‰è¿™æ ·çš„å®ç°ã€‚ 2.1.2 C++ä»£ç å®ç°å®šä¹‰ ICMPã€ping é¦–éƒ¨networkprotocolheader.hå¤´æ–‡ä»¶ä¸­å®šä¹‰äº† IP åè®®ã€ICMP åè®®ç­‰åè®®çš„é¦–éƒ¨ç»“æ„ä½“ã€‚ 12345678910111213141516171819#pragma pack(1)#define __u8 unsigned char#define __u16 unsigned short#define __u32 unsigned longstruct icmp_common_hdr &#123; __u8 type; __u8 code; __u16 check; /*Other content start here. */&#125;;struct ping_header &#123; icmp_common_hdr common_hdr; __u16 id; __u16 seq; __u32 timestamp;&#125;;#pragma pack() ç¨‹åºæ‰§è¡Œå‚æ•°12345678910111213DECLARE_bool(h); // å¸®åŠ©DECLARE_bool(t); // pingæŒ‡å®šçš„ä¸»æœºç›´åˆ°åœæ­¢DECLARE_int(w); // ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(s); // å‘é€pingåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(l); // å‘é€ç¼“å†²åŒºå¤§å°DECLARE_int(i); // TTLDEFINE_bool(h, false, &quot;å¸®åŠ©&quot;);DEFINE_bool(t, false, &quot;pingæŒ‡å®šçš„ä¸»æœºç›´åˆ°åœæ­¢&quot;);DEFINE_int(w, 3000, &quot;ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(s, 3000, &quot;å‘é€pingåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(l, 32, &quot;å‘é€ç¼“å†²åŒºå¤§å°&quot;);DEFINE_int(i, 128, &quot;TTL&quot;); ping ç¨‹åºçš„æ‰§è¡Œå‚æ•°çš„å®šä¹‰å’Œè§£æç”± webrtc çš„&quot;rtc_base/flags.h&quot;æ”¯æŒã€‚ å®Œæ•´ä»£ç ä»£ç ä¸­çš„æŸäº›åŠŸèƒ½ï¼Œå¦‚å‚æ•°è§£æã€æ–­è¨€ã€æ—¶é—´æˆ³ç­‰åŸºäº webrtc çš„rtc_baseå®ç°ï¼Œè¿™äº›åŠŸèƒ½ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„è‡ªå·±å®ç°ã€‚ å¦å¤–ï¼Œä½¿ç”¨åŸå§‹å¥—æ¥å­—éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œå¦‚æœéœ€è¦ç»•å¼€ç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ windows æä¾›çš„IcmpSendEchoç³»åˆ—å‡½æ•°ã€‚ åœ¨å‘é€ ping è¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªå°è£…äº†ä¸€ä¸ª ICMP æŠ¥æ–‡ï¼Œå¹¶æ²¡æœ‰è‡ªå·±æ‰‹åŠ¨æ·»åŠ  IP å¤´ï¼Œå°è£… IP æŠ¥æ–‡ã€‚å› ä¸ºå†…æ ¸ä¼šè‡ªåŠ¨æ·»åŠ  IP å¤´ï¼Œå¦‚æœæƒ³è‡ªå·±æ·»åŠ  IP å¤´ï¼Œå¯ä»¥è°ƒç”¨setsockoptè®¾ç½®IP_HDRINCLé€‰é¡¹ï¼Œå‘Šè¯‰å†…æ ¸ç”±æˆ‘ä»¬è‡ªå·±æ¥å°è£… IP å¤´ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271#include &lt;WinSock2.h&gt;#include &lt;ws2spi.h&gt;#include &lt;ws2tcpip.h&gt;#include &quot;rtc_base/networkprotocolheader.h&quot;#include &quot;rtc_base/checks.h&quot;#include &quot;rtc_base/flags.h&quot;#include &quot;rtc_base/timeutils.h&quot;DECLARE_bool(h); // å¸®åŠ©DECLARE_bool(t); // pingæŒ‡å®šçš„ä¸»æœºç›´åˆ°åœæ­¢DECLARE_int(w); // ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(s); // å‘é€pingåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(l); // å‘é€ç¼“å†²åŒºå¤§å°DECLARE_int(i); // TTLDEFINE_bool(h, false, &quot;å¸®åŠ©&quot;);DEFINE_bool(t, false, &quot;pingæŒ‡å®šçš„ä¸»æœºç›´åˆ°åœæ­¢&quot;);DEFINE_int(w, 3000, &quot;ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(s, 3000, &quot;å‘é€pingåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(l, 32, &quot;å‘é€æ•°æ®å¤§å°&quot;);DEFINE_int(i, 128, &quot;TTL&quot;);void FillPingPacket(__u8* icmp_packet, __u16 seq, __u16 icmp_packet_size) &#123; RTC_DCHECK(icmp_packet); ping_hdr* pping_hdr = reinterpret_cast&lt;ping_hdr*&gt;(icmp_packet); pping_hdr-&gt;common_hdr.type = 8; pping_hdr-&gt;common_hdr.code = 0; pping_hdr-&gt;id = (__u16)GetCurrentProcessId(); pping_hdr-&gt;seq = seq; __u32 now = rtc::Time32(); memcpy((icmp_packet + sizeof(ping_hdr)), &amp;now, sizeof(__u32)); // fill some junk in the buffer. int junk_data_size = FLAG_l - sizeof(__u32); // timestamp int junk_offset = icmp_packet_size - junk_data_size; if(junk_data_size &gt; 0) memset((icmp_packet + junk_offset), &#x27;E&#x27;, junk_data_size); pping_hdr-&gt;common_hdr.check = 0; pping_hdr-&gt;common_hdr.check = rtc::GetCheckSum(reinterpret_cast&lt;__u16*&gt;(icmp_packet), icmp_packet_size);&#125;void DecodeIPPacket(__u8* ip_packet, __u16 packet_size) &#123; iphdr* ip_hdr = reinterpret_cast&lt;iphdr*&gt;(ip_packet); __u32 now = rtc::Time32(); __u16 ip_hdr_len = ip_hdr-&gt;ihl * 4; // bytes ping_hdr *pping_hdr = reinterpret_cast&lt;ping_hdr*&gt;(ip_packet + ip_hdr_len); if (pping_hdr-&gt;common_hdr.type != 0 || pping_hdr-&gt;common_hdr.code != 0) &#123; printf(&quot;non-echo response, type=%d, code=%d &quot;, pping_hdr-&gt;common_hdr.type, pping_hdr-&gt;common_hdr.code); return; &#125; if (pping_hdr-&gt;id != (__u16)GetCurrentProcessId()) &#123; printf(&quot;other process ping response packet, pid=%d &quot;, GetCurrentProcessId()); return; &#125; __u32 timestamp = 0; memcpy(&amp;timestamp, reinterpret_cast&lt;__u32*&gt;((__u8*)pping_hdr + sizeof(ping_hdr)), sizeof(__u32)); in_addr from; from.s_addr = ip_hdr-&gt;saddr; printf(&quot;%d bytes from %s, time &lt; %d ms, icmp_seq = %d, TTL = %d &quot;, packet_size - ip_hdr_len - sizeof(ping_hdr), inet_ntoa(from), now - timestamp, pping_hdr-&gt;seq, ip_hdr-&gt;ttl );&#125;int main(int argc, char**argv)&#123; rtc::FlagList::SetFlagsFromCommandLine(&amp;argc, argv, true); if (FLAG_h) &#123; rtc::FlagList::Print(NULL, false); return 1; &#125; char *hostname = argv[argc - 1]; if (!hostname || strlen(hostname) == 0) &#123; printf(&quot;Invalid host name &quot;); return 1; &#125; if (FLAG_l &lt;= 4) &#123; return 1; &#125; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); sockaddr_in from; int from_len = sizeof(sockaddr_in); sockaddr_in dest; memset(&amp;dest, 0, sizeof(sockaddr_in)); dest.sin_family = AF_INET; dest.sin_addr.s_addr = inet_addr(hostname); // resolve host name if (dest.sin_addr.s_addr == INADDR_NONE) &#123; unsigned long begin_time = rtc::Time32(); struct addrinfo* result = nullptr; struct addrinfo hints = &#123; 0 &#125;; hints.ai_family = AF_UNSPEC; hints.ai_flags = AI_ADDRCONFIG; int ret = getaddrinfo(hostname, nullptr, &amp;hints, &amp;result); if (ret != 0) &#123; printf(&quot;Resolve host name failed, error code = %d &quot;, ret); return 1; &#125; unsigned long end_time = rtc::Time32(); struct addrinfo* cursor = result; printf(&quot;------------------------------ &quot;); printf(&quot;Resolve [time &lt; %d ms]: &quot;, end_time - begin_time); bool flag = false; for (; cursor; cursor = cursor-&gt;ai_next) &#123; sockaddr_in *paddr_in = reinterpret_cast&lt;sockaddr_in *&gt;(cursor-&gt;ai_addr); printf(&quot;%s &quot;, inet_ntoa(paddr_in-&gt;sin_addr)); if (!flag) &#123; dest.sin_addr = paddr_in-&gt;sin_addr; flag = true; &#125; &#125; freeaddrinfo(result); printf(&quot;------------------------------- &quot;); &#125; printf(&quot;Ping %s [TTL %d]: &quot;, inet_ntoa(dest.sin_addr), FLAG_i); // socketå‡½æ•°éœ€è¦ç®¡ç†å‘˜æƒé™ // éœ€è¦ç»•å¼€ç®¡ç†å‘˜æƒé™ï¼Œå¯ä»¥ä½¿ç”¨IcmpSendEchoç³»åˆ—å‡½æ•° // SOCKET s = socket(AF_INET, SOCK_RAW, IPPROTO_ICMP); if (s == INVALID_SOCKET) &#123; printf(&quot;create socket failed, error code = %d &quot;, WSAGetLastError()); WSACleanup(); return 1; &#125; int err = setsockopt(s, SOL_SOCKET, SO_SNDTIMEO, reinterpret_cast&lt;const char*&gt;(&amp;FLAG_s), sizeof(FLAG_s)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for SO_SNDTIMEO failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; err = setsockopt(s, SOL_SOCKET, SO_RCVTIMEO, reinterpret_cast&lt;const char*&gt;(&amp;FLAG_w), sizeof(FLAG_w)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for SO_RCVTIMEO failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; err = setsockopt(s, IPPROTO_IP, IP_TTL, reinterpret_cast&lt;const char*&gt;(&amp;FLAG_i), sizeof(FLAG_i)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for IP_TTL failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; // ping request int icmp_packet_size = sizeof(ping_hdr) + FLAG_l; // data __u8 *icmp_packet = new __u8[icmp_packet_size]; RTC_DCHECK(icmp_packet); // ping response __u16 ip_packet_size = icmp_packet_size + 20; // 20 bytes ip header, no option. __u8 *ip_packet = new __u8[ip_packet_size]; RTC_DCHECK(ip_packet); if (!icmp_packet || !ip_packet) &#123; closesocket(s); WSACleanup(); return 1; &#125; __u16 i = 0; while (true) &#123; if (i == 0xFFFF) i = 0; i++; if (!FLAG_t) &#123; if(i &gt; 4) break; &#125; FillPingPacket(icmp_packet, i, icmp_packet_size); int sent = sendto(s, reinterpret_cast&lt;const char*&gt;(icmp_packet), icmp_packet_size, 0, reinterpret_cast&lt;const sockaddr*&gt;(&amp;dest), sizeof(sockaddr)); if (sent == SOCKET_ERROR) &#123; int gle = WSAGetLastError(); if (gle == WSAETIMEDOUT) &#123; printf(&quot;request timeout &quot;); continue; &#125; else &#123; printf(&quot;ping %s failed, error code = %d &quot;, inet_ntoa(dest.sin_addr), gle); break; &#125; &#125; if (sent &lt; FLAG_l) &#123; printf(&quot;warning, sent %d bytes &quot;, sent); &#125; int bread = recvfrom(s, reinterpret_cast&lt;char*&gt;(ip_packet), ip_packet_size, 0, reinterpret_cast&lt;sockaddr*&gt;(&amp;from), &amp;from_len); if (bread == SOCKET_ERROR) &#123; int gle = WSAGetLastError(); if (gle == WSAETIMEDOUT) &#123; printf(&quot;receive timeout &quot;); continue; &#125; else &#123; printf(&quot;ping %s failed, error code = %d &quot;, inet_ntoa(dest.sin_addr), gle); break; &#125; &#125; if (bread &lt; ip_packet_size) &#123; printf(&quot;too few bytes from %s &quot;, inet_ntoa(from.sin_addr)); continue; &#125; DecodeIPPacket(reinterpret_cast&lt;__u8*&gt;(ip_packet), ip_packet_size); Sleep(1000); &#125; delete [] icmp_packet; delete [] ip_packet; if (s != INVALID_SOCKET) &#123; closesocket(s); &#125; WSACleanup(); return 0;&#125; è¿è¡Œæ•ˆæœ 2.2 TracertTracert æ˜¯ windows ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œä½¿ç”¨è¯¥ç¨‹åºå¯ä»¥è®©æˆ‘ä»¬çœ‹åˆ° IP æ•°æ®æŠ¥ä»ä¸€å°ä¸»æœºåˆ°å¦ä¸€å°ä¸»æœºæ‰€ç»è¿‡çš„è·¯ç”±å™¨ã€‚Linux ç³»ç»Ÿä¹Ÿæä¾›äº†ç±»ä¼¼çš„å·¥å…·ï¼Œå« tracerouteï¼ŒåŠŸèƒ½å’Œ Tracert ä¸€æ ·ã€‚ 2.2.1 Tracert åŸç†åœ¨ä»‹ç» Tracert çš„åŸç†ä¹‹å‰ï¼Œéœ€è¦å…ˆå¼„æ¸…æ¥š IP é¦–éƒ¨ TTL å­—æ®µçš„å«ä¹‰ï¼ŒIP æŠ¥æ–‡æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œè·¯ç”±å™¨éƒ½ä¼šå°†è¯¥ IP æŠ¥æ–‡é¦–éƒ¨çš„ TTL å­—æ®µå‡ 1ï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°ä¸€ä»½ IP æ•°æ®æŠ¥çš„ TTL æ˜¯ 0 æˆ– 1 æ—¶ï¼Œè·¯ç”±å™¨æ­¤æ—¶ä¸ä¼šè½¬å‘è¯¥æ•°æ®æŠ¥ï¼Œè€Œä¼šä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œå¹¶ä¸”ç»™ IP æ•°æ®æŠ¥é¦–éƒ¨ä¸­çš„æºåœ°å€å‘é€ä¸€ä»½ ICMP è¶…æ—¶æŠ¥æ–‡ã€‚ IP é¦–éƒ¨çš„å®šä¹‰è§ï¼šç½‘ç»œåè®®(3)--IPåè®® Tracert åˆ©ç”¨äº†è·¯ç”±å™¨ä¼šä¸¢å¼ƒ TTL ä¸º 1 æˆ– 0 çš„æ•°æ®æŠ¥ä¸”è¿”å› ICMP è¶…æ—¶æŠ¥æ–‡çš„ç‰¹æ€§ï¼Œæ¥å®ç°ä¾¦æµ‹è·¯ç”±çš„åŠŸèƒ½ã€‚Tracert ç¨‹åºå…ˆå‘é€ TTL å€¼ä¸º 1 çš„ IP æ•°æ®æŠ¥ï¼Œå¤„ç†è¿™ä»½æ•°æ®æŠ¥çš„ç¬¬ä¸€ä¸ªè·¯ç”±å™¨å°† TTL å‡ 1ï¼Œä¸¢å¼ƒè¯¥æ•°æ®æŠ¥å¹¶è¿”å› ICMP è¶…æ—¶æŠ¥æ–‡ï¼Œè¿™æ ·ç¨‹åºå°±å¾—åˆ°äº†ç¬¬ä¸€ä¸ªè·¯ç”±å™¨çš„åœ°å€ï¼Œä»¥æ­¤æ–¹å¼ï¼Œé€’å¢ IP æ•°æ®æŠ¥ TTL çš„å€¼ï¼Œç›´åˆ°æ•°æ®æŠ¥æœ€ç»ˆåˆ°è¾¾ç›®æ ‡ä¸»æœºã€‚ é‚£ä¹ˆæ€ä¹ˆåˆ¤æ–­æ•°æ®æŠ¥åˆ°è¾¾äº†æœ€ç»ˆçš„ç›®æ ‡ä¸»æœºå‘¢ï¼Ÿæˆ‘ä»¬ä¸èƒ½å•çº¯çš„é€šè¿‡æœªæ”¶åˆ°è·¯ç”±å™¨è¿”å›çš„ ICMP å·®é”™æŠ¥æ–‡çš„æ–¹å¼æ¥åˆ¤æ–­æ•°æ®æŠ¥åˆ°è¾¾ç›®çš„åœ°äº†ï¼Œå› ä¸ºæœ‰å¯èƒ½æˆ‘ä»¬ç”±äºæ¥æ”¶ ICMP å·®é”™æŠ¥æ–‡è¶…æ—¶ç­‰åŸå› å¯¼è‡´æˆ‘ä»¬æ”¶ä¸åˆ° ICMP å·®é”™æŠ¥æ–‡ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åé¢ä¼šä»‹ç»æ¯ä¸€ä¸ª TTL è·ƒç‚¹ä¼šå‘é€ 3 æ¬¡æˆ–å¤šæ¬¡è¯·æ±‚çš„åŸå› ï¼‰ã€‚windows å¹³å°çš„ tracert ä¸ linux å¹³å°çš„ traceroute çš„å®ç°åŸç†ç¨æœ‰ä¸åŒï¼Œåˆ¤æ–­æ•°æ®æŠ¥åˆ°è¾¾ç›®æ ‡ä¸»æœºçš„æ–¹å¼ä¹Ÿæœ‰ä¸åŒã€‚tracert æ˜¯é€šè¿‡å‘é€ ping åŒ…ï¼Œå› ä¸º windows ç³»ç»Ÿå†…æ ¸éƒ½å®ç°äº† ping åŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚æœç›®çš„ä¸»æœºæ”¶åˆ°äº† ping è¯·æ±‚å°±ä¼šå›å¤ç›¸åº”çš„ ping åŒ…ï¼Œtracert å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥åˆ¤æ–­æ•°æ®æŠ¥æ˜¯å¦åˆ°è¾¾äº†ç›®æ ‡ä¸»æœºã€‚è€Œ traceroute æ˜¯é€šè¿‡å‘é€ UDP åŒ…ï¼ˆUDP ç«¯å£é€‰æ‹©ä¸€ä¸ªä¸å¯èƒ½ä½¿ç”¨çš„ UDP ç«¯å£ï¼Œæ¯”å¦‚å¤§äº 30000 çš„ç«¯å£ï¼‰ï¼Œå› ä¸ºç›®çš„ä¸»æœºæ²¡æœ‰ç›‘å¬è¯¥ç«¯å£ï¼Œæ‰€ä»¥ä¸ä¼šå“åº”æ¥æ”¶åˆ°çš„è¯¥ UDP è¯·æ±‚ï¼Œå› æ­¤å½“ UDP åŒ…åˆ°è¾¾æ—¶ï¼Œç›®æ ‡ä¸»æœºä¼šè¿”å›â€œç«¯å£ä¸å¯è¾¾â€çš„é”™è¯¯ï¼Œtraceroute å°±æ˜¯é€šè¿‡è¯¥é”™è¯¯æ¥åˆ¤æ–­ UDP åŒ…åˆ°è¾¾äº†ç›®çš„ä¸»æœºã€‚ ä»å®ç°æ–¹å¼æ¥çœ‹ï¼Œtraceroute é€šè¿‡ UDP çš„æ–¹å¼æ¥å®ç°æ›´åŠ ç¨³å®šå¯é ï¼Œå› ä¸ºå¤§å¤šæ•°ä¸»æœºçš„é˜²ç«å¢™ä¼šç»„ç»‡ ICMP æŠ¥æ–‡ï¼Œè€Œä¸ä¼šé˜»æ­¢ UDP æŠ¥æ–‡ã€‚ ä¸‹å›¾ä½¿ç”¨ wireshark æŠ“å–çš„tracert 192.168.3.76å‘½ä»¤çš„æ•°æ®åŒ…ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ° tracert æ˜¯é€šè¿‡å‘é€ ping åŒ…æ¥å®ç°çš„ï¼Œä»¥åŠæ¯ä¸ª ping åŒ…çš„ TTL é€’å¢è¿‡ç¨‹ï¼š 2.2.2 ICMP å·®é”™æŠ¥æ–‡æ ¼å¼è·¯ç”±å™¨åœ¨ä¸¢å¼ƒ TTL ä¸º 0 æˆ– 1 çš„æ•°æ®æŠ¥æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªä¸€ä»½ ICMP å·®é”™æŠ¥æ–‡ï¼Œè¯¥ ICMP çš„å·®é”™æŠ¥æ–‡çš„ type ä¸º 11, code ä¸º 0. type ä¸º 11 çš„æŠ¥æ–‡æ ¼å¼å¦‚ä¸‹ï¼ˆcode æœ‰ 0 å’Œ 1 ä¸¤ç§ï¼Œæ ¼å¼ä¸€æ ·ï¼‰ï¼š 2.2.3 å®ç°è¯¥ç¤ºä¾‹å’Œä¹‹å‰çš„ Ping ç¨‹åºçš„ç¤ºä¾‹æœ‰æ‰€ä¸åŒï¼Œè¯¥ç¤ºä¾‹è®¾ç½®äº†IP_HDRINCLé€‰é¡¹æ¥è‡ªå·±æ„é€  IP å¤´éƒ¨ã€‚ ç¨‹åºçš„å¯åŠ¨å‚æ•°ä½¿ç”¨ webrtc çš„&quot;rtc_base/flags.h&quot;å®ç°ã€‚ ä»£ç ä¸­çš„å…¶ä»–æŸäº›åŠŸèƒ½ï¼Œå¦‚æ–­è¨€ã€æ—¶é—´æˆ³ç­‰åŸºäº webrtc çš„rtc_baseå®ç°ï¼Œè¿™äº›åŠŸèƒ½ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„è‡ªå·±å®ç°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348#include &lt;WinSock2.h&gt;#include &lt;ws2spi.h&gt;#include &lt;ws2tcpip.h&gt;#include &lt;strsafe.h&gt;#include &lt;algorithm&gt;#include &quot;rtc_base/networkprotocolheader.h&quot;#include &quot;rtc_base/checks.h&quot;#include &quot;rtc_base/flags.h&quot;#include &quot;rtc_base/timeutils.h&quot;DECLARE_bool(h); // å¸®åŠ©DECLARE_int(m); // æœ€å¤§è·ƒç‚¹æ•°DECLARE_int(w); // ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(s); // å‘é€ICMPåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)DECLARE_int(n); // æ¯ä¸ªè·ƒç‚¹å‘é€çš„è¯·æ±‚æ•°DEFINE_bool(h, false, &quot;å¸®åŠ©&quot;);DEFINE_int(m, 30, &quot;æœ€å¤§è·ƒç‚¹æ•°&quot;);DEFINE_int(w, 3000, &quot;ç­‰å¾…æ¯æ¬¡å›å¤çš„è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(s, 3000, &quot;å‘é€ICMPåŒ…è¶…æ—¶æ—¶é—´(æ¯«ç§’)&quot;);DEFINE_int(n, 3, &quot;æ¯ä¸ªè·ƒç‚¹å‘é€çš„è¯·æ±‚æ•°&quot;);const int kPingDataSize = 36;__u32 kLocalIP = 0;__u32 GetLocalIPv4Address() &#123; return inet_addr(&quot;192.168.42.26&quot;); char hostname[MAX_PATH] = &#123; 0 &#125;; gethostname(hostname, MAX_PATH); struct hostent FAR* lpHostEnt = gethostbyname(hostname); if (lpHostEnt == NULL) &#123; return htonl(0x7f000001); //127.0.0.1 &#125; LPSTR lpAddr = lpHostEnt-&gt;h_addr_list[0]; struct in_addr addr; memcpy(&amp;addr, lpAddr, 4); return addr.s_addr;&#125;std::string IPv4ToString(__u32 ip) &#123; in_addr addr; addr.s_addr = ip; char *p= inet_ntoa(addr); if (p) return p; return &quot;&quot;;&#125;std::string GetPrintString(const char* fmt, ...) &#123; char buf[100]; va_list arglist; va_start(arglist, fmt); StringCchVPrintfA(buf, 100, fmt, arglist); va_end(arglist); return buf;&#125;bool print_ip(__u32* ips, int count, __u32 dest_ip) &#123; bool has_ip = false; bool trace_end = false; for (int i = 0; i &lt; count; i++) &#123; if (ips[i] != 0) &#123; printf(&quot; %s&quot;, IPv4ToString(ips[i]).c_str()); has_ip = true; trace_end = (ips[i] == dest_ip); &#125; &#125; if (!has_ip) printf(&quot; timeout&quot;); printf(&quot; &quot;); if (trace_end) printf(&quot;Trace Complete &quot;); return trace_end;&#125;void FillRequestIPPacket(__u8* ip_packet, __u16 ip_packet_size, __u16 seq, __u8 ttl, __u32 dest_addr) &#123; RTC_DCHECK(ip_packet); iphdr* p_iphdr = reinterpret_cast&lt;iphdr*&gt;(ip_packet); memset(p_iphdr, 0, sizeof(iphdr)); p_iphdr-&gt;version = 4; p_iphdr-&gt;ihl = sizeof(iphdr)/4; // no option p_iphdr-&gt;tos = 0; p_iphdr-&gt;frag_off = 0; p_iphdr-&gt;id = (__u16)rtc::Time32(); p_iphdr-&gt;ttl = ttl; p_iphdr-&gt;protocol = IPPROTO_ICMP; p_iphdr-&gt;tot_len = ip_packet_size; p_iphdr-&gt;daddr = dest_addr; p_iphdr-&gt;saddr = kLocalIP; p_iphdr-&gt;check = rtc::GetCheckSum(reinterpret_cast&lt;__u16*&gt;(p_iphdr), p_iphdr-&gt;ihl*4); ping_hdr* p_ping_hdr = reinterpret_cast&lt;ping_hdr*&gt;(ip_packet + p_iphdr-&gt;ihl*4); p_ping_hdr-&gt;common_hdr.type = 8; p_ping_hdr-&gt;common_hdr.code = 0; p_ping_hdr-&gt;id = (__u16)GetCurrentProcessId(); p_ping_hdr-&gt;seq = seq; // fill some junk in the buffer. if (kPingDataSize &gt; 0) memset((void*)((__u8*)p_ping_hdr+sizeof(ping_hdr)), &#x27;E&#x27;, kPingDataSize); p_ping_hdr-&gt;common_hdr.check = 0; p_ping_hdr-&gt;common_hdr.check = rtc::GetCheckSum(reinterpret_cast&lt;__u16*&gt;(p_ping_hdr), ip_packet_size - p_iphdr-&gt;ihl*4);&#125;// return source ip addressbool DecodeIPPacket(const __u8* ip_packet, __u16 ip_packet_size, __u32 send_time, __u32* src_addr) &#123; const iphdr* ip_hdr = reinterpret_cast&lt;const iphdr*&gt;(ip_packet); __u32 use_time = rtc::Time32() - send_time; __u16 ip_hdr_len = ip_hdr-&gt;ihl * 4; // bytes const icmp_common_hdr *icmp_hdr = reinterpret_cast&lt;const icmp_common_hdr*&gt;(ip_packet + ip_hdr_len); if (icmp_hdr-&gt;type == 0 &amp;&amp; icmp_hdr-&gt;code == 0) &#123; // å›æ˜¾åº”ç­” const ping_hdr *p_ping_hdr = reinterpret_cast&lt;const ping_hdr*&gt;(icmp_hdr); if (p_ping_hdr-&gt;id != (__u16)GetCurrentProcessId()) &#123; printf(&quot;other process ping response packet, pid=%d &quot;, GetCurrentProcessId()); return false; &#125; printf(&quot;%-10s&quot;, GetPrintString(&quot;&lt;%d ms&quot;, use_time == 0 ? 1 : use_time).c_str()); *src_addr = ip_hdr-&gt;saddr; return true; &#125; else if (icmp_hdr-&gt;type == 11 &amp;&amp; icmp_hdr-&gt;code == 0) &#123; // cause by ttl == 0 printf(&quot;%-10s&quot;, GetPrintString(&quot;&lt;%d ms&quot;, use_time == 0 ? 1 : use_time).c_str()); *src_addr = ip_hdr-&gt;saddr; return true; &#125; else &#123; printf(&quot;unexpected response, type=%d, code=%d &quot;, icmp_hdr-&gt;type, icmp_hdr-&gt;code); return false; &#125;&#125;#define SAFE_RELEASE \\if (req_ip_packet) &#123; \\delete[] req_ip_packet; \\ req_ip_packet = NULL;\\&#125;\\if (rsp_ip_packet) &#123; \\delete[] rsp_ip_packet; \\ rsp_ip_packet = NULL;\\&#125;\\if (s != INVALID_SOCKET) &#123;\\ closesocket(s);\\ s = INVALID_SOCKET;\\&#125;\\WSACleanup();int main(int argc, char**argv) &#123; rtc::FlagList::SetFlagsFromCommandLine(&amp;argc, argv, true); if (FLAG_h) &#123; rtc::FlagList::Print(NULL, false); return 1; &#125; char *hostname = argv[argc - 1]; if (!hostname || strlen(hostname) == 0) &#123; printf(&quot;Invalid host name &quot;); return 1; &#125; printf(&quot;Trace %s &quot;, hostname); WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); sockaddr_in from; int from_len = sizeof(sockaddr_in); kLocalIP = GetLocalIPv4Address(); sockaddr_in dest; memset(&amp;dest, 0, sizeof(sockaddr_in)); dest.sin_family = AF_INET; dest.sin_addr.s_addr = inet_addr(hostname); // resolve host name if (dest.sin_addr.s_addr == INADDR_NONE) &#123; unsigned long begin_time = rtc::Time32(); struct addrinfo* result = nullptr; struct addrinfo hints = &#123; 0 &#125;; hints.ai_family = AF_UNSPEC; hints.ai_flags = AI_ADDRCONFIG; int ret = getaddrinfo(hostname, nullptr, &amp;hints, &amp;result); if (ret != 0) &#123; printf(&quot;Resolve host name failed, error code = %d &quot;, ret); return 1; &#125; unsigned long end_time = rtc::Time32(); struct addrinfo* cursor = result; printf(&quot;------------------------------ &quot;); printf(&quot;Resolve [time &lt; %d ms]: &quot;, end_time - begin_time); bool flag = false; for (; cursor; cursor = cursor-&gt;ai_next) &#123; sockaddr_in *paddr_in = reinterpret_cast&lt;sockaddr_in *&gt;(cursor-&gt;ai_addr); printf(&quot;%s &quot;, inet_ntoa(paddr_in-&gt;sin_addr)); if (!flag) &#123; dest.sin_addr = paddr_in-&gt;sin_addr; flag = true; &#125; &#125; freeaddrinfo(result); printf(&quot;------------------------------- &quot;); &#125; printf(&quot;Tracing %s [%d max hops]: &quot;, inet_ntoa(dest.sin_addr), FLAG_m); SOCKET s = socket(AF_INET, SOCK_RAW, IPPROTO_ICMP); if (s == INVALID_SOCKET) &#123; printf(&quot;create socket failed, error code = %d &quot;, WSAGetLastError()); WSACleanup(); return 1; &#125; int err = setsockopt(s, SOL_SOCKET, SO_SNDTIMEO, reinterpret_cast&lt;const char*&gt;(&amp;FLAG_s), sizeof(FLAG_s)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for SO_SNDTIMEO failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; err = setsockopt(s, SOL_SOCKET, SO_RCVTIMEO, reinterpret_cast&lt;const char*&gt;(&amp;FLAG_w), sizeof(FLAG_w)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for SO_RCVTIMEO failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; int opt = 1; err = setsockopt(s, IPPROTO_IP, IP_HDRINCL, reinterpret_cast&lt;const char*&gt;(&amp;opt), sizeof(opt)); RTC_DCHECK(err != SOCKET_ERROR); if (err == SOCKET_ERROR) &#123; printf(&quot;setsockopt for IP_HDRINCL failed, error code = %d &quot;, WSAGetLastError()); closesocket(s); WSACleanup(); return 1; &#125; // ip packet for ping request. __u16 req_ip_packet_size = sizeof(iphdr) + sizeof(ping_hdr) + kPingDataSize; __u8 *req_ip_packet = new __u8[req_ip_packet_size]; memset(req_ip_packet, 0, req_ip_packet_size); // ip packet for icmp response or ping echo. __u16 rsp_ip_packet_size = // ICMPå·®é”™æŠ¥æ–‡çš„å¤§å° sizeof(iphdr) + sizeof(icmp_common_hdr) // ICMP(type=11,code=0æˆ–1)å·®é”™æŠ¥æ–‡ + 4 // unused + sizeof(iphdr) + 8; //å–pingåŒ…å¤§å°å’ŒICMPå·®é”™æŠ¥æ–‡å¤§å°çš„æœ€å¤§å€¼ï¼Œä¿è¯æ— è®ºè¿”å›å“ªç§æŠ¥æ–‡ç¼“å†²åŒºéƒ½å¤Ÿç”¨ï¼Œ //ä¹Ÿå¯ä»¥ç›´æ¥åˆ†é…ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å†²åŒºï¼Œå¦‚1024 // rsp_ip_packet_size = std::max(rsp_ip_packet_size, req_ip_packet_size); __u8 *rsp_ip_packet = new __u8[rsp_ip_packet_size]; memset(rsp_ip_packet, 0, rsp_ip_packet_size); RTC_DCHECK(rsp_ip_packet); int ttl = 1; int seq = 0; __u32 *ips = new __u32[FLAG_n]; for(int hop = 1; hop &lt;= FLAG_m; hop++) &#123; printf(&quot; %-4d&quot;, hop); for (int i = 0; i &lt; FLAG_n; i++) &#123; ips[i] = 0; seq++; FillRequestIPPacket(req_ip_packet, req_ip_packet_size, seq, ttl, dest.sin_addr.s_addr); __u32 send_time = rtc::Time32(); int sent = sendto(s, reinterpret_cast&lt;const char*&gt;(req_ip_packet), req_ip_packet_size, 0, reinterpret_cast&lt;const sockaddr*&gt;(&amp;dest), sizeof(sockaddr)); if (sent == SOCKET_ERROR) &#123; printf(&quot;%-10s&quot;, &quot;*&quot;); if (i == FLAG_n - 1) if (print_ip(ips, FLAG_n, dest.sin_addr.s_addr)) &#123; SAFE_RELEASE; return 0; &#125; continue; &#125; int bread = recvfrom(s, reinterpret_cast&lt;char*&gt;(rsp_ip_packet), rsp_ip_packet_size, 0, reinterpret_cast&lt;sockaddr*&gt;(&amp;from), &amp;from_len); if (bread == SOCKET_ERROR) &#123; int gle = WSAGetLastError(); printf(&quot;%-10s&quot;, &quot;*&quot;); if (i == FLAG_n - 1) if (print_ip(ips, FLAG_n, dest.sin_addr.s_addr)) &#123; SAFE_RELEASE; return 0; &#125; continue; &#125; __u32 dest_ip = 0; DecodeIPPacket(reinterpret_cast&lt;const __u8*&gt;(rsp_ip_packet), rsp_ip_packet_size, send_time, &amp;dest_ip); ips[i] = dest_ip; if (i == FLAG_n - 1) if (print_ip(ips, FLAG_n, dest.sin_addr.s_addr)) &#123; SAFE_RELEASE; return 0; &#125; &#125; ttl++; &#125; SAFE_RELEASE; return 0;&#125; 2.2.4 è¿è¡Œæ•ˆæœï¼š æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["ICMP","Ping"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ç½‘ç»œåè®®(3)--IPåè®®","path":"/post/2274025898.html","content":"IP åè®®æ˜¯ TCP/IP åè®®æ—ä¸­æœ€æ ¸å¿ƒçš„åè®®ã€‚æ‰€æœ‰çš„ TCPã€UDPã€ICMPã€IGMP æ•°æ®éƒ½ä»¥ IP æ•°æ®æŠ¥çš„æ ¼å¼ä¼ è¾“ã€‚ IP åè®®æ˜¯ä¸å¯é ã€æ— è¿æ¥çš„ï¼š ä¸å¯é è¡¨ç¤º IP åè®®ä¸èƒ½ä¿è¯ IP æ•°æ®æŠ¥èƒ½æˆåŠŸçš„åˆ°è¾¾ç›®çš„åœ°ã€‚IP ä»…æä¾›ä¼ è¾“æœåŠ¡ï¼Œä»»ä½•å¯é æ€§çš„è¦æ±‚éƒ½å¿…é¡»ç”±ä¸Šå±‚æ¥æä¾›ï¼ˆå¦‚ TCPï¼‰ã€‚å¦‚æœä¼ è¾“è¿‡ç¨‹å‘ç”Ÿé”™è¯¯ï¼ŒIP åè®®ç®€å•çš„ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥ï¼Œç„¶åå‘é€ ICMP æ¶ˆæ¯ç»™å‘é€ç«¯ã€‚ æ— è¿æ¥è¡¨ç¤º IP åè®®ä¸ç»´æŠ¤ä»»ä½•å…³äºåç»­æ•°æ®æŠ¥çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯ä¸ªæ•°æ®æŠ¥éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚è¿™ä¹Ÿè¯´æ˜ï¼ŒIP æ•°æ®æŠ¥å¯èƒ½ä¸æ˜¯æŒ‰ç…§å‘é€é¡ºåºè¢«æ¥æ”¶åˆ°çš„ï¼Œå¾ˆæœ‰å¯èƒ½åå‘é€çš„æ•°æ®è¢«å…ˆæ”¶åˆ°ã€‚ ä¸€ã€IP é¦–éƒ¨IP æ•°æ®æŠ¥çš„æ ¼å¼å¦‚å›¾ï¼š 4 ä½ç‰ˆæœ¬ï¼šæ ‡è¯†ç›®å‰é‡‡ç”¨çš„ IP åè®®çš„ç‰ˆæœ¬å·ã€‚IPv4 ä¸º 0100, IPv6 ä¸º 0110 4 ä½é¦–éƒ¨é•¿åº¦ï¼šç”¨äºæ ‡è¯†é¦–éƒ¨çš„é•¿åº¦ï¼Œå•ä½ä¸º4 å­—èŠ‚ï¼Œæ‰€ä»¥é¦–éƒ¨çš„æœ€å¤§é•¿åº¦ä¸º15*4å­—èŠ‚=60å­—èŠ‚ã€‚ 8 ä½æœåŠ¡ç±»å‹ï¼šåŒ…æ‹¬ 3bit çš„ä¼˜å…ˆæƒå­—æ®µï¼ˆå·²è¢«å¿½ç•¥ï¼‰ï¼Œ4bit çš„ TOS å­—æ®µï¼Œ1bit çš„å§‹ç»ˆä¸º 0 çš„æœªä½¿ç”¨ä½ã€‚ 16 ä½æ€»é•¿åº¦(å­—èŠ‚æ•°)ï¼šæ•´ä¸ª IP æ•°æ®æŠ¥çš„é•¿åº¦ã€‚æ•°æ®æŠ¥ä¸­æ•°æ®å†…å®¹çš„é•¿åº¦=æ€»é•¿åº¦ - é¦–éƒ¨é•¿åº¦ 16 ä½æ ‡è¯†ï¼šå”¯ä¸€åœ°æ ‡è¯†ä¸»æœºå‘é€çš„æ¯ä¸€ä»½æ•°æ®æŠ¥ã€‚IP æ•°æ®æŠ¥çš„æœ€å¤§é•¿åº¦å¯è¾¾ 65535 å­—èŠ‚ï¼Œä½†å¤§å¤šæ•°é“¾è·¯å±‚éƒ½ä¼šå¯¹å®ƒè¿›è¡Œåˆ†ç‰‡ã€‚ç”±äº TCP æœ¬èº«ä¼šæŠŠç”¨æˆ·æ•°æ®åˆ†æˆè‹¥å¹²ç‰‡ï¼Œå› æ­¤è¿™ä¸ªå­—æ®µä¸€èˆ¬æ¥è¯´ä¸ä¼šå½±å“åˆ° TCPã€‚ 3 ä½æ ‡å¿—ï¼šç”¨äº IP æ•°æ®æŠ¥åˆ†ç‰‡ã€‚è¯¥å­—æ®µç¬¬ 1bit ä¸ä½¿ç”¨ï¼Œç¬¬ 2bit æ˜¯ DF(Don't Fragment)ä½ï¼ŒDF ä½è®¾ä¸º 1 æ—¶è¡¨æ˜ IP ä¸å¯¹è¯¥æ•°æ®åŒ…åˆ†ç‰‡ã€‚ç¬¬ 3bit æ˜¯ MF(More Fragments)ä½ï¼Œå½“å¯¹æ•°æ®åŒ…åˆ†ç‰‡æ—¶ï¼Œé™¤äº†æœ€åä¸€ç‰‡å¤–ï¼Œå…¶ä»–æ¯ä¸ªç»„æˆæ•°æ®æŠ¥çš„ç‰‡éƒ½è¦æŠŠæ­¤ä½è®¾ä¸º 1ã€‚ 13 ä½åç§»ï¼šç”¨äº IP æ•°æ®æŠ¥åˆ†ç‰‡ã€‚å•ä½ä¸º 8 å­—èŠ‚ã€‚è¡¨ç¤ºè¯¥ç‰‡ç›¸å¯¹äºåŸå§‹æ•°æ®æŠ¥å¼€å§‹å¤„çš„ä½ç½®ï¼Œèƒ½è¡¨ç¤ºçš„æœ€å¤§åç§»ä¸º*8=65536 å­—èŠ‚ã€‚ å¦å¤–ï¼Œæ•°æ®æŠ¥è¢«åˆ†ç‰‡ä¹‹åï¼Œæ¯ä¸ªç‰‡çš„æ€»é•¿åº¦è¦æ›´æ”¹ä¸ºè¯¥ç‰‡çš„é•¿åº¦å€¼ã€‚IP å±‚åˆ†ç‰‡æ˜¯é€æ˜çš„ï¼Œä½†æ˜¯å³ä½¿åªä¸¢å¤±ä¸€ç‰‡æ•°æ®ä¹Ÿè¦é‡ä¼ æ•´ä¸ªæ•°æ®æŠ¥ï¼Œå› ä¸º IP å±‚æœ¬èº«æ²¡æœ‰è¶…æ—¶é‡ä¼ çš„æœºåˆ¶ã€‚ 8 ä½ç”Ÿå­˜æ—¶é—´(TTL)ï¼šè®¾ç½®æ•°æ®æŠ¥å¯ä»¥ç»è¿‡çš„æœ€å¤šè·¯ç”±å™¨æ•°é‡ï¼Œæ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼Œè¯¥å€¼å°±å‡å» 1ã€‚å½“è¯¥å€¼ä¸º 0 æ—¶ï¼Œæ•°æ®æŠ¥å°±è¢«ä¸¢å¼ƒã€‚é€šå¸¸åˆå§‹å€¼ä¸º 32 æˆ– 64. 8 ä½åè®®ï¼šè¡¨ç¤ºä¸Šå±‚ä¼ è¾“å±‚æ‰€ç”¨çš„åè®®ç±»å‹ã€‚1 è¡¨ç¤º ICMP åè®®ï¼Œ2 è¡¨ç¤º IGMP åè®®ï¼Œ6 è¡¨ç¤º TCP åè®®ï¼Œ17 è¡¨ç¤º UDP åè®®ã€‚ 16 ä½é¦–éƒ¨æ ¡éªŒå’Œï¼šç”¨äºå¯¹ IP é¦–éƒ¨çš„æ­£ç¡®æ€§è¿›è¡Œæ ¡éªŒï¼Œä½†ä¸åŒ…æ‹¬æ•°æ®éƒ¨åˆ†ï¼Œè¿™ç‚¹ä¸åŒäº TCP å’Œ UDP çš„é¦–éƒ¨æ ¡éªŒå’Œã€‚ 32 ä½æº IP åœ°å€ï¼šå‘é€ç«¯çš„ 32bit çš„ IP åœ°å€ã€‚ 32 ä½ç›®çš„ IP åœ°å€ï¼šæ¥æ”¶ç«¯çš„ 32bit çš„ IP åœ°å€ã€‚ é€‰é¡¹ï¼šå¯å˜é•¿åº¦çš„å¯é€‰ä¿¡æ¯ã€‚å¦‚æœé¦–éƒ¨ä¸å«â€œé€‰é¡¹å­—æ®µâ€ï¼Œåˆ™ IP é¦–éƒ¨é•¿åº¦ä¸º 20 å­—èŠ‚ã€‚ äºŒã€IP é¦–éƒ¨æ ¡éªŒå’Œ å‘é€ç«¯å¯¹ IP æ•°æ®æŠ¥çš„æ ¡éªŒå’Œçš„è®¡ç®—æ­¥éª¤ï¼š æŠŠ IP æ•°æ®æŠ¥çš„æ ¡éªŒå’Œå­—æ®µç½®ä¸º 0ï¼› æŠŠé¦–éƒ¨çœ‹æˆä»¥ 16 ä½ä¸ºå•ä½çš„æ•°å­—ç»„æˆï¼Œä¾æ¬¡è¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œï¼› æŠŠæ±‚å’Œå¾—åˆ°çš„ç»“æœå–åã€‚ å°†ç¬¬ 2ã€3 æ­¥å¾—åˆ°çš„ 2 ä¸ªå­—èŠ‚æ•°æ®å­˜å…¥é¦–éƒ¨æ ¡éªŒå’Œã€‚ æ¥æ”¶ç«¯å¯¹ IP æ•°æ®æŠ¥çš„æ ¡éªŒå’Œçš„æ ¡éªŒæ­¥éª¤ï¼š æŠŠé¦–éƒ¨çœ‹æˆä»¥ 16 ä½ä¸ºå•ä½çš„æ•°å­—ç»„æˆï¼Œä¾æ¬¡è¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œï¼› æŠŠæ±‚å’Œå¾—åˆ°çš„ç»“æœå–åç ã€‚ å¦‚æœç»“æœä¸º 0ï¼Œåˆ™è¡¨ç¤ºæ£€éªŒå’Œæ ¡éªŒé€šè¿‡ï¼ŒIP æŠ¥æ–‡æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚ ä¸‰ã€ä½¿ç”¨ä»£ç è®¡ç®—æ ¡éªŒå’Œé€šè¿‡ wireshark æŠ“å–ä¸€å¸§æ•°æ®æŠ¥ï¼Œå¦‚å›¾ï¼š ä»¥è¯¥æ•°æ®æŠ¥çš„ IP é¦–éƒ¨ä¸ºåŸºç¡€ï¼Œä½¿ç”¨ C++ä»£ç æ¥éªŒè¯ IP é¦–éƒ¨æ ¡éªŒå’Œçš„è®¡ç®—æ­¥éª¤å’Œæ ¡éªŒæ­¥éª¤ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100#include &lt;assert.h&gt;// GetChecksumå‡½æ•°ç”¨äºå®ç°ä¸Šé¢æ‰€è¯´çš„è®¡ç®—æ­¥éª¤ä¸­çš„ç¬¬2æ­¥ã€ç¬¬3æ­¥ï¼š// æŠŠé¦–éƒ¨çœ‹æˆä»¥16ä½ï¼ˆ2å­—èŠ‚ï¼‰ä¸ºå•ä½çš„æ•°å­—ç»„æˆï¼Œä¾æ¬¡è¿›è¡ŒäºŒè¿›åˆ¶åç æ±‚å’Œï¼Œ// ä½†å®é™…çš„ç®—æ³•å®ç°ä¸Šéœ€è¦è€ƒè™‘å–å’Œæº¢å‡ºæ—¶çš„æ”¹è¿›è®¡ç®—æ–¹æ³•ï¼ˆè§å‡½æ•°å†…éƒ¨æ³¨é‡Šï¼‰//unsigned short GetChecksum(unsigned short* ip_header, int size) { assert(sizeof(unsigned short) == 2); // ä¸ºä»€ä¹ˆä½¿ç”¨unsigned longï¼ˆ4å­—èŠ‚ï¼‰ï¼Ÿ // å› ä¸ºè™½ç„¶é¦–éƒ¨æ ¡éªŒå’Œåªå 16ä½ï¼ˆ2ä¸ªå­—èŠ‚ï¼‰ï¼Œä½†æ‰§è¡Œâ€œä»¥16ä½ï¼ˆ2å­—èŠ‚ï¼‰ä¸ºå•ä½çš„äºŒè¿›åˆ¶åç æ•°æ®â€æ±‚å’Œæ“ä½œå¾—åˆ°çš„checksumå¯èƒ½ä¼šè¶…è¿‡16ä½ï¼ˆ2å­—èŠ‚ï¼‰ï¼Œ // æ‰€ä»¥è¿™é‡Œç”¨4ä¸ªå­—èŠ‚çš„unsigned longæ¥æ¥æ”¶ç›¸åŠ å¾—åˆ°çš„ç»“æœï¼Œåé¢å†è¿›è¡Œå¤„ç†ã€‚ // unsigned long checksum = 0; while (size &gt; 1) { checksum += *ip_header; // å› ä¸ºéƒ½æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥åç ä¸åŸç ç›¸åŒï¼›æ•…ç›´æ¥ç›¸åŠ æ±‚å’Œ ip_header++; // ip_headerä¸ºunsigned shortç±»å‹çš„æŒ‡é’ˆæ¯æ¬¡æŒ‰2ä¸ªå­—èŠ‚ç›¸åŠ  size -= 2; } // æ‰§è¡Œåˆ°è¿™ï¼šchecksum = 0x2850c // IPé¦–éƒ¨å¦‚æœä¸åŒ…å«â€œé€‰é¡¹â€å­—æ®µï¼Œåˆ™ä¸º20å­—èŠ‚ï¼Œå¶æ•°ï¼›å¦‚æœåŒ…å«äº†â€œé€‰é¡¹â€ï¼Œåˆ™å­—èŠ‚æ•°å°±å¯èƒ½ä¸ºå¥‡æ•°äº†ï¼Œ // è¿™é‡Œé’ˆå¯¹å­—èŠ‚æ•°ä¸ºå¥‡æ•°çš„æƒ…å†µè¿›è¡Œå¤„ç†ã€‚ // æ³¨ï¼šç¤ºä¾‹mainå‡½æ•°ä¸­æ„é€ çš„ip_headerä¸å«æœ‰â€œé€‰é¡¹â€ // if (size == 1) { checksum += *(unsigned char*)ip_header; } // å› ä¸ºä¸Šé¢ç›¸åŠ ä¹‹åçš„ç»“æœå¤§äº2ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ‰§è¡Œé¢å¤–çš„å¤„ç†æ­¥éª¤ï¼š // checksum &gt;&gt; 16 å³ç§»16ä½ // å³é™¤ä»¥2çš„16æ¬¡æ–¹ï¼ˆ0xffffï¼‰ï¼Œå°±æ˜¯å»é™¤å³è¾¹çš„2ä¸ªå­—èŠ‚ï¼Œå¦‚ï¼š0x2850c &gt;&gt; 16 = 0x2 // // checksum &amp; 0xffff ä½è¿ç®—ï¼Œå¾—åˆ°å2ä¸ªå­—èŠ‚ // å¦‚ï¼š0x2850c &amp; 0xffff = 0x850c // // checksum = 0x2 + 0x850c = 0x850e // checksum = (checksum &gt;&gt; 16) + (checksum &amp; 0xffff); // å‡å¦‚è¿˜å¤§äº2ä¸ªå­—èŠ‚ï¼Œå†æ¬¡å°†å¤šä½™çš„å­—èŠ‚å’Œchecksumç›¸åŠ ã€‚ checksum += (checksum &gt;&gt; 16); // æ±‚å’Œå¾—åˆ°çš„ç»“æœçš„å–å return (unsigned short)(~checksum);}int main(){ // å°†ä¸Šé¢wirksharkæŠ“çš„æ•°æ®åŒ…çš„IPå¤´éƒ¨ï¼Œä½¿ç”¨charæ•°ç»„ï¼ŒæŒ‰å­—èŠ‚æ„é€ å‡ºæ¥ // unsigned char ip_header[20] = { 0x45, // 4ä½ç‰ˆæœ¬+4ä½é¦–éƒ¨é•¿åº¦ 0x00, // 8ä½æœåŠ¡ç±»å‹ï¼ˆTOSï¼‰ 0x00, 0x1c, // 16ä½æ€»é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ 0x50, 0xaa, // 16ä½æ ‡è¯† 0x00, 0x00, // 3ä½æ ‡å¿—+13ä½ç‰‡åç§» 0xff, // 8ä½ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ 0x01, // 8ä½åè®® 0xf1, 0x7a, // 16ä½é¦–éƒ¨æ ¡éªŒå’Œ 0xc0, 0xa8, 0x2e, 0x55, // 32ä½æºIPåœ°å€ 0xee, 0x73, 0x9c, 0x4a // 32ä½ç›®çš„IPåœ°å€ }; // ç¬¬1æ­¥ï¼šæŠŠIPæ•°æ®åŒ…çš„æ ¡éªŒå’Œå­—æ®µç½®ä¸º0ï¼› // ip_header[10] = 0x00; ip_header[11] = 0x00; // ç¬¬2ã€3æ­¥è®¡ç®—æ ¡éªŒå’Œ // unsigned short checksum = GetChecksum((unsigned short*)ip_header, sizeof(ip_header)); printf(\"%02hhx %02hhx \", *(char*)(&amp;checksum), *((char*)(&amp;checksum) + 1)); // ç¬¬4æ­¥ï¼šå°†ç¬¬2ã€3æ­¥å¾—åˆ°çš„2ä¸ªå­—èŠ‚æ•°æ®å­˜å…¥é¦–éƒ¨æ ¡éªŒå’Œ // ip_header[10] = *(char*)(&amp;checksum); ip_header[11] = *((char*)(&amp;checksum) + 1); // æ¨¡æ‹Ÿæ¥æ”¶åˆ°IPåŒ…ä¹‹åï¼Œå¯¹IPé¦–éƒ¨çš„æ ¡éªŒå’Œè¿›è¡Œæ ¡éªŒ // unsigned short checksum_check = GetChecksum((unsigned short*)ip_header, sizeof(ip_header)); if (checksum_check == 0) { printf(\"checksum check successful! \"); } else { printf(\"checksum check failed! \"); } return 0;} å››ã€IP æ ¡éªŒå’Œçš„è®¾è®¡åŸç†æˆ‘ä»¬å°† IP é¦–éƒ¨è¿›è¡Œç®€åŒ–æ¥è®²è§£ IP æ ¡éªŒå’Œçš„è®¾è®¡åŸç†ï¼Œå‡è®¾ IP é¦–éƒ¨åªæœ‰ 6 ä¸ªå­—èŠ‚ï¼Œç¬¬ 5,6 å­—èŠ‚å­˜æ”¾æ ¡éªŒå’Œï¼š è®¡ç®—æ ¡éªŒå’Œæ—¶ç¬¬ 5,6 å­—èŠ‚ç½®ä¸º 0ï¼Œæ ¡éªŒå’Œç­‰äºï¼šA+B+0ï¼Œç„¶åå–åï¼Œå³ï¼š æ¥æ”¶ç«¯æ”¶åˆ°ä¹‹åæ ¡éªŒæ­¥éª¤ä¸ºï¼šæ±‚æ ¡éªŒå’Œï¼ˆä¸åŒçš„æ˜¯ï¼šæ ¡éªŒå’Œä½ä¸ç½® 0ï¼‰ï¼Œè‹¥æ­¤æ—¶æ±‚å¾—æ ¡éªŒå’Œä¸º 0ï¼Œåˆ™æ ¡éªŒé€šè¿‡ã€‚å³ï¼š äº”ã€IP åœ°å€ç›¸å…³æ“ä½œæœ¬èŠ‚ä»‹ç»åœ¨ç½‘ç»œç¼–ç¨‹ä¸­æ¶‰åŠåˆ°çš„ä¸ IP åœ°å€ç›¸å…³çš„æ“ä½œ struct in_addr1234567891011121314151617// sizeof(in_addr) == sizeof(ULONG) == 4//typedef struct in_addr { union { struct { UCHAR s_b1,s_b2,s_b3,s_b4; } S_un_b; struct { USHORT s_w1,s_w2; } S_un_w; ULONG S_addr; // 4ä¸ªå­—èŠ‚ï¼ŒæŒ‰ç½‘ç»œå­—èŠ‚åºåˆ—å­˜å‚¨ // å¯ä»¥ä½¿ç”¨inet_addrå‡½æ•°å°†IPæ ¼å¼å­—ç¬¦ä¸²è½¬ä¸ºç½‘ç»œå­—èŠ‚åºåˆ—çš„æ•´æ•°ã€‚ } S_un;// å®šä¹‰çš„ä¸€äº›å®ï¼Œæ–¹ä¾¿è®¿é—®ç»“æ„ä½“æˆå‘˜#define s_addr S_un.S_addr /* can be used for most tcp &amp; ip code */#define s_host S_un.S_un_b.s_b2 // host on imp#define s_net S_un.S_un_b.s_b1 // network#define s_imp S_un.S_un_w.s_w2 // imp#define s_impno S_un.S_un_b.s_b4 // imp ##define s_lh S_un.S_un_b.s_b3 // logical host} IN_ADDR, *PIN_ADDR, FAR *LPIN_ADDR; struct sockaddr_in1234567// sizeof(sockaddr_in) == 16struct sockaddr_in { short sin_family; u_short sin_port; struct in_addr sin_addr; char sin_zero[8];}; struct sockaddr123456// sizeof(sockaddr) == 16//struct sockaddr { u_short sa_family; /* address family */ char sa_data[14]; /* up to 14 bytes of direct address */}; 5.1 è½¬æ¢å‡½æ•° webrtc ä¸­çš„IPAddressç±»å’ŒSocketAddressç±»ï¼Œå¯¹ç½‘ç»œåœ°å€çš„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ï¼Œå€¼å¾—å‚è€ƒã€‚ 5.1.1 IP å­—ç¬¦ä¸² -&gt; æ•´æ•°123unsigned long inet_addr( _In_ const char *cp); å°†ç±»ä¼¼127.0.0.1è¿™æ ·çš„ IP å­—ç¬¦ä¸²è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºåˆ—çš„æ•´æ•° 5.1.2 æ•´æ•° -&gt; IP å­—ç¬¦ä¸²123char* FAR inet_ntoa( _In_ struct in_addr in); å°† in_addrï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºç½‘ç»œå­—èŠ‚åºåˆ—æ•´æ•°ï¼‰è½¬æ¢ä¸º IP å­—ç¬¦ä¸²ã€‚ 5.2 å­—èŠ‚åºåˆ—è½¬æ¢123456htonshtonlntohsntohlhtonllntohll å¯¹æ•´æ•°ï¼ˆshortã€longã€longlongï¼‰è¿›è¡Œç½‘ç»œå­—èŠ‚åºåˆ—å’Œä¸»æœºå­—èŠ‚åºåˆ—é—´çš„è½¬æ¢æ“ä½œã€‚ä»¥ htons ä¸ºä¾‹ï¼šhæ˜¯ host çš„é¦–å­—æ¯ï¼Œè¡¨ç¤ºä¸»æœºå­—èŠ‚åºåˆ—ï¼›næ˜¯ network çš„é¦–å­—æ¯ï¼Œè¡¨ç¤ºç½‘ç»œå­—èŠ‚åºåˆ—ï¼›sä»£è¡¨ shortï¼›æ‰€ä»¥ htons çš„åŠŸèƒ½æ˜¯ï¼Œå°† short ä»ä¸»æœºå­—èŠ‚åºåˆ—è½¬ä¸ºç½‘ç»œå­—èŠ‚åºåˆ—ã€‚ å­—èŠ‚åºåˆ—å¯ä»¥å‚è€ƒï¼šhttp://blog.csdn.net/china_jeffery/article/details/78401731 5.3 è·å–æœ¬æœº IP åœ°å€5.3.1 ä½¿ç”¨ gethostbynameè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¼Šç«¯ï¼šåªèƒ½è·å–ä¸€ä¸ªç½‘å¡çš„ IP åœ°å€ã€‚ 123456789101112131415unsigned long GetLocalIPv4Address() { char hostname[MAX_PATH] = { 0 }; gethostname(hostname, MAX_PATH); struct hostent FAR* lpHostEnt = gethostbyname(hostname); if (lpHostEnt == NULL) { return htonl(0x7f000001); //127.0.0.1 } LPSTR lpAddr = lpHostEnt-&gt;h_addr_list[0]; struct in_addr addr; memcpy(&amp;addr, lpAddr, 4); return addr.s_addr;} 5.3.2 ä½¿ç”¨ GetAdaptersInfoè¯¥æ–¹å¼å¯ä»¥è·å–æœ¬æœºå¤šå—ç½‘å¡çš„ä¿¡æ¯ï¼ˆä¸é™äº IP åœ°å€ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;windows.h&gt;#include &lt;Iphlpapi.h&gt;#include &lt;string&gt;#include &lt;vector&gt;#pragma comment(lib,\"Iphlpapi.lib\")bool GetLocalAddress(std::vector&lt;std::string&gt; &amp;ip_list) { PIP_ADAPTER_INFO pIpAdapterInfo = new IP_ADAPTER_INFO(); unsigned long stSize = sizeof(IP_ADAPTER_INFO); int nRet = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize); if (ERROR_BUFFER_OVERFLOW == nRet) { delete pIpAdapterInfo; pIpAdapterInfo = (PIP_ADAPTER_INFO)new BYTE[stSize]; nRet = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize); } if (ERROR_SUCCESS != nRet) { if (pIpAdapterInfo) { delete pIpAdapterInfo; } return false; } while (pIpAdapterInfo) { IP_ADDR_STRING *pIpAddrString = &amp;(pIpAdapterInfo-&gt;IpAddressList); switch (pIpAdapterInfo-&gt;Type) { case MIB_IF_TYPE_OTHER: case MIB_IF_TYPE_ETHERNET: case MIB_IF_TYPE_TOKENRING: case MIB_IF_TYPE_FDDI: case MIB_IF_TYPE_PPP: case MIB_IF_TYPE_LOOPBACK: case MIB_IF_TYPE_SLIP: { std::string address = pIpAddrString-&gt;IpAddress.String; if (\"0.0.0.0\" == address) break; ip_list.push_back(address); break; } default: break; } pIpAdapterInfo = pIpAdapterInfo-&gt;Next; } if (pIpAdapterInfo) { delete pIpAdapterInfo; } return true;} ã€ŠTCP/IP è¯¦è§£ å· 1ï¼šåè®®ã€‹åœ¨çº¿é˜…è¯»åœ°å€ï¼šhttp://www.52im.net/topic-tcpipvol1.html æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["IP"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ç½‘ç»œåè®®(2)--ARPå’ŒRARPåè®®","path":"/post/3034381124.html","content":"ARP(Address Resolution Protocol)åœ°å€è§£æåè®®ï¼Œä½äº TCP&#x2F;IP åè®®æ ˆä¸­çš„é“¾è·¯å±‚ã€‚ å½“å±€åŸŸç½‘å†…ä¸»æœºé—´ï¼ˆæˆ–è€…æ˜¯ä¸»æœºä¸ç½‘å…³é—´ï¼‰éœ€è¦é€šä¿¡æ—¶ï¼Œé€šè¿‡ä½¿ç”¨ARPåè®®è·å–ç›®æ ‡IPåœ°å€æ‰€å¯¹åº”çš„ç¡¬ä»¶MACåœ°å€ï¼Œç„¶åä¸»æœºé—´é€šè¿‡è¯¥MACåœ°å€å®Œæˆæ•°æ®åŒ…å‘é€å’Œæ¥æ”¶ã€‚ ä¸€ã€ARP åè®®1.1 ARP åè®®ä»‹ç»é€šè¿‡ä½¿ç”¨ARPåè®®è·å–ç›®æ ‡IPåœ°å€æ‰€å¯¹åº”ç¡¬ä»¶MACåœ°å€çš„å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š æœ¬åœ°ä¸»æœºåœ¨å±€åŸŸç½‘ä¸­å¹¿æ’­ARP è¯·æ±‚ï¼ŒARP è¯·æ±‚æ•°æ®å¸§ä¸­åŒ…å«ç›®çš„ä¸»æœºçš„ IP åœ°å€ã€‚æ„æ€æ˜¯â€œå¦‚æœä½ æ˜¯è¿™ä¸ª IP åœ°å€çš„æ‹¥æœ‰è€…ï¼Œè¯·å›ç­”ä½ çš„ç¡¬ä»¶ MAC åœ°å€â€ã€‚ ç›®çš„ä¸»æœºçš„ ARP å±‚è§£æè¿™ä»½å¹¿æ’­æŠ¥æ–‡ï¼Œè¯†åˆ«å‡ºæ˜¯è¯¢é—®å…¶ç¡¬ä»¶åœ°å€ã€‚äºæ˜¯å‘é€ï¼ˆå•æ’­ï¼‰ARP åº”ç­”åŒ…ï¼Œé‡Œé¢åŒ…å« IP åœ°å€åŠå…¶å¯¹åº”çš„ç¡¬ä»¶åœ°å€ã€‚ æœ¬åœ°ä¸»æœºæ”¶åˆ° ARP åº”ç­”åï¼ŒçŸ¥é“äº†ç›®çš„åœ°å€çš„ç¡¬ä»¶åœ°å€ï¼Œä¹‹åçš„æ•°æ®æŠ¥å°±å¯ä»¥ä¼ é€äº†ã€‚ 1.2 ARP ç¼“å­˜å¦‚æœåƒä¸Šé¢è¯´çš„é‚£æ ·ï¼Œæ¯æ¬¡å‘åŒ…ä¹‹å‰éƒ½è¦å‘é€ ARP è¯·æ±‚ç¡¬ä»¶åœ°å€ä¼šä¸ä¼šå¤ªæ…¢ï¼Œä½†æ˜¯å®é™…ä¸Š ARP çš„è¿è¡Œæ˜¯éå¸¸é«˜æ•ˆçš„ã€‚é‚£æ˜¯å› ä¸ºæ¯ä¸€ä¸ªä¸»æœºä¸Šéƒ½æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤arp -aè·å–æœ¬æœº ARP é«˜é€Ÿç¼“å­˜çš„æ‰€æœ‰å†…å®¹ï¼š 12345678910111213141516arp -aæ¥å£: 192.168.42.26 --- 0xb Internet åœ°å€ ç‰©ç†åœ°å€ ç±»å‹ 192.168.1.1 00-00-00-00-00-ff é™æ€ 192.168.40.1 f8-75-88-c2-df-c1 åŠ¨æ€ 192.168.40.74 c8-5b-76-86-c6-06 åŠ¨æ€ 192.168.40.245 38-d5-47-e1-8a-2f åŠ¨æ€ 192.168.42.131 60-a4-4c-65-9f-68 åŠ¨æ€ 224.14.51.28 01-00-5e-0e-33-1c é™æ€ 224.19.133.150 01-00-5e-13-85-96 é™æ€ 224.49.6.212 01-00-5e-31-06-d4 é™æ€ 224.50.134.225 01-00-5e-32-86-e1 é™æ€ 224.68.111.100 01-00-5e-44-6f-64 é™æ€ 224.80.154.130 01-00-5e-50-9a-82 é™æ€ 224.88.174.75 01-00-5e-58-ae-4b é™æ€ é€šè¿‡å‘½ä»¤arp -dæ¸…é™¤ arp ç¼“å­˜å†…å®¹ã€‚ 1.3 ARP ç¼“å­˜ç”Ÿå­˜å‘¨æœŸåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒWindows Server 2003 å®¶æ—å’Œ Windows XP ä¸­ï¼ŒARP ç¼“å­˜ä¸­çš„è¡¨é¡¹ä»…å­˜å‚¨ 2 åˆ†é’Ÿã€‚å¦‚æœä¸€ä¸ª ARP ç¼“å­˜è¡¨é¡¹åœ¨ 2 åˆ†é’Ÿå†…è¢«ç”¨åˆ°ï¼Œåˆ™å…¶æœŸé™å†å»¶é•¿ 2 åˆ†é’Ÿï¼Œç›´åˆ°æœ€å¤§ç”Ÿå‘½æœŸé™ 10 åˆ†é’Ÿä¸ºæ­¢ã€‚è¶…è¿‡ 10 åˆ†é’Ÿçš„æœ€å¤§æœŸé™åï¼ŒARP ç¼“å­˜è¡¨é¡¹å°†è¢«ç§»å‡ºï¼Œå¹¶ä¸”é€šè¿‡å¦å¤–ä¸€ä¸ª ARP è¯·æ±‚æ¥è·å¾—æ–°çš„å¯¹åº”å…³ç³»ã€‚ ARP ç¼“å­˜è¡¨é¡¹çš„å­˜æ”¾æ—¶é—´å¯ä»¥é€šè¿‡æ”¹å˜ArpCacheLifeå’ŒArpCacheMinReferencedLifeçš„æ³¨å†Œè¡¨å€¼æ¥é‡æ–°è®¾ç½®ã€‚ 1234567891011HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/Tcpip/Parametersé”®å€¼ï¼šArpCacheLifeï¼Œè®¾ç½®æœªè¢«ä½¿ç”¨çš„ARPç¼“å­˜è¡¨é¡¹å¯ä»¥è¢«ä¿æŒçš„æ—¶é—´ï¼Œç±»å‹ä¸ºDwordï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤å€¼ä¸º120ã€‚ArpCacheMinReferencedLifeï¼Œè®¾ç½®è¢«é‡å¤ä½¿ç”¨çš„è¡¨é¡¹å¯ä»¥åœ¨ARPç¼“å­˜ä¸­å­˜æ”¾çš„æ—¶é—´ï¼Œç±»å‹ä¸ºDwordï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤å€¼ä¸º600ã€‚ArpCacheMinReferencedLifeå’ŒArpCacheLifeçš„å€¼çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼šå¦‚æœArpCacheLife &gt;= ArpCacheMinReferencedLifeï¼Œåˆ™è¢«ä½¿ç”¨å’Œæœªè¢«ä½¿ç”¨çš„ARPç¼“å­˜è¡¨é¡¹å¯å­˜å‚¨çš„æ—¶é—´éƒ½æ˜¯ArpCacheLifeã€‚å¦‚æœArpCacheLife &lt; ArpCacheMinReferencedLifeï¼Œåˆ™æœªè¢«ä½¿ç”¨çš„ARPç¼“å­˜è¡¨é¡¹åœ¨ArpCacheLifeç§’çš„æ—¶é—´åå°±è¿‡æœŸäº†ï¼Œè¢«ä½¿ç”¨çš„è¡¨é¡¹çš„ç”Ÿå­˜æœŸä¸ºArpCacheMinReferencedLifeç§’ã€‚æ³¨æ„ï¼šè¿™äº›é”®å€¼é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹ï¼Œå¿…é¡»è‡ªè¡Œåˆ›å»ºï¼›ä¿®æ”¹åé‡å¯è®¡ç®—æœºåç”Ÿæ•ˆ 1.3 ARP å¸§æ ¼å¼ 123456789101112131415ä»¥å¤ªç½‘ç›®çš„åœ°å€ï¼šç›®çš„ä¸»æœºçš„ç¡¬ä»¶åœ°å€ã€‚ç›®çš„åœ°å€å…¨ä¸º1çš„ç‰¹æ®Šåœ°å€æ˜¯å¹¿æ’­åœ°å€ã€‚ä»¥å¤ªç½‘æºåœ°å€ï¼šæºä¸»æœºçš„ç¡¬ä»¶åœ°å€ã€‚å¸§ç±»å‹ï¼šå¯¹äºARPåè®®ï¼Œè¯¥å­—æ®µä¸º0x0806ã€‚å¯¹äºRARPåè®®ï¼Œè¯¥å­—æ®µä¸º0x8035ã€‚ç¡¬ä»¶ç±»å‹ï¼šè¡¨ç¤ºç¡¬ä»¶åœ°å€çš„ç±»å‹ã€‚å€¼ä¸º1æ—¶è¡¨ç¤ºä»¥å¤ªç½‘åœ°å€ã€‚ARPåè®®ä¸ä»…ä»…åº”ç”¨äºä»¥å¤ªç½‘åè®®ï¼Œè¿˜å¯ä»¥æ”¯æŒåˆ«çš„é“¾è·¯å±‚åè®®ã€‚åè®®ç±»å‹ï¼šè¡¨ç¤ºè¦æ˜ å°„çš„åè®®åœ°å€ç±»å‹ã€‚å€¼ä¸º0x0800æ—¶è¡¨ç¤ºIPåè®®ã€‚ç¡¬ä»¶åœ°å€é•¿åº¦ï¼šä¸ç¡¬ä»¶ç±»å‹å¯¹åº”çš„ç¡¬ä»¶åœ°å€çš„é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚å¦‚æœæ˜¯ä»¥å¤ªç½‘ï¼Œåˆ™æ˜¯6å­—èŠ‚ï¼ˆMACé•¿åº¦ï¼‰ã€‚åè®®åœ°å€é•¿åº¦ï¼šä¸åè®®ç±»å‹å¯¹åº”çš„åè®®åœ°å€é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚å¦‚æœæ˜¯IPåè®®ï¼Œåˆ™æ˜¯4å­—èŠ‚ï¼ˆIPåœ°å€é•¿åº¦ï¼‰ã€‚æ“ä½œç±»å‹ï¼ˆopï¼‰ï¼šå››ç§æ“ä½œç±»å‹ã€‚ARPè¯·æ±‚ï¼ˆ1ï¼‰ï¼ŒARPåº”ç­”ï¼ˆ2ï¼‰ï¼ŒRARPè¯·æ±‚ï¼ˆ3ï¼‰ï¼ŒRARPåº”ç­”ï¼ˆ4ï¼‰ã€‚å‘é€ç«¯ç¡¬ä»¶åœ°å€ï¼šå¦‚æœæ˜¯ä»¥å¤ªç½‘ï¼Œåˆ™æ˜¯æºä¸»æœºä»¥å¤ªç½‘åœ°å€ï¼Œæ­¤å¤„å’Œä»¥å¤ªç½‘å¤´ä¸­çš„æºåœ°å€å¯¹åº”ã€‚å‘é€ç«¯åè®®åœ°å€ï¼šå¦‚æœæ˜¯IPåè®®ï¼Œåˆ™è¡¨ç¤ºæºä¸»æœºçš„IPåœ°å€ã€‚ç›®çš„ç«¯ç¡¬ä»¶åœ°å€ï¼šå¦‚æœæ˜¯ä»¥å¤ªç½‘ï¼Œåˆ™æ˜¯ç›®çš„ä»¥å¤ªç½‘åœ°å€ï¼Œå’Œä»¥å¤ªç½‘å¤´ä¸­çš„ç›®çš„åœ°å€å¯¹åº”ã€‚ç›®çš„ç«¯åè®®åœ°å€ï¼šå¦‚æœæ˜¯IPåè®®ï¼Œåˆ™è¡¨ç¤ºæºä¸»æœºè¦è¯·æ±‚ç¡¬ä»¶åœ°å€çš„IPåœ°å€ã€‚å¯¹åº”ARPè¯·æ±‚åŒ…æ¥è¯´ï¼Œç›®çš„ç«¯çš„ç¡¬ä»¶åœ°å€å­—æ®µæ— é¡»å¡«å……ï¼Œå…¶ä»–å­—æ®µéƒ½éœ€è¦å¡«å……ã€‚å¯¹äºARPå›å¤åŒ…æ¥è¯´ï¼Œæ‰€æœ‰å­—æ®µéƒ½éœ€è¦å¡«å……ã€‚ 1.4 ARP æ¬ºéª—ARP æ¬ºéª—ä¸€èˆ¬ç›®çš„æ˜¯é€šè¿‡æŸç§æ–¹å¼æŠŠè‡ªå·±ä¼ªè£…æˆç½‘å…³ï¼Œä»è€Œæ¬ºéª—ç›®æ ‡æœºå™¨ï¼Œä½¿æœ¬åº”å‘é€åˆ°çœŸå®ç½‘å…³çš„æ•°æ®åŒ…å‘é€åˆ°æ¬ºéª—è€…çš„æœºå™¨ã€‚ ç°æœ‰å¦‚ä¸‹ç½‘ç»œï¼š 1.4.1 å¦‚ä½•ä¼ªè£…æˆç½‘å…³ï¼Ÿæˆ‘ä»¬ä»¥ä¸»æœº A è¯·æ±‚www.csdn.netç½‘ç«™ä¸ºä¾‹ï¼Œæ¶‰åŠåˆ° ARP çš„ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š ä¸»æœº A é€šè¿‡æµè§ˆå™¨æ‰“å¼€www.csdn.netï¼ˆå‡è®¾é€šè¿‡ DNS å¾—åˆ°çš„ IP æ˜¯47.95.163.175ï¼‰ï¼Œç„¶åç»„è£…éœ€è¦å‘é€ http è¯·æ±‚åŒ…ã€‚ ä¸»æœº A å‡†å¤‡æ ¹æ®é»˜è®¤è·¯ç”±ï¼ˆç½‘å…³ï¼‰å°†æ•°æ®åŒ…å‘é€ç»™192.168.0.1, ä½†æ˜¯æœ€å¼€å§‹çš„æ—¶å€™ä¸»æœº A ä¸çŸ¥é“ 192.168.0.1 çš„ MAC åœ°å€, æ‰€ä»¥ä¸»æœº A å¹¿æ’­ä¸€æ¡ ARP è¯·æ±‚, è¯¢é—® 192.168.0.1 çš„ MAC åœ°å€ã€‚ è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰æ”¶åˆ°è¯¥ ARP è¯·æ±‚, å‘ç°è‡ªå·±æ˜¯ 192.168.0.1 äºæ˜¯å‘ä¸»æœº A å›å¤ä¸€æ¡ ARP åº”ç­”åŒ…, å‘Šè¯‰ä¸»æœº A 192.168.0.1 çš„ MAC åœ°å€æ˜¯ xxxGW. ä¸»æœº A æ”¶åˆ°è¯¥ ARP å“åº”åŒ…, å¹¶å‘è¯¥å“åº”åŒ…ä¸­çš„ MAC åœ°å€å‘é€ä¸€ä¸ª Http è¯·æ±‚åŒ…ã€‚ è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰æ”¶åˆ°è¯¥ Http è¯·æ±‚åŒ…, å‘ç°ç›®æ ‡ IP æ˜¯å…¬ç½‘ IP, ä¾¿å°†è¯¥åŒ…æ”¾é€åˆ°å…¬ç½‘, å…¬ç½‘è¿”å› Http åº”ç­”åŒ…ç»™è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰ã€‚ è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰å‡†å¤‡å°† Http å“åº”åŒ…å‘é€ç»™192.168.0.100, ä½†æ˜¯åŒç¬¬ 2 æ­¥, è·¯ç”±å™¨æœ€å¼€å§‹çš„æ—¶å€™ä¹Ÿä¸çŸ¥é“ 192.168.0.100 çš„ MAC åœ°å€æ˜¯å¤šå°‘, æ‰€ä»¥è·¯ç”±å™¨ä¼šå¹¿æ’­ä¸€æ¡ ARP è¯·æ±‚, è¯¢é—® 192.168.0.100 çš„ MAC åœ°å€æ˜¯å¤šå°‘ã€‚ ä¸»æœº A æ”¶åˆ° ARP è¯·æ±‚, å‘ç°è‡ªå·±æ˜¯192.168.0.100, äºæ˜¯å‘è·¯ç”±å™¨å›å¤ä¸€ä¸ª ARP åº”ç­”åŒ…, å‘Šè¯‰è·¯ç”±å™¨192.168.0.100 çš„ MAC åœ°å€æ˜¯ xxxA. è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰æ”¶åˆ° ARP åº”ç­”åŒ…, å¹¶ä½¿ç”¨è¯¥ APR åº”ç­”åŒ…ä¸­çš„ MAC åœ°å€å°†ç¬¬ 5 æ­¥æ”¶åˆ° Http å“åº”åŒ…å‘é€å‡ºå»ã€‚ è¯•æƒ³ï¼Œå¦‚æœç°åœ¨ä¸»æœº B åšäº†å¦‚ä¸‹ 2 ä»¶äº‹æƒ…ä¼šæœ‰ä»€ä¹ˆåæœï¼š ä¸»æœº B ä¸åœçš„å‘ä¸»æœº A å‘é€ ARP åº”ç­”åŒ…, å‘Šè¯‰è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰192.168.0.1 çš„ MAC åœ°å€æ˜¯ xxxB, ä¼šå‘ç”Ÿä»€ä¹ˆ? ä¸»æœº B ä¸åœçš„å‘è·¯ç”±å™¨ï¼ˆç½‘å…³ï¼‰å‘é€ ARP åº”ç­”åŒ…, å‘Šè¯‰ä¸»æœº A 192.168.0.100 çš„ MAC æ˜¯ xxxB, ä¼šå‘ç”Ÿä»€ä¹ˆ? å¦‚æœä¸»æœº B åšäº†ä¸Šé¢è¯´çš„ä¸¤ä»¶äº‹çš„, é‚£ä¹ˆä¸»æœº A è®¿é—®ç½‘ç»œçš„æ‰€æœ‰æ•°æ®éƒ½ä¼šå…ˆç»è¿‡ä¸»æœº B, å¹¶ä¸”ä»ç½‘å…³å‘é€åˆ°ä¸»æœº A çš„æ•°æ®ä¹Ÿéƒ½ä¼šç»è¿‡ B, è‡³æ­¤, æ•´ä¸ª ARP æ¬ºéª—å®Œæˆã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ¬ºéª—è€…æœºå™¨ä¸å¯¹è¿™äº›æ•°æ®åŒ…ä½œå¤„ç†ï¼Œå½“è¢«æ¬ºéª—æ•°æ®åŒ…åˆ°è¾¾åå°±ä¼šè¢«æœ¬æœºä¸¢å¼ƒï¼ˆå› ä¸ºè‡ªå·±åˆ°åº•ä¸æ˜¯ç½‘å…³ï¼Œè¿˜ä¸çŸ¥é“å¦‚ä½•å¤„ç†è¿™ç±»æ•°æ®åŒ…ï¼‰ï¼Œè¿™å½“ç„¶æ˜¯ä¸å…è®¸çš„ã€‚è¿™æ—¶å¼€å¯ IP è½¬å‘åŠŸèƒ½å¯ä»¥è§£å†³è¯¥é—®é¢˜ï¼ŒIP è½¬å‘è´Ÿè´£æŠŠè¯¥ç±»æ•°æ®åŒ…å†è½¬å‘ç»™çœŸæ­£çš„ç½‘å…³å¤„ç†ï¼Œå¼€å¯ IP è½¬å‘çš„æ–¹æ³•ï¼š 1sysctl net.ipv4.ip_forward=1 1.4.2 arpspoof ä½¿ç”¨åœ¨ Ubuntu æˆ– Kali ç­‰ç³»ç»Ÿä¸Šæœ‰arpspoofå·¥å…·å¯ä»¥è½»æ¾å®ç° ARP æ¬ºéª—çš„æ•´ä¸ªæµç¨‹ã€‚ 123456789101112arpspoof [-i interface] [-c own|host|both] [-t target] [-r] hostå‚æ•°ï¼š-i æŒ‡å®šç”¨æ”»å‡»æœºçš„å“ªä¸ªç½‘ç»œæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹æ”»å‡»æœºæ¥å£åˆ—è¡¨ã€‚-c own|host|both-t æŒ‡å®šarpæ”»å‡»çš„ç›®æ ‡ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç›®æ ‡ä¸ºè¯¥å±€åŸŸç½‘å†…çš„æ‰€æœ‰æœºå™¨ã€‚å¯ä»¥æŒ‡å®šå¤šä¸ªç›®æ ‡ï¼Œå¦‚ï¼šarpspoof -i etho -t 192.168.32.100 -t 192.168.32.101-r hostå¸Œæœ›æ‹¦æˆªæ”»å‡»æœºå’Œå“ªä¸ªhostä¹‹é—´çš„é€šä¿¡ï¼Œä¸€èˆ¬éƒ½æ˜¯ç½‘å…³ã€‚ äºŒã€RARP åè®®RARP åè®®ï¼ˆReverse Address Resolution Protocolï¼‰ï¼Œåå‘åœ°å€è½¬æ¢åè®®ï¼Œä¹Ÿå«é€†åœ°å€è§£æåè®®ï¼Œä¸»è¦è¢«é‚£äº›æ²¡æœ‰ç£ç›˜é©±åŠ¨å™¨çš„ç³»ç»Ÿä½¿ç”¨ï¼Œå¦‚æ— ç›˜å·¥ä½œç«™ç­‰ã€‚ å…·æœ‰æœ¬åœ°ç£ç›˜çš„ç³»ç»Ÿå¼•å¯¼æ—¶ï¼Œä¸€èˆ¬æ˜¯ä»ç£ç›˜ä¸­çš„é…ç½®æ–‡ä»¶è¯»å– IP åœ°å€ã€‚ä½†æ˜¯æ— ç›˜æœºï¼Œå¦‚æ— ç›˜å·¥ä½œç«™ï¼Œåˆ™éœ€è¦é‡‡ç”¨å…¶ä»–æ–¹æ³•è·å– ip åœ°å€ã€‚ç½‘ç»œä¸Šçš„æ¯ä¸ªç³»ç»Ÿéƒ½å…·æœ‰å”¯ä¸€çš„ç¡¬ä»¶åœ°å€ï¼Œå®ƒæ˜¯ç”±ç½‘ç»œæ¥å£ç”Ÿäº§å‚å®¶é…ç½®çš„ã€‚æ— ç›˜ç³»ç»Ÿçš„ RARP å®ç°è¿‡ç¨‹æ˜¯ä»ç½‘å¡ä¸Šè¯»å–å”¯ä¸€çš„ç¡¬ä»¶åœ°å€ï¼Œç„¶åå‘é€ RARP è¯·æ±‚åˆ° RARP æœåŠ¡å™¨ï¼Œè¯·æ±‚è¯¥ä¸»æœºåœ¨æ— ç›˜ç³»ç»Ÿçš„ IP åœ°å€ã€‚ æ–‡ç« å‚è€ƒï¼šhttps://segmentfault.com/a/1190000009562333 æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["ARP"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ç½‘ç»œåè®®(1)--åŸºç¡€æ¦‚å¿µ","path":"/post/3886809266.html","content":"ä¸€ã€åè®®æ ˆ1.1 ä¸ƒå±‚OSIåè®®æ ˆå®Œæ•´çš„OSIåè®®æ€»å…±æœ‰7å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1.2 äº”å±‚TCP/IPåè®®æ ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸šç•Œåˆäº§ç”Ÿäº†ç®€åŒ–çš„äº”å±‚ TPC/IP åè®®æ ˆï¼Œå°† OSI åè®®æ ˆä¸­çš„ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚ç»Ÿç§°ä¸ºåº”ç”¨å±‚ã€‚ 1.3 å››å±‚TCP/IPåè®®æ ˆåœ¨äº”å±‚TCP/IPåè®®æ ˆçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å°†ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ç»Ÿç§°ä¸ºé“¾è·¯å±‚ã€‚ äºŒã€IP åœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³2.1 IP åœ°å€åŠåˆ†ç±»IP åœ°å€ç›¸å½“äºäº’è”ç½‘ä¸Šçš„é—¨ç‰Œå·ï¼Œè®¡ç®—æœºåœ¨å¯åŠ¨çš„æ—¶å€™å¯ä»¥ä»ç£ç›˜ï¼ˆæ— ç›˜ç³»ç»Ÿä¾‹å¤–ï¼‰ä¸Šè¯»å–è¯¥ä¸»æœºçš„ IP é…ç½®ã€‚ IP åœ°å€ç”± 4 ä¸ªå­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯ 32 ä½ï¼‰çš„äºŒè¿›åˆ¶ç ç»„æˆï¼ŒåŒ…å«äº†ç½‘ç»œå·( net-id )å’Œä¸»æœºå·( host-id )ã€‚ä½†ç°å®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è¿˜éœ€è¦å†ç»§ç»­åˆ’åˆ†â€œå­ç½‘â€ï¼Œè¿™æ—¶å°±éœ€è¦å€Ÿç”¨ä¸»æœºå·çš„ä¸€éƒ¨åˆ†å……ä»»å­ç½‘å·ï¼Œè¿™æ · IP åœ°å€ä¹Ÿå°±å¯ä»¥çœ‹æˆç”±æ ‡å‡†ç½‘ç»œå·ã€å­ç½‘å·ã€ä¸»æœºå·3 éƒ¨åˆ†ç»„æˆçš„ï¼Œå³IPåœ°å€=æ ‡å‡†ç½‘ç»œå·+å­ç½‘å·+ä¸»æœºå·ã€‚ ç½‘ç»œå·ã€å­ç½‘å·ã€ä¸»æœºå·ä¸‰è€…é—´çš„å…³ç³»ï¼Œå½¢è±¡çš„æè¿°å¦‚ä¸‹ï¼šå‡è®¾ä½ çš„ä½å€ IP æ˜¯æ­¦æ±‰å¸‚æ–‡æ²»è¡—16å·ï¼Œé‚£ä¹ˆï¼ŒIP åœ°å€ = æ­¦æ±‰å¸‚æ–‡æ²»è¡— 16 å·ç½‘ç»œå· = æ­¦æ±‰å¸‚å­ç½‘å· = æ–‡æ²»è¡—ä¸»æœºå· = 16 å· IP åœ°å€ç§ç±» äºŒè¿›åˆ¶ç»„æˆ(å‰ç¼€ä½+ç½‘ç»œä½+ä¸»æœºä½) IP èŒƒå›´ ç½‘ç»œæ•° ä¸»æœºæ•°/ç½‘ç»œ A ç±»åœ°å€ 0+7 ä½ç½‘ç»œå·+24 ä½ä¸»æœºå· 1.0.0.0 - 127.255.255.255 B ç±»åœ°å€ 10+14 ä½ç½‘ç»œå·+16 ä½ä¸»æœºå· 128.0.0.0 - 191.255.255.255 C ç±»åœ°å€ 110+21 ä½ç½‘ç»œå·+8 ä½ä¸»æœºå· 192.0.0.0 - 223.255.255.255 D ç±»åœ°å€ 1110+å¤šæ’­åœ°å€(ç”¨äºå¤šæ’­) 224.0.0.0 - 239.255.255.255 - - E ç±»åœ°å€ 1111+ä¿ç•™ä½(ä¸å¼€æ”¾, ä¿ç•™ä½¿ç”¨) 240.0.0.0-249.255.255.255 - - ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼ŒA ç±» IP çš„ç¬¬ 1 ä½ï¼ˆäºŒè¿›åˆ¶ä½ï¼‰å¿…é¡»æ˜¯ 0ï¼Œæ‰€ä»¥ A ç±» IP çš„ç¬¬ä¸€ä¸ªæ•´æ•°çš„èŒƒå›´æ˜¯0000 0000 ~ 01111 11111ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯0 ~ 127ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å…³äºç½‘ç»œæ•°çš„è§£é‡Šç½‘ç»œæ•°å°±æ˜¯ä¸€ç§ç½‘ç»œçš„å­ç½‘æ•°, æ¯”å¦‚ A ç±»åœ°å€, å¯ä»¥åˆ†ä¸ºå¤šå°‘ä¸ªå­ç½‘ã€‚çœ‹è¡¨æ ¼å¯ä»¥æ¨å‡ºç½‘ç»œæ•°çš„è®¡ç®—å…¬å¼ä¸º: ç½‘ç»œå·ä½æ•°ã€‚è§„å®šç½‘ç»œåœ°å€å…¨ä¸º0çš„ IP åœ°å€æ˜¯ä¿ç•™åœ°å€ï¼Œæ„æ€æ˜¯â€œæœ¬ç½‘ç»œâ€ã€‚ åœ¨ A ç±»åœ°å€ä¸­ï¼Œå®é™…ä¸Š 0.0.0.0 æ˜¯ä¸æŒ‡æ´¾çš„ï¼Œè€Œå¯ä»¥æŒ‡æ´¾çš„æœ€å°ç½‘ç»œæ˜¯ 1.0.0.0ï¼›ç½‘ç»œåœ°å€ä¸º 127 çš„ A ç±» IP åœ°å€ä¿ç•™ä½œä¸ºæœ¬åœ°è½¯ä»¶ç¯å›æµ‹è¯•æœ¬ä¸»æœºçš„è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡(æ¯”å¦‚å¸¸ç”¨çš„ 127.0.0.1ï¼Œä½†å®é™…ä¸Šç½‘ç»œåœ°å€ä¸º127çš„éƒ½å¯ä»¥ç”¨ä½œæœ¬åœ°ç¯å›åœ°å€)ã€‚æ‰€ä»¥ A ç±»åœ°å€ç½‘ç»œæ•°ä¸º ã€‚ åœ¨ B ç±»åœ°å€ä¸­ï¼Œå®é™…ä¸Š 128.0.0.0 æ˜¯ä¸æŒ‡æ´¾çš„ï¼Œè€Œå¯ä»¥æŒ‡æ´¾çš„æœ€å°ç½‘ç»œæ˜¯ `128.1.0.0ï¼Œæ‰€ä»¥ B ç±»åœ°å€ç½‘ç»œæ•°æ˜¯ ã€‚ åœ¨ C ç±»åœ°å€ä¸­ï¼Œå®é™…ä¸Š 192.0.0.0 æ˜¯ä¸æŒ‡æ´¾çš„ï¼Œè€Œå¯ä»¥æŒ‡æ´¾çš„æœ€å°ç½‘ç»œæ˜¯ 192.0.1.0ï¼Œæ‰€ä»¥ C ç±»åœ°å€ç½‘ç»œæ•°æ˜¯ ã€‚ å…³äºä¸»æœºæ•°çš„è§£é‡Šä¸»æœºæ•°å°±æ˜¯ä¸€ä¸ªå­ç½‘é‡Œé¢å¯ä»¥å®¹çº³å¤šå°‘å°ä¸»æœºã€‚çœ‹è¡¨æ ¼å¯ä»¥æ¨å‡ºä¸»æœºæ•°çš„è®¡ç®—å…¬å¼ä¸º: 2^ä¸»æœºå·ä½æ•°-2ã€‚ä¸»æœºå·å…¨ä¸º 0 è¡¨ç¤ºè¯¥ç½‘ç»œï¼Œè€Œä¸»æœºå·å…¨ä¸º 1 è¡¨ç¤ºå¹¿æ’­åœ°å€ï¼Œæ‰€ä»¥è¦æ’é™¤æ‰è¿™ä¸¤ä¸ªã€‚æ¯”å¦‚ A ç±»åœ°å€ 1.0.0.0 è¡¨ç¤ºä¸»æœºæ‰€åœ¨çš„ç½‘æ®µçš„ç½‘ç»œåœ°å€, 1.255.255.255 ä¸ºè¯¥ç½‘æ®µçš„å¹¿æ’­åœ°å€ã€‚ 2.2 ç§æœ‰ IP åœ°å€ç»å¸¸å¯ä»¥çœ‹åˆ°192.168.1.101è¿™ç±»çš„ IP åœ°å€, è¿™äº›æ˜¯ç§æœ‰ IP åœ°å€, ä¸“ç”¨åœ°å€, ä¹Ÿå°±æ˜¯å±€åŸŸç½‘å†…ä½¿ç”¨çš„çš„ IP åœ°å€ã€‚å…¬ç½‘ IP åœ°å€æ˜¯éœ€è¦å‘æœ‰å…³éƒ¨é—¨ç”³è¯·å¤‡æ¡ˆçš„ï¼Œç§æœ‰ IP åœ°å€ä¸ç”¨ç”³è¯·, ä½†æ˜¯ä»…é™å†…ç½‘ä½¿ç”¨, ä¹ŸèŠ‚çº¦å…¬ç½‘ IPã€‚ IP åœ°å€ç§ç±» ç§æœ‰ IP èŒƒå›´ A ç±»åœ°å€ 10.0.0.0 - 10.255.255.255 B ç±»åœ°å€ 172.16.0.0 - 172.31.255.255 C ç±»åœ°å€ 192.168.0.0 - 192.168.255.255 è·¯ç”±å™¨çœ‹åˆ°ä¸“ç”¨åœ°å€å°±ä¸è½¬å‘ï¼Œæ‰€ä»¥è¯´ä¸“ç”¨åœ°å€ä½œä¸ºç›®çš„åœ°å€æ˜¯ä¸å¯èƒ½åœ¨å› ç‰¹ç½‘ä¸Šä¼ é€çš„ã€‚ä¸“ç”¨ IP åœ°å€ä¹Ÿå¯å«åšå¯é‡ç”¨åœ°å€ã€‚é‚£å¥½ï¼Œé—®é¢˜æ¥äº†ï¼Œå¦‚æœé…ç½®äº†è¿™äº›ä¸“ç”¨åœ°å€çš„ä¸»æœºæƒ³å’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡ï¼Œæ€ä¹ˆåŠå‘¢ï¼ŸNAT(network address translation: ç½‘ç»œåœ°å€è½¬æ¢)åœ¨è¿™ç§æƒ…å†µä¸‹å°±åº”è¿è€Œç”Ÿäº†ã€‚NAT å°±æ˜¯å°†è¿™ç§åœ°å€è½¬æ¢æˆæœ‰æ•ˆçš„å¤–éƒ¨å…¨çƒ IP åœ°å€ï¼Œä½¿å¾—æ•´ä¸ªä¸“ç”¨ç½‘åªéœ€è¦ä¸€ä¸ªå…¨çƒ IP åœ°å€å°±å¯ä»¥ä¸å› ç‰¹ç½‘è”é€šã€‚ 2.3 å­ç½‘æ©ç IPåœ°å€=æ ‡å‡†ç½‘ç»œå·+å­ç½‘å·+ä¸»æœºå·ã€‚ä» IP åˆ†ç±»å¯ä»¥å¾ˆå®¹æ˜“ç¡®å®šâ€œæ ‡å‡†ç½‘ç»œå·â€ï¼Œ32bitçš„ IP åœ°å€é™¤å»å‰é¢çš„â€œæ ‡å‡†ç½‘ç»œå·â€ä¹‹åï¼Œå‰©ä¸‹çš„å°±æ˜¯â€œå­ç½‘å·â€å’Œâ€œä¸»æœºå·â€ï¼Œé‚£ä¹ˆæ€ä¹ˆç¡®å®šâ€œå­ç½‘å·â€å’Œâ€œä¸»æœºå·â€äº†ï¼Ÿ è¿™å°±éœ€è¦å€ŸåŠ©â€œå­ç½‘æ©ç â€äº†ã€‚å­ç½‘æ©ç ä¹Ÿæ˜¯ä¸€ä¸ª 32bit(xxx.xxx.xxx.xxx)çš„å€¼ï¼Œå…¶ä¸­å€¼ä¸º 1 çš„ bit ç•™ç»™â€œæ ‡å‡†ç½‘ç»œå·â€å’Œâ€œå­ç½‘å·â€ï¼Œä¸º 0 çš„ bit ç•™ç»™â€œä¸»æœºå·â€ã€‚æˆ‘ä»¬å¯ä»¥å°†å­ç½‘æ©ç å’Œ IP åœ°å€è¿›è¡ŒäºŒè¿›åˆ¶â€œä¸è¿ç®—â€ï¼Œé€šè¿‡å¾—åˆ°çš„ç»“æœæ¥ç¡®å®šâ€œå­ç½‘å·â€ã€‚ ä»¥ C ç±» IP åœ°å€ä¸ºä¾‹ï¼Œå¯¹äºè§„èŒƒçš„ C ç±» IP åœ°å€æ¥è¯´ï¼Œè§„èŒƒå­ç½‘æ©ç ä¸º255.255.255.0ï¼Œå³ç”¨ 32 æ¯”ç‰¹ IP åœ°å€çš„å‰ 24 æ¯”ç‰¹æ ‡è¯†ç½‘ç»œå·ï¼Œå 8 æ¯”ç‰¹æ ‡è¯†ä¸»æœºå·ã€‚å› è€Œï¼Œæ¯ä¸ª C ç±»ç½‘ç»œä¸‹å…±å¯å®¹çº³ 254 å°ä¸»æœº()ã€‚ å¦‚ä»Šï¼Œæˆ‘ä»¬å…ˆæ€ç´¢å€Ÿç”¨ 2 æ¯”ç‰¹çš„ä¸»æœºå·æ¥å……ä»»å­ç½‘ç»œå·çš„æƒ…å½¢ã€‚ C ç±»ç½‘ç»œåœ°å€210.31.233.0ï¼Œæˆ‘ä»¬å€Ÿç”¨ 2bit çš„ä¸»æœºå·æ¥å……å½“å­ç½‘å·ï¼Œå­ç½‘çš„æ•°ç›®ä¸º(å­ç½‘å·æ— æ³•å…¨ä¸º 0 æˆ– 1ï¼Œæ‰€ä»¥å‡ 2). ä¸ºäº†å€Ÿç”¨åŸæ¥ 8 ä½ä¸»æœºå·ä¸­çš„å‰ 2 ä½å……ä»»å­ç½‘ç»œå·ï¼Œé‡‡ç”¨äº†æ–°çš„éè§„èŒƒå­ç½‘æ© 255.255.255.192ã€‚é‡‡ç”¨äº†æ–°çš„å­ç½‘æ©ç åï¼Œå€Ÿç”¨çš„ 2 ä½å­ç½‘å·å¯ä»¥ç”¨æ¥æ ‡è¯†ä¸¤ä¸ªå­ç½‘ï¼š01 å­ç½‘å’Œ 10 å­ç½‘(å­ç½‘å·æ— æ³•å…¨ä¸º 0 æˆ– 1ï¼Œå› è€Œ 00ã€11 å­ç½‘æ— æ³•ç”¨)ã€‚ å¯¹äºä¸Šå›¾çš„ 01 å­ç½‘æ¥è¯´ï¼Œå…¶ç½‘ç»œå·çš„ç‚¹åˆ†åè¿›åˆ¶çš„æ–¹å¼ä¸ºï¼š210.31.233.64ï¼Œè¯¥å­ç½‘çš„æœ€å° IP åœ°å€ä¸ºï¼š210.31.233.65ï¼Œæœ€å¤§ IP åœ°å€ä¸ºï¼š210.31.233.126ï¼ˆä¸»æœºå·å…¨ä¸º 1 ä½å¹¿æ’­åœ°å€ï¼‰ï¼Œå…±å¯å®¹çº³ 62 å°ä¸»æœºã€‚å¯¹è¯¥å­ç½‘çš„ç›´æ¥å¹¿æ’­åœ°å€ä¸ºï¼š210.31.233.127ï¼ˆä¸»æœºå·å…¨ä¸º 1ï¼‰ã€‚ ç»å¸¸è§åˆ°åƒ192.168.1.0/24è¿™æ ·çš„å†™æ³•ï¼Œå®ƒçš„æ„æ€æ˜¯ç½‘ç»œå·ä¸º192.168.1.0ï¼›å­ç½‘æ©ç ä¸º 24 ä½ï¼Œå³111111111 111111111 111111111 00000000ï¼Œè½¬ä¸ºç‚¹åˆ†åè¿›åˆ¶å°±ä¸º255.255.255.0ï¼Œæ²¡æœ‰å€Ÿç”¨ä¸»æœºå·æ¥å……å½“å­ç½‘å·ï¼Œå¯ä»¥æ‹¥æœ‰çš„ä¸»æœºæ•°ä¸º-2. 2.3 ç½‘å…³çš„ä½œç”¨ä½ çš„ä½å€ IP æ˜¯æ­¦æ±‰å¸‚æ´ªå±±åŒºæ–‡æ²»è¡—16å·ï¼Œä½ çš„çˆ¶æ¯åªå…è®¸ä½ å’Œæ–‡æ²»è¡—çš„å°æœ‹å‹ï¼ˆåŒä¸€ä¸ªå­ç½‘ï¼‰ä¸€èµ·ç©è€ï¼Œå¦‚æœä½ æƒ³è¦å»å’Œåˆ«çš„è¡—é“ï¼ˆåˆ«çš„å­ç½‘ï¼‰çš„å°æœ‹å‹ç©è€ï¼Œä½ å°±éœ€è¦ç»è¿‡ä½ çš„çˆ¶æ¯çš„åŒæ„ï¼Œç”±ä½ çš„çˆ¶æ¯å¸¦ä½ è¿‡å»ï¼Œè¿™æ—¶å€™ä½ çš„çˆ¶æ¯å°±å……å½“äº†ç½‘å…³çš„è§’è‰²ï¼Œæ²¡æœ‰ä½ çš„çˆ¶æ¯ï¼Œä½ å°±ä¸èƒ½å’Œå…¶ä»–è¡—é“ï¼ˆå…¶ä»–å­ç½‘ï¼‰çš„å°æœ‹å‹ç©è€ã€‚ ä¸‰ã€åŒ…çš„å°è£…ä¸è§£å°è£… å°è£…è‹±æ–‡ï¼šEncapsulationè§£å°è£…è‹±æ–‡ï¼šDemultiplexing å½“åº”ç”¨ç¨‹åºä½¿ç”¨ç½‘ç»œä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®æŒ‰ç…§åè®®æ ˆä»ä¸Šåˆ°ä¸‹çš„é¡ºåºï¼Œé€æ¬¡é€šè¿‡æ¯ä¸€å±‚ã€‚å…¶ä¸­æ¯ä¸€å±‚å¯¹æ”¶åˆ°çš„æ•°æ®éƒ½è¦å¢åŠ ä¸€äº›é¦–éƒ¨ä¿¡æ¯ï¼ˆæœ‰æ—¶è¿˜å¢åŠ å°¾éƒ¨ä¿¡æ¯ï¼‰ã€‚æœ€ç»ˆç”Ÿæˆä¸€ä¸²æ¯”ç‰¹æµé€šè¿‡ä»¥å¤ªç½‘æ¥ä¼ è¾“ï¼Œæˆ‘ä»¬ç§°è¿™ä¸²æ¯”ç‰¹æµå«å¸§ã€‚å¦‚å›¾ï¼š å½“æ•°æ®æŠ¥åˆ°è¾¾é“¾è·¯å±‚æ—¶ï¼Œé“¾è·¯å±‚ä¹Ÿè¦å¯¹ IP æ•°æ®åŒ…å°è£…è¿›è¡ŒåŒ…è£…ã€‚é“¾è·¯å±‚ä¹Ÿè¦å¯¹ IP æ•°æ®åŒ…å°è£…çš„æ–¹å¼ä¸»è¦æœ‰ä»¥å¤ªç½‘IPæ•°æ®åŒ…å°è£…ï¼ˆRFC894ï¼‰ã€IEEE 802 IPæ•°æ®æŠ¥å°è£…ï¼ˆRFC1042ï¼‰ä¸¤ç§ï¼Œæœ€å¸¸ä½¿ç”¨çš„å°è£…æ ¼å¼æ˜¯ä»¥å¤ªç½‘ IP æ•°æ®åŒ…å°è£…ï¼ˆRFC894ï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è¿™ä¸¤ç§ä¸åŒå½¢å¼çš„å°è£…æ ¼å¼ï¼šä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ä»¥å¤ªç½‘å°è£…é™åˆ¶äº†æ•°æ®å¸§çš„æœ€å¤§é•¿åº¦ä¸º 1500 å­—èŠ‚ï¼Œè¿™ä¸ªé™åˆ¶å«åš MTUï¼Œæœ€å¤§ä¼ è¾“å•å…ƒï¼ˆè¯¦è§ç¬¬å››èŠ‚ï¼‰ã€‚ æ¥æ”¶ç«¯æ”¶åˆ°å¸§ä¹‹åï¼ŒæŒ‰ç…§å’Œä¸Šé¢ç›¸åçš„é¡ºåºï¼ˆåè®®æ ˆä»ä¸‹åˆ°ä¸Šï¼‰æ¥è§£åŒ…ï¼Œä¾æ¬¡è§£ææ¯ä¸€å±‚åŠ å…¥çš„å¤´éƒ¨ï¼ˆæˆ–å°¾éƒ¨ï¼‰ï¼Œæœ€ç»ˆå°†åŸå§‹æ•°æ®ä¼ ç»™æœ€ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚å¦‚å›¾ï¼š å› ä¸ºä¼ è¾“å±‚çš„ TCPã€UDPã€ICMP ç­‰éƒ½æœ‰å¯èƒ½å‘ç½‘ç»œå±‚ IP åè®®ä¼ é€æ•°æ®ï¼Œè¿™æ ·åœ¨ IP åè®®å±‚è§£åŒ…çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“è¿™ä¸ªåŒ…å¯¹åº”çš„ä¸Šå±‚åè®®æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ IP åè®®å¿…é¡»åœ¨ç”Ÿæˆçš„ IP é¦–éƒ¨åŠ å…¥æŸç§æ ‡è¯†ï¼Œä»¥è¡¨æ˜æ•°æ®çš„ä¸Šä¸€å±‚çš„å…·ä½“åè®®ã€‚ä¸ºæ­¤ï¼ŒIP åœ¨é¦–éƒ¨ä¸­å­˜å…¥äº†ä¸€ä¸ªé•¿åº¦ä¸º 8bit çš„æ•°å€¼ï¼Œç§°ä½œåè®®åŸŸã€‚å¸¸è§çš„ IP åè®®å·æœ‰ï¼š1 è¡¨ç¤º ICMP åè®®ï¼Œ2 è¡¨ç¤º IGMP åè®®ï¼Œ6 è¡¨ç¤º TCP åè®®ï¼Œ17 è¡¨ç¤º UDP åè®®ã€‚ å®Œæ•´çš„ IP åè®®å·è§ï¼šIP åè®®å·åˆ—è¡¨ å››ã€MTUå‰é¢ç¬¬ä¸‰èŠ‚æåˆ°äº†ä»¥å¤ªç½‘å°è£…é™åˆ¶äº†æ•°æ®å¸§çš„é•¿åº¦ä¸º 1500 å­—èŠ‚ï¼Œè¿™ä¸ªé™åˆ¶æ˜¯åœ¨é“¾è·¯å±‚å°è£… IP æ•°æ®æŠ¥æ—¶ä½œçš„ã€‚å¦‚æœ IP å±‚çš„æ•°æ®æŠ¥æ¯”é“¾è·¯å±‚çš„è¿™ä¸ª MTU å€¼å¤§ï¼Œé‚£ä¹ˆ IP å±‚å°±éœ€è¦åˆ†ç‰‡ï¼ˆè‹±æ–‡ï¼šfragmentationï¼‰ï¼ŒæŠŠæ•°æ®æŠ¥åˆ†æˆè‹¥å¹²ç‰‡ï¼Œä¿è¯æ¯ä¸€ç‰‡çš„å¤§å°éƒ½å°äº MTU å€¼ã€‚ windows ç³»ç»Ÿä¿®æ”¹ MTU å€¼ æŸ¥è¯¢å½“å‰ MTU å€¼ 1netsh interface ipv4 show subinterfaces ä¿®æ”¹ MTU å€¼ 1netsh interface ipv4 set subinterface \"æœ¬åœ°è¿æ¥\" mtu=1480 store=persistent æ–‡ç« å‚è€ƒï¼šhttps://m.vipcn.com/a/360973/ &gt; https://ahaochan.github.io/posts/IP_address,_subnet_mask,_gateway_Introduction.html &gt; https://www.zhihu.com/question/20717354 ã€ŠTCP/IP è¯¦è§£ å· 1ï¼šåè®®ã€‹åœ¨çº¿é˜…è¯»åœ°å€ï¼šhttp://www.52im.net/topic-tcpipvol1.html æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["IP"],"categories":["ç¼–ç¨‹åŸºç¡€"]},{"title":"ä½¿ç”¨WinDbgæŸ¥çœ‹è°ƒç”¨å †æ ˆ","path":"/post/2414867920.html","content":"ä¸€. æ˜¾ç¤ºå †æ ˆä¿¡æ¯k*å‘½ä»¤ 1234[~Thread] k[b|p|P|v] [c] [n] [f] [L] [M] [FrameCount][~Thread] k[b|p|P|v] [c] [n] [f] [L] [M] = BasePtr [FrameCount][~Thread] k[b|p|P|v] [c] [n] [f] [L] [M] = BasePtr StackPtr InstructionPtr[~Thread] kd [WordCount] å‚æ•°ï¼šThreadï¼š &nbsp;æŒ‡å®šæ˜¾ç¤ºå“ªä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆã€‚å¦‚æœçœç•¥è¯¥å‚æ•°ï¼Œåˆ™æ˜¾ç¤ºå½“å‰çº¿ç¨‹çš„è°ƒç”¨å †æ ˆã€‚æ˜¾ç¤ºæ‰€æœ‰çº¿ç¨‹çš„è°ƒç”¨å †æ ˆã€‚bï¼š &nbsp;æ˜¾ç¤ºæ¯ä¸ªå‡½æ•°çš„å‰3ä¸ªå‚æ•°ã€‚pï¼š &nbsp;æ˜¾ç¤ºæ¯ä¸ªå‡½æ•°çš„æ‰€æœ‰å‚æ•°ã€‚å‚æ•°åˆ—è¡¨åŒ…æ‹¬æ¯ä¸ªå‚æ•°çš„ç±»å‹ã€åç§°ã€å€¼ã€‚Pï¼š &nbsp;ç±»ä¼¼äºp*ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ¯ä¸ªå‚æ•°æ˜¾ç¤ºåœ¨å•ç‹¬çš„è¡Œä¸Šé¢ã€‚nï¼š &nbsp;æ˜¾ç¤ºè°ƒç”¨å †æ ˆä¸­æ¯å¸§çš„åºå·ï¼ˆä¸€èˆ¬ç§°æ ˆå¸§ï¼Œå¦‚æ ˆå¸§3ï¼‰ã€‚FrameCountï¼š &nbsp;æŒ‡å®šæ˜¾ç¤ºè°ƒç”¨å †æ ˆçš„å¸§æ•°ï¼Œå³è°ƒç”¨å †æ ˆçš„æ·±åº¦ã€‚é»˜è®¤ä¸º16è¿›åˆ¶æ ¼å¼ã€‚é»˜è®¤å¸§æ•°ä¸º0x14&#x3D;20 äºŒ. åˆ‡æ¢åˆ°æŒ‡å®šå¸§ä¿¡æ¯è°ƒç”¨å †æ ˆæ˜¾ç¤ºå‡ºæ¥ä¹‹åï¼Œå¦‚æœæƒ³çŸ¥é“è°ƒç”¨æŸå¸§æ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨.frameæ¥åˆ‡æ¢åˆ°æŒ‡å®šçš„å¸§ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å¦‚dvå‘½ä»¤æ˜¾ç¤ºå±€éƒ¨å˜é‡ç­‰ã€‚ 1.frame [/c] [/r] [FrameNumber] &#x2F;rï¼š &nbsp;æ˜¾ç¤ºæ‰§è¡Œè¯¥å¸§æ—¶å¯„å­˜å™¨çš„å€¼ã€‚ FrameNumberï¼š &nbsp;æŒ‡å®šè¦åˆ‡æ¢åˆ°çš„å¸§å·ã€‚","tags":["Windbg"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"MySQLçš„DECLARE...HANDLERä½¿ç”¨","path":"/post/3457369310.html","content":"ä¸€ã€ åŠŸèƒ½DECLARE...HANDLERè¯­æ³•å¦‚ä¸‹ï¼š 123DECLARE handler_action HANDLER FOR condition_value [, condition_value] ... statement åŠŸèƒ½æ¦‚æ‹¬èµ·æ¥å°±æ˜¯ï¼šåœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªcondition_valueæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…ˆæ‰§è¡Œstatementè¯­å¥ï¼Œç„¶åæ‰§è¡Œhandler_actionåŠ¨ä½œã€‚ äºŒã€ å‚æ•°è§£é‡Š2.1 statementstatementè¯­å¥å¯ä»¥æ˜¯ä¸€è¡Œç®€å•çš„SQLè¯­å¥ï¼Œå¦‚SET var_name = valueï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šè¡Œå¤æ‚çš„çš„SQLè¯­å¥ï¼Œä½†å¤šè¡ŒSQLè¯­å¥éœ€è¦ä½¿ç”¨BEGINå’ŒENDåŒ…å›´ã€‚ ç®€å•statementï¼š 1DECLARE CONTINUE HANDLER FOR 1051 SET result = 0; å¤æ‚çš„statementï¼š 1234DECLARE CONTINUE HANDLER FOR 1051BEGIN -- body of handlerEND; 2.2 handler_actionhandler_actionçš„å–å€¼å¦‚ä¸‹ï¼š CONTINUEï¼šè¡¨ç¤ºç»§ç»­æ‰§è¡Œå½“å‰SQLè„šæœ¬ã€‚ EXITï¼šè¡¨ç¤ºç»ˆæ­¢æ‰§è¡Œå½“å‰SQLè„šæœ¬ã€‚å³ä½¿condition_valueï¼ˆè§2.3ï¼‰ç”±statementè¯­å¥çš„BEGIN...ANDè¯­å¥å—å¼•å‘ï¼Œä¹Ÿæ˜¯ä¸€æ ·ä¼šç»ˆæ­¢æ‰§è¡Œã€‚ 2.3 condition_valuecondition_valueçš„å–å€¼å¯ä»¥ä¸ºå¦‚ä¸‹å‡ ç§ï¼š â— mysql_error_codeï¼šMySQLçš„é”™è¯¯ç ï¼Œæ•´æ•°ç±»å‹ã€‚ 1234DECLARE CONTINUE HANDLER FOR 1051BEGIN -- body of handlerEND; MySQLé”™è¯¯ç å–å€¼è§:https://dev.mysql.com/doc/refman/5.7/en/error-messages-server.html â— SQLSTATE ï¼šç”¨5ä¸ªå­—ç¬¦è¡¨ç¤ºçš„SQLSTATEå€¼ã€‚ 1234DECLARE CONTINUE HANDLER FOR SQLSTATE &#x27;42S02&#x27;BEGIN -- body of handlerEND; ä»¥&#39;00&#39;å¼€å§‹çš„å€¼è¡¨ç¤ºæˆåŠŸã€‚SQLSTATEçš„å®Œæ•´å–å€¼åˆ—è¡¨è§:https://dev.mysql.com/doc/refman/5.7/en/error-messages-server.html â— condition_nameï¼šä½¿ç”¨DECLARE ... CONDITIONå®šä¹‰çš„æ¡ä»¶çš„åç§°ã€‚ å¦‚ä½•ä½¿ç”¨DECLARE ... CONDITIONå®šä¹‰æ¡ä»¶ï¼Œè§ï¼šhttps://dev.mysql.com/doc/refman/5.7/en/declare-condition.html â— SQLWARNINGï¼šç›¸å½“äºå€¼ä»&#39;01&#39;å¼€å§‹çš„SQLSTATE ã€‚â— NOT FOUNDï¼šç›¸å½“äºå€¼ä»&#39;02&#39;å¼€å§‹çš„SQLSTATE ã€‚â— SQLEXCEPTIONï¼šç›¸å½“äºå€¼ä¸ä¸º&#39;00&#39;,&#39;01&#39;,&#39;02&#39;çš„æ‰€æœ‰ SQLSTATEã€‚ å‚è€ƒæ–‡æ¡£: https://dev.mysql.com/doc/refman/5.7/en/declare-handler.html","tags":["MySQL"],"categories":["æ•°æ®åº“","MySQL"]},{"title":"æœ€ä¸åƒå¹²è´§çš„33æ¡å¹²è´§ã€è½¬è½½ã€‘","path":"/post/3534906950.html","content":"æˆåŠŸçš„å”¯ä¸€ç§˜è¯€å°±æ˜¯é’»ç©ºå­ã€‚é’»èŒåœºäººé™…å…³ç³»çš„ç©ºå­ã€é’»å¸‚åœºç›‘ç®¡çš„ç©ºå­ã€é’»ä¿¡æ¯ä¸å¯¹ç§°çš„ç©ºå­ï¼Œé’»ä½ å‘ç°çš„ä¸€åˆ‡ç©ºå­çš„ç©ºå­ã€‚å½“ç„¶ï¼ŒåšæŒã€åŠªåŠ›ã€é€‰æ‹©è¿™äº›å› ç´ ï¼Œå¯¹äºæˆåŠŸä¹Ÿå¾ˆé‡è¦ï¼Œä½†ç®—ä¸ä¸Šç§˜è¯€ã€‚åªæœ‰é’»ç©ºå­æ‰æ˜¯å”¯ä¸€çš„ç§˜è¯€ã€‚ ä¸è¦åšæ°¸è¿œæ­£ç¡®çš„ç©·äººã€‚å°‘è·Ÿäººäº‰è¾©ï¼Œä½ è§‰å¾—å¯¹å°±å»åšï¼Œåšæˆäº†è‡ªç„¶åˆ«äººå°±é—­å˜´äº†ã€‚è¯´æœåˆ«äººå¹¶æ²¡æœ‰å®é™…çš„æ„ä¹‰ï¼Œæµªè´¹å£èˆŒå’Œæ—¶é—´ã€‚å½“ç„¶ï¼Œåˆ©ç›Šç›¸å…³çš„äº‹æƒ…ï¼Œæœ‰äººå†¤æ‰ä½ çš„æƒ…å†µé™¤å¤–ã€‚ è„¸çš®å˜åšä¸€å€ï¼ŒæˆåŠŸçš„å¯èƒ½æ€§è¦ç¿»å€ã€‚ä¸è¦æ€•ä¸¢è„¸ï¼Œä½ è§‰å¾—ä¸¢è„¸çš„äº‹æƒ…ï¼Œå¤§å®¶å…¶å®å‹æ ¹ä¸åœ¨ä¹ï¼Œä¸¢è„¸å¤šåŠæ˜¯ä½ ä¸ªäººçš„è‡†æƒ³ã€‚ é¡¹ç›®ä¸åšè°ƒç ”ï¼Œå°±åƒå«–å¨¼ä¸æˆ´å¥—ï¼Œéå¸¸å±é™©ã€‚ä»»ä½•é¡¹ç›®å¯åŠ¨å‰ä¸€å®šè¦åšé€‚å½“çš„è°ƒç ”ï¼Œå“ªæ€•å¾ˆç²—ç³™ï¼Œä¹Ÿè¿œèƒœäºæ— ã€‚ åˆ›ä¸šåšç”Ÿæ„å°±æ˜¯è¦æŠ„ï¼ŒæŠ„äº§å“ã€æŠ„æ¨¡å¼ã€æŠ„æ¶æ„ï¼Œè¿™æ˜¯è§„é¿é£é™©ï¼Œå‡å°‘è¯•é”™æˆæœ¬çš„æœ€å¥½æ–¹æ³•ã€‚ä½†æ˜¯ä¹Ÿä¸èƒ½å…¨æŠ„ã€‚å¤§åŸåˆ™æ˜¯ï¼šæ‹¿å¾—å‡†çš„ç¯èŠ‚åˆ›æ–°ï¼Œæ‹¿ä¸å‡†çš„åœ°æ–¹æŠ„ã€‚ æ¯ä¸ªæœˆèŠ±åŠå¤©æ—¶é—´ï¼Œæ‰«æå’Œæ¢³ç†è‡ªå·±æ‰€åœ¨é¢†åŸŸå’ŒåŒºåŸŸçš„è¡Œä¸šæ–°æœºä¼šã€‚ æœ‰æ£æ²¡æ£ï¼Œæ‰“ä¸€ç«¿å­ã€‚å¤šå»åšä¸€äº›å°è¯•ã€‚ä¸ä¸€å®šæ¯ä¸€ä»¶äº‹éƒ½è¦åŠªåŠ›å»åšï¼Œä½†é‚£äº›èˆ’é€‚åŒºå¤–çš„äº‹æƒ…ï¼Œå¯ä»¥è¯•ç€å»åšã€‚ å¤§å®¶éƒ½å»æ‰¾é‡‘çŸ¿çš„æ—¶å€™ï¼Œç»™æ·˜é‡‘çš„äººå–é“²å­å°±æ˜¯æœ€å¥½çš„ç”Ÿæ„ï¼Œå¤šè€ƒè™‘å¿«é€Ÿå¢é•¿è¡Œä¸šçš„å‘¨è¾¹ç”Ÿæ„ã€‚ å–æ‰‹æœºä¸å¦‚ä¿®æ‰‹æœºï¼Œä¿®æ‰‹æœºä¸å¦‚åšäºŒæ‰‹å›æ”¶ã€‚ä¸€ä¸ªè¡Œä¸šè¶Šæ˜¯ä¿¡æ¯ä¸å¯¹ç§°ï¼Œè¶Šæ˜¯ä¸æ ‡å‡†åŒ–ï¼Œå®ƒçš„åˆ©æ¶¦å°±è¶Šé«˜ï¼Œèµšé’±çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚ è¦æŠ•èµ„ä¸€ä¸ªé¢†åŸŸï¼Œä¸‹é¢ä¸¤ä¸ªæ¡ä»¶è‡³å°‘è¦ä¸€ä¸ªæ¡ä»¶æˆç«‹ï¼š1. ä½ è‡ªå·±æ‡‚è¡Œï¼›2. ä½ èƒ½æ‰¾åˆ°æ‡‚è¡Œåˆé è°±çš„äººæ¥å¸®ä½ æŠŠå…³ã€‚ ä¸è¦ç”¨ä¸ªäººçš„å¥½æ¶ä»£æ›¿å•†ä¸šé€»è¾‘ã€‚å¦‚æœä½ è§‰å¾—ç½—è¾‘æ€ç»´ã€å’ªè’™ã€æ¯”ç‰¹å¸éƒ½æ˜¯éª—å­ï¼Œé‚£ä½ æ°¸è¿œçœ‹ä¸åˆ°èƒŒåçš„éœ€æ±‚ã€æœºä¼šå’Œè¡Œä¸šçº¢åˆ©ã€‚ åšè¥é”€å°±å’Œåšå°å§ä¸€æ ·ï¼Œè¶Šlowçš„æ–¹å¼åå€’è¶Šæœ‰æ•ˆã€‚ä¸å…¶æ‰­æ‰­ææã€æ•…ä½œé€¼æ ¼ï¼Œä¸å¦‚å¤§å¤§æ–¹æ–¹ç®€å•ç²—æš´ã€èµ¤è£¸ç›¸å¾…ã€‚ é‡åˆ°è‡ªå·±ä¸æ‡‚æˆ–è€…æ²¡å¬è¿‡çš„æ–°åè¯ï¼Œç”¨æ‰‹æœºè®°ä¸‹æ¥ã€‚æœ‰ç©ºå¯ä»¥ç ”ç©¶ä¸€ä¸‹ï¼Œè¯´ä¸å®šé‡Œé¢æœ‰æ–°çš„æœºä¼šå’Œæ€è·¯ã€‚ å¯¹äºèµšé’±çš„äº‹ï¼Œå¤šç¢ç£¨ï¼Œå¤šå°è¯•ã€‚å½“ä½ ç¬¬ä¸€æ¬¡å°åˆ°ç”œå¤´ï¼Œä½ å°±èµ°åœ¨ä¸€æ¡å¿«è½¦é“ä¸Šäº†ã€‚ è®©ä½ è§‰å¾—å¬äº†ä¸èˆ’æœçš„è¯ï¼Œå¾€å¾€æ˜¯çœŸè¯ã€‚åˆ«äººå¯¹ä½ çš„æœ‰ä»·å€¼çš„æ‰¹è¯„ï¼Œå¾€å¾€æ˜¯ä½ æˆé•¿å’Œè¿›æ­¥çš„æœºä¼šã€‚ å‡å°‘æ— æ•ˆæ€è€ƒã€‚80%çš„äººéƒ½æ˜¯æ— èƒ½çš„ï¼Œå³ä½¿æ˜¯æœ‰èƒ½åŠ›çš„äººå½“ä¸­ï¼Œ80%çš„æ€è€ƒä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚å°½å¯èƒ½å‡å°‘æ— æ•ˆçš„æ€è€ƒæ—¶é—´ï¼Œå¤šæŠŠç²¾åŠ›å’Œæ—¶é—´æŠ•å…¥åˆ°è¡ŒåŠ¨ä¸­ã€‚ åˆ«è¢«é‚£äº›ä¸€å¤œæš´å¯Œçš„äº‹æƒ…å¿½æ‚ äº†ï¼Œç›¸ä¿¡æ—¶é—´ï¼Œç›¸ä¿¡ç§¯ç´¯ï¼Œé¡ºç€å¤§è¶‹åŠ¿æ…¢æ…¢åšï¼Œæ€»ä¼šèµ·æ¥ã€‚ é€‰æ‹©æ¯”åŠªåŠ›æ›´é‡è¦ã€‚æ€è€ƒæ–¹å¼çš„è½¬å˜æ¯”èƒ½åŠ›æå‡æ›´é‡è¦ï¼Œè¿™æ–¹é¢çš„å­¦ä¹ å’Œç ”ç©¶å¾ˆæœ‰ä»·å€¼ã€‚ å¦‚æœä½ æ— æ³•é‡Šæ€€è¿‡å»çš„ç—›è‹¦ï¼Œä¸è¦è´£æ€ªä½ è‡ªå·±ï¼Œå°½å¯èƒ½å®‰æ’ä¸€ä¸‹æœªæ¥ç”Ÿæ´»çš„å…´å¥‹ç‚¹ã€‚ å¿§è™‘çš„æ—¶å€™å°½å¯èƒ½ä¿æŒå¿™ç¢Œï¼ŒæŠŠèº«ä½“çš„èƒ½é‡ç”¨å®Œäº†ï¼Œå°±æ²¡æ—¶é—´ã€ç²¾åŠ›å¿§è™‘äº†ã€‚ æ¯å‘¨è‡³å°‘çº¦ä¸€ä¸ªå¯¹è‡ªå·±äº‹ä¸šã€ç”Ÿæ´»æœ‰å¸®åŠ©çš„æœ‹å‹åƒé¥­ã€‚ äººä¸äººä¹‹é—´å¾ˆéš¾çœŸæ­£ç†è§£ï¼Œä½ ä¹Ÿä¸éœ€è¦è¿™ä¹ˆå¤šäººç†è§£ä½ ï¼Œä¹Ÿä¸è¦ä¸ºäº†è®©åˆ«äººç†è§£ä½ åšå¤ªå¤šå°è¯•ã€‚ä¸“æ³¨äºæå‡è‡ªå·±çš„å®åŠ›ï¼Œå¤šåšä¸€äº›è®©åˆ«äººæ•¬ä½©ä½ çš„äº‹æƒ…ã€‚ ç›¸æ¯”äºè®¤æ¸…ä¸–ç•Œï¼Œæ›´éš¾çš„æ˜¯è®¤æ¸…è‡ªå·±ã€‚å¯¹è‡ªå·±æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†åï¼Œéœ€è¦åšå–èˆåšé€‰æ‹©ï¼Œæ‰ä¼šæœ‰åˆ¤æ–­ä¾æ®ã€‚ é è°±ä¸ä»…æ˜¯ä¸€ç§äººæ ¼ï¼Œä¹Ÿæ˜¯ä¸€ç§è¥é”€ç­–ç•¥ã€‚å› ä¸ºè¿™ä¸ªä¸–ç•Œå¤§éƒ¨åˆ†äººéƒ½ä¸é è°±ï¼Œä½ è¦æ˜¯ç›¸å¯¹é è°±ï¼Œå¥½çš„èµ„æºã€æœºä¼šéƒ½ä¼šé¦–å…ˆæƒ³åˆ°ä½ ã€æ‰¾åˆ°ä½ ã€‚èƒ½åœ¨æ··æ²Œä¸€ç‰‡çš„ä¸–ç•Œé‡Œå¿«é€ŸæŠŠè‡ªå·±çš„å“ç‰Œè¥é”€å‡ºå»ã€‚ æ€æƒ³æ·±åº¦å’Œå¿«ä¹æ˜¯æˆåæ¯”çš„ï¼Œé™¤äº†èµšé’±ç›¸å…³çš„äº‹æƒ…ï¼Œå…¶ä»–äº‹æƒ…æ²¡å¿…è¦æ·±ç©¶ï¼Œå¾’å¢çƒ¦æ¼ã€‚ä¸è¦è§‰å¾—å‡å°‘å°±å˜æˆä¸€ä¸ªå¿«ä¹çš„ç¬¨è›‹äº†ï¼Œä½ æ€è€ƒå¤ªå¤šã€å¿§è™‘å¤ªå¤šï¼Œä½ åªæ˜¯å˜æˆä¸€ä¸ªå¿§å¿ƒå¿¡å¿¡çš„ç¬¨è›‹ç½¢äº†ã€‚ å­¦ä¹ æœ€é‡è¦çš„ï¼Œä¸æ˜¯æŠŠ10åˆ†çš„ç²¾åŠ›éƒ½èŠ±åœ¨å¸æ”¶æ–°çŸ¥è¯†ä¸Šï¼Œè€Œæ˜¯3åˆ†å­¦ä¹ ï¼Œ7åˆ†ç»ƒä¹ å’Œå®è·µã€‚ ç®€å•çš„äº‹æƒ…åå¤åšï¼Œå°±èƒ½æˆé•¿ï¼›å¤æ‚çš„äº‹æƒ…ç®€å•åšï¼Œå°±èƒ½æˆåŠŸã€‚åŒä¸€ä¸ªæŠ€èƒ½åå¤ç»ƒä¹ 100æ¬¡ï¼Œé‚£ä¸ªæŠ€èƒ½å°±æ˜¯ä½ çš„ï¼›åŒä¸€ä¸ªé¢†åŸŸçš„äº‹æƒ…åšå¯¹100æ¬¡ï¼Œé‚£ä¸ªé¢†åŸŸçš„é’±å°±æ˜¯ä½ çš„ã€‚ è¿·èŒ«çš„æ—¶å€™ï¼Œå°±æŠŠèƒ½åšå¥½çš„äº‹æƒ…è¸å®åšå¥½å°±è¡Œã€‚å¤šå…³æ³¨è‡ªå·±åŠ›æ‰€èƒ½åŠçš„å°äº‹ï¼Œå°æˆåŠŸç§¯ç´¯å¤šäº†ï¼Œå°±æœ‰å¤§æˆåŠŸçš„æœºä¼šã€‚ã€‚ äººç”Ÿå¸¸å¸¸å°±åƒå µè½¦ï¼Œå¿ƒé‡Œåˆ«æ·»å µã€‚å¾ˆå¤šæ—¶å€™å µåœ¨é‡Œé¢ï¼Œä½ ä¹Ÿä¸è¦å¿ƒæ€¥ã€‚èƒ½èµ°å‡ æ­¥èµ°å‡ æ­¥ï¼Œèµ°ä¸åŠ¨çš„æ—¶å€™æ­‡ç€ï¼Œç­‰è½¦æµæ…¢æ…¢æ¢å¤äº†ï¼Œåˆç»§ç»­èµ°ã€‚ æœ‰è´£ä»»æ„Ÿæœ‰æ‹…å½“çš„äººï¼Œå¾€å¾€éƒ½æ´»å¾—æ¯”è¾ƒç´¯ï¼Œå› ä¸ºè¦æ“å¿ƒçš„äº‹å„¿å¤ªå¤šã€‚ä½ å¦‚æœæ˜¯è¿™æ ·çš„äººï¼Œæ¥å—è¿™æ ·çš„äº‹å®ï¼Œå°½å¯èƒ½å¦ç„¶é¢å¯¹äº‹ä¸šã€ç”Ÿæ´»ã€å®¶åº­ä¸­çš„è‹¦ä¸ä¹ã€‚ åšäººä¸è¦å¤ªå®¹æ˜“å¤šæ„å–„æ„Ÿï¼Œä¸ç„¶å®¹æ˜“æˆä¸ºloserã€‚ ç”Ÿæ´»çš„å¸¸æ€å°±æ˜¯å¹³æ·¡ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è§„åˆ’æœªæ¥çš„æ—¶å€™ï¼Œå°½å¯èƒ½è¿˜æ˜¯ä¸ºç”Ÿæ´»å®‰æ’ä¸€äº›å…´å¥‹ç‚¹ã€‚ æ¯ä¸ªäººçš„ç”Ÿæ´»éƒ½éœ€è¦æœ‰ä¸€ä¸ªæ”¯ç‚¹ï¼Œä¸ç®¡æ˜¯è®©ä½ å……æ»¡æˆå°±æ„Ÿçš„äº‹ä¸šã€è¿˜æ˜¯ä½ ç–¼çˆ±çš„çˆ±äººï¼Œè¿˜æ˜¯ä½ çš„æ¸©æš–å®¶åº­ï¼Œè¿˜æ˜¯ä½ çš„çŸ¥å¿ƒæŒšå‹ã€è€å¸ˆã€è´µäººï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªçˆ±å¥½ã€‚è‡³å°‘è¦æœ‰ä¸€ä¸ªè¿™æ ·çš„æ”¯ç‚¹ï¼Œèƒ½å¤Ÿæ”¯æ’‘èµ·ä½ çš„ç”Ÿå‘½ã€‚å³ä½¿åœ¨ä½ è¿·èŒ«ã€æ— åŠ©ã€æ‚²ä¼¤çš„æ—¶å€™ï¼Œè¿™ä¸ªæ”¯ç‚¹èƒ½æ”¯æ’‘ä½ èµ°è¿‡æœ€è‰°éš¾çš„æ—¶åˆ»ã€‚èƒ½è®©ä½ çš„ç²¾ç¥éšæ—¶æœ‰åœ°æ–¹å¯ä»¥å€šé ã€‚ è½¬è½½è‡ªï¼š http://mp.weixin.qq.com/s/PjlLbikJHSM4PKwpmTkL9g","categories":["ç¾æ–‡èµæ"]},{"title":"ç¨‹åºå‘˜å¦‚ä½•æå‡è‡ªèº«ä»·å€¼ã€è½¬è½½ã€‘","path":"/post/618632730.html","content":"ç¨‹åºå‘˜è–ªæ°´æœ‰é«˜æœ‰ä½ï¼Œæœ‰çš„äººä¸€ä¸ªæœˆå¯èƒ½æ‹¿30Kã€50Kï¼Œæœ‰çš„äººå¯èƒ½åªæœ‰2Kã€3Kã€‚åŒæ ·æœ‰äº”å¹´å·¥ä½œç»éªŒçš„ç¨‹åºå‘˜ï¼Œå¯èƒ½ä¸€ä¸ªäººæ¯æœˆæ‹¿20Kï¼Œä¸€ä¸ªæ‹¿5Kã€‚æ˜¯ä»€ä¹ˆå› ç´ å¯¼è‡´äº†è¿™ç§å·®å¼‚ï¼Ÿæˆ‘ç‰¹æ„æ€»ç»“äº†å®¹æ˜“å¯¼è‡´è–ªæ°´ä½çš„ä¹å¤§è¡Œä¸ºè¡¨ç°ï¼Œé¿å¼€è¿™äº›å¤§å‘ï¼Œä½ å°±ç¦»é«˜è–ªä¸è¿œäº†ã€‚ 1. ä¹ æƒ¯å³åˆ»å›æŠ¥ä»–ä¸æ‡‚å¾—åªæœ‰æ˜¥å¤©æ’­ç§ï¼Œç§‹å¤©æ‰ä¼šæœ‰æ”¶è·ã€‚åˆšåˆšä»˜å‡ºä¸€ç‚¹ç‚¹ï¼Œç”šè‡³è¿˜æ²¡æœ‰ä»˜å‡ºï¼Œå°±æƒ³è¦å¾—åˆ°å›æŠ¥ã€‚æŠ€æœ¯åˆšåˆšæŒæ¡ï¼Œèƒ½ä¸€è¾¹ç™¾åº¦ä¸€è¾¹å¹²æ´»äº†å°±è§‰å¾—è¯¥æ‹¿åˆ°å¤šå°‘å¤šå°‘é’±äº†ã€‚æ‰¾å·¥ä½œå…ˆæƒ³ç€å¤šå°‘å¤šå°‘é’±ï¼Œå…¥èŒäº†æ²¡å¹²å‡ ä¸ªæœˆå°±æƒ³ç€è¦åŠ å¤šå°‘å¤šå°‘é’±ï¼Œå¹²äº†æ²¡å‡ ä¸ªæœˆï¼Œè–ªæ°´è¦æ˜¯æ²¡æ¶¨ï¼Œå°±æ”¾å¼ƒäº†ï¼Œå‡†å¤‡é€šè¿‡è·³æ§½åŠ è–ªï¼Œä¸è·³æ§½çš„è¯ï¼Œå¾€å¾€ä¹Ÿä¼šå› ä¸ºæ²¡åŠ è–ªè€Œç‰¢éªšæ»¡è…¹ï¼Œå·¥ä½œæ•·è¡äº†äº‹ã€‚ ä¸€ä¸ªç¨‹åºå‘˜çš„ä»·å€¼ï¼Œæ˜¯é€šè¿‡ä»–å¸¦ç»™å…¬å¸çš„ä»·å€¼ä½“ç°çš„ã€‚å…ˆç»™å…¬å¸å¸¦æ¥äº†ä»·å€¼ï¼Œç„¶åæ‰ä¼šåè¿‡æ¥åœ¨è–ªæ°´ä¸Šä½“ç°å‡ºè‡ªå·±çš„ä»·å€¼ã€‚å…¬å¸éƒ½å¾ˆç°å®ï¼Œå¾ˆå°‘ä¼šä¸ºä½ çš„æ½œåŠ›ä¹°å•ï¼Œåœ¨ä½ è¿˜æ²¡æœ‰ä½“ç°å‡ºä»·å€¼æ—¶å°±ç»™ä½ å¾ˆé«˜çš„è–ªæ°´ã€‚ åœ¨ç”Ÿæ´»å’Œå·¥ä½œä¸­ï¼Œä¸€å®šè¦æ‡‚å¾—ä»˜å‡ºï¼Œä¸è¦é‚£ä¹ˆæ€¥åŠŸè¿‘åˆ©ï¼Œé©¬ä¸Šæƒ³å¾—åˆ°å›æŠ¥ã€‚å¤©ä¸‹æ²¡æœ‰ç™½åƒçš„åˆé¤ï¼Œä½ æƒ³è·å¾—ä»€ä¹ˆï¼Œå°±å¾—å…ˆä»˜å‡ºä»€ä¹ˆã€‚å”¯æœ‰ç§ä¸‹ç§å­ï¼Œç„¶åæµ‡æ°´ã€æ–½è‚¥ã€é™¤è‰ã€æ€è™«ï¼Œç„¶åæ‰èƒ½ç­‰æ¥æ”¶è·ã€‚ 2. ç¼ºä¹å­¦ä¹ çƒ­æƒ…å¾ˆå°‘æœ‰å“ªä¸ªå²—ä½çš„äººåƒç¨‹åºå‘˜è¿™æ ·éœ€è¦æŒç»­ä¸æ–­çš„å­¦ä¹ ï¼Œè½¯ä»¶å¼€å‘çš„æŠ€æœ¯æ—¥æ–°æœˆå¼‚ï¼Œè€Œæ¯ä¸€é¡¹æŠ€æœ¯åˆå¾€å¾€åšå¤§ç²¾æ·±ï¼Œä¸æŒç»­ã€æ·±å…¥é’»ç ”æ˜¯å¾ˆéš¾æŒæ¡çš„ï¼Œæ›´åˆ«è°ˆç²¾é€šäº†ã€‚å¦‚æœä½ å¯¹ä¸€é¡¹æŠ€æœ¯ä¸èƒ½æ·±åˆ»ç†è§£ç†Ÿç»ƒåº”ç”¨ï¼Œè¡¨ç°å‡ºæ¥çš„æ°´å‡†ä»…ä»…æ˜¯èƒ½å¹²æ´»ã€è¿˜è¡Œï¼Œé‚£å¾ˆéš¾è¯´ä¼šæœ‰å…¬å¸æ„¿æ„ä¸ºâ€œè¿˜è¡Œâ€ä»˜å‡ºå¤§çš„ä»£ä»·ï¼Œåªæœ‰è„±é¢–è€Œå‡ºï¼Œæ‰å¯èƒ½å¤‡å—é‡è§†ã€‚ å‡å¦‚ä½ å¯¹å­¦ä¹ ã€æŒæ¡ã€ç²¾é€šæŠ€æœ¯æ²¡æœ‰å…´è¶£ï¼Œé¢å¯¹ä¸æ–­æ¶Œç°çš„æ–°è¯­è¨€æ–°æŠ€æœ¯æ–°æ¡†æ¶æ²¡æœ‰å­¦ä¹ æ¬²æœ›ï¼Œé‚£ä½†å°±è½¯ä»¶å¼€å‘è¿™ä¸ªå·¥ä½œè€Œè¨€ï¼Œä½ ä¸ä½†çœ¼ä¸‹ä¸å¤ªå¯èƒ½æ‹¿åˆ°é«˜è–ªï¼Œå°†æ¥ä¹Ÿä¸ä¼šã€‚åœ¨è¿™æ ·ä¸€ä¸ªå¿«é€Ÿå˜åŒ–çš„æ—¶ä»£ï¼Œåªæœ‰ä¸æ–­åœ°å­¦ä¹ æ‰ä¸ä¼šè¢«æŠ›å¼ƒã€‚ 3. ä¸å¤ŸåŠªåŠ›è™½ç„¶æˆ‘ä»¬éƒ½çŸ¥é“åŠªåŠ›å­¦ä¹ å¯ä»¥æ”¹å˜æˆ‘ä»¬çš„æŠ€èƒ½æ°´å¹³ï¼ŒæŒç»­åŠªåŠ›ä¸æ‡ˆåšæŒå¯ä»¥è®©è‡ªå·±æœ‰æ‰€å»ºæ ‘ï¼Œå¯è¿˜æ˜¯æœ‰å¾ˆå¤šäººæµ…å°è¾„æ­¢ï¼Œä¸‰å¤©æ‰“é±¼ä¸¤å¤©æ™’ç½‘ï¼Œæä¸¤ä¸‹èƒ½Runå°±æ”¾ä¸‹äº†ã€‚ äººå’Œäººåœ¨èªæ˜æ‰æ™ºä¸Šçš„å·®è·å¹¶æ²¡æœ‰æƒ³è±¡ä¸­å¤§ï¼Œç”šè‡³å¾ˆå¤šæ—¶å€™ï¼Œä»å¤§å¤šæ•°äººçš„åŠªåŠ›ç¨‹åº¦ä¹‹ä½æ¥çœ‹ï¼Œæ ¹æœ¬è¿˜è½®ä¸åˆ°æ‹¼å¤©èµ‹ã€‚å¦‚æœä¸¤ä¸ªäººçš„å®åŠ›åŠæ–¤å…«ä¸¤çš„è¯ï¼Œçƒ­æƒ…å·¥ä½œåŠªåŠ›åšæŒçš„äººï¼Œä¸€å®šæ¯”è¾ƒå®¹æ˜“æˆåŠŸã€‚ 4. ç•éš¾åšäº‹æ‹ˆè½»æ€•é‡ï¼Œä¸æ„¿æŒ‘æˆ˜ã€‚æ®Šä¸çŸ¥èƒ½åŠ›å°±æ˜¯åœ¨ä¸æ–­æŒ‘æˆ˜ä¸æ–­çªç ´è‡ªå·±çš„è¿‡ç¨‹ä¸­å†ç»ƒå‡ºæ¥çš„ã€‚åœ¨ä¸€ä¸ªå…¬å¸é‡Œé¢ï¼Œç»å¸¸æ‰¿æ‹…é«˜éš¾åº¦ä»»åŠ¡çš„ç¨‹åºå‘˜ï¼Œä¸€å®šæ˜¯æˆé•¿æ¯”è¾ƒå¿«çš„ï¼Œè–ªæ°´å¢é•¿ä¹Ÿä¸€å®šæ˜¯æ¯”è¾ƒå¿«çš„ã€‚è¶Šæ˜¯å›°éš¾çš„äº‹æƒ…ï¼Œè¶Šèƒ½ä½“ç°å‡ºä¸ªäººä»·å€¼ï¼Œä¹Ÿè¶Šèƒ½å¸¦ç»™ä¸ªäººæˆé•¿ã€‚ ä¸‡äº‹èµ·å¤´éš¾ï¼Œä¸è¦å®³æ€•å›°éš¾ã€‚äº‹æƒ…åšä¸å¥½å¾€å¾€ä¸æ˜¯å› ä¸ºæ²¡æœ‰èƒ½åŠ›ï¼Œå¤§éƒ½æ˜¯ç”±äºç¼ºä¹æ’å¿ƒã€‚åªè¦ä¸æ€•å›°éš¾ï¼ŒåšæŒå‰è¡Œï¼Œä¸€å®šä¼šæœ‰ä¸ä¸€æ ·çš„æ”¶è·ã€‚ äº‹ä¸šå°±åƒå¥³äººï¼Œè°å»è¿½æ±‚ï¼Œè°å°±èƒ½å¾—æ‰‹ã€‚é‡‘é’±ä¹Ÿä¸€æ ·ã€‚ 5. ç¼ºä¹è´£ä»»å¿ƒå·¥ä½œä¸Šä¸ç®¡ä»€ä¹ˆäº‹å„¿ï¼Œåæ­£ä¸æ˜¯è‡ªå·±çš„äº‹å„¿ï¼Œç¼ºä¹è´£ä»»å¿ƒï¼Œå¹²å¥½å¹²ä¸å¥½éƒ½æ— æ‰€è°“ï¼Œå¯¹äº¤ä»˜æ‰¿è¯ºã€å¯¹äº§å“è´¨é‡éƒ½ä¸åœ¨æ„ï¼Œæ²¡ä»€ä¹ˆäº‹å„¿èƒ½è®©ä»–ä¸Šå¿ƒã€‚ ä¸€ä¸ªäººçš„è´£ä»»å¿ƒå¦‚ä½•ï¼Œå†³å®šç€ä»–åœ¨å·¥ä½œä¸­çš„æ€åº¦ï¼Œå†³å®šç€å…¶äº‹ä¸šçš„å¥½åå’Œæˆè´¥ã€‚å¦‚æœä¸€ä¸ªäººæ²¡æœ‰è´£ä»»å¿ƒï¼Œå³ä½¿ä»–æœ‰å†å¤§çš„èƒ½è€ï¼Œä¹Ÿä¸ä¸€å®šèƒ½åšå‡ºå¥½çš„æˆç»©æ¥ã€‚ 6. æ¶ˆæï¼ŒæŠ±æ€¨å·¥ä½œç¨æœ‰ä¸é¡ºï¼Œå°±æ€¨æ°”æ²¸è…¾ï¼Œè¿™ä¸ªæ€ä¹ˆæ€ä¹ˆæ ·ï¼Œé‚£ä¸ªæ€ä¹ˆæ€ä¹ˆæ ·ï¼Œè€Œæˆ‘æ€ä¹ˆå°±è¿™æ ·ï¼Œä»»åŠ¡ä¸å…¬å¹³ï¼Œèµ„æºä¸å…¬å¹³ï¼Œé‚£è°è°ä¸æ”¯æŒæˆ‘ï¼Œé‚£è°è°ä¸é…åˆâ€¦â€¦ æŠ±æ€¨ä¸èƒ½ä½¿äº‹æƒ…å˜å¥½ï¼Œåä¹‹ï¼Œå®ƒä¼šè®©è´Ÿé¢æƒ…ç»ªè”“å»¶ï¼Œèš•é£Ÿä½ çš„ç²¾åŠ›å’Œæ—¶é—´ï¼Œè®©ä½ äº§å‡ºæ›´ä½ã€‚æˆåŠŸè€…æ°¸ä¸æŠ±æ€¨ï¼ŒæŠ±æ€¨è€…æ°¸ä¸æˆåŠŸã€‚ç«‹åˆ»åœæ­¢æŠ±æ€¨ï¼Œæ—©ä¸€åˆ†é’Ÿåœæ­¢ï¼Œä½ å°±ç¦»ç›®æ ‡è¿‘ä¸€åˆ†é’Ÿã€‚ 7. æ²¡æœ‰æ—¶é—´ç®¡ç†è§‚å¿µæ¯ä¸ªäººçš„ä¸€å¤©éƒ½åªæœ‰24å°æ—¶ï¼Œäººå’Œäººçš„å·®åˆ«å°±åœ¨äºå¦‚ä½•åˆ©ç”¨æ—¶é—´ä¸Šã€‚ æœ‰çš„äººæ¯å‘¨éƒ½æœ‰ç›®æ ‡ï¼Œæ¯å¤©éƒ½æœ‰è®¡åˆ’ï¼Œæ—©ä¸Šèµ·æ¥ä¼šæƒ³ä»Šå¤©è¦åšçš„å‡ ä»¶é‡è¦çš„äº‹ï¼Œæ™šä¸Šä¼šå›é¡¾ä»Šå¤©å®Œæˆçš„äº‹ï¼Œæ€»ç»“å¹²æˆäº†ä»€ä¹ˆå¹²åäº†ä»€ä¹ˆï¼Œè¿˜ä¼šæœ‰è®¡åˆ’çš„å­¦ä¹ æ–°çŸ¥è¯†æ–°æŠ€èƒ½ï¼Œè¿™æ ·æ—¥ç§¯æœˆç´¯ä¸æ–­åšæŒï¼Œæ¯ä¸€å¤©éƒ½æ˜¯é«˜æ•ˆçš„ï¼Œæ¯ä¸€å¤©éƒ½æœç€æ›´ä¸°å¯Œæ›´å®Œç¾çš„è‡ªå·±å‰è¿›ã€‚ è€Œæœ‰çš„äººåˆ™æ¼«æ— ç›®çš„ï¼Œèµ°å“ªç®—å“ªï¼Œåˆ°äº†å…¬å¸ï¼Œä¸ŠåˆåŸºæœ¬åšä¸æˆäº‹å„¿ï¼Œåˆ°ä¸‹åˆäº†è¿˜ä¸çŸ¥é“è¦åšä»€ä¹ˆï¼Œæ™šä¸Šä¹Ÿå‘æ„å¦‚ä½•æ¶ˆç£¨æ—¶é—´â€¦â€¦ 8. ä¸ºè–ªæ°´å·¥ä½œè™½ç„¶å·¥ä½œçš„ä¸€å¤§ç›®çš„æ˜¯è·å–è–ªæ°´ï¼Œå…»æ´»è‡ªå·±ä»¥åŠä¾›ç»™å®¶åº­æ‰€éœ€ï¼›ä½†æ˜¯ï¼Œè¿™åªæ˜¯å·¥ä½œæœ€ç›´æ¥çš„æŠ¥å¿ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€ä½çº§çš„ç›®æ ‡ã€‚ å¦‚æœæˆ‘ä»¬ä¸ºè–ªæ°´è€Œå·¥ä½œï¼Œå°†æ³¨å®šæˆ‘ä»¬æ˜¯çŸ­è§†çš„ï¼Œä¹Ÿå°†æ³¨å®šå—åˆ°æœ€æ·±çš„ä¼¤å®³ã€‚å‡å¦‚ä½ çœ‹ä¸åˆ°å·¥èµ„ä»¥å¤–çš„ä¸œè¥¿ï¼Œæ–¤æ–¤è®¡è¾ƒäºè–ªæ°´ã€ç¦åˆ©ã€èŒä½ç­‰ï¼Œé‚£å¤–ç•Œçš„äº›å¾®é£å¹è‰åŠ¨å°±å¯èƒ½è®©ä½ åƒæµ®èä¸€æ ·é£˜æ¥è¡å»ï¼Œä½ å¾ˆå¿«å°±ä¼šå¤±å»å¹³è¡¡ï¼Œå¤±å»ä¿¡å¿ƒï¼Œå¤±å»çƒ­æƒ…ï¼Œå¤±å»å¹³å’Œï¼Œè¿›è€Œåœ¨å·¥ä½œæ—¶æ€»æ˜¯é‡‡å–ä¸€ç§åº”ä»˜äº†äº‹çš„æ€åº¦ï¼Œèƒ½å°‘åšå°±å°‘åšï¼Œèƒ½èº²é¿å°±èº²é¿ï¼Œè§‰å¾—åªè¦å¯¹å¾—èµ·è‡ªå·±çš„é‚£ä»½è–ªæ°´å°±æˆäº†ã€‚é•¿æ­¤ä»¥å¾€ï¼Œä½ è¿½æ±‚çš„é«˜è–ªæ°´åå€’å¾—ä¸åˆ°ã€‚ æˆ‘ä»¬è¿›å…¥ä¸€ä¸ªå…¬å¸å·¥ä½œï¼Œæ˜¯ä¸ºäº†è‡ªå·±ï¼Œä¸æ˜¯è–ªæ°´ä¹Ÿä¸æ˜¯åˆ«äººï¼Œæ¯”è–ªæ°´æ›´é‡è¦çš„ï¼Œæ˜¯æˆé•¿å’Œæˆå°±è‡ªå·±çš„æœºä¼šã€‚æˆ‘ä»¬ä¸€å®šè¦æ˜ç™½ï¼Œå…¬å¸ã€ä¼ä¸šã€ç»„ç»‡ï¼Œéƒ½æ˜¯æˆ‘ä»¬é”»ç‚¼è‡ªå·±ã€ä¿®ç‚¼è‡ªæˆ‘çš„å¹³å°ï¼Œæˆ‘ä»¬ä¸æ˜¯ä¸ºè–ªæ°´å·¥ä½œã€ä¸æ˜¯ä¸ºè€æ¿å·¥ä½œã€ä¸æ˜¯ä¸ºå®¶äººå·¥ä½œï¼Œæ˜¯ä¸ºå®ç°è‡ªæˆ‘è€Œå·¥ä½œï¼Œæ˜¯ä¸ºæ›´å®Œç¾çš„è‡ªå·±è€Œå·¥ä½œã€‚ å”¯æœ‰å¿—å­˜é«˜è¿œï¼Œæ–¹èƒ½é£è¡Œå¤©ä¸‹ã€‚ 9. å…¶å®ä¸å–œæ¬¢è½¯ä»¶å¼€å‘æœ‰ä¸€éƒ¨åˆ†äººä»äº‹è½¯ä»¶å¼€å‘å·¥ä½œï¼Œå¹¶ä¸æ˜¯å› ä¸ºå–œæ¬¢ï¼Œä¹Ÿæ²¡æœ‰å¹²ç€å¹²ç€ä»ä¸å–œæ¬¢å˜æˆå–œæ¬¢ã€‚ä»–ä»¬å¯èƒ½æ˜¯å–œæ¬¢è½¯ä»¶å¼€å‘é™„å¸¦çš„é«˜è–ªæ°´â€”â€”å¹³å‡è–ªæ°´æ¯”å…¶ä»–è¡Œä¸šé«˜ã€‚äººåšä¸€ä»¶è‡ªå·±ä¸å–œæ¬¢çš„äº‹æƒ…æ—¶ï¼Œå¿ƒç†ä¸Šæ²¡æœ‰äº²è¿‘æ„Ÿï¼Œä¸ä¼šæƒ³ç€æ€æ ·æŠŠäº‹æƒ…åšå¾—æ›´å¥½ï¼Œå¾€å¾€æ˜¯å·®ä¸å¤šå°±æˆäº†ï¼Œä¸å¤ªå¯èƒ½æœ‰ç²¾ç›Šæ±‚ç²¾ç§¯æå‘ä¸Šçš„è¿½æ±‚ã€‚å› ä¸ºåœ¨åšä¸å–œæ¬¢çš„äº‹æƒ…æ—¶ï¼Œæƒ…æ„Ÿä¸Šæ˜¯æ‹’ç»çš„ï¼Œæƒ…ç»ªä¸Šæ˜¯æƒ³é€ƒç¦»çš„ï¼Œæ€»æƒ³ç€æ—©ç‚¹å„¿å®Œäº‹å„¿æ‹‰å€’ï¼Œæ¯ä¸€å¤©å»å•ä½æ—¶ä¸æ˜¯å……æ»¡æœŸå¾…ï¼Œè€Œæ˜¯å„ç§æ‹…å¿§ã€çƒ¦èºã€ç•æƒ§ï¼Œåˆ°äº†å•ä½ï¼Œç¨æœ‰å›°éš¾æˆ–ä¸é¡ºå¿ƒï¼Œå°±ä¼šæ¶ˆæã€æŠ±æ€¨ã€æŠµè§¦ã€æ‹’ç»â€¦â€¦ åšå–œæ¬¢çš„äº‹ï¼Œèƒ½æœ€å¤§å¯èƒ½å‘æŒ¥ä¸€ä¸ªäººçš„æ½œèƒ½å’Œçƒ­æƒ…ï¼Œä¼šæœ€å¿«é€Ÿåœ°é€šå‘æˆåŠŸæˆå°±è‡ªå·±ã€‚è€Œåšä¸å–œæ¬¢çš„äº‹ï¼Œä¸€å¼€å§‹å°±æ³¨å®šäº†äº‹å€åŠŸåŠï¼Œæœ€åä¹Ÿå¾€å¾€ä¼šæ˜¯ç—›è‹¦ä¸å ªæˆ–åŠé€”è€ŒåºŸã€‚ è½¬è½½è‡ª: æœˆè–ª3ä¸‡çš„ç¨‹åºå‘˜éƒ½é¿å¼€äº†å“ªäº›å‘","categories":["ç¾æ–‡èµæ"]},{"title":"ä½¿ç”¨WinDbgè°ƒè¯•å…³é”®åŒºæ­»é”","path":"/post/3177767322.html","content":"æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨WinDbgæ¥è°ƒè¯•Windows CriticalSectionæ­»é”çš„é—®é¢˜ã€‚ ä¸€. æ¼”ç¤ºç¤ºä¾‹è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®åŒºé”æ­»é—®é¢˜çš„ç¨‹åºï¼Œè¿è¡Œä¹‹åä¾æ¬¡ç‚¹å‡»â€œCSé”æ­»â€æŒ‰é’®ã€å³ä¸Šè§’é€€å‡ºæŒ‰é’®ï¼Œç¨‹åºå°±ä¼šå¡æ­»ã€‚ å¯¹äºçœ¼ä¸‹çš„è¿™ä¸ªé—®é¢˜ï¼Œç•Œé¢å®Œå…¨å¤±å»å“åº”ï¼Œè¿™è¯´æ˜è´Ÿè´£æ¶ˆæ¯å¤„ç†çš„UIçº¿ç¨‹é˜»å¡äº†ã€‚ å¯¹äºå‡ ä¹æ‰€æœ‰çš„windows GUIç¨‹åºï¼Œç¼–å·ä¸º0çš„åˆå§‹çº¿ç¨‹å°±æ˜¯UIçº¿ç¨‹ï¼Œwindowså‘ç°è¯¥ç•Œé¢ä¸€æ®µæ—¶é—´æ²¡æœ‰æ¶ˆæ¯å“åº”ä¹‹åå°±ä¼šåœ¨æ ‡é¢˜åé¢åŠ ä¸Šâ€œï¼ˆæœªå“åº”ï¼‰â€ã€‚ äºŒ. WinDbgè°ƒè¯•å¯åŠ¨Windbgï¼Œé™„åŠ åˆ°æ‰§è¡Œè¿›ç¨‹ï¼ˆF6ï¼‰ã€‚ ~*knv3æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œæ•°å­—3è¡¨ç¤ºæ˜¾ç¤ºçš„å †æ ˆæ·±åº¦ï¼Œçœç•¥å³æ˜¾ç¤ºå®Œæ•´å †æ ˆã€‚ #0å·çº¿çš„æ ˆå¸§0è¡¨ç¤ºçº¿ç¨‹ç¨‹é˜»å¡åœ¨NtWaitForSingleObjectå‡½æ•°ï¼ŒMSDNå¾—çŸ¥è¯¥å‡½æ•°åŸå‹ä¸ºï¼š 12345NTSTATUS WINAPI NtWaitForSingleObject( _In_ HANDLE Handle, _In_ BOOLEAN Alertable, _In_ PLARGE_INTEGER Timeout); ç¬¬ä¸€ä¸ªå‚æ•°Handleä¸ºå…¶ç­‰å¾…çš„å¥æŸ„ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°TimeOutä¸ºè¶…æ—¶æ—¶é—´ã€‚åŒæ ·ä»æ ˆå¸§0å¾—çŸ¥NtWaitForSingleObjectæ­£åœ¨ç­‰å¾…å¥æŸ„000000c4ï¼Œè¶…æ—¶æ—¶é—´ä¸º0ï¼ˆå³æ²¡ä¿¡å·å°±ä¸€ç›´ç­‰å¾…ï¼‰ã€‚ !handle 000000c4 f å‘½ä»¤æŸ¥çœ‹000000c4å¥æŸ„çš„ä¿¡æ¯ï¼š ç°åœ¨æˆ‘ä»¬çŸ¥é“c4å¥æŸ„å°±æ˜¯çº¿ç¨‹ID:20d0çš„å¥æŸ„ï¼Œä¸»çº¿ç¨‹åœ¨é€€å‡ºçš„æ—¶å€™ç­‰å¾…è¯¥çº¿ç¨‹é€€å‡ºï¼Œè€Œè¯¥çº¿ç¨‹ä¸€ç›´æ²¡æœ‰é€€å‡ºï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å¡æ­»äº†ã€‚ æ ¹æ®å›¾3å¾—çŸ¥20d0çº¿ç¨‹å°±æ˜¯#1çº¿ç¨‹ï¼Œ~1kvnæŸ¥çœ‹è¯¥çº¿ç¨‹å®Œæ•´å †æ ˆï¼š æ ˆå¸§00 NtWaitForSingleObjectè¡¨ç¤ºçº¿ç¨‹åœ¨ç­‰å¾…000000c0å¥æŸ„ã€‚ !handle!handle 000000c0 fæŸ¥çœ‹å¥æŸ„ä¿¡æ¯ï¼Œå¾—çŸ¥c0å¥æŸ„ä¸ºäº‹ä»¶å¥æŸ„ï¼š 123456789101112130:002&gt; !handle c0 fHandle c0 Type Event Attributes 0 GrantedAccess 0x100003: Synch QueryState,ModifyState HandleCount 2 PointerCount 4 Name &lt;none&gt; Object Specific Information Event Type Auto Reset Event is Waiting !locks!locksæŸ¥çœ‹è¿›ç¨‹ä¸­å“ªäº›é”å¤„äºé”å®šçŠ¶æ€ï¼š ä»ç¬¬ä¸€è¡Œç»“æœå¯ä»¥å¾—çŸ¥æ˜¯gcsNameä¸´ç•ŒåŒºï¼ˆéœ€è¦æœ‰pdbæ‰ä¼šæ˜¾ç¤ºå…·ä½“å˜é‡åï¼‰å¤„äºé”å®šçŠ¶æ€ã€‚ å…¶å®ï¼Œæˆ‘ä»¬ä»æ ˆå¸§02 RtlEnterCriticalSectionä¹Ÿå¯ä»¥å¾ˆå¿«çš„çŸ¥é“è¯¥çº¿ç¨‹ä¸€ç›´åœ¨ç­‰å¾…è¿›å…¥å…³é”®åŒºã€‚ ç»è¿‡åˆ†æï¼ŒçŸ¥é“ç¨‹åºæ— æ³•é€€å‡ºçš„åŸå› äº†ï¼šçº¿ç¨‹#1ä¸­çš„å…³é”®åŒºgcsNameå¤„äºé”å®šçŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯ä¸€ç›´ç­‰å¾…è¿›å…¥å…³é”®åŒºï¼‰ï¼Œå¯¼è‡´çº¿ç¨‹#1é˜»å¡æ— æ³•æ‰§è¡Œã€‚åˆå› ä¸»çº¿ç¨‹åœ¨é€€å‡ºçš„æ—¶å€™æ‰§è¡Œäº†WaitForSingleObjectç­‰å¾…#1çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ä¸»çº¿ç¨‹å¡æ­»ã€‚ RTL_CRITICAL_SECTIONç»“æ„å…³é”®åŒºæœºåˆ¶ä¸»è¦æ˜¯é€šè¿‡ä¸‹é¢è¿™æ ·çš„RTL_CRITICAL_SECTIONç»“æ„æ¥å®ç°çš„ï¼Œå¯ä»¥é€šè¿‡dtå‘½ä»¤æŸ¥çœ‹è¯¥ç»“æ„å®šä¹‰ï¼š 123456780:002&gt; dt RTL_CRITICAL_SECTIONTest1!RTL_CRITICAL_SECTION +0x000 DebugInfo : Ptr32 _RTL_CRITICAL_SECTION_DEBUG +0x004 LockCount : Int4B +0x008 RecursionCount : Int4B +0x00c OwningThread : Ptr32 Void +0x010 LockSemaphore : Ptr32 Void +0x014 SpinCount : Uint4B å…¶ä¸­ï¼ŒLockCountå­—æ®µç”¨æ¥æ ‡è¯†å…³é”®åŒºçš„é”çŠ¶æ€ï¼ŒRecursionCountå­—æ®µç”¨æ¥è®°å½•é€’å½’æ¬¡æ•°ï¼Œç”¨æ¥æ”¯æŒåŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è¿›å…¥å…³é”®åŒºï¼ŒOwningThreadå­—æ®µç”¨æ¥è®°å½•è¿›å…¥ï¼ˆæ‹¥æœ‰ï¼‰å…³é”®åŒºçš„çº¿ç¨‹IDï¼ŒLockSemaphoreç”¨æ¥è®°å½•è¿™ä¸ªå…³é”®åŒºå¯¹åº”çš„äº‹ä»¶å¯¹è±¡ï¼Œå½“æœ‰çº¿ç¨‹éœ€è¦ç­‰å¾…è¿™ä¸ªå…³é”®åŒºæ—¶ï¼Œä¾¿æ˜¯é€šè¿‡ç­‰å¾…è¿™ä¸ªäº‹ä»¶æ¥åšåˆ°çš„ï¼Œè¿™ä¸ªäº‹ä»¶å¯¹è±¡æ˜¯æŒ‰éœ€åˆ›å»ºçš„ï¼Œå¦‚æœLockSemaphoreä¸ºNULLè¡¨ç¤ºè¿™ä¸ªå…³é”®åŒºä»æ¥æ²¡æœ‰çº¿ç¨‹åœ¨æ­¤ç­‰å¾…è¿‡ã€‚ é€šè¿‡å›¾6ä¸­çš„OwningThread&#x3D;738å¾—çŸ¥ï¼Œå…³é”®åŒºè¢«çº¿ç¨‹IDä¸º738çš„çº¿ç¨‹æ‰€æ‹¥æœ‰ï¼Œå³Enterä¹‹åä¸€ç›´æ²¡æœ‰Leaveã€‚ çŸ¥é“äº†æ˜¯å“ªä¸ªçº¿ç¨‹è·å–äº†å…³é”®åŒºä½†æ²¡æœ‰é‡Šæ”¾ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„åœ¨ä»£ç ä¸­å®šä½é—®é¢˜äº†ã€‚ !cs -l!locksæ²¡æœ‰æ˜¾ç¤ºLockSemaphoreå­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡!cs -lå‘½ä»¤è·å–æ›´ä¸ºå…¨é¢çš„å…³é”®åŒºä¿¡æ¯ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°LockSemaphore&#x3D;0xC0ï¼Œæ­£å¥½æ˜¯#1çº¿ç¨‹NtWaitForSingleObjectçš„äº‹ä»¶å¯¹è±¡ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["Windbg","æ­»é”"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"ä½¿ç”¨WinDbgè°ƒè¯•äº’æ–¥ä½“æ­»é”","path":"/post/1092140776.html","content":"æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥è®²è§£å¦‚ä½•ä½¿ç”¨WinDbgæ¥è°ƒè¯•Windows Mutexæ­»é”çš„é—®é¢˜ã€‚ ä¸€. æ¼”ç¤ºç”¨ä¾‹ä¸‹é¢æ˜¯ä¸€ä¸ªä¼šå¯¼è‡´Mutexæ­»é”çš„ç¨‹åºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364#include &lt;windows.h&gt;#include &lt;tchar.h&gt;#include &lt;process.h&gt;HANDLE hMutexA = NULL;HANDLE hMutexB = NULL;unsigned __stdcall ThreadProc1(void * pArg) &#123; WaitForSingleObject(hMutexA, INFINITE); Sleep(500); WaitForSingleObject(hMutexB, INFINITE); printf(&quot;+++ &quot;); ReleaseMutex(hMutexB); ReleaseMutex(hMutexA); return 0;&#125;unsigned __stdcall ThreadProc2(void * pArg) &#123; WaitForSingleObject(hMutexB, INFINITE); Sleep(500); WaitForSingleObject(hMutexA, INFINITE); printf(&quot;... &quot;); ReleaseMutex(hMutexA); ReleaseMutex(hMutexB); return 0;&#125;int main()&#123; hMutexA = CreateMutex(NULL, FALSE, TEXT(&quot;MutexA&quot;)); hMutexB = CreateMutex(NULL, FALSE, TEXT(&quot;MutexB&quot;)); // å¯åŠ¨çº¿ç¨‹ HANDLE hThread1 = (HANDLE)_beginthreadex(NULL, 0, ThreadProc1, NULL, 0, NULL); HANDLE hThread2 = (HANDLE)_beginthreadex(NULL, 0, ThreadProc2, NULL, 0, NULL); getchar(); // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å…³é—­å¥æŸ„ if (hThread1) &#123; WaitForSingleObject(hThread1, INFINITE); CloseHandle(hThread1); &#125; if (hThread2) &#123; WaitForSingleObject(hThread2, INFINITE); CloseHandle(hThread2); &#125; // å…³é—­å¥æŸ„ if(hMutexA) CloseHandle(hMutexA); if(hMutexB) CloseHandle(hMutexB); return 0;&#125; äºŒ. æ­»é”åŸå› ç¨‹åºç”Ÿæˆäº†2ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹1ã€çº¿ç¨‹2ï¼‰å’Œ2ä¸ªäº’æ–¥ä½“MutexAå’ŒMutexBã€‚è§‚å¯Ÿçº¿ç¨‹æ‰§è¡Œä»£ç å¯çŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æ­»é”ç”¨ä¾‹ï¼Œ2ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…ã€‚ çº¿ç¨‹1ï¼š æ‹¥æœ‰MutexA â€“&gt; è¿‡ä¸€æ®µæ—¶é—´(sleep) â€”&gt; æƒ³æ‹¥æœ‰MutexB çº¿ç¨‹2ï¼š æ‹¥æœ‰MutexB â€“&gt; è¿‡ä¸€æ®µæ—¶é—´(sleep) â€”&gt; æƒ³æ‹¥æœ‰MutexA çº¿ç¨‹1æƒ³æ‹¥æœ‰å±äºçº¿ç¨‹2çš„MutexBï¼Œè€Œçº¿ç¨‹2å´æƒ³æ‹¥æœ‰å±äºçº¿ç¨‹1çš„MutexAï¼Œäº’ä¸æ¾æ‰‹ï¼Œå°±åªèƒ½éƒ½ç­‰ç€äº†ã€‚ ä¸‰. Windbgè°ƒè¯•~*kvnæŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹è°ƒç”¨å †æ ˆï¼š ä»çº¿ç¨‹#1æ ˆå¸§03å¯ä»¥çœ‹åˆ°å…¶æ­£åœ¨ç­‰å¾…å¥æŸ„00000038ã€‚ä»çº¿ç¨‹#2æ ˆå¸§03å¯ä»¥çœ‹åˆ°å…¶æ­£åœ¨ç­‰å¾…å¥æŸ„00000034ã€‚å³ï¼šçº¿ç¨‹#1ï¼ˆIDï¼š22f4ï¼‰â€”&gt;ç­‰å¾…å¥æŸ„38çº¿ç¨‹#2ï¼ˆIDï¼š33bcï¼‰â€”&gt; ç­‰å¾…å¥æŸ„34 ä½¿ç”¨!handleå‘½ä»¤æŸ¥çœ‹å¥æŸ„00000034å’Œ00000038æ˜¯ä»€ä¹ˆç±»å‹ï¼š ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼šå¥æŸ„00000034ä¸ºåä¸ºMutexAçš„äº’æ–¥ä½“ï¼Œè¢«çº¿ç¨‹IDï¼š2264 æ‹¥æœ‰ã€‚å¥æŸ„00000038ä¸ºåä¸ºMutexBçš„äº’æ–¥ä½“ï¼Œè¢«çº¿ç¨‹IDï¼š33bc æ‹¥æœ‰ã€‚ å³ï¼šçº¿ç¨‹#1ï¼ˆIDï¼š22f4ï¼‰ç­‰å¾…00000038ï¼ˆäº’æ–¥ä½“MutexA ï¼‰ï¼Œæ‹¥æœ‰00000034ï¼ˆäº’æ–¥ä½“MutexB)çº¿ç¨‹#2ï¼ˆIDï¼š33bcï¼‰ç­‰å¾…å¥æŸ„00000034ï¼ˆäº’æ–¥ä½“MutexB ï¼‰ï¼Œæ‹¥æœ‰00000038ï¼ˆäº’æ–¥ä½“MutexA) æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["Windbg","æ­»é”"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"C++ åŒ¿åå¯¹è±¡","path":"/post/3350490999.html","content":"åœ¨WebRTCçš„æºç ä¸­æœ‰å¦‚ä¸‹å‡½æ•°ï¼š 1234template &lt;typename T&gt;std::unique_ptr&lt;T&gt; WrapUnique(T* ptr) &#123; return std::unique_ptr&lt;T&gt;(ptr);&#125; è¯¥å‡½æ•°æœ¬èº«ä¸å¤æ‚ï¼Œé‡ç‚¹åœ¨äºå®ƒç›´æ¥è¿”å›äº†ä¸€ä¸ªstd::unique_ptrï¼Œæ®æˆ‘æ‰€çŸ¥std::unique_ptræ˜¯ä¸èƒ½å¤Ÿç›´æ¥æ‹·è´æ„é€ çš„ï¼Œå¦‚ï¼š 12std::unique_ptr&lt;std::string&gt; s1(new std::string(&quot;123&quot;));std::unique_ptr&lt;std::string&gt; s2 = s1; // ERROR è€Œä¸”WrapUniqueç»è¿‡å•æ­¥è°ƒè¯•ï¼Œæ•´ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹åªæœ‰æ‰§è¡Œäº†ä¸€æ¬¡std::unique_ptræ„é€ ã€‚æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œè‡³å°‘è¦æ‰§è¡Œ1æ¬¡æ„é€ ï¼Œ2æ¬¡æ‹·è´æ„é€ çš„ã€‚é‚£ä¹ˆWrapUniqueä¸ºä»€ä¹ˆå¯ä»¥åšåˆ°äº†ï¼Ÿ ç»“è®ºæ˜¯ï¼šC++ç¼–è¯‘å™¨å¯¹åŒ¿åå˜é‡åšäº†ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨å‘ç°æœ‰å˜é‡æ¥æ¥æ”¶åŒ¿åå˜é‡ï¼Œåˆ™ç›´æ¥å°†åŒ¿åå˜é‡çš„åˆå§‹åŒ–è¿‡ç¨‹æ”¾åˆ°æ¥æ”¶è¯¥åŒ¿åå˜é‡çš„å¯¹è±¡èº«ä¸Šå»ï¼Œå…å»äº†åé¢çš„æ‹·è´æ„é€ çš„è¿‡ç¨‹ã€‚ å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;iostream&gt;using namespace std;class Apple &#123;public: Apple() &#123; id_ = 0; cout &lt;&lt; &quot;Apple()&quot; &lt;&lt; endl; &#125; Apple(int id) &#123; id_ = id; cout &lt;&lt; &quot;Apple(&quot; &lt;&lt; id_ &lt;&lt; &quot;)&quot; &lt;&lt; endl; &#125; Apple(const Apple &amp;a) &#123; id_ = a.id_; cout &lt;&lt; &quot;Apple(const Apple &amp;a)&quot; &lt;&lt; endl; &#125; Apple&amp; operator=(const Apple &amp;that) &#123; id_ = that.id_; cout &lt;&lt; &quot;Apple&amp; operator=(const Apple &amp;that)&quot; &lt;&lt; endl; &#125; ~Apple() &#123; cout &lt;&lt; &quot;~Apple()&quot; &lt;&lt; endl; &#125;private: int id_;&#125;;Apple WrapApple(int id) &#123; return Apple(id);&#125;int main() &#123; Apple apple = WrapApple(666); return 0;&#125; ä¸è€ƒè™‘åŒ¿åå˜é‡çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬çŒœæµ‹æ‰§è¡Œè¿‡ç¨‹çš„è¾“å‡ºæ˜¯ï¼š 123Apple(666)Apple(const Apple &amp;a)Apple(const Apple &amp;a) ä½†å®é™…æ‰§è¡Œç»“æœæ˜¯ï¼š 1Apple(666) ç¼–è¯‘å™¨ç›´æ¥å¯¹appleå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ï¼Œçœå»äº†2æ¬¡æ‹·è´æ„é€ çš„è¿‡ç¨‹ã€‚ WebRTCä¸­çš„WrapUniqueå‡½æ•°å°±æ˜¯åˆ©ç”¨è¿™ä¸ªåŸç†ã€‚","tags":["C++","åŒ¿åå¯¹è±¡","WebRTC"],"categories":["C++è¯­è¨€"]},{"title":"ä¸€ä¸ªMySQLå­˜å‚¨è¿‡ç¨‹æ¨¡æ¿","path":"/post/254517042.html","content":"åœ¨è¿›è¡Œæ•°æ®åº“å¼€å‘æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å†™å¾ˆå¤šå­˜å‚¨è¿‡ç¨‹ï¼Œæœ¬æ–‡æä¾›ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹çš„æ¨¡æ¿ï¼Œé€šè¿‡è¯¥æ¨¡æ¿å¯ä»¥ç®€åŒ–å­˜å‚¨è¿‡ç¨‹çš„å¼€å‘ã€‚ MySQLå­˜å‚¨è¿‡ç¨‹çš„èŒƒä¾‹æ¨¡æ¿ï¼Œå¸¦è¿”å›å€¼å’Œå¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ã€‚ 12345678910111213141516171819202122DROP PROCEDURE IF EXISTS sp_sample;CREATE PROCEDURE sp_sample(OUT errno INT)root:BEGIN /* åŠŸèƒ½ï¼š INå‚æ•°ï¼š OUTå‚æ•°ï¼š errno å­˜å‚¨è¿‡ç¨‹å¼‚å¸¸æ ‡å¿—(0-æˆåŠŸ, 1-å¼‚å¸¸) */ DECLARE EXIT HANDLER FOR SQLEXCEPTION BEGIN ROLLBACK; SET errno = 1; END; SET errno = 0; START TRANSACTION; -- do what you want to do. -- ... COMMIT;END; å…¶ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹çš„å¼‚å¸¸æ•è·å’Œå›æ»šä½¿ç”¨DECLARE...HANDLERå®ç°ï¼š 12345DECLARE EXIT HANDLER FOR SQLEXCEPTION BEGIN ROLLBACK; SET errno = 1; END; å…³äºDECLARE...HANDLERçš„ç”¨æ³•è§ï¼š MySQLçš„DECLARE...HANDLERä½¿ç”¨","tags":["MySQL"],"categories":["æ•°æ®åº“","MySQL"]},{"title":"Windowså¥—æ¥å­—I/Oæ¨¡å‹(5)-å®Œæˆç«¯å£æ¨¡å‹","path":"/post/326824759.html","content":"ä¸€ã€å†™åœ¨å‰é¢å‰é¢çš„æ–‡ç« å·²ç»ä»‹ç»äº†å¥—æ¥å­— I&#x2F;O çš„åŒæ­¥æ¨¡å‹ã€WSAAsyncSelectæ¨¡å‹ã€WSAEventSelectæ¨¡å‹ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å¥—æ¥å­—I&#x2F;Oè¿˜å‰©ä¸‹2ä¸ªæ¨¡å‹æ²¡æœ‰ä»‹ç»ï¼šé‡å æ¨¡å‹ï¼Œå®Œæˆç«¯å£æ¨¡å‹ã€‚ å¦‚æœç¨‹åºå¯¹æ€§èƒ½å’Œå¹¶å‘è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥ä½¿ç”¨å‰é¢ä»‹ç»çš„WSAEventSelectæ¨¡å‹ï¼›å¦‚æœå¯¹æ€§èƒ½å’Œå¹¶å‘æœ‰è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„å®Œæˆç«¯å£æ¨¡å‹ã€‚å› ä¸ºå®Œæˆç«¯å£æ¨¡å‹æ˜¯åŸºäºé‡å æ¨¡å‹çš„ï¼Œä¸”åœ¨æ˜“ç”¨æ€§ã€å¯ä¼¸ç¼©æ€§ç­‰æ–¹é¢éƒ½é«˜äºé‡å æ¨¡å‹ï¼Œåœ¨ä¸€èˆ¬é€‰æ‹©é‡å æ¨¡å‹çš„åœºåˆï¼Œéƒ½å¯ä»¥ç”¨å®Œæˆç«¯å£æ¨¡å‹æ¥æ›¿ä»£ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å®Œæˆç«¯å£æ¨¡å‹ã€‚ â€œå®Œæˆç«¯å£æ¨¡å‹â€æ˜¯ Windows ç³»ç»Ÿä¸Šé¢å¥—æ¥å­— I&#x2F;O çš„ç»ˆææ¨¡å‹ï¼Œå¯ä»¥ç”¨å®ƒä»£æ›¿å‰é¢çš„æ‰€æœ‰æ¨¡å‹ã€‚å¦‚æœå¯¹å®Œæˆç«¯å£æ¨¡å‹æœ‰ä¸€ä¸ªå¥½çš„å°è£…ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥â€œä¸€æ‹›é²œï¼Œåƒéå¤©â€ï¼Œå…å»é‡å¤é€ è½®å­çš„éº»çƒ¦ã€‚æ‰€ä»¥è¿™é‡Œå¯¹å®Œæˆç«¯å£çš„æ¨¡å‹çš„ä»‹ç»å’Œæ¯”å‰é¢çš„å‡ ç¯‡ç¯‡å¹…æ›´é•¿ï¼Œç¤ºä¾‹ä»£ç ä¹Ÿæ›´åŠ å¤æ‚å’Œå…¨é¢ã€‚ Reactorå’ŒProactoråœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¬åˆ°çš„2ç§I&#x2F;Oå¤šè·¯å¤ç”¨çš„æ¨¡å¼ï¼šreactorå’Œproactorã€‚å¯¹äºè¿™2ç§æ¨¡å¼çš„åŒºåˆ«é€šä¿—æ¥è¯´å°±æ˜¯ï¼š 12Reactorï¼š èƒ½æ”¶äº†ä½ è·Ÿæˆ‘è¯´ä¸€å£°ã€‚Proactor: ä½ å¸®æˆ‘æœ€å¤šæ”¶åä¸ªå­—èŠ‚ï¼Œæ”¶å¥½äº†è·Ÿæˆ‘è¯´ä¸€å£°ã€‚ Windowsæä¾›çš„å®Œæˆç«¯å£æ¨¡å‹å°±æ˜¯Proactoræ¨¡å¼ï¼›è€ŒLinuxä¸Šé¢ç”±äºæ²¡æœ‰æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œåªèƒ½ä½¿ç”¨Reactoræ¨¡å¼ï¼Œå¦‚epollç­‰ã€‚ äºŒã€å®Œæˆç«¯å£æ¨¡å‹ä»‹ç»å®Œæˆç«¯å£æ¨¡å‹è¯´ç™½äº†å°±æ˜¯ï¼Œæ‚¨è¦åšä»€ä¹ˆäº‹æƒ…ï¼ˆå¦‚æ¥æ”¶è¿æ¥AcceptExã€å‘é€æ•°æ®WSASendã€æ¥æ”¶æ•°æ®WSARecvã€è¿æ¥æœåŠ¡ç«¯ConnectExï¼‰ï¼Œæ‚¨å‘Šè¯‰æˆ‘ï¼Œæˆ‘åšå®Œäº†é€šçŸ¥æ‚¨ã€‚è¿™é‡Œçš„â€œæˆ‘â€æŒ‡çš„æ˜¯æ“ä½œç³»ç»Ÿï¼Œâ€œæ‚¨â€æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºã€‚å¦‚åº”ç”¨ç¨‹åºéœ€è¦æ¥æ”¶å…¶ä»–ç«¯å‘æ¥çš„æ•°æ®ï¼Œå¯ä»¥è°ƒç”¨WSARecvï¼Œå¹¶æŒ‡å®šæ¥æ”¶æ•°æ®çš„ç¼“å†²åŒºåŠå¤§å°ï¼Œç­‰å…¶ä»–ç«¯å‘æ¥æ•°æ®æ—¶ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨å°†æ•°æ®æ”¾å…¥åˆ°åº”ç”¨ç¨‹åºæŒ‡å®šçš„ç¼“å†²åŒºä¸­ï¼Œç„¶åé€šçŸ¥åº”ç”¨ç¨‹åºæ•°æ®æ¥å•¦ã€‚ è¿™ä¸ªå’ŒWSAEventSelectæ¨¡å‹æœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼ŒWSAEventSelectæ¨¡å‹åªæ˜¯é€šçŸ¥ç¨‹åºæ•°æ®æ¥äº†ï¼Œå¹¶æ²¡æœ‰å°†æ•°æ®æ¥æ”¶ï¼Œè¿˜éœ€è¦ç¨‹åºè°ƒç”¨recvæ¥æ¥æ”¶æ•°æ®ã€‚ 2.1 å®Œæˆç«¯å£åˆ›å»ºå’Œç»‘å®š123456HANDLE WINAPI CreateIoCompletionPort( _In_ HANDLE FileHandle, _In_opt_ HANDLE ExistingCompletionPort, _In_ ULONG_PTR CompletionKey, _In_ DWORD NumberOfConcurrentThreads); CreateIoCompletionPortè¿™ä¸ªå‡½æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°ä¸åŒï¼Œå®ƒå¯ä»¥å®ç°2ä¸ªåŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªå®Œæˆç«¯å£ï¼›å°†å®Œæˆç«¯å£å’Œè®¾å¤‡ï¼ˆå¥—æ¥å­—ï¼‰ç›¸ç»‘å®šã€‚ä¸€èˆ¬å¯¹è¯¥å‡½æ•°è¿›è¡Œå¦‚ä¸‹å°è£…æ¥å®ç°è¿™2ä¸ªåŠŸèƒ½ï¼š 12345678HANDLE CreateNewCompletionPort() &#123; return CreateIoCompletionPort(INVALID_HANDLE_VALUE, NULL, 0, 0);&#125;BOOL AssociateDeviceWithCompletionPort(HANDLE completion_port, HANDLE device, DWORD completion_key) &#123; HANDLE h = CreateIoCompletionPort(device, completion_port, completion_key, 0); return (h == completion_port);&#125; 2.2 çº¿ç¨‹æ± å‰é¢è¯´åˆ°äº†ï¼Œå®Œæˆç«¯å£æ¨¡å‹å°±æ˜¯åº”ç”¨ç¨‹åºç­‰ç€æ“ä½œç³»ç»ŸæŠŠäº‹æƒ…åšå®Œäº†é€šçŸ¥å®ƒã€‚é‚£æ—¢ç„¶æ˜¯ç­‰ï¼Œç­‰çš„æ“ä½œè‚¯å®šæ˜¯é˜»å¡ä½äº†çš„ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨ä¸»çº¿ç¨‹ä¸­ç­‰ï¼Œæˆ‘ä»¬éœ€è¦å¯åŠ¨å­çº¿ç¨‹å»ç­‰ã€‚å¯æ˜¯å¯åŠ¨å¤šä¸ªå­çº¿ç¨‹å»ç­‰äº†ï¼Œä¸€ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹å—ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹è¶Šå¤šï¼Œå ç”¨çš„ç³»ç»Ÿèµ„æºä¹Ÿå°±è¶Šå¤šï¼Œè€Œä¸”çº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿæ˜¯æ¶ˆè€—CPUæ—¶é—´çš„ã€‚æ‰€ä»¥çº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç»éªŒæ³•åˆ™å°±æ˜¯ï¼šçº¿ç¨‹æ•°é‡ = CPUæ•°é‡ * 2ã€‚ çº¿ç¨‹æ•°é‡å’ŒCPUæ•°é‡ç›¸åŒæ˜¯æœ€ç†æƒ³çš„ç¯å¢ƒï¼Œè¿™æ ·å…å»äº†CPUåœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œä½†ç°å®æƒ…å†µä¸‹ï¼Œéš¾å…æŸäº›çº¿ç¨‹æ‰§è¡ŒæŸäº›ä»»åŠ¡è€—æ—¶è¾ƒé•¿ï¼Œå¯¼è‡´CPUå°†æ—¶é—´ç‰‡ä»è¯¥çº¿ç¨‹åˆ†æ‹¨å‡ºå»ã€‚æ‰€ä»¥è¿™é‡Œç”¨CPUæ•°é‡ä¹˜ä»¥2ï¼Œæœ€å¤§é™åº¦çš„åˆ©ç”¨CPUèµ„æºã€‚è¿™ä¹Ÿæ˜¯å®Œæˆç«¯å£çš„ç›®æ ‡ï¼Œå³æœ€å¤§é™åº¦çš„åˆ©ç”¨CPUèµ„æºã€‚ è·å–CPUæ•°é‡çš„æ–¹å¼ï¼š 12345int GetNumberOfProcesser() &#123; SYSTEM_INFO si; GetSystemInfo(&amp;si); return si.dwNumberOfProcessors;&#125; 2.3 AcceptExç­‰12345678910BOOL AcceptEx( _In_ SOCKET sListenSocket, _In_ SOCKET sAcceptSocket, _In_ PVOID lpOutputBuffer, _In_ DWORD dwReceiveDataLength, _In_ DWORD dwLocalAddressLength, _In_ DWORD dwRemoteAddressLength, _Out_ LPDWORD lpdwBytesReceived, _In_ LPOVERLAPPED lpOverlapped); AcceptExå’ŒWSARecvã€WSASendã€ConnectExç­‰å‡½æ•°ç±»ä¼¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°éƒ½æ˜¯LPOVERLAPPEDï¼Œéœ€è¦è°ƒç”¨è€…æä¾›ä¸€ä¸ªé‡å ç»“æ„ã€‚ä½†è¿™ä¸ªAcceptExã€ConnectExç­‰å‡½æ•°æ¯”è¾ƒç‰¹åˆ«ï¼Œä»–ä»¬æ˜¯å¾®è½¯ä¸“é—¨åœ¨Windowsæ“ä½œç³»ç»Ÿé‡Œé¢æä¾›çš„æ‰©å±•å‡½æ•°ï¼Œä¸æ˜¯åœ¨Winsock2æ ‡å‡†é‡Œé¢æä¾›çš„ï¼Œæ˜¯å¾®è½¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨é‡å I&#x2F;Oæœºåˆ¶ï¼Œé¢å¤–æä¾›çš„ä¸€äº›å‡½æ•°ã€‚ ä»¥AcceptExä¸ºä¾‹ï¼Œå¾®è½¯çš„å®ç°æ˜¯é€šè¿‡mswsock.dllä¸­æä¾›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é™æ€é“¾æ¥mswsock.libæ¥ç›´æ¥è°ƒç”¨AcceptExã€‚ä½†ä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºæ¯æ¬¡ç›´æ¥è°ƒç”¨AcceptExæ—¶ï¼ŒService Provideréƒ½å¾—è¦é€šè¿‡WSAIoctl()è·å–ä¸€æ¬¡è¯¥å‡½æ•°æŒ‡é’ˆï¼Œè¿™æ ·æ•ˆç‡æ¯”è¾ƒä½ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åœ¨ç›´æ¥ä»£ç ä¸­å…ˆè·å–åˆ°è¿™ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå¹¶ä¿å­˜ä¸‹æ¥ï¼Œåé¢ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆå°±å¥½äº†ã€‚ è·å–AcceptExç­‰å‡½æ•°çš„æŒ‡é’ˆçš„æ–¹å¼ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162LPFN_ACCEPTEX GetAcceptExFnPointer(SOCKET s)&#123; LPFN_ACCEPTEX fn = NULL; GUID GuidAcceptEx = WSAID_ACCEPTEX; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidAcceptEx, sizeof(GuidAcceptEx), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn;&#125;LPFN_CONNECTEX GetConnectExFnPointer(SOCKET s)&#123; LPFN_CONNECTEX fn = NULL; GUID GuidConnectEx = WSAID_CONNECTEX; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidConnectEx, sizeof(GuidConnectEx), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn;&#125;LPFN_GETACCEPTEXSOCKADDRS GetAcceptExSockAddrsFnPointer(SOCKET s)&#123; LPFN_GETACCEPTEXSOCKADDRS fn = NULL; GUID GuidGetAcceptExSockAddrs = WSAID_GETACCEPTEXSOCKADDRS; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidGetAcceptExSockAddrs, sizeof(GuidGetAcceptExSockAddrs), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn;&#125; 2.4 GetQueuedCompletionStatuså‡½æ•°åŸå‹å¦‚ä¸‹ï¼š 1234567BOOL WINAPI GetQueuedCompletionStatus( _In_ HANDLE CompletionPort, _Out_ LPDWORD lpNumberOfBytes, _Out_ PULONG_PTR lpCompletionKey, _Out_ LPOVERLAPPED *lpOverlapped, _In_ DWORD dwMilliseconds); å‰é¢è¯´åˆ°äº†ï¼Œå®Œæˆç«¯å£æ¨¡å‹éœ€è¦åœ¨å­çº¿ç¨‹ä¸­ç­‰å¾…æ“ä½œç³»ç»Ÿåšå®Œäº‹æƒ…ä¹‹åçš„é€šçŸ¥ã€‚è€ŒGetQueuedCompletionStatuså‡½æ•°å°±æ˜¯ç”¨æ¥ç­‰å¾…è¿™ä¸ªé€šçŸ¥çš„ã€‚é€šè¿‡è¯¥å‡½æ•°å¯ä»¥è·å–çš„æœ¬æ¬¡ä¼ è¾“çš„å­—èŠ‚æ•°lpNumberOfBytesã€ä¸€ä¸ªç”¨æˆ·ç»‘å®šåœ¨å¥—æ¥å­—ä¸Šçš„è‡ªå®šä¹‰æ•´æ•°lpCompletionKeyã€ç”¨æˆ·è°ƒç”¨WSASendç­‰å‡½æ•°æ—¶æŒ‡å®šçš„OVERLAPPEDç»“æ„çš„æŒ‡é’ˆlpOverlappedã€‚ æˆ‘ä»¬æ¯”è¾ƒå…³æ³¨çš„æ˜¯lpCompletionKeyã€lpOverlappedè¿™2ä¸ªå‚æ•°ï¼šlpCompletionKeyæ˜¯è°ƒç”¨CreateIoCompletionPortå‡½æ•°ç»‘å®šå®Œæˆç«¯å£å’Œå¥—æ¥å­—æ—¶æŒ‡å®šçš„ï¼Œæ¯ä¸ªå¥—æ¥å­—(SOCKET)å¯¹åº”ä¸€ä¸ªlpCompletionKeyã€‚lpCompletionKeyå¯ä»¥æ˜¯åŒ…æ‹¬æŒ‡é’ˆåœ¨å†…çš„ä»»ä½•æ•´æ•°ã€‚ lpOverlappedæ˜¯æ¯æ¬¡è°ƒç”¨WSASendç­‰å‡½æ•°æ—¶æŒ‡å®šçš„ï¼Œæ¯ä¸€æ¬¡æ“ä½œï¼ˆä¹Ÿå°±æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ï¼Œå¦‚WSASend, WSARecv, AcceptEx, ConnectExï¼‰å¯¹åº”çš„lpOverlappedéƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸€æ¬¡æ“ä½œå¯¹åº”ä¸€ä¸ªlpOverlappedã€‚ä¸€ä¸ªSOCKETå¯ä»¥æœ‰å¤šæ¬¡æ“ä½œï¼Œå¤šä»¥å¯¹åº”å¤šä¸ªlpOverlappedã€‚ å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š 123456789101112131415161718192021+-----------+ +--------------------+| | 1 --&gt; 1 | || SOCKET +-----------&gt; lpCompletionKey || | | |+-----+-----+ +--------------------+ | |1 --&gt; n |+-----v------------------+| || Send,Recv,Accept... || |+-----+------------------+ | |1 --&gt; 1 |+-----v------------------+| || lpOverlapped || |+------------------------+ æ³¨ï¼šç¤ºä¾‹ä»£ç ä¸­çš„PER_SOCKET_CONTEXTç»“æ„å¯¹åº”å›¾ä¸­çš„SOCKETï¼ŒPER_IO_CONTEXTç»“æ„å¯¹åº”å›¾ä¸­çš„lpOverlappedã€‚çŸ¥é“è¿™ä¸ªå¯¹ç†è§£ç¤ºä¾‹ä»£ç ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚ Windowsè¿˜æä¾›äº†ä¸€ä¸ªè¾…åŠ©å®CONTAINING_RECORDï¼Œè¯¥å®å¯ä»¥æ ¹æ®ç»“æ„ä½“ä¸­çš„æŸæˆå‘˜çš„åœ°å€æ¥æ¨ç®—å‡ºè¯¥ç»“æ„ä½“æ•´ä½“çš„åœ°å€ã€‚çŸ¥é“äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨lpOverlappedå‚æ•°ä¸Šåšæ–‡ç« äº†ï¼ˆæ‰©å±•ï¼‰ï¼Œå…·ä½“è§ç¤ºä¾‹ã€‚ ä¸Šé¢å¯¹å®Œæˆç«¯å£æ¨¡å‹åªåšäº†ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œå…³äºå®Œæˆç«¯å£çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒã€Šwindowsæ ¸å¿ƒç¼–ç¨‹ ç¬¬5ç‰ˆã€‹ 10.3èŠ‚ã€‚ 2.5 CONTAINING_RECORDå®çš„å®ç°åŸç†è¯¥å®çš„ä½œç”¨å°±æ˜¯ï¼šæ ¹æ®ç»“æ„ä½“ä¸­çš„æŸæˆå‘˜çš„åœ°å€æ¥æ¨ç®—å‡ºè¯¥ç»“æ„ä½“æ•´ä½“çš„åœ°å€ï¼Œç›¸å½“äºä¸€ä¸ªä¸‡èƒ½å…¬å¼ã€‚ ä¸‹é¢ä»£ç çš„æ³¨é‡Šä¸­ï¼Œè®²è§£äº†è¯¥å®çš„å®ç°åŸç†ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;Windows.h&gt;#include &lt;stdio.h&gt;int main()&#123; struct T &#123; int a; int b; int c; &#125;; //CONTAINING_RECORDå®çš„ä½œç”¨å°±æ˜¯æ ¹æ®ç»“æ„ä½“ä¸­çš„æŸæˆå‘˜çš„åœ°å€æ¥æ¨ç®—å‡ºè¯¥ç»“æ„ä½“æ•´ä½“çš„åœ°å€ã€‚ T t = &#123; 1, 2, 3 &#125;; //å‡è®¾æˆ‘ä»¬çŸ¥é“Tç»“æ„ä½“ä¸­bçš„åœ°å€å’Œåç§°ï¼Œæ±‚tçš„æŒ‡é’ˆ T *pT = CONTAINING_RECORD(&amp;t.b, T, b); printf(&quot;a:%d b:%d c:%d &quot;, pT-&gt;a, pT-&gt;b, pT-&gt;c); //CONTAINING_RECORDçš„å®šä¹‰: //((type *)( (PCHAR)(address) - (ULONG_PTR)(&amp;((type *)0)-&gt;field))) //æœ€åä¸€éƒ¨åˆ†(&amp;((type *)0)-&gt;field) å°†0(ç©ºæŒ‡é’ˆ)è½¬æˆtypeï¼Œå†å–åœ°å€ã€‚ //åœ¨æœ¬ä¾‹ä¸­å°±æ˜¯å°†ç©ºæŒ‡é’ˆè½¬æˆT*, ç„¶åæŒ‡å‘bè¿™ä¸ªå˜é‡, ç„¶åå†å–åœ°å€ã€‚ //è¿™ä¸ªæ“ä½œçš„ä½œç”¨å°±æ˜¯ï¼šå‡è®¾Tå¼€å§‹åœ¨0x000000å†…å­˜ä½ç½®ä¸Šåˆ†é…å†…å­˜ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ±‚bçš„å†…å­˜åœ°å€, //è¿™æ ·ç­‰åŒäºæ±‚å¾—bçš„å†…å­˜ç»“æ„ä½“å¯¹é½åç§»é‡, æ±‚å¾—bçš„åœ°å€æˆ‘ä»¬è½¬æˆULONG_PTRç±»å‹, //ç„¶åç”¨å®é™…bçš„å†…å­˜åœ°å€å‡å»bçš„ç»“æ„ä½“åç§»é‡æ±‚å¾—ç»“æ„ä½“é¦–åœ°å€ã€‚ // //åˆ†è§£å¼€æ¥å°±æ˜¯ï¼š //è¿™ç§æƒ…å†µæ˜¯å…è®¸çš„ã€‚ //è¿™ä¸ªå¤§å‰æå¾ˆé‡è¦ï¼ï¼ï¼ T *pTemp = (T*)0; //æ±‚bçš„å†…å­˜åœ°å€,åœ¨ç»“æ„ä½“é¦–åœ°å€ä¸º0çš„æƒ…å†µä¸‹bçš„å†…å­˜åœ°å€å…¶å®å°±æ˜¯è‡ªèº«çš„å¯¹é½å¤§å°åç§»é‡ï¼ï¼ï¼ //CONTAINING_RECORDå®çš„æ ¸å¿ƒï¼ï¼ï¼ int *pB = &amp;pTemp-&gt;b; ULONG_PTR Offset = (ULONG_PTR)pB; //è½¬æˆæ•°å­—, å°±æ˜¯bçš„åç§»é‡ã€‚ printf(&quot;bçš„åç§»é‡:%d &quot;, Offset); //å› ä¸ºå„ä¸ªæˆå‘˜çš„åœ°å€æ˜¯é€’å¢çš„ï¼Œæœ€åç”¨å®é™…bçš„åœ°å€å‡bçš„åç§»é‡çš„åˆ°ç»“æ„ä½“é¦–åœ°å€ T *pFinal = (T*)(((char*)&amp;t.b) - Offset); printf(&quot;Tä¸­a:%d b:%d c:%d &quot;, pFinal-&gt;a, pFinal-&gt;b, pFinal-&gt;c); return 0;&#125; ä¸‰ã€ç¤ºä¾‹ç¤ºä¾‹ä»£ç å®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½ä½¿ç”¨å®Œæˆç«¯å£æ¨¡å‹æ¥å®ç°ã€‚ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡å‘é€æ¶ˆæ¯æ¥æ¨¡æ‹ŸTCPçš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶ã€‚ 3.1 è¾…åŠ©å‡½æ•°iocp.hå’Œiocp.cppä¸­å®ç°äº†IOCPç›¸å…³çš„ç»“æ„ä½“å®šä¹‰å’Œä¸€äº›é€šç”¨çš„è¾…åŠ©å‡½æ•°ï¼šiocp.h 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112// iocp.h#ifndef IOCP_H_#define IOCP_H_#include &lt;winsock2.h&gt;#include &lt;MSWSock.h&gt;#include &lt;vector&gt;#define MAX_BUFFER_LEN 8192 #define EXIT_CODE 0namespace IOCP &#123; typedef enum _OPERATION_TYPE &#123; ACCEPT_POSTED, CONNECT_POSTED, SEND_POSTED, RECV_POSTED, NULL_POSTED &#125;OPERATION_TYPE; typedef struct _PER_IO_CONTEXT &#123; OVERLAPPED overlapped; SOCKET socket; WSABUF wsa_buffer; char buffer[MAX_BUFFER_LEN]; OPERATION_TYPE operation_type; _PER_IO_CONTEXT() &#123; ZeroMemory(&amp;overlapped, sizeof(overlapped)); ZeroMemory(buffer, MAX_BUFFER_LEN); socket = INVALID_SOCKET; wsa_buffer.buf = buffer; wsa_buffer.len = MAX_BUFFER_LEN; operation_type = NULL_POSTED; &#125; ~_PER_IO_CONTEXT() &#123; if (socket != INVALID_SOCKET) &#123; closesocket(socket); socket = INVALID_SOCKET; &#125; &#125; void ResetBuffer() &#123; ZeroMemory(buffer, MAX_BUFFER_LEN); &#125; &#125; PER_IO_CONTEXT; typedef struct _PER_SOCKET_CONTEXT &#123; SOCKET socket; SOCKADDR_IN client_addr; std::vector&lt;_PER_IO_CONTEXT*&gt; io_ctx_array; _PER_SOCKET_CONTEXT() &#123; socket = INVALID_SOCKET; memset(&amp;client_addr, 0, sizeof(client_addr)); &#125; ~_PER_SOCKET_CONTEXT() &#123; if (socket != INVALID_SOCKET) &#123; closesocket(socket); socket = INVALID_SOCKET; &#125; for (size_t i = 0; i &lt; io_ctx_array.size(); i++) &#123; delete io_ctx_array[i]; &#125; io_ctx_array.clear(); &#125; _PER_IO_CONTEXT* GetNewIoContext() &#123; _PER_IO_CONTEXT* p = new _PER_IO_CONTEXT; io_ctx_array.push_back(p); return p; &#125; void RemoveContext(_PER_IO_CONTEXT* pContext) &#123; for (std::vector&lt;_PER_IO_CONTEXT*&gt;::iterator it = io_ctx_array.begin(); it != io_ctx_array.end(); it++) &#123; if (pContext == *it) &#123; delete pContext; pContext = NULL; io_ctx_array.erase(it); break; &#125; &#125; &#125; &#125; PER_SOCKET_CONTEXT; int GetNumberOfProcesser(); HANDLE CreateNewCompletionPort(); BOOL AssociateDeviceWithCompletionPort(HANDLE completion_port, HANDLE device, DWORD completion_key); LPFN_ACCEPTEX GetAcceptExFnPointer(SOCKET s); LPFN_CONNECTEX GetConnectExFnPointer(SOCKET s); LPFN_GETACCEPTEXSOCKADDRS GetAcceptExSockAddrsFnPointer(SOCKET s);&#125;;#endif // IOCP_H_ iocp.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081// iocp.cpp#include &quot;iocp.h&quot;namespace IOCP &#123; int GetNumberOfProcesser() &#123; SYSTEM_INFO si; GetSystemInfo(&amp;si); return si.dwNumberOfProcessors; &#125; HANDLE CreateNewCompletionPort() &#123; return CreateIoCompletionPort(INVALID_HANDLE_VALUE, NULL, 0, 0); &#125; BOOL AssociateDeviceWithCompletionPort(HANDLE completion_port, HANDLE device, DWORD completion_key) &#123; HANDLE h = CreateIoCompletionPort(device, completion_port, completion_key, 0); return (h == completion_port); &#125; LPFN_ACCEPTEX GetAcceptExFnPointer(SOCKET s) &#123; LPFN_ACCEPTEX fn = NULL; GUID GuidAcceptEx = WSAID_ACCEPTEX; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidAcceptEx, sizeof(GuidAcceptEx), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn; &#125; LPFN_CONNECTEX GetConnectExFnPointer(SOCKET s) &#123; LPFN_CONNECTEX fn = NULL; GUID GuidConnectEx = WSAID_CONNECTEX; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidConnectEx, sizeof(GuidConnectEx), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn; &#125; LPFN_GETACCEPTEXSOCKADDRS GetAcceptExSockAddrsFnPointer(SOCKET s) &#123; LPFN_GETACCEPTEXSOCKADDRS fn = NULL; GUID GuidGetAcceptExSockAddrs = WSAID_GETACCEPTEXSOCKADDRS; DWORD bytes = 0; if (SOCKET_ERROR == WSAIoctl( s, SIO_GET_EXTENSION_FUNCTION_POINTER, &amp;GuidGetAcceptExSockAddrs, sizeof(GuidGetAcceptExSockAddrs), &amp;fn, sizeof(fn), &amp;bytes, NULL, NULL)) &#123; return NULL; &#125; return fn; &#125;&#125; 3.1 æœåŠ¡ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;#include &lt;process.h&gt;#include &quot;iocp.h&quot;using namespace std;const u_short kPort = 10001;const std::string kSYN = &quot;(SYN) hello server, I&#x27;m client. Can you hear me?&quot;;const std::string kSYN_ACK = &quot;(SYN+ACK) hello client, I&#x27;m server. I can hear you, can you hear me?&quot;;const std::string kACK = &quot;(ACK) hello server, I&#x27;m client. I can hear you!&quot;;#pragma comment(lib, &quot;Ws2_32.lib&quot;)HANDLE g_IOCP = INVALID_HANDLE_VALUE;HANDLE g_exit = NULL;int g_work_thread_num = 0;HANDLE *g_work_threads = NULL;IOCP::PER_SOCKET_CONTEXT *g_listen_ctx = NULL;CRITICAL_SECTION g_cs_socket_ctx_array;std::vector&lt;IOCP::PER_SOCKET_CONTEXT*&gt; g_socket_ctx_array;LPFN_ACCEPTEX g_AcceptExFn = NULL;LPFN_GETACCEPTEXSOCKADDRS g_AcceptExSockAddrsFn = NULL;// ç®¡ç†g_socket_ctx_array//void AddSocketContext(IOCP::PER_SOCKET_CONTEXT *socket_ctx) &#123; EnterCriticalSection(&amp;g_cs_socket_ctx_array); g_socket_ctx_array.push_back(socket_ctx); LeaveCriticalSection(&amp;g_cs_socket_ctx_array);&#125;void RemoveSocketContext(IOCP::PER_SOCKET_CONTEXT *socket_ctx) &#123; EnterCriticalSection(&amp;g_cs_socket_ctx_array); for (std::vector&lt;IOCP::PER_SOCKET_CONTEXT*&gt;::iterator it = g_socket_ctx_array.begin(); it != g_socket_ctx_array.end(); it++) &#123; if (*it == socket_ctx) &#123; delete *it; g_socket_ctx_array.erase(it); break; &#125; &#125; LeaveCriticalSection(&amp;g_cs_socket_ctx_array);&#125;void ClearSocketContextArray() &#123; EnterCriticalSection(&amp;g_cs_socket_ctx_array); for (std::vector&lt;IOCP::PER_SOCKET_CONTEXT*&gt;::iterator it = g_socket_ctx_array.begin(); it != g_socket_ctx_array.end(); it++) &#123; closesocket((*it)-&gt;socket); delete *it; &#125; g_socket_ctx_array.clear(); LeaveCriticalSection(&amp;g_cs_socket_ctx_array);&#125;// å‘é€Acceptã€Recvã€Sendè¯·æ±‚//bool PostAccept(IOCP::PER_IO_CONTEXT* io_ctx) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::ACCEPT_POSTED; io_ctx-&gt;ResetBuffer(); io_ctx-&gt;socket = WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, 0, WSA_FLAG_OVERLAPPED); if (io_ctx-&gt;socket == INVALID_SOCKET) &#123; printf(&quot;WSASocket failed with code: %d &quot;, WSAGetLastError()); return false; &#125; DWORD bytes = 0; if (g_AcceptExFn(g_listen_ctx-&gt;socket, io_ctx-&gt;socket, io_ctx-&gt;wsa_buffer.buf, 0, sizeof(SOCKADDR_IN) + 16, sizeof(SOCKADDR_IN) + 16, &amp;bytes, &amp;io_ctx-&gt;overlapped) == FALSE) &#123; int gle = WSAGetLastError(); if (gle != WSA_IO_PENDING) &#123; printf(&quot;AcceptEx failed with code: %d &quot;, gle); return false; &#125; &#125; return true;&#125;bool PostRecv(IOCP::PER_IO_CONTEXT* io_ctx) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::RECV_POSTED; io_ctx-&gt;ResetBuffer(); DWORD recv_bytes = 0; DWORD flags = 0; int ret = WSARecv(io_ctx-&gt;socket, &amp;io_ctx-&gt;wsa_buffer, 1, &amp;recv_bytes, &amp;flags, &amp;io_ctx-&gt;overlapped, NULL); if (ret == SOCKET_ERROR &amp;&amp; WSAGetLastError() != WSA_IO_PENDING) &#123; return false; &#125; return true;&#125;bool PostSend(IOCP::PER_IO_CONTEXT* io_ctx, const char* msg, int msg_len) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::SEND_POSTED; memcpy(io_ctx-&gt;wsa_buffer.buf, msg, msg_len); io_ctx-&gt;wsa_buffer.len = msg_len; DWORD sent_bytes = 0; int ret = WSASend(io_ctx-&gt;socket, &amp;io_ctx-&gt;wsa_buffer, 1, &amp;sent_bytes, 0, &amp;io_ctx-&gt;overlapped, NULL); if (ret == SOCKET_ERROR &amp;&amp; WSAGetLastError() != WSA_IO_PENDING) &#123; return false; &#125; return true;&#125;// å¤„ç†Acceptã€Recvã€Sendå®Œæˆä¹‹åçš„é€šçŸ¥//bool DoAccept(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; SOCKADDR_IN* ClientAddr = NULL; SOCKADDR_IN* LocalAddr = NULL; int remoteLen = sizeof(SOCKADDR_IN); int localLen = sizeof(SOCKADDR_IN); g_AcceptExSockAddrsFn(io_ctx-&gt;wsa_buffer.buf, io_ctx-&gt;wsa_buffer.len - ((sizeof(SOCKADDR_IN) + 16) * 2), sizeof(SOCKADDR_IN) + 16, sizeof(SOCKADDR_IN) + 16, (LPSOCKADDR*)&amp;LocalAddr, &amp;localLen, (LPSOCKADDR*)&amp;ClientAddr, &amp;remoteLen); printf(&quot;* new connection(%s:%d): %s &quot;, inet_ntoa(ClientAddr-&gt;sin_addr), ntohs(ClientAddr-&gt;sin_port), io_ctx-&gt;wsa_buffer.buf); // æ­¤æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„PER_SOCKET_CONTEXTï¼Œä¹‹å‰è€çš„PER_SOCKET_CONTEXTç»§ç»­ç”¨ä½œæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ // IOCP::PER_SOCKET_CONTEXT *new_socket_ctx = new IOCP::PER_SOCKET_CONTEXT(); new_socket_ctx-&gt;socket = io_ctx-&gt;socket; if (!IOCP::AssociateDeviceWithCompletionPort(g_IOCP, (HANDLE)new_socket_ctx-&gt;socket, (DWORD)new_socket_ctx)) &#123; printf(&quot;AssociateDeviceWithCompletionPort failed &quot;); delete new_socket_ctx; new_socket_ctx = NULL; return false; &#125; AddSocketContext(new_socket_ctx); // post recv IOCP::PER_IO_CONTEXT *new_io_ctx = new_socket_ctx-&gt;GetNewIoContext(); new_io_ctx-&gt;socket = new_socket_ctx-&gt;socket; if (!PostRecv(new_io_ctx)) &#123; printf(&quot;PostRecv failed &quot;); return false; &#125; // post new accept if (!PostAccept(io_ctx)) &#123; printf(&quot;PostAccept failed &quot;); return false; &#125; return true;&#125;bool DoRecv(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; printf(&quot;recv: %s &quot;, io_ctx-&gt;wsa_buffer.buf); if (strcmp(io_ctx-&gt;wsa_buffer.buf, kSYN.c_str()) == 0) &#123; // SYN+ACK IOCP::PER_IO_CONTEXT * new_io_ctx = socket_ctx-&gt;GetNewIoContext(); new_io_ctx-&gt;socket = socket_ctx-&gt;socket; if (!PostSend(new_io_ctx, kSYN_ACK.c_str(), kSYN_ACK.length())) &#123; printf(&quot;PostSend failed &quot;); return false; &#125; &#125; // post new recv if (!PostRecv(io_ctx)) &#123; printf(&quot;PostRecv failed &quot;); return false; &#125; return true;&#125;bool DoSend(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; printf(&quot;send: %s &quot;, io_ctx-&gt;wsa_buffer.buf); return true;&#125;// å·¥ä½œçº¿ç¨‹unsigned int __stdcall WorkThreadProc(void *arg) &#123; DWORD transferred_bytes = 0; IOCP::PER_SOCKET_CONTEXT *socket_ctx = NULL; OVERLAPPED *overlapped = NULL; DWORD gle; while (WaitForSingleObject(g_exit, 0) != WAIT_OBJECT_0) &#123; BOOL ret = GetQueuedCompletionStatus(g_IOCP, &amp;transferred_bytes, (PULONG_PTR)&amp;socket_ctx, &amp;overlapped, INFINITE); gle = GetLastError(); if (socket_ctx == EXIT_CODE) &#123; break; &#125; if (ret == FALSE) &#123; if (gle == WAIT_TIMEOUT) &#123; continue; &#125; else if (gle == ERROR_NETNAME_DELETED) &#123; printf(&quot;client exit &quot;); RemoveSocketContext(socket_ctx); continue; &#125; else &#123; RemoveSocketContext(socket_ctx); break; &#125; &#125; else &#123; // http://blog.csdn.net/china_jeffery/article/details/78801331 IOCP::PER_IO_CONTEXT *io_ctx = CONTAINING_RECORD(overlapped, IOCP::PER_IO_CONTEXT, overlapped); if ((transferred_bytes == 0) &amp;&amp; (io_ctx-&gt;operation_type == IOCP::RECV_POSTED || io_ctx-&gt;operation_type == IOCP::SEND_POSTED)) &#123; printf(&quot;client disconnect &quot;); RemoveSocketContext(socket_ctx); continue; &#125; switch (io_ctx-&gt;operation_type) &#123; case IOCP::ACCEPT_POSTED: DoAccept(socket_ctx, io_ctx); break; case IOCP::RECV_POSTED: DoRecv(socket_ctx, io_ctx); break; case IOCP::SEND_POSTED: DoSend(socket_ctx, io_ctx); break; default: assert(false); &#125; &#125; &#125; return 0;&#125;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); do &#123; InitializeCriticalSection(&amp;g_cs_socket_ctx_array); g_IOCP = IOCP::CreateNewCompletionPort(); g_exit = CreateEvent(NULL, FALSE, FALSE, NULL); g_work_thread_num = IOCP::GetNumberOfProcesser() * 2; g_work_threads = new HANDLE[g_work_thread_num]; for (int i = 0; i &lt; g_work_thread_num; i++) &#123; g_work_threads[i] = (HANDLE)_beginthreadex(NULL, 0, WorkThreadProc, NULL, 0, NULL); &#125; g_listen_ctx = new IOCP::PER_SOCKET_CONTEXT; g_listen_ctx-&gt;socket = WSASocket(AF_INET, SOCK_STREAM, 0, NULL, 0, WSA_FLAG_OVERLAPPED); if (!IOCP::AssociateDeviceWithCompletionPort(g_IOCP, (HANDLE)g_listen_ctx-&gt;socket, (DWORD)g_listen_ctx)) &#123; printf(&quot;AssociateDeviceWithCompletionPort failed with code: %d &quot;, GetLastError()); break; &#125; struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = htonl(INADDR_ANY); addr.sin_port = htons(kPort); if (bind(g_listen_ctx-&gt;socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; printf(&quot;bind failed with code: %d &quot;, WSAGetLastError()); break; &#125; if (listen(g_listen_ctx-&gt;socket, SOMAXCONN) == SOCKET_ERROR) &#123; printf(&quot;listen failed with code: %d &quot;, WSAGetLastError()); break; &#125; g_AcceptExFn = IOCP::GetAcceptExFnPointer(g_listen_ctx-&gt;socket); if (g_AcceptExFn == NULL) &#123; printf(&quot;GetAcceptExFnPointer failed &quot;); break; &#125; g_AcceptExSockAddrsFn = IOCP::GetAcceptExSockAddrsFnPointer(g_listen_ctx-&gt;socket); if (g_AcceptExSockAddrsFn == NULL) &#123; printf(&quot;GetAcceptExSockAddrsFnPointer failed &quot;); break; &#125; int i = 0; for (; i &lt; 10; i++) &#123; IOCP::PER_IO_CONTEXT *io_ctx = g_listen_ctx-&gt;GetNewIoContext(); if (PostAccept(io_ctx) == FALSE) &#123; break; &#125; &#125; if(i != 10) break; &#125; while (FALSE); printf(&quot; press any ket to stop server... &quot;); getchar(); SetEvent(g_exit); for (int i = 0; i &lt; g_work_thread_num; i++) &#123; PostQueuedCompletionStatus(g_IOCP, 0, (DWORD)EXIT_CODE, NULL); &#125; WaitForMultipleObjects(g_work_thread_num, g_work_threads, TRUE, INFINITE); ClearSocketContextArray(); printf(&quot; press any ket to exit... &quot;); getchar(); DeleteCriticalSection(&amp;g_cs_socket_ctx_array); WSACleanup(); return 0;&#125; 3.2 å®¢æˆ·ç«¯å®¢æˆ·ç«¯ä»£ç å’ŒæœåŠ¡ç«¯ç±»ä¼¼ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ConnectExå‡½æ•°è°ƒç”¨ä¹‹å‰ï¼Œéœ€è¦å°†SOCKETè¿›è¡Œbindæ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;#include &lt;process.h&gt;#include &quot;iocp.h&quot;using namespace std;const std::string kIP = &quot;127.0.0.1&quot;;const u_short kPort = 10001;const std::string kSYN = &quot;(SYN) hello server, I&#x27;m client. Can you hear me?&quot;;const std::string kSYN_ACK = &quot;(SYN+ACK) hello client, I&#x27;m server. I can hear you, can you hear me?&quot;;const std::string kACK = &quot;(ACK) hello server, I&#x27;m client. I can hear you!&quot;;#pragma comment(lib, &quot;Ws2_32.lib&quot;)HANDLE g_IOCP = INVALID_HANDLE_VALUE;HANDLE g_exit = NULL;int g_work_thread_num = 0;HANDLE *g_work_threads = NULL;IOCP::PER_SOCKET_CONTEXT *g_client_ctx = NULL;LPFN_CONNECTEX g_ConnectExFn = NULL;bool PostConnect(IOCP::PER_IO_CONTEXT* io_ctx, const std::string &amp;ip, int port) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::CONNECT_POSTED; io_ctx-&gt;ResetBuffer(); // ConnectEx requires the socket to be initially bound. struct sockaddr_in addr0 = &#123; 0 &#125;; addr0.sin_family = AF_INET; addr0.sin_addr.s_addr = INADDR_ANY; addr0.sin_port = 0; int ret = bind(io_ctx-&gt;socket, (SOCKADDR*)&amp;addr0, sizeof(addr0)); if (ret != 0) &#123; printf(&quot;bind failed: %d &quot;, WSAGetLastError()); return false; &#125; struct sockaddr_in addr1 = &#123; 0 &#125;; addr1.sin_family = AF_INET; addr1.sin_addr.s_addr = inet_addr(ip.c_str()); addr1.sin_port = htons(port); ret = g_ConnectExFn(io_ctx-&gt;socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr1), sizeof(addr1), NULL, 0, NULL, &amp;io_ctx-&gt;overlapped); int gle = WSAGetLastError(); if (ret == SOCKET_ERROR &amp;&amp; gle != WSA_IO_PENDING) &#123; return false; &#125; return true;&#125;bool PostRecv(IOCP::PER_IO_CONTEXT* io_ctx) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::RECV_POSTED; io_ctx-&gt;ResetBuffer(); DWORD recv_bytes = 0; DWORD flags = 0; int ret = WSARecv(io_ctx-&gt;socket, &amp;io_ctx-&gt;wsa_buffer, 1, &amp;recv_bytes, &amp;flags, &amp;io_ctx-&gt;overlapped, NULL); if (ret == SOCKET_ERROR &amp;&amp; WSAGetLastError() != WSA_IO_PENDING) &#123; return false; &#125; return true;&#125;bool PostSend(IOCP::PER_IO_CONTEXT* io_ctx, const char* msg, int msg_len) &#123; if (io_ctx == NULL) return false; io_ctx-&gt;operation_type = IOCP::SEND_POSTED; memcpy(io_ctx-&gt;wsa_buffer.buf, msg, msg_len); io_ctx-&gt;wsa_buffer.len = msg_len; DWORD sent_bytes = 0; int ret = WSASend(io_ctx-&gt;socket, &amp;io_ctx-&gt;wsa_buffer, 1, &amp;sent_bytes, 0, &amp;io_ctx-&gt;overlapped, NULL); int gle = WSAGetLastError(); if (ret == SOCKET_ERROR &amp;&amp; gle != WSA_IO_PENDING) &#123; printf(&quot;WSASend failed with code: %d &quot;, gle); return false; &#125; return true;&#125;bool DoConnect(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; printf(&quot;connect to server &quot;); if (!PostRecv(io_ctx)) &#123; printf(&quot;PostRecv failed &quot;); return false; &#125; IOCP::PER_IO_CONTEXT* new_io_ctx = socket_ctx-&gt;GetNewIoContext(); new_io_ctx-&gt;socket = socket_ctx-&gt;socket; if (!PostSend(new_io_ctx, kSYN.c_str(), kSYN.length())) &#123; printf(&quot;PostSend failed &quot;); return false; &#125; return true;&#125;bool DoRecv(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; printf(&quot;recv: %s &quot;, io_ctx-&gt;wsa_buffer.buf); if (strcmp(io_ctx-&gt;wsa_buffer.buf, kSYN_ACK.c_str()) == 0) &#123; // ACK IOCP::PER_IO_CONTEXT * new_io_ctx = socket_ctx-&gt;GetNewIoContext(); new_io_ctx-&gt;socket = socket_ctx-&gt;socket; if (!PostSend(new_io_ctx, kACK.c_str(), kACK.length())) &#123; printf(&quot;PostSend failed &quot;); return false; &#125; &#125; // post new recv if (!PostRecv(io_ctx)) &#123; printf(&quot;PostRecv failed &quot;); return false; &#125; return true;&#125;bool DoSend(IOCP::PER_SOCKET_CONTEXT *socket_ctx, IOCP::PER_IO_CONTEXT *io_ctx) &#123; printf(&quot;send: %s &quot;, io_ctx-&gt;wsa_buffer.buf); return true;&#125;unsigned int __stdcall WorkThreadProc(void *arg) &#123; DWORD transferred_bytes = 0; IOCP::PER_SOCKET_CONTEXT *socket_ctx = NULL; OVERLAPPED *overlapped = NULL; DWORD gle; while (WaitForSingleObject(g_exit, 0) != WAIT_OBJECT_0) &#123; BOOL ret = GetQueuedCompletionStatus(g_IOCP, &amp;transferred_bytes, (PULONG_PTR)&amp;socket_ctx, &amp;overlapped, INFINITE); gle = GetLastError(); if (socket_ctx == EXIT_CODE) &#123; break; &#125; if (ret == FALSE) &#123; if (gle == WAIT_TIMEOUT) &#123; continue; &#125; else if (gle == ERROR_NETNAME_DELETED) &#123; printf(&quot;server exit &quot;); closesocket(socket_ctx-&gt;socket); socket_ctx-&gt;socket = INVALID_SOCKET; break; &#125; else &#123; closesocket(socket_ctx-&gt;socket); socket_ctx-&gt;socket = INVALID_SOCKET; break; &#125; &#125; else &#123; IOCP::PER_IO_CONTEXT *io_ctx = CONTAINING_RECORD(overlapped, IOCP::PER_IO_CONTEXT, overlapped); switch (io_ctx-&gt;operation_type) &#123; case IOCP::CONNECT_POSTED: DoConnect(socket_ctx, io_ctx); break; case IOCP::RECV_POSTED: DoRecv(socket_ctx, io_ctx); break; case IOCP::SEND_POSTED: DoSend(socket_ctx, io_ctx); break; default: assert(false); &#125; &#125; &#125; return 0;&#125;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); do &#123; g_IOCP = IOCP::CreateNewCompletionPort(); g_exit = CreateEvent(NULL, FALSE, FALSE, NULL); g_work_thread_num = IOCP::GetNumberOfProcesser() * 2; g_work_threads = new HANDLE[g_work_thread_num]; for (int i = 0; i &lt; g_work_thread_num; i++) &#123; g_work_threads[i] = (HANDLE)_beginthreadex(NULL, 0, WorkThreadProc, NULL, 0, NULL); &#125; g_client_ctx = new IOCP::PER_SOCKET_CONTEXT; g_client_ctx-&gt;socket = WSASocket(AF_INET, SOCK_STREAM, 0, NULL, 0, WSA_FLAG_OVERLAPPED); if (!IOCP::AssociateDeviceWithCompletionPort(g_IOCP, (HANDLE)g_client_ctx-&gt;socket, (DWORD)g_client_ctx)) &#123; printf(&quot;AssociateDeviceWithCompletionPort failed with code: %d &quot;, GetLastError()); break; &#125; g_ConnectExFn = IOCP::GetConnectExFnPointer(g_client_ctx-&gt;socket); if (g_ConnectExFn == NULL) &#123; printf(&quot;GetConnectExFnPointer failed &quot;); break; &#125; IOCP::PER_IO_CONTEXT* io_ctx = g_client_ctx-&gt;GetNewIoContext(); io_ctx-&gt;socket = g_client_ctx-&gt;socket; if (!PostConnect(io_ctx, kIP, kPort)) &#123; printf(&quot;PostConnect failed &quot;); &#125; &#125; while (FALSE); printf(&quot;press any key to exit client... &quot;); getchar(); SetEvent(g_exit); closesocket(g_client_ctx-&gt;socket); getchar(); WSACleanup(); return 0;&#125; å®Œæ•´å·¥ç¨‹ä¸‹è½½åœ°å€ï¼šhttps://github.com/winsoft666/CodeSnippet/tree/main/CompletionPort-Sample","categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"ç”±å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°å¼•èµ·çš„å´©æºƒ","path":"/post/432875265.html","content":"æœ¬æ–‡è®°å½•ä¸€ä¸ªç”±é”™è¯¯ä½¿ç”¨StringCchVPrintfç­‰æ ¼å¼åŒ–å‡½æ•°æ‰€å¯¼è‡´çš„å´©æºƒé—®é¢˜ã€‚ ä¸€. é—®é¢˜æè¿°æˆ‘ä»¬å¸¸ç”¨çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°æœ‰ï¼š 123456HRESULT StringCchVPrintf( _Out_ LPTSTR pszDest, _In_ size_t cchDest, _In_ LPCTSTR pszFormat, _In_ va_list argList); 1int printf ( const char * format, ... ); å¯¹äºå¦‚ä¸‹çš„è°ƒç”¨ï¼š 12char buf[100] = &#123;0&#125;;StringCchVPrintf(buf, 100, &quot;select * from member where name like &#x27;%sjj%&#x27;;&quot;); æ­¤æ—¶bufä¸­å­˜å‚¨çš„å¹¶ä¸æ˜¯æœŸæœ›çš„select * from member where name like &#39;%sjj%&#39;;å­—ç¬¦ä¸²ã€‚ä¸å‡ºæ„å¤–ï¼Œ%sjj%å¤„çš„%sä¼šå˜æˆä¹±ç ã€‚ å› ä¸ºå‡½æ•°å°†%sjj%ä¸­çš„%så½“åšäº†å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸²äº†ï¼Œè€Œæˆ‘ä»¬åˆæ²¡æœ‰ç»™æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå³å¯å˜å‚æ•°ï¼‰ä¼ å€¼ï¼Œæ ¹æ®å¯å˜å‚æ•°çš„åŸç†ï¼Œé»˜è®¤ä¼šæ ¹æ®formatå‚æ•°çš„åœ°å€æ¥å–ä¸€ä¸ªåœ°å€è®©%sè¿›è¡Œè¾“å‡ºã€‚ å…·ä½“è®¡ç®—æ–¹å¼å‚è€ƒva_startå®å®šä¹‰: 12#define va_start _crt_va_start#define _crt_va_start(ap,v) ( ap = (va_list)_ADDRESSOF(v) + _INTSIZEOF(v) ) è¿™ä¸ªåœ°å€çš„å†…å®¹æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥å°±å¯èƒ½å‡ºç°ä¹±ç æˆ–å´©æºƒã€‚ äºŒ. è§£å†³æ–¹æ¡ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦åšåˆ°ä¸€ç‚¹ï¼Œåœ¨è°ƒç”¨StringCchVPrintfã€vsprintfã€vswprintfã€_vstprintfã€printfç­‰å‡½æ•°æ—¶ï¼Œä¸€å®šä¸è¦å°†å›ºå®šå­—ç¬¦ä¸²ä¼ å…¥åˆ°pszFormatå‚æ•°ï¼Œå¦‚ï¼š 1StringCchVPrintf(szBuf, 512, &quot;æˆ‘æƒ³è¾“å‡ºå•çº¯çš„%sï¼Œæˆ‘æ˜¯é”™è¯¯çš„æ ¼å¼ç¤ºèŒƒ&quot;); // é”™è¯¯çš„ è¿™ä¸ªæ—¶å€™ï¼Œå•çº¯çš„%sä¸­çš„%så·²ç»ä¸åœ¨å•çº¯ã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ï¼š 1StringCchVPrintf(szBuf, 512, &quot;%s&quot;, &quot;æˆ‘æƒ³è¾“å‡ºå•çº¯çš„%sï¼Œæˆ‘æ˜¯æ­£ç¡®çš„æ ¼å¼ç¤ºèŒƒ&quot;); åŒç†ï¼Œä¸‹é¢çš„è°ƒç”¨æ–¹å¼ä¹Ÿæ˜¯é”™è¯¯çš„ã€å±é™©çš„ï¼š 12std::string strInfo = GetInfo();printf(strInfo.c_str()); æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å­—ç¬¦ä¸²","å´©æºƒ"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"Windowså¥—æ¥å­—I/Oæ¨¡å‹(4)-WSAEventSelectæ¨¡å‹","path":"/post/547434843.html","content":"ä¸€ã€WSAEventSelectæ¨¡å‹ä»‹ç»WSAEventSelectæ¨¡å‹å’ŒWSAAsyncSelectæ¨¡å‹ç±»ä¼¼ï¼Œä½†WSAEventSelectæ¨¡å‹å…è®¸åº”ç”¨ç¨‹åºåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå¥—æ¥å­—ä¸Šé¢æ¥æ”¶ä»¥äº‹ä»¶ä¸ºåŸºç¡€çš„ç½‘ç»œäº‹ä»¶é€šçŸ¥ã€‚è¯¥æ¨¡å‹å’ŒWSAAsyncSelectæ¨¡å‹çš„æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºç½‘ç»œäº‹ä»¶æ˜¯ç”±äº‹ä»¶å¯¹è±¡å¥æŸ„å®Œæˆçš„ï¼Œè€Œä¸æ˜¯é€šè¿‡çª—å£æ¶ˆæ¯å®Œæˆçš„ã€‚ è¯¥æ¨¡å‹è¦æ±‚åº”ç”¨ç¨‹åºé’ˆå¯¹æ‰“ç®—ä½¿ç”¨çš„æ¯ä¸€ä¸ªå¥—æ¥å­—éƒ½åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡ã€‚åˆ›å»ºæ–¹æ³•æ˜¯å°±æ˜¯è°ƒç”¨WSACreateEventå‡½æ•°ã€‚ 1WSAEVENT WSACreateEvent(void); WSACreateEventå‡½æ•°è¿”å›ä¸€ä¸ªäººå·¥æ§åˆ¶(manual)ã€æ— ä¿¡å·çš„äº‹ä»¶å¯¹è±¡å¥æŸ„ã€‚å¾—åˆ°äº‹ä»¶å¥æŸ„ä¹‹åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨WSAEventSelectå‡½æ•°ï¼Œå°†å®ƒå’Œå¥—æ¥å­—ç›¸å…³è”ï¼ŒåŒæ—¶æ³¨å†Œæ„Ÿå…´è¶£çš„ç½‘ç»œäº‹ä»¶ã€‚ 12345int WSAEventSelect( _In_ SOCKET s, _In_ WSAEVENT hEventObject, _In_ long lNetworkEvents); å…·ä½“çš„å‚æ•°è§£é‡Šå¯ä»¥å‚è€ƒMSDNï¼šhttps://msdn.microsoft.com/en-us/library/windows/desktop/ms741576(v=vs.85).aspx å’ŒCreateEventåˆ›å»ºçš„äº‹ä»¶ç±»å‹ï¼Œwindowsæä¾›äº†ç±»ä¼¼çš„APIæ¥é‡ç½®äº‹ä»¶ä¿¡å·ã€å…³é—­äº‹ä»¶ç­‰ï¼Œå¦‚WSAResetEvent, WSACloseEventç­‰ã€‚ åŒæ ·æä¾›äº†å’ŒWaitForMultipleObjectsç±»ä¼¼çš„å‡½æ•°WSAWaitForMultipleEventsæ¥ç­‰å¾…å¤šä¸ªäº‹ä»¶ä¿¡å·ï¼Œå…¶å‚æ•°ä¹Ÿå’ŒWaitForMultipleObjectsç±»ä¼¼ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWSAWaitForMultipleEventsæœ€å¤šåªæ”¯æŒåŒæ—¶ç­‰å¾…64ä¸ªäº‹ä»¶ï¼Œå¦‚æœéœ€è¦ç­‰å¾…è¶…è¿‡64ä¸ªäº‹ä»¶ï¼Œéœ€è¦ä½¿ç”¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨å¤šæ¬¡WSAWaitForMultipleEventså‡½æ•°æ¥å®ç°ï¼Œè¿™ä¹Ÿæ˜¯WSAEventSelectæ¨¡å‹çš„ä¸€å¤§å¼Šç«¯ã€‚ 12345int WSAEnumNetworkEvents( _In_ SOCKET s, _In_ WSAEVENT hEventObject, _Out_ LPWSANETWORKEVENTS lpNetworkEvents); WSAEnumNetworkEventså‡½æ•°ç”¨äºè·å–æŒ‡å®šSOCKETä¸Šå‘é€äº†å“ªäº›äº‹ä»¶ï¼ˆæ˜¯FD_READï¼Œè¿˜æ˜¯FD_WRITEï¼Œæˆ–è€…è¯´è¿˜æ˜¯FD_ACCEPTç­‰ï¼‰ï¼ŒhEventObjectå‚æ•°ä¼ å…¥äº‹ä»¶å¥æŸ„ï¼Œå‡½æ•°ä¼šè‡ªåŠ¨å°†äº‹ä»¶ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ï¼Œä¸éœ€è¦å†æ¬¡è°ƒç”¨WSAResetEventæ¥é‡ç½®ä¿¡å·ã€‚ å…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è€ƒä¸‹é¢â€œç¤ºä¾‹ç¨‹åºâ€ã€‚ äºŒã€ç¤ºä¾‹æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç€é‡åœ¨åˆ—å‡ºWSAEventSelectæ¨¡å‹çš„åŸºæœ¬ç”¨æ³•ï¼Œå¹¶æœªå®ç°å¤æ‚çš„é€»è¾‘ã€‚æœåŠ¡ç«¯åœ¨æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥ä¸Šæ—¶ï¼Œç»™å®¢æˆ·ç«¯å‘é€â€œhello, Iâ€™m server.â€æ¶ˆæ¯ï¼Œå¹¶ä¸”åœ¨æœåŠ¡ç«¯é€€å‡ºæ—¶ä¼šå…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ã€‚å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡ç«¯ä¹‹åï¼Œä¸é—´æ–­æ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯ã€‚ ç¤ºä¾‹ç¨‹åºåªä½¿ç”¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ¥ç­‰å¾…æœ€å¤š64ä¸ªäº‹ä»¶ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤šåªæ”¯æŒ64-1&#x3D;63ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼‰ï¼Œå¦‚æœéœ€è¦æ”¯æŒæ›´å¤šçš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹æ¥ç­‰å¾…ã€‚ 2.1 æœåŠ¡ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;using namespace std;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const u_short kPort = 10001;const std::string kHelloServer = &quot;hello, I&#x27;m server.&quot;;HANDLE g_event_array[WSA_MAXIMUM_WAIT_EVENTS];SOCKET g_socket_array[WSA_MAXIMUM_WAIT_EVENTS];int g_index = 0;template&lt;typename T&gt;void RemoveArrayIndex(T arr[], int total, int index) &#123; if (index &gt; total) return; for (int i = index; i &lt; (total - 1); i++) &#123; arr[i] = arr[i + 1]; &#125;&#125;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); do &#123; // (1) g_socket_array[g_index] = ::socket(AF_INET, SOCK_STREAM, 0); if (g_socket_array[0] == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = htonl(INADDR_ANY); addr.sin_port = htons(kPort); if (bind(g_socket_array[g_index], reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;bind failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (3) g_event_array[g_index] = WSACreateEvent(); WSAEventSelect(g_socket_array[g_index], g_event_array[g_index], FD_ACCEPT | FD_READ | FD_WRITE | FD_CLOSE); // (4) if (listen(g_socket_array[g_index], 5) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;listen failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; std::cout &lt;&lt; &quot;listen on port: &quot; &lt;&lt; kPort &lt;&lt; std::endl; // (5) // è¯¥å¾ªç¯å¯ä»¥æ”¾åˆ°å­çº¿ç¨‹ä¸­ while (true) &#123; DWORD ret = WSAWaitForMultipleEvents(g_index + 1, g_event_array, FALSE, WSA_INFINITE, FALSE); if(ret == WSA_WAIT_FAILED || ret == WSA_WAIT_TIMEOUT) continue; // å¿½ç•¥ä¸Šé¢WSAWaitForMultipleEventsè¿”å›å€¼æ‰€è¡¨ç¤ºçš„indexã€‚éå†æ¯ä¸ªsocketï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä¿¡å·ã€‚ for (int i = 0; i &lt;= g_index; i++) &#123; ret = WSAWaitForMultipleEvents(1, &amp;g_event_array[i], FALSE, 0, FALSE); if (ret == WSA_WAIT_FAILED || ret == WSA_WAIT_TIMEOUT) &#123; continue; &#125; WSANETWORKEVENTS network_events; // WSAEnumNetworkEventå‡½æ•°ä¼šå°†äº‹ä»¶é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ WSAEnumNetworkEvents(g_socket_array[i], g_event_array[i], &amp;network_events); if (network_events.lNetworkEvents &amp; FD_ACCEPT) &#123; if (network_events.iErrorCode[FD_ACCEPT_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_ACCEPT failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_ACCEPT_BIT] &lt;&lt; &quot; &quot;; break; &#125; SOCKET s = accept(g_socket_array[i], NULL, NULL); if (s == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;accept failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; if (g_index &gt;= WSA_MAXIMUM_WAIT_EVENTS - 1) &#123; std::cout &lt;&lt; &quot;too many connection &quot;; closesocket(s); break; &#125; g_index++; g_event_array[g_index] = WSACreateEvent(); g_socket_array[g_index] = s; std::cout &lt;&lt; &quot;new connection &quot;; int err = send(s, (const char*)kHelloServer.c_str(), kHelloServer.length(), 0); if (err == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;send failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; &#125; if (network_events.lNetworkEvents &amp; FD_READ) &#123; if (network_events.iErrorCode[FD_READ_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_READ failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_READ_BIT] &lt;&lt; &quot; &quot;; break; &#125; char buf[100] = &#123; 0 &#125;; int err = recv(g_socket_array[i], buf, 100, 0); if (err &gt; 0) &#123; std::cout &lt;&lt; &quot;recv: &quot; &lt;&lt; buf &lt;&lt; std::endl; &#125; else if (err == 0) &#123; std::cout &lt;&lt; &quot;connection closed.&quot; &lt;&lt; std::endl; closesocket(g_socket_array[i]); WSACloseEvent(g_event_array[i]); RemoveArrayIndex(g_socket_array, g_index, i); RemoveArrayIndex(g_event_array, g_index, i); g_index--; &#125; else &#123; std::cout &lt;&lt; &quot;recv failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; closesocket(g_socket_array[i]); WSACloseEvent(g_event_array[i]); RemoveArrayIndex(g_socket_array, g_index, i); RemoveArrayIndex(g_event_array, g_index, i); g_index--; &#125; &#125; if (network_events.lNetworkEvents &amp; FD_WRITE) &#123; if (network_events.iErrorCode[FD_WRITE_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_WRITE failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_WRITE_BIT] &lt;&lt; &quot; &quot;; break; &#125; &#125; if (network_events.lNetworkEvents &amp; FD_CLOSE) &#123; if (network_events.iErrorCode[FD_CLOSE_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_CLOSE failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_CLOSE_BIT] &lt;&lt; &quot; &quot;; break; &#125; closesocket(g_socket_array[i]); WSACloseEvent(g_event_array[i]); RemoveArrayIndex(g_socket_array, g_index, i); RemoveArrayIndex(g_event_array, g_index, i); g_index--; &#125; &#125; &#125; // while &#125; while (false); // (6) for (int i = 0; i &lt;= g_index; i++) &#123; closesocket(g_socket_array[i]); WSACloseEvent(g_event_array[i]); &#125; WSACleanup(); return 0;&#125; 2.2 å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;using namespace std;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const std::string kIP = &quot;127.0.0.1&quot;;const u_short kPort = 10001;HANDLE g_event;SOCKET g_socket;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); do &#123; // (1) g_socket = ::socket(AF_INET, SOCK_STREAM, 0); if (g_socket == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) g_event = WSACreateEvent(); WSAEventSelect(g_socket, g_event, FD_CONNECT | FD_READ | FD_WRITE | FD_CLOSE); // (3) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = inet_addr(kIP.c_str()); addr.sin_port = htons(kPort); if (connect(g_socket, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; int gle_err = WSAGetLastError(); if (gle_err != WSAEWOULDBLOCK) &#123; std::cout &lt;&lt; &quot;connect failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; &quot; &quot;; break; &#125; &#125; // (4) while (true) &#123; DWORD ret = WSAWaitForMultipleEvents(1, &amp;g_event, FALSE, WSA_INFINITE, FALSE); if (ret == WSA_WAIT_FAILED || ret == WSA_WAIT_TIMEOUT) &#123; continue; &#125; WSANETWORKEVENTS network_events; // WSAEnumNetworkEventå‡½æ•°ä¼šå°†äº‹ä»¶é‡ç½®ä¸ºæ— ä¿¡å·çŠ¶æ€ WSAEnumNetworkEvents(g_socket, g_event, &amp;network_events); if (network_events.lNetworkEvents &amp; FD_CONNECT) &#123; if (network_events.iErrorCode[FD_CONNECT_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_CONNECT failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_CONNECT_BIT] &lt;&lt; &quot; &quot;; break; &#125; std::cout &lt;&lt; &quot;connect to server &quot;; &#125; if (network_events.lNetworkEvents &amp; FD_READ) &#123; if (network_events.iErrorCode[FD_READ_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_READ failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_READ_BIT] &lt;&lt; &quot; &quot;; break; &#125; char buf[100] = &#123; 0 &#125;; int err = recv(g_socket, buf, 100, 0); if (err &gt; 0) &#123; std::cout &lt;&lt; &quot;recv: &quot; &lt;&lt; buf &lt;&lt; std::endl; &#125; else if (err == 0) &#123; std::cout &lt;&lt; &quot;connection closed.&quot; &lt;&lt; std::endl; closesocket(g_socket); WSACloseEvent(g_event); &#125; else &#123; std::cout &lt;&lt; &quot;recv failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; closesocket(g_socket); WSACloseEvent(g_event); &#125; &#125; if (network_events.lNetworkEvents &amp; FD_WRITE) &#123; if (network_events.iErrorCode[FD_WRITE_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_WRITE failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_WRITE_BIT] &lt;&lt; &quot; &quot;; break; &#125; &#125; if (network_events.lNetworkEvents &amp; FD_CLOSE) &#123; if (network_events.iErrorCode[FD_CLOSE_BIT] != 0) &#123; std::cout &lt;&lt; &quot;FD_CLOSE failed with code: &quot; &lt;&lt; network_events.iErrorCode[FD_CLOSE_BIT] &lt;&lt; &quot; &quot;; break; &#125; closesocket(g_socket); WSACloseEvent(g_event); &#125; &#125; // while &#125; while (false); // (5) closesocket(g_socket); WSACloseEvent(g_event); WSACleanup(); return 0;&#125;","categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"Windowså¥—æ¥å­—I/Oæ¨¡å‹(3)-WSAAsyncSelectæ¨¡å‹","path":"/post/2544551173.html","content":"ä¸€ã€WSAAsyncSelectæ¨¡å‹ä»‹ç»åˆ©ç”¨WSAAsyncSelectæ¨¡å‹ç»“åˆwindowsçª—å£æ¶ˆæ¯å¾ªç¯ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸€ä¸ªå¥—æ¥å­—ä¸Šæ¥æ”¶ä»¥Windowsæ¶ˆæ¯ä¸ºåŸºç¡€çš„ç½‘ç»œäº‹ä»¶é€šçŸ¥ã€‚è¦æƒ³ä½¿ç”¨WSAAsyncSelectæ¨¡å‹ï¼Œé¦–å…ˆå¿…é¡»åˆ›å»ºä¸€ä¸ªWindowsçª—å£ï¼Œå¹¶ä¸ºè¯¥çª—å£æä¾›ä¸€ä¸ªçª—å£è¿‡ç¨‹æ”¯æŒå‡½æ•°ã€‚ 123456int WSAAsyncSelect( _In_ SOCKET s, _In_ HWND hWnd, _In_ unsigned int wMsg, _In_ long lEvent); s æŒ‡å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„å¥—æ¥å­—ã€‚hWnd æŒ‡å®šä¸€ä¸ªçª—å£å¥æŸ„ï¼Œå®ƒè¡¨ç¤ºç½‘ç»œäº‹ä»¶å‘ç”Ÿä¹‹åï¼Œæ”¶åˆ°æ¶ˆæ¯é€šçŸ¥çš„é‚£ä¸ªçª—å£ã€‚wMsg è¡¨ç¤ºåœ¨ç½‘ç»œäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œçª—å£æ”¶åˆ°çš„æ¶ˆæ¯ã€‚lEvent ä»£è¡¨ä¸€ä¸ªæ©ç ï¼ŒæŒ‡å®šåº”ç”¨ç¨‹åºæ„Ÿå…´è¶£çš„ç½‘ç»œäº‹ä»¶çš„ç»„åˆã€‚äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼šFD_READï¼ŒFD_WRITEï¼ŒFD_CLOSEï¼ŒFD_CONNECTï¼ŒFD_ACCEPTã€‚å¯¹äºFD_CONNECTï¼ŒFD_ACCEPTï¼ŒæœåŠ¡ç«¯ä¸€èˆ¬ä½¿ç”¨FD_ACCEPTï¼Œå®¢æˆ·ç«¯ä¸€èˆ¬ä½¿ç”¨FD_CONNECTã€‚è‹¥å°†lEventè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºåœæ­¢æ¥æ”¶è¯¥å¥—æ¥å­—ä¸Šçš„æ‰€æœ‰ç½‘ç»œäº‹ä»¶é€šçŸ¥ã€‚ ä¸€æ—¦è°ƒç”¨WSAAsyncSelectåœ¨å¥—æ¥å­—ä¸Šå¯ç”¨äº†äº‹ä»¶é€šçŸ¥ï¼Œé™¤éæ˜ç¡®è°ƒç”¨closesocketï¼Œæˆ–è€…å†æ¬¡è°ƒç”¨WSAAsyncSelecté‡æ–°è®¾ç½®ç½‘ç»œäº‹ä»¶ç±»å‹ï¼Œå¦åˆ™ï¼Œäº‹ä»¶é€šçŸ¥æ€»æ˜¯æœ‰æ•ˆçš„ã€‚ WSAAsyncSelectæ¨¡å‹éœ€è¦ç»“åˆwindowsçª—å£æ¥ä½¿ç”¨ï¼Œä¸é€‚ç”¨äºæ²¡æœ‰ç•Œé¢çš„æœåŠ¡ç¨‹åºã€‚å»ºè®®ä½¿ç”¨WSAEventSelectæ¨¡å‹æ¥ä»£æ›¿ã€‚ äºŒã€ç¤ºä¾‹å› ä¸ºé‡ç‚¹ä¸åœ¨ç•Œé¢ç¼–ç¨‹ä¸Šé¢ï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­ä½¿ç”¨TraceMsgAæ‰“å°ä¿¡æ¯åˆ°visual studioçš„è¾“å‡ºçª—å£æˆ–debugviewã€‚InitWindowå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªç®€å•çš„ã€ç©ºç™½çš„çª—å£ï¼Œå°†å¥æŸ„å­˜å‚¨åœ¨å…¨å±€å˜é‡g_hwndä¸­ã€‚WndProcä¸ºçª—å£çš„å¤„ç†è¿‡ç¨‹å‡½æ•°ã€‚ æœåŠ¡ç«¯åœ¨æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥ä¸Šæ—¶ï¼Œç»™å®¢æˆ·ç«¯å‘é€â€œhello, Iâ€™m server.â€æ¶ˆæ¯ï¼Œåœ¨æœåŠ¡ç«¯é€€å‡ºæ—¶ï¼Œå…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ã€‚å®¢æˆ·ç«¯è¿æ¥ä¸ŠæœåŠ¡ç«¯ä¹‹åï¼Œæ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯ã€‚ 2.1 æœåŠ¡ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210#include &lt;winsock2.h&gt;#include &lt;vector&gt;#include &lt;strsafe.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const u_short kPort = 10001;const std::string kHelloServer = &quot;hello, I&#x27;m server.&quot;;#define WUM_SOCKET (WM_USER+1)HWND g_hwnd;SOCKET socket_srv = INVALID_SOCKET;std::vector&lt;SOCKET&gt; clients;void TraceMsgA(const char *lpFormat, ...) &#123; if (!lpFormat) return; char *pMsgBuffer = NULL; unsigned int iMsgBufCount = 0; va_list arglist; va_start(arglist, lpFormat); HRESULT hr = STRSAFE_E_INSUFFICIENT_BUFFER; while (hr == STRSAFE_E_INSUFFICIENT_BUFFER) &#123; iMsgBufCount += 1024; if (pMsgBuffer) &#123; free(pMsgBuffer); pMsgBuffer = NULL; &#125; pMsgBuffer = (char*)malloc(iMsgBufCount * sizeof(char)); if (!pMsgBuffer) &#123; break; &#125; hr = StringCchVPrintfA(pMsgBuffer, iMsgBufCount, lpFormat, arglist); &#125; va_end(arglist); if (hr == S_OK) &#123; OutputDebugStringA(pMsgBuffer); &#125; if (pMsgBuffer) &#123; free(pMsgBuffer); pMsgBuffer = NULL; &#125;&#125;LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)&#123; int err; SOCKET s; char buf[100] = &#123; 0 &#125;; switch (message) &#123; // (5) case WUM_SOCKET: if (WSAGETSELECTERROR(lParam)) &#123; closesocket((SOCKET)wParam); break; &#125; switch (WSAGETSELECTEVENT(lParam)) &#123; case FD_ACCEPT: s = accept((SOCKET)wParam, NULL, NULL); clients.push_back(s); WSAAsyncSelect(s, g_hwnd, WUM_SOCKET, FD_READ | FD_WRITE | FD_CLOSE); TraceMsgA(&quot;new connection &quot;); err = send(s, (const char*)kHelloServer.c_str(), kHelloServer.length(), 0); if (err == SOCKET_ERROR) &#123; TraceMsgA(&quot;send failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; break; case FD_READ: err = recv((SOCKET)wParam, buf, 100, 0); if (err &gt; 0) &#123; TraceMsgA(&quot;recv: %s &quot;, buf); &#125; else if (err == 0) &#123; TraceMsgA(&quot;connection closed &quot;); closesocket((SOCKET)wParam); &#125; else &#123; TraceMsgA(&quot;recv failed, GLE: %d &quot;, WSAGetLastError()); closesocket((SOCKET)wParam); &#125; break; case FD_WRITE: break; case FD_CLOSE: closesocket((SOCKET)wParam); for (std::vector&lt;SOCKET&gt;::iterator it = clients.begin(); it != clients.end(); it++) &#123; if (*it == (SOCKET)wParam) &#123; clients.erase(it); break; &#125; &#125; break; &#125; break; case WM_DESTROY: PostQuitMessage(0); break; default: return DefWindowProc(hWnd, message, wParam, lParam); &#125; return 0;&#125;void InitWindow(HINSTANCE hInstance) &#123; WCHAR szWindowClass[100] = L&quot;Test&quot;; WNDCLASSEX wcex = &#123; sizeof(WNDCLASSEX) &#125;; wcex.style = CS_HREDRAW | CS_VREDRAW; wcex.lpfnWndProc = WndProc; wcex.cbClsExtra = 0; wcex.cbWndExtra = 0; wcex.hInstance = hInstance; wcex.lpszClassName = szWindowClass; RegisterClassExW(&amp;wcex); g_hwnd = CreateWindowW(szWindowClass, L&quot;server&quot;, WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, nullptr, nullptr, hInstance, nullptr); if (g_hwnd) &#123; ShowWindow(g_hwnd, SW_SHOW); UpdateWindow(g_hwnd); &#125;&#125;int APIENTRY wWinMain(_In_ HINSTANCE hInstance, _In_opt_ HINSTANCE hPrevInstance, _In_ LPWSTR lpCmdLine, _In_ int nCmdShow)&#123; UNREFERENCED_PARAMETER(hPrevInstance); UNREFERENCED_PARAMETER(lpCmdLine); InitWindow(hInstance); WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); do &#123; // (1) socket_srv = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_srv == INVALID_SOCKET) &#123; TraceMsgA(&quot;create socket failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = htonl(INADDR_ANY); addr.sin_port = htons(kPort); if (bind(socket_srv, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; TraceMsgA(&quot;bind failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; // (3) WSAAsyncSelect(socket_srv, g_hwnd, WUM_SOCKET, FD_ACCEPT | FD_READ | FD_WRITE | FD_CLOSE); // (4) if (listen(socket_srv, 5) == SOCKET_ERROR) &#123; TraceMsgA(&quot;listen failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; TraceMsgA(&quot;listen on port: %d &quot;, kPort); &#125; while (false); MSG msg; while (GetMessage(&amp;msg, nullptr, 0, 0)) &#123; TranslateMessage(&amp;msg); DispatchMessage(&amp;msg); &#125; for (std::vector&lt;SOCKET&gt;::iterator it = clients.begin(); it != clients.end(); it++) &#123; closesocket(*it); &#125; // (6) closesocket(socket_srv); WSACleanup(); return 0;&#125; 2.2 å®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179#include &lt;winsock2.h&gt;#include &lt;vector&gt;#include &lt;strsafe.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const std::string kIP = &quot;127.0.0.1&quot;;const u_short kPort = 10001;#define WUM_SOCKET (WM_USER+1)HWND g_hwnd;void TraceMsgA(const char *lpFormat, ...) &#123; if (!lpFormat) return; char *pMsgBuffer = NULL; unsigned int iMsgBufCount = 0; va_list arglist; va_start(arglist, lpFormat); HRESULT hr = STRSAFE_E_INSUFFICIENT_BUFFER; while (hr == STRSAFE_E_INSUFFICIENT_BUFFER) &#123; iMsgBufCount += 1024; if (pMsgBuffer) &#123; free(pMsgBuffer); pMsgBuffer = NULL; &#125; pMsgBuffer = (char*)malloc(iMsgBufCount * sizeof(char)); if (!pMsgBuffer) &#123; break; &#125; hr = StringCchVPrintfA(pMsgBuffer, iMsgBufCount, lpFormat, arglist); &#125; va_end(arglist); if (hr == S_OK) &#123; OutputDebugStringA(pMsgBuffer); &#125; if (pMsgBuffer) &#123; free(pMsgBuffer); pMsgBuffer = NULL; &#125;&#125;LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)&#123; int err; SOCKET s; char buf[100] = &#123; 0 &#125;; switch (message) &#123; // (4) case WUM_SOCKET: if (WSAGETSELECTERROR(lParam)) &#123; closesocket((SOCKET)wParam); TraceMsgA(&quot;connect failed, %d &quot;, WSAGETSELECTERROR(lParam)); break; &#125; switch (WSAGETSELECTEVENT(lParam)) &#123; case FD_CONNECT: TraceMsgA(&quot;connection to server &quot;); break; case FD_READ: err = recv((SOCKET)wParam, buf, 100, 0); if (err &gt; 0) &#123; TraceMsgA(&quot;recv: %s &quot;, buf); &#125; else if (err == 0) &#123; closesocket((SOCKET)wParam); TraceMsgA(&quot;connection closed &quot;); &#125; else &#123; closesocket((SOCKET)wParam); TraceMsgA(&quot;recv failed, GLE: %d &quot;, WSAGetLastError()); &#125; break; case FD_WRITE: break; case FD_CLOSE: closesocket((SOCKET)wParam); TraceMsgA(&quot;connection closed &quot;); break; &#125; break; case WM_DESTROY: PostQuitMessage(0); break; default: return DefWindowProc(hWnd, message, wParam, lParam); &#125; return 0;&#125;void InitWindow(HINSTANCE hInstance) &#123; WCHAR szWindowClass[100] = L&quot;Test&quot;; WNDCLASSEX wcex = &#123; sizeof(WNDCLASSEX) &#125;; wcex.style = CS_HREDRAW | CS_VREDRAW; wcex.lpfnWndProc = WndProc; wcex.cbClsExtra = 0; wcex.cbWndExtra = 0; wcex.hInstance = hInstance; wcex.lpszClassName = szWindowClass; RegisterClassExW(&amp;wcex); g_hwnd = CreateWindowW(szWindowClass, L&quot;client&quot;, WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, nullptr, nullptr, hInstance, nullptr); if (g_hwnd) &#123; ShowWindow(g_hwnd, SW_SHOW); UpdateWindow(g_hwnd); &#125;&#125;int APIENTRY wWinMain(_In_ HINSTANCE hInstance, _In_opt_ HINSTANCE hPrevInstance, _In_ LPWSTR lpCmdLine, _In_ int nCmdShow)&#123; UNREFERENCED_PARAMETER(hPrevInstance); UNREFERENCED_PARAMETER(lpCmdLine); InitWindow(hInstance); WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket_ = INVALID_SOCKET; do &#123; // (1) socket_ = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_ == INVALID_SOCKET) &#123; TraceMsgA(&quot;create socket failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; // (2) WSAAsyncSelect(socket_, g_hwnd, WUM_SOCKET, FD_CONNECT | FD_READ | FD_WRITE | FD_CLOSE); // (3) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = inet_addr(kIP.c_str()); addr.sin_port = htons(kPort); if (connect(socket_, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; int gle_err = WSAGetLastError(); if (gle_err != WSAEWOULDBLOCK) &#123; TraceMsgA(&quot;connect failed, GLE: %d &quot;, WSAGetLastError()); break; &#125; &#125; &#125; while (false); MSG msg; while (GetMessage(&amp;msg, nullptr, 0, 0)) &#123; TranslateMessage(&amp;msg); DispatchMessage(&amp;msg); &#125; // (5) closesocket(socket_); WSACleanup(); return 0;&#125; ä»£ç ä¸‹è½½åœ°å€: https://github.com/winsoft666/CodeSnippet/tree/main/WSAAsyncSelect-Sample","categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"Windowså¥—æ¥å­—I/Oæ¨¡å‹(2)-Selectæ¨¡å‹","path":"/post/640627104.html","content":"ä¸€ã€Selectæ¨¡å‹ä»‹ç»å¥—æ¥å­—Selectæ¨¡å‹çš„ä¸­å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨selectå‡½æ•°å®ç°å¯¹I&#x2F;Oçš„ç®¡ç†ã€‚åˆ©ç”¨selectå‡½æ•°æ¥åˆ¤æ–­å¥—æ¥å­—ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰ä¸Šæ˜¯å¦å­˜åœ¨æ•°æ®ï¼Œæˆ–è€…èƒ½å¦å‘å¥—æ¥å­—å†™å…¥æ•°æ®ã€‚å®ƒä¹Ÿæ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¼šé˜»å¡ã€‚ä½†å’Œé˜»å¡æ¨¡å‹ä¸åŒçš„æ˜¯ï¼ŒSelectæ¨¡å‹å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªSocketã€‚ selectå‡½æ•°åŸå‹ï¼š 1234567int select ( int nfds, fd_set FAR * readfds, fd_set FAR * writefds, fd_set FAR * exceptfds, const struct timeval FAR * timeout ); ç¬¬ä¸€ä¸ªå‚æ•°nfdsä¼šè¢«å¿½ç•¥ã€‚ä¹‹æ‰€ä»¥ä»ç„¶è¦æä¾›è¿™ä¸ªå‚æ•°ï¼Œåªæ˜¯ä¸ºäº†ä¿æŒä¸æ—©æœŸçš„Berkeleyå¥—æ¥å­—åº”ç”¨ç¨‹åºçš„å…¼å®¹ã€‚ ä¸‰ä¸ªfd_setå‚æ•°ï¼šä¸€ä¸ªç”¨äºæ£€æŸ¥å¯è¯»æ€§ï¼ˆreadfdsï¼‰ï¼Œä¸€ä¸ªç”¨äºæ£€æŸ¥å¯å†™æ€§ï¼ˆwritefdsï¼‰ï¼Œå¦ä¸€ä¸ªç”¨äºä¾‹å¤–æ•°æ®ï¼ˆ excepfdsï¼‰ã€‚ ä»æ ¹æœ¬ä¸Šè¯´ï¼Œfdsetæ•°æ®ç±»å‹ä»£è¡¨ç€ä¸€ç³»åˆ—ç‰¹å®šå¥—æ¥å­—çš„é›†åˆã€‚å…¶ä¸­ï¼Œreadfdsé›†åˆåŒ…æ‹¬ç¬¦åˆä¸‹è¿°ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„å¥—æ¥å­—ï¼š æœ‰æ•°æ®å¯ä»¥è¯»å…¥ã€‚ è¿æ¥å·²ç»å…³é—­ã€é‡è®¾æˆ–ä¸­æ­¢ã€‚(å¯ä»¥ç”¨æ¥åˆ¤æ–­å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯ç¨‹åºæ˜¯å¦é€€å‡ºäº†) å‡å¦‚å·²è°ƒç”¨äº†listenï¼Œè€Œä¸”ä¸€ä¸ªè¿æ¥æ­£åœ¨å»ºç«‹ï¼Œé‚£ä¹ˆacceptå‡½æ•°è°ƒç”¨ä¼šæˆåŠŸã€‚ writefdsé›†åˆåŒ…æ‹¬ç¬¦åˆä¸‹è¿°ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„å¥—æ¥å­—ï¼š æœ‰æ•°æ®å¯ä»¥å‘å‡ºã€‚ å¦‚æœå·²å®Œæˆäº†å¯¹ä¸€ä¸ªéé”å®šè¿æ¥è°ƒç”¨çš„å¤„ç†ï¼Œè¿æ¥å°±ä¼šæˆåŠŸã€‚ æœ€åï¼Œexceptfdsé›†åˆåŒ…æ‹¬ç¬¦åˆä¸‹è¿°ä»»ä½•ä¸€ä¸ªæ¡ä»¶çš„å¥—æ¥å­—ï¼š å‡å¦‚å·²å®Œæˆäº†å¯¹ä¸€ä¸ªéé”å®šè¿æ¥è°ƒç”¨çš„å¤„ç†ï¼Œè¿æ¥å°è¯•å°±ä¼šå¤±è´¥ã€‚ æœ‰å¸¦å¤–ï¼ˆout-of-bandï¼ŒOOBï¼‰æ•°æ®å¯ä¾›è¯»å–ã€‚ ä¾‹å¦‚ï¼Œå‡å®šæˆ‘ä»¬æƒ³æµ‹è¯•ä¸€ä¸ªå¥—æ¥å­—æ˜¯å¦â€œå¯è¯»â€ï¼Œå¿…é¡»å°†è‡ªå·±çš„å¥—æ¥å­—å¢æ·»åˆ°readfdsé›†åˆï¼Œå†ç­‰å¾…selectå‡½æ•°å®Œæˆã€‚selectå®Œæˆä¹‹åï¼Œå¿…é¡»åˆ¤æ–­è‡ªå·±çš„å¥—æ¥å­—æ˜¯å¦ä»ä¸ºreadfdsé›†åˆçš„ä¸€éƒ¨åˆ†ã€‚è‹¥ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¾¿è¡¨æ˜è¯¥å¥—æ¥å­—â€œå¯è¯»â€ï¼Œå¯ç«‹å³ç€æ‰‹ä»å®ƒä¸Šé¢è¯»å–æ•°æ®ã€‚åœ¨ä¸‰ä¸ªå‚æ•°ä¸­ï¼ˆreadfdsã€writedfsså’Œexceptfdsï¼‰ï¼Œä»»ä½•ä¸¤ä¸ªéƒ½å¯ä»¥æ˜¯ç©ºå€¼ï¼ˆNULLï¼‰ï¼›ä½†æ˜¯ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªä¸èƒ½ä¸ºç©ºå€¼ï¼åœ¨ä»»ä½•ä¸ä¸ºç©ºçš„é›†åˆä¸­ï¼Œå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¥—æ¥å­—å¥æŸ„ï¼›å¦åˆ™ï¼Œselectå‡½æ•°ä¾¿æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥ç­‰å¾…ã€‚ æœ€åä¸€ä¸ªå‚æ•°timeoutå¯¹åº”çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªtimevalç»“æ„ï¼Œç”¨äºå†³å®šselectæœ€å¤šç­‰å¾…I&#x2F;Oæ“ä½œå®Œæˆå¤šä¹…çš„æ—¶é—´ã€‚å¦‚timeoutæ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆï¼Œé‚£ä¹ˆselectè°ƒç”¨ä¼šæ— é™æœŸåœ°â€œé”å®šâ€æˆ–åœé¡¿ä¸‹å»ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªæè¿°ç¬¦ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶åç»“æŸã€‚å¯¹timevalç»“æ„çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234struct timeval &#123; long tv_sec; long tv_usec;&#125; ; è‹¥å°†è¶…æ—¶å€¼è®¾ç½®ä¸º(0,0)ï¼Œè¡¨æ˜selectä¼šç«‹å³è¿”å›ï¼Œå…è®¸åº”ç”¨ç¨‹åºå¯¹selectæ“ä½œè¿›è¡Œâ€œè½®è¯¢â€ã€‚å‡ºäºå¯¹æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œåº”é¿å…è¿™æ ·çš„è®¾ç½®ã€‚selectæˆåŠŸå®Œæˆåï¼Œä¼šåœ¨fd_setç»“æ„ä¸­ï¼Œè¿”å›åˆšå¥½æœ‰æœªå®Œæˆçš„I&#x2F;Oæ“ä½œçš„æ‰€æœ‰å¥—æ¥å­—å¥æŸ„çš„æ€»é‡ã€‚è‹¥è¶…è¿‡timevalè®¾å®šçš„æ—¶é—´ï¼Œä¾¿ä¼šè¿”å›0ã€‚ä¸ç®¡ç”±äºä»€ä¹ˆåŸå› ï¼Œå‡å¦‚selectè°ƒç”¨å¤±è´¥ï¼Œéƒ½ä¼šè¿”å›SOCKET_ERRORã€‚ç”¨selectå¯¹å¥—æ¥å­—è¿›è¡Œç›‘è§†ä¹‹å‰ï¼Œåœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¿…é¡»å°†å¥—æ¥å­—å¥æŸ„åˆ†é…ç»™ä¸€ä¸ªé›†åˆï¼Œè®¾ç½®å¥½ä¸€ä¸ªæˆ–å…¨éƒ¨è¯»ã€å†™ä»¥åŠä¾‹å¤–fd_setç»“æ„ã€‚å°†ä¸€ä¸ªå¥—æ¥å­—åˆ†é…ç»™ä»»ä½•ä¸€ä¸ªé›†åˆåï¼Œå†æ¥è°ƒç”¨selectï¼Œä¾¿å¯çŸ¥é“ä¸€ä¸ªå¥—æ¥å­—ä¸Šæ˜¯å¦æ­£åœ¨å‘ç”Ÿä¸Šè¿°çš„I&#x2F;Oæ´»åŠ¨ã€‚ Winsockæä¾›äº†ä¸‹åˆ—å®æ“ä½œï¼Œå¯¹fd_setè¿›è¡Œå¤„ç†ä¸æ£€æŸ¥ï¼š 1234FD_CLR(s, *set); ä»setä¸­åˆ é™¤å¥—æ¥å­—sã€‚FD_ISSET(s, *set); æ£€æŸ¥sæ˜¯å¦seté›†åˆçš„ä¸€åæˆå‘˜ï¼›è¿”å›TRUEæˆ–FALSEã€‚FD_SET(s, *set); å°†å¥—æ¥å­—såŠ å…¥é›†åˆsetã€‚FD_ZERO(*set); å°†setåˆå§‹åŒ–æˆç©ºé›†åˆã€‚ äºŒã€ç¤ºä¾‹2.1 æœåŠ¡ç«¯æœåŠ¡ç«¯ä»£ç æ¯”ä¹‹å‰ä»‹ç»çš„â€œå¥—æ¥å­—I&#x2F;O é˜»å¡æ¨¡å‹â€ä¸­çš„ç¤ºä¾‹ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚å¯ä»¥ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¯¹æ¯ä¸ªæ–°çš„å®¢æˆ·ç«¯å‘é€â€œHelloï¼ŒIâ€™m serverâ€é—®å€™ä¿¡æ¯ï¼Œåœ¨å®¢æˆ·ç«¯ç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨å…³é—­è¿æ¥ç­‰åŠŸèƒ½ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;using namespace std;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const u_short kPort = 10001;const std::string kHelloServer = &quot;hello, I&#x27;m server.&quot;;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket_ = INVALID_SOCKET; std::vector&lt;SOCKET&gt; clients; do &#123; // (1) socket_ = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_ == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = htonl(INADDR_ANY); addr.sin_port = htons(kPort); if (bind(socket_, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;bind failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (3) if (listen(socket_, 5) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;listen failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; std::cout &lt;&lt; &quot;listen on port: &quot; &lt;&lt; kPort &lt;&lt; std::endl; fd_set fd_read; while (true) // TODO æœªå¤„ç†ä½•æ—¶é€€å‡ºçš„é—®é¢˜ &#123; // (4) FD_ZERO(&amp;fd_read); FD_SET(socket_, &amp;fd_read); for (std::vector&lt;SOCKET&gt;::iterator it = clients.begin(); it != clients.end(); ++it) FD_SET(*it, &amp;fd_read); // (5) timeval timeout = &#123; 3, 0 &#125;; int ret = select(0, &amp;fd_read, NULL, NULL, &amp;timeout); if (ret == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;select failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (6.1) // æ£€æŸ¥æœåŠ¡ç«¯çš„ç›‘å¬socketï¼Œæ˜¯å¦æœ‰æ–°çš„è¿æ¥è¢«æç½® if (FD_ISSET(socket_, &amp;fd_read)) &#123; // (7.1) struct sockaddr_in addr_c = &#123; 0 &#125;; int addr_len = sizeof(addr_c); SOCKET s = accept(socket_, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr_c), &amp;addr_len); if (s == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;accept failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; &#125; else &#123; clients.push_back(s); std::cout &lt;&lt; &quot;new connection&quot; &lt;&lt; std::endl; int left = kHelloServer.length(); int idx = 0; while (left &gt; 0) &#123; int err = send(s, (const char*)(kHelloServer.c_str() + idx), left, 0); if (err == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;send failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; left -= err; idx += err; std::cout &lt;&lt; &quot;bytes sent: &quot; &lt;&lt; err &lt;&lt; std::endl; &#125; &#125; &#125; // (6.2) // æ£€æŸ¥ä¸å®¢æˆ·ç«¯è¿æ¥çš„socketï¼Œæ˜¯å¦æœ‰æ•°æ®å¯ä»¥è¯»å…¥ for (std::vector&lt;SOCKET&gt;::iterator it = clients.begin(); it != clients.end(); ) &#123; if (FD_ISSET(*it, &amp;fd_read)) &#123; // (7.2) char buf[100] = &#123; 0 &#125;; int err = recv(*it, buf, 100, 0); if (err &gt; 0) &#123; std::cout &lt;&lt; &quot;recv: &quot; &lt;&lt; buf &lt;&lt; std::endl; ++it; &#125; else if (err == 0) &#123; std::cout &lt;&lt; &quot;connection closed.&quot; &lt;&lt; std::endl; closesocket(*it); it = clients.erase(it); &#125; else &#123; std::cout &lt;&lt; &quot;recv failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; closesocket(*it); it = clients.erase(it); &#125; &#125; else &#123; ++it; &#125; &#125; &#125; // while &#125; while (false); // (8) for (std::vector&lt;SOCKET&gt;::iterator it = clients.begin(); it != clients.end(); ++it) &#123; closesocket(*it); &#125; // (9) closesocket(socket_); WSACleanup(); return 0;&#125; 2.2 å®¢æˆ·ç«¯å®¢æˆ·ç«¯åœ¨è¿æ¥ä¸ŠæœåŠ¡ç«¯ä¹‹åï¼Œä¾¿å¯ä»¥ä¸é—´æ–­çš„æ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;#include &lt;vector&gt;using namespace std;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const std::string kIP = &quot;127.0.0.1&quot;;const u_short kPort = 10001;const std::string kHelloClient = &quot;hello, I&#x27;m client.&quot;;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket_ = INVALID_SOCKET; do &#123; // (1) socket_ = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_ == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = inet_addr(kIP.c_str()); addr.sin_port = htons(kPort); if (connect(socket_, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;connect failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; fd_set fd_read; while (true) // TODO æœªå¤„ç†ä½•æ—¶é€€å‡ºçš„é—®é¢˜ &#123; // (3) FD_ZERO(&amp;fd_read); FD_SET(socket_, &amp;fd_read); // (4) timeval timeout = &#123; 3, 0 &#125;; int ret = select(0, &amp;fd_read, NULL, NULL, &amp;timeout); if (ret == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;select failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (5) if (FD_ISSET(socket_, &amp;fd_read)) &#123; char buf[100] = &#123; 0 &#125;; int err = recv(socket_, buf, 100, 0); if (err &gt; 0) &#123; std::cout &lt;&lt; &quot;recv: &quot; &lt;&lt; buf &lt;&lt; std::endl; &#125; else if (err == 0) &#123; std::cout &lt;&lt; &quot;connection closed.&quot; &lt;&lt; std::endl; break; &#125; else &#123; std::cout &lt;&lt; &quot;recv failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; &#125; &#125; // while &#125; while (false); // (6) closesocket(socket_); WSACleanup(); return 0;&#125;","categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"Windowså¥—æ¥å­—I/Oæ¨¡å‹(1)-é˜»å¡æ¨¡å‹","path":"/post/2937580891.html","content":"å¥—æ¥å­—I&#x2F;Oçš„é˜»å¡æ¨¡å‹æ˜¯æœ€å¸¸è§çš„ç½‘ç»œæ¨¡å‹ï¼Œä¹Ÿæ˜¯åœ¨ç½‘ç»œç¼–ç¨‹ä¸­æœ€æ—©æ¥è§¦çš„ä¸€ä¸ªæ¨¡å‹ã€‚å› ä¸ºå®ƒæ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç»“åˆçº¿ç¨‹ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚å°†acceptï¼Œrecvç­‰æ“ä½œæ”¾åˆ°å•ç‹¬çš„çº¿ç¨‹ï¼Œé˜²æ­¢ç¨‹åºçš„ä¸»çº¿ç¨‹è¢«é˜»å¡ä½ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ä¸ºäº†æ¼”ç¤ºé˜»å¡æ¨¡å‹ä½¿ç”¨çš„åŸºæœ¬æµç¨‹æ²¡æœ‰å°†å…¶æ”¾å…¥åˆ°ç‹¬ç«‹çš„çº¿ç¨‹ä¸­ã€‚ ä¸€ã€æœåŠ¡ç«¯æœåŠ¡ç«¯å¤§è‡´æµç¨‹: åˆ›å»ºSocket Bindç«¯å£ å¼€å§‹Listen acceptå®¢æˆ·ç«¯è¿æ¥ï¼ˆä¸€èˆ¬åœ¨å­çº¿ç¨‹ä¸­ä¸é—´æ–­acceptï¼‰ sendæ•°æ®åˆ°å®¢æˆ·ç«¯ï¼ˆä¹Ÿå¯ä»¥recvï¼‰ close socket 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889#include &lt;winsock2.h&gt;#include &lt;iostream&gt;#include &lt;assert.h&gt;using namespace std;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const u_short kPort = 10001;const std::string kHelloServer = &quot;hello, I&#x27;m server.&quot;;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket_ = INVALID_SOCKET; SOCKET s_ = INVALID_SOCKET; do &#123; // (1) socket_ = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_ == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = htonl(INADDR_ANY); addr.sin_port = htons(kPort); if (bind(socket_, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;bind failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (3) if (listen(socket_, 5) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;listen failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; std::cout &lt;&lt; &quot;listen on port: &quot; &lt;&lt; kPort &lt;&lt; std::endl; // (4) while (true) &#123; struct sockaddr_in addr_c = &#123; 0 &#125;; int addr_len = sizeof(addr_c); SOCKET s = accept(socket_, reinterpret_cast&lt;sockaddr*&gt;(&amp;addr_c), &amp;addr_len); if (s == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;accept failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; std::cout &lt;&lt; &quot;new connection&quot; &lt;&lt; endl; // (5) // æ­¤å¤„ä½¿ç”¨whileå¾ªç¯sendï¼Œè¯¦è§ ä¸‰ã€æµåè®® int left = kHelloServer.length(); int idx = 0; while (left &gt; 0) &#123; int err = send(s, (const char*)(kHelloServer.c_str() + idx), left, 0); if (err == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;send failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; left -= err; idx += err; std::cout &lt;&lt; &quot;bytes sent: &quot; &lt;&lt; err &lt;&lt; std::endl; &#125; &#125; &#125; while (false); // (6) closesocket(socket_); closesocket(s_); WSACleanup(); return 0;&#125; äºŒã€å®¢æˆ·ç«¯å®¢æˆ·ç«¯å¤§è‡´æµç¨‹ï¼š åˆ›å»ºSocket connectæœåŠ¡ç«¯ recvæ¥æ”¶æ•°æ®ä»æœåŠ¡ç«¯(ä¹Ÿå¯ä»¥send) close socket 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#include &lt;iostream&gt;#include &lt;winsock2.h&gt;#include &lt;assert.h&gt;#pragma comment(lib, &quot;Ws2_32.lib&quot;)const std::string kIP = &quot;127.0.0.1&quot;;const u_short kPort = 10001;const std::string kHelloClient = &quot;hello, I&#x27;m client.&quot;;int main()&#123; WSADATA wsaData; WORD wVersionRequested = MAKEWORD(2, 2); WSAStartup(wVersionRequested, &amp;wsaData); SOCKET socket_ = INVALID_SOCKET; do &#123; // (1) socket_ = ::socket(AF_INET, SOCK_STREAM, 0); if (socket_ == INVALID_SOCKET) &#123; std::cout &lt;&lt; &quot;create socket failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (2) struct sockaddr_in addr = &#123; 0 &#125;; addr.sin_family = AF_INET; addr.sin_addr.s_addr = inet_addr(kIP.c_str()); addr.sin_port = htons(kPort); if (connect(socket_, reinterpret_cast&lt;const sockaddr*&gt;(&amp;addr), sizeof(addr)) == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;connect failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; // (3) char buf[100] = &#123; 0 &#125;; int err = recv(socket_, buf, 100, 0); if (err &gt; 0) &#123; std::cout &lt;&lt; &quot;recv: &quot; &lt;&lt; buf &lt;&lt; std::endl; &#125; else if (err == 0) &#123; std::cout &lt;&lt; &quot;connection closed.&quot; &lt;&lt; std::endl; break; &#125; else &#123; std::cout &lt;&lt; &quot;recv failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; &#125; while (false); // (4) closesocket(socket_); WSACleanup(); return 0;&#125; ä¸‰ã€æµåè®®ç”±äºå¤§å¤šæ•°é¢å‘è¿æ¥çš„åè®®ï¼ˆå¦‚TCPï¼‰ä¹Ÿæ˜¯æµåè®®ã€‚åœ¨æµåè®®ä¸­ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…å¯ä»¥å°†æ•°æ®åˆ†è§£æˆå°å—æ•°æ®ï¼Œæˆ–å°†æ•°æ®åˆå¹¶æˆå¤§å—æ•°æ®ã€‚å¯¹äºæµå¥—æ¥å­—ä¸Šæ”¶å‘æ•°æ®æ‰€æœ‰ç”¨çš„å‡½æ•°ï¼ˆå¦‚send, recvï¼‰ï¼Œéœ€è¦çŸ¥é“çš„æ˜¯ï¼šå®ƒä»¬ä¸èƒ½ä¿è¯è¦æ±‚è¿›è¡Œè¯»å–æˆ–å†™å…¥çš„æ•°æ®é‡ã€‚æ¯”å¦‚ç”¨sendå‘é€ä¸€ä¸ªæœ‰1024å­—èŠ‚çš„å­—ç¬¦ç¼“å†²åŒºæ—¶ï¼Œsendå‡½æ•°å¯èƒ½è¿”å›çš„å·²å‘å‡ºçš„å­—èŠ‚æ•°å°‘äº1024ã€‚å› ä¸ºå¯¹æ¯ä¸ªæ”¶å‘æ•°æ®çš„å¥—æ¥å­—æ¥è¯´ï¼Œç³»ç»Ÿéƒ½ä¸ºå®ƒä»¬åˆ†é…äº†å……è¶³çš„ç¼“å†²åŒºç©ºé—´ï¼Œæ‰€ä»¥sendçš„è¿”å›å€¼å°†è¢«è®¾ä¸ºå·²ç»å‘é€çš„å­—èŠ‚æ•°ã€‚ é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œè¦ä¿è¯ç¼“å†²åŒºæ‰€æœ‰æ•°æ®éƒ½è¢«å‘é€å‡ºå»ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314int left = kHelloServer.length();int idx = 0;while (left &gt; 0) &#123; int err = send(s, (const char*)(kHelloServer.c_str() + idx), left, 0); if (err == SOCKET_ERROR) &#123; std::cout &lt;&lt; &quot;send failed, GLE: &quot; &lt;&lt; WSAGetLastError() &lt;&lt; std::endl; break; &#125; left -= err; idx += err; std::cout &lt;&lt; &quot;bytes sent: &quot; &lt;&lt; err &lt;&lt; std::endl;&#125; å¯¹äºæ¥æ”¶æ•°æ®æ¥è¯´ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ä¸Šé¢çš„æ–¹å¼ï¼Œä½†æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å¾ªç¯çš„ã€ä¸é—´æ–­çš„æ¥æ”¶æ•°æ®ï¼Œå¾ˆå°‘æœ‰ä¸Šé¢çš„ä¾‹å­ä¸­çš„ï¼Œåªæ¥æ”¶ä¸€æ¬¡çš„æƒ…å†µã€‚","categories":["ç½‘ç»œç¼–ç¨‹"]},{"title":"Linux GDBè°ƒè¯•å‘½ä»¤","path":"/post/2824175441.html","content":"ä¸€ã€å¯åŠ¨GDBgdb -tuiï¼šåˆ†å±æ˜¾ç¤ºæºä»£ç gdb -qï¼šä¸æ˜¾ç¤ºå¼€å§‹çš„æç¤ºä¿¡æ¯ å¯ä»¥åœ¨.bashrcä¸­åŠ å…¥åˆ«åï¼š 1alias gdb=&quot;gdb -q -tui&quot; äºŒã€å¼€å§‹è°ƒè¯•æ‰§è¡Œrunï¼ˆéœ€è¦æå‰è®¾ç½®æ–­ç‚¹ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­é‡æ–°è¿è¡Œè°ƒè¯•çš„ç¨‹åºï¼Œrunåå¯ä»¥è·Ÿéšå‘ç»™è¯¥ç¨‹åºçš„ä»»ä½•å‚æ•°ã€‚ ä¸‰ã€å¸¸ç”¨å‘½ä»¤ å‘½ä»¤ åŠŸèƒ½ listï¼ˆç®€å†™lï¼‰ æ˜¾ç¤ºå½“å‰è¡Œå‰é¢å’Œåé¢çš„10è¡Œä»£ç  list n1 n2 æ˜¾ç¤ºn1åˆ°è¡Œå’Œn2è¡Œä¹‹é—´çš„ä»£ç  list main æ˜¾ç¤ºmainå‡½æ•°ä»£ç  info functions regex åˆ—å‡ºç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„å‡½æ•°åç§° info breakpointsï¼ˆç®€å†™info bï¼‰ æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„æ–­ç‚¹ä¿¡æ¯ï¼ˆæ–­ç‚¹å·ï¼Œæ–­ç‚¹ç±»å‹ï¼Œæ–­ç‚¹ä½ç½®ï¼‰ break func åœ¨å½“å‰æ–‡ä»¶çš„funcå‡½æ•°å¤„è®¾ç½®æ–­ç‚¹ break fileName:N åœ¨æŸæ–‡ä»¶çš„ç¬¬Nè¡Œå¤„è®¾ç½®æ–­ç‚¹ï¼Œå½“å‰æ–‡ä»¶ç¬¬Nè¡Œè®¾ç½®æ–­ç‚¹å¯ä»¥å¿½ç•¥fileName break func(æˆ–fileName:N) if exp æ¡ä»¶æ–­ç‚¹ï¼Œexpæˆç«‹åˆ™æ–­ç‚¹ delete N åˆ é™¤ç¬¬Nå·æ–­ç‚¹ delete åˆ é™¤æ‰€æœ‰æ–­ç‚¹ clear N æ¸…é™¤ç¬¬Nè¡Œä¸Šçš„æ–­ç‚¹ watch exp expæˆç«‹ç¨‹åºåœä½ nextï¼ˆç®€å†™nï¼‰ å•æ­¥æ‰§è¡Œï¼Œé‡åˆ°å‡½æ•°ä¼šè·³è¿‡ next N æ‰§è¡ŒNæ¬¡å•æ­¥æ‰§è¡Œ stepï¼ˆç®€å†™s) å•æ­¥æ‰§è¡Œï¼Œé‡åˆ°å‡½æ•°ä¼šè¿›å…¥ finish æ‰§è¡Œå®Œå½“å‰å‡½æ•°ï¼Œè¿”å›åˆ°è°ƒç”¨å®ƒçš„ä½ç½® continue è¿è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å¤„ untilï¼ˆç®€å†™uï¼‰ é¼ æ ‡æ”¾åˆ°ä»£ç è¡Œï¼Œè¿è¡Œåˆ°è¯¥ä»£ç è¡Œåœæ­¢ jump N è·³è½¬åˆ°ç¬¬Nè¡Œå¼€å§‹æ‰§è¡Œï¼Œä¸ä¼šä¸»åŠ¨åœ¨Nè¡Œåœä½ run é‡æ–°è¿è¡Œè°ƒè¯•çš„ç¨‹åºï¼Œå¯ä»¥å¸¦å‚æ•° [Enter] ç›´æ¥å›è½¦æ‰§è¡Œä¸Šæ¬¡æ‰§è¡Œçš„å‘½ä»¤ print varï¼ˆç®€å†™pï¼‰ æŸ¥çœ‹å˜é‡varçš„å€¼ print &#x2F;x var æŒ‰16è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡å€¼ ptype var æŸ¥çœ‹å˜é‡varçš„ç»“æ„æˆ–ç±»å‹ backtrach æŸ¥çœ‹è°ƒç”¨å †æ ˆ å››ã€å¤šè¿›ç¨‹è°ƒè¯•åœ¨è°ƒè¯•å¤šè¿›ç¨‹ç¨‹åºæ—¶GDBé»˜è®¤åªä¼šè°ƒè¯•ä¸»è¿›ç¨‹ï¼Œä½†æ˜¯GDBï¼ˆ&gt;V7.0ï¼‰æ”¯æŒå¯¹å¤šè¿›ç¨‹åˆ†åˆ«æˆ–åŒæ—¶è°ƒè¯•ã€‚æ¢å¥è¯è¯´ï¼ŒGDBå¯ä»¥åŒæ—¶è°ƒè¯•å¤šä¸ªç¨‹åºã€‚åªéœ€è¦è®¾ç½®follow-fork-mode(é»˜è®¤å€¼ï¼šparent)å’Œdetach-on-forkï¼ˆé»˜è®¤å€¼ï¼šonï¼‰å³å¯ã€‚ follow-fork-mode detach-on-fork è¯´æ˜ parent on åªè°ƒè¯•ä¸»è¿›ç¨‹ï¼ˆGDBé»˜è®¤ï¼‰ child on åªè°ƒè¯•å­è¿›ç¨‹ parent off åŒæ—¶è°ƒè¯•ä¸¤ä¸ªè¿›ç¨‹ï¼Œgdbè·Ÿä¸»è¿›ç¨‹ï¼Œå­è¿›ç¨‹blockåœ¨forkä½ç½® child off åŒæ—¶è°ƒè¯•ä¸¤ä¸ªè¿›ç¨‹ï¼Œgdbè·Ÿå­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹blockåœ¨forkä½ç½® è®¾ç½®æ–¹æ³•ï¼šset follow-fork-mode [parent|child] set detach-on-fork [on|off] æŸ¥è¯¢æ­£åœ¨è°ƒè¯•çš„è¿›ç¨‹ï¼šinfo inferiors åˆ‡æ¢è°ƒè¯•çš„è¿›ç¨‹ï¼š inferior æ·»åŠ æ–°çš„è°ƒè¯•è¿›ç¨‹ï¼š add-inferior [-copies n] [-exec executable] ,å¯ä»¥ç”¨file executableæ¥åˆ†é…ç»™inferiorå¯æ‰§è¡Œæ–‡ä»¶ã€‚ å…¶ä»–ï¼šremove-inferiors infnoï¼Œ detach inferior","tags":["GDB"],"categories":["è½¯ä»¶è°ƒè¯•"]},{"title":"æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(4)--MySQLå­—ç¬¦ç¼–ç ","path":"/post/1559270845.html","content":"ä¸€. MySQL å­—ç¬¦é›†å’Œæ ¡å¯¹è§„åˆ™MySQL çš„å­—ç¬¦é›†æ˜¯ç”¨æ¥å®šä¹‰ MySQL å­˜å‚¨å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œæ ¡å¯¹è§„åˆ™ï¼ˆæœ‰çš„è½¯ä»¶å«æ’åºè§„åˆ™ï¼‰åˆ™æ˜¯ç”¨æ¥å®šä¹‰äº†æ¯”è¾ƒå­—ç¬¦ä¸²çš„æ–¹å¼ã€‚å­—ç¬¦é›†å’Œæ ¡å¯¹è§„åˆ™æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚æ¯ç§å­—ç¬¦é›†éƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ ¡å¯¹è§„åˆ™ã€‚ æŸ¥çœ‹æ•°æ®åº“æ”¯æŒçš„å­—ç¬¦é›†: 123456# æ–¹æ³•1ï¼šSHOW CHARACTER SET;# æ–¹æ³•2ï¼šUSE information_schema;SELECT * FROM CHARACTER_SETS; æŸ¥çœ‹æ•°æ®åº“æ”¯æŒçš„æ ¡å¯¹è§„åˆ™ï¼š 123456# æ–¹æ³•1ï¼šSHOW COLLATION;# æ–¹æ³•2ï¼šUSE information_schema;SELECT * FROM collations; äºŒ. MySQL å„ä¸ªçº§åˆ«å­—ç¬¦é›†MySQL å¯ä»¥å¯¹å¦‚ä¸‹å­—ç¬¦é›†è¿›è¡Œè®¾ç½®ï¼š æœåŠ¡å™¨çº§å­—ç¬¦é›†ï¼ˆCHARACTER_SET_SERVERï¼‰ æ•°æ®åº“çº§å­—ç¬¦é›†ï¼ˆCHARACTER_SET_DATABASEï¼‰ è¡¨çº§å­—ç¬¦é›† å­—æ®µçº§å­—ç¬¦é›† è¿æ¥å­—ç¬¦é›†ï¼ˆCHARACTER_SET_CONNECTIONï¼‰ï¼Œå®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“æ‰€ç”¨çš„å­—ç¬¦é›†ã€‚ ç»“æœå­—ç¬¦é›†ï¼ˆCHARACTER_SET_RESULTSï¼‰ï¼Œå­˜å‚¨æŸ¥è¯¢ç»“æœï¼ˆå«é”™è¯¯ä¿¡æ¯ï¼‰æ‰€ç”¨çš„å­—ç¬¦é›†ã€‚ å®¢æˆ·ç«¯å­—ç¬¦é›†ï¼ˆCHARACTER_SET_CLIENTï¼‰ï¼Œå®¢æˆ·ç«¯å‘é€ç»™ MySQL æœåŠ¡å™¨çš„æŸ¥è¯¢è¯­å¥å­—ç¬¦é›†ã€‚ ç³»ç»Ÿå­—ç¬¦é›†ï¼ˆCHARACTER_SET_SYSTEMï¼‰ï¼Œç”¨äºå­˜å‚¨æˆ‘ä»¬æ–°å»ºçš„æˆ–è‡ªå¸¦çš„æ•°æ®åº“çš„è¡¨ã€åˆ—çš„åç§°ï¼Œé»˜è®¤æ˜¯ UTF-8 æœåŠ¡å™¨çº§ã€æ•°æ®åº“çº§ã€è¡¨çº§ã€å­—æ®µçº§ è¿™ 4 ä¸ªå­—ç¬¦é›†è®¾ç½®å½±å“åˆ°æ•°æ®åº“ä¸­å­˜å‚¨æ•°æ®çš„ç¼–ç ã€‚ è¿™ 4 ä¸ªçº§åˆ«çš„å­—ç¬¦é›†ç»§æ‰¿å…³ç³»ä¸ºï¼šæœåŠ¡å™¨çº§ --&gt; æ•°æ®åº“çº§ --&gt; è¡¨çº§ --&gt; å­—æ®µçº§, ä»å·¦åˆ°å³ï¼Œä¸€çº§ç»§æ‰¿ä¸€çº§ï¼Œå’Œ C++ã€Java ä¸­çš„ç±»çš„ç»§æ‰¿ç±»ä¼¼ï¼Œå¦‚æœæŸä¸€çº§æœªæ˜¾å¼çš„æŒ‡å®šå­—ç¬¦é›†ï¼Œé‚£ä¹ˆå°†ç»§æ‰¿ä¸Šä¸€çº§çš„å­—ç¬¦é›†è®¾ç½®ã€‚ 2.1 æœåŠ¡å™¨çº§åˆ«å­—ç¬¦é›†è®¾ç½®æœåŠ¡å™¨çº§åˆ«çš„å­—ç¬¦é›†å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªåœ°æ–¹æŒ‡å®šï¼Œä»ä¸Šåˆ°ä¸‹ä¼˜å…ˆçº§ä¾æ¬¡å¢åŠ ï¼š ç¼–è¯‘ MySQL æ—¶æŒ‡å®šçš„å­—ç¬¦é›† my.cnf é…ç½®æ–‡ä»¶è®¾ç½® character-set-server mysqld æœåŠ¡å¯åŠ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šå­—ç¬¦é›† å½±å“æ•°æ®å­˜å‚¨çš„å­—ç¬¦é›†ä¹‹é—´çš„å…³ç³»ï¼š æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„å­—ç¬¦é›†è®¾ç½®ï¼š 123456# æ–¹æ³•1ï¼šSHOW VARIABLES LIKE &#x27;%character%&#x27;;# æ–¹æ³•2ï¼šUSE information_schema;SELECT * FROM GLOBAL_VARIABLES WHERE VARIABLE_NAME LIKE &#x27;%character%&#x27;; 3. utf8 ä¸ utf8mb4 åŒºåˆ«UTF-8 æ˜¯å¤šå­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼Œé‡‡ç”¨ 1~4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œä½†åœ¨ MySQL è®¾è®¡ä¹‹åˆï¼Œä¸€ä¸ªå­—ç¬¦æœ€å¤šé‡‡ç”¨ 3 ä¸ªå­—èŠ‚çš„å°±å¯ä»¥å­˜å‚¨ï¼Œæ‰€ä»¥ Mysql çš„è®¾è®¡è€…å°† MySQL ä¸­çš„ UTF-8 å­—ç¬¦é›†ï¼ˆUTF-8 å…¶å®ä¸æ˜¯å­—ç¬¦é›†ï¼Œæ˜¯å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼Œä½†åœ¨ MySQL ä¸­ä¸€ç›´è¿™ä¹ˆå«ï¼‰è®¾è®¡æˆäº†æœ€å¤§é•¿åº¦åªèƒ½ä¸º 3. å¦‚å›¾ï¼š ä½†éšç€ Unicode å­—ç¬¦é›†çš„æ‰©å¼ ï¼Œå‡ºç°äº†éœ€è¦ 4 ä¸ªå­—èŠ‚æ‰èƒ½å­˜å‚¨çš„å­—ç¬¦ï¼Œå¦‚æœè¿™æ—¶ä»ç„¶ä½¿ç”¨ utf-8ï¼ˆæŒ‡ mysql ä¸­çš„ 3 å­—èŠ‚ utf-8ï¼‰æ¥å­˜å‚¨è¿™äº›å­—ç¬¦å°±ä¼šå‡ºç°é”™è¯¯ï¼Œå¦‚æ‰§è¡ŒINSERT INTO member(memberName)VALUES(&#39;ğ¤­¢&#39;)æŠ¥é”™å¦‚ä¸‹ï¼š 12Warning Code : 1366Incorrect string value: &#x27;\\xF0\\xA4\\xAD\\xA2&#x27; for column &#x27;memberName&#x27; at row 1 äºæ˜¯ MySQL åæ¥æ–°å¢äº† utf8mb4 å­—ç¬¦é›†ï¼Œæœ€å¤§é•¿åº¦ä¸º 4ï¼Œå…¼å®¹ä¹‹å‰çš„ utf8ï¼Œä½†ä¸ºäº†ä¹‹å‰çš„æ•°æ®åº“ä¸æŠ¥é”™ï¼Œä»ç„¶ä¿ç•™äº†ä¹‹å‰çš„ utf8 å­—ç¬¦é›†ã€‚ æ‰€ä»¥ MySQL ä¸­çš„ UTF-8 å­—ç¬¦é›†æ˜¯ä¼ª UTF-8ï¼Œç°åœ¨éœ€è¦ä½¿ç”¨ utf8mb4ã€‚ 4. å®Œå…¨é¿å…å­—ç¬¦ä¹±ç è¦å®Œå…¨é¿å…å­—ç¬¦ä¹±ç ï¼Œæœ€ç®€å•ä¹Ÿæ˜¯æœ€å¥½çš„æ–¹æ³•å°±æ˜¯å°†å„ä¸ªå­—ç¬¦é›†ä¿æŒä¸€è‡´ï¼Œå¯ä»¥éƒ½è®¾ç½®ä¸º utf8mb4ã€‚Mysql æ•°æ®å­˜å‚¨æ¶‰åŠåˆ°çš„ 4 ä¸ªå­—ç¬¦é›†çš„è®¾ç½®å¯ä»¥ä½¿ç”¨ç¬¬ 2 èŠ‚çš„æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼Œå®¢æˆ·ç«¯å­—ç¬¦é›†ã€è¿æ¥å­—ç¬¦é›†ï¼Œç»“æœå­—ç¬¦é›†å…³ç³»åˆ°æ•°æ®æ˜¾ç¤ºçš„æ­£ç¡®æ€§ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­å¥ç»Ÿä¸€è®¾ç½®ä¸º utf8mb4ï¼Œä½†è¿™ä¸ªè®¾ç½®åªé’ˆå¯¹å½“å‰è¿æ¥æœ‰æ•ˆï¼š 1set names utf8mb4; ç¼–ç¨‹å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ MySQL API è¿›è¡Œæ•°æ®è¿æ¥ã€æŸ¥è¯¢ç­‰æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨mysql_set_character_setå¯¹æ¯ä¸ªè¿æ¥è¿›è¡Œè®¾ç½®ï¼Œè¿™ä¸ª API ä¼šå°†å®¢æˆ·ç«¯å­—ç¬¦é›†ã€è¿æ¥å­—ç¬¦é›†ï¼Œç»“æœå­—ç¬¦é›†éƒ½è®¾ç½®ä¸ºæŒ‡å®šå­—ç¬¦é›†ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š 123MYSQL* pMysql = NULL;mysql_real_connect(pMysql, szHost, szUser, szPwd, szDatabase, iPort, NULL, CLIENT_MULTI_STATEMENTS);mysql_set_character_set(pMysql, &quot;utf8mb4&quot;); æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["MySQL","å­—ç¬¦ç¼–ç "],"categories":["MySQL"]},{"title":"æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(2)--ç¼–è¯‘å™¨å¤„ç†æ–‡ä»¶ç¼–ç ","path":"/post/1337290471.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¾®è½¯ MSVC ç¼–è¯‘å™¨å¦‚ä½•åŠ è½½å’Œå¤„ç† C++ä»£ç æ–‡ä»¶ã€‚ ä¸€. Visual Studio å­—ç¬¦é›†ä½¿ç”¨ Visual Studio åˆ›å»ºçš„ C++å·¥ç¨‹å¯ä»¥åœ¨å·¥ç¨‹å±æ€§é…ç½®å±æ€§--&gt;å¸¸è§„ä¸­é…ç½®å­—ç¬¦é›†ï¼šä½¿ç”¨Unicodeå­—ç¬¦é›†ï¼ˆé»˜è®¤ï¼‰ã€ä½¿ç”¨å¤šå­—èŠ‚å­—ç¬¦é›†ã€‚å¦‚å›¾ï¼š ä½†è¿™ä¸ªè®¾ç½®é¡¹ä¸ä¼šå¯¹ç¼–è¯‘å™¨å¤„ç†å­—ç¬¦ç¼–ç äº§ç”Ÿç›´æ¥çš„å½±å“ï¼ˆæ³¨æ„è¿™é‡Œçš„â€œç›´æ¥â€äºŒå­—ï¼Œç¬¬ 3 èŠ‚ä¼šè¯´åˆ°ï¼‰ï¼Œåªä¼šåœ¨å·¥ç¨‹å±æ€§é…ç½®å±æ€§--&gt;C/C++--&gt;é¢„å¤„ç†å™¨åŠ å…¥ç›¸åº”çš„å®ï¼š 12ä½¿ç”¨Unicodeå­—ç¬¦é›† --&gt; _UNICODEå’ŒUNICODEå®ä½¿ç”¨å¤šå­—èŠ‚å­—ç¬¦é›† --&gt; _MBCSå® è¿™å‡ ä¸ªå®ä¸€èˆ¬ç”¨æ¥åˆ¤æ–­æ˜¯ä½¿ç”¨ char è¿˜æ˜¯ wchar_tï¼Œåœ¨ç³»ç»Ÿ API ä¸­ä½¿ç”¨æ¯”è¾ƒå¤šï¼Œå¦‚ MessegeBox é€šè¿‡æ˜¯å¦å®šä¹‰äº† UNICODE å®æ¥å†³å®šæ˜¯ä½¿ç”¨ LPCSTR è¿˜æ˜¯ LPCWSTRï¼ˆLPCSTR å³ const char*, LPCWSTR å³ const wchar_t*ï¼‰ï¼š 12345#ifdef UNICODE#define MessageBox MessageBoxW#else#define MessageBox MessageBoxA#endif // !UNICODE äºŒ. char å’Œ wchar_tä¸Šé¢æåˆ°äº†ï¼Œå®šä¹‰ API æ—¶é€šè¿‡UNICODE å®æ¥å†³å®šæ˜¯ä½¿ç”¨ char è¿˜æ˜¯ wchar_tç±»å‹ï¼Œé‚£ä¹ˆ char å’Œ wchar_t æœ‰ä»€ä¹ˆä¸åŒäº†ï¼Ÿ char å’Œ wchar_t æ˜¯æ ‡å‡† C&#x2F;C++å­—ç¬¦ç±»å‹ï¼Œå¹¶ä¸æ˜¯ Windows ç‰¹æœ‰çš„ã€‚ char å›ºå®šå  1 ä¸ªå­—èŠ‚ï¼Œwchar_t å›ºå®šå  2 ä¸ªå­—èŠ‚ï¼Œä»å†…å­˜çš„è§’åº¦æ¥çœ‹ï¼Œcharã€wchar_t å’Œå…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼Œåªæ˜¯ä»£è¡¨ä¸€æ®µå†…å­˜å—ï¼Œç”¨æ¥å­˜å‚¨å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶ 0 æˆ– 1ã€‚ åœ¨ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹ æƒ¯äºå°†å­—ç¬¦ä¸²å‚¨åˆ° char æˆ– wchar_t å®šä¹‰çš„å†…å­˜ç©ºé—´ä¸­ï¼Œå°†æ•´å½¢å­˜å‚¨åœ¨ int å®šä¹‰çš„å†…å­˜ç©ºé—´ä¸­ã€‚ æ‰€ä»¥ï¼Œç”¨ char è¿˜æ˜¯ wchar_t æ¥å­˜å‚¨å­—ç¬¦ï¼Œåªæ˜¯å†…å­˜åˆ†é…å’Œæ•°æ®å­˜å‚¨ä¸Šé¢çš„äº‹æƒ…ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿæ˜¯ä¸å­—ç¬¦ç¼–ç æ— ç›´æ¥å…³ç³»çš„ï¼ˆ åŒæ ·æ³¨æ„è¿™é‡Œçš„â€œç›´æ¥â€äºŒå­—ï¼Œç¬¬ 3 èŠ‚ä¼šè¯´åˆ°ï¼‰ã€‚ ä¸‰. ç¼–è¯‘å™¨å¦‚ä½•å¤„ç†ç¡¬ç¼–ç å­—ç¬¦VC++ç¼–è¯‘å™¨ç¼–è¯‘æºä»£ç çš„æ­¥éª¤ä¸­ï¼Œæ¶‰åŠç¼–ç å¤„ç†çš„æ­¥éª¤ä¸»è¦æœ‰ 2 ä¸ªï¼šç¬¬ 1 æ­¥ï¼šé¢„å¤„ç† 1.1) è¯»å–æºæ–‡ä»¶ï¼Œåˆ¤æ–­æºæ–‡ä»¶é‡‡ç”¨çš„å­—ç¬¦ç¼–ç ç±»å‹ã€‚(è¿™ä¸€æ­¥ä¸ä¼šæ”¹å˜æ–‡ä»¶å†…å®¹) 1234ç¼–è¯‘å™¨åˆ¤æ–­æºæ–‡ä»¶ç¼–ç ç±»å‹çš„æ­¥éª¤ä¸ºï¼š1. è‹¥æ–‡ä»¶å¼€å§‹å¤„æœ‰BOM(EF BB BF)ï¼Œåˆ™åˆ¤å®šä¸ºUTF-8ç¼–ç ï¼›2. è‹¥æ²¡æœ‰BOMï¼Œåˆ™è¯•å›¾ä»æ–‡ä»¶çš„å‰8ä¸ªå­—èŠ‚æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦åƒUTF-16ç¼–ç ï¼Œå¦‚æœåƒï¼Œåˆ™å°±åˆ¤æ–­ä¸ºUTF-16ç¼–ç ã€‚3. å¦‚æœæ—¢æ²¡BOMï¼Œä¹Ÿä¸æ˜¯UTF-16ç¼–ç ï¼Œåˆ™ä½¿ç”¨ç³»ç»Ÿå½“å‰çš„ä»£ç é¡µï¼ˆç®€ä½“ä¸­æ–‡æ“ä½œç³»ç»Ÿä¸ºCP936ï¼‰ã€‚ 1.2) å°†æºæ–‡ä»¶å†…å®¹è½¬æˆæºå­—ç¬¦é›†(Source Character Set)ï¼Œé»˜è®¤ä¸º UTF-8 ç¼–ç ã€‚ ç¬¬ 2 æ­¥ï¼šé“¾æ¥ 2.1) å°† 1.2 ä¸­å¾—åˆ°çš„ UTF-8 è½¬ä¸ºæ‰§è¡Œå­—ç¬¦é›†(Execution Character Set)ï¼š å¯¹äºå®½å­—ç¬¦ä¸²ï¼ˆå³ C&#x2F;C++ä¸­ä»¥Læ ‡è®°çš„ä¸²ï¼Œå¦‚L&quot;abc&quot;, L&#39;ä¸­&#39;ï¼‰ï¼Œæ‰§è¡Œå­—ç¬¦é›†ä¸º UTF-16 ç¼–ç ã€‚ å¯¹äºçª„å­—ç¬¦ä¸²ï¼ˆå’Œå®½å­—ç¬¦ä¸²å¯¹åº”ï¼Œå³ä¸ä»¥Læ ‡è®°çš„ä¸²ï¼‰ï¼Œæ‰§è¡Œå­—ç¬¦é›†ä¸ºç³»ç»Ÿå½“å‰çš„ä»£ç é¡µã€‚ ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥è¯´æ¸…æ¥š Visual Studio å­—ç¬¦é›†è®¾ç½®ã€charã€wchar*t æ˜¯å¦‚ä½•***é—´æ¥_**å½±å“åˆ°ç¼–è¯‘å™¨å¯¹å­—ç¬¦ç¼–ç çš„å¤„ç†äº†ï¼š 1234567Visual Studioå­—ç¬¦é›†è®¾ç½® |å†³å®šå£°æ˜å“ªä¸€ä¸ªå®ï¼ˆUNICODEè¿˜æ˜¯_MBCSå®ï¼‰ |å®åˆå†³å®šäº†APIå‚æ•°ä½¿ç”¨charè¿˜æ˜¯wchar_t |ç¼–è¯‘å™¨åœ¨è¿›è¡Œã€æ‰§è¡Œå­—ç¬¦é›†ã€‘ç¼–ç æ—¶å¯¹charå’Œwchar_é‡‡ç”¨ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œä»è€Œå¯¹å­—ç¬¦ç¼–ç äº§ç”Ÿäº†å½±å“ã€‚ åœ¨ Visual Studio 2010ï¼ˆå«ï¼‰ä¹‹åï¼Œæ”¯æŒä½¿ç”¨#pragma execution_character_setæ¥è®¾ç½®æ‰§è¡Œå­—ç¬¦é›†ã€‚ å››. å®ä¾‹åˆ†æ å·²çŸ¥æ±‰å­—â€œä¸­â€çš„å„ç§ç¼–ç å¦‚ä¸‹ï¼š 123GBK D6 D0Unicode 2D 4EUTF-8 E4 B8 AD å‡½æ•°DumpCharacterCodeç”¨äºæŒ‰å­—èŠ‚æ‰“å°å†…å­˜ä¸­çš„æ•°æ®ï¼š 1234567void DumpCharacterCode(const char* pChar, int iSize) &#123; for(int i = 0; i &lt; iSize; i++) &#123; char a = *pChar++; printf(&quot;%02X &quot;, a &amp; 0xff); &#125; printf(&quot; &quot;);&#125; è®¾ç½®ç³»ç»Ÿä»£ç é¡µçš„æ–¹æ³•ï¼šâ€œæ§åˆ¶é¢æ¿â€ â€“&gt; â€œåŒºåŸŸå’Œè¯­è¨€â€ â€“&gt; â€œç®¡ç†â€ â€“&gt; â€œé Unicode ç¨‹åºçš„è¯­è¨€â€ â€“&gt; â€œæ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®â€ Visual Studio ä¿å­˜æ–‡ä»¶åˆ°æŒ‡å®šç¼–ç æ–¹æ³•ï¼šâ€œæ–‡ä»¶â€ â€“&gt; â€œé«˜çº§ä¿å­˜é€‰é¡¹â€ 4.1 æµ‹è¯•ç¼–è¯‘å™¨å¤„ç†çª„å­—ç¬¦ç¼–ç æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 12345678int _tmain(int argc, _TCHAR* argv[])&#123; char buf[100] = &#123;&quot;ä¸­&quot;&#125;; // char DumpCharacterCode(buf, 2); // ä¹Ÿå¯ä»¥æ‰“å°4ä¸ªå­—èŠ‚ return 0;&#125; é’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿä»£ç é¡µå’Œæºæ–‡ä»¶ç¼–ç ï¼Œæ‰“å°å‡ºçš„æ±‰å­—â€œä¸­â€çš„ç¼–ç åˆ†åˆ«ä¸ºï¼š æµ‹è¯•ç”¨ä¾‹ ç³»ç»Ÿä»£ç é¡µ ä¿å­˜æºæ–‡ä»¶ç¼–ç  ç¼–è¯‘å™¨åˆ¤æ–­æ–‡ä»¶é‡‡ç”¨çš„ç¼–ç  æºå­—ç¬¦é›†(Source Character Set) æ‰§è¡Œå­—ç¬¦é›†(Execution Character Set) æ‰“å°è¾“å‡º ç”¨ä¾‹ 1 ç®€ä½“ä¸­æ–‡ CP936 ç®€ä½“ä¸­æ–‡ CP936 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 ç®€ä½“ä¸­æ–‡ CP936 D6 D0 ç”¨ä¾‹ 2 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 BOM UTF-8 BOM UTF-8 ç®€ä½“ä¸­æ–‡ CP936 D6 D0 ç”¨ä¾‹ 3 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 ç®€ä½“ä¸­æ–‡ CP936 ç¼–è¯‘é”™è¯¯(C2146) ç”¨ä¾‹ 4 è¥¿æ¬§ CP1252 ç®€ä½“ä¸­æ–‡ CP936 è¥¿æ¬§ CP1252 UTF-8 è¥¿æ¬§ CP1252 D6 D0 ç”¨ä¾‹ 5 è¥¿æ¬§ CP1252 UTF-8 BOM UTF-8 BOM UTF-8 è¥¿æ¬§ CP1252 3F 00 è¡¨æ ¼ä¸­åˆ— 4~6 ä¾æ¬¡å¯¹åº”ç¼–è¯‘å¤„ç†æºæ–‡ä»¶çš„å‡ ä¸ªæ­¥éª¤ã€‚3Få¯¹åº”çš„ ASCII å­—ç¬¦ä¸º?ï¼Œç¼–è¯‘å™¨é‡åˆ°ä¸èƒ½è¯†åˆ«çš„å­—ç¬¦æ—¶ï¼Œå°±ä¼šç”¨?æ¥æ›¿ä»£ã€‚ å‡ºç°?çš„æƒ…å†µä¼šä¼´éšç€ç¼–è¯‘è­¦å‘ŠC4566ã€‚ä¸Šé¢å‡ºç°äº† 1 æ¬¡3Fï¼ˆç”¨ä¾‹ 5ï¼‰ï¼Œå¯¼è‡´ä¹±ç çš„åŸå› æ˜¯UTF-8 --&gt; è¥¿æ¬§ CP1252. è¥¿æ¬§ CP1252ä¹Ÿå°±æ˜¯ ASCII çš„æ‰©å±•ï¼Œä¸æ”¯æŒæ±‰å­—ï¼Œæ‰€ä»¥ç”¨3Fæ›¿ä»£ã€‚ ç”¨ä¾‹ 3 ä¸ºä»€ä¹ˆä¼šç¼–è¯‘é”™è¯¯ï¼Ÿå¾®è½¯çš„ç¼–è¯‘å™¨åªèƒ½è¯†åˆ«å¸¦ BOM çš„ UTF-8ï¼Œç”¨ä¾‹ 3 çš„ UTF-8 æ²¡å¸¦ BOMï¼Œç¼–è¯‘å™¨ä¼šåˆ¤å®šæºæ–‡ä»¶ç¼–ç ä¸ºç³»ç»Ÿå½“å‰ä»£ç é¡µ CP936ã€‚â€œä¸­â€çš„ UTF-8 ç¼–ç ä¸ºE4 B8 ADï¼Œåˆ— 5 æ‰§è¡Œä» CP936 åˆ° UTF-8 è½¬æ¢ä¹‹åå˜æˆäº†E6 B6 93 3Fï¼Œåˆ— 6 å†è¦å°†E6 B6 93 3Fè½¬æ¢ä¸º CP936 è‚¯å®šæ˜¯è½¬æ¢ä¸å›å»çš„ï¼Œç›¸å½“äº UTF-8ï¼ˆ1ï¼‰ â€“&gt; UTF-8 ï¼ˆ2ï¼‰ï¼Œå†å°† UTF-8ï¼ˆ2ï¼‰è½¬æ¢å› CP936ï¼Œè¿™æ—¶è‚¯å®šå¾—åˆ°çš„å­—ç¬¦ä¸æ˜¯åŸæ¥çš„å­—ç¬¦äº†ã€‚ ç”¨ä¾‹ 4 ä¸ºä»€ä¹ˆè¾“å‡ºçš„D6 D0ï¼Œè€Œä¸æ˜¯3Fï¼Ÿå¯¹ç€ç”¨ä¾‹ 4 çš„å„ä¸ªé¡ºåºæ¥çœ‹ï¼Œæºæ–‡ä»¶é€šè¿‡ CP936 ä¿å­˜ç€ï¼Œä½†ç¼–è¯‘å™¨é€šè¿‡ CP1252 æ¥è¯»å–çš„ï¼ŒCP1252 å°±æ˜¯ ASCII æ‰©å±•ï¼Œå•å­—èŠ‚çš„ï¼Œè™½ç„¶æ­¤æ—¶æ˜¾ç¤ºä¸ºä¹±ç ï¼Œä½†å„å­—èŠ‚ä»ç„¶æ˜¯ D6 D0ï¼›ç„¶åå°†è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹ä» CP1252 è½¬æˆ UTF-8 ç¼–ç ï¼Œè½¬ç åä¸º C3 96 C3 90ï¼›ç„¶åå†å°† UTF-8 ç¼–ç è½¬å›ä¸º CP1251ï¼Œè½¬ç å°±åˆå˜æˆäº† D6 D0ã€‚ ä½†è¿™ä¸ªD6 D0åœ¨ CP1252 ä¸­æ˜¯æ— æ³•æ˜¾ç¤ºçš„ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç”¨ä¾‹ 4 åŠ å…¥MessageBoxA(NULL, &quot;ä¸­&quot;, &quot;test&quot;, MB_OK); ä¼šå‘ç°å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºä»ç„¶æ˜¯ä¹±ç ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼š 1234567891011121314int _tmain(int argc, _TCHAR* argv[])&#123; char buf[3] = &#123; 0 &#125;; // æ¨¡æ‹ŸCP936ç¼–ç çš„â€œä¸­â€ buf[0] = 0xD6; buf[1] = 0xD0; std::string strUTF8 = ANSIToUTF8(buf, 1252); char *p = (char*)strUTF8.c_str(); // é€šè¿‡visual studioæŸ¥çœ‹æŒ‡é’ˆpå¤„å†…å­˜ä¸ºï¼š C3 96 C3 90 std::string str = UTF8ToANSI(strUTF8, 1252); p = (char*)str.c_str(); // é€šè¿‡visual studioæŸ¥çœ‹æŒ‡é’ˆpå¤„å†…å­˜ä¸ºï¼š D6 D0 return 0;&#125; 4.2 æµ‹è¯•ç¼–è¯‘å™¨å¤„ç†å®½å­—ç¬¦ç¼–ç æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 12345678int _tmain(int argc, _TCHAR* argv[])&#123; wchar_t buf[100] = &#123;L&quot;ä¸­&quot;&#125;; // wchar_t DumpCharacterCode((char*)buf, 4); // æ‰“å°4ä¸ªå­—èŠ‚ return 0;&#125; åŒæ ·ï¼Œé’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿä»£ç é¡µå’Œæºæ–‡ä»¶ç¼–ç ï¼Œæ‰“å°å‡ºçš„æ±‰å­—â€œä¸­â€çš„ç¼–ç åˆ†åˆ«ä¸ºï¼š æµ‹è¯•ç”¨ä¾‹ ç³»ç»Ÿä»£ç é¡µ ä¿å­˜æºæ–‡ä»¶ç¼–ç  ç¼–è¯‘å™¨åˆ¤æ–­æ–‡ä»¶é‡‡ç”¨çš„ç¼–ç  æºå­—ç¬¦é›†(Source Character Set) æ‰§è¡Œå­—ç¬¦é›†(Execution Character Set) æ‰“å°è¾“å‡º ç”¨ä¾‹ 1 ç®€ä½“ä¸­æ–‡ CP936 ç®€ä½“ä¸­æ–‡ CP936 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 UTF-16 2D 4E 00 00 ç”¨ä¾‹ 2 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 BOM UTF-8 BOM UTF-8 UTF-16 2D 4E 00 00 ç”¨ä¾‹ 3 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 ç®€ä½“ä¸­æ–‡ CP936 UTF-8 UTF-16 ç¼–è¯‘é”™è¯¯(C2146) ç”¨ä¾‹ 4 è¥¿æ¬§ CP1252 ç®€ä½“ä¸­æ–‡ CP936 è¥¿æ¬§ CP1252 UTF-8 UTF-16 D6 00 D0 00 å¤§å°ç«¯ ç”¨ä¾‹ 5 è¥¿æ¬§ CP1252 UTF-8 BOM UTF-8 BOM UTF-8 UTF-16 2D 4E 00 00 äº”. å½»åº•é¿å…ç¡¬ç¼–ç å­—ç¬¦ä¹±ç é€šè¿‡ç¬¬ 3 èŠ‚çš„è¯´æ˜ï¼Œå¾ˆå®¹æ˜“çŸ¥é“ï¼Œè¦å¼€å‘æ”¯æŒå¤šè¯­è¨€ï¼Œåœ¨ä»»æ„è¯­è¨€ï¼ˆç³»ç»Ÿä»£ç é¡µï¼‰çš„ windows ç¯å¢ƒä¸‹éƒ½æ­£å¸¸ç¼–è¯‘ï¼Œä¸”è¿è¡Œèµ·æ¥æ²¡æœ‰ä¹±ç çš„ç¨‹åºï¼Œéœ€è¦éµå¾ªå¦‚ä¸‹åŸåˆ™ï¼š ä»£ç æ–‡ä»¶é‡‡ç”¨ UTF-8 with BOM ç¼–ç ã€‚ Visual Studio å­—ç¬¦é›†è®¾ç½®ä¸º Unicode å­—ç¬¦é›†ã€‚ ä½¿ç”¨ wchar_tã€‚ åšåˆ°ä¸Šé¢ 3 æ­¥ï¼Œä½ çš„ä»£ç è¢«åˆ«äººä» github ä¸Š clone ä¸‹æ¥ç¼–è¯‘ï¼Œä¸ä¼šå› ä¸ºä½ ä»£ç ä¸­å«æœ‰ä¸­æ–‡ç­‰å­—ç¬¦ï¼Œäº§ç”Ÿç±»ä¼¼error C2015è¿™æ ·çš„ç¼–è¯‘é”™è¯¯ï¼Œæ›´ä¸ä¼šäº§ç”Ÿä¹±ç ã€‚ æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•åªç”¨æ¥è§£å†³ç¡¬ç¼–ç å­—ç¬¦ä¹±ç çš„é—®é¢˜ï¼Œè‡³äºæ•°æ®ä¼ è¾“ä¸­çš„ä¹±ç ï¼Œéœ€è¦ç»Ÿä¸€å­—ç¬¦ç¼–ç æ¥è§£å†³ã€‚ å‚è€ƒ: https://blogs.msdn.microsoft.com/vcblog/2016/02/22/new-options-for-managing-character-sets-in-the-microsoft-cc-compiler æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["MSVC","å­—ç¬¦ç¼–ç "],"categories":["å­—ç¬¦ç¼–ç "]},{"title":"æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(3)--å­—ç¬¦ç¼–ç è½¬æ¢","path":"/post/4126466705.html","content":"æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ç³»ç»Ÿ API è¿›è¡Œå­—ç¬¦ç¼–ç çš„è½¬æ¢ã€‚ 1. Windows API ä»‹ç»æœ¬æ–‡ä»‹ç»ä½¿ç”¨ Windows API è¿›è¡Œå­—ç¬¦ç¼–ç çš„è½¬æ¢ï¼Œæ¶‰åŠWideCharToMultiByteå’ŒMultiByteToWideChar2 ä¸ª APIï¼ŒAPI æ¥å£åä¸­çš„MultiByteå¯¹åº”ç€å¤šå­—èŠ‚ç¼–ç ï¼Œå¦‚ ASCIIã€UTF-8 ç­‰éƒ½æ˜¯å¤šå­—èŠ‚ç¼–ç ï¼Œè€ŒWideCharå­—é¢æ„æ€æ˜¯å®½å­—ç¬¦ï¼Œåœ¨ windows å†…éƒ¨å®½å­—ç¬¦ç‰¹æŒ‡ UTF-16 ç¼–ç ã€‚ åŸå‹å¦‚ä¸‹ï¼š 1234567891011int WideCharToMultiByte( UINT CodePage, DWORD dwFlags, LPCWSTR lpWideCharStr, int cchWideChar, LPSTR lpMultiByteStr, int cbMultiByte, LPCSTR lpDefaultChar, LPBOOL lpUsedDefaultChar); 123456789int MultiByteToWideChar( UINT CodePage, DWORD dwFlags, LPCSTR lpMultiByteStr, int cbMultiByte, LPWSTR lpWideCharStr, int cchWideChar); 2. API å°è£…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118std::string UnicodeToANSI(const std::wstring &amp;str, UINT iCodePage = CP_ACP) &#123; std::string strRes; int iSize = ::WideCharToMultiByte(iCodePage, 0, str.c_str(), -1, NULL, 0, NULL, NULL); if (iSize == 0) return strRes; char *szBuf = new (std::nothrow) char[iSize]; if (!szBuf) return strRes; memset(szBuf, 0, iSize); ::WideCharToMultiByte(iCodePage, 0, str.c_str(), -1, szBuf, iSize, NULL, NULL); strRes = szBuf; delete[] szBuf; return strRes;&#125;std::wstring ANSIToUnicode(const std::string &amp;str, UINT iCodePage = CP_ACP) &#123; std::wstring strRes; int iSize = ::MultiByteToWideChar(iCodePage, 0, str.c_str(), -1, NULL, 0); if (iSize == 0) return strRes; wchar_t *szBuf = new (std::nothrow) wchar_t[iSize]; if (!szBuf) return strRes; memset(szBuf, 0, iSize * sizeof(wchar_t)); ::MultiByteToWideChar(iCodePage, 0, str.c_str(), -1, szBuf, iSize); strRes = szBuf; delete[] szBuf; return strRes;&#125;std::string UnicodeToUTF8(const std::wstring &amp;str) &#123; std::string strRes; int iSize = ::WideCharToMultiByte(CP_UTF8, 0, str.c_str(), -1, NULL, 0, NULL, NULL); if (iSize == 0) return strRes; char *szBuf = new (std::nothrow) char[iSize]; if (!szBuf) return strRes; memset(szBuf, 0, iSize); ::WideCharToMultiByte(CP_UTF8, 0, str.c_str(), -1, szBuf, iSize, NULL, NULL); strRes = szBuf; delete[] szBuf; return strRes;&#125;std::string UnicodeToUTF8BOM(const std::wstring &amp;str) &#123; std::string strRes; int iSize = ::WideCharToMultiByte(CP_UTF8, 0, str.c_str(), -1, NULL, 0, NULL, NULL); if (iSize == 0) return strRes; unsigned char *szBuf = new (std::nothrow) unsigned char[iSize + 3]; if (!szBuf) return strRes; memset(szBuf, 0, iSize + 3); if (::WideCharToMultiByte(CP_UTF8, 0, str.c_str(), -1, (LPSTR)(szBuf + 3), iSize, NULL, NULL) &gt; 0) &#123; szBuf[0] = 0xEF; szBuf[1] = 0xBB; szBuf[2] = 0xBF; &#125; strRes = (char*)szBuf; delete[] szBuf; return strRes;&#125;std::wstring UTF8ToUnicode(const std::string &amp;str) &#123; std::wstring strRes; int iSize = ::MultiByteToWideChar(CP_UTF8, 0, str.c_str(), -1, NULL, 0); if (iSize == 0) return strRes; wchar_t *szBuf = new (std::nothrow) wchar_t[iSize]; if (!szBuf) return strRes; memset(szBuf, 0, iSize * sizeof(wchar_t)); ::MultiByteToWideChar(CP_UTF8, 0, str.c_str(), -1, szBuf, iSize); strRes = szBuf; delete[] szBuf; return strRes;&#125;std::string ANSIToUTF8(const std::string &amp;str, UINT iCodePage = CP_ACP) &#123; return UnicodeToUTF8(ANSIToUnicode(str, iCodePage));&#125;std::string ANSIToUTF8BOM(const std::string &amp;str, UINT iCodePage = CP_ACP) &#123; return UnicodeToUTF8BOM(ANSIToUnicode(str, iCodePage));&#125;std::string UTF8ToANSI(const std::string &amp;str, UINT iCodePage = CP_ACP) &#123; return UnicodeToANSI(UTF8ToUnicode(str), iCodePage);&#125; å¯¹äºåªæ”¯æŒç®€ä½“ä¸­æ–‡ï¼ˆéƒ¨åˆ†éŸ©æ–‡ã€æ—¥æ–‡ï¼‰çš„ç³»ç»Ÿï¼ŒiCodePageå¯ä»¥ä½¿ç”¨ CP_ACPï¼Œè¿™æ—¶ API ä¼šä½¿ç”¨ç³»ç»Ÿå½“å‰çš„ä»£ç é¡µï¼ˆç®€ä½“ä¸­æ–‡ç³»ç»Ÿä¸º CP936ï¼Œå³ GBK å­—ç¬¦é›†ï¼‰æ¥è¿›è¡Œç¼–ç è½¬æ¢ã€‚ ä½†é‡åˆ°å¦‚ä¸‹æƒ…å†µå°±éœ€è¦æ‰‹åŠ¨æŒ‡å®šä»£ç é¡µï¼š éœ€è¦è½¬æ¢çš„å­—ç¬¦ä¸²ä¸­çš„æ–‡å­—æ˜¯ç³»ç»Ÿå½“å‰ä»£ç é¡µä¸æ”¯æŒçš„ã€‚å¦‚å­—ç¬¦ä¸²ä¸­å«æœ‰ä¸­æ–‡ï¼Œè€Œå½“å‰ç³»ç»Ÿä»£ç é¡µç¡®æ˜¯è‹±æ–‡çš„ï¼› GBK å­—ç¬¦é›†ä¸­åªåŒ…å«äº†ä¸€éƒ¨åˆ†éŸ©æ–‡å’Œæ—¥æ–‡ï¼Œéƒ¨åˆ†éŸ©æ–‡å’Œæ—¥æ–‡çš„è½¬æ¢å¯ä»¥æ­£å¸¸è½¬æ¢ï¼Œè‹¥é‡åˆ°ä¸èƒ½è½¬æ¢çš„æƒ…å†µä¹Ÿéœ€è¦å°†æŒ‡å®š iCodePage ä¸ºç‰¹å®šçš„æ”¯æŒéŸ©æ–‡æˆ–æ—¥æ–‡çš„ä»£ç é¡µäº†ï¼Œç‰¹åˆ«æ˜¯ä¸­æ–‡å’ŒéŸ©æ–‡ã€æ—¥æ–‡ç­‰æ··åˆçš„æƒ…å†µä¸‹ã€‚å¦‚éŸ©æ–‡â€œíƒ‰â€ä¸åŒ…å«åœ¨ GBK ä¸­ï¼Œè‹¥è¿™æ—¶ä»ç„¶ä½¿ç”¨ CP_ACP å°±ä¼šå¾—åˆ°é”™è¯¯çš„è½¬æ¢ç»“æœ?ï¼Œåå…­è¿›åˆ¶3Fã€‚ä½† GB18030ï¼ˆä»£ç é¡µä¸º 54936ï¼‰æ”¯æŒâ€œíƒ‰â€ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®š iCodePage ä¸º 54936ã€‚ å¦‚æœä»£ç ä¸­å«æœ‰ GBK ä¸æ”¯æŒçš„å­—ç¬¦ï¼Œå¦‚â€œíƒ‰â€ã€â€œğ¤­¢â€ï¼ˆå¿µ suÃ¬ï¼‰ç­‰ï¼ŒVisual Studio ä¼šå¼¹å‡ºå¦‚ä¸‹æç¤ºï¼šé€‰æ‹©â€œä»¥å…¶ä»–ç¼–ç ä¿å­˜â€ï¼Œé€‰æ‹©â€œUnicodeï¼ˆUTF-8 å¸¦ç­¾åï¼‰- ä»£ç é¡µ 65001â€ä¿å­˜ã€‚è™½ç„¶â€œç®€ä½“ä¸­æ–‡ï¼ˆGB18030) - ä»£ç é¡µ 54936â€ä¹Ÿæ”¯æŒè¿™äº›å­—ç¬¦ï¼Œä½†ä¸èƒ½é€‰æ‹©è¯¥é€‰é¡¹è¿›è¡Œä¿å­˜ï¼Œå…·ä½“åŸå› åœ¨æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(2)--ç¼–è¯‘å™¨å¤„ç†æ–‡ä»¶ç¼–ç ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["Windows","å­—ç¬¦ç¼–ç "],"categories":["å­—ç¬¦ç¼–ç "]},{"title":"æ‹¨å¼€å­—ç¬¦ç¼–ç çš„è¿·é›¾(1)--å­—ç¬¦ç¼–ç æ¦‚è¿°","path":"/post/2720283852.html","content":"ä¸ºä»€ä¹ˆè¿™æ ·çš„å­—ç¬¦ä¸²&#123;&quot;data&quot;:&quot;é¢¸é¢¸&quot;&#125;ï¼ŒJSON åº“ï¼ˆå¦‚jsoncppï¼‰ä¼šè§£æå¤±è´¥ï¼Ÿ ä¸ºä»€ä¹ˆè½¯ä»¶ç•Œé¢ä¸Šçš„éŸ©æ–‡ä¼šæ˜¾ç¤ºä¹±ç ï¼Ÿ ASCII å’Œ ANSI æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç›¸ä¿¡ä¸å°‘äººåœ¨å­—ç¬¦ç¼–ç ä¸Šé¢æ‘”è¿‡è·Ÿå¤´ï¼Œè¿™ç¯‡æ–‡ç« é’ˆå¯¹å¼€å‘ä¸­éœ€è¦äº†è§£çš„å­—ç¬¦ç¼–ç çŸ¥è¯†è¿›è¡Œäº†ç®€è¦çš„è®²è§£ï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚ 1. ASCII åŠå…¶æ‰©å±•1.1 ä»€ä¹ˆæ˜¯ ASCII å­—ç¬¦é›†å­—ç¬¦é›†å°±æ˜¯ä¸€ç³»åˆ—ç”¨äºæ˜¾ç¤ºçš„å­—ç¬¦çš„é›†åˆã€‚ ASCII å­—ç¬¦é›†ç”±ç¾å›½å›½å®¶æ ‡å‡†åä¼šï¼ˆAmerican National Standard Institute)äº 1968 å¹´åˆ¶å®šä¸€ä¸ªå­—ç¬¦æ˜ å°„é›†åˆã€‚ ASCII ä½¿ç”¨ 7 ä½äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ€»å…±å¯ä»¥è¡¨ç¤º 128 ä¸ªå­—ç¬¦ï¼ˆå³2^7ï¼ŒäºŒè¿›åˆ¶000 0000 ï½ 111 1111ï¼Œåè¿›åˆ¶0ï½127ï¼‰ã€‚ ASCII å­—ç¬¦é›†ä¸­æ¯ä¸ªæ•°å­—å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ï¼Œå¦‚ä¸‹è¡¨ï¼š å› ä¸ºå…¶å¯¹åº”å…³ç³»éå¸¸ç®€å•ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„ç¼–ç è§„åˆ™ï¼Œæ‰€ä»¥ä¸¥æ ¼æ¥è®² ASCII ä¸èƒ½ç®—å­—ç¬¦ç¼–ç ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è§„å®šç¼–ç è§„åˆ™ã€‚æˆ‘ä»¬åªæ˜¯ä¹ æƒ¯æ€§çš„å°† ASCII å­—ç¬¦é›†ç§°ä¹‹ä¸º ASCII ç ã€ASCII ç¼–ç ã€‚ 1.2 ASCII çš„æ‰©å±•1.2.1 æœ€é«˜ä½æ‰©å±• - ISO&#x2F;IEC 8859ASCII å­—ç¬¦é›†æ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œå…¶ä¸­çš„å­—ç¬¦å®Œå…¨æ˜¯ä¸ºå…¶è‡ªå·±é‡èº«å®šåˆ¶çš„ã€‚éšç€è®¡ç®—æœºæŠ€æœ¯æ™®åŠåˆ°æ¬§æ´²ï¼ˆå¦‚æ³•å›½ã€å¾·å›½ï¼‰å„å›½ï¼Œæ¬§æ´²å¾ˆå¤šå›½å®¶ä½¿ç”¨çš„å­—ç¬¦é™¤äº† ASCII è¡¨ä¸­çš„ 128 ä¸ªå­—ç¬¦ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å„å›½ç‰¹æœ‰çš„å­—ç¬¦ï¼Œæ­¤æ—¶æ¬§æ´²äººæ°‘å‘ç° ASCII å­—ç¬¦é›†ä¸èƒ½å®Œå…¨è¡¨è¾¾ä»–ä»¬æ‰€è¦è¡¨è¾¾çš„å†…å®¹ã€‚æ€ä¹ˆåŠäº†ï¼Ÿä»–ä»¬å‘ç° ASCII åªä½¿ç”¨äº†ä¸€ä¸ªå­—èŠ‚ï¼ˆ8 ä½ï¼‰ä¹‹ä¸­çš„ä½ 7 ä½ï¼Œäºæ˜¯æ¬§æ´²å„å›½å¼€å§‹å„æ˜¾ç¥é€šï¼Œæ‰“èµ·äº†é‚£ 1 ä¸ªæœ€é«˜ä½ï¼ˆç¬¬ 0 ä½ï¼‰çš„ä¸»æ„ï¼Œå°†æœ€é«˜ä½åˆ©ç”¨äº†èµ·æ¥ï¼Œè¿™æ ·åˆå¤šäº† 128 ä¸ªå­—ç¬¦ï¼Œä»è€Œæ»¡è¶³äº†æ¬§æ´²äººæ°‘çš„éœ€è¦ã€‚ ä½†å› ä¸ºæ¯ä¸ªå›½å®¶çš„éœ€æ±‚ä¸ä¸€æ ·ï¼Œå„å›½éƒ½è®¾è®¡äº†ä¸åŒçš„æ–¹æ¡ˆã€‚ä¸ºäº†ç»“æŸè¿™ç§æ··ä¹±çš„å±€é¢ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡(ISO)åŠå›½é™…ç”µå·¥å§”å‘˜ä¼š(IEC)è”åˆåˆ¶å®šäº†ä¸€ç³»åˆ— 8 ä½å­—ç¬¦é›†çš„æ ‡å‡†ï¼Œç»Ÿç§°ä¸º ISO 8859ï¼ˆå…¨ç§° ISO&#x2F;IEC 8859ï¼‰ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ç³»åˆ—å­—ç¬¦é›†çš„ç»Ÿç§°ï¼Œå¦‚ ISO&#x2F;IEC 8859-1ï¼ˆä¹Ÿå°±æ˜¯å¸¸å¬åˆ°çš„ Latin-1ï¼‰æ”¯æŒè¥¿æ¬§è¯­è¨€ï¼ŒISO&#x2F;IEC 8859-4ï¼ˆLatin-4ï¼‰æ”¯æŒåŒ—æ¬§è¯­è¨€ç­‰ã€‚ å®Œæ•´åˆ—è¡¨å¦‚ä¸‹ï¼ˆæ‘˜è‡ªç™¾åº¦ç™¾ç§‘ï¼‰ï¼šISO&#x2F;IEC 8859-1 (Latin-1) - è¥¿æ¬§è¯­è¨€ISO&#x2F;IEC 8859-2 (Latin-2) - ä¸­æ¬§è¯­è¨€ISO&#x2F;IEC 8859-3 (Latin-3) - å—æ¬§è¯­è¨€ï¼Œä¸–ç•Œè¯­ä¹Ÿå¯ç”¨æ­¤å­—ç¬¦é›†æ˜¾ç¤ºã€‚ISO&#x2F;IEC 8859-4 (Latin-4) - åŒ—æ¬§è¯­è¨€ISO&#x2F;IEC 8859-5 (Cyrillic) - æ–¯æ‹‰å¤«è¯­è¨€ISO&#x2F;IEC 8859-6 (Arabic) - é˜¿æ‹‰ä¼¯è¯­ISO&#x2F;IEC 8859-7 (Greek) - å¸Œè…Šè¯­ISO&#x2F;IEC 8859-8 (Hebrew) - å¸Œä¼¯æ¥è¯­(è§†è§‰é¡ºåº)ISO 8859-8-I - å¸Œä¼¯æ¥è¯­(é€»è¾‘é¡ºåº)ISO&#x2F;IEC 8859-9 (Latin-5 æˆ– Turkish) - å®ƒæŠŠ Latin-1 çš„å†°å²›è¯­å­—æ¯æ¢èµ°ï¼ŒåŠ å…¥åœŸè€³å…¶è¯­å­—æ¯ã€‚ISO&#x2F;IEC 8859-10 (Latin-6 æˆ– Nordic) - åŒ—æ—¥è€³æ›¼è¯­æ”¯ï¼Œç”¨æ¥ä»£æ›¿ Latin-4ã€‚ISO&#x2F;IEC 8859-11 (Thai) - æ³°è¯­ï¼Œä»æ³°å›½çš„ TIS620 æ ‡å‡†å­—é›†æ¼”åŒ–è€Œæ¥ã€‚ISO&#x2F;IEC 8859-13 (Latin-7 æˆ– Baltic Rim) - æ³¢ç½—çš„è¯­æ—ISO&#x2F;IEC 8859-14 (Latin-8 æˆ– Celtic) - å‡¯å°”ç‰¹è¯­æ—ISO&#x2F;IEC 8859-15 (Latin-9) - è¥¿æ¬§è¯­è¨€ï¼ŒåŠ å…¥ Latin-1 æ¬ ç¼ºçš„èŠ¬å…°è¯­å­—æ¯å’Œå¤§å†™æ³•è¯­é‡éŸ³å­—æ¯ï¼Œä»¥åŠæ¬§å…ƒç¬¦å·ã€‚ISO&#x2F;IEC 8859-16 (Latin-10) - ä¸œå—æ¬§è¯­è¨€ã€‚ä¸»è¦ä¾›ç½—é©¬å°¼äºšè¯­ä½¿ç”¨ï¼Œå¹¶åŠ å…¥æ¬§å…ƒç¬¦å·ã€‚ æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­å¸¸è§åˆ°çš„ Latin-1ã€2ã€5ã€7 å…¶å®å°±æ˜¯ä¸Šé¢æåˆ°çš„é’ˆå¯¹ç‰¹å®šè¯­è¨€çš„ ASCII æ‰©å±•å­—ç¬¦é›†ã€‚ 1.2.2 å¤šå­—èŠ‚æ‰©å±• - GB ç³»åˆ—å‰é¢è®²åˆ°äº†ï¼Œæ¬§æ´²å„å›½æœ‰æ•ˆåˆ©ç”¨é—²ç½®çš„æœ€é«˜ä½å¯¹ ASCII å­—ç¬¦é›†è¿›è¡Œäº†æ‰©å±•ã€‚å¯æ˜¯æ¬§æ´²äººæ°‘æ²¡æœ‰æƒ³åˆ°åœ¨å¤§æ´‹å½¼å²¸æœ‰ç€ä¸€ä¸ªæ‹¥æœ‰äº”åƒå¹´å†å²çš„ä¼Ÿå¤§æ°‘æ—ï¼Œå¥¹æ‹¥æœ‰ç€æˆåƒä¸Šä¸‡çš„æ±‰å­—ï¼Œ1 ä¸ªå­—èŠ‚æ˜¾ç„¶ä¸å¤Ÿè¡¨è¾¾å¦‚æ­¤æ·±åšçš„æ–‡åŒ–åº•è•´ã€‚ äºæ˜¯å½“è®¡ç®—æœºå¼•å…¥åˆ°ä¸­å›½ä¹‹åˆï¼Œå›½å®¶æŠ€æœ¯ç›‘ç£å±€å°±è®¾è®¡äº† GB ç³»åˆ—ç¼–ç æ–¹æ¡ˆï¼ˆGB ä¸º guo biao çš„ç®€ç§°)ã€‚GB ç¼–ç æ–¹æ¡ˆä½¿ç”¨ 2 ä¸ªå­—èŠ‚æ¥è¡¨è¾¾ä¸€ä¸ªæ±‰å­—ã€‚åŒæ—¶ä¸ºäº†å…¼å®¹ ASCII ç¼–ç ï¼Œè§„å®šå„ä¸ªå­—èŠ‚çš„æœ€é«˜ä½ï¼ˆé¦–ä½ï¼‰å¿…é¡»ä¸º 1ï¼Œä»è€Œé¿å…äº†å’Œæœ€é«˜ä½ä¸º 0 çš„ ASCII å­—ç¬¦é›†çš„å†²çªã€‚ GB ç³»åˆ—å­—ç¬¦é›†ç»å†ä¸‹é¢çš„å‡ ä¸ªå‘å±•è¿‡ç¨‹ï¼š ç¼–ç åç§° å‘å¸ƒæ—¶é—´ å­—èŠ‚æ•° æ±‰å­—èŒƒå›´ GB2312 1980 å¹´ å˜å­—èŠ‚ï¼ˆASCII 1 å­—èŠ‚ï¼Œæ±‰å­— 2 ä¸ªå­—èŠ‚ï¼‰ 6763 ä¸ªæ±‰å­— GB13000 1993 å¹´ç¬¬ä¸€ç‰ˆ å˜å­—èŠ‚ï¼ˆASCII 1 å­—èŠ‚ï¼Œæ±‰å­— 2 ä¸ªå­—èŠ‚ï¼‰ 20902 ä¸ªæ±‰å­— GBK Windows95 ä¸­ 2 ä¸ªå­—èŠ‚ 21886 ä¸ªæ±‰å­—å’Œå›¾å½¢ç¬¦å·ï¼ˆå« GB2312ï¼ŒBIG5 ä¸­æ‰€æœ‰å­—ç¬¦ï¼‰ GB18030 2000 å¹´ç¬¬ä¸€ç‰ˆ å˜å­—èŠ‚ï¼ˆASCII 1 å­—èŠ‚ï¼Œæ±‰å­— 2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚ï¼‰ 27484 ä¸ªæ±‰å­— æ¯ä¸€æ¬¡è¿­ä»£ï¼Œæ”¯æŒçš„å­—ç¬¦æ•°é‡éƒ½ä¼šå¢åŠ ï¼Œè€Œä¸”æ¯ä¸€æ¬¡è¿­ä»£éƒ½ä¼šä¿ç•™ä¹‹å‰ç‰ˆæœ¬æ”¯æŒçš„ç¼–ç ï¼Œæ‰€ä»¥åšåˆ°äº†å‘ä¸Šå…¼å®¹ã€‚ 1.2.3 å…¨è§’ä¸åŠè§’å› ä¸ºæ±‰å­—åœ¨æ˜¾ç¤ºå™¨ä¸Šçš„æ˜¾ç¤ºå®½åº¦è¦æ¯”è‹±æ–‡å­—ç¬¦çš„å®½åº¦è¦å®½ä¸€å€ï¼Œåœ¨ä¸€èµ·æ’ç‰ˆæ˜¾ç¤ºæ—¶ä¸å¤ªç¾è§‚ã€‚æ‰€ä»¥ GB ç¼–ç ä¸ä»…ä»…åŠ å…¥äº†æ±‰å­—å­—ç¬¦ï¼Œè€Œä¸”åŒ…æ‹¬äº† ASCII å­—ç¬¦é›†ä¸­æœ¬æ¥å°±æœ‰çš„æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€å­—æ¯ç­‰å­—ç¬¦ã€‚è¿™äº›è¢«ç¼–å…¥ GB ç¼–ç çš„æ•°å­—ã€æ ‡ç‚¹ã€å­—æ¯åœ¨æ˜¾ç¤ºå™¨ä¸Šçš„æ˜¾ç¤ºå®½åº¦æ¯” ASCII å­—ç¬¦é›†ä¸­çš„å®½åº¦å®½ä¸€å€ï¼Œæ‰€ä»¥å‰è€…ç§°ä¸ºå…¨è§’å­—ç¬¦ï¼Œåè€…ç§°ä¸ºåŠè§’å­—ç¬¦ã€‚ 2. ANSI2.1 ANSI ä¸ä»£ç é¡µå‰é¢è¯´åˆ°äº†ä¸–ç•Œå„å›½é’ˆå¯¹ ASCII çš„æ‰©å±•æ–¹æ¡ˆï¼ˆå¦‚æ¬§æ´²çš„ ISO&#x2F;IEC 8859ï¼Œä¸­å›½çš„ GB ç³»åˆ—ç­‰ï¼‰ï¼Œè¿™äº› ASCII æ‰©å±•ç¼–ç æ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ï¼šä»–ä»¬éƒ½å…¼å®¹ ASCII ç¼–ç ï¼Œä½†ä»–ä»¬å½¼æ­¤ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ã€‚å¾®è½¯å°†è¿™äº›ç¼–ç æ–¹æ¡ˆç»Ÿç§°ä¸º ANSI ç¼–ç ã€‚æ•… ANSI å¹¶ä¸æ˜¯ç‰¹æŒ‡æŸä¸€ç§ç¼–ç æ–¹æ¡ˆï¼Œåªæœ‰çŸ¥é“äº†åœ¨å“ªä¸ªå›½å®¶ï¼Œå“ªä¸ªè¯­è¨€ç¯å¢ƒä¸‹ï¼Œæ‰çŸ¥é“å®ƒå…·ä½“è¡¨ç¤ºå“ªä¸ªç¼–ç æ–¹æ¡ˆã€‚ åœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šï¼Œé»˜è®¤ä½¿ç”¨ ANSI æ¥ä¿å­˜æ–‡ä»¶ï¼ˆä»Windows 10å¼€å§‹é»˜è®¤ä½¿ç”¨UTF8ç¼–ç ï¼‰ã€‚æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•çŸ¥é“ ANSI åˆ°åº•åº”è¯¥è¡¨ç¤ºå“ªç§ç¼–ç äº†ï¼Œæ˜¯ GBKè¿˜æ˜¯ ASCIIï¼Œæˆ–è€…è¿˜æ˜¯ EUC-KR äº†ï¼Ÿ Windows é€šè¿‡ä¸€ä¸ªå«â€Code Pageâ€ï¼ˆç¿»è¯‘ä¸ºä¸­æ–‡å«ä»£ç é¡µï¼‰çš„ä¸œè¥¿æ¥åˆ¤æ–­ç³»ç»Ÿçš„é»˜è®¤ç¼–ç ã€‚ ç®€ä½“ä¸­æ–‡æ“ä½œç³»ç»Ÿé»˜è®¤çš„ä»£ç é¡µæ˜¯ 936ï¼Œå®ƒè¡¨ç¤º ANSI ä½¿ç”¨çš„æ˜¯ GBK ç¼–ç ã€‚GB18030 ç¼–ç å¯¹åº”çš„ windows ä»£ç é¡µä¸º CP54936ã€‚ å¯ä»¥ä½¿ç”¨å‘½ä»¤chcpæ¥æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤çš„ä»£ç é¡µ. æ±‰å­—â€œğ¤­¢â€ï¼ˆå¿µ suÃ¬ï¼‰åªåŒ…å«åœ¨ GB18030 ä¸­ï¼ŒGB2312ã€GB13000ã€GBK ä¸­å‡ä¸åŒ…å«ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ Visual Studio ä¸­è¾“å…¥è¯¥æ±‰å­—ï¼Œvisual studio ä¼šä½¿ç”¨ CP936ï¼ˆå³ GBKï¼‰æ¥ä¿å­˜ä»£ç æ–‡ä»¶ï¼Œä½†å¦‚æœåœ¨ä»£ç æ–‡ä»¶ä¸­è¾“å…¥è¯¥æ±‰å­—ï¼Œvisual studio å¼¹å‡ºå¦‚ä¸‹æç¤ºè¦æ±‚ç”¨æˆ·é€‰æ‹©ä»£ç é¡µï¼š 2.2 æ›´æ”¹é»˜è®¤ä»£ç é¡µ2.2.1 chcp å‘½ä»¤å¯ä»¥ä½¿ç”¨chcpå‘½ä»¤æ¥æ›´æ”¹é»˜è®¤ä»£ç é¡µï¼Œå¦‚chcp 437å°†é»˜è®¤ä»£ç é¡µæ›´æ”¹ä¸º 437ï¼ˆç¾å›½ï¼‰ã€‚ 2.2.2 æ§åˆ¶é¢æ¿åœ¨â€œæ§åˆ¶é¢æ¿â€â€“&gt;â€œåŒºåŸŸå’Œè¯­è¨€â€â€“&gt; â€œæ›´æ”¹ç³»ç»ŸåŒºåŸŸè®¾ç½®â€ä¸­æ›´æ”¹ç³»ç»Ÿé»˜è®¤çš„ä»£ç é¡µä¸ºâ€œä¸­æ–‡ï¼ˆç®€ä½“ï¼Œä¸­å›½ï¼‰â€ã€‚ 2.2.3 ä»£ç ä¿®æ”¹ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç æ›´æ”¹é»˜è®¤çš„ä»£ç é¡µï¼š 1234char *setlocale( int category, const char *locale); 3. Unicode3.1 Unicode äº§ç”ŸèƒŒæ™¯å„ä¸ªå›½å®¶ä½¿ç”¨ä¸åŒçš„ç¼–ç è§„åˆ™ï¼Œè™½ç„¶ä»–ä»¬éƒ½æ˜¯å…¼å®¹ ASCII çš„ï¼Œä½†å®ƒä»¬ç›¸äº’å´æ˜¯ä¸å…¼å®¹çš„ã€‚ è¯•æƒ³æ³•å›½äºº Jack å†™äº†ä¸€å°åä¸ºâ€love_you.txtâ€çš„ä¿¡ï¼Œä¼ ç»™äº†ä»–çš„å¾·å›½æœ‹å‹ Roseï¼ŒRose æƒ³è¦åœ¨ windows ç³»ç»Ÿä¸Šæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¥¹éœ€è¦çŸ¥é“å¾·å›½ä½¿ç”¨çš„å­—ç¬¦ç¼–ç æ˜¯ Latin-1ï¼Œç„¶åè¿˜è¦ç¡®ä¿å¥¹çš„è®¡ç®—æœºä¸Šå®‰è£…äº†è¯¥ç¼–ç ï¼Œæ‰èƒ½é¡ºåˆ©çš„æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœä¸Šé¢è¿™äº›è¿˜èƒ½å¿å—ï¼Œé‚£ä¹ˆéšç€ç½‘ç»œçš„å‘å±•ï¼Œä½ ä»äº’è”ç½‘ä¸Šè·å–çš„æ–‡ä»¶ï¼Œä½ å¾ˆæœ‰å¯èƒ½ä¸çŸ¥é“å®ƒæ¥è‡ªå“ªä¸ªå›½å®¶ï¼Œä½¿ç”¨çš„å“ªç§ç¼–ç ã€‚è¿™ä¹Ÿå°±æ˜¯ Email åˆšè¯ç”Ÿæ—¶å¸¸å¸¸å‡ºç°ä¹±ç çš„åŸå› ï¼Œå‘ä¿¡äººå’Œæ”¶ä¿¡äººä½¿ç”¨çš„ç¼–ç å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ äºæ˜¯The Unicode Standardï¼ˆç»Ÿä¸€ç æ ‡å‡†ï¼‰æ¨ªç©ºå‡ºä¸–ï¼Œå®ƒç”± The Unicode Consortium äº 1991 å¹´å‘å¸ƒï¼Œæˆ‘ä»¬ä¹ æƒ¯ç§°å®ƒä¸º Unicode å­—ç¬¦é›†ã€‚ Unicode å­—ç¬¦é›†å’Œ ASCII å­—ç¬¦é›†ä¸€æ ·ï¼Œä¹Ÿåªæ˜¯ä¸€ä¸ªå­—ç¬¦é›†åˆï¼Œæ ‡è®°ç€å­—ç¬¦å’Œæ•°å­—ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå®ƒä¸åŒ…å«ä»»ä½•ç¼–ç è§„åˆ™å’Œæ–¹æ¡ˆã€‚å’Œ ASCII ä¸ä¸€æ ·çš„æ˜¯ï¼ŒUnicode å­—ç¬¦é›†æ”¯æŒçš„å­—ç¬¦æ•°é‡æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒ Unicode è§„èŒƒï¼‰ã€‚ æˆ‘ä»¬é€šå¸¸è®¤ä¸ºçš„ Unicode å­—ç¬¦å›ºå®šå ç”¨ 2 ä¸ªå­—èŠ‚çš„è§‚ç‚¹æ˜¯é”™è¯¯çš„ã€‚å¦‚â€œğ¤­¢â€ï¼ˆå¿µ suÃ¬ï¼‰Unicode ç ä¸ºD852 DF62ã€‚ é‚£ä¹ˆ Unicode å­—ç¬¦æ˜¯æ€æ ·è¢«ç¼–ç æˆå†…å­˜ä¸­çš„å­—èŠ‚çš„äº†ï¼Ÿå®ƒæ˜¯é€šè¿‡ UTF(Unicode Transformation Formats)å®ç°çš„ï¼Œæ¯”è¾ƒå¸¸è§å¾—æœ‰ UTF-8ï¼ŒUTF-16ã€‚ åœ¨ windows ç³»ç»Ÿä¸Šæ±‰å­—é»˜è®¤ä½¿ç”¨ CP936ï¼ˆå³ GBK ç¼–ç ï¼‰ï¼Œå  2 ä¸ªå­—èŠ‚ã€‚è€Œå¤§å¤šæ•° Unicode å­—ç¬¦çš„ Unicode ç å€¼ä¹Ÿå  2 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¤§å¤šæ•°äººè¯¯ä»¥ä¸ºæ±‰å­—å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„å€¼å°±æ˜¯ Unicode å€¼ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚å¯ä»¥ä» ç«™é•¿å·¥å…·-Unicode æŸ¥è¯¢æ±‰å­—çš„ Unicode ç å€¼ã€‚ 3.3 å­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç çš„åŒºåˆ«ä» ASCIIã€GB2312ã€GBKã€GB18030ã€Big5ï¼ˆç¹ä½“ä¸­æ–‡ï¼‰ã€Latin-1 ç­‰é‡‡ç”¨çš„æ–¹æ¡ˆæ¥çœ‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯å®šä¹‰äº†å•ä¸ªå­—ç¬¦ä¸äºŒè¿›åˆ¶æ•°æ®çš„æ˜ å°„å…³ç³»ï¼Œä¸€ä¸ªå­—ç¬¦åœ¨ä¸€ä¸ªæ–¹æ¡ˆä¸­åªä¼šå­˜åœ¨ä¸€ç§è¡¨ç¤ºæ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´ GB2312 æ˜¯å­—ç¬¦é›†è¿˜æ˜¯å­—ç¬¦ç¼–ç æ–¹å¼éƒ½æ— æ‰€è°“äº†ã€‚ä½†æ˜¯ Unicode ä¸ä¸€æ ·ï¼ŒUnicode ä½œä¸ºä¸€ä¸ªå­—ç¬¦é›†å¯ä»¥é‡‡ç”¨å¤šç§ç¼–ç æ–¹å¼ï¼Œå¦‚ UTF-8, UTF-16, UTF-32 ç­‰ã€‚æ‰€ä»¥è‡ª Unicode å‡ºç°ä¹‹åï¼Œå­—ç¬¦é›†ä¸å­—ç¬¦ç¼–ç éœ€è¦æ˜ç¡®åŒºåˆ†å¼€æ¥ã€‚ 3.4 UTF-16 ç¼–ç çš„ç¼ºç‚¹UTF-16 ç¼–ç æ–¹å¼è§„å®šç”¨ä¸¤ä¸ªæˆ–å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ‰€æœ‰çš„å­—ç¬¦ã€‚å¯¹äº ASCII å­—ç¬¦ä¿æŒä¸å˜ï¼Œåªæ˜¯å°†åŸæ¥çš„ 7 ä½æ‰©å±•åˆ°äº† 16 ä½ï¼Œå…¶é«˜ 9 ä½æ°¸è¿œæ˜¯ 0ã€‚å¦‚å­—ç¬¦â€™Aâ€™ï¼š 12ASCII: 100 0001UTF-16: 0000 0000 0100 0001 å¯ä»¥çœ‹åˆ°å¯¹äº ASCII å­—ç¬¦ï¼ŒUTF-16 çš„å­˜å‚¨ç©ºé—´æ‰©å¤§äº†ä¸€å€ï¼ŒUTF-16 å¹¶ä¸æ˜¯å®Œå…¨å…¼å®¹ ASCII å­—ç¬¦é›†ã€‚è¿™å¯¹äºé‚£äº› ASCII å­—ç¬¦é›†å·²ç»æ»¡è¶³éœ€æ±‚çš„è¥¿æ–¹å›½å®¶æ¥è¯´å®Œå…¨æ˜¯æ²¡å¿…è¦çš„ï¼Œè€Œä¸” ASCII å­—ç¬¦ç»è¿‡ UTF-16 ç¼–ç ä¹‹åé«˜å­—èŠ‚å§‹ç»ˆæ˜¯ 0ï¼Œå¯¼è‡´å¾ˆå¤š C è¯­è¨€å‡½æ•°ï¼ˆå¦‚strcpy,strlen)ä¼šå°†æ­¤å­—èŠ‚è§†ä¸ºå­—ç¬¦ä¸²çš„ç»“æŸç¬¦&#39;\\0&#39;ï¼Œä»è€Œå‡ºç°é”™è¯¯çš„è®¡ç®—ç»“æœã€‚è€Œä¸”ï¼ŒUTF-16 è¿˜å­˜åœ¨å¤§å°ç«¯çš„é—®é¢˜ï¼Œâ€œğ¤­¢â€ï¼ˆå¿µ suÃ¬ï¼‰Unicode ç åœ¨å¤§ç«¯ç³»ç»Ÿä¸Šä¸ºD852 DF62ï¼Œå°ç«¯ç³»ç»Ÿä¸Šä¸º52D8 62DFã€‚å› æ­¤ï¼ŒUTF-16 ä¸€å¼€å§‹æ¨å‡ºçš„æ—¶å€™å°±é­åˆ°å¾ˆå¤šè¥¿æ–¹å›½å®¶çš„æŠµåˆ¶ï¼Œå½±å“äº† Unicode çš„æ¨è¡Œã€‚äºæ˜¯åæ¥åˆè®¾è®¡äº† UTF-8 ç¼–ç æ–¹å¼ï¼Œæ‰è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ 3.5. Unicode å­—ç¬¦é›†å¸¸ç”¨ç¼–ç æ–¹å¼ï¼šUTF-83.5.1 UTF-8 æ¦‚è¿°UTF-8 æ˜¯äº’è”ç½‘ä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„ Unicode å­—ç¬¦é›†ç¼–ç æ–¹å¼ã€‚UTF-8 ç¼–ç çš„æœ€å°å•ä½ç”± 8 ä½ï¼ˆ1 ä¸ªå­—èŠ‚ï¼‰ç»„æˆï¼ŒUTF-8 ä½¿ç”¨ä¸€ä¸ªè‡³å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤º Unicode å­—ç¬¦ã€‚å¦å¤–ï¼ŒUTF-8 æ˜¯å®Œç¾å…¼å®¹ ASCII å­—ç¬¦é›†çš„ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ä¸‹é¢çš„ UTF-8 çš„ç¼–ç è§„åˆ™å¾—åˆ°è¯æ˜ã€‚ 3.5.2 UTF-8 ç¼–ç è§„åˆ™UTF-8 ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼šï¼ˆ1ï¼‰å¯¹äº ASCIIï¼ˆå•å­—èŠ‚å­—ç¬¦ï¼‰å­—ç¬¦ï¼Œé‡‡ç”¨å’Œ ASCII ç›¸åŒçš„ç¼–ç æ–¹å¼ï¼Œå³åªä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸”è¯¥å­—èŠ‚ç¬¬ä¸€ä½ä¸º 0.ï¼ˆ2ï¼‰å¯¹äºå¤šå­—èŠ‚ï¼ˆ2~4 å­—èŠ‚ï¼‰å­—ç¬¦ï¼Œå‡è®¾å­—èŠ‚æ•°ä¸º nï¼ˆ1 &lt; n &lt;&#x3D; 4ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ï¼šå‰ n ä½éƒ½è®¾ä¸º 1ï¼Œç¬¬ n+1 ä½è®¾ä¸º 0ï¼›åé¢çš„ n-1 ä¸ªå­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º 10ã€‚æ‰€æœ‰å­—èŠ‚ä¸­çš„æ²¡æœ‰æåŠçš„å…¶ä»–äºŒè¿›åˆ¶ä½ï¼Œå…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„ unicode ç ã€‚ Unicode ç¬¦å·èŒƒå›´(åå…­è¿›åˆ¶) UTF-8 ç¼–ç æ–¹å¼(äºŒè¿›åˆ¶) å•å­—èŠ‚:00000000-0000 007F 0xxxxxxx åŒå­—èŠ‚:00000080-0000 07FF 110xxxxx 10xxxxxx ä¸‰å­—èŠ‚:00000800-0000 FFFF 1110xxxx 10xxxxxx 10xxxxxx å››å­—èŠ‚:0001 0000-0010 FFFF 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx 3.5.2 UTF-8 BOMBOMï¼ˆbyte order markï¼‰ä»å­—é¢æ„ä¹‰æ¥çœ‹æ˜¯æ ‡è®°å­—èŠ‚é¡ºåºçš„ã€‚æœ€æ—©å‡ºç°çš„åŸå› æ˜¯å› ä¸º UTF-16 å’Œ UTF-32 ç¼–ç é‡‡ç”¨ 2 ä¸ªæˆ– 4 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œé¢ä¸´å¤§å°ç«¯çš„é—®é¢˜ã€‚ä¸ºäº†åŒºåˆ†æ˜¯ä½¿ç”¨çš„å¤§ç«¯(Big Endianï¼Œç®€ç§° BE)è¿˜æ˜¯å°ç«¯(Little Endianï¼Œç®€ç§° LE)ï¼Œé‡‡ç”¨äº†åœ¨ä¸²çš„å‰é¢åŠ å…¥æŒ‡å®šçš„å­—èŠ‚åŠ ä»¥åŒºåˆ†ï¼ŒUTF-16 å¤§ç«¯åŠ å…¥FE FFï¼Œå°ç«¯åŠ å…¥FF FE. æ¯”å¦‚ï¼Œ å­—ç¬¦ä¸²â€œABCâ€çš„ UTF-16 ç¼–ç ä¸º 00 41 00 42 00 43ï¼Œå¯¹åº”çš„å„ç§çš„å­—èŠ‚åºåˆ—å¦‚ä¸‹ï¼š åºåˆ— æ•°æ® UTF-16BE(withoutBOM) 00 41 00 42 00 43 UTF-16LE(withoutBOM) 41 00 42 00 43 00 UTF-16BE(with BOM) FE FF 00 41 00 42 00 43 UTF-16LE(with BOM) FF FE 41 00 42 00 43 00 å› ä¸º UTF-8 å’Œ ASCII éƒ½æ˜¯å•å­—èŠ‚åºåˆ—ï¼ŒäºŒè€…ä¸å¥½åŒºåˆ†ï¼Œå¾®è½¯é‡‡ç”¨åœ¨ UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²å‰ä¹ŸåŠ å…¥ BOMï¼ˆ3 ä¸ªå­—èŠ‚EF BB BFï¼‰æ¥æ ‡è®° UTF-8 ç¼–ç çš„ä¸²ã€‚UTF-8 BOM è¿™ä¸€è§„èŒƒå¤§å¤šåœ¨ windows ä¸‹è¢«ä½¿ç”¨ï¼Œåœ¨å…¶ä»–å¹³å°ä¸‹ç”¨çš„å¾ˆå°‘ä½¿ç”¨ï¼Œå¦‚ï¼šLinux å…¨éƒ¨é‡‡ç”¨ UTF-8 ç¼–ç ï¼Œä¸å­˜åœ¨è¦åŒºåˆ†çš„æƒ…å†µï¼›HTTP åè®®ä¸­å¯ä»¥åŒ…å«Content-Type:text/html; charset=utf-8è¿™æ ·çš„è¯´æ˜ï¼Œä¹Ÿä¸éœ€è¦åŒºåˆ†ã€‚ æ–‡ç« å›¾ç‰‡å¸¦æœ‰â€œCSDNâ€æ°´å°çš„è¯´æ˜ï¼šç”±äºè¯¥æ–‡ç« å’Œå›¾ç‰‡æœ€åˆå‘è¡¨åœ¨æˆ‘çš„CSDN åšå®¢ä¸­ï¼Œå› æ­¤å›¾ç‰‡è¢« CSDN è‡ªåŠ¨æ·»åŠ äº†æ°´å°ã€‚","tags":["å­—ç¬¦ç¼–ç ","ANSI","UTF8"],"categories":["å­—ç¬¦ç¼–ç "]},{"title":"SQLæ‰¹é‡æ·»åŠ æ›´æ–°å’Œåˆ é™¤","path":"/post/2842059394.html","content":"æ‰¹é‡æ’å…¥1INSERT INTO users(name, age) VALUES(&#x27;å§šæ˜&#x27;, 25), (&#x27;æ¯”å°”.ç›–èŒ¨&#x27;, 50), (&#x27;ç«æ˜Ÿäºº&#x27;, 600); æ‰¹é‡æ›´æ–°1UPDATE member SET descipt = &quot;é»˜è®¤&quot; WHERE usertypeid IN (1,2,3,4); 1234567UPDATE member SET descipt = CASE id WHEN 1 THEN &#x27;é»˜è®¤&#x27; WHEN 2 THEN &#x27;é»„é“œ&#x27; WHEN 3 THEN &#x27;é»„é‡‘&#x27; END WHERE id IN (1,2,3); æ‰¹é‡åˆ é™¤1DELETE FROM users WHERE id IN (1,2,3,4);","tags":["MySQL","SQL"],"categories":["æ•°æ®åº“","MySQL"]},{"title":"P2PåŠNATç©¿é€æŠ€æœ¯ä»‹ç»","path":"/post/2441416675.html","content":"ä¸€ã€ P2Pï¼ˆpeer to peerï¼‰P2P æ˜¯ä¸€ä¸ªâ€œç‚¹å¯¹ç‚¹ä¼ è¾“æŠ€æœ¯â€ï¼Œä¹Ÿå°±æ˜¯ 2 å°è®¡ç®—æœºä¹‹é—´ä¸éœ€è¦ç¬¬ä¸‰å°æœºå™¨ä½œä¸ºæœåŠ¡ç«¯å°±èƒ½å®ç°æ•°æ®çš„ä¼ è¾“ã€‚æ¯å°è®¡ç®—æœºå³æ˜¯å®¢æˆ·ç«¯åˆæ˜¯æœåŠ¡ç«¯ã€‚å¦‚æœæ¯å°è®¡ç®—æœºéƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„å…¬ç½‘ IPï¼Œé‚£ä¹ˆ P2P æŠ€æœ¯å°±æ¯”è¾ƒå¥½å®ç°äº†ï¼Œä½†æ˜¯ç°å®ä¸­ç”±äº NAT çš„å­˜åœ¨ï¼Œä½¿å¾— P2P æŠ€æœ¯æœ€å¤§çš„éš¾ç‚¹å°±åœ¨äºç©¿è¶Š NAT çš„é™åˆ¶ï¼Œä¿—ç§°â€œæ‰“æ´â€ã€‚ äºŒã€ NATï¼ˆNetwork Address Translationï¼‰2.1 NAT çš„äº§ç”ŸèƒŒæ™¯IPv4 å³ç½‘é™…ç½‘åè®®ç¬¬ 4 ç‰ˆâ€”â€”Internet Protocol Version 4 çš„ç¼©å†™ã€‚å¦‚æœæˆ‘ä»¬æŠŠ Internet æ¯”ä½œä¸€ä¸ªé‚®æ”¿ç³»ç»Ÿï¼Œé‚£ä¹ˆ IP åœ°å€çš„ä½œç”¨å°±ç­‰åŒäºåŒ…å«åŸå¸‚ã€è¡—åŒºã€é—¨ç‰Œç¼–å·åœ¨å†…çš„å®Œæ•´åœ°å€ï¼Œå¯ä»¥å‡†ç¡®çš„å®šä½åˆ°æŸä¸€å°è®¡ç®—æœºã€‚IPv4 ä½¿ç”¨ 32bits æ•´æ•°è¡¨è¾¾ä¸€ä¸ªåœ°å€ï¼Œåœ°å€æœ€å¤§èŒƒå›´å°±æ˜¯ 232 çº¦ä¸º 43 äº¿ã€‚ä»¥ IP åˆ›å§‹æ—¶æœŸå¯è¢«è”ç½‘çš„è®¾å¤‡æ¥çœ‹ï¼Œè¿™æ ·çš„ä¸€ä¸ªç©ºé—´å·²ç»å¾ˆå¤§ï¼Œå¾ˆéš¾è¢«çŸ­æ—¶é—´ç”¨å®Œã€‚ç„¶è€Œï¼Œäº‹å®è¿œè¿œè¶…å‡ºäººä»¬çš„è®¾æƒ³ï¼Œè®¡ç®—æœºç½‘ç»œåœ¨æ­¤åçš„å‡ åå¹´é‡Œè¿…é€Ÿå£®å¤§ï¼Œç½‘ç»œç»ˆç«¯æ•°é‡ä¹Ÿå‘ˆçˆ†ç‚¸æ€§å¢é•¿ã€‚ æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œä¸ºäº†è·¯ç”±å’Œç®¡ç†æ–¹ä¾¿ï¼Œ43 äº¿çš„åœ°å€ç©ºé—´è¢«æŒ‰ç…§ä¸åŒå‰ç¼€é•¿åº¦åˆ’åˆ†ä¸º A,B,C,D ç±»åœ°å€ç½‘ç»œå’Œä¿ç•™åœ°å€ã€‚IANA å‘è¶…å¤§å‹ä¼ä¸š&#x2F;ç»„ç»‡åˆ†é… A ç±»ç½‘ç»œåœ°å€ï¼Œä¸€æ¬¡ä¸€æ®µã€‚å‘ä¸­å‹ä¼ä¸šæˆ–æ•™è‚²æœºæ„åˆ†é… B ç±»ç½‘ç»œåœ°å€ï¼Œä¸€æ¬¡ä¸€æ®µã€‚è¿™æ ·ä¸€ç§åˆ†é…ç­–ç•¥ä½¿å¾— IP åœ°å€æµªè´¹å¾ˆä¸¥é‡ï¼Œå¾ˆå¤šè¢«åˆ†é…å‡ºå»çš„åœ°å€æ²¡æœ‰çœŸå®è¢«åˆ©ç”¨ï¼Œåœ°å€æ¶ˆè€—å¾ˆå¿«ã€‚ä»¥è‡³äºäºŒåä¸–çºª 90 å¹´ä»£åˆï¼Œç½‘ç»œä¸“å®¶ä»¬æ„è¯†åˆ°ï¼Œè¿™æ ·å¤§æ‰‹å¤§è„šä¸‹å»ï¼ŒIPv4 åœ°å€å¾ˆå¿«å°±è¦è€—å…‰äº†ã€‚äºæ˜¯ï¼Œäººä»¬å¼€å§‹è€ƒè™‘ IPv4 çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒåŒæ—¶é‡‡å–ä¸€ç³»åˆ—çš„æªæ–½æ¥å‡ç¼“ IPv4 åœ°å€çš„æ¶ˆè€—ã€‚æ­£æ˜¯åœ¨è¿™æ ·ä¸€ä¸ªèƒŒæ™¯ä¹‹ä¸‹ï¼ŒNAT åº”è¿è€Œç”Ÿã€‚ 2.2 NATNATï¼ˆNetwork Address Translationï¼‰ç½‘ç»œåœ°å€è½¬æ¢ï¼Œå°±æ˜¯åœ¨å†…ç½‘ IP å’Œå…¬ç½‘ IP ä¹‹å‰ç›¸äº’è½¬æ¢ã€‚NAT é€šå¸¸éƒ¨ç½²åœ¨ä¸€ä¸ªç»„ç»‡çš„ç½‘ç»œå‡ºå£ä½ç½®ã€‚ 2.2.1 ä»€ä¹ˆæ˜¯å†…éƒ¨ç½‘ç»œåœ°å€ï¼ˆå†…ç½‘ IPï¼‰ï¼ŸRFC1918 è§„å®šäº†ä¸‰ä¸ªä¿ç•™åœ°å€æ®µè½ï¼Œè¿™ä¸‰ä¸ªèŒƒå›´åˆ†åˆ«å¤„äº A,B,C ç±»çš„åœ°å€æ®µï¼Œä¸å‘ç‰¹å®šçš„ç”¨æˆ·åˆ†é…ï¼Œè¢« IANA ä½œä¸ºç§æœ‰åœ°å€ä¿ç•™ã€‚è¿™äº›åœ°å€å¯ä»¥åœ¨ä»»ä½•ç»„ç»‡æˆ–ä¼ä¸šå†…éƒ¨ä½¿ç”¨ã€‚å’Œå…¶ä»– IPv4 åœ°å€çš„åŒºåˆ«å°±æ˜¯ï¼Œä»…èƒ½åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œä¸èƒ½ä½œä¸ºå…¨çƒè·¯ç”±åœ°å€ã€‚è¿™å°±æ˜¯è¯´ï¼Œå‡ºäº†ç»„ç»‡çš„ç®¡ç†èŒƒå›´è¿™äº›åœ°å€å°±ä¸å†æœ‰æ„ä¹‰ï¼Œæ— è®ºæ˜¯ä½œä¸ºæºåœ°å€ï¼Œè¿˜æ˜¯ç›®çš„åœ°å€ã€‚å¯¹äºä¸€ä¸ªå°é—­çš„ç»„ç»‡ï¼Œå¦‚æœå…¶ç½‘ç»œä¸è¿æ¥åˆ°å¤–éƒ¨ Internetï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™äº›åœ°å€è€Œä¸ç”¨å‘ IANA æå‡ºç”³è¯·ï¼Œè€Œåœ¨å†…éƒ¨çš„è·¯ç”±ç®¡ç†å’ŒæŠ¥æ–‡ä¼ é€’æ–¹å¼ä¸å…¶ä»–ç½‘ç»œæ²¡æœ‰å·®å¼‚ã€‚ 12310.0.0.0-10.255.255.255172.16.0.0-172.31.255.255192.168.0.0-192.168.255.255 å¯¹äºæœ‰ Internet è®¿é—®éœ€æ±‚è€Œå†…éƒ¨åˆä½¿ç”¨ç§æœ‰åœ°å€çš„ç½‘ç»œï¼Œå°±è¦åœ¨ç»„ç»‡çš„å‡ºå£ä½ç½®éƒ¨ç½² NAT ç½‘å…³ï¼Œåœ¨æŠ¥æ–‡ç¦»å¼€ç§ç½‘è¿›å…¥ Internet æ—¶ï¼Œå°†æº IP æ›¿æ¢ä¸ºå…¬ç½‘åœ°å€ï¼Œé€šå¸¸æ˜¯å‡ºå£è®¾å¤‡çš„æ¥å£åœ°å€ã€‚ä¸€ä¸ªå¯¹å¤–çš„è®¿é—®è¯·æ±‚åœ¨åˆ°è¾¾ç›®æ ‡ä»¥åï¼Œè¡¨ç°ä¸ºç”±æœ¬ç»„ç»‡å‡ºå£è®¾å¤‡å‘èµ·ï¼Œå› æ­¤è¢«è¯·æ±‚çš„æœåŠ¡ç«¯å¯å°†å“åº”å†…å®¹ç”± Internet å‘å›åˆ°å‡ºå£ç½‘å…³ã€‚å‡ºå£ç½‘å…³å†å°†ç›®çš„åœ°å€æ›¿æ¢ä¸ºç§ç½‘çš„æºä¸»æœºåœ°å€ï¼Œå‘å›å†…éƒ¨ã€‚è¿™æ ·ä¸€æ¬¡ç”±ç§ç½‘ä¸»æœºå‘å…¬ç½‘æœåŠ¡ç«¯çš„è¯·æ±‚å’Œå“åº”å°±åœ¨é€šä¿¡ä¸¤ç«¯å‡æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®Œæˆäº†ã€‚ä¾æ®è¿™ç§æ¨¡å‹ï¼Œæ•°é‡åºå¤§çš„å†…ç½‘ä¸»æœºå°±ä¸å†éœ€è¦å…¬æœ‰ IP åœ°å€äº†ã€‚ 2.2.2 NAT åˆ†ç±» å…¨é”¥å½¢ NATï¼ˆFull Cone NATï¼‰ä¸€æ—¦å†…éƒ¨ä¸»æœºç«¯å£å¯¹(iAddr:iPort)è¢« NAT ç½‘å…³æ˜ å°„åˆ°(eAddr:ePort)ï¼Œæ‰€æœ‰åç»­çš„(iAddr:iPort)æŠ¥æ–‡éƒ½ä¼šè¢«è½¬æ¢ä¸º(eAddr:ePort)ï¼›ä»»ä½•ä¸€ä¸ªå¤–éƒ¨ä¸»æœºå‘é€åˆ°(eAddr:ePort)çš„æŠ¥æ–‡å°†ä¼šè¢«è½¬æ¢åå‘åˆ°(iAddr:iPort)ã€‚ é™åˆ¶é”¥å½¢ NATï¼ˆRestricted Cone NATï¼‰ä¸€æ—¦å†…éƒ¨ä¸»æœºç«¯å£å¯¹(iAddr:iPort)è¢«æ˜ å°„åˆ°(eAddr:ePort)ï¼Œæ‰€æœ‰åç»­çš„(iAddr:iPort)æŠ¥æ–‡éƒ½ä¼šè¢«è½¬æ¢ä¸º(eAddr:ePort)ï¼›åªæœ‰ (iAddr:iPort)å‘ç‰¹å®šçš„å¤–éƒ¨ä¸»æœº hAddr å‘é€è¿‡æ•°æ®ï¼Œä¸»æœº hAddr ä»ä»»æ„ç«¯å£å‘é€åˆ°(eAddr:ePort)çš„æŠ¥æ–‡å°†ä¼šè¢«è½¬å‘åˆ°(iAddr:iPort)ã€‚ ç«¯å£é™åˆ¶é”¥å½¢ NATï¼ˆPort Restricted Cone NATï¼‰ä¸€æ—¦å†…éƒ¨ä¸»æœºç«¯å£å¯¹(iAddr:iPort)è¢«æ˜ å°„åˆ°(eAddr:ePort)ï¼Œæ‰€æœ‰åç»­çš„(iAddr:iPort)æŠ¥æ–‡éƒ½ä¼šè¢«è½¬æ¢ä¸º(eAddr:ePort)ï¼›åªæœ‰(iAddr:iPort)å‘ç‰¹å®šçš„å¤–éƒ¨ä¸»æœºç«¯å£å¯¹(hAddr:hPort)å‘é€è¿‡æ•°æ®ï¼Œç”± (hAddr:hPort)å‘é€åˆ°(eAddr:ePort)çš„æŠ¥æ–‡å°†ä¼šè¢«è½¬å‘åˆ°(iAddr:iPort)ã€‚ å¯¹ç§°å‹ NATï¼ˆSymmetric NATï¼‰NAT ç½‘å…³ä¼šæŠŠå†…éƒ¨ä¸»æœºâ€œåœ°å€ç«¯å£å¯¹â€å’Œå¤–éƒ¨ä¸»æœºâ€œåœ°å€ç«¯å£å¯¹â€å®Œå…¨ç›¸åŒçš„æŠ¥æ–‡çœ‹ä½œä¸€ä¸ªè¿æ¥ï¼Œåœ¨ NAT ç½‘å…³ä¸Šåˆ›å»ºä¸€ä¸ªå…¬ç½‘â€œåœ°å€ç«¯å£å¯¹â€æ˜ å°„è¿›è¡Œè½¬æ¢ï¼Œåªæœ‰æ”¶åˆ°æŠ¥æ–‡çš„å¤–éƒ¨ä¸»æœºä»å¯¹åº”çš„ç«¯å£å¯¹å‘é€å›åº”çš„æŠ¥æ–‡ï¼Œæ‰èƒ½è¢«è½¬æ¢ã€‚å³ä½¿å†…éƒ¨ä¸»æœºä½¿ç”¨ä¹‹å‰ç”¨è¿‡çš„åœ°å€ç«¯å£å¯¹å»è¿æ¥ä¸åŒå¤–éƒ¨ä¸»æœº(æˆ–ç«¯å£)æ—¶ï¼ŒNAT ç½‘å…³ä¹Ÿä¼šå»ºç«‹æ–°çš„æ˜ å°„å…³ç³»ã€‚ ä¸‰ã€ NAT ç©¿è¶ŠæŠ€æœ¯å¸¸è§çš„ NAT ç©¿è¶ŠæŠ€æœ¯æœ‰ï¼šSTUNã€TURNã€ICEã€‚ 3.1 STUNï¼ˆSession Traversal Utileties for NATï¼‰åœ¨RFC3489å’ŒRFC5389ä¸­çš„åç§°éƒ½æ˜¯ STUNï¼Œä½†å…¶å…¨ç§°æ˜¯ä¸åŒçš„ã€‚åœ¨ RFC3489 é‡Œï¼ŒSTUN çš„å…¨ç§°æ˜¯ Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs)ï¼Œ å³ç©¿è¶Š NAT çš„ç®€å• UDP ä¼ è¾“ï¼Œæ˜¯ä¸€ä¸ªè½»é‡çº§çš„åè®®ï¼Œå…è®¸åº”ç”¨ç¨‹åºå‘ç°è‡ªå·±å’Œå…¬ç½‘ä¹‹é—´çš„ä¸­é—´ä»¶ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿèƒ½å…è®¸åº”ç”¨ç¨‹åºå‘ç°è‡ªå·±è¢« NAT åˆ†é…çš„å…¬ç½‘ IPã€‚è¿™ä¸ªåè®®åœ¨ 2003 å¹´ 3 æœˆè¢«æå‡ºï¼Œç›®å‰å·²ç»è¢« STUN&#x2F;RFC5389 æ‰€æ›¿ä»£ã€‚ ä½†åœ¨ RFC5389 ä¸­ï¼ŒSTUN çš„å…¨ç§°å˜ä¸º Session Traversal Utilities for NATï¼Œå³ NAT ç¯å¢ƒä¸‹çš„ä¼šè¯ä¼ è¾“å·¥å…·ï¼Œæ˜¯ä¸€ç§å¤„ç† NAT ä¼ è¾“çš„åè®®ï¼Œä½†ä¸»è¦ä½œä¸ºä¸€ä¸ªå·¥å…·æ¥æœåŠ¡äºå…¶ä»–åè®®ã€‚å’Œ STUN&#x2F;RFC3489 ç±»ä¼¼ï¼Œå¯ä»¥è¢«ç»ˆç«¯ç”¨æ¥å‘ç°å…¶å…¬ç½‘ IP å’Œç«¯å£ï¼ŒåŒæ—¶å¯ä»¥æ£€æµ‹ç«¯ç‚¹é—´çš„è¿æ¥æ€§ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§ä¿æ´»ï¼ˆkeep-aliveï¼‰åè®®æ¥ç»´æŒ NAT çš„ç»‘å®šã€‚å’Œ RFC3489 æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºï¼ŒSTUN æœ¬èº«ä¸å†æ˜¯ä¸€ä¸ª å®Œæ•´çš„ NAT ä¼ è¾“è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯åœ¨ NAT ä¼ è¾“ç¯å¢ƒä¸­ä½œä¸ºä¸€ä¸ªè¾…åŠ©çš„è§£å†³æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº† TCP çš„æ”¯æŒã€‚RFC5389 åºŸå¼ƒäº† RFC3489ï¼Œå› æ­¤åè€…é€šå¸¸ç§°ä¸º classic STUNï¼Œä½†ä¾æ—§æ˜¯åå‘å…¼å®¹çš„ã€‚STUN æ˜¯ä¸€ç§ Client&#x2F;Server çš„åè®®ï¼Œä¹Ÿæ˜¯ä¸€ç§ Request&#x2F;Response çš„åè®®ï¼Œé»˜è®¤ç«¯å£å·æ˜¯ 3478ã€‚ STUN å®Œæ•´çš„å®šä¹‰å‚è€ƒï¼šRFC5398 3.2 TURNï¼ˆTraversal Using Relay NATï¼‰Traversal Using Relay NAT å³ä½¿ç”¨ä¸­ç»§ç©¿é€ NATï¼ŒSTUN çš„ä¸­ç»§æ‰©å±•ã€‚ç®€å•çš„è¯´ï¼ŒTURN ä¸ STUN çš„å…±åŒç‚¹éƒ½æ˜¯é€šè¿‡ä¿®æ”¹åº”ç”¨å±‚ä¸­çš„ç§ç½‘åœ°å€è¾¾åˆ° NAT ç©¿é€çš„æ•ˆæœï¼Œå¼‚åŒç‚¹æ˜¯ TURN æ˜¯é€šè¿‡ä¸¤æ–¹é€šè®¯çš„â€œä¸­é—´äººâ€æ–¹å¼å®ç°ç©¿é€ã€‚ TURN å®Œæ•´çš„å®šä¹‰å‚è€ƒï¼šRFC5766 3.3 ICEï¼ˆInteractive Connectivity Establishmentï¼‰Interactive Connectivity Establishment å³äº’åŠ¨å¼è¿æ¥å»ºç«‹ï¼Œç”± IETF çš„ MMUSIC å·¥ä½œç»„å¼€å‘å‡ºæ¥çš„ï¼Œå®ƒæ‰€æä¾›çš„æ˜¯ä¸€ç§æ¡†æ¶ï¼Œä½¿å„ç§ NAT ç©¿é€æŠ€æœ¯å¯ä»¥å®ç°ç»Ÿä¸€ã€‚ICE è·Ÿ STUN å’Œ TURN ä¸ä¸€æ ·ï¼ŒICE ä¸æ˜¯ä¸€ç§åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼ˆFrameworkï¼‰ï¼Œå®ƒæ•´åˆäº† STUN å’Œ TURNã€‚ ICE å®Œæ•´çš„å®šä¹‰å‚è€ƒï¼šRFC5245 å‚è€ƒï¼šP2P æŠ€æœ¯è¯¦è§£(ä¸€)ï¼šNAT è¯¦è§£â€”â€”è¯¦ç»†åŸç†ã€P2P ç®€ä»‹ &gt; P2P æŠ€æœ¯è¯¦è§£(äºŒ)ï¼šP2P ä¸­çš„ NAT ç©¿è¶Š(æ‰“æ´)æ–¹æ¡ˆè¯¦è§£ &gt; P2P æŠ€æœ¯è¯¦è§£(ä¸‰)ï¼šP2P æŠ€æœ¯ä¹‹ STUNã€TURNã€ICE è¯¦è§£","tags":["WebRTC","P2P","TURN","ICE","NAT"],"categories":["éŸ³è§†é¢‘ç¼–ç¨‹"]},{"title":"MySQLè·å–æ—¶é—´å’Œæ—¥æœŸ","path":"/post/3556253141.html","content":"ä¸€ã€ æ—¶é—´ã€æ—¥æœŸè·å–1.1 è·å–å½“å‰æœ¬åœ°çš„æ—¥æœŸå’Œæ—¶é—´123456SELECT NOW(), CURRENT_TIMESTAMP(), LOCALTIME(), LOCALTIMESTAMP(), SYSDATE(); ä¸Šé¢5ä¸ªå‡½æ•°éƒ½å¯ä»¥è·å–å½“å‰æœ¬åœ°æ—¶é—´ï¼Œä½†SYSDATEæœ‰æ‰€ä¸åŒã€‚ 1SELECT NOW(), SLEEP(3), NOW(); æ‰§è¡Œç»“æœï¼š 12NOW() sleep(3) NOW()2017-11-09 17:21:09 0 2017-11-09 17:21:09 è™½ç„¶sleepäº†3ç§’ï¼Œä½†NOW()å‰å2æ¬¡è·å–åˆ°æ—¶é—´æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´NOW()å‡½æ•°è·å–çš„æ—¶é—´æ˜¯åœ¨æ•´ä¸ªSQLè¯­å¥å¼€å§‹æ‰§è¡Œæ—¶çš„æ—¶é—´ï¼Œæ— è®ºSQLè¯­å¥ä¸­æœ‰å¤šå°‘ä¸ªNOW()å‡½æ•°ï¼Œè·å–åˆ°çš„æ—¶é—´éƒ½æ˜¯ä¸€æ ·çš„ã€‚CURRENT_TIMESTAMP(), LOCALTIME(), LOCALTIMESTAMP()å’ŒNOW()å‡½æ•°ä¸€æ ·ã€‚ ä½†SYSDATEä¸åŒï¼Œå®ƒè·å–åˆ°çš„æ˜¯SYSDATE()å‡½æ•°æ‰§è¡Œæ—¶çš„å®æ—¶æ—¶é—´ï¼š 1SELECT SYSDATE(), SLEEP(3), SYSDATE(); æ‰§è¡Œç»“æœï¼š 12SYSDATE() sleep(3)\tSYSDATE()2017-11-09 17:25:05 0 2017-11-09 17:25:08 1.2 è·å–å½“å‰æœ¬åœ°çš„æ—¥æœŸ123SELECT CURDATE(), CURRENT_DATE(); 1.3 è·å–å½“å‰æœ¬åœ°çš„æ—¶é—´123SELECT CURTIME(), CURRENT_TIME(); 1.4 è·å–å½“å‰UTCæ—¥æœŸå’Œæ—¶é—´12SELECT UTC_TIMESTAMP(); 1.5 è·å–å½“å‰UTCæ—¥æœŸ12SELECT UTC_DATE(); 1.6 è·å–å½“å‰UTCæ—¶é—´12SELECT UTC_TIME(); 1.7 è·å–æ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´ç»è¿‡çš„ç§’ï¼‰12SELECT UNIX_TIMESTAMP(); -- å½“å‰æ—¶é—´æ—¶é—´æˆ³SELECT UNIX_TIMESTAMP(&#x27;2017-11-09 12:30:00&#x27;); -- è‡ª1970å¹´åˆ°2017-11-09 12:30:00ç»è¿‡çš„ç§’æ•° äºŒã€ æ—¶é—´æ“ä½œ2.1 ä»å­—ç¬¦ä¸²æå–æ—¶é—´å’Œæ—¥æœŸ12345678910111213SET @dt = &#x27;2008-09-10 07:15:30.123456&#x27;;SELECT DATE(@dt); -- 2008-09-10SELECT TIME(@dt); -- 07:15:30.123456SELECT YEAR(@dt); -- 2008SELECT QUARTER(@dt); -- 3SELECT MONTH(@dt); -- 9SELECT WEEK(@dt); -- 36SELECT DAY(@dt); -- 10SELECT HOUR(@dt); -- 7SELECT MINUTE(@dt); -- 15SELECT SECOND(@dt); -- 30SELECT MICROSECOND(@dt); -- 123456 2.2 è·å–æŸå¤©åœ¨å‘¨ã€æœˆã€å¹´ä¸­æ‰€å¤„ä½ç½®12345SET @dt = &#x27;2017-11-09&#x27;;SELECT DAYOFWEEK(@dt); -- 5 æ˜ŸæœŸæ—¥ä¸º0ï¼Œ5ä»£è¡¨æ˜ŸæœŸå››SELECT DAYOFMONTH(@dt); -- 9 ä¸€ä¸ªæœˆçš„ç¬¬9å¤©SELECT DAYOFYEAR(@dt); -- 313 2017å¹´çš„ç¬¬313å¤© 2.3 è·å–æŒ‡å®šæ—¥æœŸçš„æœ€åä¸€å¤©1SELECT LAST_DAY(&#x27;2017-02-05&#x27;); -- 2017-02-28 2.4 æ—¶é—´åŠ å‡123456789101112SET @dt = &quot;2017-11-09 17:10:20.0000001&quot;;SELECT DATE_ADD(@dt, INTERVAL 1 DAY); -- åŠ 1å¤©SELECT DATE_ADD(@dt, INTERVAL 2 HOUR); -- åŠ 2å°æ—¶SELECT DATE_ADD(@dt, INTERVAL 1 MINUTE); -- åŠ 1åˆ†é’ŸSELECT DATE_ADD(@dt, INTERVAL 1 SECOND);SELECT DATE_ADD(@dt, INTERVAL 1 MICROSECOND); -- åŠ 1å¾®å¦™SELECT DATE_ADD(@dt, INTERVAL 1 WEEK); -- åŠ 1å‘¨SELECT DATE_ADD(@dt, INTERVAL 1 MONTH);SELECT DATE_ADD(@dt, INTERVAL 1 QUARTER); -- åŠ 1ä¸ªå­£åº¦SELECT DATE_ADD(@dt, INTERVAL 1 YEAR);SELECT DATE_ADD(@dt, INTERVAL -1 DAY); -- å‡1å¤© 2.5 ä¸¤ä¸ªæ—¥æœŸã€æ—¶é—´åŠ å‡12SELECT DATEDIFF(&#x27;2008-08-08&#x27;, &#x27;2008-08-01&#x27;); -- 7SELECT DATEDIFF(&#x27;2008-08-01&#x27;, &#x27;2008-08-08&#x27;); -- -7 ç¬¬ä¸€ä¸ªå‚æ•°å‡å»ç¬¬äºŒä¸ªå‚æ•° 12SELECT TIMEDIFF(&#x27;2008-08-08 08:08:08&#x27;, &#x27;2008-08-08 00:00:00&#x27;); -- 08:08:08SELECT TIMEDIFF(&#x27;00:00:00&#x27;, &#x27;08:08:08&#x27;); -- -08:08:08 2.6 æ—¶é—´æ ¼å¼åŒ–123SELECT DATE_FORMAT(&#x27;2008-08-08 22:23:00&#x27;, &#x27;%W %M %Y&#x27;); -- Friday August 2008SELECT DATE_FORMAT(&#x27;2008-08-08 22:23:01&#x27;, &#x27;%Y%m%d%H%i%s&#x27;); -- 20080808222301SELECT TIME_FORMAT(&#x27;22:23:01&#x27;, &#x27;%H.%i.%s&#x27;); -- 22.23.01 2.7 ç§’è®¡ç®—è®¡ç®—æŒ‡å®šæ—¶é—´æŠ˜åˆå¤šå°‘ç§’ï¼Œå¦‚00:01:00è¡¨ç¤º1åˆ†é’Ÿï¼Œç­‰äº60ç§’ã€‚ 12SELECT TIME_TO_SEC(&#x27;01:00:05&#x27;); -- 3605SELECT SEC_TO_TIME(3605); -- &#x27;01:00:05&#x27;","tags":["MySQL"],"categories":["æ•°æ®åº“","MySQL"]},{"title":"MySQLè·å–å­—ç¬¦ä¸²é•¿åº¦çš„å‡ ç§æ–¹å¼","path":"/post/1446858454.html","content":"å¸¸ç”¨å‡½æ•°æœ‰char_lengthã€lengthã€bit_lengthï¼Œå®ƒä»¬é’ˆå¯¹ä¸åŒçš„å­—ç¬¦ç¼–ç å¤„ç†æ–¹å¼ä¸ä¸€æ ·ã€‚æ€»çš„æ¥è¯´ï¼šchar_lengthå­—ç¬¦æ˜¾ç¤ºçš„ä¸ªæ•°ï¼›length å­—ç¬¦åœ¨å½“å‰ç¼–ç ä¸‹å­˜å‚¨ï¼Œæ‰€å çš„å­—èŠ‚æ•°ã€‚bit_length å­—ç¬¦åœ¨å½“å‰ç¼–ç ä¸‹å­˜å‚¨ï¼Œæ‰€å çš„bitï¼Œä¹Ÿå°±æ˜¯length*8 GBK ç¼–ç 1234567select char_length(&#x27;ä¸­å›½&#x27;); -- 2select length(&#x27;ä¸­å›½&#x27;); -- 4select length(&#x27;china&#x27;); -- 5select bit_length(&#x27;ä¸­å›½&#x27;); --32 UTF-8 ç¼–ç 1234567select char_length(&#x27;ä¸­å›½&#x27;); -- 2select length(&#x27;ä¸­å›½&#x27;); -- 6select length(&#x27;china&#x27;); -- 5select bit_length(&#x27;ä¸­å›½&#x27;); -- 48","tags":["MySQL"],"categories":["æ•°æ®åº“","MySQL"]},{"title":"ç™½é…’å…¥é—¨","path":"/post/1855436935.html","content":"æ­£å€¼ 9 æœˆ 9 å…¨çƒé…’æ°´èŠ‚ï¼Œå„å¤§ç”µå•†éƒ½åœ¨åšæ´»åŠ¨ï¼Œè¶æœºç½‘è´­äº†ä¸€æ‰¹é…’æ°´ã€‚åœ¨äº«å—è¿™å¤§è‡ªç„¶é¦ˆèµ çš„ç¤¼ç‰©çš„åŒæ—¶ï¼Œä¹Ÿè¯´ä¸€è¯´è‡ªå·±å¯¹ç™½é…’çš„ç†è§£ã€‚å¸Œæœ›åœ¨äº†è§£äº†ç™½é…’çš„è¿™äº›çŸ¥è¯†åèƒ½æ˜æ˜ç™½ç™½å–é…’ã€‚ 1. ç™½é…’é…¿é€ å·¥è‰º1.1 ç²®é£Ÿé…’ä¸å‹¾å…‘é…’é¦–å…ˆï¼Œæ‰€æœ‰çš„ç™½é…’éƒ½æ˜¯ç²®é£Ÿç»è¿‡å‘é…µã€è’¸é¦è€Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç²®é£Ÿé…’ï¼Œè¿™ä¹Ÿå°è¯äº†äººä»¬å¸¸è¯´çš„â€œé…’æ˜¯ç²®é£Ÿç²¾ï¼Œè¶Šå–è¶Šå¹´è½»â€è¿™å¥è¯ã€‚ å› ä¸ºç™½é…’éƒ½è¦ç»è¿‡è’¸é¦è¿™ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿç§°ç™½é…’ä¸ºâ€œè’¸é¦é…’â€ã€‚ ä½†æˆ‘ä»¬å¸¸æåˆ°çš„â€œéç²®é£Ÿé…’â€æŒ‡çš„æ˜¯ç”¨é£Ÿç”¨é…’ç²¾ï¼ˆæœ‰çš„ç”šè‡³ç”¨çš„å·¥ä¸šé…’ç²¾ï¼‰å‹¾å…‘è€Œæˆçš„é…’ï¼Œæˆ‘è®¤ä¸ºè¿™ç§é…’ä¸¥æ ¼æ„ä¹‰ä¸Šå¯ä»¥ç§°ä¸ºâ€œå‡é…’â€(è™½ç„¶ä½¿ç”¨é£Ÿç”¨é…’ç²¾å‹¾å…‘åœ¨æ³•å¾‹ä¸Šæ˜¯è¢«å…è®¸çš„ï¼Œä¹Ÿå°±æ˜¯åé¢æåˆ°çš„æ¶²æ€å‘é…µé…’ã€‚æ³•å¾‹ç¦æ­¢ä½¿ç”¨å·¥ä¸šé…’ç²¾å‹¾å…‘é…’)ï¼Œå–äº†ä¹‹åå¯¹äººä½“æ²¡æœ‰ä»»ä½•å¥½å¤„ï¼Œæœ€å¤šåªèƒ½éº»ç—¹ç¥ç»ï¼ˆå·¥ä¸šé…’ç²¾å‹¾å…‘çš„é…’æ˜¯ç»å¯¹ä¸èƒ½å–çš„ï¼Œå·¥ä¸šé…’ç²¾æˆä»½æ˜¯ç”²é†‡ï¼Œå°‘é‡å°±ä¼šä½¿äººå¤±æ˜æˆ–è€…è‡´å‘½ï¼‰ã€‚ å¾ˆå¤šäººå¯¹â€œå‹¾å…‘â€äºŒå­—å¾ˆæ•æ„Ÿï¼Œè®¤ä¸ºå‡¡æ˜¯å‹¾å…‘çš„é…’éƒ½ä¸æ˜¯å¥½é…’ï¼Œè¿™ä¸ªè§‚ç‚¹æ˜¯é”™è¯¯çš„ã€‚ ä¸‹é¢ä»‹ç»ç™½é…’çš„é…¿é€ å·¥è‰ºæ—¶ä¼šè¯´åˆ°ï¼Œç²®é£Ÿç­‰æœ€åˆç»è¿‡å‘é…µã€è’¸é¦å½¢æˆçš„é…’å«â€œåŸæµ†â€ï¼ŒåŸæµ†çš„é…’ç²¾åº¦æ•°ä¸€èˆ¬åœ¨ 70 åº¦å·¦å³ï¼Œæ˜¯æ— æ³•ç›´æ¥é¥®ç”¨çš„ï¼Œéœ€è¦é™ä½å…¶åº¦æ•°æ‰èƒ½é¥®ç”¨ã€‚ å¦‚æœåœ¨å¸‚é¢ä¸Šçœ‹åˆ°å¦‚â€œèŒ…å°é•‡ç²®é£ŸåŸæµ†é…’â€ç­‰è¿™æ ·çš„â€œåŸæµ†é…’â€ï¼Œä½†åº¦æ•°ä½äº 70 åº¦(å·¦å³)çš„ï¼Œéƒ½ä¸æ˜¯çœŸæ­£çš„åŸæµ†é…’ã€‚è¿™æ ·çš„å•†å®¶è¦ä¹ˆæ˜¯ä¸è¯šä¿¡ï¼Œè¦ä¹ˆå°±æ˜¯ä¸ä¸“ä¸šã€‚ é™ä½åº¦æ•°ä¸æ˜¯ç›´æ¥å¾€é…’é‡Œé¢æºæ°´ï¼Œè¿™æ ·å£æ„Ÿä¼šéå¸¸å·®ï¼Œè€Œä¸”ä¼šä½¿é…’ä½“å˜æµ‘æµŠã€‚ éœ€è¦ä¸“é—¨çš„ç™½é…’å‹¾å…‘å·¥è‰ºï¼Œç™½é…’å‹¾å…‘ä¸€é—¨å¾ˆå¤æ‚çš„å­¦ç§‘ï¼Œå‹¾å…‘ä¸»è¦æ˜¯å°†ä¸åŒçš„åŸæ–™ã€ä¸åŒçª–æ± ã€ä¸åŒç¯èŠ‚ã€ä¸åŒå¹´ä»½çš„é…’è¿›è¡Œè°ƒé…ï¼Œä»è€Œäº§ç”Ÿå…·æœ‰ä¸åŒå£å‘³ã€é¦™å‹çš„ç™½é…’ã€‚ æ ‡å‡†çš„ç™½é…’å‹¾å…‘å·¥è‰ºä¸­æ˜¯ä¸å…è®¸æ·»åŠ åŒ–å­¦æ·»åŠ å‰‚çš„ï¼Œç™½é…’çš„å£å‘³ã€é¦™å‹éƒ½æ˜¯è‡ªç„¶å½¢æˆçš„ã€‚ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå¸‚é¢ä¸Šæ‰€æœ‰çš„é…’éƒ½æ˜¯â€œå‹¾å…‘é…’â€ï¼Œåªæ˜¯æ¯ç§é…’å‹¾å…‘æ‰€ç”¨çš„åŸæ–™ã€å·¥è‰ºä¸ç›¸åŒï¼ŒèŒ…å°ã€äº”ç²®æ¶²ã€æ±¾é…’ç­‰æ— ä¸€ä¾‹å¤–ä¹Ÿæ˜¯å‹¾å…‘è€Œæˆçš„ã€‚å¥½é…’é‡‡ç”¨â€œé…’å‹¾å…‘é…’â€çš„æ–¹å¼ï¼Œå·®é…’é‡‡ç”¨â€œé…’ç²¾å‹¾å…‘æ°´â€æˆ–è€…â€œé…’ç²¾+é¦™ç²¾+æ·»åŠ å‰‚å‹¾å…‘æ°´â€çš„æ–¹å¼ã€‚ 1.2 é…¿é€ å·¥è‰º1.2.1 çº¯ç²®å›ºæ€å‘é…µã€æ¶²æ€å‘é…µç™½é…’åœ¨é…¿é€ å·¥è‰ºä¸Šåˆ†ä¸ºçº¯ç²®å›ºæ€å‘é…µå’Œæ¶²æ€å‘é…µ 2 ç§ã€‚ çº¯ç²®å›ºæ€å‘é…µé…’æ˜¯é€šè¿‡ç²®é£Ÿ+æ›²+å‘é…µ+é™ˆé…¿+å‹¾å…‘ç­‰å‡ ä¸ªç¯èŠ‚åˆ¶æˆçš„ã€‚ æ¶²æ€å‘é…µé…’æ˜¯ç”¨ç”˜è”—å’Œç”œèœæ¸£ã€è–¯å¹²ã€ç‰ç±³ç­‰ï¼ˆè¿™å‡ ç§æ¤ç‰©å‘é…µå‘¨æœŸçŸ­ã€å‡ºé…’ç‡é«˜ã€é…’è´¨å·®ï¼‰åˆ¶é€ å‡ºæ¥çš„é£Ÿç”¨é…’ç²¾ä¸ºåŸºç¡€é…’ï¼ŒåŠ å…¥å¢é¦™è°ƒå‘³ç‰©è´¨æ¨¡æ‹Ÿä¼ ç»Ÿç²®é£Ÿç™½é…’çš„å£æ„Ÿï¼Œç»è°ƒé…è€Œæˆçš„æ¶²æ€ç™½é…’ï¼Œè¡Œè¯å«â€œä¸‰ç²¾ä¸€æ°´â€ï¼Œå³é£Ÿç”¨é…’ç²¾ã€é¦™ç²¾ã€ç³–ç²¾ã€æ°´ã€‚ ç”±äºçº¯ç²®å›ºæ€å‘é…µå·¥è‰ºæ‰€éµå¾ªçš„éƒ½æ˜¯è‡ªç„¶çš„é…¿é€ è§„å¾‹ï¼ŒåŠ ä¹‹æ›²ã€è€çª–ä¸­å¾®ç”Ÿç‰©çš„ä½œç”¨ï¼Œé…’ä½“ä¸­é™¤äº†ä¹™é†‡å¤–ï¼Œè¿˜è•´å«äº†ä¸°å¯Œçš„å·±é…¸ã€ä¹™é…¯ç­‰è¥å…»æˆåˆ†ã€‚é…¸æ˜¯ç™½é…’ä¸­çš„é‡è¦å‘ˆå‘³ç‰©è´¨ï¼Œå®ƒä¸å…¶ä»–é¦™å‘³ç‰©è´¨å…±åŒæ„æˆç™½é…’æ‰€ç‰¹æœ‰çš„èŠ³é¦™ã€‚ä¼˜è´¨çº¯ç²®å›ºæ€å‘é…µçš„ç™½é…’çš„é…¸è¶…è¿‡æ™®é€šæ¶²æ€ç™½é…’çš„ä¸¤å€ã€‚é…¯ä¹Ÿæ˜¯å›ºæ€å‘é…µç™½é…’çš„é¦™å‘³ç‰©è´¨ï¼Œä¼˜è´¨ç™½é…’çš„é…¯ç±»å«é‡æ¯”æ¶²æ€ç™½é…’é«˜å‡ºä¸€å€ä»¥ä¸Šï¼Œæ‰€ä»¥ä¼˜è´¨ç™½é…’é¦™å‘³æµ“éƒï¼Œè€Œæ¶²æ€å‘é…µç™½é…’çš„é¦™å‘³åªèƒ½é æ·»åŠ äººå·¥åˆæˆçš„é¦™å‘³ç‰©è´¨æ¥è§£å†³ã€‚ 1.2.2 é…¿é€ æµç¨‹è¿™é‡Œåªä»‹ç»ç™½é…’çº¯ç²®å›ºæ€é…¿é€ çš„å‡ å¤§ä¸»è¦çš„æµç¨‹ï¼Œæ¯ä¸ªé…’å‚ç”Ÿäº§é…’çš„ç‰¹ç‚¹ä¸ä¸€æ ·ï¼Œå…·ä½“ç»†èŠ‚ä¹Ÿä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œä½†éƒ½ç¦»ä¸å¼€è¿™å‡ å¤§æµç¨‹ã€‚ 1. é€‰æ–™åŸæ–™ä¸»è¦æ˜¯ç²®é£Ÿå’Œæ°´ã€‚ç²®é£Ÿä»¥é«˜ç²±ã€ç‰ç±³ã€å°éº¦ã€å¤§ç±³ã€ç³¯ç±³ç­‰ä¸­çš„ä¸€ç§æˆ–å¤šç§ä¸ºä¸»ï¼Œæ¯ç§ç²®é£Ÿé…¿å‡ºçš„é…’çš„å£å‘³éƒ½ä¸ä¸€æ ·ï¼Œæœ‰è¡Œä¸šæœ¯è¯­å«â€œé«˜ç²±é¦™ã€ç‰ç±³ç”œã€å¤§ç±³å‡€ã€å°éº¦ç³™ã€ç³¯ç±³ç»µâ€ã€‚ æ°´ï¼Œé…¿é…’å¯¹æ°´çš„è¦æ±‚å¾ˆé«˜ï¼Œå¸¸è¨€é“â€œæ°´ä¸ºé…’ä¹‹è¡€ï¼Œåé…’å¿…æœ‰ä½³æ³‰â€ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåªæœ‰èµ¤æ°´æ²³çš„æ°´æ‰èƒ½é…¿å‡ºèŒ…å°çš„åŸå› ã€‚ 2. åˆ¶æ›²å¦‚æœè¯´ç²®é£Ÿæ˜¯é…’çš„æ ¹æœ¬ï¼Œé‚£ä¹ˆâ€œæ›²å°±æ˜¯é…’çš„éª¨é«“â€ã€‚æ›²ç±»ä¼¼äºåšé¦’å¤´çš„é…µæ¯ã€‚æ›²ä¸»è¦æœ‰ 3 ç§ï¼š å¤§æ›²ï¼šç”±éº¦å­é«˜æ¸©åˆ¶æˆï¼Œå‘é…µå‘¨æœŸé•¿ã€å¾®ç”Ÿç‰©å«é‡ä¸°å¯Œï¼Œå¤šç”¨äºé«˜ç«¯ç™½é…’ã€‚ å°æ›²ï¼šç”±ç±³åˆ¶æˆï¼Œå‘é…µå‘¨æœŸçŸ­ã€å¾®ç”Ÿç‰©å«é‡ä½ã€‚ éº¸æ›²ï¼šç”±éº¸çš®ï¼ˆå°éº¦çš„å£³ï¼Œæ‰“ç¢ä¹‹åå«ç³ ï¼Œå†œæ‘å¸¸ç”¨äºå–‚çŒªï¼‰åˆ¶æˆï¼Œå‘é…µå‘¨æœŸçŸ­ï¼Œå‡ºé…’ç‡é«˜ï¼Œä½†é…’è´¨è¾ƒå·®ã€‚å¤šç”¨äºä½ç«¯é…’ï¼Œå¦‚äºŒé”…å¤´ç­‰ã€‚ 3. å‘é…µå°†ç²®é£Ÿå’Œæ›²æ”¾å…¥çª–æ± ä¸­å‘é…µï¼Œåˆ©ç”¨æ›²å’Œçª–æ± ä¸­çš„å¾®ç”Ÿç‰©å°†ç²®é£Ÿç³–åŒ–ã€å‘é…µæˆé…’ç²¾ã€‚ â€œåƒå¹´è€çª–â€ä¸­å«æœ‰çš„å¾®ç”Ÿç‰©ä¸°å¯Œï¼Œå‘é…µå‡ºæ¥çš„é…’å£æ„Ÿå’Œå‘³é“ä¹Ÿä¸ä¸€æ ·ã€‚ 4. è’¸é¦é å‘é…µå½¢æˆçš„é…’çš„é…’ç²¾åº¦æ•°å¾ˆä½ï¼Œéœ€è¦è¿›è¡Œæçº¯ã€‚åˆ©ç”¨é…’ç²¾å’Œæ°´çš„æ²¸ç‚¹ä¸ä¸€æ ·ï¼Œé‡‡ç”¨è’¸é¦æ³•è¿›è¡Œæçº¯ã€‚ è’¸é¦çš„è¿‡ç¨‹åˆ†ä¸ºå¤´ã€ä¸­ã€å°¾ 3 éƒ¨åˆ†ï¼Œäº§ç”Ÿçš„é…’ç§°ä¸ºé…’å¤´ã€ä¸­é¦é…’ã€é…’å°¾ï¼Œæ¯ç§é…’åœ¨é…’å‚ä¸­éƒ½æœ‰ä¸åŒçš„ç”¨å¤„ã€‚ 5. é™ˆé…¿ç»è¿‡è’¸é¦äº§ç”Ÿçš„é«˜åº¦æºé…’è¿˜åªèƒ½ç®—åŠæˆå“ï¼Œå–èµ·æ¥è¾›è¾£ï¼Œä¸é†‡å’Œã€‚éœ€è¦ç»è¿‡åˆç†çš„è´®å­˜ã€é™ˆé…¿ï¼Œä¸€æ–¹é¢è‡ªç„¶çš„æ’é™¤æ‚å‘³ï¼Œå¦ä¸€æ–¹é¢è®©é…’åˆ†å­ï¼ˆå³ä¹™é†‡åˆ†å­ï¼‰å’Œæ°´åˆ†å­å……åˆ†ç»“åˆï¼Œä½¿é…’çš„å£æ„Ÿæ›´åŠ é†‡åšã€‚è¿™ä¸€æ­¥é™ˆé…¿çš„è¶Šä¹…ï¼Œå£å‘³å°±è¶Šå¥½ï¼Œæˆæœ¬å°±è¶Šé«˜ï¼Œä»·æ ¼ä¹Ÿå°±è¶Šè´µã€‚ 6. å‹¾å…‘ç»è¿‡ä¸Šé¢å‡ ä¸ªæ­¥éª¤äº§ç”Ÿçš„é…’å°±å¯ä»¥ç§°ä¸ºâ€œåŸæµ†â€äº†ï¼Œåº¦æ•°è¾ƒé«˜ã€å£å‘³å•ä¸€ã€é¦™å‘³ä¸çº¯åœ¨ã€‚ä¸ºäº†ç»Ÿä¸€å£å‘³ï¼Œåè°ƒé¦™å‘³ã€é™ä½åº¦æ•°ï¼Œéœ€è¦ä¸“é—¨çš„è°ƒé…’å¸ˆå¯¹åŸæµ†é…’è¿›è¡Œå‹¾å…‘ã€‚ ç°åœ¨ç™½é…’å¸‚åœºè¶Šæ¥è¶Šæ¥ä¹±ï¼Œå„ç§æ··ã€é…ï¼Œå¦‚å›ºæ€å‘é…µç™½é…’+é£Ÿç”¨é…’ç²¾+é£Ÿç”¨é¦™ç²¾+å…¶ä»–æ·»åŠ ç‰©ç­‰ç­‰ï¼Œè®¤å‡†å¥½é…’é™¤äº†ç›¸ä¿¡ä¸€åˆ†é’±ä¸€åˆ†è´§ä¹‹å¤–ï¼Œè¿˜æœ‰**å¥½é…’åœ¨é…¿é€ å·¥è‰ºä¸Šéœ€å…·å¤‡è¿™ 3 ä¸ªå…³é”®è¯ çº¯ç²®ã€çº¯å›ºæ€ã€å¤§æ›²**ã€‚ç“¶èº«éƒ½æœ‰é…æ–™è¡¨ï¼Œå‡ºç°â€œé£Ÿç”¨é…’ç²¾â€çš„ä¸è¦è´­ä¹°ã€‚ 1.3 å¹´ä»½é…’æˆ‘ä»¬åœ¨å¸‚é¢ä¸Šç»å¸¸é‡åˆ°ç±»ä¼¼â€œç™½äº‘è¾¹ 12 å¹´â€ï¼Œâ€œç™½äº‘è¾¹ 15 å¹´â€ï¼Œâ€œç™½äº‘è¾¹ 20 å¹´â€è¿™æ ·çš„å¹´ä»½é…’ï¼Œå¾ˆå¤šäººè®¤ä¸ºè¿™ä¸ªâ€œ12 å¹´â€ã€â€œ15 å¹´â€ã€â€œ20 å¹´â€æŒ‡çš„è¿™ç“¶é…’å­˜å‚¨çš„å¹´ä»½ã€‚ å¦‚æœä½ æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ï¼Œé‚£åªèƒ½è¯´ä½ â€œå¤ªå¹´è½»ï¼Œå¤ªç®€å•â€äº†ã€‚ æ‹¿â€œç™½äº‘è¾¹ 20 å¹´â€ä¸ºä¾‹ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨ç™½é…’å‹¾å…‘è¿‡ç¨‹ä¸­æºå…¥äº†å°‘è®¸ 20 å¹´å¹´ä»½çš„é…’ï¼Œå…·ä½“çš„è¿™ä¸ªâ€œå°‘è®¸â€æŒ‡çš„æ˜¯å¤šå°‘å°±ä¸æ¸…æ¥šäº†ï¼Œå¯èƒ½æ˜¯ä¸€ç¼¸é…’:ä¸€æ¯ 20 å¹´é…’ï¼Œä¹Ÿå¯èƒ½æ›´å°‘æˆ–æ›´å¤šã€‚ ç°å®ä¸­ç”±äºé…’çš„å¹´ä»½ä¸åŒï¼Œä»·æ ¼å·®è·ä¹Ÿå·¨å¤§ï¼Œæ‰€ä»¥è°ƒé…’æ—¶æ‰€ç”¨çš„åŸºé…’çš„å“è´¨ç­‰ä¹Ÿä¼šæœ‰å·®åˆ«ï¼Œæ¯•ç«Ÿç™½äº‘è¾¹ 20 å¹´å’Œ 15 å¹´å–èµ·æ¥å·®åˆ«è¿˜æ˜¯å¾ˆå¤§çš„ã€‚ 1.4 ç™½é…’æ”¶è—ä¸€èˆ¬æ”¶è—é…’çš„å¹´ä»½æŒ‡çš„æ˜¯è¿™æ•´ç“¶é…’å­˜æ”¾çš„å¹´ä»½ã€‚ è¿™ä¸ªä»·å€¼ä¸æ˜¯å¹´ä»½é…’æ‰€èƒ½æ¯”æ‹Ÿçš„ã€‚æˆ‘ä»¬ç»å¸¸å¬è¯´â€œé…’æ˜¯é™ˆçš„é¦™â€ï¼Œä½†ç™½é…’æ˜¯ä¸æ˜¯å­˜æ”¾çš„è¶Šä¹…å°±ä¸€å®šè¶Šå¥½å–äº†ï¼Ÿ ä¸ä¸€å®šï¼Œè¿™ä¸ªå’Œé…’çš„è´¨é‡ã€å­˜æ”¾çš„ç¯å¢ƒã€å¯†å°ç¨‹åº¦ç­‰æœ‰å¾ˆå¤§å…³ç³»ã€‚ä¸€èˆ¬å­˜æ”¾ 3~5 å¹´å–ä¸ºå®œï¼Œå¾ˆå¤šå‡ åå¹´çš„é™ˆé…’å·²ç»ä¸é€‚åˆç›´æ¥å–äº†ï¼Œå¯ä»¥ç”¨æ¥ä½œä¸ºåŸºé…’è¿›è¡Œå‹¾è°ƒã€‚ æœ‰å‡ ç§é…’ä¸é€‚åˆé™ˆï¼š å«æ·»åŠ å‰‚çš„é…’ã€‚ç°åœ¨å¸‚é¢ä¸Šå¾ˆå¤šä½ç«¯é…’éƒ½åŠ å…¥äº†é¦™ç²¾ï¼Œå¦‚æœå­˜æ”¾æ—¶é—´é•¿äº†ï¼Œé¦™ç²¾æŒ¥å‘äº†ï¼Œå£æ„Ÿä¹Ÿä¼šä¸ä¸€æ ·ã€‚ ä½åº¦é…’ï¼ˆ43 åº¦ä»¥ä¸‹çš„é…’å°±ç®—ä½åº¦é…’äº†ï¼‰ã€‚ä¸–ç•Œä¸Šæ²¡æœ‰ç»å¯¹å¯†å°çš„ç¯å¢ƒï¼ˆæˆ‘ä»¬å¯èƒ½è®¤ä¸ºç»ç’ƒç“¶ã€é™¶ç“·ç“¶çš„ç“¶å£æ˜¯ç»å¯¹å°é—­çš„ï¼Œä½†ä»åˆ†å­çš„è§’åº¦æ¥çœ‹ï¼Œä»ç„¶ä¼šæœ‰é…’åˆ†å­çš„æ¸—æ¼æŒ¥å‘ï¼Œæ›´ä½•å†µè¿˜æœ‰ç“¶å£çš„å¯†å°ç­‰é—®é¢˜ï¼‰ï¼Œé…’æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰æŒ¥å‘ï¼Œä½åº¦é…’åº¦æ•°æœ¬æ¥å°±ä¸é«˜ï¼ŒæŒ¥å‘ä¹‹åé…’çš„åº¦æ•°å°±ä¼šæ›´ä½ï¼›å¦å¤–ï¼Œä½åº¦é…’æ€èŒèƒ½åŠ›è¾ƒå¼±ï¼Œå­˜å‚¨ä¸å½“ä¼šå¯¼è‡´å¾®ç”Ÿç‰©æ˜“åœ¨é…’ä½“ä¸­ç¹æ®–ã€‚ 2. ç™½é…’é¦™å‹åˆ†ç±»æ–°ä¸­å›½æˆç«‹ä¹‹åï¼Œä¸ºäº†åŠ å¼ºç™½é…’å¸‚åœºçš„ç®¡ç†ï¼Œæé«˜ç™½é…’è´¨é‡ï¼Œé€šè¿‡å¯¹ç™½é…’é¦™å‘³æˆåˆ†çš„åˆ†æï¼ˆå½“ç„¶åˆ°ç°åœ¨ä¹Ÿæ²¡å¼„æ¸…æ¥šé…±é¦™å‹ç™½é…’çš„é¦™å‘³æˆåˆ†ï¼‰ï¼Œæå‡ºäº†æŒ‰é¦™å‹å¯¹ç™½é…’åˆ†ç±»çš„æ–¹æ¡ˆã€‚æˆªæ­¢åˆ°ç°åœ¨ï¼Œç™½é…’çš„é¦™å‹æœ‰åå‡ ç§ä¹‹å¤šï¼Œä½†é…±é¦™å‹ã€æµ“é¦™å‹ã€æ¸…é¦™å‹è¿™ 3 ç§é¦™å‹å·®ä¸å¤šå æ®äº†ç™½é…’å¸‚åœº 90%çš„ä»½é¢ã€‚ é¦™å‹ ä»£è¡¨é…’ é…±é¦™å‹ èŒ…å°ã€éƒé…’ æµ“é¦™å‹ äº”ç²®æ¶²ã€æ³¸å·è€çª–ã€å‰‘å—æ˜¥ æ¸…é¦™å‹ æ±¾é…’ã€äºŒé”…å¤´ è‘£é¦™å‹ è‘£é…’ å‡¤é¦™å‹ è¥¿å‡¤é…’ å…¼é¦™å‹ ç™½äº‘è¾¹ é¦¥éƒé¦™å‹ é…’é¬¼é…’ ç±³é¦™å‹ ä¸‰èŠ±é…’ 3. é…±é¦™å‹ç™½é…’3.1 é…±é¦™ç™½é…’çš„ä¼˜ç‚¹ä¸ºä»€ä¹ˆå°†é…±é¦™å‹ç™½é…’å•ç‹¬æ‹¿å‡ºæ¥è¯´äº†ï¼Ÿä¸€ä¸ªæ˜¯å› ä¸ºæˆ‘è‡ªå·±çˆ±å–ï¼Œå¦å¤–ä¸€ä¸ªåŸå› æ˜¯å–é…±é¦™å‹ç™½é…’çš„ç¡®æœ‰è¯¸å¤šå¥½å¤„ã€‚é…±é¦™å‹ç™½é…’ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š æ­£è§„é…±é¦™å‹ç™½é…’å‡ºå‚å‰è¦ç»è¿‡ä¸‰å¹´ä»¥ä¸Šçš„è´®å­˜ï¼Œé…’ä½“ä¸­çš„æ˜“æŒ¥å‘ç‰©è´¨å°‘ï¼Œå¯¹èº«ä½“çš„åˆºæ¿€å°‘ã€‚èŒ…å°é…’ç©ºæ¯ç•™é¦™ä¹Ÿå’Œè¿™æœ‰ä¸€å®šçš„å…³ç³»ã€‚ å› ä¸ºæ˜“æŒ¥å‘ç‰©è´¨å°‘ï¼Œé…±é¦™å‹çš„é…’æ›´é€‚åˆå­˜æ”¾ï¼Œè¶Šé™ˆè¶Šé¦™ã€‚ é…±é¦™å‹ç™½é…’çš„é…¸åº¦é«˜ã€å« SOD ç­‰ç‰©è´¨ï¼Œå¯¹è½¯åŒ–è¡€ç®¡ï¼ŒæŠ—æ°§åŒ–ç­‰æ–¹é¢æœ‰ä¸€å®šçš„å¸®åŠ©ã€‚ ç›®å‰è¿˜æ²¡æ‰¾åˆ°å¯ä»¥äº§ç”Ÿé…±é¦™å‘³çš„ä¸»è¦é¦™å‘³ç‰©è´¨ï¼Œæ‰€ä»¥å¾ˆéš¾é€šè¿‡é¦™ç²¾ã€æ·»åŠ å‰‚é€ å‡ã€‚ å›½å®¶å·²ç»å‡ºå°é…±é¦™å‹ç™½é…’å›½å®¶æ ‡å‡†ï¼Œæ˜ç¡®è§„å®šé…±é¦™å‹ç™½é…’ä¸å…è®¸ä½¿ç”¨é£Ÿç”¨é…’ç²¾åŠéç™½é…’å‘é…µç”Ÿäº§çš„å‘ˆé¦™ã€å‘ˆå‘³ã€å‘ˆè‰²ç‰©è´¨ï¼Œå¿…é¡»æ˜¯ä½¿ç”¨çº¯ç²®é£Ÿã€å›ºæ€æ³•å‘é…µè€Œæˆã€‚ï¼ˆä½†ä½ç«¯é…±é¦™é…’å› ä¸ºæˆæœ¬ç­‰åŸæœ‰å¾ˆéš¾è¾¾ä½¿ç”¨å¤§æ›²å‘é…µï¼‰ã€‚ ä¸Šé¢åˆ—å‡ºçš„é…±é¦™å‹é…’çš„è¯¸å¤šå¥½å¤„éƒ½æ˜¯åŸºäºé€‚é‡é¥®é…’çš„å‰æã€‚ 3.2 å¤æ²™ã€ç¢æ²™ã€ç¿»æ²™ã€ä¸²æ²™å¤æ²™ã€ç¢æ²™ã€ç¿»æ²™ã€ä¸²æ²™è¿™äº›åè¯æ˜¯ä¸“é—¨ç”¨äºé…±é¦™å‹ç™½é…’çš„å·¥è‰ºã€‚â€œæ²™â€æŒ‡çš„æ˜¯é«˜ç²±ï¼Œä¸æ˜¯æ²™å­ã€‚ å¤æ²™é…’â€œå¤â€æ˜¯éŸ³è¯‘è¿‡æ¥çš„ï¼Œä¹Ÿå«åšâ€œæ†â€ï¼Œè¡¨ç¤ºç”¨å®Œæ•´çš„é«˜ç²±æ¥é…¿é…’ã€‚å¤æ²™é…’ä¹Ÿå«æ†æ²™é…’ã€å¤ç±½é…’ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ­£å®—çš„é…±é¦™å‹ç™½é…’ã€‚ä¸¥æ ¼æŒ‰ç…§ä¼ ç»Ÿçš„è´µå·èŒ…å°é•‡å·¥è‰ºè¿›è¡Œç”Ÿäº§ï¼Œé‡‡ç”¨å½“åœ°äº§çš„ç³¯é«˜ç²±ã€å°éº¦ï¼Œç”Ÿäº§å‘¨æœŸé•¿è¾¾ä¸€å¹´ï¼Œå‡ºé…’ç‡ä½ï¼Œä½†é…’è´¨å¥½ã€‚éœ€è¦ç»è¿‡å¾ˆé‡è¦çš„â€œå›æ²™â€œå·¥è‰ºï¼Œå³ 1 å¹´ç”Ÿäº§ã€2 æ¬¡æŠ•æ–™ã€9 æ¬¡è’¸é¦ã€8 æ¬¡å‘é…µã€7 æ¬¡å–é…’ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ 12987 ç”Ÿäº§å·¥è‰ºï¼Œç„¶åè¿˜è¦ç»è¿‡ä¸‰å¹´ä»¥ä¸Šçš„é™ˆé…¿æ‰èƒ½å¤Ÿå‡ºå‚ã€‚åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­é«˜ç²±ä¸èƒ½å¤Ÿç²‰ç¢ï¼Œé«˜ç²±çš„ç²‰ç¢ç‡éœ€æ§åˆ¶åœ¨ 20%ä»¥å†…ã€‚ å¤æ²™é…’ç”Ÿäº§æµç¨‹éå¸¸å¤æ‚ï¼Œå‘¨æœŸé•¿ï¼Œä¸”å‡ºé…’ç‡ä½ï¼Œè¿™ä¹Ÿæ˜¯èŒ…å°é£å¤©ç­‰é«˜ç«¯é…±é¦™å‹é…’ä»·æ ¼å±…é«˜ä¸ä¸‹çš„ä¸€ä¸ªåŸå› å§ã€‚ ç¢æ²™é…’ç¢æ²™å·¥è‰ºå°±æ˜¯æŒ‡ç”¨è¢«å®Œå®Œå…¨å…¨ç²‰ç¢çš„é«˜ç²±æ¥é…¿é…’ã€‚ç¢æ²™å·¥è‰ºç”Ÿäº§å‘¨æœŸè¾ƒçŸ­ï¼Œå‡ºé…’ç‡é«˜ï¼Œä¸è¦ç»è¿‡åƒå¤æ²™é‚£ä¹ˆä¸¥æ ¼çš„â€å›æ²™â€œå·¥è‰ºï¼Œæ‰€å‡ºé…’çš„é…±é¦™å‘³å•è–„ï¼Œä¸å¦‚å¤æ²™é‚£æ ·é…±é¦™å‘³æµ“éƒã€‚ä½†è¾ƒå¥½å…¥å£ï¼Œä¹Ÿèµ¢å¾—äº†ä¸€éƒ¨åˆ†äººçš„å–œçˆ±ã€‚å¸‚é¢ä¸Šçš„ä¸­ä½ç«¯é…±é¦™ç™½é…’å¤§å¤šé‡‡ç”¨æ­¤ç§å·¥è‰ºã€‚ ç¿»æ²™é…’ç¿»æ²™å°±æ˜¯åˆ©ç”¨å¤æ²™å·¥è‰ºä¸­æœ€åä¸€æ¬¡ï¼ˆç¬¬ 9 æ¬¡ï¼‰è’¸é¦ä¹‹ååºŸå¼ƒçš„é…’ç³Ÿï¼Œå†æ¬¡åŠ å…¥é«˜ç²±å’Œæ›²ï¼Œé‡æ–°å‘é…µé…¿å‡ºæ¥çš„é…’ã€‚ç¿»æ²™é…’ç”Ÿäº§å‘¨æœŸçŸ­ï¼Œå‡ºé…’ç‡é«˜ï¼Œä½†å“è´¨å·®ã€‚è¿™æ ·åšåªæ˜¯åˆ©ç”¨é…’ç³Ÿè®©é…’å¤šäº†ä¸€ç‚¹é…±é¦™å‘³ã€‚å› ä¸ºç”Ÿäº§æˆæœ¬ä½å»‰ï¼Œå¸‚åœºä¸Šå¾ˆå¤šä½ç«¯é…±é¦™å‹é…’å¤šæ˜¯ç”¨çš„è¿™ç§æ–¹æ³•ã€‚ ä¸²æ²™é…’çªœæ²™é…’ï¼Œä¹Ÿå«ä¸²é¦™é…’ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¤æ²™å·¥è‰ºä¸­æœ€åä¸€æ¬¡ï¼ˆç¬¬ 9 æ¬¡ï¼‰è’¸é¦ä¹‹ååºŸå¼ƒçš„é…’ç³Ÿï¼Œä½†æ˜¯å®ƒæ˜¯ç›´æ¥åŠ å…¥é£Ÿç”¨é…’ç²¾è’¸é¦ã€‚é…’è´¨å¾ˆå·®ï¼Œæˆæœ¬éå¸¸ä½å»‰ã€‚è¿™ç§é…’ä¸ç¬¦åˆé…±é¦™å‹çš„å›½å®¶æ ‡å‡†ï¼Œä¸èƒ½ç®—é…±é¦™å‹ç™½é…’äº†ã€‚ 3.3 èŒ…å°åŠå­å“ç‰Œè¯´åˆ°é…±é¦™å°±ä¸èƒ½ä¸æèŒ…å°äº†ï¼Œé…±é¦™å‹é…’æ›¾ç»ä¸€åº¦ä¹Ÿå«â€œèŒ…é¦™å‹é…’â€ã€‚â€œä»ŠèŒ…å·²éå½¼èŒ…â€ï¼ŒèŒ…å°ä»Šå¤©å·²ç»æ˜¯ä¸€ä¸ªä¸Šå¸‚å…¬å¸ï¼Œå¤§é›†å›¢ï¼Œæ——ä¸‹æœ‰å¾ˆå¤šå­å…¬å¸ï¼Œæ¯ä¸ªå­å…¬å¸éƒ½æœ‰è‡ªå·±çš„å“ç‰Œã€‚å¸¸è§çš„æœ‰é£å¤©èŒ…å°ã€äº”æ˜ŸèŒ…å°ã€èŒ…å°ç‹å­é…’ã€èŒ…å°è¿å®¾é…’ã€æ±‰é…±ç­‰ç­‰ï¼Œå®ƒä»¬æœ‰è´µçš„ï¼Œä¹Ÿæœ‰ä¾¿å®œçš„ï¼Œè¿™ä¹Ÿæ˜¯èŒ…å°é›†å›¢å¤šå“ç‰Œæˆ˜ç•¥çš„æ ¸å¿ƒï¼Œä»¥é€‚åº”å„ç§æ¶ˆè´¹å±‚æ¬¡çš„éœ€æ±‚ã€‚ ä¸‹å›¾æ˜¯èŒ…å°é›†å›¢åŠå…¶å­å…¬å¸çš„ç™½é…’ç±»å“ç‰Œï¼š æˆ‘ä»¬å¸¸è¯´çš„é«˜ç«¯èŒ…å°æŒ‡çš„è´µå·èŒ…å°é…’è‚¡ä»½æœ‰é™å…¬å¸ç”Ÿäº§çš„é£å¤©èŒ…å°ã€äº”æ˜ŸèŒ…å°ã€èŒ…å°çºªå¿µé…’ã€èŒ…å°ç”Ÿè‚–é…’ã€èŒ…å°é™ˆå¹´é…’ï¼Œè¿™äº›é«˜ç«¯èŒ…å°é…’å¤§å¤šæœ‰ 43 åº¦å’Œ 53 åº¦ 2 ç§åº¦æ•°ã€‚åº¦æ•°ä¸åŒï¼Œä»·æ ¼å·®è·å¾ˆå¤§ï¼Œä»¥é£å¤©èŒ…å°å¸‚åœºä»·ä¸ºä¾‹ï¼Œ43 åº¦çš„å·®ä¸å¤š 900 å…ƒï¼Œ53 åº¦çš„å°†è¿‘ 2400 å…ƒã€‚ 4. å¦‚ä½•å–é…’å–é…’å½“ç„¶æ˜¯ç”¨å˜´å–ï¼Œè¿™é‡Œè¯´çš„å–é…’ä¸€å®šç¨‹åº¦ä¸ŠæŒ‡çš„æ˜¯å“é…’ï¼Œä½†å“é…’æ˜¯ä¸€ä¸ªå¾ˆä¸“ä¸šçš„äº‹æƒ…ï¼Œä¸æ˜¯ä¸€ä¸¤å¥è¯å¯ä»¥è¯´çš„æ¸…çš„ï¼Œéœ€è¦ä¸“ä¸šçš„çŸ¥è¯†å’Œç»éªŒçš„ç´¯ç§¯ï¼Œæ•…è¿™é‡Œä½¿ç”¨â€œå¦‚ä½•å“é…’â€è¿™ä¸ªæ ‡é¢˜ã€‚é…’æ˜¯å°å£å°å£çš„å“çš„ï¼Œç»ä¸æ˜¯â€œæˆ‘å¹²äº†ï¼Œä½ éšæ„â€å¼çš„å–æ³•ã€‚ä¸‹é¢åˆ—å‡ºæˆ‘çš„ä¸€ç‚¹å–é…’çš„æ–¹æ³•ï¼š 4.1 æœ›å€’å…¥æ¯ä¸­çœ‹æ˜¯å¦æœ‰é…’èŠ±ï¼Œæ˜¯å¦æŒ‚æ¯ã€‚è§‚å¯Ÿé…’çš„é¢œè‰²ï¼Œå¦‚é…±é¦™å‹çš„é…’ä¼šå¾®å¾®åé»„ã€‚ 4.2 é—»ç«¯èµ·é…’æ¯é—»é…’é¦™ï¼Œä¸åŒçš„é…’æœ‰ä¸åŒçš„é¦™å‘³ï¼Œæœ‰æ—¶å€™é€šè¿‡é¦™å‘³æ˜¯å¦çº¯åœ¨å°±å¯ä»¥åˆ¤æ–­ä¸€ä¸ªé…’çš„å¥½åã€‚å–å®Œä¹‹åï¼Œå¯ä»¥é—»é—»æ˜¯å¦ç©ºæ¯ç•™é¦™ç­‰ç­‰ã€‚ 4.3 å’‚å«åœ¨å£ä¸­ï¼Œæ…¢æ…¢æ„Ÿå—é…’çš„æ°”å‘³ï¼Œæ˜¯æŸ”å’Œè¿˜æ˜¯åˆºæ¿€ï¼›ä»èˆŒå°–æ»‘åˆ°èˆŒæ ¹ï¼Œæœ€ååˆ°å–‰å’™ï¼›å›å‘³æ˜¯å¦ç”˜ç”œã€‚","tags":["é…’"],"categories":["æ‚å¿µ"]},{"path":"/404.html","content":""},{"title":"å…³äº","path":"/author/index.html","content":"æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¤´è¡”ï¼Œä¹Ÿæ²¡è¢«å½’ä¸ºæŸä¸€ç±»åˆ«ï¼Œé™¤äº†ä¸åŠ³è€Œè·çš„å§“åã€æ€§åˆ«å’Œå¹´é¾„ï¼Œè¿˜çœŸæ˜¯ä¸€ç‰‡ç©ºç™½ã€‚ æˆ‘æ‰€çŸ¥çš„ï¼Œæ˜¯æˆ‘æ— é™çš„æ— çŸ¥ã€‚ è‡ªè¯©ä¸ºâ€œä»£ç çƒ¹é¥ªå¸ˆâ€ï¼Œçƒ¹é¥ªä»£ç åä½™è½½ï¼Œå¯ä»¥ä½¿ç”¨ C&#x2F;C++ã€JavaScriptã€TypeScriptã€Qtã€Node.jsã€Golangã€Electronã€NSISã€Pythonã€Visual Basicã€C#ç­‰ææ–™çƒ¹é¥ªå„å¼èœè‚´ã€‚ æˆ‘åœ¨ Github åˆ†äº«äº†ä¸€äº›èœè‚´ï¼Œæ¬¢è¿å“é‰´ï¼ æˆ‘æ˜¯ä» 2017 å¹´å¼€å§‹å†™åšå®¢çš„ï¼Œä»æ­¤å–œæ¬¢ä¸Šäº†è¿™é¡¹â€œè¿åŠ¨â€ï¼Œæœ€åˆæ˜¯æ··è¿¹åœ¨ CSDNï¼Œåœ¨ä¸Šé¢å‘å¸ƒäº†ä¸€äº›æ–‡ç« ï¼Œä¹Ÿæœ‰äº†ç‚¹æµè§ˆé‡ï¼Œè¿˜æ··äº†ä¸ªâ€œåšå®¢ä¸“å®¶â€ï¼Œä½†è¿‘äº›å¹´ CSDN çš„è¿è¥ç­–ç•¥è¶Šæ¥è¶Šç¥å‡ºé¬¼æ²¡ï¼Œå—å¤Ÿäº†ï¼Œå› æ­¤åé¢å†™çš„ä¸œè¥¿å°†ä¼˜å…ˆå‘å¸ƒåœ¨è¿™ä¸ªç«™ç‚¹ã€‚ æˆ‘æ—¶é•¿é—®è‡ªå·±â€œä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿâ€ï¼Œâ€œè¿™æ ·åšæœ‰æ„ä¹‰å—ï¼Ÿâ€ ä¿—è¯è¯´â€œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´â€ï¼Œåšå®¢ä¹Ÿæ˜¯æˆ‘çš„åœ¨çº¿ç¬”è®°ï¼Œå¯ä»¥æ–¹ä¾¿æˆ‘éšæ—¶å›é¡¾å’ŒæŸ¥é˜…ã€‚æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œä¸‰å¹´å‰å†™çš„ä¸œè¥¿ï¼Œä¸‰å¹´åé‡æ–°æ„Ÿæ‚Ÿï¼Œåˆæ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„çŠ¶æ€ï¼Œæˆ‘æ—¶é•¿ä¹Ÿä¼šå›å¤´æ¸©ä¹ ä¹‹å‰å†™çš„æ–‡ç« ï¼Œå¦‚è‹¥å‘ç°ä¸å½“æˆ–é”™è¯¯ä¹‹å¤„ï¼Œä¼šåŠæ—¶åœ°è¿›è¡Œä¿®æ­£ã€‚ é€šè¿‡å†™åšå®¢è¿˜å¯ä»¥ä¿ƒä½¿æˆ‘è¿›è¡Œæ€è€ƒå’Œæ€»ç»“ï¼Œä»¥åå‘è¾“å‡ºçš„å½¢å¼é€¼è¿«æˆ‘å¯¹çŸ¥è¯†ä½“ç³»è¿›è¡Œæ·±å…¥å’Œå®Œå–„ï¼ŒæŠŠçŸ¥è¯†ç”±ç‚¹è¿æˆçº¿ï¼Œå†ä»çº¿å˜æˆé¢ã€‚ ä¾æˆ‘æ‰€è§ï¼ŒçŸ¥è¯†å°±åƒéš”ç€ä¸€å±‚çª—æˆ·çº¸ï¼Œåœ¨æ²¡ç”¨æ…ç ´ä¹‹å‰ï¼Œç»™äººä¸€ç§é«˜æ·±è€Œç¥ç§˜çš„æ„Ÿè§‰ï¼Œä½†æ˜¯ä¸€æ—¦æŒæ¡äº†å®ƒï¼Œæ…ç ´äº†è¿™å±‚çª—æˆ·çº¸ï¼Œä¹Ÿå°±æ„Ÿè§‰å¹³å¹³æ— å¥‡äº†ï¼Œæ‰€ä»¥æˆ‘æŠŠæˆ‘æ‰€æŒæ¡çš„çŸ¥è¯†åŠ ä¸Šæˆ‘çš„ç†è§£åˆ†äº«ç»™å…¶ä»–äººï¼Œè‹¥èƒ½å¸®åŠ©åˆ°ä»–äººæ›´å¿«åœ°æ…ç ´çª—æˆ·çº¸ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä»¶æä¸ºå¼€å¿ƒçš„äº‹æƒ…ã€‚ å¦‚æœä½ æƒ³è”ç³»æˆ‘ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼š QQ: 295492457 Email: &#x73;&#x6d;&#x61;&#114;&#x74;&#55;&#x31;&#55;&#56;&#x40;&#x31;&#x36;&#x33;&#46;&#99;&#x6f;&#109;"},{"title":"å‹é“¾","path":"/friends/index.html","content":"v2ex"}]